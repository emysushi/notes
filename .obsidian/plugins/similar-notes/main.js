var P0=Object.create;var ao=Object.defineProperty;var C0=Object.getOwnPropertyDescriptor;var I0=Object.getOwnPropertyNames;var A0=Object.getPrototypeOf,$0=Object.prototype.hasOwnProperty;var O0=(t,e,r)=>e in t?ao(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var I=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),sh=(t,e)=>{for(var r in e)ao(t,r,{get:e[r],enumerable:!0})},ah=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of I0(e))!$0.call(t,i)&&i!==r&&ao(t,i,{get:()=>e[i],enumerable:!(n=C0(e,i))||n.enumerable});return t};var Z=(t,e,r)=>(r=t!=null?P0(A0(t)):{},ah(e||!t||!t.__esModule?ao(r,"default",{value:t,enumerable:!0}):r,t)),F0=t=>ah(ao({},"__esModule",{value:!0}),t);var Ar=(t,e,r)=>O0(t,typeof e!="symbol"?e+"":e,r);var Qe=I((lh,zs)=>{(function(t,e){"use strict";typeof define=="function"&&define.amd?define(e):typeof zs=="object"&&zs.exports?zs.exports=e():t.log=e()})(lh,function(){"use strict";var t=function(){},e="undefined",r=typeof window!==e&&typeof window.navigator!==e&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"],i={},o=null;function s(_,w){var b=_[w];if(typeof b.bind=="function")return b.bind(_);try{return Function.prototype.bind.call(b,_)}catch{return function(){return Function.prototype.apply.apply(b,[_,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(_){return _==="debug"&&(_="log"),typeof console===e?!1:_==="trace"&&r?a:console[_]!==void 0?s(console,_):console.log!==void 0?s(console,"log"):t}function u(){for(var _=this.getLevel(),w=0;w<n.length;w++){var b=n[w];this[b]=w<_?t:this.methodFactory(b,_,this.name)}if(this.log=this.debug,typeof console===e&&_<this.levels.SILENT)return"No console available for logging"}function c(_){return function(){typeof console!==e&&(u.call(this),this[_].apply(this,arguments))}}function d(_,w,b){return l(_)||c.apply(this,arguments)}function p(_,w){var b=this,m,h,g,y="loglevel";typeof _=="string"?y+=":"+_:typeof _=="symbol"&&(y=void 0);function v(C){var D=(n[C]||"silent").toUpperCase();if(!(typeof window===e||!y)){try{window.localStorage[y]=D;return}catch{}try{window.document.cookie=encodeURIComponent(y)+"="+D+";"}catch{}}}function x(){var C;if(!(typeof window===e||!y)){try{C=window.localStorage[y]}catch{}if(typeof C===e)try{var D=window.document.cookie,ge=encodeURIComponent(y),un=D.indexOf(ge+"=");un!==-1&&(C=/^([^;]+)/.exec(D.slice(un+ge.length+1))[1])}catch{}return b.levels[C]===void 0&&(C=void 0),C}}function k(){if(!(typeof window===e||!y)){try{window.localStorage.removeItem(y)}catch{}try{window.document.cookie=encodeURIComponent(y)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function E(C){var D=C;if(typeof D=="string"&&b.levels[D.toUpperCase()]!==void 0&&(D=b.levels[D.toUpperCase()]),typeof D=="number"&&D>=0&&D<=b.levels.SILENT)return D;throw new TypeError("log.setLevel() called with invalid level: "+C)}b.name=_,b.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},b.methodFactory=w||d,b.getLevel=function(){return g??h??m},b.setLevel=function(C,D){return g=E(C),D!==!1&&v(g),u.call(b)},b.setDefaultLevel=function(C){h=E(C),x()||b.setLevel(C,!1)},b.resetLevel=function(){g=null,k(),u.call(b)},b.enableAll=function(C){b.setLevel(b.levels.TRACE,C)},b.disableAll=function(C){b.setLevel(b.levels.SILENT,C)},b.rebuild=function(){if(o!==b&&(m=E(o.getLevel())),u.call(b),o===b)for(var C in i)i[C].rebuild()},m=E(o?o.getLevel():"WARN");var H=x();H!=null&&(g=E(H)),u.call(b)}o=new p,o.getLogger=function(w){if(typeof w!="symbol"&&typeof w!="string"||w==="")throw new TypeError("You must supply a name when creating a logger.");var b=i[w];return b||(b=i[w]=new p(w,o.methodFactory)),b};var f=typeof window!==e?window.log:void 0;return o.noConflict=function(){return typeof window!==e&&window.log===o&&(window.log=f),o},o.getLoggers=function(){return i},o.default=o,o})});var Ph=I(G=>{"use strict";var po=Symbol.for("react.element"),G0=Symbol.for("react.portal"),q0=Symbol.for("react.fragment"),H0=Symbol.for("react.strict_mode"),K0=Symbol.for("react.profiler"),Q0=Symbol.for("react.provider"),J0=Symbol.for("react.context"),X0=Symbol.for("react.forward_ref"),Z0=Symbol.for("react.suspense"),Y0=Symbol.for("react.memo"),ex=Symbol.for("react.lazy"),_h=Symbol.iterator;function tx(t){return t===null||typeof t!="object"?null:(t=_h&&t[_h]||t["@@iterator"],typeof t=="function"?t:null)}var vh={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},bh=Object.assign,xh={};function ui(t,e,r){this.props=t,this.context=e,this.refs=xh,this.updater=r||vh}ui.prototype.isReactComponent={};ui.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};ui.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Sh(){}Sh.prototype=ui.prototype;function oc(t,e,r){this.props=t,this.context=e,this.refs=xh,this.updater=r||vh}var sc=oc.prototype=new Sh;sc.constructor=oc;bh(sc,ui.prototype);sc.isPureReactComponent=!0;var yh=Array.isArray,Th=Object.prototype.hasOwnProperty,ac={current:null},Mh={key:!0,ref:!0,__self:!0,__source:!0};function kh(t,e,r){var n,i={},o=null,s=null;if(e!=null)for(n in e.ref!==void 0&&(s=e.ref),e.key!==void 0&&(o=""+e.key),e)Th.call(e,n)&&!Mh.hasOwnProperty(n)&&(i[n]=e[n]);var a=arguments.length-2;if(a===1)i.children=r;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];i.children=l}if(t&&t.defaultProps)for(n in a=t.defaultProps,a)i[n]===void 0&&(i[n]=a[n]);return{$$typeof:po,type:t,key:o,ref:s,props:i,_owner:ac.current}}function rx(t,e){return{$$typeof:po,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function lc(t){return typeof t=="object"&&t!==null&&t.$$typeof===po}function nx(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return e[r]})}var wh=/\/+/g;function ic(t,e){return typeof t=="object"&&t!==null&&t.key!=null?nx(""+t.key):e.toString(36)}function Ks(t,e,r,n,i){var o=typeof t;(o==="undefined"||o==="boolean")&&(t=null);var s=!1;if(t===null)s=!0;else switch(o){case"string":case"number":s=!0;break;case"object":switch(t.$$typeof){case po:case G0:s=!0}}if(s)return s=t,i=i(s),t=n===""?"."+ic(s,0):n,yh(i)?(r="",t!=null&&(r=t.replace(wh,"$&/")+"/"),Ks(i,e,r,"",function(u){return u})):i!=null&&(lc(i)&&(i=rx(i,r+(!i.key||s&&s.key===i.key?"":(""+i.key).replace(wh,"$&/")+"/")+t)),e.push(i)),1;if(s=0,n=n===""?".":n+":",yh(t))for(var a=0;a<t.length;a++){o=t[a];var l=n+ic(o,a);s+=Ks(o,e,r,l,i)}else if(l=tx(t),typeof l=="function")for(t=l.call(t),a=0;!(o=t.next()).done;)o=o.value,l=n+ic(o,a++),s+=Ks(o,e,r,l,i);else if(o==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return s}function Hs(t,e,r){if(t==null)return t;var n=[],i=0;return Ks(t,n,"","",function(o){return e.call(r,o,i++)}),n}function ix(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var De={current:null},Qs={transition:null},ox={ReactCurrentDispatcher:De,ReactCurrentBatchConfig:Qs,ReactCurrentOwner:ac};function Eh(){throw Error("act(...) is not supported in production builds of React.")}G.Children={map:Hs,forEach:function(t,e,r){Hs(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return Hs(t,function(){e++}),e},toArray:function(t){return Hs(t,function(e){return e})||[]},only:function(t){if(!lc(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};G.Component=ui;G.Fragment=q0;G.Profiler=K0;G.PureComponent=oc;G.StrictMode=H0;G.Suspense=Z0;G.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ox;G.act=Eh;G.cloneElement=function(t,e,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var n=bh({},t.props),i=t.key,o=t.ref,s=t._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,s=ac.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)Th.call(e,l)&&!Mh.hasOwnProperty(l)&&(n[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)n.children=r;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];n.children=a}return{$$typeof:po,type:t.type,key:i,ref:o,props:n,_owner:s}};G.createContext=function(t){return t={$$typeof:J0,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Q0,_context:t},t.Consumer=t};G.createElement=kh;G.createFactory=function(t){var e=kh.bind(null,t);return e.type=t,e};G.createRef=function(){return{current:null}};G.forwardRef=function(t){return{$$typeof:X0,render:t}};G.isValidElement=lc;G.lazy=function(t){return{$$typeof:ex,_payload:{_status:-1,_result:t},_init:ix}};G.memo=function(t,e){return{$$typeof:Y0,type:t,compare:e===void 0?null:e}};G.startTransition=function(t){var e=Qs.transition;Qs.transition={};try{t()}finally{Qs.transition=e}};G.unstable_act=Eh;G.useCallback=function(t,e){return De.current.useCallback(t,e)};G.useContext=function(t){return De.current.useContext(t)};G.useDebugValue=function(){};G.useDeferredValue=function(t){return De.current.useDeferredValue(t)};G.useEffect=function(t,e){return De.current.useEffect(t,e)};G.useId=function(){return De.current.useId()};G.useImperativeHandle=function(t,e,r){return De.current.useImperativeHandle(t,e,r)};G.useInsertionEffect=function(t,e){return De.current.useInsertionEffect(t,e)};G.useLayoutEffect=function(t,e){return De.current.useLayoutEffect(t,e)};G.useMemo=function(t,e){return De.current.useMemo(t,e)};G.useReducer=function(t,e,r){return De.current.useReducer(t,e,r)};G.useRef=function(t){return De.current.useRef(t)};G.useState=function(t){return De.current.useState(t)};G.useSyncExternalStore=function(t,e,r){return De.current.useSyncExternalStore(t,e,r)};G.useTransition=function(){return De.current.useTransition()};G.version="18.3.1"});var fo=I((zC,Ch)=>{"use strict";Ch.exports=Ph()});var zh=I(te=>{"use strict";function pc(t,e){var r=t.length;t.push(e);e:for(;0<r;){var n=r-1>>>1,i=t[n];if(0<Js(i,e))t[n]=e,t[r]=i,r=n;else break e}}function Ot(t){return t.length===0?null:t[0]}function Zs(t){if(t.length===0)return null;var e=t[0],r=t.pop();if(r!==e){t[0]=r;e:for(var n=0,i=t.length,o=i>>>1;n<o;){var s=2*(n+1)-1,a=t[s],l=s+1,u=t[l];if(0>Js(a,r))l<i&&0>Js(u,a)?(t[n]=u,t[l]=r,n=l):(t[n]=a,t[s]=r,n=s);else if(l<i&&0>Js(u,r))t[n]=u,t[l]=r,n=l;else break e}}return e}function Js(t,e){var r=t.sortIndex-e.sortIndex;return r!==0?r:t.id-e.id}typeof performance=="object"&&typeof performance.now=="function"?(Ih=performance,te.unstable_now=function(){return Ih.now()}):(uc=Date,Ah=uc.now(),te.unstable_now=function(){return uc.now()-Ah});var Ih,uc,Ah,Ht=[],$r=[],sx=1,gt=null,Pe=3,Ys=!1,pn=!1,mo=!1,Fh=typeof setTimeout=="function"?setTimeout:null,Nh=typeof clearTimeout=="function"?clearTimeout:null,$h=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function fc(t){for(var e=Ot($r);e!==null;){if(e.callback===null)Zs($r);else if(e.startTime<=t)Zs($r),e.sortIndex=e.expirationTime,pc(Ht,e);else break;e=Ot($r)}}function hc(t){if(mo=!1,fc(t),!pn)if(Ot(Ht)!==null)pn=!0,gc(mc);else{var e=Ot($r);e!==null&&_c(hc,e.startTime-t)}}function mc(t,e){pn=!1,mo&&(mo=!1,Nh(go),go=-1),Ys=!0;var r=Pe;try{for(fc(e),gt=Ot(Ht);gt!==null&&(!(gt.expirationTime>e)||t&&!Dh());){var n=gt.callback;if(typeof n=="function"){gt.callback=null,Pe=gt.priorityLevel;var i=n(gt.expirationTime<=e);e=te.unstable_now(),typeof i=="function"?gt.callback=i:gt===Ot(Ht)&&Zs(Ht),fc(e)}else Zs(Ht);gt=Ot(Ht)}if(gt!==null)var o=!0;else{var s=Ot($r);s!==null&&_c(hc,s.startTime-e),o=!1}return o}finally{gt=null,Pe=r,Ys=!1}}var ea=!1,Xs=null,go=-1,Lh=5,Rh=-1;function Dh(){return!(te.unstable_now()-Rh<Lh)}function cc(){if(Xs!==null){var t=te.unstable_now();Rh=t;var e=!0;try{e=Xs(!0,t)}finally{e?ho():(ea=!1,Xs=null)}}else ea=!1}var ho;typeof $h=="function"?ho=function(){$h(cc)}:typeof MessageChannel<"u"?(dc=new MessageChannel,Oh=dc.port2,dc.port1.onmessage=cc,ho=function(){Oh.postMessage(null)}):ho=function(){Fh(cc,0)};var dc,Oh;function gc(t){Xs=t,ea||(ea=!0,ho())}function _c(t,e){go=Fh(function(){t(te.unstable_now())},e)}te.unstable_IdlePriority=5;te.unstable_ImmediatePriority=1;te.unstable_LowPriority=4;te.unstable_NormalPriority=3;te.unstable_Profiling=null;te.unstable_UserBlockingPriority=2;te.unstable_cancelCallback=function(t){t.callback=null};te.unstable_continueExecution=function(){pn||Ys||(pn=!0,gc(mc))};te.unstable_forceFrameRate=function(t){0>t||125<t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Lh=0<t?Math.floor(1e3/t):5};te.unstable_getCurrentPriorityLevel=function(){return Pe};te.unstable_getFirstCallbackNode=function(){return Ot(Ht)};te.unstable_next=function(t){switch(Pe){case 1:case 2:case 3:var e=3;break;default:e=Pe}var r=Pe;Pe=e;try{return t()}finally{Pe=r}};te.unstable_pauseExecution=function(){};te.unstable_requestPaint=function(){};te.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var r=Pe;Pe=t;try{return e()}finally{Pe=r}};te.unstable_scheduleCallback=function(t,e,r){var n=te.unstable_now();switch(typeof r=="object"&&r!==null?(r=r.delay,r=typeof r=="number"&&0<r?n+r:n):r=n,t){case 1:var i=-1;break;case 2:i=250;break;case 5:i=1073741823;break;case 4:i=1e4;break;default:i=5e3}return i=r+i,t={id:sx++,callback:e,priorityLevel:t,startTime:r,expirationTime:i,sortIndex:-1},r>n?(t.sortIndex=r,pc($r,t),Ot(Ht)===null&&t===Ot($r)&&(mo?(Nh(go),go=-1):mo=!0,_c(hc,r-n))):(t.sortIndex=i,pc(Ht,t),pn||Ys||(pn=!0,gc(mc))),t};te.unstable_shouldYield=Dh;te.unstable_wrapCallback=function(t){var e=Pe;return function(){var r=Pe;Pe=e;try{return t.apply(this,arguments)}finally{Pe=r}}}});var Bh=I((BC,jh)=>{"use strict";jh.exports=zh()});var G_=I(dt=>{"use strict";var ax=fo(),ut=Bh();function M(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Km=new Set,Do={};function Mn(t,e){Ii(t,e),Ii(t+"Capture",e)}function Ii(t,e){for(Do[t]=e,t=0;t<e.length;t++)Km.add(e[t])}var fr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),jc=Object.prototype.hasOwnProperty,lx=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Uh={},Vh={};function ux(t){return jc.call(Vh,t)?!0:jc.call(Uh,t)?!1:lx.test(t)?Vh[t]=!0:(Uh[t]=!0,!1)}function cx(t,e,r,n){if(r!==null&&r.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function dx(t,e,r,n){if(e===null||typeof e>"u"||cx(t,e,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Be(t,e,r,n,i,o,s){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=o,this.removeEmptyString=s}var Me={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Me[t]=new Be(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Me[e]=new Be(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Me[t]=new Be(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Me[t]=new Be(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Me[t]=new Be(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Me[t]=new Be(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Me[t]=new Be(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Me[t]=new Be(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Me[t]=new Be(t,5,!1,t.toLowerCase(),null,!1,!1)});var $d=/[\-:]([a-z])/g;function Od(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace($d,Od);Me[e]=new Be(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace($d,Od);Me[e]=new Be(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace($d,Od);Me[e]=new Be(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Me[t]=new Be(t,1,!1,t.toLowerCase(),null,!1,!1)});Me.xlinkHref=new Be("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Me[t]=new Be(t,1,!1,t.toLowerCase(),null,!0,!0)});function Fd(t,e,r,n){var i=Me.hasOwnProperty(e)?Me[e]:null;(i!==null?i.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(dx(e,r,i,n)&&(r=null),n||i===null?ux(e)&&(r===null?t.removeAttribute(e):t.setAttribute(e,""+r)):i.mustUseProperty?t[i.propertyName]=r===null?i.type===3?!1:"":r:(e=i.attributeName,n=i.attributeNamespace,r===null?t.removeAttribute(e):(i=i.type,r=i===3||i===4&&r===!0?"":""+r,n?t.setAttributeNS(n,e,r):t.setAttribute(e,r))))}var _r=ax.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ta=Symbol.for("react.element"),pi=Symbol.for("react.portal"),fi=Symbol.for("react.fragment"),Nd=Symbol.for("react.strict_mode"),Bc=Symbol.for("react.profiler"),Qm=Symbol.for("react.provider"),Jm=Symbol.for("react.context"),Ld=Symbol.for("react.forward_ref"),Uc=Symbol.for("react.suspense"),Vc=Symbol.for("react.suspense_list"),Rd=Symbol.for("react.memo"),Fr=Symbol.for("react.lazy");Symbol.for("react.scope");Symbol.for("react.debug_trace_mode");var Xm=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden");Symbol.for("react.cache");Symbol.for("react.tracing_marker");var Wh=Symbol.iterator;function _o(t){return t===null||typeof t!="object"?null:(t=Wh&&t[Wh]||t["@@iterator"],typeof t=="function"?t:null)}var ue=Object.assign,yc;function Mo(t){if(yc===void 0)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);yc=e&&e[1]||""}return`
`+yc+t}var wc=!1;function vc(t,e){if(!t||wc)return"";wc=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var n=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){n=u}t.call(e.prototype)}else{try{throw Error()}catch(u){n=u}t()}}catch(u){if(u&&n&&typeof u.stack=="string"){for(var i=u.stack.split(`
`),o=n.stack.split(`
`),s=i.length-1,a=o.length-1;1<=s&&0<=a&&i[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(i[s]!==o[a]){if(s!==1||a!==1)do if(s--,a--,0>a||i[s]!==o[a]){var l=`
`+i[s].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=s&&0<=a);break}}}finally{wc=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?Mo(t):""}function px(t){switch(t.tag){case 5:return Mo(t.type);case 16:return Mo("Lazy");case 13:return Mo("Suspense");case 19:return Mo("SuspenseList");case 0:case 2:case 15:return t=vc(t.type,!1),t;case 11:return t=vc(t.type.render,!1),t;case 1:return t=vc(t.type,!0),t;default:return""}}function Wc(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case fi:return"Fragment";case pi:return"Portal";case Bc:return"Profiler";case Nd:return"StrictMode";case Uc:return"Suspense";case Vc:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Jm:return(t.displayName||"Context")+".Consumer";case Qm:return(t._context.displayName||"Context")+".Provider";case Ld:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Rd:return e=t.displayName||null,e!==null?e:Wc(t.type)||"Memo";case Fr:e=t._payload,t=t._init;try{return Wc(t(e))}catch{}}return null}function fx(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Wc(e);case 8:return e===Nd?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Kr(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Zm(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function hx(t){var e=Zm(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),n=""+t[e];if(!t.hasOwnProperty(e)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var i=r.get,o=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(s){n=""+s,o.call(this,s)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(s){n=""+s},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function ra(t){t._valueTracker||(t._valueTracker=hx(t))}function Ym(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),n="";return t&&(n=Zm(t)?t.checked?"true":"false":t.value),t=n,t!==r?(e.setValue(t),!0):!1}function Ia(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Gc(t,e){var r=e.checked;return ue({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function Gh(t,e){var r=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;r=Kr(e.value!=null?e.value:r),t._wrapperState={initialChecked:n,initialValue:r,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function eg(t,e){e=e.checked,e!=null&&Fd(t,"checked",e,!1)}function qc(t,e){eg(t,e);var r=Kr(e.value),n=e.type;if(r!=null)n==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(n==="submit"||n==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Hc(t,e.type,r):e.hasOwnProperty("defaultValue")&&Hc(t,e.type,Kr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function qh(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function Hc(t,e,r){(e!=="number"||Ia(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var ko=Array.isArray;function Ti(t,e,r,n){if(t=t.options,e){e={};for(var i=0;i<r.length;i++)e["$"+r[i]]=!0;for(r=0;r<t.length;r++)i=e.hasOwnProperty("$"+t[r].value),t[r].selected!==i&&(t[r].selected=i),i&&n&&(t[r].defaultSelected=!0)}else{for(r=""+Kr(r),e=null,i=0;i<t.length;i++){if(t[i].value===r){t[i].selected=!0,n&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function Kc(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(M(91));return ue({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Hh(t,e){var r=e.value;if(r==null){if(r=e.children,e=e.defaultValue,r!=null){if(e!=null)throw Error(M(92));if(ko(r)){if(1<r.length)throw Error(M(93));r=r[0]}e=r}e==null&&(e=""),r=e}t._wrapperState={initialValue:Kr(r)}}function tg(t,e){var r=Kr(e.value),n=Kr(e.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),e.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),n!=null&&(t.defaultValue=""+n)}function Kh(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function rg(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Qc(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?rg(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var na,ng=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,r,n,i){MSApp.execUnsafeLocalFunction(function(){return t(e,r,n,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(na=na||document.createElement("div"),na.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=na.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function zo(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=e;return}}t.textContent=e}var Co={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},mx=["Webkit","ms","Moz","O"];Object.keys(Co).forEach(function(t){mx.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Co[e]=Co[t]})});function ig(t,e,r){return e==null||typeof e=="boolean"||e===""?"":r||typeof e!="number"||e===0||Co.hasOwnProperty(t)&&Co[t]?(""+e).trim():e+"px"}function og(t,e){t=t.style;for(var r in e)if(e.hasOwnProperty(r)){var n=r.indexOf("--")===0,i=ig(r,e[r],n);r==="float"&&(r="cssFloat"),n?t.setProperty(r,i):t[r]=i}}var gx=ue({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Jc(t,e){if(e){if(gx[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(M(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(M(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(M(61))}if(e.style!=null&&typeof e.style!="object")throw Error(M(62))}}function Xc(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Zc=null;function Dd(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Yc=null,Mi=null,ki=null;function Qh(t){if(t=ns(t)){if(typeof Yc!="function")throw Error(M(280));var e=t.stateNode;e&&(e=il(e),Yc(t.stateNode,t.type,e))}}function sg(t){Mi?ki?ki.push(t):ki=[t]:Mi=t}function ag(){if(Mi){var t=Mi,e=ki;if(ki=Mi=null,Qh(t),e)for(t=0;t<e.length;t++)Qh(e[t])}}function lg(t,e){return t(e)}function ug(){}var bc=!1;function cg(t,e,r){if(bc)return t(e,r);bc=!0;try{return lg(t,e,r)}finally{bc=!1,(Mi!==null||ki!==null)&&(ug(),ag())}}function jo(t,e){var r=t.stateNode;if(r===null)return null;var n=il(r);if(n===null)return null;r=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(M(231,e,typeof r));return r}var ed=!1;if(fr)try{ci={},Object.defineProperty(ci,"passive",{get:function(){ed=!0}}),window.addEventListener("test",ci,ci),window.removeEventListener("test",ci,ci)}catch{ed=!1}var ci;function _x(t,e,r,n,i,o,s,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(r,u)}catch(c){this.onError(c)}}var Io=!1,Aa=null,$a=!1,td=null,yx={onError:function(t){Io=!0,Aa=t}};function wx(t,e,r,n,i,o,s,a,l){Io=!1,Aa=null,_x.apply(yx,arguments)}function vx(t,e,r,n,i,o,s,a,l){if(wx.apply(this,arguments),Io){if(Io){var u=Aa;Io=!1,Aa=null}else throw Error(M(198));$a||($a=!0,td=u)}}function kn(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,(e.flags&4098)!==0&&(r=e.return),t=e.return;while(t)}return e.tag===3?r:null}function dg(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Jh(t){if(kn(t)!==t)throw Error(M(188))}function bx(t){var e=t.alternate;if(!e){if(e=kn(t),e===null)throw Error(M(188));return e!==t?null:t}for(var r=t,n=e;;){var i=r.return;if(i===null)break;var o=i.alternate;if(o===null){if(n=i.return,n!==null){r=n;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===r)return Jh(i),t;if(o===n)return Jh(i),e;o=o.sibling}throw Error(M(188))}if(r.return!==n.return)r=i,n=o;else{for(var s=!1,a=i.child;a;){if(a===r){s=!0,r=i,n=o;break}if(a===n){s=!0,n=i,r=o;break}a=a.sibling}if(!s){for(a=o.child;a;){if(a===r){s=!0,r=o,n=i;break}if(a===n){s=!0,n=o,r=i;break}a=a.sibling}if(!s)throw Error(M(189))}}if(r.alternate!==n)throw Error(M(190))}if(r.tag!==3)throw Error(M(188));return r.stateNode.current===r?t:e}function pg(t){return t=bx(t),t!==null?fg(t):null}function fg(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=fg(t);if(e!==null)return e;t=t.sibling}return null}var hg=ut.unstable_scheduleCallback,Xh=ut.unstable_cancelCallback,xx=ut.unstable_shouldYield,Sx=ut.unstable_requestPaint,fe=ut.unstable_now,Tx=ut.unstable_getCurrentPriorityLevel,zd=ut.unstable_ImmediatePriority,mg=ut.unstable_UserBlockingPriority,Oa=ut.unstable_NormalPriority,Mx=ut.unstable_LowPriority,gg=ut.unstable_IdlePriority,el=null,Xt=null;function kx(t){if(Xt&&typeof Xt.onCommitFiberRoot=="function")try{Xt.onCommitFiberRoot(el,t,void 0,(t.current.flags&128)===128)}catch{}}var Dt=Math.clz32?Math.clz32:Cx,Ex=Math.log,Px=Math.LN2;function Cx(t){return t>>>=0,t===0?32:31-(Ex(t)/Px|0)|0}var ia=64,oa=4194304;function Eo(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Fa(t,e){var r=t.pendingLanes;if(r===0)return 0;var n=0,i=t.suspendedLanes,o=t.pingedLanes,s=r&268435455;if(s!==0){var a=s&~i;a!==0?n=Eo(a):(o&=s,o!==0&&(n=Eo(o)))}else s=r&~i,s!==0?n=Eo(s):o!==0&&(n=Eo(o));if(n===0)return 0;if(e!==0&&e!==n&&(e&i)===0&&(i=n&-n,o=e&-e,i>=o||i===16&&(o&4194240)!==0))return e;if((n&4)!==0&&(n|=r&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=n;0<e;)r=31-Dt(e),i=1<<r,n|=t[r],e&=~i;return n}function Ix(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ax(t,e){for(var r=t.suspendedLanes,n=t.pingedLanes,i=t.expirationTimes,o=t.pendingLanes;0<o;){var s=31-Dt(o),a=1<<s,l=i[s];l===-1?((a&r)===0||(a&n)!==0)&&(i[s]=Ix(a,e)):l<=e&&(t.expiredLanes|=a),o&=~a}}function rd(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function _g(){var t=ia;return ia<<=1,(ia&4194240)===0&&(ia=64),t}function xc(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function ts(t,e,r){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Dt(e),t[e]=r}function $x(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var n=t.eventTimes;for(t=t.expirationTimes;0<r;){var i=31-Dt(r),o=1<<i;e[i]=0,n[i]=-1,t[i]=-1,r&=~o}}function jd(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var n=31-Dt(r),i=1<<n;i&e|t[n]&e&&(t[n]|=e),r&=~i}}var Y=0;function yg(t){return t&=-t,1<t?4<t?(t&268435455)!==0?16:536870912:4:1}var wg,Bd,vg,bg,xg,nd=!1,sa=[],jr=null,Br=null,Ur=null,Bo=new Map,Uo=new Map,Lr=[],Ox="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Zh(t,e){switch(t){case"focusin":case"focusout":jr=null;break;case"dragenter":case"dragleave":Br=null;break;case"mouseover":case"mouseout":Ur=null;break;case"pointerover":case"pointerout":Bo.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Uo.delete(e.pointerId)}}function yo(t,e,r,n,i,o){return t===null||t.nativeEvent!==o?(t={blockedOn:e,domEventName:r,eventSystemFlags:n,nativeEvent:o,targetContainers:[i]},e!==null&&(e=ns(e),e!==null&&Bd(e)),t):(t.eventSystemFlags|=n,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function Fx(t,e,r,n,i){switch(e){case"focusin":return jr=yo(jr,t,e,r,n,i),!0;case"dragenter":return Br=yo(Br,t,e,r,n,i),!0;case"mouseover":return Ur=yo(Ur,t,e,r,n,i),!0;case"pointerover":var o=i.pointerId;return Bo.set(o,yo(Bo.get(o)||null,t,e,r,n,i)),!0;case"gotpointercapture":return o=i.pointerId,Uo.set(o,yo(Uo.get(o)||null,t,e,r,n,i)),!0}return!1}function Sg(t){var e=mn(t.target);if(e!==null){var r=kn(e);if(r!==null){if(e=r.tag,e===13){if(e=dg(r),e!==null){t.blockedOn=e,xg(t.priority,function(){vg(r)});return}}else if(e===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function va(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var r=id(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var n=new r.constructor(r.type,r);Zc=n,r.target.dispatchEvent(n),Zc=null}else return e=ns(r),e!==null&&Bd(e),t.blockedOn=r,!1;e.shift()}return!0}function Yh(t,e,r){va(t)&&r.delete(e)}function Nx(){nd=!1,jr!==null&&va(jr)&&(jr=null),Br!==null&&va(Br)&&(Br=null),Ur!==null&&va(Ur)&&(Ur=null),Bo.forEach(Yh),Uo.forEach(Yh)}function wo(t,e){t.blockedOn===e&&(t.blockedOn=null,nd||(nd=!0,ut.unstable_scheduleCallback(ut.unstable_NormalPriority,Nx)))}function Vo(t){function e(i){return wo(i,t)}if(0<sa.length){wo(sa[0],t);for(var r=1;r<sa.length;r++){var n=sa[r];n.blockedOn===t&&(n.blockedOn=null)}}for(jr!==null&&wo(jr,t),Br!==null&&wo(Br,t),Ur!==null&&wo(Ur,t),Bo.forEach(e),Uo.forEach(e),r=0;r<Lr.length;r++)n=Lr[r],n.blockedOn===t&&(n.blockedOn=null);for(;0<Lr.length&&(r=Lr[0],r.blockedOn===null);)Sg(r),r.blockedOn===null&&Lr.shift()}var Ei=_r.ReactCurrentBatchConfig,Na=!0;function Lx(t,e,r,n){var i=Y,o=Ei.transition;Ei.transition=null;try{Y=1,Ud(t,e,r,n)}finally{Y=i,Ei.transition=o}}function Rx(t,e,r,n){var i=Y,o=Ei.transition;Ei.transition=null;try{Y=4,Ud(t,e,r,n)}finally{Y=i,Ei.transition=o}}function Ud(t,e,r,n){if(Na){var i=id(t,e,r,n);if(i===null)Cc(t,e,n,La,r),Zh(t,n);else if(Fx(i,t,e,r,n))n.stopPropagation();else if(Zh(t,n),e&4&&-1<Ox.indexOf(t)){for(;i!==null;){var o=ns(i);if(o!==null&&wg(o),o=id(t,e,r,n),o===null&&Cc(t,e,n,La,r),o===i)break;i=o}i!==null&&n.stopPropagation()}else Cc(t,e,n,null,r)}}var La=null;function id(t,e,r,n){if(La=null,t=Dd(n),t=mn(t),t!==null)if(e=kn(t),e===null)t=null;else if(r=e.tag,r===13){if(t=dg(e),t!==null)return t;t=null}else if(r===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return La=t,null}function Tg(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Tx()){case zd:return 1;case mg:return 4;case Oa:case Mx:return 16;case gg:return 536870912;default:return 16}default:return 16}}var Dr=null,Vd=null,ba=null;function Mg(){if(ba)return ba;var t,e=Vd,r=e.length,n,i="value"in Dr?Dr.value:Dr.textContent,o=i.length;for(t=0;t<r&&e[t]===i[t];t++);var s=r-t;for(n=1;n<=s&&e[r-n]===i[o-n];n++);return ba=i.slice(t,1<n?1-n:void 0)}function xa(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function aa(){return!0}function em(){return!1}function ct(t){function e(r,n,i,o,s){this._reactName=r,this._targetInst=i,this.type=n,this.nativeEvent=o,this.target=s,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(r=t[a],this[a]=r?r(o):o[a]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?aa:em,this.isPropagationStopped=em,this}return ue(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=aa)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=aa)},persist:function(){},isPersistent:aa}),e}var Ri={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Wd=ct(Ri),rs=ue({},Ri,{view:0,detail:0}),Dx=ct(rs),Sc,Tc,vo,tl=ue({},rs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Gd,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==vo&&(vo&&t.type==="mousemove"?(Sc=t.screenX-vo.screenX,Tc=t.screenY-vo.screenY):Tc=Sc=0,vo=t),Sc)},movementY:function(t){return"movementY"in t?t.movementY:Tc}}),tm=ct(tl),zx=ue({},tl,{dataTransfer:0}),jx=ct(zx),Bx=ue({},rs,{relatedTarget:0}),Mc=ct(Bx),Ux=ue({},Ri,{animationName:0,elapsedTime:0,pseudoElement:0}),Vx=ct(Ux),Wx=ue({},Ri,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Gx=ct(Wx),qx=ue({},Ri,{data:0}),rm=ct(qx),Hx={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Kx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Qx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Jx(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Qx[t])?!!e[t]:!1}function Gd(){return Jx}var Xx=ue({},rs,{key:function(t){if(t.key){var e=Hx[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=xa(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Kx[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Gd,charCode:function(t){return t.type==="keypress"?xa(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?xa(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Zx=ct(Xx),Yx=ue({},tl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),nm=ct(Yx),e1=ue({},rs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Gd}),t1=ct(e1),r1=ue({},Ri,{propertyName:0,elapsedTime:0,pseudoElement:0}),n1=ct(r1),i1=ue({},tl,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),o1=ct(i1),s1=[9,13,27,32],qd=fr&&"CompositionEvent"in window,Ao=null;fr&&"documentMode"in document&&(Ao=document.documentMode);var a1=fr&&"TextEvent"in window&&!Ao,kg=fr&&(!qd||Ao&&8<Ao&&11>=Ao),im=" ",om=!1;function Eg(t,e){switch(t){case"keyup":return s1.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Pg(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var hi=!1;function l1(t,e){switch(t){case"compositionend":return Pg(e);case"keypress":return e.which!==32?null:(om=!0,im);case"textInput":return t=e.data,t===im&&om?null:t;default:return null}}function u1(t,e){if(hi)return t==="compositionend"||!qd&&Eg(t,e)?(t=Mg(),ba=Vd=Dr=null,hi=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return kg&&e.locale!=="ko"?null:e.data;default:return null}}var c1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function sm(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!c1[t.type]:e==="textarea"}function Cg(t,e,r,n){sg(n),e=Ra(e,"onChange"),0<e.length&&(r=new Wd("onChange","change",null,r,n),t.push({event:r,listeners:e}))}var $o=null,Wo=null;function d1(t){jg(t,0)}function rl(t){var e=_i(t);if(Ym(e))return t}function p1(t,e){if(t==="change")return e}var Ig=!1;fr&&(fr?(ua="oninput"in document,ua||(kc=document.createElement("div"),kc.setAttribute("oninput","return;"),ua=typeof kc.oninput=="function"),la=ua):la=!1,Ig=la&&(!document.documentMode||9<document.documentMode));var la,ua,kc;function am(){$o&&($o.detachEvent("onpropertychange",Ag),Wo=$o=null)}function Ag(t){if(t.propertyName==="value"&&rl(Wo)){var e=[];Cg(e,Wo,t,Dd(t)),cg(d1,e)}}function f1(t,e,r){t==="focusin"?(am(),$o=e,Wo=r,$o.attachEvent("onpropertychange",Ag)):t==="focusout"&&am()}function h1(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return rl(Wo)}function m1(t,e){if(t==="click")return rl(e)}function g1(t,e){if(t==="input"||t==="change")return rl(e)}function _1(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var jt=typeof Object.is=="function"?Object.is:_1;function Go(t,e){if(jt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var i=r[n];if(!jc.call(e,i)||!jt(t[i],e[i]))return!1}return!0}function lm(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function um(t,e){var r=lm(t);t=0;for(var n;r;){if(r.nodeType===3){if(n=t+r.textContent.length,t<=e&&n>=e)return{node:r,offset:e-t};t=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=lm(r)}}function $g(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?$g(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Og(){for(var t=window,e=Ia();e instanceof t.HTMLIFrameElement;){try{var r=typeof e.contentWindow.location.href=="string"}catch{r=!1}if(r)t=e.contentWindow;else break;e=Ia(t.document)}return e}function Hd(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function y1(t){var e=Og(),r=t.focusedElem,n=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&$g(r.ownerDocument.documentElement,r)){if(n!==null&&Hd(r)){if(e=n.start,t=n.end,t===void 0&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if(t=(e=r.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=r.textContent.length,o=Math.min(n.start,i);n=n.end===void 0?o:Math.min(n.end,i),!t.extend&&o>n&&(i=n,n=o,o=i),i=um(r,o);var s=um(r,n);i&&s&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==s.node||t.focusOffset!==s.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),o>n?(t.addRange(e),t.extend(s.node,s.offset)):(e.setEnd(s.node,s.offset),t.addRange(e)))}}for(e=[],t=r;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)t=e[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var w1=fr&&"documentMode"in document&&11>=document.documentMode,mi=null,od=null,Oo=null,sd=!1;function cm(t,e,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;sd||mi==null||mi!==Ia(n)||(n=mi,"selectionStart"in n&&Hd(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Oo&&Go(Oo,n)||(Oo=n,n=Ra(od,"onSelect"),0<n.length&&(e=new Wd("onSelect","select",null,e,r),t.push({event:e,listeners:n}),e.target=mi)))}function ca(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var gi={animationend:ca("Animation","AnimationEnd"),animationiteration:ca("Animation","AnimationIteration"),animationstart:ca("Animation","AnimationStart"),transitionend:ca("Transition","TransitionEnd")},Ec={},Fg={};fr&&(Fg=document.createElement("div").style,"AnimationEvent"in window||(delete gi.animationend.animation,delete gi.animationiteration.animation,delete gi.animationstart.animation),"TransitionEvent"in window||delete gi.transitionend.transition);function nl(t){if(Ec[t])return Ec[t];if(!gi[t])return t;var e=gi[t],r;for(r in e)if(e.hasOwnProperty(r)&&r in Fg)return Ec[t]=e[r];return t}var Ng=nl("animationend"),Lg=nl("animationiteration"),Rg=nl("animationstart"),Dg=nl("transitionend"),zg=new Map,dm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Jr(t,e){zg.set(t,e),Mn(e,[t])}for(da=0;da<dm.length;da++)pa=dm[da],pm=pa.toLowerCase(),fm=pa[0].toUpperCase()+pa.slice(1),Jr(pm,"on"+fm);var pa,pm,fm,da;Jr(Ng,"onAnimationEnd");Jr(Lg,"onAnimationIteration");Jr(Rg,"onAnimationStart");Jr("dblclick","onDoubleClick");Jr("focusin","onFocus");Jr("focusout","onBlur");Jr(Dg,"onTransitionEnd");Ii("onMouseEnter",["mouseout","mouseover"]);Ii("onMouseLeave",["mouseout","mouseover"]);Ii("onPointerEnter",["pointerout","pointerover"]);Ii("onPointerLeave",["pointerout","pointerover"]);Mn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Mn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Mn("onBeforeInput",["compositionend","keypress","textInput","paste"]);Mn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Mn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Mn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Po="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),v1=new Set("cancel close invalid load scroll toggle".split(" ").concat(Po));function hm(t,e,r){var n=t.type||"unknown-event";t.currentTarget=r,vx(n,e,void 0,t),t.currentTarget=null}function jg(t,e){e=(e&4)!==0;for(var r=0;r<t.length;r++){var n=t[r],i=n.event;n=n.listeners;e:{var o=void 0;if(e)for(var s=n.length-1;0<=s;s--){var a=n[s],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==o&&i.isPropagationStopped())break e;hm(i,a,u),o=l}else for(s=0;s<n.length;s++){if(a=n[s],l=a.instance,u=a.currentTarget,a=a.listener,l!==o&&i.isPropagationStopped())break e;hm(i,a,u),o=l}}}if($a)throw t=td,$a=!1,td=null,t}function ne(t,e){var r=e[dd];r===void 0&&(r=e[dd]=new Set);var n=t+"__bubble";r.has(n)||(Bg(e,t,2,!1),r.add(n))}function Pc(t,e,r){var n=0;e&&(n|=4),Bg(r,t,n,e)}var fa="_reactListening"+Math.random().toString(36).slice(2);function qo(t){if(!t[fa]){t[fa]=!0,Km.forEach(function(r){r!=="selectionchange"&&(v1.has(r)||Pc(r,!1,t),Pc(r,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[fa]||(e[fa]=!0,Pc("selectionchange",!1,e))}}function Bg(t,e,r,n){switch(Tg(e)){case 1:var i=Lx;break;case 4:i=Rx;break;default:i=Ud}r=i.bind(null,e,r,t),i=void 0,!ed||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),n?i!==void 0?t.addEventListener(e,r,{capture:!0,passive:i}):t.addEventListener(e,r,!0):i!==void 0?t.addEventListener(e,r,{passive:i}):t.addEventListener(e,r,!1)}function Cc(t,e,r,n,i){var o=n;if((e&1)===0&&(e&2)===0&&n!==null)e:for(;;){if(n===null)return;var s=n.tag;if(s===3||s===4){var a=n.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(s===4)for(s=n.return;s!==null;){var l=s.tag;if((l===3||l===4)&&(l=s.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;s=s.return}for(;a!==null;){if(s=mn(a),s===null)return;if(l=s.tag,l===5||l===6){n=o=s;continue e}a=a.parentNode}}n=n.return}cg(function(){var u=o,c=Dd(r),d=[];e:{var p=zg.get(t);if(p!==void 0){var f=Wd,_=t;switch(t){case"keypress":if(xa(r)===0)break e;case"keydown":case"keyup":f=Zx;break;case"focusin":_="focus",f=Mc;break;case"focusout":_="blur",f=Mc;break;case"beforeblur":case"afterblur":f=Mc;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=tm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=jx;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=t1;break;case Ng:case Lg:case Rg:f=Vx;break;case Dg:f=n1;break;case"scroll":f=Dx;break;case"wheel":f=o1;break;case"copy":case"cut":case"paste":f=Gx;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=nm}var w=(e&4)!==0,b=!w&&t==="scroll",m=w?p!==null?p+"Capture":null:p;w=[];for(var h=u,g;h!==null;){g=h;var y=g.stateNode;if(g.tag===5&&y!==null&&(g=y,m!==null&&(y=jo(h,m),y!=null&&w.push(Ho(h,y,g)))),b)break;h=h.return}0<w.length&&(p=new f(p,_,null,r,c),d.push({event:p,listeners:w}))}}if((e&7)===0){e:{if(p=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",p&&r!==Zc&&(_=r.relatedTarget||r.fromElement)&&(mn(_)||_[hr]))break e;if((f||p)&&(p=c.window===c?c:(p=c.ownerDocument)?p.defaultView||p.parentWindow:window,f?(_=r.relatedTarget||r.toElement,f=u,_=_?mn(_):null,_!==null&&(b=kn(_),_!==b||_.tag!==5&&_.tag!==6)&&(_=null)):(f=null,_=u),f!==_)){if(w=tm,y="onMouseLeave",m="onMouseEnter",h="mouse",(t==="pointerout"||t==="pointerover")&&(w=nm,y="onPointerLeave",m="onPointerEnter",h="pointer"),b=f==null?p:_i(f),g=_==null?p:_i(_),p=new w(y,h+"leave",f,r,c),p.target=b,p.relatedTarget=g,y=null,mn(c)===u&&(w=new w(m,h+"enter",_,r,c),w.target=g,w.relatedTarget=b,y=w),b=y,f&&_)t:{for(w=f,m=_,h=0,g=w;g;g=di(g))h++;for(g=0,y=m;y;y=di(y))g++;for(;0<h-g;)w=di(w),h--;for(;0<g-h;)m=di(m),g--;for(;h--;){if(w===m||m!==null&&w===m.alternate)break t;w=di(w),m=di(m)}w=null}else w=null;f!==null&&mm(d,p,f,w,!1),_!==null&&b!==null&&mm(d,b,_,w,!0)}}e:{if(p=u?_i(u):window,f=p.nodeName&&p.nodeName.toLowerCase(),f==="select"||f==="input"&&p.type==="file")var v=p1;else if(sm(p))if(Ig)v=g1;else{v=h1;var x=f1}else(f=p.nodeName)&&f.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(v=m1);if(v&&(v=v(t,u))){Cg(d,v,r,c);break e}x&&x(t,p,u),t==="focusout"&&(x=p._wrapperState)&&x.controlled&&p.type==="number"&&Hc(p,"number",p.value)}switch(x=u?_i(u):window,t){case"focusin":(sm(x)||x.contentEditable==="true")&&(mi=x,od=u,Oo=null);break;case"focusout":Oo=od=mi=null;break;case"mousedown":sd=!0;break;case"contextmenu":case"mouseup":case"dragend":sd=!1,cm(d,r,c);break;case"selectionchange":if(w1)break;case"keydown":case"keyup":cm(d,r,c)}var k;if(qd)e:{switch(t){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else hi?Eg(t,r)&&(E="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(E="onCompositionStart");E&&(kg&&r.locale!=="ko"&&(hi||E!=="onCompositionStart"?E==="onCompositionEnd"&&hi&&(k=Mg()):(Dr=c,Vd="value"in Dr?Dr.value:Dr.textContent,hi=!0)),x=Ra(u,E),0<x.length&&(E=new rm(E,t,null,r,c),d.push({event:E,listeners:x}),k?E.data=k:(k=Pg(r),k!==null&&(E.data=k)))),(k=a1?l1(t,r):u1(t,r))&&(u=Ra(u,"onBeforeInput"),0<u.length&&(c=new rm("onBeforeInput","beforeinput",null,r,c),d.push({event:c,listeners:u}),c.data=k))}jg(d,e)})}function Ho(t,e,r){return{instance:t,listener:e,currentTarget:r}}function Ra(t,e){for(var r=e+"Capture",n=[];t!==null;){var i=t,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=jo(t,r),o!=null&&n.unshift(Ho(t,o,i)),o=jo(t,e),o!=null&&n.push(Ho(t,o,i))),t=t.return}return n}function di(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function mm(t,e,r,n,i){for(var o=e._reactName,s=[];r!==null&&r!==n;){var a=r,l=a.alternate,u=a.stateNode;if(l!==null&&l===n)break;a.tag===5&&u!==null&&(a=u,i?(l=jo(r,o),l!=null&&s.unshift(Ho(r,l,a))):i||(l=jo(r,o),l!=null&&s.push(Ho(r,l,a)))),r=r.return}s.length!==0&&t.push({event:e,listeners:s})}var b1=/\r\n?/g,x1=/\u0000|\uFFFD/g;function gm(t){return(typeof t=="string"?t:""+t).replace(b1,`
`).replace(x1,"")}function ha(t,e,r){if(e=gm(e),gm(t)!==e&&r)throw Error(M(425))}function Da(){}var ad=null,ld=null;function ud(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var cd=typeof setTimeout=="function"?setTimeout:void 0,S1=typeof clearTimeout=="function"?clearTimeout:void 0,_m=typeof Promise=="function"?Promise:void 0,T1=typeof queueMicrotask=="function"?queueMicrotask:typeof _m<"u"?function(t){return _m.resolve(null).then(t).catch(M1)}:cd;function M1(t){setTimeout(function(){throw t})}function Ic(t,e){var r=e,n=0;do{var i=r.nextSibling;if(t.removeChild(r),i&&i.nodeType===8)if(r=i.data,r==="/$"){if(n===0){t.removeChild(i),Vo(e);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=i}while(r);Vo(e)}function Vr(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function ym(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(e===0)return t;e--}else r==="/$"&&e++}t=t.previousSibling}return null}var Di=Math.random().toString(36).slice(2),Jt="__reactFiber$"+Di,Ko="__reactProps$"+Di,hr="__reactContainer$"+Di,dd="__reactEvents$"+Di,k1="__reactListeners$"+Di,E1="__reactHandles$"+Di;function mn(t){var e=t[Jt];if(e)return e;for(var r=t.parentNode;r;){if(e=r[hr]||r[Jt]){if(r=e.alternate,e.child!==null||r!==null&&r.child!==null)for(t=ym(t);t!==null;){if(r=t[Jt])return r;t=ym(t)}return e}t=r,r=t.parentNode}return null}function ns(t){return t=t[Jt]||t[hr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function _i(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(M(33))}function il(t){return t[Ko]||null}var pd=[],yi=-1;function Xr(t){return{current:t}}function ie(t){0>yi||(t.current=pd[yi],pd[yi]=null,yi--)}function re(t,e){yi++,pd[yi]=t.current,t.current=e}var Qr={},$e=Xr(Qr),Ze=Xr(!1),vn=Qr;function Ai(t,e){var r=t.type.contextTypes;if(!r)return Qr;var n=t.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in r)i[o]=e[o];return n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function Ye(t){return t=t.childContextTypes,t!=null}function za(){ie(Ze),ie($e)}function wm(t,e,r){if($e.current!==Qr)throw Error(M(168));re($e,e),re(Ze,r)}function Ug(t,e,r){var n=t.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var i in n)if(!(i in e))throw Error(M(108,fx(t)||"Unknown",i));return ue({},r,n)}function ja(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Qr,vn=$e.current,re($e,t),re(Ze,Ze.current),!0}function vm(t,e,r){var n=t.stateNode;if(!n)throw Error(M(169));r?(t=Ug(t,e,vn),n.__reactInternalMemoizedMergedChildContext=t,ie(Ze),ie($e),re($e,t)):ie(Ze),re(Ze,r)}var ur=null,ol=!1,Ac=!1;function Vg(t){ur===null?ur=[t]:ur.push(t)}function P1(t){ol=!0,Vg(t)}function Zr(){if(!Ac&&ur!==null){Ac=!0;var t=0,e=Y;try{var r=ur;for(Y=1;t<r.length;t++){var n=r[t];do n=n(!0);while(n!==null)}ur=null,ol=!1}catch(i){throw ur!==null&&(ur=ur.slice(t+1)),hg(zd,Zr),i}finally{Y=e,Ac=!1}}return null}var wi=[],vi=0,Ba=null,Ua=0,_t=[],yt=0,bn=null,cr=1,dr="";function fn(t,e){wi[vi++]=Ua,wi[vi++]=Ba,Ba=t,Ua=e}function Wg(t,e,r){_t[yt++]=cr,_t[yt++]=dr,_t[yt++]=bn,bn=t;var n=cr;t=dr;var i=32-Dt(n)-1;n&=~(1<<i),r+=1;var o=32-Dt(e)+i;if(30<o){var s=i-i%5;o=(n&(1<<s)-1).toString(32),n>>=s,i-=s,cr=1<<32-Dt(e)+i|r<<i|n,dr=o+t}else cr=1<<o|r<<i|n,dr=t}function Kd(t){t.return!==null&&(fn(t,1),Wg(t,1,0))}function Qd(t){for(;t===Ba;)Ba=wi[--vi],wi[vi]=null,Ua=wi[--vi],wi[vi]=null;for(;t===bn;)bn=_t[--yt],_t[yt]=null,dr=_t[--yt],_t[yt]=null,cr=_t[--yt],_t[yt]=null}var lt=null,at=null,se=!1,Rt=null;function Gg(t,e){var r=wt(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)}function bm(t,e){switch(t.tag){case 5:var r=t.type;return e=e.nodeType!==1||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,lt=t,at=Vr(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,lt=t,at=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(r=bn!==null?{id:cr,overflow:dr}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},r=wt(18,null,null,0),r.stateNode=e,r.return=t,t.child=r,lt=t,at=null,!0):!1;default:return!1}}function fd(t){return(t.mode&1)!==0&&(t.flags&128)===0}function hd(t){if(se){var e=at;if(e){var r=e;if(!bm(t,e)){if(fd(t))throw Error(M(418));e=Vr(r.nextSibling);var n=lt;e&&bm(t,e)?Gg(n,r):(t.flags=t.flags&-4097|2,se=!1,lt=t)}}else{if(fd(t))throw Error(M(418));t.flags=t.flags&-4097|2,se=!1,lt=t}}}function xm(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;lt=t}function ma(t){if(t!==lt)return!1;if(!se)return xm(t),se=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!ud(t.type,t.memoizedProps)),e&&(e=at)){if(fd(t))throw qg(),Error(M(418));for(;e;)Gg(t,e),e=Vr(e.nextSibling)}if(xm(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(M(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(e===0){at=Vr(t.nextSibling);break e}e--}else r!=="$"&&r!=="$!"&&r!=="$?"||e++}t=t.nextSibling}at=null}}else at=lt?Vr(t.stateNode.nextSibling):null;return!0}function qg(){for(var t=at;t;)t=Vr(t.nextSibling)}function $i(){at=lt=null,se=!1}function Jd(t){Rt===null?Rt=[t]:Rt.push(t)}var C1=_r.ReactCurrentBatchConfig;function bo(t,e,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(M(309));var n=r.stateNode}if(!n)throw Error(M(147,t));var i=n,o=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(s){var a=i.refs;s===null?delete a[o]:a[o]=s},e._stringRef=o,e)}if(typeof t!="string")throw Error(M(284));if(!r._owner)throw Error(M(290,t))}return t}function ga(t,e){throw t=Object.prototype.toString.call(e),Error(M(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Sm(t){var e=t._init;return e(t._payload)}function Hg(t){function e(m,h){if(t){var g=m.deletions;g===null?(m.deletions=[h],m.flags|=16):g.push(h)}}function r(m,h){if(!t)return null;for(;h!==null;)e(m,h),h=h.sibling;return null}function n(m,h){for(m=new Map;h!==null;)h.key!==null?m.set(h.key,h):m.set(h.index,h),h=h.sibling;return m}function i(m,h){return m=Hr(m,h),m.index=0,m.sibling=null,m}function o(m,h,g){return m.index=g,t?(g=m.alternate,g!==null?(g=g.index,g<h?(m.flags|=2,h):g):(m.flags|=2,h)):(m.flags|=1048576,h)}function s(m){return t&&m.alternate===null&&(m.flags|=2),m}function a(m,h,g,y){return h===null||h.tag!==6?(h=Dc(g,m.mode,y),h.return=m,h):(h=i(h,g),h.return=m,h)}function l(m,h,g,y){var v=g.type;return v===fi?c(m,h,g.props.children,y,g.key):h!==null&&(h.elementType===v||typeof v=="object"&&v!==null&&v.$$typeof===Fr&&Sm(v)===h.type)?(y=i(h,g.props),y.ref=bo(m,h,g),y.return=m,y):(y=Ca(g.type,g.key,g.props,null,m.mode,y),y.ref=bo(m,h,g),y.return=m,y)}function u(m,h,g,y){return h===null||h.tag!==4||h.stateNode.containerInfo!==g.containerInfo||h.stateNode.implementation!==g.implementation?(h=zc(g,m.mode,y),h.return=m,h):(h=i(h,g.children||[]),h.return=m,h)}function c(m,h,g,y,v){return h===null||h.tag!==7?(h=wn(g,m.mode,y,v),h.return=m,h):(h=i(h,g),h.return=m,h)}function d(m,h,g){if(typeof h=="string"&&h!==""||typeof h=="number")return h=Dc(""+h,m.mode,g),h.return=m,h;if(typeof h=="object"&&h!==null){switch(h.$$typeof){case ta:return g=Ca(h.type,h.key,h.props,null,m.mode,g),g.ref=bo(m,null,h),g.return=m,g;case pi:return h=zc(h,m.mode,g),h.return=m,h;case Fr:var y=h._init;return d(m,y(h._payload),g)}if(ko(h)||_o(h))return h=wn(h,m.mode,g,null),h.return=m,h;ga(m,h)}return null}function p(m,h,g,y){var v=h!==null?h.key:null;if(typeof g=="string"&&g!==""||typeof g=="number")return v!==null?null:a(m,h,""+g,y);if(typeof g=="object"&&g!==null){switch(g.$$typeof){case ta:return g.key===v?l(m,h,g,y):null;case pi:return g.key===v?u(m,h,g,y):null;case Fr:return v=g._init,p(m,h,v(g._payload),y)}if(ko(g)||_o(g))return v!==null?null:c(m,h,g,y,null);ga(m,g)}return null}function f(m,h,g,y,v){if(typeof y=="string"&&y!==""||typeof y=="number")return m=m.get(g)||null,a(h,m,""+y,v);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case ta:return m=m.get(y.key===null?g:y.key)||null,l(h,m,y,v);case pi:return m=m.get(y.key===null?g:y.key)||null,u(h,m,y,v);case Fr:var x=y._init;return f(m,h,g,x(y._payload),v)}if(ko(y)||_o(y))return m=m.get(g)||null,c(h,m,y,v,null);ga(h,y)}return null}function _(m,h,g,y){for(var v=null,x=null,k=h,E=h=0,H=null;k!==null&&E<g.length;E++){k.index>E?(H=k,k=null):H=k.sibling;var C=p(m,k,g[E],y);if(C===null){k===null&&(k=H);break}t&&k&&C.alternate===null&&e(m,k),h=o(C,h,E),x===null?v=C:x.sibling=C,x=C,k=H}if(E===g.length)return r(m,k),se&&fn(m,E),v;if(k===null){for(;E<g.length;E++)k=d(m,g[E],y),k!==null&&(h=o(k,h,E),x===null?v=k:x.sibling=k,x=k);return se&&fn(m,E),v}for(k=n(m,k);E<g.length;E++)H=f(k,m,E,g[E],y),H!==null&&(t&&H.alternate!==null&&k.delete(H.key===null?E:H.key),h=o(H,h,E),x===null?v=H:x.sibling=H,x=H);return t&&k.forEach(function(D){return e(m,D)}),se&&fn(m,E),v}function w(m,h,g,y){var v=_o(g);if(typeof v!="function")throw Error(M(150));if(g=v.call(g),g==null)throw Error(M(151));for(var x=v=null,k=h,E=h=0,H=null,C=g.next();k!==null&&!C.done;E++,C=g.next()){k.index>E?(H=k,k=null):H=k.sibling;var D=p(m,k,C.value,y);if(D===null){k===null&&(k=H);break}t&&k&&D.alternate===null&&e(m,k),h=o(D,h,E),x===null?v=D:x.sibling=D,x=D,k=H}if(C.done)return r(m,k),se&&fn(m,E),v;if(k===null){for(;!C.done;E++,C=g.next())C=d(m,C.value,y),C!==null&&(h=o(C,h,E),x===null?v=C:x.sibling=C,x=C);return se&&fn(m,E),v}for(k=n(m,k);!C.done;E++,C=g.next())C=f(k,m,E,C.value,y),C!==null&&(t&&C.alternate!==null&&k.delete(C.key===null?E:C.key),h=o(C,h,E),x===null?v=C:x.sibling=C,x=C);return t&&k.forEach(function(ge){return e(m,ge)}),se&&fn(m,E),v}function b(m,h,g,y){if(typeof g=="object"&&g!==null&&g.type===fi&&g.key===null&&(g=g.props.children),typeof g=="object"&&g!==null){switch(g.$$typeof){case ta:e:{for(var v=g.key,x=h;x!==null;){if(x.key===v){if(v=g.type,v===fi){if(x.tag===7){r(m,x.sibling),h=i(x,g.props.children),h.return=m,m=h;break e}}else if(x.elementType===v||typeof v=="object"&&v!==null&&v.$$typeof===Fr&&Sm(v)===x.type){r(m,x.sibling),h=i(x,g.props),h.ref=bo(m,x,g),h.return=m,m=h;break e}r(m,x);break}else e(m,x);x=x.sibling}g.type===fi?(h=wn(g.props.children,m.mode,y,g.key),h.return=m,m=h):(y=Ca(g.type,g.key,g.props,null,m.mode,y),y.ref=bo(m,h,g),y.return=m,m=y)}return s(m);case pi:e:{for(x=g.key;h!==null;){if(h.key===x)if(h.tag===4&&h.stateNode.containerInfo===g.containerInfo&&h.stateNode.implementation===g.implementation){r(m,h.sibling),h=i(h,g.children||[]),h.return=m,m=h;break e}else{r(m,h);break}else e(m,h);h=h.sibling}h=zc(g,m.mode,y),h.return=m,m=h}return s(m);case Fr:return x=g._init,b(m,h,x(g._payload),y)}if(ko(g))return _(m,h,g,y);if(_o(g))return w(m,h,g,y);ga(m,g)}return typeof g=="string"&&g!==""||typeof g=="number"?(g=""+g,h!==null&&h.tag===6?(r(m,h.sibling),h=i(h,g),h.return=m,m=h):(r(m,h),h=Dc(g,m.mode,y),h.return=m,m=h),s(m)):r(m,h)}return b}var Oi=Hg(!0),Kg=Hg(!1),Va=Xr(null),Wa=null,bi=null,Xd=null;function Zd(){Xd=bi=Wa=null}function Yd(t){var e=Va.current;ie(Va),t._currentValue=e}function md(t,e,r){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),t===r)break;t=t.return}}function Pi(t,e){Wa=t,Xd=bi=null,t=t.dependencies,t!==null&&t.firstContext!==null&&((t.lanes&e)!==0&&(Xe=!0),t.firstContext=null)}function bt(t){var e=t._currentValue;if(Xd!==t)if(t={context:t,memoizedValue:e,next:null},bi===null){if(Wa===null)throw Error(M(308));bi=t,Wa.dependencies={lanes:0,firstContext:t}}else bi=bi.next=t;return e}var gn=null;function ep(t){gn===null?gn=[t]:gn.push(t)}function Qg(t,e,r,n){var i=e.interleaved;return i===null?(r.next=r,ep(e)):(r.next=i.next,i.next=r),e.interleaved=r,mr(t,n)}function mr(t,e){t.lanes|=e;var r=t.alternate;for(r!==null&&(r.lanes|=e),r=t,t=t.return;t!==null;)t.childLanes|=e,r=t.alternate,r!==null&&(r.childLanes|=e),r=t,t=t.return;return r.tag===3?r.stateNode:null}var Nr=!1;function tp(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Jg(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function pr(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Wr(t,e,r){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,(Q&2)!==0){var i=n.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),n.pending=e,mr(t,r)}return i=n.interleaved,i===null?(e.next=e,ep(n)):(e.next=i.next,i.next=e),n.interleaved=e,mr(t,r)}function Sa(t,e,r){if(e=e.updateQueue,e!==null&&(e=e.shared,(r&4194240)!==0)){var n=e.lanes;n&=t.pendingLanes,r|=n,e.lanes=r,jd(t,r)}}function Tm(t,e){var r=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var i=null,o=null;if(r=r.firstBaseUpdate,r!==null){do{var s={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};o===null?i=o=s:o=o.next=s,r=r.next}while(r!==null);o===null?i=o=e:o=o.next=e}else i=o=e;r={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:n.shared,effects:n.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function Ga(t,e,r,n){var i=t.updateQueue;Nr=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,u=l.next;l.next=null,s===null?o=u:s.next=u,s=l;var c=t.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==s&&(a===null?c.firstBaseUpdate=u:a.next=u,c.lastBaseUpdate=l))}if(o!==null){var d=i.baseState;s=0,c=u=l=null,a=o;do{var p=a.lane,f=a.eventTime;if((n&p)===p){c!==null&&(c=c.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var _=t,w=a;switch(p=e,f=r,w.tag){case 1:if(_=w.payload,typeof _=="function"){d=_.call(f,d,p);break e}d=_;break e;case 3:_.flags=_.flags&-65537|128;case 0:if(_=w.payload,p=typeof _=="function"?_.call(f,d,p):_,p==null)break e;d=ue({},d,p);break e;case 2:Nr=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,p=i.effects,p===null?i.effects=[a]:p.push(a))}else f={eventTime:f,lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(u=c=f,l=d):c=c.next=f,s|=p;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;p=a,a=p.next,p.next=null,i.lastBaseUpdate=p,i.shared.pending=null}}while(!0);if(c===null&&(l=d),i.baseState=l,i.firstBaseUpdate=u,i.lastBaseUpdate=c,e=i.shared.interleaved,e!==null){i=e;do s|=i.lane,i=i.next;while(i!==e)}else o===null&&(i.shared.lanes=0);Sn|=s,t.lanes=s,t.memoizedState=d}}function Mm(t,e,r){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var n=t[e],i=n.callback;if(i!==null){if(n.callback=null,n=r,typeof i!="function")throw Error(M(191,i));i.call(n)}}}var is={},Zt=Xr(is),Qo=Xr(is),Jo=Xr(is);function _n(t){if(t===is)throw Error(M(174));return t}function rp(t,e){switch(re(Jo,e),re(Qo,t),re(Zt,is),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Qc(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Qc(e,t)}ie(Zt),re(Zt,e)}function Fi(){ie(Zt),ie(Qo),ie(Jo)}function Xg(t){_n(Jo.current);var e=_n(Zt.current),r=Qc(e,t.type);e!==r&&(re(Qo,t),re(Zt,r))}function np(t){Qo.current===t&&(ie(Zt),ie(Qo))}var ae=Xr(0);function qa(t){for(var e=t;e!==null;){if(e.tag===13){var r=e.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if((e.flags&128)!==0)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var $c=[];function ip(){for(var t=0;t<$c.length;t++)$c[t]._workInProgressVersionPrimary=null;$c.length=0}var Ta=_r.ReactCurrentDispatcher,Oc=_r.ReactCurrentBatchConfig,xn=0,le=null,_e=null,we=null,Ha=!1,Fo=!1,Xo=0,I1=0;function Ce(){throw Error(M(321))}function op(t,e){if(e===null)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!jt(t[r],e[r]))return!1;return!0}function sp(t,e,r,n,i,o){if(xn=o,le=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Ta.current=t===null||t.memoizedState===null?F1:N1,t=r(n,i),Fo){o=0;do{if(Fo=!1,Xo=0,25<=o)throw Error(M(301));o+=1,we=_e=null,e.updateQueue=null,Ta.current=L1,t=r(n,i)}while(Fo)}if(Ta.current=Ka,e=_e!==null&&_e.next!==null,xn=0,we=_e=le=null,Ha=!1,e)throw Error(M(300));return t}function ap(){var t=Xo!==0;return Xo=0,t}function Qt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return we===null?le.memoizedState=we=t:we=we.next=t,we}function xt(){if(_e===null){var t=le.alternate;t=t!==null?t.memoizedState:null}else t=_e.next;var e=we===null?le.memoizedState:we.next;if(e!==null)we=e,_e=t;else{if(t===null)throw Error(M(310));_e=t,t={memoizedState:_e.memoizedState,baseState:_e.baseState,baseQueue:_e.baseQueue,queue:_e.queue,next:null},we===null?le.memoizedState=we=t:we=we.next=t}return we}function Zo(t,e){return typeof e=="function"?e(t):e}function Fc(t){var e=xt(),r=e.queue;if(r===null)throw Error(M(311));r.lastRenderedReducer=t;var n=_e,i=n.baseQueue,o=r.pending;if(o!==null){if(i!==null){var s=i.next;i.next=o.next,o.next=s}n.baseQueue=i=o,r.pending=null}if(i!==null){o=i.next,n=n.baseState;var a=s=null,l=null,u=o;do{var c=u.lane;if((xn&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),n=u.hasEagerState?u.eagerState:t(n,u.action);else{var d={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=d,s=n):l=l.next=d,le.lanes|=c,Sn|=c}u=u.next}while(u!==null&&u!==o);l===null?s=n:l.next=a,jt(n,e.memoizedState)||(Xe=!0),e.memoizedState=n,e.baseState=s,e.baseQueue=l,r.lastRenderedState=n}if(t=r.interleaved,t!==null){i=t;do o=i.lane,le.lanes|=o,Sn|=o,i=i.next;while(i!==t)}else i===null&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function Nc(t){var e=xt(),r=e.queue;if(r===null)throw Error(M(311));r.lastRenderedReducer=t;var n=r.dispatch,i=r.pending,o=e.memoizedState;if(i!==null){r.pending=null;var s=i=i.next;do o=t(o,s.action),s=s.next;while(s!==i);jt(o,e.memoizedState)||(Xe=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),r.lastRenderedState=o}return[o,n]}function Zg(){}function Yg(t,e){var r=le,n=xt(),i=e(),o=!jt(n.memoizedState,i);if(o&&(n.memoizedState=i,Xe=!0),n=n.queue,lp(r_.bind(null,r,n,t),[t]),n.getSnapshot!==e||o||we!==null&&we.memoizedState.tag&1){if(r.flags|=2048,Yo(9,t_.bind(null,r,n,i,e),void 0,null),ve===null)throw Error(M(349));(xn&30)!==0||e_(r,e,i)}return i}function e_(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},e=le.updateQueue,e===null?(e={lastEffect:null,stores:null},le.updateQueue=e,e.stores=[t]):(r=e.stores,r===null?e.stores=[t]:r.push(t))}function t_(t,e,r,n){e.value=r,e.getSnapshot=n,n_(e)&&i_(t)}function r_(t,e,r){return r(function(){n_(e)&&i_(t)})}function n_(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!jt(t,r)}catch{return!0}}function i_(t){var e=mr(t,1);e!==null&&zt(e,t,1,-1)}function km(t){var e=Qt();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Zo,lastRenderedState:t},e.queue=t,t=t.dispatch=O1.bind(null,le,t),[e.memoizedState,t]}function Yo(t,e,r,n){return t={tag:t,create:e,destroy:r,deps:n,next:null},e=le.updateQueue,e===null?(e={lastEffect:null,stores:null},le.updateQueue=e,e.lastEffect=t.next=t):(r=e.lastEffect,r===null?e.lastEffect=t.next=t:(n=r.next,r.next=t,t.next=n,e.lastEffect=t)),t}function o_(){return xt().memoizedState}function Ma(t,e,r,n){var i=Qt();le.flags|=t,i.memoizedState=Yo(1|e,r,void 0,n===void 0?null:n)}function sl(t,e,r,n){var i=xt();n=n===void 0?null:n;var o=void 0;if(_e!==null){var s=_e.memoizedState;if(o=s.destroy,n!==null&&op(n,s.deps)){i.memoizedState=Yo(e,r,o,n);return}}le.flags|=t,i.memoizedState=Yo(1|e,r,o,n)}function Em(t,e){return Ma(8390656,8,t,e)}function lp(t,e){return sl(2048,8,t,e)}function s_(t,e){return sl(4,2,t,e)}function a_(t,e){return sl(4,4,t,e)}function l_(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function u_(t,e,r){return r=r!=null?r.concat([t]):null,sl(4,4,l_.bind(null,e,t),r)}function up(){}function c_(t,e){var r=xt();e=e===void 0?null:e;var n=r.memoizedState;return n!==null&&e!==null&&op(e,n[1])?n[0]:(r.memoizedState=[t,e],t)}function d_(t,e){var r=xt();e=e===void 0?null:e;var n=r.memoizedState;return n!==null&&e!==null&&op(e,n[1])?n[0]:(t=t(),r.memoizedState=[t,e],t)}function p_(t,e,r){return(xn&21)===0?(t.baseState&&(t.baseState=!1,Xe=!0),t.memoizedState=r):(jt(r,e)||(r=_g(),le.lanes|=r,Sn|=r,t.baseState=!0),e)}function A1(t,e){var r=Y;Y=r!==0&&4>r?r:4,t(!0);var n=Oc.transition;Oc.transition={};try{t(!1),e()}finally{Y=r,Oc.transition=n}}function f_(){return xt().memoizedState}function $1(t,e,r){var n=qr(t);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},h_(t))m_(e,r);else if(r=Qg(t,e,r,n),r!==null){var i=je();zt(r,t,n,i),g_(r,e,n)}}function O1(t,e,r){var n=qr(t),i={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(h_(t))m_(e,i);else{var o=t.alternate;if(t.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var s=e.lastRenderedState,a=o(s,r);if(i.hasEagerState=!0,i.eagerState=a,jt(a,s)){var l=e.interleaved;l===null?(i.next=i,ep(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}r=Qg(t,e,i,n),r!==null&&(i=je(),zt(r,t,n,i),g_(r,e,n))}}function h_(t){var e=t.alternate;return t===le||e!==null&&e===le}function m_(t,e){Fo=Ha=!0;var r=t.pending;r===null?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function g_(t,e,r){if((r&4194240)!==0){var n=e.lanes;n&=t.pendingLanes,r|=n,e.lanes=r,jd(t,r)}}var Ka={readContext:bt,useCallback:Ce,useContext:Ce,useEffect:Ce,useImperativeHandle:Ce,useInsertionEffect:Ce,useLayoutEffect:Ce,useMemo:Ce,useReducer:Ce,useRef:Ce,useState:Ce,useDebugValue:Ce,useDeferredValue:Ce,useTransition:Ce,useMutableSource:Ce,useSyncExternalStore:Ce,useId:Ce,unstable_isNewReconciler:!1},F1={readContext:bt,useCallback:function(t,e){return Qt().memoizedState=[t,e===void 0?null:e],t},useContext:bt,useEffect:Em,useImperativeHandle:function(t,e,r){return r=r!=null?r.concat([t]):null,Ma(4194308,4,l_.bind(null,e,t),r)},useLayoutEffect:function(t,e){return Ma(4194308,4,t,e)},useInsertionEffect:function(t,e){return Ma(4,2,t,e)},useMemo:function(t,e){var r=Qt();return e=e===void 0?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var n=Qt();return e=r!==void 0?r(e):e,n.memoizedState=n.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},n.queue=t,t=t.dispatch=$1.bind(null,le,t),[n.memoizedState,t]},useRef:function(t){var e=Qt();return t={current:t},e.memoizedState=t},useState:km,useDebugValue:up,useDeferredValue:function(t){return Qt().memoizedState=t},useTransition:function(){var t=km(!1),e=t[0];return t=A1.bind(null,t[1]),Qt().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var n=le,i=Qt();if(se){if(r===void 0)throw Error(M(407));r=r()}else{if(r=e(),ve===null)throw Error(M(349));(xn&30)!==0||e_(n,e,r)}i.memoizedState=r;var o={value:r,getSnapshot:e};return i.queue=o,Em(r_.bind(null,n,o,t),[t]),n.flags|=2048,Yo(9,t_.bind(null,n,o,r,e),void 0,null),r},useId:function(){var t=Qt(),e=ve.identifierPrefix;if(se){var r=dr,n=cr;r=(n&~(1<<32-Dt(n)-1)).toString(32)+r,e=":"+e+"R"+r,r=Xo++,0<r&&(e+="H"+r.toString(32)),e+=":"}else r=I1++,e=":"+e+"r"+r.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},N1={readContext:bt,useCallback:c_,useContext:bt,useEffect:lp,useImperativeHandle:u_,useInsertionEffect:s_,useLayoutEffect:a_,useMemo:d_,useReducer:Fc,useRef:o_,useState:function(){return Fc(Zo)},useDebugValue:up,useDeferredValue:function(t){var e=xt();return p_(e,_e.memoizedState,t)},useTransition:function(){var t=Fc(Zo)[0],e=xt().memoizedState;return[t,e]},useMutableSource:Zg,useSyncExternalStore:Yg,useId:f_,unstable_isNewReconciler:!1},L1={readContext:bt,useCallback:c_,useContext:bt,useEffect:lp,useImperativeHandle:u_,useInsertionEffect:s_,useLayoutEffect:a_,useMemo:d_,useReducer:Nc,useRef:o_,useState:function(){return Nc(Zo)},useDebugValue:up,useDeferredValue:function(t){var e=xt();return _e===null?e.memoizedState=t:p_(e,_e.memoizedState,t)},useTransition:function(){var t=Nc(Zo)[0],e=xt().memoizedState;return[t,e]},useMutableSource:Zg,useSyncExternalStore:Yg,useId:f_,unstable_isNewReconciler:!1};function Nt(t,e){if(t&&t.defaultProps){e=ue({},e),t=t.defaultProps;for(var r in t)e[r]===void 0&&(e[r]=t[r]);return e}return e}function gd(t,e,r,n){e=t.memoizedState,r=r(n,e),r=r==null?e:ue({},e,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var al={isMounted:function(t){return(t=t._reactInternals)?kn(t)===t:!1},enqueueSetState:function(t,e,r){t=t._reactInternals;var n=je(),i=qr(t),o=pr(n,i);o.payload=e,r!=null&&(o.callback=r),e=Wr(t,o,i),e!==null&&(zt(e,t,i,n),Sa(e,t,i))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var n=je(),i=qr(t),o=pr(n,i);o.tag=1,o.payload=e,r!=null&&(o.callback=r),e=Wr(t,o,i),e!==null&&(zt(e,t,i,n),Sa(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=je(),n=qr(t),i=pr(r,n);i.tag=2,e!=null&&(i.callback=e),e=Wr(t,i,n),e!==null&&(zt(e,t,n,r),Sa(e,t,n))}};function Pm(t,e,r,n,i,o,s){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,o,s):e.prototype&&e.prototype.isPureReactComponent?!Go(r,n)||!Go(i,o):!0}function __(t,e,r){var n=!1,i=Qr,o=e.contextType;return typeof o=="object"&&o!==null?o=bt(o):(i=Ye(e)?vn:$e.current,n=e.contextTypes,o=(n=n!=null)?Ai(t,i):Qr),e=new e(r,o),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=al,t.stateNode=e,e._reactInternals=t,n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=o),e}function Cm(t,e,r,n){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(r,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(r,n),e.state!==t&&al.enqueueReplaceState(e,e.state,null)}function _d(t,e,r,n){var i=t.stateNode;i.props=r,i.state=t.memoizedState,i.refs={},tp(t);var o=e.contextType;typeof o=="object"&&o!==null?i.context=bt(o):(o=Ye(e)?vn:$e.current,i.context=Ai(t,o)),i.state=t.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(gd(t,e,o,r),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&al.enqueueReplaceState(i,i.state,null),Ga(t,r,i,n),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function Ni(t,e){try{var r="",n=e;do r+=px(n),n=n.return;while(n);var i=r}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:t,source:e,stack:i,digest:null}}function Lc(t,e,r){return{value:t,source:null,stack:r??null,digest:e??null}}function yd(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var R1=typeof WeakMap=="function"?WeakMap:Map;function y_(t,e,r){r=pr(-1,r),r.tag=3,r.payload={element:null};var n=e.value;return r.callback=function(){Ja||(Ja=!0,Pd=n),yd(t,e)},r}function w_(t,e,r){r=pr(-1,r),r.tag=3;var n=t.type.getDerivedStateFromError;if(typeof n=="function"){var i=e.value;r.payload=function(){return n(i)},r.callback=function(){yd(t,e)}}var o=t.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(r.callback=function(){yd(t,e),typeof n!="function"&&(Gr===null?Gr=new Set([this]):Gr.add(this));var s=e.stack;this.componentDidCatch(e.value,{componentStack:s!==null?s:""})}),r}function Im(t,e,r){var n=t.pingCache;if(n===null){n=t.pingCache=new R1;var i=new Set;n.set(e,i)}else i=n.get(e),i===void 0&&(i=new Set,n.set(e,i));i.has(r)||(i.add(r),t=X1.bind(null,t,e,r),e.then(t,t))}function Am(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function $m(t,e,r,n,i){return(t.mode&1)===0?(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(e=pr(-1,1),e.tag=2,Wr(r,e,1))),r.lanes|=1),t):(t.flags|=65536,t.lanes=i,t)}var D1=_r.ReactCurrentOwner,Xe=!1;function ze(t,e,r,n){e.child=t===null?Kg(e,null,r,n):Oi(e,t.child,r,n)}function Om(t,e,r,n,i){r=r.render;var o=e.ref;return Pi(e,i),n=sp(t,e,r,n,o,i),r=ap(),t!==null&&!Xe?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,gr(t,e,i)):(se&&r&&Kd(e),e.flags|=1,ze(t,e,n,i),e.child)}function Fm(t,e,r,n,i){if(t===null){var o=r.type;return typeof o=="function"&&!_p(o)&&o.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(e.tag=15,e.type=o,v_(t,e,o,n,i)):(t=Ca(r.type,null,n,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(o=t.child,(t.lanes&i)===0){var s=o.memoizedProps;if(r=r.compare,r=r!==null?r:Go,r(s,n)&&t.ref===e.ref)return gr(t,e,i)}return e.flags|=1,t=Hr(o,n),t.ref=e.ref,t.return=e,e.child=t}function v_(t,e,r,n,i){if(t!==null){var o=t.memoizedProps;if(Go(o,n)&&t.ref===e.ref)if(Xe=!1,e.pendingProps=n=o,(t.lanes&i)!==0)(t.flags&131072)!==0&&(Xe=!0);else return e.lanes=t.lanes,gr(t,e,i)}return wd(t,e,r,n,i)}function b_(t,e,r){var n=e.pendingProps,i=n.children,o=t!==null?t.memoizedState:null;if(n.mode==="hidden")if((e.mode&1)===0)e.memoizedState={baseLanes:0,cachePool:null,transitions:null},re(Si,st),st|=r;else{if((r&1073741824)===0)return t=o!==null?o.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,re(Si,st),st|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=o!==null?o.baseLanes:r,re(Si,st),st|=n}else o!==null?(n=o.baseLanes|r,e.memoizedState=null):n=r,re(Si,st),st|=n;return ze(t,e,i,r),e.child}function x_(t,e){var r=e.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function wd(t,e,r,n,i){var o=Ye(r)?vn:$e.current;return o=Ai(e,o),Pi(e,i),r=sp(t,e,r,n,o,i),n=ap(),t!==null&&!Xe?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,gr(t,e,i)):(se&&n&&Kd(e),e.flags|=1,ze(t,e,r,i),e.child)}function Nm(t,e,r,n,i){if(Ye(r)){var o=!0;ja(e)}else o=!1;if(Pi(e,i),e.stateNode===null)ka(t,e),__(e,r,n),_d(e,r,n,i),n=!0;else if(t===null){var s=e.stateNode,a=e.memoizedProps;s.props=a;var l=s.context,u=r.contextType;typeof u=="object"&&u!==null?u=bt(u):(u=Ye(r)?vn:$e.current,u=Ai(e,u));var c=r.getDerivedStateFromProps,d=typeof c=="function"||typeof s.getSnapshotBeforeUpdate=="function";d||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==n||l!==u)&&Cm(e,s,n,u),Nr=!1;var p=e.memoizedState;s.state=p,Ga(e,n,s,i),l=e.memoizedState,a!==n||p!==l||Ze.current||Nr?(typeof c=="function"&&(gd(e,r,c,n),l=e.memoizedState),(a=Nr||Pm(e,r,a,n,p,l,u))?(d||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4194308)):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=l),s.props=n,s.state=l,s.context=u,n=a):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{s=e.stateNode,Jg(t,e),a=e.memoizedProps,u=e.type===e.elementType?a:Nt(e.type,a),s.props=u,d=e.pendingProps,p=s.context,l=r.contextType,typeof l=="object"&&l!==null?l=bt(l):(l=Ye(r)?vn:$e.current,l=Ai(e,l));var f=r.getDerivedStateFromProps;(c=typeof f=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==d||p!==l)&&Cm(e,s,n,l),Nr=!1,p=e.memoizedState,s.state=p,Ga(e,n,s,i);var _=e.memoizedState;a!==d||p!==_||Ze.current||Nr?(typeof f=="function"&&(gd(e,r,f,n),_=e.memoizedState),(u=Nr||Pm(e,r,u,n,p,_,l)||!1)?(c||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(n,_,l),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(n,_,l)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof s.componentDidUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=_),s.props=n,s.state=_,s.context=l,n=u):(typeof s.componentDidUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),n=!1)}return vd(t,e,r,n,o,i)}function vd(t,e,r,n,i,o){x_(t,e);var s=(e.flags&128)!==0;if(!n&&!s)return i&&vm(e,r,!1),gr(t,e,o);n=e.stateNode,D1.current=e;var a=s&&typeof r.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,t!==null&&s?(e.child=Oi(e,t.child,null,o),e.child=Oi(e,null,a,o)):ze(t,e,a,o),e.memoizedState=n.state,i&&vm(e,r,!0),e.child}function S_(t){var e=t.stateNode;e.pendingContext?wm(t,e.pendingContext,e.pendingContext!==e.context):e.context&&wm(t,e.context,!1),rp(t,e.containerInfo)}function Lm(t,e,r,n,i){return $i(),Jd(i),e.flags|=256,ze(t,e,r,n),e.child}var bd={dehydrated:null,treeContext:null,retryLane:0};function xd(t){return{baseLanes:t,cachePool:null,transitions:null}}function T_(t,e,r){var n=e.pendingProps,i=ae.current,o=!1,s=(e.flags&128)!==0,a;if((a=s)||(a=t!==null&&t.memoizedState===null?!1:(i&2)!==0),a?(o=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),re(ae,i&1),t===null)return hd(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?((e.mode&1)===0?e.lanes=1:t.data==="$!"?e.lanes=8:e.lanes=1073741824,null):(s=n.children,t=n.fallback,o?(n=e.mode,o=e.child,s={mode:"hidden",children:s},(n&1)===0&&o!==null?(o.childLanes=0,o.pendingProps=s):o=cl(s,n,0,null),t=wn(t,n,r,null),o.return=e,t.return=e,o.sibling=t,e.child=o,e.child.memoizedState=xd(r),e.memoizedState=bd,t):cp(e,s));if(i=t.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return z1(t,e,s,n,a,i,r);if(o){o=n.fallback,s=e.mode,i=t.child,a=i.sibling;var l={mode:"hidden",children:n.children};return(s&1)===0&&e.child!==i?(n=e.child,n.childLanes=0,n.pendingProps=l,e.deletions=null):(n=Hr(i,l),n.subtreeFlags=i.subtreeFlags&14680064),a!==null?o=Hr(a,o):(o=wn(o,s,r,null),o.flags|=2),o.return=e,n.return=e,n.sibling=o,e.child=n,n=o,o=e.child,s=t.child.memoizedState,s=s===null?xd(r):{baseLanes:s.baseLanes|r,cachePool:null,transitions:s.transitions},o.memoizedState=s,o.childLanes=t.childLanes&~r,e.memoizedState=bd,n}return o=t.child,t=o.sibling,n=Hr(o,{mode:"visible",children:n.children}),(e.mode&1)===0&&(n.lanes=r),n.return=e,n.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=n,e.memoizedState=null,n}function cp(t,e){return e=cl({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function _a(t,e,r,n){return n!==null&&Jd(n),Oi(e,t.child,null,r),t=cp(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function z1(t,e,r,n,i,o,s){if(r)return e.flags&256?(e.flags&=-257,n=Lc(Error(M(422))),_a(t,e,s,n)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(o=n.fallback,i=e.mode,n=cl({mode:"visible",children:n.children},i,0,null),o=wn(o,i,s,null),o.flags|=2,n.return=e,o.return=e,n.sibling=o,e.child=n,(e.mode&1)!==0&&Oi(e,t.child,null,s),e.child.memoizedState=xd(s),e.memoizedState=bd,o);if((e.mode&1)===0)return _a(t,e,s,null);if(i.data==="$!"){if(n=i.nextSibling&&i.nextSibling.dataset,n)var a=n.dgst;return n=a,o=Error(M(419)),n=Lc(o,n,void 0),_a(t,e,s,n)}if(a=(s&t.childLanes)!==0,Xe||a){if(n=ve,n!==null){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=(i&(n.suspendedLanes|s))!==0?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,mr(t,i),zt(n,t,i,-1))}return gp(),n=Lc(Error(M(421))),_a(t,e,s,n)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=Z1.bind(null,t),i._reactRetry=e,null):(t=o.treeContext,at=Vr(i.nextSibling),lt=e,se=!0,Rt=null,t!==null&&(_t[yt++]=cr,_t[yt++]=dr,_t[yt++]=bn,cr=t.id,dr=t.overflow,bn=e),e=cp(e,n.children),e.flags|=4096,e)}function Rm(t,e,r){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),md(t.return,e,r)}function Rc(t,e,r,n,i){var o=t.memoizedState;o===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:i}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=n,o.tail=r,o.tailMode=i)}function M_(t,e,r){var n=e.pendingProps,i=n.revealOrder,o=n.tail;if(ze(t,e,n.children,r),n=ae.current,(n&2)!==0)n=n&1|2,e.flags|=128;else{if(t!==null&&(t.flags&128)!==0)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Rm(t,r,e);else if(t.tag===19)Rm(t,r,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}n&=1}if(re(ae,n),(e.mode&1)===0)e.memoizedState=null;else switch(i){case"forwards":for(r=e.child,i=null;r!==null;)t=r.alternate,t!==null&&qa(t)===null&&(i=r),r=r.sibling;r=i,r===null?(i=e.child,e.child=null):(i=r.sibling,r.sibling=null),Rc(e,!1,i,r,o);break;case"backwards":for(r=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&qa(t)===null){e.child=i;break}t=i.sibling,i.sibling=r,r=i,i=t}Rc(e,!0,r,null,o);break;case"together":Rc(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ka(t,e){(e.mode&1)===0&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function gr(t,e,r){if(t!==null&&(e.dependencies=t.dependencies),Sn|=e.lanes,(r&e.childLanes)===0)return null;if(t!==null&&e.child!==t.child)throw Error(M(153));if(e.child!==null){for(t=e.child,r=Hr(t,t.pendingProps),e.child=r,r.return=e;t.sibling!==null;)t=t.sibling,r=r.sibling=Hr(t,t.pendingProps),r.return=e;r.sibling=null}return e.child}function j1(t,e,r){switch(e.tag){case 3:S_(e),$i();break;case 5:Xg(e);break;case 1:Ye(e.type)&&ja(e);break;case 4:rp(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,i=e.memoizedProps.value;re(Va,n._currentValue),n._currentValue=i;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(re(ae,ae.current&1),e.flags|=128,null):(r&e.child.childLanes)!==0?T_(t,e,r):(re(ae,ae.current&1),t=gr(t,e,r),t!==null?t.sibling:null);re(ae,ae.current&1);break;case 19:if(n=(r&e.childLanes)!==0,(t.flags&128)!==0){if(n)return M_(t,e,r);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),re(ae,ae.current),n)break;return null;case 22:case 23:return e.lanes=0,b_(t,e,r)}return gr(t,e,r)}var k_,Sd,E_,P_;k_=function(t,e){for(var r=e.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};Sd=function(){};E_=function(t,e,r,n){var i=t.memoizedProps;if(i!==n){t=e.stateNode,_n(Zt.current);var o=null;switch(r){case"input":i=Gc(t,i),n=Gc(t,n),o=[];break;case"select":i=ue({},i,{value:void 0}),n=ue({},n,{value:void 0}),o=[];break;case"textarea":i=Kc(t,i),n=Kc(t,n),o=[];break;default:typeof i.onClick!="function"&&typeof n.onClick=="function"&&(t.onclick=Da)}Jc(r,n);var s;r=null;for(u in i)if(!n.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var a=i[u];for(s in a)a.hasOwnProperty(s)&&(r||(r={}),r[s]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Do.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in n){var l=n[u];if(a=i?.[u],n.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(s in a)!a.hasOwnProperty(s)||l&&l.hasOwnProperty(s)||(r||(r={}),r[s]="");for(s in l)l.hasOwnProperty(s)&&a[s]!==l[s]&&(r||(r={}),r[s]=l[s])}else r||(o||(o=[]),o.push(u,r)),r=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(o=o||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(o=o||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Do.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&ne("scroll",t),o||a===l||(o=[])):(o=o||[]).push(u,l))}r&&(o=o||[]).push("style",r);var u=o;(e.updateQueue=u)&&(e.flags|=4)}};P_=function(t,e,r,n){r!==n&&(e.flags|=4)};function xo(t,e){if(!se)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function Ie(t){var e=t.alternate!==null&&t.alternate.child===t.child,r=0,n=0;if(e)for(var i=t.child;i!==null;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags&14680064,n|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=n,t.childLanes=r,e}function B1(t,e,r){var n=e.pendingProps;switch(Qd(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ie(e),null;case 1:return Ye(e.type)&&za(),Ie(e),null;case 3:return n=e.stateNode,Fi(),ie(Ze),ie($e),ip(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(ma(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&(e.flags&256)===0||(e.flags|=1024,Rt!==null&&(Ad(Rt),Rt=null))),Sd(t,e),Ie(e),null;case 5:np(e);var i=_n(Jo.current);if(r=e.type,t!==null&&e.stateNode!=null)E_(t,e,r,n,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(M(166));return Ie(e),null}if(t=_n(Zt.current),ma(e)){n=e.stateNode,r=e.type;var o=e.memoizedProps;switch(n[Jt]=e,n[Ko]=o,t=(e.mode&1)!==0,r){case"dialog":ne("cancel",n),ne("close",n);break;case"iframe":case"object":case"embed":ne("load",n);break;case"video":case"audio":for(i=0;i<Po.length;i++)ne(Po[i],n);break;case"source":ne("error",n);break;case"img":case"image":case"link":ne("error",n),ne("load",n);break;case"details":ne("toggle",n);break;case"input":Gh(n,o),ne("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!o.multiple},ne("invalid",n);break;case"textarea":Hh(n,o),ne("invalid",n)}Jc(r,o),i=null;for(var s in o)if(o.hasOwnProperty(s)){var a=o[s];s==="children"?typeof a=="string"?n.textContent!==a&&(o.suppressHydrationWarning!==!0&&ha(n.textContent,a,t),i=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(o.suppressHydrationWarning!==!0&&ha(n.textContent,a,t),i=["children",""+a]):Do.hasOwnProperty(s)&&a!=null&&s==="onScroll"&&ne("scroll",n)}switch(r){case"input":ra(n),qh(n,o,!0);break;case"textarea":ra(n),Kh(n);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(n.onclick=Da)}n=i,e.updateQueue=n,n!==null&&(e.flags|=4)}else{s=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=rg(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=s.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof n.is=="string"?t=s.createElement(r,{is:n.is}):(t=s.createElement(r),r==="select"&&(s=t,n.multiple?s.multiple=!0:n.size&&(s.size=n.size))):t=s.createElementNS(t,r),t[Jt]=e,t[Ko]=n,k_(t,e,!1,!1),e.stateNode=t;e:{switch(s=Xc(r,n),r){case"dialog":ne("cancel",t),ne("close",t),i=n;break;case"iframe":case"object":case"embed":ne("load",t),i=n;break;case"video":case"audio":for(i=0;i<Po.length;i++)ne(Po[i],t);i=n;break;case"source":ne("error",t),i=n;break;case"img":case"image":case"link":ne("error",t),ne("load",t),i=n;break;case"details":ne("toggle",t),i=n;break;case"input":Gh(t,n),i=Gc(t,n),ne("invalid",t);break;case"option":i=n;break;case"select":t._wrapperState={wasMultiple:!!n.multiple},i=ue({},n,{value:void 0}),ne("invalid",t);break;case"textarea":Hh(t,n),i=Kc(t,n),ne("invalid",t);break;default:i=n}Jc(r,i),a=i;for(o in a)if(a.hasOwnProperty(o)){var l=a[o];o==="style"?og(t,l):o==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&ng(t,l)):o==="children"?typeof l=="string"?(r!=="textarea"||l!=="")&&zo(t,l):typeof l=="number"&&zo(t,""+l):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Do.hasOwnProperty(o)?l!=null&&o==="onScroll"&&ne("scroll",t):l!=null&&Fd(t,o,l,s))}switch(r){case"input":ra(t),qh(t,n,!1);break;case"textarea":ra(t),Kh(t);break;case"option":n.value!=null&&t.setAttribute("value",""+Kr(n.value));break;case"select":t.multiple=!!n.multiple,o=n.value,o!=null?Ti(t,!!n.multiple,o,!1):n.defaultValue!=null&&Ti(t,!!n.multiple,n.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=Da)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ie(e),null;case 6:if(t&&e.stateNode!=null)P_(t,e,t.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(M(166));if(r=_n(Jo.current),_n(Zt.current),ma(e)){if(n=e.stateNode,r=e.memoizedProps,n[Jt]=e,(o=n.nodeValue!==r)&&(t=lt,t!==null))switch(t.tag){case 3:ha(n.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&ha(n.nodeValue,r,(t.mode&1)!==0)}o&&(e.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[Jt]=e,e.stateNode=n}return Ie(e),null;case 13:if(ie(ae),n=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(se&&at!==null&&(e.mode&1)!==0&&(e.flags&128)===0)qg(),$i(),e.flags|=98560,o=!1;else if(o=ma(e),n!==null&&n.dehydrated!==null){if(t===null){if(!o)throw Error(M(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(M(317));o[Jt]=e}else $i(),(e.flags&128)===0&&(e.memoizedState=null),e.flags|=4;Ie(e),o=!1}else Rt!==null&&(Ad(Rt),Rt=null),o=!0;if(!o)return e.flags&65536?e:null}return(e.flags&128)!==0?(e.lanes=r,e):(n=n!==null,n!==(t!==null&&t.memoizedState!==null)&&n&&(e.child.flags|=8192,(e.mode&1)!==0&&(t===null||(ae.current&1)!==0?ye===0&&(ye=3):gp())),e.updateQueue!==null&&(e.flags|=4),Ie(e),null);case 4:return Fi(),Sd(t,e),t===null&&qo(e.stateNode.containerInfo),Ie(e),null;case 10:return Yd(e.type._context),Ie(e),null;case 17:return Ye(e.type)&&za(),Ie(e),null;case 19:if(ie(ae),o=e.memoizedState,o===null)return Ie(e),null;if(n=(e.flags&128)!==0,s=o.rendering,s===null)if(n)xo(o,!1);else{if(ye!==0||t!==null&&(t.flags&128)!==0)for(t=e.child;t!==null;){if(s=qa(t),s!==null){for(e.flags|=128,xo(o,!1),n=s.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=r,r=e.child;r!==null;)o=r,t=n,o.flags&=14680066,s=o.alternate,s===null?(o.childLanes=0,o.lanes=t,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,o.type=s.type,t=s.dependencies,o.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return re(ae,ae.current&1|2),e.child}t=t.sibling}o.tail!==null&&fe()>Li&&(e.flags|=128,n=!0,xo(o,!1),e.lanes=4194304)}else{if(!n)if(t=qa(s),t!==null){if(e.flags|=128,n=!0,r=t.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),xo(o,!0),o.tail===null&&o.tailMode==="hidden"&&!s.alternate&&!se)return Ie(e),null}else 2*fe()-o.renderingStartTime>Li&&r!==1073741824&&(e.flags|=128,n=!0,xo(o,!1),e.lanes=4194304);o.isBackwards?(s.sibling=e.child,e.child=s):(r=o.last,r!==null?r.sibling=s:e.child=s,o.last=s)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=fe(),e.sibling=null,r=ae.current,re(ae,n?r&1|2:r&1),e):(Ie(e),null);case 22:case 23:return mp(),n=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==n&&(e.flags|=8192),n&&(e.mode&1)!==0?(st&1073741824)!==0&&(Ie(e),e.subtreeFlags&6&&(e.flags|=8192)):Ie(e),null;case 24:return null;case 25:return null}throw Error(M(156,e.tag))}function U1(t,e){switch(Qd(e),e.tag){case 1:return Ye(e.type)&&za(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Fi(),ie(Ze),ie($e),ip(),t=e.flags,(t&65536)!==0&&(t&128)===0?(e.flags=t&-65537|128,e):null;case 5:return np(e),null;case 13:if(ie(ae),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(M(340));$i()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ie(ae),null;case 4:return Fi(),null;case 10:return Yd(e.type._context),null;case 22:case 23:return mp(),null;case 24:return null;default:return null}}var ya=!1,Ae=!1,V1=typeof WeakSet=="function"?WeakSet:Set,F=null;function xi(t,e){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){ce(t,e,n)}else r.current=null}function Td(t,e,r){try{r()}catch(n){ce(t,e,n)}}var Dm=!1;function W1(t,e){if(ad=Na,t=Og(),Hd(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var i=n.anchorOffset,o=n.focusNode;n=n.focusOffset;try{r.nodeType,o.nodeType}catch{r=null;break e}var s=0,a=-1,l=-1,u=0,c=0,d=t,p=null;t:for(;;){for(var f;d!==r||i!==0&&d.nodeType!==3||(a=s+i),d!==o||n!==0&&d.nodeType!==3||(l=s+n),d.nodeType===3&&(s+=d.nodeValue.length),(f=d.firstChild)!==null;)p=d,d=f;for(;;){if(d===t)break t;if(p===r&&++u===i&&(a=s),p===o&&++c===n&&(l=s),(f=d.nextSibling)!==null)break;d=p,p=d.parentNode}d=f}r=a===-1||l===-1?null:{start:a,end:l}}else r=null}r=r||{start:0,end:0}}else r=null;for(ld={focusedElem:t,selectionRange:r},Na=!1,F=e;F!==null;)if(e=F,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,F=t;else for(;F!==null;){e=F;try{var _=e.alternate;if((e.flags&1024)!==0)switch(e.tag){case 0:case 11:case 15:break;case 1:if(_!==null){var w=_.memoizedProps,b=_.memoizedState,m=e.stateNode,h=m.getSnapshotBeforeUpdate(e.elementType===e.type?w:Nt(e.type,w),b);m.__reactInternalSnapshotBeforeUpdate=h}break;case 3:var g=e.stateNode.containerInfo;g.nodeType===1?g.textContent="":g.nodeType===9&&g.documentElement&&g.removeChild(g.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(M(163))}}catch(y){ce(e,e.return,y)}if(t=e.sibling,t!==null){t.return=e.return,F=t;break}F=e.return}return _=Dm,Dm=!1,_}function No(t,e,r){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do{if((i.tag&t)===t){var o=i.destroy;i.destroy=void 0,o!==void 0&&Td(e,r,o)}i=i.next}while(i!==n)}}function ll(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var r=e=e.next;do{if((r.tag&t)===t){var n=r.create;r.destroy=n()}r=r.next}while(r!==e)}}function Md(t){var e=t.ref;if(e!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof e=="function"?e(t):e.current=t}}function C_(t){var e=t.alternate;e!==null&&(t.alternate=null,C_(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Jt],delete e[Ko],delete e[dd],delete e[k1],delete e[E1])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function I_(t){return t.tag===5||t.tag===3||t.tag===4}function zm(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||I_(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function kd(t,e,r){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?r.nodeType===8?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(r.nodeType===8?(e=r.parentNode,e.insertBefore(t,r)):(e=r,e.appendChild(t)),r=r._reactRootContainer,r!=null||e.onclick!==null||(e.onclick=Da));else if(n!==4&&(t=t.child,t!==null))for(kd(t,e,r),t=t.sibling;t!==null;)kd(t,e,r),t=t.sibling}function Ed(t,e,r){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(n!==4&&(t=t.child,t!==null))for(Ed(t,e,r),t=t.sibling;t!==null;)Ed(t,e,r),t=t.sibling}var Se=null,Lt=!1;function Or(t,e,r){for(r=r.child;r!==null;)A_(t,e,r),r=r.sibling}function A_(t,e,r){if(Xt&&typeof Xt.onCommitFiberUnmount=="function")try{Xt.onCommitFiberUnmount(el,r)}catch{}switch(r.tag){case 5:Ae||xi(r,e);case 6:var n=Se,i=Lt;Se=null,Or(t,e,r),Se=n,Lt=i,Se!==null&&(Lt?(t=Se,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):Se.removeChild(r.stateNode));break;case 18:Se!==null&&(Lt?(t=Se,r=r.stateNode,t.nodeType===8?Ic(t.parentNode,r):t.nodeType===1&&Ic(t,r),Vo(t)):Ic(Se,r.stateNode));break;case 4:n=Se,i=Lt,Se=r.stateNode.containerInfo,Lt=!0,Or(t,e,r),Se=n,Lt=i;break;case 0:case 11:case 14:case 15:if(!Ae&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){i=n=n.next;do{var o=i,s=o.destroy;o=o.tag,s!==void 0&&((o&2)!==0||(o&4)!==0)&&Td(r,e,s),i=i.next}while(i!==n)}Or(t,e,r);break;case 1:if(!Ae&&(xi(r,e),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(a){ce(r,e,a)}Or(t,e,r);break;case 21:Or(t,e,r);break;case 22:r.mode&1?(Ae=(n=Ae)||r.memoizedState!==null,Or(t,e,r),Ae=n):Or(t,e,r);break;default:Or(t,e,r)}}function jm(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new V1),e.forEach(function(n){var i=Y1.bind(null,t,n);r.has(n)||(r.add(n),n.then(i,i))})}}function Ft(t,e){var r=e.deletions;if(r!==null)for(var n=0;n<r.length;n++){var i=r[n];try{var o=t,s=e,a=s;e:for(;a!==null;){switch(a.tag){case 5:Se=a.stateNode,Lt=!1;break e;case 3:Se=a.stateNode.containerInfo,Lt=!0;break e;case 4:Se=a.stateNode.containerInfo,Lt=!0;break e}a=a.return}if(Se===null)throw Error(M(160));A_(o,s,i),Se=null,Lt=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(u){ce(i,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)$_(e,t),e=e.sibling}function $_(t,e){var r=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ft(e,t),Kt(t),n&4){try{No(3,t,t.return),ll(3,t)}catch(w){ce(t,t.return,w)}try{No(5,t,t.return)}catch(w){ce(t,t.return,w)}}break;case 1:Ft(e,t),Kt(t),n&512&&r!==null&&xi(r,r.return);break;case 5:if(Ft(e,t),Kt(t),n&512&&r!==null&&xi(r,r.return),t.flags&32){var i=t.stateNode;try{zo(i,"")}catch(w){ce(t,t.return,w)}}if(n&4&&(i=t.stateNode,i!=null)){var o=t.memoizedProps,s=r!==null?r.memoizedProps:o,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&o.type==="radio"&&o.name!=null&&eg(i,o),Xc(a,s);var u=Xc(a,o);for(s=0;s<l.length;s+=2){var c=l[s],d=l[s+1];c==="style"?og(i,d):c==="dangerouslySetInnerHTML"?ng(i,d):c==="children"?zo(i,d):Fd(i,c,d,u)}switch(a){case"input":qc(i,o);break;case"textarea":tg(i,o);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var f=o.value;f!=null?Ti(i,!!o.multiple,f,!1):p!==!!o.multiple&&(o.defaultValue!=null?Ti(i,!!o.multiple,o.defaultValue,!0):Ti(i,!!o.multiple,o.multiple?[]:"",!1))}i[Ko]=o}catch(w){ce(t,t.return,w)}}break;case 6:if(Ft(e,t),Kt(t),n&4){if(t.stateNode===null)throw Error(M(162));i=t.stateNode,o=t.memoizedProps;try{i.nodeValue=o}catch(w){ce(t,t.return,w)}}break;case 3:if(Ft(e,t),Kt(t),n&4&&r!==null&&r.memoizedState.isDehydrated)try{Vo(e.containerInfo)}catch(w){ce(t,t.return,w)}break;case 4:Ft(e,t),Kt(t);break;case 13:Ft(e,t),Kt(t),i=t.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(fp=fe())),n&4&&jm(t);break;case 22:if(c=r!==null&&r.memoizedState!==null,t.mode&1?(Ae=(u=Ae)||c,Ft(e,t),Ae=u):Ft(e,t),Kt(t),n&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!c&&(t.mode&1)!==0)for(F=t,c=t.child;c!==null;){for(d=F=c;F!==null;){switch(p=F,f=p.child,p.tag){case 0:case 11:case 14:case 15:No(4,p,p.return);break;case 1:xi(p,p.return);var _=p.stateNode;if(typeof _.componentWillUnmount=="function"){n=p,r=p.return;try{e=n,_.props=e.memoizedProps,_.state=e.memoizedState,_.componentWillUnmount()}catch(w){ce(n,r,w)}}break;case 5:xi(p,p.return);break;case 22:if(p.memoizedState!==null){Um(d);continue}}f!==null?(f.return=p,F=f):Um(d)}c=c.sibling}e:for(c=null,d=t;;){if(d.tag===5){if(c===null){c=d;try{i=d.stateNode,u?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(a=d.stateNode,l=d.memoizedProps.style,s=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=ig("display",s))}catch(w){ce(t,t.return,w)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(w){ce(t,t.return,w)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Ft(e,t),Kt(t),n&4&&jm(t);break;case 21:break;default:Ft(e,t),Kt(t)}}function Kt(t){var e=t.flags;if(e&2){try{e:{for(var r=t.return;r!==null;){if(I_(r)){var n=r;break e}r=r.return}throw Error(M(160))}switch(n.tag){case 5:var i=n.stateNode;n.flags&32&&(zo(i,""),n.flags&=-33);var o=zm(t);Ed(t,o,i);break;case 3:case 4:var s=n.stateNode.containerInfo,a=zm(t);kd(t,a,s);break;default:throw Error(M(161))}}catch(l){ce(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function G1(t,e,r){F=t,O_(t,e,r)}function O_(t,e,r){for(var n=(t.mode&1)!==0;F!==null;){var i=F,o=i.child;if(i.tag===22&&n){var s=i.memoizedState!==null||ya;if(!s){var a=i.alternate,l=a!==null&&a.memoizedState!==null||Ae;a=ya;var u=Ae;if(ya=s,(Ae=l)&&!u)for(F=i;F!==null;)s=F,l=s.child,s.tag===22&&s.memoizedState!==null?Vm(i):l!==null?(l.return=s,F=l):Vm(i);for(;o!==null;)F=o,O_(o,e,r),o=o.sibling;F=i,ya=a,Ae=u}Bm(t,e,r)}else(i.subtreeFlags&8772)!==0&&o!==null?(o.return=i,F=o):Bm(t,e,r)}}function Bm(t){for(;F!==null;){var e=F;if((e.flags&8772)!==0){var r=e.alternate;try{if((e.flags&8772)!==0)switch(e.tag){case 0:case 11:case 15:Ae||ll(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!Ae)if(r===null)n.componentDidMount();else{var i=e.elementType===e.type?r.memoizedProps:Nt(e.type,r.memoizedProps);n.componentDidUpdate(i,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&Mm(e,o,n);break;case 3:var s=e.updateQueue;if(s!==null){if(r=null,e.child!==null)switch(e.child.tag){case 5:r=e.child.stateNode;break;case 1:r=e.child.stateNode}Mm(e,s,r)}break;case 5:var a=e.stateNode;if(r===null&&e.flags&4){r=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&r.focus();break;case"img":l.src&&(r.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&Vo(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(M(163))}Ae||e.flags&512&&Md(e)}catch(p){ce(e,e.return,p)}}if(e===t){F=null;break}if(r=e.sibling,r!==null){r.return=e.return,F=r;break}F=e.return}}function Um(t){for(;F!==null;){var e=F;if(e===t){F=null;break}var r=e.sibling;if(r!==null){r.return=e.return,F=r;break}F=e.return}}function Vm(t){for(;F!==null;){var e=F;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{ll(4,e)}catch(l){ce(e,r,l)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var i=e.return;try{n.componentDidMount()}catch(l){ce(e,i,l)}}var o=e.return;try{Md(e)}catch(l){ce(e,o,l)}break;case 5:var s=e.return;try{Md(e)}catch(l){ce(e,s,l)}}}catch(l){ce(e,e.return,l)}if(e===t){F=null;break}var a=e.sibling;if(a!==null){a.return=e.return,F=a;break}F=e.return}}var q1=Math.ceil,Qa=_r.ReactCurrentDispatcher,dp=_r.ReactCurrentOwner,vt=_r.ReactCurrentBatchConfig,Q=0,ve=null,me=null,Te=0,st=0,Si=Xr(0),ye=0,es=null,Sn=0,ul=0,pp=0,Lo=null,Je=null,fp=0,Li=1/0,lr=null,Ja=!1,Pd=null,Gr=null,wa=!1,zr=null,Xa=0,Ro=0,Cd=null,Ea=-1,Pa=0;function je(){return(Q&6)!==0?fe():Ea!==-1?Ea:Ea=fe()}function qr(t){return(t.mode&1)===0?1:(Q&2)!==0&&Te!==0?Te&-Te:C1.transition!==null?(Pa===0&&(Pa=_g()),Pa):(t=Y,t!==0||(t=window.event,t=t===void 0?16:Tg(t.type)),t)}function zt(t,e,r,n){if(50<Ro)throw Ro=0,Cd=null,Error(M(185));ts(t,r,n),((Q&2)===0||t!==ve)&&(t===ve&&((Q&2)===0&&(ul|=r),ye===4&&Rr(t,Te)),et(t,n),r===1&&Q===0&&(e.mode&1)===0&&(Li=fe()+500,ol&&Zr()))}function et(t,e){var r=t.callbackNode;Ax(t,e);var n=Fa(t,t===ve?Te:0);if(n===0)r!==null&&Xh(r),t.callbackNode=null,t.callbackPriority=0;else if(e=n&-n,t.callbackPriority!==e){if(r!=null&&Xh(r),e===1)t.tag===0?P1(Wm.bind(null,t)):Vg(Wm.bind(null,t)),T1(function(){(Q&6)===0&&Zr()}),r=null;else{switch(yg(n)){case 1:r=zd;break;case 4:r=mg;break;case 16:r=Oa;break;case 536870912:r=gg;break;default:r=Oa}r=B_(r,F_.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function F_(t,e){if(Ea=-1,Pa=0,(Q&6)!==0)throw Error(M(327));var r=t.callbackNode;if(Ci()&&t.callbackNode!==r)return null;var n=Fa(t,t===ve?Te:0);if(n===0)return null;if((n&30)!==0||(n&t.expiredLanes)!==0||e)e=Za(t,n);else{e=n;var i=Q;Q|=2;var o=L_();(ve!==t||Te!==e)&&(lr=null,Li=fe()+500,yn(t,e));do try{Q1();break}catch(a){N_(t,a)}while(!0);Zd(),Qa.current=o,Q=i,me!==null?e=0:(ve=null,Te=0,e=ye)}if(e!==0){if(e===2&&(i=rd(t),i!==0&&(n=i,e=Id(t,i))),e===1)throw r=es,yn(t,0),Rr(t,n),et(t,fe()),r;if(e===6)Rr(t,n);else{if(i=t.current.alternate,(n&30)===0&&!H1(i)&&(e=Za(t,n),e===2&&(o=rd(t),o!==0&&(n=o,e=Id(t,o))),e===1))throw r=es,yn(t,0),Rr(t,n),et(t,fe()),r;switch(t.finishedWork=i,t.finishedLanes=n,e){case 0:case 1:throw Error(M(345));case 2:hn(t,Je,lr);break;case 3:if(Rr(t,n),(n&130023424)===n&&(e=fp+500-fe(),10<e)){if(Fa(t,0)!==0)break;if(i=t.suspendedLanes,(i&n)!==n){je(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=cd(hn.bind(null,t,Je,lr),e);break}hn(t,Je,lr);break;case 4:if(Rr(t,n),(n&4194240)===n)break;for(e=t.eventTimes,i=-1;0<n;){var s=31-Dt(n);o=1<<s,s=e[s],s>i&&(i=s),n&=~o}if(n=i,n=fe()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*q1(n/1960))-n,10<n){t.timeoutHandle=cd(hn.bind(null,t,Je,lr),n);break}hn(t,Je,lr);break;case 5:hn(t,Je,lr);break;default:throw Error(M(329))}}}return et(t,fe()),t.callbackNode===r?F_.bind(null,t):null}function Id(t,e){var r=Lo;return t.current.memoizedState.isDehydrated&&(yn(t,e).flags|=256),t=Za(t,e),t!==2&&(e=Je,Je=r,e!==null&&Ad(e)),t}function Ad(t){Je===null?Je=t:Je.push.apply(Je,t)}function H1(t){for(var e=t;;){if(e.flags&16384){var r=e.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var i=r[n],o=i.getSnapshot;i=i.value;try{if(!jt(o(),i))return!1}catch{return!1}}}if(r=e.child,e.subtreeFlags&16384&&r!==null)r.return=e,e=r;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Rr(t,e){for(e&=~pp,e&=~ul,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-Dt(e),n=1<<r;t[r]=-1,e&=~n}}function Wm(t){if((Q&6)!==0)throw Error(M(327));Ci();var e=Fa(t,0);if((e&1)===0)return et(t,fe()),null;var r=Za(t,e);if(t.tag!==0&&r===2){var n=rd(t);n!==0&&(e=n,r=Id(t,n))}if(r===1)throw r=es,yn(t,0),Rr(t,e),et(t,fe()),r;if(r===6)throw Error(M(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,hn(t,Je,lr),et(t,fe()),null}function hp(t,e){var r=Q;Q|=1;try{return t(e)}finally{Q=r,Q===0&&(Li=fe()+500,ol&&Zr())}}function Tn(t){zr!==null&&zr.tag===0&&(Q&6)===0&&Ci();var e=Q;Q|=1;var r=vt.transition,n=Y;try{if(vt.transition=null,Y=1,t)return t()}finally{Y=n,vt.transition=r,Q=e,(Q&6)===0&&Zr()}}function mp(){st=Si.current,ie(Si)}function yn(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,S1(r)),me!==null)for(r=me.return;r!==null;){var n=r;switch(Qd(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&za();break;case 3:Fi(),ie(Ze),ie($e),ip();break;case 5:np(n);break;case 4:Fi();break;case 13:ie(ae);break;case 19:ie(ae);break;case 10:Yd(n.type._context);break;case 22:case 23:mp()}r=r.return}if(ve=t,me=t=Hr(t.current,null),Te=st=e,ye=0,es=null,pp=ul=Sn=0,Je=Lo=null,gn!==null){for(e=0;e<gn.length;e++)if(r=gn[e],n=r.interleaved,n!==null){r.interleaved=null;var i=n.next,o=r.pending;if(o!==null){var s=o.next;o.next=i,n.next=s}r.pending=n}gn=null}return t}function N_(t,e){do{var r=me;try{if(Zd(),Ta.current=Ka,Ha){for(var n=le.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}Ha=!1}if(xn=0,we=_e=le=null,Fo=!1,Xo=0,dp.current=null,r===null||r.return===null){ye=1,es=e,me=null;break}e:{var o=t,s=r.return,a=r,l=e;if(e=Te,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=a,d=c.tag;if((c.mode&1)===0&&(d===0||d===11||d===15)){var p=c.alternate;p?(c.updateQueue=p.updateQueue,c.memoizedState=p.memoizedState,c.lanes=p.lanes):(c.updateQueue=null,c.memoizedState=null)}var f=Am(s);if(f!==null){f.flags&=-257,$m(f,s,a,o,e),f.mode&1&&Im(o,u,e),e=f,l=u;var _=e.updateQueue;if(_===null){var w=new Set;w.add(l),e.updateQueue=w}else _.add(l);break e}else{if((e&1)===0){Im(o,u,e),gp();break e}l=Error(M(426))}}else if(se&&a.mode&1){var b=Am(s);if(b!==null){(b.flags&65536)===0&&(b.flags|=256),$m(b,s,a,o,e),Jd(Ni(l,a));break e}}o=l=Ni(l,a),ye!==4&&(ye=2),Lo===null?Lo=[o]:Lo.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var m=y_(o,l,e);Tm(o,m);break e;case 1:a=l;var h=o.type,g=o.stateNode;if((o.flags&128)===0&&(typeof h.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(Gr===null||!Gr.has(g)))){o.flags|=65536,e&=-e,o.lanes|=e;var y=w_(o,a,e);Tm(o,y);break e}}o=o.return}while(o!==null)}D_(r)}catch(v){e=v,me===r&&r!==null&&(me=r=r.return);continue}break}while(!0)}function L_(){var t=Qa.current;return Qa.current=Ka,t===null?Ka:t}function gp(){(ye===0||ye===3||ye===2)&&(ye=4),ve===null||(Sn&268435455)===0&&(ul&268435455)===0||Rr(ve,Te)}function Za(t,e){var r=Q;Q|=2;var n=L_();(ve!==t||Te!==e)&&(lr=null,yn(t,e));do try{K1();break}catch(i){N_(t,i)}while(!0);if(Zd(),Q=r,Qa.current=n,me!==null)throw Error(M(261));return ve=null,Te=0,ye}function K1(){for(;me!==null;)R_(me)}function Q1(){for(;me!==null&&!xx();)R_(me)}function R_(t){var e=j_(t.alternate,t,st);t.memoizedProps=t.pendingProps,e===null?D_(t):me=e,dp.current=null}function D_(t){var e=t;do{var r=e.alternate;if(t=e.return,(e.flags&32768)===0){if(r=B1(r,e,st),r!==null){me=r;return}}else{if(r=U1(r,e),r!==null){r.flags&=32767,me=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{ye=6,me=null;return}}if(e=e.sibling,e!==null){me=e;return}me=e=t}while(e!==null);ye===0&&(ye=5)}function hn(t,e,r){var n=Y,i=vt.transition;try{vt.transition=null,Y=1,J1(t,e,r,n)}finally{vt.transition=i,Y=n}return null}function J1(t,e,r,n){do Ci();while(zr!==null);if((Q&6)!==0)throw Error(M(327));r=t.finishedWork;var i=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(M(177));t.callbackNode=null,t.callbackPriority=0;var o=r.lanes|r.childLanes;if($x(t,o),t===ve&&(me=ve=null,Te=0),(r.subtreeFlags&2064)===0&&(r.flags&2064)===0||wa||(wa=!0,B_(Oa,function(){return Ci(),null})),o=(r.flags&15990)!==0,(r.subtreeFlags&15990)!==0||o){o=vt.transition,vt.transition=null;var s=Y;Y=1;var a=Q;Q|=4,dp.current=null,W1(t,r),$_(r,t),y1(ld),Na=!!ad,ld=ad=null,t.current=r,G1(r,t,i),Sx(),Q=a,Y=s,vt.transition=o}else t.current=r;if(wa&&(wa=!1,zr=t,Xa=i),o=t.pendingLanes,o===0&&(Gr=null),kx(r.stateNode,n),et(t,fe()),e!==null)for(n=t.onRecoverableError,r=0;r<e.length;r++)i=e[r],n(i.value,{componentStack:i.stack,digest:i.digest});if(Ja)throw Ja=!1,t=Pd,Pd=null,t;return(Xa&1)!==0&&t.tag!==0&&Ci(),o=t.pendingLanes,(o&1)!==0?t===Cd?Ro++:(Ro=0,Cd=t):Ro=0,Zr(),null}function Ci(){if(zr!==null){var t=yg(Xa),e=vt.transition,r=Y;try{if(vt.transition=null,Y=16>t?16:t,zr===null)var n=!1;else{if(t=zr,zr=null,Xa=0,(Q&6)!==0)throw Error(M(331));var i=Q;for(Q|=4,F=t.current;F!==null;){var o=F,s=o.child;if((F.flags&16)!==0){var a=o.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(F=u;F!==null;){var c=F;switch(c.tag){case 0:case 11:case 15:No(8,c,o)}var d=c.child;if(d!==null)d.return=c,F=d;else for(;F!==null;){c=F;var p=c.sibling,f=c.return;if(C_(c),c===u){F=null;break}if(p!==null){p.return=f,F=p;break}F=f}}}var _=o.alternate;if(_!==null){var w=_.child;if(w!==null){_.child=null;do{var b=w.sibling;w.sibling=null,w=b}while(w!==null)}}F=o}}if((o.subtreeFlags&2064)!==0&&s!==null)s.return=o,F=s;else e:for(;F!==null;){if(o=F,(o.flags&2048)!==0)switch(o.tag){case 0:case 11:case 15:No(9,o,o.return)}var m=o.sibling;if(m!==null){m.return=o.return,F=m;break e}F=o.return}}var h=t.current;for(F=h;F!==null;){s=F;var g=s.child;if((s.subtreeFlags&2064)!==0&&g!==null)g.return=s,F=g;else e:for(s=h;F!==null;){if(a=F,(a.flags&2048)!==0)try{switch(a.tag){case 0:case 11:case 15:ll(9,a)}}catch(v){ce(a,a.return,v)}if(a===s){F=null;break e}var y=a.sibling;if(y!==null){y.return=a.return,F=y;break e}F=a.return}}if(Q=i,Zr(),Xt&&typeof Xt.onPostCommitFiberRoot=="function")try{Xt.onPostCommitFiberRoot(el,t)}catch{}n=!0}return n}finally{Y=r,vt.transition=e}}return!1}function Gm(t,e,r){e=Ni(r,e),e=y_(t,e,1),t=Wr(t,e,1),e=je(),t!==null&&(ts(t,1,e),et(t,e))}function ce(t,e,r){if(t.tag===3)Gm(t,t,r);else for(;e!==null;){if(e.tag===3){Gm(e,t,r);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Gr===null||!Gr.has(n))){t=Ni(r,t),t=w_(e,t,1),e=Wr(e,t,1),t=je(),e!==null&&(ts(e,1,t),et(e,t));break}}e=e.return}}function X1(t,e,r){var n=t.pingCache;n!==null&&n.delete(e),e=je(),t.pingedLanes|=t.suspendedLanes&r,ve===t&&(Te&r)===r&&(ye===4||ye===3&&(Te&130023424)===Te&&500>fe()-fp?yn(t,0):pp|=r),et(t,e)}function z_(t,e){e===0&&((t.mode&1)===0?e=1:(e=oa,oa<<=1,(oa&130023424)===0&&(oa=4194304)));var r=je();t=mr(t,e),t!==null&&(ts(t,e,r),et(t,r))}function Z1(t){var e=t.memoizedState,r=0;e!==null&&(r=e.retryLane),z_(t,r)}function Y1(t,e){var r=0;switch(t.tag){case 13:var n=t.stateNode,i=t.memoizedState;i!==null&&(r=i.retryLane);break;case 19:n=t.stateNode;break;default:throw Error(M(314))}n!==null&&n.delete(e),z_(t,r)}var j_;j_=function(t,e,r){if(t!==null)if(t.memoizedProps!==e.pendingProps||Ze.current)Xe=!0;else{if((t.lanes&r)===0&&(e.flags&128)===0)return Xe=!1,j1(t,e,r);Xe=(t.flags&131072)!==0}else Xe=!1,se&&(e.flags&1048576)!==0&&Wg(e,Ua,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;ka(t,e),t=e.pendingProps;var i=Ai(e,$e.current);Pi(e,r),i=sp(null,e,n,t,i,r);var o=ap();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ye(n)?(o=!0,ja(e)):o=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,tp(e),i.updater=al,e.stateNode=i,i._reactInternals=e,_d(e,n,t,r),e=vd(null,e,n,!0,o,r)):(e.tag=0,se&&o&&Kd(e),ze(null,e,i,r),e=e.child),e;case 16:n=e.elementType;e:{switch(ka(t,e),t=e.pendingProps,i=n._init,n=i(n._payload),e.type=n,i=e.tag=tS(n),t=Nt(n,t),i){case 0:e=wd(null,e,n,t,r);break e;case 1:e=Nm(null,e,n,t,r);break e;case 11:e=Om(null,e,n,t,r);break e;case 14:e=Fm(null,e,n,Nt(n.type,t),r);break e}throw Error(M(306,n,""))}return e;case 0:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Nt(n,i),wd(t,e,n,i,r);case 1:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Nt(n,i),Nm(t,e,n,i,r);case 3:e:{if(S_(e),t===null)throw Error(M(387));n=e.pendingProps,o=e.memoizedState,i=o.element,Jg(t,e),Ga(e,n,null,r);var s=e.memoizedState;if(n=s.element,o.isDehydrated)if(o={element:n,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){i=Ni(Error(M(423)),e),e=Lm(t,e,n,r,i);break e}else if(n!==i){i=Ni(Error(M(424)),e),e=Lm(t,e,n,r,i);break e}else for(at=Vr(e.stateNode.containerInfo.firstChild),lt=e,se=!0,Rt=null,r=Kg(e,null,n,r),e.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if($i(),n===i){e=gr(t,e,r);break e}ze(t,e,n,r)}e=e.child}return e;case 5:return Xg(e),t===null&&hd(e),n=e.type,i=e.pendingProps,o=t!==null?t.memoizedProps:null,s=i.children,ud(n,i)?s=null:o!==null&&ud(n,o)&&(e.flags|=32),x_(t,e),ze(t,e,s,r),e.child;case 6:return t===null&&hd(e),null;case 13:return T_(t,e,r);case 4:return rp(e,e.stateNode.containerInfo),n=e.pendingProps,t===null?e.child=Oi(e,null,n,r):ze(t,e,n,r),e.child;case 11:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Nt(n,i),Om(t,e,n,i,r);case 7:return ze(t,e,e.pendingProps,r),e.child;case 8:return ze(t,e,e.pendingProps.children,r),e.child;case 12:return ze(t,e,e.pendingProps.children,r),e.child;case 10:e:{if(n=e.type._context,i=e.pendingProps,o=e.memoizedProps,s=i.value,re(Va,n._currentValue),n._currentValue=s,o!==null)if(jt(o.value,s)){if(o.children===i.children&&!Ze.current){e=gr(t,e,r);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var a=o.dependencies;if(a!==null){s=o.child;for(var l=a.firstContext;l!==null;){if(l.context===n){if(o.tag===1){l=pr(-1,r&-r),l.tag=2;var u=o.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}o.lanes|=r,l=o.alternate,l!==null&&(l.lanes|=r),md(o.return,r,e),a.lanes|=r;break}l=l.next}}else if(o.tag===10)s=o.type===e.type?null:o.child;else if(o.tag===18){if(s=o.return,s===null)throw Error(M(341));s.lanes|=r,a=s.alternate,a!==null&&(a.lanes|=r),md(s,r,e),s=o.sibling}else s=o.child;if(s!==null)s.return=o;else for(s=o;s!==null;){if(s===e){s=null;break}if(o=s.sibling,o!==null){o.return=s.return,s=o;break}s=s.return}o=s}ze(t,e,i.children,r),e=e.child}return e;case 9:return i=e.type,n=e.pendingProps.children,Pi(e,r),i=bt(i),n=n(i),e.flags|=1,ze(t,e,n,r),e.child;case 14:return n=e.type,i=Nt(n,e.pendingProps),i=Nt(n.type,i),Fm(t,e,n,i,r);case 15:return v_(t,e,e.type,e.pendingProps,r);case 17:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Nt(n,i),ka(t,e),e.tag=1,Ye(n)?(t=!0,ja(e)):t=!1,Pi(e,r),__(e,n,i),_d(e,n,i,r),vd(null,e,n,!0,t,r);case 19:return M_(t,e,r);case 22:return b_(t,e,r)}throw Error(M(156,e.tag))};function B_(t,e){return hg(t,e)}function eS(t,e,r,n){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function wt(t,e,r,n){return new eS(t,e,r,n)}function _p(t){return t=t.prototype,!(!t||!t.isReactComponent)}function tS(t){if(typeof t=="function")return _p(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Ld)return 11;if(t===Rd)return 14}return 2}function Hr(t,e){var r=t.alternate;return r===null?(r=wt(t.tag,e,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function Ca(t,e,r,n,i,o){var s=2;if(n=t,typeof t=="function")_p(t)&&(s=1);else if(typeof t=="string")s=5;else e:switch(t){case fi:return wn(r.children,i,o,e);case Nd:s=8,i|=8;break;case Bc:return t=wt(12,r,e,i|2),t.elementType=Bc,t.lanes=o,t;case Uc:return t=wt(13,r,e,i),t.elementType=Uc,t.lanes=o,t;case Vc:return t=wt(19,r,e,i),t.elementType=Vc,t.lanes=o,t;case Xm:return cl(r,i,o,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Qm:s=10;break e;case Jm:s=9;break e;case Ld:s=11;break e;case Rd:s=14;break e;case Fr:s=16,n=null;break e}throw Error(M(130,t==null?t:typeof t,""))}return e=wt(s,r,e,i),e.elementType=t,e.type=n,e.lanes=o,e}function wn(t,e,r,n){return t=wt(7,t,n,e),t.lanes=r,t}function cl(t,e,r,n){return t=wt(22,t,n,e),t.elementType=Xm,t.lanes=r,t.stateNode={isHidden:!1},t}function Dc(t,e,r){return t=wt(6,t,null,e),t.lanes=r,t}function zc(t,e,r){return e=wt(4,t.children!==null?t.children:[],t.key,e),e.lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function rS(t,e,r,n,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=xc(0),this.expirationTimes=xc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=xc(0),this.identifierPrefix=n,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function yp(t,e,r,n,i,o,s,a,l){return t=new rS(t,e,r,a,l),e===1?(e=1,o===!0&&(e|=8)):e=0,o=wt(3,null,null,e),t.current=o,o.stateNode=t,o.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},tp(o),t}function nS(t,e,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:pi,key:n==null?null:""+n,children:t,containerInfo:e,implementation:r}}function U_(t){if(!t)return Qr;t=t._reactInternals;e:{if(kn(t)!==t||t.tag!==1)throw Error(M(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Ye(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(M(171))}if(t.tag===1){var r=t.type;if(Ye(r))return Ug(t,r,e)}return e}function V_(t,e,r,n,i,o,s,a,l){return t=yp(r,n,!0,t,i,o,s,a,l),t.context=U_(null),r=t.current,n=je(),i=qr(r),o=pr(n,i),o.callback=e??null,Wr(r,o,i),t.current.lanes=i,ts(t,i,n),et(t,n),t}function dl(t,e,r,n){var i=e.current,o=je(),s=qr(i);return r=U_(r),e.context===null?e.context=r:e.pendingContext=r,e=pr(o,s),e.payload={element:t},n=n===void 0?null:n,n!==null&&(e.callback=n),t=Wr(i,e,s),t!==null&&(zt(t,i,s,o),Sa(t,i,s)),s}function Ya(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function qm(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<e?r:e}}function wp(t,e){qm(t,e),(t=t.alternate)&&qm(t,e)}function iS(){return null}var W_=typeof reportError=="function"?reportError:function(t){console.error(t)};function vp(t){this._internalRoot=t}pl.prototype.render=vp.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(M(409));dl(t,e,null,null)};pl.prototype.unmount=vp.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Tn(function(){dl(null,t,null,null)}),e[hr]=null}};function pl(t){this._internalRoot=t}pl.prototype.unstable_scheduleHydration=function(t){if(t){var e=bg();t={blockedOn:null,target:t,priority:e};for(var r=0;r<Lr.length&&e!==0&&e<Lr[r].priority;r++);Lr.splice(r,0,t),r===0&&Sg(t)}};function bp(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function fl(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Hm(){}function oS(t,e,r,n,i){if(i){if(typeof n=="function"){var o=n;n=function(){var u=Ya(s);o.call(u)}}var s=V_(e,n,t,0,null,!1,!1,"",Hm);return t._reactRootContainer=s,t[hr]=s.current,qo(t.nodeType===8?t.parentNode:t),Tn(),s}for(;i=t.lastChild;)t.removeChild(i);if(typeof n=="function"){var a=n;n=function(){var u=Ya(l);a.call(u)}}var l=yp(t,0,!1,null,null,!1,!1,"",Hm);return t._reactRootContainer=l,t[hr]=l.current,qo(t.nodeType===8?t.parentNode:t),Tn(function(){dl(e,l,r,n)}),l}function hl(t,e,r,n,i){var o=r._reactRootContainer;if(o){var s=o;if(typeof i=="function"){var a=i;i=function(){var l=Ya(s);a.call(l)}}dl(e,s,t,i)}else s=oS(r,e,t,i,n);return Ya(s)}wg=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=Eo(e.pendingLanes);r!==0&&(jd(e,r|1),et(e,fe()),(Q&6)===0&&(Li=fe()+500,Zr()))}break;case 13:Tn(function(){var n=mr(t,1);if(n!==null){var i=je();zt(n,t,1,i)}}),wp(t,1)}};Bd=function(t){if(t.tag===13){var e=mr(t,134217728);if(e!==null){var r=je();zt(e,t,134217728,r)}wp(t,134217728)}};vg=function(t){if(t.tag===13){var e=qr(t),r=mr(t,e);if(r!==null){var n=je();zt(r,t,e,n)}wp(t,e)}};bg=function(){return Y};xg=function(t,e){var r=Y;try{return Y=t,e()}finally{Y=r}};Yc=function(t,e,r){switch(e){case"input":if(qc(t,r),e=r.name,r.type==="radio"&&e!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var n=r[e];if(n!==t&&n.form===t.form){var i=il(n);if(!i)throw Error(M(90));Ym(n),qc(n,i)}}}break;case"textarea":tg(t,r);break;case"select":e=r.value,e!=null&&Ti(t,!!r.multiple,e,!1)}};lg=hp;ug=Tn;var sS={usingClientEntryPoint:!1,Events:[ns,_i,il,sg,ag,hp]},So={findFiberByHostInstance:mn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},aS={bundleType:So.bundleType,version:So.version,rendererPackageName:So.rendererPackageName,rendererConfig:So.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_r.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=pg(t),t===null?null:t.stateNode},findFiberByHostInstance:So.findFiberByHostInstance||iS,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&(To=__REACT_DEVTOOLS_GLOBAL_HOOK__,!To.isDisabled&&To.supportsFiber))try{el=To.inject(aS),Xt=To}catch{}var To;dt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sS;dt.createPortal=function(t,e){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!bp(e))throw Error(M(200));return nS(t,e,null,r)};dt.createRoot=function(t,e){if(!bp(t))throw Error(M(299));var r=!1,n="",i=W_;return e!=null&&(e.unstable_strictMode===!0&&(r=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=yp(t,1,!1,null,null,r,!1,n,i),t[hr]=e.current,qo(t.nodeType===8?t.parentNode:t),new vp(e)};dt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(M(188)):(t=Object.keys(t).join(","),Error(M(268,t)));return t=pg(e),t=t===null?null:t.stateNode,t};dt.flushSync=function(t){return Tn(t)};dt.hydrate=function(t,e,r){if(!fl(e))throw Error(M(200));return hl(null,t,e,!0,r)};dt.hydrateRoot=function(t,e,r){if(!bp(t))throw Error(M(405));var n=r!=null&&r.hydratedSources||null,i=!1,o="",s=W_;if(r!=null&&(r.unstable_strictMode===!0&&(i=!0),r.identifierPrefix!==void 0&&(o=r.identifierPrefix),r.onRecoverableError!==void 0&&(s=r.onRecoverableError)),e=V_(e,null,t,1,r??null,i,!1,o,s),t[hr]=e.current,qo(t),n)for(t=0;t<n.length;t++)r=n[t],i=r._getVersion,i=i(r._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[r,i]:e.mutableSourceEagerHydrationData.push(r,i);return new pl(e)};dt.render=function(t,e,r){if(!fl(e))throw Error(M(200));return hl(null,t,e,!1,r)};dt.unmountComponentAtNode=function(t){if(!fl(t))throw Error(M(40));return t._reactRootContainer?(Tn(function(){hl(null,null,t,!1,function(){t._reactRootContainer=null,t[hr]=null})}),!0):!1};dt.unstable_batchedUpdates=hp;dt.unstable_renderSubtreeIntoContainer=function(t,e,r,n){if(!fl(r))throw Error(M(200));if(t==null||t._reactInternals===void 0)throw Error(M(38));return hl(t,e,r,!1,n)};dt.version="18.3.1-next-f1338f8080-20240426"});var K_=I((VC,H_)=>{"use strict";function q_(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(q_)}catch(t){console.error(t)}}q_(),H_.exports=G_()});var J_=I(xp=>{"use strict";var Q_=K_();xp.createRoot=Q_.createRoot,xp.hydrateRoot=Q_.hydrateRoot;var WC});var Y_=I(ml=>{"use strict";var lS=fo(),uS=Symbol.for("react.element"),cS=Symbol.for("react.fragment"),dS=Object.prototype.hasOwnProperty,pS=lS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,fS={key:!0,ref:!0,__self:!0,__source:!0};function Z_(t,e,r){var n,i={},o=null,s=null;r!==void 0&&(o=""+r),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(s=e.ref);for(n in e)dS.call(e,n)&&!fS.hasOwnProperty(n)&&(i[n]=e[n]);if(t&&t.defaultProps)for(n in e=t.defaultProps,e)i[n]===void 0&&(i[n]=e[n]);return{$$typeof:uS,type:t,key:o,ref:s,props:i,_owner:pS.current}}ml.Fragment=cS;ml.jsx=Z_;ml.jsxs=Z_});var Sp=I((KC,ey)=>{"use strict";ey.exports=Y_()});var Ny=I((BA,Fy)=>{function Mt(t,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}Fy.exports=Mt;Mt.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};Mt.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};Mt.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=new Date().getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(t),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var r=this._timeouts.shift();if(r===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},r),this._options.unref&&this._timer.unref(),!0};Mt.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};Mt.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)};Mt.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)};Mt.prototype.start=Mt.prototype.try;Mt.prototype.errors=function(){return this._errors};Mt.prototype.attempts=function(){return this._attempts};Mt.prototype.mainError=function(){if(this._errors.length===0)return null;for(var t={},e=null,r=0,n=0;n<this._errors.length;n++){var i=this._errors[n],o=i.message,s=(t[o]||0)+1;t[o]=s,s>=r&&(e=i,r=s)}return e}});var Ly=I(Hn=>{var NT=Ny();Hn.operation=function(t){var e=Hn.timeouts(t);return new NT(e,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})};Hn.timeouts=function(t){if(t instanceof Array)return[].concat(t);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var r in t)e[r]=t[r];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],i=0;i<e.retries;i++)n.push(this.createTimeout(i,e));return t&&t.forever&&!n.length&&n.push(this.createTimeout(i,e)),n.sort(function(o,s){return o-s}),n};Hn.createTimeout=function(t,e){var r=e.randomize?Math.random()+1:1,n=Math.round(r*Math.max(e.minTimeout,1)*Math.pow(e.factor,t));return n=Math.min(n,e.maxTimeout),n};Hn.wrap=function(t,e,r){if(e instanceof Array&&(r=e,e=null),!r){r=[];for(var n in t)typeof t[n]=="function"&&r.push(n)}for(var i=0;i<r.length;i++){var o=r[i],s=t[o];t[o]=function(l){var u=Hn.operation(e),c=Array.prototype.slice.call(arguments,1),d=c.pop();c.push(function(p){u.retry(p)||(p&&(arguments[0]=u.mainError()),d.apply(this,arguments))}),u.attempt(function(){l.apply(t,c)})}.bind(t,s),t[o].options=e}}});var Dy=I((VA,Ry)=>{Ry.exports=Ly()});var Wl=I((WA,Vl)=>{"use strict";var LT=Dy(),RT=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],Ul=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}},DT=(t,e,r)=>{let n=r.retries-(e-1);return t.attemptNumber=e,t.retriesLeft=n,t},zT=t=>RT.includes(t),zy=(t,e)=>new Promise((r,n)=>{e={onFailedAttempt:()=>{},retries:10,...e};let i=LT.operation(e);i.attempt(async o=>{try{r(await t(o))}catch(s){if(!(s instanceof Error)){n(new TypeError(`Non-error was thrown: "${s}". You should only throw errors.`));return}if(s instanceof Ul)i.stop(),n(s.originalError);else if(s instanceof TypeError&&!zT(s.message))i.stop(),n(s);else{DT(s,o,e);try{await e.onFailedAttempt(s)}catch(a){n(a);return}i.retry(s)||n(i.mainError())}}})});Vl.exports=zy;Vl.exports.default=zy;Vl.exports.AbortError=Ul});var Vy=I((n2,jp)=>{"use strict";var WT=Object.prototype.hasOwnProperty,We="~";function gs(){}Object.create&&(gs.prototype=Object.create(null),new gs().__proto__||(We=!1));function GT(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function Uy(t,e,r,n,i){if(typeof r!="function")throw new TypeError("The listener must be a function");var o=new GT(r,n||t,i),s=We?We+e:e;return t._events[s]?t._events[s].fn?t._events[s]=[t._events[s],o]:t._events[s].push(o):(t._events[s]=o,t._eventsCount++),t}function Kl(t,e){--t._eventsCount===0?t._events=new gs:delete t._events[e]}function Fe(){this._events=new gs,this._eventsCount=0}Fe.prototype.eventNames=function(){var e=[],r,n;if(this._eventsCount===0)return e;for(n in r=this._events)WT.call(r,n)&&e.push(We?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(r)):e};Fe.prototype.listeners=function(e){var r=We?We+e:e,n=this._events[r];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,s=new Array(o);i<o;i++)s[i]=n[i].fn;return s};Fe.prototype.listenerCount=function(e){var r=We?We+e:e,n=this._events[r];return n?n.fn?1:n.length:0};Fe.prototype.emit=function(e,r,n,i,o,s){var a=We?We+e:e;if(!this._events[a])return!1;var l=this._events[a],u=arguments.length,c,d;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,r),!0;case 3:return l.fn.call(l.context,r,n),!0;case 4:return l.fn.call(l.context,r,n,i),!0;case 5:return l.fn.call(l.context,r,n,i,o),!0;case 6:return l.fn.call(l.context,r,n,i,o,s),!0}for(d=1,c=new Array(u-1);d<u;d++)c[d-1]=arguments[d];l.fn.apply(l.context,c)}else{var p=l.length,f;for(d=0;d<p;d++)switch(l[d].once&&this.removeListener(e,l[d].fn,void 0,!0),u){case 1:l[d].fn.call(l[d].context);break;case 2:l[d].fn.call(l[d].context,r);break;case 3:l[d].fn.call(l[d].context,r,n);break;case 4:l[d].fn.call(l[d].context,r,n,i);break;default:if(!c)for(f=1,c=new Array(u-1);f<u;f++)c[f-1]=arguments[f];l[d].fn.apply(l[d].context,c)}}return!0};Fe.prototype.on=function(e,r,n){return Uy(this,e,r,n,!1)};Fe.prototype.once=function(e,r,n){return Uy(this,e,r,n,!0)};Fe.prototype.removeListener=function(e,r,n,i){var o=We?We+e:e;if(!this._events[o])return this;if(!r)return Kl(this,o),this;var s=this._events[o];if(s.fn)s.fn===r&&(!i||s.once)&&(!n||s.context===n)&&Kl(this,o);else{for(var a=0,l=[],u=s.length;a<u;a++)(s[a].fn!==r||i&&!s[a].once||n&&s[a].context!==n)&&l.push(s[a]);l.length?this._events[o]=l.length===1?l[0]:l:Kl(this,o)}return this};Fe.prototype.removeAllListeners=function(e){var r;return e?(r=We?We+e:e,this._events[r]&&Kl(this,r)):(this._events=new gs,this._eventsCount=0),this};Fe.prototype.off=Fe.prototype.removeListener;Fe.prototype.addListener=Fe.prototype.on;Fe.prefixed=We;Fe.EventEmitter=Fe;typeof jp<"u"&&(jp.exports=Fe)});var Gy=I((i2,Wy)=>{"use strict";Wy.exports=(t,e)=>(e=e||(()=>{}),t.then(r=>new Promise(n=>{n(e())}).then(()=>r),r=>new Promise(n=>{n(e())}).then(()=>{throw r})))});var Hy=I((o2,Jl)=>{"use strict";var qT=Gy(),Ql=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},qy=(t,e,r)=>new Promise((n,i)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){n(t);return}let o=setTimeout(()=>{if(typeof r=="function"){try{n(r())}catch(l){i(l)}return}let s=typeof r=="string"?r:`Promise timed out after ${e} milliseconds`,a=r instanceof Error?r:new Ql(s);typeof t.cancel=="function"&&t.cancel(),i(a)},e);qT(t.then(n,i),()=>{clearTimeout(o)})});Jl.exports=qy;Jl.exports.default=qy;Jl.exports.TimeoutError=Ql});var Ky=I(Bp=>{"use strict";Object.defineProperty(Bp,"__esModule",{value:!0});function HT(t,e,r){let n=0,i=t.length;for(;i>0;){let o=i/2|0,s=n+o;r(t[s],e)<=0?(n=++s,i-=o+1):i=o}return n}Bp.default=HT});var Qy=I(Vp=>{"use strict";Object.defineProperty(Vp,"__esModule",{value:!0});var KT=Ky(),Up=class{constructor(){this._queue=[]}enqueue(e,r){r=Object.assign({priority:0},r);let n={priority:r.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=r.priority){this._queue.push(n);return}let i=KT.default(this._queue,n,(o,s)=>s.priority-o.priority);this._queue.splice(i,0,n)}dequeue(){let e=this._queue.shift();return e?.run}filter(e){return this._queue.filter(r=>r.priority===e.priority).map(r=>r.run)}get size(){return this._queue.length}};Vp.default=Up});var Zl=I(Gp=>{"use strict";Object.defineProperty(Gp,"__esModule",{value:!0});var QT=Vy(),Jy=Hy(),JT=Qy(),Xl=()=>{},XT=new Jy.TimeoutError,Wp=class extends QT{constructor(e){var r,n,i,o;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=Xl,this._resolveIdle=Xl,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:JT.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(r=e.intervalCap)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(o=(i=e.interval)===null||i===void 0?void 0:i.toString())!==null&&o!==void 0?o:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=Xl,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=Xl,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(this._intervalId===void 0){let r=this._intervalEnd-e;if(r<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},r)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let r=this._queue.dequeue();return r?(this.emit("active"),r(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,r={}){return new Promise((n,i)=>{let o=async()=>{this._pendingCount++,this._intervalCount++;try{let s=this._timeout===void 0&&r.timeout===void 0?e():Jy.default(Promise.resolve(e()),r.timeout===void 0?this._timeout:r.timeout,()=>{(r.throwOnTimeout===void 0?this._throwOnTimeout:r.throwOnTimeout)&&i(XT)});n(await s)}catch(s){i(s)}this._next()};this._queue.enqueue(o,r),this._tryToStartAnother(),this.emit("add")})}async addAll(e,r){return Promise.all(e.map(async n=>this.add(n,r)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{let r=this._resolveEmpty;this._resolveEmpty=()=>{r(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{let r=this._resolveIdle;this._resolveIdle=()=>{r(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}};Gp.default=Wp});var ys=I((m2,Yy)=>{"use strict";var rM="2.0.0",nM=Number.MAX_SAFE_INTEGER||9007199254740991,iM=16,oM=250,sM=["major","premajor","minor","preminor","patch","prepatch","prerelease"];Yy.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:iM,MAX_SAFE_BUILD_LENGTH:oM,MAX_SAFE_INTEGER:nM,RELEASE_TYPES:sM,SEMVER_SPEC_VERSION:rM,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var ws=I((g2,ew)=>{"use strict";var aM=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};ew.exports=aM});var eo=I((rr,tw)=>{"use strict";var{MAX_SAFE_COMPONENT_LENGTH:Kp,MAX_SAFE_BUILD_LENGTH:lM,MAX_LENGTH:uM}=ys(),cM=ws();rr=tw.exports={};var dM=rr.re=[],pM=rr.safeRe=[],$=rr.src=[],fM=rr.safeSrc=[],O=rr.t={},hM=0,Qp="[a-zA-Z0-9-]",mM=[["\\s",1],["\\d",uM],[Qp,lM]],gM=t=>{for(let[e,r]of mM)t=t.split(`${e}*`).join(`${e}{0,${r}}`).split(`${e}+`).join(`${e}{1,${r}}`);return t},j=(t,e,r)=>{let n=gM(e),i=hM++;cM(t,i,e),O[t]=i,$[i]=e,fM[i]=n,dM[i]=new RegExp(e,r?"g":void 0),pM[i]=new RegExp(n,r?"g":void 0)};j("NUMERICIDENTIFIER","0|[1-9]\\d*");j("NUMERICIDENTIFIERLOOSE","\\d+");j("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${Qp}*`);j("MAINVERSION",`(${$[O.NUMERICIDENTIFIER]})\\.(${$[O.NUMERICIDENTIFIER]})\\.(${$[O.NUMERICIDENTIFIER]})`);j("MAINVERSIONLOOSE",`(${$[O.NUMERICIDENTIFIERLOOSE]})\\.(${$[O.NUMERICIDENTIFIERLOOSE]})\\.(${$[O.NUMERICIDENTIFIERLOOSE]})`);j("PRERELEASEIDENTIFIER",`(?:${$[O.NONNUMERICIDENTIFIER]}|${$[O.NUMERICIDENTIFIER]})`);j("PRERELEASEIDENTIFIERLOOSE",`(?:${$[O.NONNUMERICIDENTIFIER]}|${$[O.NUMERICIDENTIFIERLOOSE]})`);j("PRERELEASE",`(?:-(${$[O.PRERELEASEIDENTIFIER]}(?:\\.${$[O.PRERELEASEIDENTIFIER]})*))`);j("PRERELEASELOOSE",`(?:-?(${$[O.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${$[O.PRERELEASEIDENTIFIERLOOSE]})*))`);j("BUILDIDENTIFIER",`${Qp}+`);j("BUILD",`(?:\\+(${$[O.BUILDIDENTIFIER]}(?:\\.${$[O.BUILDIDENTIFIER]})*))`);j("FULLPLAIN",`v?${$[O.MAINVERSION]}${$[O.PRERELEASE]}?${$[O.BUILD]}?`);j("FULL",`^${$[O.FULLPLAIN]}$`);j("LOOSEPLAIN",`[v=\\s]*${$[O.MAINVERSIONLOOSE]}${$[O.PRERELEASELOOSE]}?${$[O.BUILD]}?`);j("LOOSE",`^${$[O.LOOSEPLAIN]}$`);j("GTLT","((?:<|>)?=?)");j("XRANGEIDENTIFIERLOOSE",`${$[O.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);j("XRANGEIDENTIFIER",`${$[O.NUMERICIDENTIFIER]}|x|X|\\*`);j("XRANGEPLAIN",`[v=\\s]*(${$[O.XRANGEIDENTIFIER]})(?:\\.(${$[O.XRANGEIDENTIFIER]})(?:\\.(${$[O.XRANGEIDENTIFIER]})(?:${$[O.PRERELEASE]})?${$[O.BUILD]}?)?)?`);j("XRANGEPLAINLOOSE",`[v=\\s]*(${$[O.XRANGEIDENTIFIERLOOSE]})(?:\\.(${$[O.XRANGEIDENTIFIERLOOSE]})(?:\\.(${$[O.XRANGEIDENTIFIERLOOSE]})(?:${$[O.PRERELEASELOOSE]})?${$[O.BUILD]}?)?)?`);j("XRANGE",`^${$[O.GTLT]}\\s*${$[O.XRANGEPLAIN]}$`);j("XRANGELOOSE",`^${$[O.GTLT]}\\s*${$[O.XRANGEPLAINLOOSE]}$`);j("COERCEPLAIN",`(^|[^\\d])(\\d{1,${Kp}})(?:\\.(\\d{1,${Kp}}))?(?:\\.(\\d{1,${Kp}}))?`);j("COERCE",`${$[O.COERCEPLAIN]}(?:$|[^\\d])`);j("COERCEFULL",$[O.COERCEPLAIN]+`(?:${$[O.PRERELEASE]})?(?:${$[O.BUILD]})?(?:$|[^\\d])`);j("COERCERTL",$[O.COERCE],!0);j("COERCERTLFULL",$[O.COERCEFULL],!0);j("LONETILDE","(?:~>?)");j("TILDETRIM",`(\\s*)${$[O.LONETILDE]}\\s+`,!0);rr.tildeTrimReplace="$1~";j("TILDE",`^${$[O.LONETILDE]}${$[O.XRANGEPLAIN]}$`);j("TILDELOOSE",`^${$[O.LONETILDE]}${$[O.XRANGEPLAINLOOSE]}$`);j("LONECARET","(?:\\^)");j("CARETTRIM",`(\\s*)${$[O.LONECARET]}\\s+`,!0);rr.caretTrimReplace="$1^";j("CARET",`^${$[O.LONECARET]}${$[O.XRANGEPLAIN]}$`);j("CARETLOOSE",`^${$[O.LONECARET]}${$[O.XRANGEPLAINLOOSE]}$`);j("COMPARATORLOOSE",`^${$[O.GTLT]}\\s*(${$[O.LOOSEPLAIN]})$|^$`);j("COMPARATOR",`^${$[O.GTLT]}\\s*(${$[O.FULLPLAIN]})$|^$`);j("COMPARATORTRIM",`(\\s*)${$[O.GTLT]}\\s*(${$[O.LOOSEPLAIN]}|${$[O.XRANGEPLAIN]})`,!0);rr.comparatorTrimReplace="$1$2$3";j("HYPHENRANGE",`^\\s*(${$[O.XRANGEPLAIN]})\\s+-\\s+(${$[O.XRANGEPLAIN]})\\s*$`);j("HYPHENRANGELOOSE",`^\\s*(${$[O.XRANGEPLAINLOOSE]})\\s+-\\s+(${$[O.XRANGEPLAINLOOSE]})\\s*$`);j("STAR","(<|>)?=?\\s*\\*");j("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");j("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var tu=I((_2,rw)=>{"use strict";var _M=Object.freeze({loose:!0}),yM=Object.freeze({}),wM=t=>t?typeof t!="object"?_M:t:yM;rw.exports=wM});var Jp=I((y2,ow)=>{"use strict";var nw=/^[0-9]+$/,iw=(t,e)=>{let r=nw.test(t),n=nw.test(e);return r&&n&&(t=+t,e=+e),t===e?0:r&&!n?-1:n&&!r?1:t<e?-1:1},vM=(t,e)=>iw(e,t);ow.exports={compareIdentifiers:iw,rcompareIdentifiers:vM}});var Ne=I((w2,aw)=>{"use strict";var ru=ws(),{MAX_LENGTH:sw,MAX_SAFE_INTEGER:nu}=ys(),{safeRe:iu,t:ou}=eo(),bM=tu(),{compareIdentifiers:to}=Jp(),Xp=class t{constructor(e,r){if(r=bM(r),e instanceof t){if(e.loose===!!r.loose&&e.includePrerelease===!!r.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>sw)throw new TypeError(`version is longer than ${sw} characters`);ru("SemVer",e,r),this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease;let n=e.trim().match(r.loose?iu[ou.LOOSE]:iu[ou.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>nu||this.major<0)throw new TypeError("Invalid major version");if(this.minor>nu||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>nu||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){let o=+i;if(o>=0&&o<nu)return o}return i}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(ru("SemVer.compare",this.version,this.options,e),!(e instanceof t)){if(typeof e=="string"&&e===this.version)return 0;e=new t(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof t||(e=new t(e,this.options)),to(this.major,e.major)||to(this.minor,e.minor)||to(this.patch,e.patch)}comparePre(e){if(e instanceof t||(e=new t(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let r=0;do{let n=this.prerelease[r],i=e.prerelease[r];if(ru("prerelease compare",r,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return to(n,i)}while(++r)}compareBuild(e){e instanceof t||(e=new t(e,this.options));let r=0;do{let n=this.build[r],i=e.build[r];if(ru("build compare",r,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return to(n,i)}while(++r)}inc(e,r,n){if(e.startsWith("pre")){if(!r&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(r){let i=`-${r}`.match(this.options.loose?iu[ou.PRERELEASELOOSE]:iu[ou.PRERELEASE]);if(!i||i[1]!==r)throw new Error(`invalid identifier: ${r}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",r,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",r,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",r,n),this.inc("pre",r,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",r,n),this.inc("pre",r,n);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let i=Number(n)?1:0;if(this.prerelease.length===0)this.prerelease=[i];else{let o=this.prerelease.length;for(;--o>=0;)typeof this.prerelease[o]=="number"&&(this.prerelease[o]++,o=-2);if(o===-1){if(r===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(r){let o=[r,i];n===!1&&(o=[r]),to(this.prerelease[0],r)===0?isNaN(this.prerelease[1])&&(this.prerelease=o):this.prerelease=o}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};aw.exports=Xp});var Kn=I((v2,uw)=>{"use strict";var lw=Ne(),xM=(t,e,r=!1)=>{if(t instanceof lw)return t;try{return new lw(t,e)}catch(n){if(!r)return null;throw n}};uw.exports=xM});var dw=I((b2,cw)=>{"use strict";var SM=Kn(),TM=(t,e)=>{let r=SM(t,e);return r?r.version:null};cw.exports=TM});var fw=I((x2,pw)=>{"use strict";var MM=Kn(),kM=(t,e)=>{let r=MM(t.trim().replace(/^[=v]+/,""),e);return r?r.version:null};pw.exports=kM});var gw=I((S2,mw)=>{"use strict";var hw=Ne(),EM=(t,e,r,n,i)=>{typeof r=="string"&&(i=n,n=r,r=void 0);try{return new hw(t instanceof hw?t.version:t,r).inc(e,n,i).version}catch{return null}};mw.exports=EM});var ww=I((T2,yw)=>{"use strict";var _w=Kn(),PM=(t,e)=>{let r=_w(t,null,!0),n=_w(e,null,!0),i=r.compare(n);if(i===0)return null;let o=i>0,s=o?r:n,a=o?n:r,l=!!s.prerelease.length;if(!!a.prerelease.length&&!l){if(!a.patch&&!a.minor)return"major";if(a.compareMain(s)===0)return a.minor&&!a.patch?"minor":"patch"}let c=l?"pre":"";return r.major!==n.major?c+"major":r.minor!==n.minor?c+"minor":r.patch!==n.patch?c+"patch":"prerelease"};yw.exports=PM});var bw=I((M2,vw)=>{"use strict";var CM=Ne(),IM=(t,e)=>new CM(t,e).major;vw.exports=IM});var Sw=I((k2,xw)=>{"use strict";var AM=Ne(),$M=(t,e)=>new AM(t,e).minor;xw.exports=$M});var Mw=I((E2,Tw)=>{"use strict";var OM=Ne(),FM=(t,e)=>new OM(t,e).patch;Tw.exports=FM});var Ew=I((P2,kw)=>{"use strict";var NM=Kn(),LM=(t,e)=>{let r=NM(t,e);return r&&r.prerelease.length?r.prerelease:null};kw.exports=LM});var kt=I((C2,Cw)=>{"use strict";var Pw=Ne(),RM=(t,e,r)=>new Pw(t,r).compare(new Pw(e,r));Cw.exports=RM});var Aw=I((I2,Iw)=>{"use strict";var DM=kt(),zM=(t,e,r)=>DM(e,t,r);Iw.exports=zM});var Ow=I((A2,$w)=>{"use strict";var jM=kt(),BM=(t,e)=>jM(t,e,!0);$w.exports=BM});var su=I(($2,Nw)=>{"use strict";var Fw=Ne(),UM=(t,e,r)=>{let n=new Fw(t,r),i=new Fw(e,r);return n.compare(i)||n.compareBuild(i)};Nw.exports=UM});var Rw=I((O2,Lw)=>{"use strict";var VM=su(),WM=(t,e)=>t.sort((r,n)=>VM(r,n,e));Lw.exports=WM});var zw=I((F2,Dw)=>{"use strict";var GM=su(),qM=(t,e)=>t.sort((r,n)=>GM(n,r,e));Dw.exports=qM});var vs=I((N2,jw)=>{"use strict";var HM=kt(),KM=(t,e,r)=>HM(t,e,r)>0;jw.exports=KM});var au=I((L2,Bw)=>{"use strict";var QM=kt(),JM=(t,e,r)=>QM(t,e,r)<0;Bw.exports=JM});var Zp=I((R2,Uw)=>{"use strict";var XM=kt(),ZM=(t,e,r)=>XM(t,e,r)===0;Uw.exports=ZM});var Yp=I((D2,Vw)=>{"use strict";var YM=kt(),ek=(t,e,r)=>YM(t,e,r)!==0;Vw.exports=ek});var lu=I((z2,Ww)=>{"use strict";var tk=kt(),rk=(t,e,r)=>tk(t,e,r)>=0;Ww.exports=rk});var uu=I((j2,Gw)=>{"use strict";var nk=kt(),ik=(t,e,r)=>nk(t,e,r)<=0;Gw.exports=ik});var ef=I((B2,qw)=>{"use strict";var ok=Zp(),sk=Yp(),ak=vs(),lk=lu(),uk=au(),ck=uu(),dk=(t,e,r,n)=>{switch(e){case"===":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t===r;case"!==":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t!==r;case"":case"=":case"==":return ok(t,r,n);case"!=":return sk(t,r,n);case">":return ak(t,r,n);case">=":return lk(t,r,n);case"<":return uk(t,r,n);case"<=":return ck(t,r,n);default:throw new TypeError(`Invalid operator: ${e}`)}};qw.exports=dk});var Kw=I((U2,Hw)=>{"use strict";var pk=Ne(),fk=Kn(),{safeRe:cu,t:du}=eo(),hk=(t,e)=>{if(t instanceof pk)return t;if(typeof t=="number"&&(t=String(t)),typeof t!="string")return null;e=e||{};let r=null;if(!e.rtl)r=t.match(e.includePrerelease?cu[du.COERCEFULL]:cu[du.COERCE]);else{let l=e.includePrerelease?cu[du.COERCERTLFULL]:cu[du.COERCERTL],u;for(;(u=l.exec(t))&&(!r||r.index+r[0].length!==t.length);)(!r||u.index+u[0].length!==r.index+r[0].length)&&(r=u),l.lastIndex=u.index+u[1].length+u[2].length;l.lastIndex=-1}if(r===null)return null;let n=r[2],i=r[3]||"0",o=r[4]||"0",s=e.includePrerelease&&r[5]?`-${r[5]}`:"",a=e.includePrerelease&&r[6]?`+${r[6]}`:"";return fk(`${n}.${i}.${o}${s}${a}`,e)};Hw.exports=hk});var Jw=I((V2,Qw)=>{"use strict";var tf=class{constructor(){this.max=1e3,this.map=new Map}get(e){let r=this.map.get(e);if(r!==void 0)return this.map.delete(e),this.map.set(e,r),r}delete(e){return this.map.delete(e)}set(e,r){if(!this.delete(e)&&r!==void 0){if(this.map.size>=this.max){let i=this.map.keys().next().value;this.delete(i)}this.map.set(e,r)}return this}};Qw.exports=tf});var Et=I((W2,ev)=>{"use strict";var mk=/\s+/g,rf=class t{constructor(e,r){if(r=_k(r),e instanceof t)return e.loose===!!r.loose&&e.includePrerelease===!!r.includePrerelease?e:new t(e.raw,r);if(e instanceof nf)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease,this.raw=e.trim().replace(mk," "),this.set=this.raw.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(i=>!Zw(i[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let i of this.set)if(i.length===1&&Tk(i[0])){this.set=[i];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let r=this.set[e];for(let n=0;n<r.length;n++)n>0&&(this.formatted+=" "),this.formatted+=r[n].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let n=((this.options.includePrerelease&&xk)|(this.options.loose&&Sk))+":"+e,i=Xw.get(n);if(i)return i;let o=this.options.loose,s=o?nt[Ge.HYPHENRANGELOOSE]:nt[Ge.HYPHENRANGE];e=e.replace(s,Fk(this.options.includePrerelease)),oe("hyphen replace",e),e=e.replace(nt[Ge.COMPARATORTRIM],wk),oe("comparator trim",e),e=e.replace(nt[Ge.TILDETRIM],vk),oe("tilde trim",e),e=e.replace(nt[Ge.CARETTRIM],bk),oe("caret trim",e);let a=e.split(" ").map(d=>Mk(d,this.options)).join(" ").split(/\s+/).map(d=>Ok(d,this.options));o&&(a=a.filter(d=>(oe("loose invalid filter",d,this.options),!!d.match(nt[Ge.COMPARATORLOOSE])))),oe("range list",a);let l=new Map,u=a.map(d=>new nf(d,this.options));for(let d of u){if(Zw(d))return[d];l.set(d.value,d)}l.size>1&&l.has("")&&l.delete("");let c=[...l.values()];return Xw.set(n,c),c}intersects(e,r){if(!(e instanceof t))throw new TypeError("a Range is required");return this.set.some(n=>Yw(n,r)&&e.set.some(i=>Yw(i,r)&&n.every(o=>i.every(s=>o.intersects(s,r)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new yk(e,this.options)}catch{return!1}for(let r=0;r<this.set.length;r++)if(Nk(this.set[r],e,this.options))return!0;return!1}};ev.exports=rf;var gk=Jw(),Xw=new gk,_k=tu(),nf=bs(),oe=ws(),yk=Ne(),{safeRe:nt,t:Ge,comparatorTrimReplace:wk,tildeTrimReplace:vk,caretTrimReplace:bk}=eo(),{FLAG_INCLUDE_PRERELEASE:xk,FLAG_LOOSE:Sk}=ys(),Zw=t=>t.value==="<0.0.0-0",Tk=t=>t.value==="",Yw=(t,e)=>{let r=!0,n=t.slice(),i=n.pop();for(;r&&n.length;)r=n.every(o=>i.intersects(o,e)),i=n.pop();return r},Mk=(t,e)=>(oe("comp",t,e),t=Pk(t,e),oe("caret",t),t=kk(t,e),oe("tildes",t),t=Ik(t,e),oe("xrange",t),t=$k(t,e),oe("stars",t),t),qe=t=>!t||t.toLowerCase()==="x"||t==="*",kk=(t,e)=>t.trim().split(/\s+/).map(r=>Ek(r,e)).join(" "),Ek=(t,e)=>{let r=e.loose?nt[Ge.TILDELOOSE]:nt[Ge.TILDE];return t.replace(r,(n,i,o,s,a)=>{oe("tilde",t,n,i,o,s,a);let l;return qe(i)?l="":qe(o)?l=`>=${i}.0.0 <${+i+1}.0.0-0`:qe(s)?l=`>=${i}.${o}.0 <${i}.${+o+1}.0-0`:a?(oe("replaceTilde pr",a),l=`>=${i}.${o}.${s}-${a} <${i}.${+o+1}.0-0`):l=`>=${i}.${o}.${s} <${i}.${+o+1}.0-0`,oe("tilde return",l),l})},Pk=(t,e)=>t.trim().split(/\s+/).map(r=>Ck(r,e)).join(" "),Ck=(t,e)=>{oe("caret",t,e);let r=e.loose?nt[Ge.CARETLOOSE]:nt[Ge.CARET],n=e.includePrerelease?"-0":"";return t.replace(r,(i,o,s,a,l)=>{oe("caret",t,i,o,s,a,l);let u;return qe(o)?u="":qe(s)?u=`>=${o}.0.0${n} <${+o+1}.0.0-0`:qe(a)?o==="0"?u=`>=${o}.${s}.0${n} <${o}.${+s+1}.0-0`:u=`>=${o}.${s}.0${n} <${+o+1}.0.0-0`:l?(oe("replaceCaret pr",l),o==="0"?s==="0"?u=`>=${o}.${s}.${a}-${l} <${o}.${s}.${+a+1}-0`:u=`>=${o}.${s}.${a}-${l} <${o}.${+s+1}.0-0`:u=`>=${o}.${s}.${a}-${l} <${+o+1}.0.0-0`):(oe("no pr"),o==="0"?s==="0"?u=`>=${o}.${s}.${a}${n} <${o}.${s}.${+a+1}-0`:u=`>=${o}.${s}.${a}${n} <${o}.${+s+1}.0-0`:u=`>=${o}.${s}.${a} <${+o+1}.0.0-0`),oe("caret return",u),u})},Ik=(t,e)=>(oe("replaceXRanges",t,e),t.split(/\s+/).map(r=>Ak(r,e)).join(" ")),Ak=(t,e)=>{t=t.trim();let r=e.loose?nt[Ge.XRANGELOOSE]:nt[Ge.XRANGE];return t.replace(r,(n,i,o,s,a,l)=>{oe("xRange",t,n,i,o,s,a,l);let u=qe(o),c=u||qe(s),d=c||qe(a),p=d;return i==="="&&p&&(i=""),l=e.includePrerelease?"-0":"",u?i===">"||i==="<"?n="<0.0.0-0":n="*":i&&p?(c&&(s=0),a=0,i===">"?(i=">=",c?(o=+o+1,s=0,a=0):(s=+s+1,a=0)):i==="<="&&(i="<",c?o=+o+1:s=+s+1),i==="<"&&(l="-0"),n=`${i+o}.${s}.${a}${l}`):c?n=`>=${o}.0.0${l} <${+o+1}.0.0-0`:d&&(n=`>=${o}.${s}.0${l} <${o}.${+s+1}.0-0`),oe("xRange return",n),n})},$k=(t,e)=>(oe("replaceStars",t,e),t.trim().replace(nt[Ge.STAR],"")),Ok=(t,e)=>(oe("replaceGTE0",t,e),t.trim().replace(nt[e.includePrerelease?Ge.GTE0PRE:Ge.GTE0],"")),Fk=t=>(e,r,n,i,o,s,a,l,u,c,d,p)=>(qe(n)?r="":qe(i)?r=`>=${n}.0.0${t?"-0":""}`:qe(o)?r=`>=${n}.${i}.0${t?"-0":""}`:s?r=`>=${r}`:r=`>=${r}${t?"-0":""}`,qe(u)?l="":qe(c)?l=`<${+u+1}.0.0-0`:qe(d)?l=`<${u}.${+c+1}.0-0`:p?l=`<=${u}.${c}.${d}-${p}`:t?l=`<${u}.${c}.${+d+1}-0`:l=`<=${l}`,`${r} ${l}`.trim()),Nk=(t,e,r)=>{for(let n=0;n<t.length;n++)if(!t[n].test(e))return!1;if(e.prerelease.length&&!r.includePrerelease){for(let n=0;n<t.length;n++)if(oe(t[n].semver),t[n].semver!==nf.ANY&&t[n].semver.prerelease.length>0){let i=t[n].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}});var bs=I((G2,sv)=>{"use strict";var xs=Symbol("SemVer ANY"),af=class t{static get ANY(){return xs}constructor(e,r){if(r=tv(r),e instanceof t){if(e.loose===!!r.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),sf("comparator",e,r),this.options=r,this.loose=!!r.loose,this.parse(e),this.semver===xs?this.value="":this.value=this.operator+this.semver.version,sf("comp",this)}parse(e){let r=this.options.loose?rv[nv.COMPARATORLOOSE]:rv[nv.COMPARATOR],n=e.match(r);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new iv(n[2],this.options.loose):this.semver=xs}toString(){return this.value}test(e){if(sf("Comparator.test",e,this.options.loose),this.semver===xs||e===xs)return!0;if(typeof e=="string")try{e=new iv(e,this.options)}catch{return!1}return of(e,this.operator,this.semver,this.options)}intersects(e,r){if(!(e instanceof t))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new ov(e.value,r).test(this.value):e.operator===""?e.value===""?!0:new ov(this.value,r).test(e.semver):(r=tv(r),r.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!r.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||of(this.semver,"<",e.semver,r)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||of(this.semver,">",e.semver,r)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};sv.exports=af;var tv=tu(),{safeRe:rv,t:nv}=eo(),of=ef(),sf=ws(),iv=Ne(),ov=Et()});var Ss=I((q2,av)=>{"use strict";var Lk=Et(),Rk=(t,e,r)=>{try{e=new Lk(e,r)}catch{return!1}return e.test(t)};av.exports=Rk});var uv=I((H2,lv)=>{"use strict";var Dk=Et(),zk=(t,e)=>new Dk(t,e).set.map(r=>r.map(n=>n.value).join(" ").trim().split(" "));lv.exports=zk});var dv=I((K2,cv)=>{"use strict";var jk=Ne(),Bk=Et(),Uk=(t,e,r)=>{let n=null,i=null,o=null;try{o=new Bk(e,r)}catch{return null}return t.forEach(s=>{o.test(s)&&(!n||i.compare(s)===-1)&&(n=s,i=new jk(n,r))}),n};cv.exports=Uk});var fv=I((Q2,pv)=>{"use strict";var Vk=Ne(),Wk=Et(),Gk=(t,e,r)=>{let n=null,i=null,o=null;try{o=new Wk(e,r)}catch{return null}return t.forEach(s=>{o.test(s)&&(!n||i.compare(s)===1)&&(n=s,i=new Vk(n,r))}),n};pv.exports=Gk});var gv=I((J2,mv)=>{"use strict";var lf=Ne(),qk=Et(),hv=vs(),Hk=(t,e)=>{t=new qk(t,e);let r=new lf("0.0.0");if(t.test(r)||(r=new lf("0.0.0-0"),t.test(r)))return r;r=null;for(let n=0;n<t.set.length;++n){let i=t.set[n],o=null;i.forEach(s=>{let a=new lf(s.semver.version);switch(s.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!o||hv(a,o))&&(o=a);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${s.operator}`)}}),o&&(!r||hv(r,o))&&(r=o)}return r&&t.test(r)?r:null};mv.exports=Hk});var yv=I((X2,_v)=>{"use strict";var Kk=Et(),Qk=(t,e)=>{try{return new Kk(t,e).range||"*"}catch{return null}};_v.exports=Qk});var pu=I((Z2,xv)=>{"use strict";var Jk=Ne(),bv=bs(),{ANY:Xk}=bv,Zk=Et(),Yk=Ss(),wv=vs(),vv=au(),eE=uu(),tE=lu(),rE=(t,e,r,n)=>{t=new Jk(t,n),e=new Zk(e,n);let i,o,s,a,l;switch(r){case">":i=wv,o=eE,s=vv,a=">",l=">=";break;case"<":i=vv,o=tE,s=wv,a="<",l="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Yk(t,e,n))return!1;for(let u=0;u<e.set.length;++u){let c=e.set[u],d=null,p=null;if(c.forEach(f=>{f.semver===Xk&&(f=new bv(">=0.0.0")),d=d||f,p=p||f,i(f.semver,d.semver,n)?d=f:s(f.semver,p.semver,n)&&(p=f)}),d.operator===a||d.operator===l||(!p.operator||p.operator===a)&&o(t,p.semver))return!1;if(p.operator===l&&s(t,p.semver))return!1}return!0};xv.exports=rE});var Tv=I((Y2,Sv)=>{"use strict";var nE=pu(),iE=(t,e,r)=>nE(t,e,">",r);Sv.exports=iE});var kv=I((e$,Mv)=>{"use strict";var oE=pu(),sE=(t,e,r)=>oE(t,e,"<",r);Mv.exports=sE});var Cv=I((t$,Pv)=>{"use strict";var Ev=Et(),aE=(t,e,r)=>(t=new Ev(t,r),e=new Ev(e,r),t.intersects(e,r));Pv.exports=aE});var Av=I((r$,Iv)=>{"use strict";var lE=Ss(),uE=kt();Iv.exports=(t,e,r)=>{let n=[],i=null,o=null,s=t.sort((c,d)=>uE(c,d,r));for(let c of s)lE(c,e,r)?(o=c,i||(i=c)):(o&&n.push([i,o]),o=null,i=null);i&&n.push([i,null]);let a=[];for(let[c,d]of n)c===d?a.push(c):!d&&c===s[0]?a.push("*"):d?c===s[0]?a.push(`<=${d}`):a.push(`${c} - ${d}`):a.push(`>=${c}`);let l=a.join(" || "),u=typeof e.raw=="string"?e.raw:String(e);return l.length<u.length?l:e}});var Rv=I((n$,Lv)=>{"use strict";var $v=Et(),cf=bs(),{ANY:uf}=cf,Ts=Ss(),df=kt(),cE=(t,e,r={})=>{if(t===e)return!0;t=new $v(t,r),e=new $v(e,r);let n=!1;e:for(let i of t.set){for(let o of e.set){let s=pE(i,o,r);if(n=n||s!==null,s)continue e}if(n)return!1}return!0},dE=[new cf(">=0.0.0-0")],Ov=[new cf(">=0.0.0")],pE=(t,e,r)=>{if(t===e)return!0;if(t.length===1&&t[0].semver===uf){if(e.length===1&&e[0].semver===uf)return!0;r.includePrerelease?t=dE:t=Ov}if(e.length===1&&e[0].semver===uf){if(r.includePrerelease)return!0;e=Ov}let n=new Set,i,o;for(let f of t)f.operator===">"||f.operator===">="?i=Fv(i,f,r):f.operator==="<"||f.operator==="<="?o=Nv(o,f,r):n.add(f.semver);if(n.size>1)return null;let s;if(i&&o){if(s=df(i.semver,o.semver,r),s>0)return null;if(s===0&&(i.operator!==">="||o.operator!=="<="))return null}for(let f of n){if(i&&!Ts(f,String(i),r)||o&&!Ts(f,String(o),r))return null;for(let _ of e)if(!Ts(f,String(_),r))return!1;return!0}let a,l,u,c,d=o&&!r.includePrerelease&&o.semver.prerelease.length?o.semver:!1,p=i&&!r.includePrerelease&&i.semver.prerelease.length?i.semver:!1;d&&d.prerelease.length===1&&o.operator==="<"&&d.prerelease[0]===0&&(d=!1);for(let f of e){if(c=c||f.operator===">"||f.operator===">=",u=u||f.operator==="<"||f.operator==="<=",i){if(p&&f.semver.prerelease&&f.semver.prerelease.length&&f.semver.major===p.major&&f.semver.minor===p.minor&&f.semver.patch===p.patch&&(p=!1),f.operator===">"||f.operator===">="){if(a=Fv(i,f,r),a===f&&a!==i)return!1}else if(i.operator===">="&&!Ts(i.semver,String(f),r))return!1}if(o){if(d&&f.semver.prerelease&&f.semver.prerelease.length&&f.semver.major===d.major&&f.semver.minor===d.minor&&f.semver.patch===d.patch&&(d=!1),f.operator==="<"||f.operator==="<="){if(l=Nv(o,f,r),l===f&&l!==o)return!1}else if(o.operator==="<="&&!Ts(o.semver,String(f),r))return!1}if(!f.operator&&(o||i)&&s!==0)return!1}return!(i&&u&&!o&&s!==0||o&&c&&!i&&s!==0||p||d)},Fv=(t,e,r)=>{if(!t)return e;let n=df(t.semver,e.semver,r);return n>0?t:n<0||e.operator===">"&&t.operator===">="?e:t},Nv=(t,e,r)=>{if(!t)return e;let n=df(t.semver,e.semver,r);return n<0?t:n>0||e.operator==="<"&&t.operator==="<="?e:t};Lv.exports=cE});var Bv=I((i$,jv)=>{"use strict";var pf=eo(),Dv=ys(),fE=Ne(),zv=Jp(),hE=Kn(),mE=dw(),gE=fw(),_E=gw(),yE=ww(),wE=bw(),vE=Sw(),bE=Mw(),xE=Ew(),SE=kt(),TE=Aw(),ME=Ow(),kE=su(),EE=Rw(),PE=zw(),CE=vs(),IE=au(),AE=Zp(),$E=Yp(),OE=lu(),FE=uu(),NE=ef(),LE=Kw(),RE=bs(),DE=Et(),zE=Ss(),jE=uv(),BE=dv(),UE=fv(),VE=gv(),WE=yv(),GE=pu(),qE=Tv(),HE=kv(),KE=Cv(),QE=Av(),JE=Rv();jv.exports={parse:hE,valid:mE,clean:gE,inc:_E,diff:yE,major:wE,minor:vE,patch:bE,prerelease:xE,compare:SE,rcompare:TE,compareLoose:ME,compareBuild:kE,sort:EE,rsort:PE,gt:CE,lt:IE,eq:AE,neq:$E,gte:OE,lte:FE,cmp:NE,coerce:LE,Comparator:RE,Range:DE,satisfies:zE,toComparators:jE,maxSatisfying:BE,minSatisfying:UE,minVersion:VE,validRange:WE,outside:GE,gtr:qE,ltr:HE,intersects:KE,simplifyRange:QE,subset:JE,SemVer:fE,re:pf.re,src:pf.src,tokens:pf.t,SEMVER_SPEC_VERSION:Dv.SEMVER_SPEC_VERSION,RELEASE_TYPES:Dv.RELEASE_TYPES,compareIdentifiers:zv.compareIdentifiers,rcompareIdentifiers:zv.rcompareIdentifiers}});var nb=I((X$,rb)=>{"use strict";rb.exports=function(t,e){if(typeof t!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,t.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}});var cb=I((Z$,Tf)=>{"use strict";var MP=/[\p{Lu}]/u,kP=/[\p{Ll}]/u,ib=/^[\p{Lu}](?![\p{Lu}])/gu,ab=/([\p{Alpha}\p{N}_]|$)/u,lb=/[_.\- ]+/,EP=new RegExp("^"+lb.source),ob=new RegExp(lb.source+ab.source,"gu"),sb=new RegExp("\\d+"+ab.source,"gu"),PP=(t,e,r)=>{let n=!1,i=!1,o=!1;for(let s=0;s<t.length;s++){let a=t[s];n&&MP.test(a)?(t=t.slice(0,s)+"-"+t.slice(s),n=!1,o=i,i=!0,s++):i&&o&&kP.test(a)?(t=t.slice(0,s-1)+"-"+t.slice(s-1),o=i,i=!1,n=!0):(n=e(a)===a&&r(a)!==a,o=i,i=r(a)===a&&e(a)!==a)}return t},CP=(t,e)=>(ib.lastIndex=0,t.replace(ib,r=>e(r))),IP=(t,e)=>(ob.lastIndex=0,sb.lastIndex=0,t.replace(ob,(r,n)=>e(n)).replace(sb,r=>e(r))),ub=(t,e)=>{if(!(typeof t=="string"||Array.isArray(t)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(t)?t=t.map(o=>o.trim()).filter(o=>o.length).join("-"):t=t.trim(),t.length===0)return"";let r=e.locale===!1?o=>o.toLowerCase():o=>o.toLocaleLowerCase(e.locale),n=e.locale===!1?o=>o.toUpperCase():o=>o.toLocaleUpperCase(e.locale);return t.length===1?e.pascalCase?n(t):r(t):(t!==r(t)&&(t=PP(t,r,n)),t=t.replace(EP,""),e.preserveConsecutiveUppercase?t=CP(t,r):t=r(t),e.pascalCase&&(t=n(t.charAt(0))+t.slice(1)),IP(t,n))};Tf.exports=ub;Tf.exports.default=ub});var vb=I((lO,wb)=>{"use strict";var _b=(t=0)=>e=>`\x1B[${38+t};5;${e}m`,yb=(t=0)=>(e,r,n)=>`\x1B[${38+t};2;${e};${r};${n}m`;function jP(){let t=new Map,e={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};e.color.gray=e.color.blackBright,e.bgColor.bgGray=e.bgColor.bgBlackBright,e.color.grey=e.color.blackBright,e.bgColor.bgGrey=e.bgColor.bgBlackBright;for(let[r,n]of Object.entries(e)){for(let[i,o]of Object.entries(n))e[i]={open:`\x1B[${o[0]}m`,close:`\x1B[${o[1]}m`},n[i]=e[i],t.set(o[0],o[1]);Object.defineProperty(e,r,{value:n,enumerable:!1})}return Object.defineProperty(e,"codes",{value:t,enumerable:!1}),e.color.close="\x1B[39m",e.bgColor.close="\x1B[49m",e.color.ansi256=_b(),e.color.ansi16m=yb(),e.bgColor.ansi256=_b(10),e.bgColor.ansi16m=yb(10),Object.defineProperties(e,{rgbToAnsi256:{value:(r,n,i)=>r===n&&n===i?r<8?16:r>248?231:Math.round((r-8)/247*24)+232:16+36*Math.round(r/255*5)+6*Math.round(n/255*5)+Math.round(i/255*5),enumerable:!1},hexToRgb:{value:r=>{let n=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(r.toString(16));if(!n)return[0,0,0];let{colorString:i}=n.groups;i.length===3&&(i=i.split("").map(s=>s+s).join(""));let o=Number.parseInt(i,16);return[o>>16&255,o>>8&255,o&255]},enumerable:!1},hexToAnsi256:{value:r=>e.rgbToAnsi256(...e.hexToRgb(r)),enumerable:!1}}),e}Object.defineProperty(wb,"exports",{enumerable:!0,get:jP})});var S0=I(Gu=>{"use strict";Gu.byteLength=pC;Gu.toByteArray=hC;Gu.fromByteArray=_C;var ar=[],$t=[],dC=typeof Uint8Array<"u"?Uint8Array:Array,rh="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(oi=0,b0=rh.length;oi<b0;++oi)ar[oi]=rh[oi],$t[rh.charCodeAt(oi)]=oi;var oi,b0;$t[45]=62;$t[95]=63;function x0(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");r===-1&&(r=e);var n=r===e?0:4-r%4;return[r,n]}function pC(t){var e=x0(t),r=e[0],n=e[1];return(r+n)*3/4-n}function fC(t,e,r){return(e+r)*3/4-r}function hC(t){var e,r=x0(t),n=r[0],i=r[1],o=new dC(fC(t,n,i)),s=0,a=i>0?n-4:n,l;for(l=0;l<a;l+=4)e=$t[t.charCodeAt(l)]<<18|$t[t.charCodeAt(l+1)]<<12|$t[t.charCodeAt(l+2)]<<6|$t[t.charCodeAt(l+3)],o[s++]=e>>16&255,o[s++]=e>>8&255,o[s++]=e&255;return i===2&&(e=$t[t.charCodeAt(l)]<<2|$t[t.charCodeAt(l+1)]>>4,o[s++]=e&255),i===1&&(e=$t[t.charCodeAt(l)]<<10|$t[t.charCodeAt(l+1)]<<4|$t[t.charCodeAt(l+2)]>>2,o[s++]=e>>8&255,o[s++]=e&255),o}function mC(t){return ar[t>>18&63]+ar[t>>12&63]+ar[t>>6&63]+ar[t&63]}function gC(t,e,r){for(var n,i=[],o=e;o<r;o+=3)n=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(t[o+2]&255),i.push(mC(n));return i.join("")}function _C(t){for(var e,r=t.length,n=r%3,i=[],o=16383,s=0,a=r-n;s<a;s+=o)i.push(gC(t,s,s+o>a?a:s+o));return n===1?(e=t[r-1],i.push(ar[e>>2]+ar[e<<4&63]+"==")):n===2&&(e=(t[r-2]<<8)+t[r-1],i.push(ar[e>>10]+ar[e>>4&63]+ar[e<<2&63]+"=")),i.join("")}});var EC={};sh(EC,{default:()=>Zu});module.exports=F0(EC);var Re=Z(Qe()),k0=require("obsidian");var si=class t{constructor(e,r,n,i,o,s){this.path=e;this.title=r;this.content=n;this.chunkIndex=i;this.totalChunks=o;this.embedding=s}withEmbedding(e){return new t(this.path,this.title,this.content,this.chunkIndex,this.totalChunks,e)}toDTO(){return{path:this.path,title:this.title,content:this.content,chunkIndex:this.chunkIndex,totalChunks:this.totalChunks,embedding:this.embedding}}static fromDTO(e){return new t(e.path,e.title,e.content,e.chunkIndex,e.totalChunks,e.embedding)}};var ch=Symbol("Comlink.proxy"),N0=Symbol("Comlink.endpoint"),Gs=Symbol("Comlink.releaseProxy"),Yu=Symbol("Comlink.finalizer"),Bs=Symbol("Comlink.thrown"),dh=t=>typeof t=="object"&&t!==null||typeof t=="function",L0={canHandle:t=>dh(t)&&t[ch],serialize(t){let{port1:e,port2:r}=new MessageChannel;return fh(t,e),[r,[r]]},deserialize(t){return t.start(),tc(t)}},R0={canHandle:t=>dh(t)&&Bs in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},ph=new Map([["proxy",L0],["throw",R0]]);function D0(t,e){for(let r of t)if(e===r||r==="*"||r instanceof RegExp&&r.test(e))return!0;return!1}function fh(t,e=globalThis,r=["*"]){e.addEventListener("message",function n(i){if(!i||!i.data)return;if(!D0(r,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}let{id:o,type:s,path:a}=Object.assign({path:[]},i.data),l=(i.data.argumentList||[]).map(cn),u;try{let c=a.slice(0,-1).reduce((p,f)=>p[f],t),d=a.reduce((p,f)=>p[f],t);switch(s){case"GET":u=d;break;case"SET":c[a.slice(-1)[0]]=cn(i.data.value),u=!0;break;case"APPLY":u=d.apply(c,l);break;case"CONSTRUCT":{let p=new d(...l);u=lo(p)}break;case"ENDPOINT":{let{port1:p,port2:f}=new MessageChannel;fh(t,f),u=V0(p,[p])}break;case"RELEASE":u=void 0;break;default:return}}catch(c){u={value:c,[Bs]:0}}Promise.resolve(u).catch(c=>({value:c,[Bs]:0})).then(c=>{let[d,p]=Ws(c);e.postMessage(Object.assign(Object.assign({},d),{id:o}),p),s==="RELEASE"&&(e.removeEventListener("message",n),hh(e),Yu in t&&typeof t[Yu]=="function"&&t[Yu]())}).catch(c=>{let[d,p]=Ws({value:new TypeError("Unserializable return value"),[Bs]:0});e.postMessage(Object.assign(Object.assign({},d),{id:o}),p)})}),e.start&&e.start()}function z0(t){return t.constructor.name==="MessagePort"}function hh(t){z0(t)&&t.close()}function tc(t,e){let r=new Map;return t.addEventListener("message",function(i){let{data:o}=i;if(!o||!o.id)return;let s=r.get(o.id);if(s)try{s(o)}finally{r.delete(o.id)}}),ec(t,r,[],e)}function js(t){if(t)throw new Error("Proxy has been released and is not useable")}function mh(t){return ai(t,new Map,{type:"RELEASE"}).then(()=>{hh(t)})}var Us=new WeakMap,Vs="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{let e=(Us.get(t)||0)-1;Us.set(t,e),e===0&&mh(t)});function j0(t,e){let r=(Us.get(e)||0)+1;Us.set(e,r),Vs&&Vs.register(t,e,t)}function B0(t){Vs&&Vs.unregister(t)}function ec(t,e,r=[],n=function(){}){let i=!1,o=new Proxy(n,{get(s,a){if(js(i),a===Gs)return()=>{B0(o),mh(t),e.clear(),i=!0};if(a==="then"){if(r.length===0)return{then:()=>o};let l=ai(t,e,{type:"GET",path:r.map(u=>u.toString())}).then(cn);return l.then.bind(l)}return ec(t,e,[...r,a])},set(s,a,l){js(i);let[u,c]=Ws(l);return ai(t,e,{type:"SET",path:[...r,a].map(d=>d.toString()),value:u},c).then(cn)},apply(s,a,l){js(i);let u=r[r.length-1];if(u===N0)return ai(t,e,{type:"ENDPOINT"}).then(cn);if(u==="bind")return ec(t,e,r.slice(0,-1));let[c,d]=uh(l);return ai(t,e,{type:"APPLY",path:r.map(p=>p.toString()),argumentList:c},d).then(cn)},construct(s,a){js(i);let[l,u]=uh(a);return ai(t,e,{type:"CONSTRUCT",path:r.map(c=>c.toString()),argumentList:l},u).then(cn)}});return j0(o,t),o}function U0(t){return Array.prototype.concat.apply([],t)}function uh(t){let e=t.map(Ws);return[e.map(r=>r[0]),U0(e.map(r=>r[1]))]}var gh=new WeakMap;function V0(t,e){return gh.set(t,e),t}function lo(t){return Object.assign(t,{[ch]:!0})}function Ws(t){for(let[e,r]of ph)if(r.canHandle(t)){let[n,i]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:t},gh.get(t)||[]]}function cn(t){switch(t.type){case"HANDLER":return ph.get(t.name).deserialize(t.value);case"RAW":return t.value}}function ai(t,e,r,n){return new Promise(i=>{let o=W0();e.set(o,i),t.start&&t.start(),t.postMessage(Object.assign({id:o},r),n)})}function W0(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var dn=Z(Qe()),li=class{constructor(e){this.worker=null;this.workerName=e}async initialize(e){await this.dispose();let r=tc(new e);if(this.worker=await new r,dn.default.info(`${this.workerName} initialized`,this.worker),!this.worker)throw new Error(`${this.workerName} not initialized`);let n=this.worker;return n.setLogLevel&&typeof n.setLogLevel=="function"&&await n.setLogLevel(dn.default.getLevel()).catch(i=>dn.default.error(`Failed to set log level on ${this.workerName}`,i)),this.worker}getWorker(){if(!this.worker)throw new Error(`${this.workerName} not initialized`);return this.worker}isInitialized(){return this.worker!==null}ensureInitialized(){if(!this.worker)throw new Error(`${this.workerName} not initialized`)}async updateLogLevel(e){if(this.worker){let r=this.worker;r.setLogLevel&&typeof r.setLogLevel=="function"&&await r.setLogLevel(e).catch(n=>dn.default.error(`Failed to set log level on ${this.workerName}`,n))}}async dispose(){if(this.worker)try{this.worker[Gs]&&this.worker[Gs](),this.worker=null,dn.default.info(`${this.workerName} disposed`)}catch(e){dn.default.error(`Error disposing ${this.workerName}:`,e)}}};var co=Z(Qe());function uo(t){let e=new Blob([t],{type:"text/javascript"}),r=URL.createObjectURL(e),n=new Worker(r);return URL.revokeObjectURL(r),n}function nc(){return uo('var Rc=Object.create;var tr=Object.defineProperty,Oc=Object.defineProperties,Dc=Object.getOwnPropertyDescriptor,Nc=Object.getOwnPropertyDescriptors,Pc=Object.getOwnPropertyNames,As=Object.getOwnPropertySymbols,Uc=Object.getPrototypeOf,Is=Object.prototype.hasOwnProperty,Mc=Object.prototype.propertyIsEnumerable;var Bt=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),Bc=t=>{throw TypeError(t)};var $n=(t,e,r)=>e in t?tr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ee=(t,e)=>{for(var r in e||(e={}))Is.call(e,r)&&$n(t,r,e[r]);if(As)for(var r of As(e))Mc.call(e,r)&&$n(t,r,e[r]);return t},tt=(t,e)=>Oc(t,Nc(e));var yt=(t,e)=>()=>(t&&(e=t(t=0)),e);var rt=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),gt=(t,e)=>{for(var r in e)tr(t,r,{get:e[r],enumerable:!0})},Ts=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Pc(e))!Is.call(t,o)&&o!==r&&tr(t,o,{get:()=>e[o],enumerable:!(n=Dc(e,o))||n.enumerable});return t};var Rs=(t,e,r)=>(r=t!=null?Rc(Uc(t)):{},Ts(e||!t||!t.__esModule?tr(r,"default",{value:t,enumerable:!0}):r,t)),Os=t=>Ts(tr({},"__esModule",{value:!0}),t);var Ie=(t,e,r)=>$n(t,typeof e!="symbol"?e+"":e,r);var ze=function(t,e){this[0]=t,this[1]=e},nt=(t,e,r)=>{var n=(s,a,l,u)=>{try{var h=r[s](a),d=(a=h.value)instanceof ze,p=h.done;Promise.resolve(d?a[0]:a).then(w=>d?n(s==="return"?s:"next",a[1]?{done:w.done,value:w.value}:w,l,u):l({value:w,done:p})).catch(w=>n("throw",w,l,u))}catch(w){u(w)}},o=s=>i[s]=a=>new Promise((l,u)=>n(s,a,l,u)),i={};return r=r.apply(t,e),i[Bt("asyncIterator")]=()=>i,o("next"),o("throw"),o("return"),i},zn=t=>{var e=t[Bt("asyncIterator")],r=!1,n,o={};return e==null?(e=t[Bt("iterator")](),n=i=>o[i]=s=>e[i](s)):(e=e.call(t),n=i=>o[i]=s=>{if(r){if(r=!1,i==="throw")throw s;return s}return r=!0,{done:!1,value:new ze(new Promise(a=>{var l=e[i](s);l instanceof Object||Bc("Object expected"),a(l)}),1)}}),o[Bt("iterator")]=()=>o,n("next"),"throw"in e?n("throw"):o.throw=i=>{throw i},"return"in e&&n("return"),o},Ge=(t,e,r)=>(e=t[Bt("asyncIterator")])?e.call(t):(t=t[Bt("iterator")](),e={},r=(n,o)=>(o=t[n])&&(e[n]=i=>new Promise((s,a,l)=>(i=o.call(t,i),l=i.done,Promise.resolve(i.value).then(u=>s({value:u,done:l}),a)))),r("next"),r("return"),e);function fd(){if(rf)return mr;rf=!0,mr.byteLength=a,mr.toByteArray=u,mr.fromByteArray=p;for(var t=[],e=[],r=typeof Uint8Array!="undefined"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,i=n.length;o<i;++o)t[o]=n[o],e[n.charCodeAt(o)]=o;e[45]=62,e[95]=63;function s(w){var g=w.length;if(g%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var m=w.indexOf("=");m===-1&&(m=g);var y=m===g?0:4-m%4;return[m,y]}function a(w){var g=s(w),m=g[0],y=g[1];return(m+y)*3/4-y}function l(w,g,m){return(g+m)*3/4-m}function u(w){var g,m=s(w),y=m[0],S=m[1],b=new r(l(w,y,S)),E=0,A=S>0?y-4:y,x;for(x=0;x<A;x+=4)g=e[w.charCodeAt(x)]<<18|e[w.charCodeAt(x+1)]<<12|e[w.charCodeAt(x+2)]<<6|e[w.charCodeAt(x+3)],b[E++]=g>>16&255,b[E++]=g>>8&255,b[E++]=g&255;return S===2&&(g=e[w.charCodeAt(x)]<<2|e[w.charCodeAt(x+1)]>>4,b[E++]=g&255),S===1&&(g=e[w.charCodeAt(x)]<<10|e[w.charCodeAt(x+1)]<<4|e[w.charCodeAt(x+2)]>>2,b[E++]=g>>8&255,b[E++]=g&255),b}function h(w){return t[w>>18&63]+t[w>>12&63]+t[w>>6&63]+t[w&63]}function d(w,g,m){for(var y,S=[],b=g;b<m;b+=3)y=(w[b]<<16&16711680)+(w[b+1]<<8&65280)+(w[b+2]&255),S.push(h(y));return S.join("")}function p(w){for(var g,m=w.length,y=m%3,S=[],b=16383,E=0,A=m-y;E<A;E+=b)S.push(d(w,E,E+b>A?A:E+b));return y===1?(g=w[m-1],S.push(t[g>>2]+t[g<<4&63]+"==")):y===2&&(g=(w[m-2]<<8)+w[m-1],S.push(t[g>>10]+t[g>>4&63]+t[g<<2&63]+"=")),S.join("")}return mr}function ld(){if(nf)return an;nf=!0;return an.read=function(t,e,r,n,o){var i,s,a=o*8-n-1,l=(1<<a)-1,u=l>>1,h=-7,d=r?o-1:0,p=r?-1:1,w=t[e+d];for(d+=p,i=w&(1<<-h)-1,w>>=-h,h+=a;h>0;i=i*256+t[e+d],d+=p,h-=8);for(s=i&(1<<-h)-1,i>>=-h,h+=n;h>0;s=s*256+t[e+d],d+=p,h-=8);if(i===0)i=1-u;else{if(i===l)return s?NaN:(w?-1:1)*(1/0);s=s+Math.pow(2,n),i=i-u}return(w?-1:1)*s*Math.pow(2,i-n)},an.write=function(t,e,r,n,o,i){var s,a,l,u=i*8-o-1,h=(1<<u)-1,d=h>>1,p=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,w=n?0:i-1,g=n?1:-1,m=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=h):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),s+d>=1?e+=p/l:e+=p*Math.pow(2,1-d),e*l>=2&&(s++,l/=2),s+d>=h?(a=0,s=h):s+d>=1?(a=(e*l-1)*Math.pow(2,o),s=s+d):(a=e*Math.pow(2,d-1)*Math.pow(2,o),s=0));o>=8;t[r+w]=a&255,w+=g,a/=256,o-=8);for(s=s<<o|a,u+=o;u>0;t[r+w]=s&255,w+=g,s/=256,u-=8);t[r+w-g]|=m*128},an}function at(){if(of)return Ot;of=!0;let t=fd(),e=ld(),r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;Ot.Buffer=s,Ot.SlowBuffer=S,Ot.INSPECT_MAX_BYTES=50;let n=2147483647;Ot.kMaxLength=n,s.TYPED_ARRAY_SUPPORT=o(),!s.TYPED_ARRAY_SUPPORT&&typeof console!="undefined"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function o(){try{let v=new Uint8Array(1),f={foo:function(){return 42}};return Object.setPrototypeOf(f,Uint8Array.prototype),Object.setPrototypeOf(v,f),v.foo()===42}catch(v){return!1}}Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}});function i(v){if(v>n)throw new RangeError(\'The value "\'+v+\'" is invalid for option "size"\');let f=new Uint8Array(v);return Object.setPrototypeOf(f,s.prototype),f}function s(v,f,c){if(typeof v=="number"){if(typeof f=="string")throw new TypeError(\'The "string" argument must be of type string. Received type number\');return h(v)}return a(v,f,c)}s.poolSize=8192;function a(v,f,c){if(typeof v=="string")return d(v,f);if(ArrayBuffer.isView(v))return w(v);if(v==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof v);if(se(v,ArrayBuffer)||v&&se(v.buffer,ArrayBuffer)||typeof SharedArrayBuffer!="undefined"&&(se(v,SharedArrayBuffer)||v&&se(v.buffer,SharedArrayBuffer)))return g(v,f,c);if(typeof v=="number")throw new TypeError(\'The "value" argument must not be of type number. Received type number\');let I=v.valueOf&&v.valueOf();if(I!=null&&I!==v)return s.from(I,f,c);let B=m(v);if(B)return B;if(typeof Symbol!="undefined"&&Symbol.toPrimitive!=null&&typeof v[Symbol.toPrimitive]=="function")return s.from(v[Symbol.toPrimitive]("string"),f,c);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof v)}s.from=function(v,f,c){return a(v,f,c)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array);function l(v){if(typeof v!="number")throw new TypeError(\'"size" argument must be of type number\');if(v<0)throw new RangeError(\'The value "\'+v+\'" is invalid for option "size"\')}function u(v,f,c){return l(v),v<=0?i(v):f!==void 0?typeof c=="string"?i(v).fill(f,c):i(v).fill(f):i(v)}s.alloc=function(v,f,c){return u(v,f,c)};function h(v){return l(v),i(v<0?0:y(v)|0)}s.allocUnsafe=function(v){return h(v)},s.allocUnsafeSlow=function(v){return h(v)};function d(v,f){if((typeof f!="string"||f==="")&&(f="utf8"),!s.isEncoding(f))throw new TypeError("Unknown encoding: "+f);let c=b(v,f)|0,I=i(c),B=I.write(v,f);return B!==c&&(I=I.slice(0,B)),I}function p(v){let f=v.length<0?0:y(v.length)|0,c=i(f);for(let I=0;I<f;I+=1)c[I]=v[I]&255;return c}function w(v){if(se(v,Uint8Array)){let f=new Uint8Array(v);return g(f.buffer,f.byteOffset,f.byteLength)}return p(v)}function g(v,f,c){if(f<0||v.byteLength<f)throw new RangeError(\'"offset" is outside of buffer bounds\');if(v.byteLength<f+(c||0))throw new RangeError(\'"length" is outside of buffer bounds\');let I;return f===void 0&&c===void 0?I=new Uint8Array(v):c===void 0?I=new Uint8Array(v,f):I=new Uint8Array(v,f,c),Object.setPrototypeOf(I,s.prototype),I}function m(v){if(s.isBuffer(v)){let f=y(v.length)|0,c=i(f);return c.length===0||v.copy(c,0,0,f),c}if(v.length!==void 0)return typeof v.length!="number"||Z(v.length)?i(0):p(v);if(v.type==="Buffer"&&Array.isArray(v.data))return p(v.data)}function y(v){if(v>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return v|0}function S(v){return+v!=v&&(v=0),s.alloc(+v)}s.isBuffer=function(f){return f!=null&&f._isBuffer===!0&&f!==s.prototype},s.compare=function(f,c){if(se(f,Uint8Array)&&(f=s.from(f,f.offset,f.byteLength)),se(c,Uint8Array)&&(c=s.from(c,c.offset,c.byteLength)),!s.isBuffer(f)||!s.isBuffer(c))throw new TypeError(\'The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array\');if(f===c)return 0;let I=f.length,B=c.length;for(let q=0,ee=Math.min(I,B);q<ee;++q)if(f[q]!==c[q]){I=f[q],B=c[q];break}return I<B?-1:B<I?1:0},s.isEncoding=function(f){switch(String(f).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(f,c){if(!Array.isArray(f))throw new TypeError(\'"list" argument must be an Array of Buffers\');if(f.length===0)return s.alloc(0);let I;if(c===void 0)for(c=0,I=0;I<f.length;++I)c+=f[I].length;let B=s.allocUnsafe(c),q=0;for(I=0;I<f.length;++I){let ee=f[I];if(se(ee,Uint8Array))q+ee.length>B.length?(s.isBuffer(ee)||(ee=s.from(ee)),ee.copy(B,q)):Uint8Array.prototype.set.call(B,ee,q);else if(s.isBuffer(ee))ee.copy(B,q);else throw new TypeError(\'"list" argument must be an Array of Buffers\');q+=ee.length}return B};function b(v,f){if(s.isBuffer(v))return v.length;if(ArrayBuffer.isView(v)||se(v,ArrayBuffer))return v.byteLength;if(typeof v!="string")throw new TypeError(\'The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type \'+typeof v);let c=v.length,I=arguments.length>2&&arguments[2]===!0;if(!I&&c===0)return 0;let B=!1;for(;;)switch(f){case"ascii":case"latin1":case"binary":return c;case"utf8":case"utf-8":return oe(v).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c*2;case"hex":return c>>>1;case"base64":return k(v).length;default:if(B)return I?-1:oe(v).length;f=(""+f).toLowerCase(),B=!0}}s.byteLength=b;function E(v,f,c){let I=!1;if((f===void 0||f<0)&&(f=0),f>this.length||((c===void 0||c>this.length)&&(c=this.length),c<=0)||(c>>>=0,f>>>=0,c<=f))return"";for(v||(v="utf8");;)switch(v){case"hex":return O(this,f,c);case"utf8":case"utf-8":return W(this,f,c);case"ascii":return pe(this,f,c);case"latin1":case"binary":return ge(this,f,c);case"base64":return Y(this,f,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return J(this,f,c);default:if(I)throw new TypeError("Unknown encoding: "+v);v=(v+"").toLowerCase(),I=!0}}s.prototype._isBuffer=!0;function A(v,f,c){let I=v[f];v[f]=v[c],v[c]=I}s.prototype.swap16=function(){let f=this.length;if(f%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let c=0;c<f;c+=2)A(this,c,c+1);return this},s.prototype.swap32=function(){let f=this.length;if(f%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let c=0;c<f;c+=4)A(this,c,c+3),A(this,c+1,c+2);return this},s.prototype.swap64=function(){let f=this.length;if(f%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let c=0;c<f;c+=8)A(this,c,c+7),A(this,c+1,c+6),A(this,c+2,c+5),A(this,c+3,c+4);return this},s.prototype.toString=function(){let f=this.length;return f===0?"":arguments.length===0?W(this,0,f):E.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(f){if(!s.isBuffer(f))throw new TypeError("Argument must be a Buffer");return this===f?!0:s.compare(this,f)===0},s.prototype.inspect=function(){let f="",c=Ot.INSPECT_MAX_BYTES;return f=this.toString("hex",0,c).replace(/(.{2})/g,"$1 ").trim(),this.length>c&&(f+=" ... "),"<Buffer "+f+">"},r&&(s.prototype[r]=s.prototype.inspect),s.prototype.compare=function(f,c,I,B,q){if(se(f,Uint8Array)&&(f=s.from(f,f.offset,f.byteLength)),!s.isBuffer(f))throw new TypeError(\'The "target" argument must be one of type Buffer or Uint8Array. Received type \'+typeof f);if(c===void 0&&(c=0),I===void 0&&(I=f?f.length:0),B===void 0&&(B=0),q===void 0&&(q=this.length),c<0||I>f.length||B<0||q>this.length)throw new RangeError("out of range index");if(B>=q&&c>=I)return 0;if(B>=q)return-1;if(c>=I)return 1;if(c>>>=0,I>>>=0,B>>>=0,q>>>=0,this===f)return 0;let ee=q-B,ve=I-c,De=Math.min(ee,ve),Oe=this.slice(B,q),Ne=f.slice(c,I);for(let Te=0;Te<De;++Te)if(Oe[Te]!==Ne[Te]){ee=Oe[Te],ve=Ne[Te];break}return ee<ve?-1:ve<ee?1:0};function x(v,f,c,I,B){if(v.length===0)return-1;if(typeof c=="string"?(I=c,c=0):c>2147483647?c=2147483647:c<-2147483648&&(c=-2147483648),c=+c,Z(c)&&(c=B?0:v.length-1),c<0&&(c=v.length+c),c>=v.length){if(B)return-1;c=v.length-1}else if(c<0)if(B)c=0;else return-1;if(typeof f=="string"&&(f=s.from(f,I)),s.isBuffer(f))return f.length===0?-1:z(v,f,c,I,B);if(typeof f=="number")return f=f&255,typeof Uint8Array.prototype.indexOf=="function"?B?Uint8Array.prototype.indexOf.call(v,f,c):Uint8Array.prototype.lastIndexOf.call(v,f,c):z(v,[f],c,I,B);throw new TypeError("val must be string, number or Buffer")}function z(v,f,c,I,B){let q=1,ee=v.length,ve=f.length;if(I!==void 0&&(I=String(I).toLowerCase(),I==="ucs2"||I==="ucs-2"||I==="utf16le"||I==="utf-16le")){if(v.length<2||f.length<2)return-1;q=2,ee/=2,ve/=2,c/=2}function De(Ne,Te){return q===1?Ne[Te]:Ne.readUInt16BE(Te*q)}let Oe;if(B){let Ne=-1;for(Oe=c;Oe<ee;Oe++)if(De(v,Oe)===De(f,Ne===-1?0:Oe-Ne)){if(Ne===-1&&(Ne=Oe),Oe-Ne+1===ve)return Ne*q}else Ne!==-1&&(Oe-=Oe-Ne),Ne=-1}else for(c+ve>ee&&(c=ee-ve),Oe=c;Oe>=0;Oe--){let Ne=!0;for(let Te=0;Te<ve;Te++)if(De(v,Oe+Te)!==De(f,Te)){Ne=!1;break}if(Ne)return Oe}return-1}s.prototype.includes=function(f,c,I){return this.indexOf(f,c,I)!==-1},s.prototype.indexOf=function(f,c,I){return x(this,f,c,I,!0)},s.prototype.lastIndexOf=function(f,c,I){return x(this,f,c,I,!1)};function G(v,f,c,I){c=Number(c)||0;let B=v.length-c;I?(I=Number(I),I>B&&(I=B)):I=B;let q=f.length;I>q/2&&(I=q/2);let ee;for(ee=0;ee<I;++ee){let ve=parseInt(f.substr(ee*2,2),16);if(Z(ve))return ee;v[c+ee]=ve}return ee}function L(v,f,c,I){return te(oe(f,v.length-c),v,c,I)}function ie(v,f,c,I){return te(ce(f),v,c,I)}function N(v,f,c,I){return te(k(f),v,c,I)}function F(v,f,c,I){return te(C(f,v.length-c),v,c,I)}s.prototype.write=function(f,c,I,B){if(c===void 0)B="utf8",I=this.length,c=0;else if(I===void 0&&typeof c=="string")B=c,I=this.length,c=0;else if(isFinite(c))c=c>>>0,isFinite(I)?(I=I>>>0,B===void 0&&(B="utf8")):(B=I,I=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let q=this.length-c;if((I===void 0||I>q)&&(I=q),f.length>0&&(I<0||c<0)||c>this.length)throw new RangeError("Attempt to write outside buffer bounds");B||(B="utf8");let ee=!1;for(;;)switch(B){case"hex":return G(this,f,c,I);case"utf8":case"utf-8":return L(this,f,c,I);case"ascii":case"latin1":case"binary":return ie(this,f,c,I);case"base64":return N(this,f,c,I);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return F(this,f,c,I);default:if(ee)throw new TypeError("Unknown encoding: "+B);B=(""+B).toLowerCase(),ee=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Y(v,f,c){return f===0&&c===v.length?t.fromByteArray(v):t.fromByteArray(v.slice(f,c))}function W(v,f,c){c=Math.min(v.length,c);let I=[],B=f;for(;B<c;){let q=v[B],ee=null,ve=q>239?4:q>223?3:q>191?2:1;if(B+ve<=c){let De,Oe,Ne,Te;switch(ve){case 1:q<128&&(ee=q);break;case 2:De=v[B+1],(De&192)===128&&(Te=(q&31)<<6|De&63,Te>127&&(ee=Te));break;case 3:De=v[B+1],Oe=v[B+2],(De&192)===128&&(Oe&192)===128&&(Te=(q&15)<<12|(De&63)<<6|Oe&63,Te>2047&&(Te<55296||Te>57343)&&(ee=Te));break;case 4:De=v[B+1],Oe=v[B+2],Ne=v[B+3],(De&192)===128&&(Oe&192)===128&&(Ne&192)===128&&(Te=(q&15)<<18|(De&63)<<12|(Oe&63)<<6|Ne&63,Te>65535&&Te<1114112&&(ee=Te))}}ee===null?(ee=65533,ve=1):ee>65535&&(ee-=65536,I.push(ee>>>10&1023|55296),ee=56320|ee&1023),I.push(ee),B+=ve}return ue(I)}let fe=4096;function ue(v){let f=v.length;if(f<=fe)return String.fromCharCode.apply(String,v);let c="",I=0;for(;I<f;)c+=String.fromCharCode.apply(String,v.slice(I,I+=fe));return c}function pe(v,f,c){let I="";c=Math.min(v.length,c);for(let B=f;B<c;++B)I+=String.fromCharCode(v[B]&127);return I}function ge(v,f,c){let I="";c=Math.min(v.length,c);for(let B=f;B<c;++B)I+=String.fromCharCode(v[B]);return I}function O(v,f,c){let I=v.length;(!f||f<0)&&(f=0),(!c||c<0||c>I)&&(c=I);let B="";for(let q=f;q<c;++q)B+=Ae[v[q]];return B}function J(v,f,c){let I=v.slice(f,c),B="";for(let q=0;q<I.length-1;q+=2)B+=String.fromCharCode(I[q]+I[q+1]*256);return B}s.prototype.slice=function(f,c){let I=this.length;f=~~f,c=c===void 0?I:~~c,f<0?(f+=I,f<0&&(f=0)):f>I&&(f=I),c<0?(c+=I,c<0&&(c=0)):c>I&&(c=I),c<f&&(c=f);let B=this.subarray(f,c);return Object.setPrototypeOf(B,s.prototype),B};function _(v,f,c){if(v%1!==0||v<0)throw new RangeError("offset is not uint");if(v+f>c)throw new RangeError("Trying to access beyond buffer length")}s.prototype.readUintLE=s.prototype.readUIntLE=function(f,c,I){f=f>>>0,c=c>>>0,I||_(f,c,this.length);let B=this[f],q=1,ee=0;for(;++ee<c&&(q*=256);)B+=this[f+ee]*q;return B},s.prototype.readUintBE=s.prototype.readUIntBE=function(f,c,I){f=f>>>0,c=c>>>0,I||_(f,c,this.length);let B=this[f+--c],q=1;for(;c>0&&(q*=256);)B+=this[f+--c]*q;return B},s.prototype.readUint8=s.prototype.readUInt8=function(f,c){return f=f>>>0,c||_(f,1,this.length),this[f]},s.prototype.readUint16LE=s.prototype.readUInt16LE=function(f,c){return f=f>>>0,c||_(f,2,this.length),this[f]|this[f+1]<<8},s.prototype.readUint16BE=s.prototype.readUInt16BE=function(f,c){return f=f>>>0,c||_(f,2,this.length),this[f]<<8|this[f+1]},s.prototype.readUint32LE=s.prototype.readUInt32LE=function(f,c){return f=f>>>0,c||_(f,4,this.length),(this[f]|this[f+1]<<8|this[f+2]<<16)+this[f+3]*16777216},s.prototype.readUint32BE=s.prototype.readUInt32BE=function(f,c){return f=f>>>0,c||_(f,4,this.length),this[f]*16777216+(this[f+1]<<16|this[f+2]<<8|this[f+3])},s.prototype.readBigUInt64LE=Ue(function(f){f=f>>>0,be(f,"offset");let c=this[f],I=this[f+7];(c===void 0||I===void 0)&&$(f,this.length-8);let B=c+this[++f]*2**8+this[++f]*2**16+this[++f]*2**24,q=this[++f]+this[++f]*2**8+this[++f]*2**16+I*2**24;return BigInt(B)+(BigInt(q)<<BigInt(32))}),s.prototype.readBigUInt64BE=Ue(function(f){f=f>>>0,be(f,"offset");let c=this[f],I=this[f+7];(c===void 0||I===void 0)&&$(f,this.length-8);let B=c*2**24+this[++f]*2**16+this[++f]*2**8+this[++f],q=this[++f]*2**24+this[++f]*2**16+this[++f]*2**8+I;return(BigInt(B)<<BigInt(32))+BigInt(q)}),s.prototype.readIntLE=function(f,c,I){f=f>>>0,c=c>>>0,I||_(f,c,this.length);let B=this[f],q=1,ee=0;for(;++ee<c&&(q*=256);)B+=this[f+ee]*q;return q*=128,B>=q&&(B-=Math.pow(2,8*c)),B},s.prototype.readIntBE=function(f,c,I){f=f>>>0,c=c>>>0,I||_(f,c,this.length);let B=c,q=1,ee=this[f+--B];for(;B>0&&(q*=256);)ee+=this[f+--B]*q;return q*=128,ee>=q&&(ee-=Math.pow(2,8*c)),ee},s.prototype.readInt8=function(f,c){return f=f>>>0,c||_(f,1,this.length),this[f]&128?(255-this[f]+1)*-1:this[f]},s.prototype.readInt16LE=function(f,c){f=f>>>0,c||_(f,2,this.length);let I=this[f]|this[f+1]<<8;return I&32768?I|4294901760:I},s.prototype.readInt16BE=function(f,c){f=f>>>0,c||_(f,2,this.length);let I=this[f+1]|this[f]<<8;return I&32768?I|4294901760:I},s.prototype.readInt32LE=function(f,c){return f=f>>>0,c||_(f,4,this.length),this[f]|this[f+1]<<8|this[f+2]<<16|this[f+3]<<24},s.prototype.readInt32BE=function(f,c){return f=f>>>0,c||_(f,4,this.length),this[f]<<24|this[f+1]<<16|this[f+2]<<8|this[f+3]},s.prototype.readBigInt64LE=Ue(function(f){f=f>>>0,be(f,"offset");let c=this[f],I=this[f+7];(c===void 0||I===void 0)&&$(f,this.length-8);let B=this[f+4]+this[f+5]*2**8+this[f+6]*2**16+(I<<24);return(BigInt(B)<<BigInt(32))+BigInt(c+this[++f]*2**8+this[++f]*2**16+this[++f]*2**24)}),s.prototype.readBigInt64BE=Ue(function(f){f=f>>>0,be(f,"offset");let c=this[f],I=this[f+7];(c===void 0||I===void 0)&&$(f,this.length-8);let B=(c<<24)+this[++f]*2**16+this[++f]*2**8+this[++f];return(BigInt(B)<<BigInt(32))+BigInt(this[++f]*2**24+this[++f]*2**16+this[++f]*2**8+I)}),s.prototype.readFloatLE=function(f,c){return f=f>>>0,c||_(f,4,this.length),e.read(this,f,!0,23,4)},s.prototype.readFloatBE=function(f,c){return f=f>>>0,c||_(f,4,this.length),e.read(this,f,!1,23,4)},s.prototype.readDoubleLE=function(f,c){return f=f>>>0,c||_(f,8,this.length),e.read(this,f,!0,52,8)},s.prototype.readDoubleBE=function(f,c){return f=f>>>0,c||_(f,8,this.length),e.read(this,f,!1,52,8)};function M(v,f,c,I,B,q){if(!s.isBuffer(v))throw new TypeError(\'"buffer" argument must be a Buffer instance\');if(f>B||f<q)throw new RangeError(\'"value" argument is out of bounds\');if(c+I>v.length)throw new RangeError("Index out of range")}s.prototype.writeUintLE=s.prototype.writeUIntLE=function(f,c,I,B){if(f=+f,c=c>>>0,I=I>>>0,!B){let ve=Math.pow(2,8*I)-1;M(this,f,c,I,ve,0)}let q=1,ee=0;for(this[c]=f&255;++ee<I&&(q*=256);)this[c+ee]=f/q&255;return c+I},s.prototype.writeUintBE=s.prototype.writeUIntBE=function(f,c,I,B){if(f=+f,c=c>>>0,I=I>>>0,!B){let ve=Math.pow(2,8*I)-1;M(this,f,c,I,ve,0)}let q=I-1,ee=1;for(this[c+q]=f&255;--q>=0&&(ee*=256);)this[c+q]=f/ee&255;return c+I},s.prototype.writeUint8=s.prototype.writeUInt8=function(f,c,I){return f=+f,c=c>>>0,I||M(this,f,c,1,255,0),this[c]=f&255,c+1},s.prototype.writeUint16LE=s.prototype.writeUInt16LE=function(f,c,I){return f=+f,c=c>>>0,I||M(this,f,c,2,65535,0),this[c]=f&255,this[c+1]=f>>>8,c+2},s.prototype.writeUint16BE=s.prototype.writeUInt16BE=function(f,c,I){return f=+f,c=c>>>0,I||M(this,f,c,2,65535,0),this[c]=f>>>8,this[c+1]=f&255,c+2},s.prototype.writeUint32LE=s.prototype.writeUInt32LE=function(f,c,I){return f=+f,c=c>>>0,I||M(this,f,c,4,4294967295,0),this[c+3]=f>>>24,this[c+2]=f>>>16,this[c+1]=f>>>8,this[c]=f&255,c+4},s.prototype.writeUint32BE=s.prototype.writeUInt32BE=function(f,c,I){return f=+f,c=c>>>0,I||M(this,f,c,4,4294967295,0),this[c]=f>>>24,this[c+1]=f>>>16,this[c+2]=f>>>8,this[c+3]=f&255,c+4};function D(v,f,c,I,B){ye(f,I,B,v,c,7);let q=Number(f&BigInt(4294967295));v[c++]=q,q=q>>8,v[c++]=q,q=q>>8,v[c++]=q,q=q>>8,v[c++]=q;let ee=Number(f>>BigInt(32)&BigInt(4294967295));return v[c++]=ee,ee=ee>>8,v[c++]=ee,ee=ee>>8,v[c++]=ee,ee=ee>>8,v[c++]=ee,c}function R(v,f,c,I,B){ye(f,I,B,v,c,7);let q=Number(f&BigInt(4294967295));v[c+7]=q,q=q>>8,v[c+6]=q,q=q>>8,v[c+5]=q,q=q>>8,v[c+4]=q;let ee=Number(f>>BigInt(32)&BigInt(4294967295));return v[c+3]=ee,ee=ee>>8,v[c+2]=ee,ee=ee>>8,v[c+1]=ee,ee=ee>>8,v[c]=ee,c+8}s.prototype.writeBigUInt64LE=Ue(function(f,c=0){return D(this,f,c,BigInt(0),BigInt("0xffffffffffffffff"))}),s.prototype.writeBigUInt64BE=Ue(function(f,c=0){return R(this,f,c,BigInt(0),BigInt("0xffffffffffffffff"))}),s.prototype.writeIntLE=function(f,c,I,B){if(f=+f,c=c>>>0,!B){let De=Math.pow(2,8*I-1);M(this,f,c,I,De-1,-De)}let q=0,ee=1,ve=0;for(this[c]=f&255;++q<I&&(ee*=256);)f<0&&ve===0&&this[c+q-1]!==0&&(ve=1),this[c+q]=(f/ee>>0)-ve&255;return c+I},s.prototype.writeIntBE=function(f,c,I,B){if(f=+f,c=c>>>0,!B){let De=Math.pow(2,8*I-1);M(this,f,c,I,De-1,-De)}let q=I-1,ee=1,ve=0;for(this[c+q]=f&255;--q>=0&&(ee*=256);)f<0&&ve===0&&this[c+q+1]!==0&&(ve=1),this[c+q]=(f/ee>>0)-ve&255;return c+I},s.prototype.writeInt8=function(f,c,I){return f=+f,c=c>>>0,I||M(this,f,c,1,127,-128),f<0&&(f=255+f+1),this[c]=f&255,c+1},s.prototype.writeInt16LE=function(f,c,I){return f=+f,c=c>>>0,I||M(this,f,c,2,32767,-32768),this[c]=f&255,this[c+1]=f>>>8,c+2},s.prototype.writeInt16BE=function(f,c,I){return f=+f,c=c>>>0,I||M(this,f,c,2,32767,-32768),this[c]=f>>>8,this[c+1]=f&255,c+2},s.prototype.writeInt32LE=function(f,c,I){return f=+f,c=c>>>0,I||M(this,f,c,4,2147483647,-2147483648),this[c]=f&255,this[c+1]=f>>>8,this[c+2]=f>>>16,this[c+3]=f>>>24,c+4},s.prototype.writeInt32BE=function(f,c,I){return f=+f,c=c>>>0,I||M(this,f,c,4,2147483647,-2147483648),f<0&&(f=4294967295+f+1),this[c]=f>>>24,this[c+1]=f>>>16,this[c+2]=f>>>8,this[c+3]=f&255,c+4},s.prototype.writeBigInt64LE=Ue(function(f,c=0){return D(this,f,c,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),s.prototype.writeBigInt64BE=Ue(function(f,c=0){return R(this,f,c,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function U(v,f,c,I,B,q){if(c+I>v.length)throw new RangeError("Index out of range");if(c<0)throw new RangeError("Index out of range")}function X(v,f,c,I,B){return f=+f,c=c>>>0,B||U(v,f,c,4),e.write(v,f,c,I,23,4),c+4}s.prototype.writeFloatLE=function(f,c,I){return X(this,f,c,!0,I)},s.prototype.writeFloatBE=function(f,c,I){return X(this,f,c,!1,I)};function le(v,f,c,I,B){return f=+f,c=c>>>0,B||U(v,f,c,8),e.write(v,f,c,I,52,8),c+8}s.prototype.writeDoubleLE=function(f,c,I){return le(this,f,c,!0,I)},s.prototype.writeDoubleBE=function(f,c,I){return le(this,f,c,!1,I)},s.prototype.copy=function(f,c,I,B){if(!s.isBuffer(f))throw new TypeError("argument should be a Buffer");if(I||(I=0),!B&&B!==0&&(B=this.length),c>=f.length&&(c=f.length),c||(c=0),B>0&&B<I&&(B=I),B===I||f.length===0||this.length===0)return 0;if(c<0)throw new RangeError("targetStart out of bounds");if(I<0||I>=this.length)throw new RangeError("Index out of range");if(B<0)throw new RangeError("sourceEnd out of bounds");B>this.length&&(B=this.length),f.length-c<B-I&&(B=f.length-c+I);let q=B-I;return this===f&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(c,I,B):Uint8Array.prototype.set.call(f,this.subarray(I,B),c),q},s.prototype.fill=function(f,c,I,B){if(typeof f=="string"){if(typeof c=="string"?(B=c,c=0,I=this.length):typeof I=="string"&&(B=I,I=this.length),B!==void 0&&typeof B!="string")throw new TypeError("encoding must be a string");if(typeof B=="string"&&!s.isEncoding(B))throw new TypeError("Unknown encoding: "+B);if(f.length===1){let ee=f.charCodeAt(0);(B==="utf8"&&ee<128||B==="latin1")&&(f=ee)}}else typeof f=="number"?f=f&255:typeof f=="boolean"&&(f=Number(f));if(c<0||this.length<c||this.length<I)throw new RangeError("Out of range index");if(I<=c)return this;c=c>>>0,I=I===void 0?this.length:I>>>0,f||(f=0);let q;if(typeof f=="number")for(q=c;q<I;++q)this[q]=f;else{let ee=s.isBuffer(f)?f:s.from(f,B),ve=ee.length;if(ve===0)throw new TypeError(\'The value "\'+f+\'" is invalid for argument "value"\');for(q=0;q<I-c;++q)this[q+c]=ee[q%ve]}return this};let ne={};function V(v,f,c){ne[v]=class extends c{constructor(){super(),Object.defineProperty(this,"message",{value:f.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${v}]`,this.stack,delete this.name}get code(){return v}set code(B){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:B,writable:!0})}toString(){return`${this.name} [${v}]: ${this.message}`}}}V("ERR_BUFFER_OUT_OF_BOUNDS",function(v){return v?`${v} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),V("ERR_INVALID_ARG_TYPE",function(v,f){return`The "${v}" argument must be of type number. Received type ${typeof f}`},TypeError),V("ERR_OUT_OF_RANGE",function(v,f,c){let I=`The value of "${v}" is out of range.`,B=c;return Number.isInteger(c)&&Math.abs(c)>2**32?B=H(String(c)):typeof c=="bigint"&&(B=String(c),(c>BigInt(2)**BigInt(32)||c<-(BigInt(2)**BigInt(32)))&&(B=H(B)),B+="n"),I+=` It must be ${f}. Received ${B}`,I},RangeError);function H(v){let f="",c=v.length,I=v[0]==="-"?1:0;for(;c>=I+4;c-=3)f=`_${v.slice(c-3,c)}${f}`;return`${v.slice(0,c)}${f}`}function re(v,f,c){be(f,"offset"),(v[f]===void 0||v[f+c]===void 0)&&$(f,v.length-(c+1))}function ye(v,f,c,I,B,q){if(v>c||v<f){let ee=typeof f=="bigint"?"n":"",ve;throw f===0||f===BigInt(0)?ve=`>= 0${ee} and < 2${ee} ** ${(q+1)*8}${ee}`:ve=`>= -(2${ee} ** ${(q+1)*8-1}${ee}) and < 2 ** ${(q+1)*8-1}${ee}`,new ne.ERR_OUT_OF_RANGE("value",ve,v)}re(I,B,q)}function be(v,f){if(typeof v!="number")throw new ne.ERR_INVALID_ARG_TYPE(f,"number",v)}function $(v,f,c){throw Math.floor(v)!==v?(be(v,c),new ne.ERR_OUT_OF_RANGE("offset","an integer",v)):f<0?new ne.ERR_BUFFER_OUT_OF_BOUNDS:new ne.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${f}`,v)}let j=/[^+/0-9A-Za-z-_]/g;function K(v){if(v=v.split("=")[0],v=v.trim().replace(j,""),v.length<2)return"";for(;v.length%4!==0;)v=v+"=";return v}function oe(v,f){f=f||1/0;let c,I=v.length,B=null,q=[];for(let ee=0;ee<I;++ee){if(c=v.charCodeAt(ee),c>55295&&c<57344){if(!B){if(c>56319){(f-=3)>-1&&q.push(239,191,189);continue}else if(ee+1===I){(f-=3)>-1&&q.push(239,191,189);continue}B=c;continue}if(c<56320){(f-=3)>-1&&q.push(239,191,189),B=c;continue}c=(B-55296<<10|c-56320)+65536}else B&&(f-=3)>-1&&q.push(239,191,189);if(B=null,c<128){if((f-=1)<0)break;q.push(c)}else if(c<2048){if((f-=2)<0)break;q.push(c>>6|192,c&63|128)}else if(c<65536){if((f-=3)<0)break;q.push(c>>12|224,c>>6&63|128,c&63|128)}else if(c<1114112){if((f-=4)<0)break;q.push(c>>18|240,c>>12&63|128,c>>6&63|128,c&63|128)}else throw new Error("Invalid code point")}return q}function ce(v){let f=[];for(let c=0;c<v.length;++c)f.push(v.charCodeAt(c)&255);return f}function C(v,f){let c,I,B,q=[];for(let ee=0;ee<v.length&&!((f-=2)<0);++ee)c=v.charCodeAt(ee),I=c>>8,B=c%256,q.push(B),q.push(I);return q}function k(v){return t.toByteArray(K(v))}function te(v,f,c,I){let B;for(B=0;B<I&&!(B+c>=f.length||B>=v.length);++B)f[B+c]=v[B];return B}function se(v,f){return v instanceof f||v!=null&&v.constructor!=null&&v.constructor.name!=null&&v.constructor.name===f.name}function Z(v){return v!==v}let Ae=function(){let v="0123456789abcdef",f=new Array(256);for(let c=0;c<16;++c){let I=c*16;for(let B=0;B<16;++B)f[I+B]=v[c]+v[B]}return f}();function Ue(v){return typeof BigInt=="undefined"?Le:v}function Le(){throw new Error("BigInt not supported")}return Ot}var mr,rf,an,nf,Ot,of,Ii=yt(()=>{mr={},rf=!1;an={},nf=!1;Ot={},of=!1});function cd(){if(sf)return fn;sf=!0;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(x,z,G){return Function.prototype.apply.call(x,z,G)},r;t&&typeof t.ownKeys=="function"?r=t.ownKeys:Object.getOwnPropertySymbols?r=function(x){return Object.getOwnPropertyNames(x).concat(Object.getOwnPropertySymbols(x))}:r=function(x){return Object.getOwnPropertyNames(x)};function n(A){console&&console.warn&&console.warn(A)}var o=Number.isNaN||function(x){return x!==x};function i(){i.init.call(this)}fn=i,fn.once=S,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var s=10;function a(A){if(typeof A!="function")throw new TypeError(\'The "listener" argument must be of type Function. Received type \'+typeof A)}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(A){if(typeof A!="number"||A<0||o(A))throw new RangeError(\'The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received \'+A+".");s=A}}),i.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(x){if(typeof x!="number"||x<0||o(x))throw new RangeError(\'The value of "n" is out of range. It must be a non-negative number. Received \'+x+".");return this._maxListeners=x,this};function l(A){return A._maxListeners===void 0?i.defaultMaxListeners:A._maxListeners}i.prototype.getMaxListeners=function(){return l(this)},i.prototype.emit=function(x){for(var z=[],G=1;G<arguments.length;G++)z.push(arguments[G]);var L=x==="error",ie=this._events;if(ie!==void 0)L=L&&ie.error===void 0;else if(!L)return!1;if(L){var N;if(z.length>0&&(N=z[0]),N instanceof Error)throw N;var F=new Error("Unhandled error."+(N?" ("+N.message+")":""));throw F.context=N,F}var Y=ie[x];if(Y===void 0)return!1;if(typeof Y=="function")e(Y,this,z);else for(var W=Y.length,fe=g(Y,W),G=0;G<W;++G)e(fe[G],this,z);return!0};function u(A,x,z,G){var L,ie,N;if(a(z),ie=A._events,ie===void 0?(ie=A._events=Object.create(null),A._eventsCount=0):(ie.newListener!==void 0&&(A.emit("newListener",x,z.listener?z.listener:z),ie=A._events),N=ie[x]),N===void 0)N=ie[x]=z,++A._eventsCount;else if(typeof N=="function"?N=ie[x]=G?[z,N]:[N,z]:G?N.unshift(z):N.push(z),L=l(A),L>0&&N.length>L&&!N.warned){N.warned=!0;var F=new Error("Possible EventEmitter memory leak detected. "+N.length+" "+String(x)+" listeners added. Use emitter.setMaxListeners() to increase limit");F.name="MaxListenersExceededWarning",F.emitter=A,F.type=x,F.count=N.length,n(F)}return A}i.prototype.addListener=function(x,z){return u(this,x,z,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(x,z){return u(this,x,z,!0)};function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(A,x,z){var G={fired:!1,wrapFn:void 0,target:A,type:x,listener:z},L=h.bind(G);return L.listener=z,G.wrapFn=L,L}i.prototype.once=function(x,z){return a(z),this.on(x,d(this,x,z)),this},i.prototype.prependOnceListener=function(x,z){return a(z),this.prependListener(x,d(this,x,z)),this},i.prototype.removeListener=function(x,z){var G,L,ie,N,F;if(a(z),L=this._events,L===void 0)return this;if(G=L[x],G===void 0)return this;if(G===z||G.listener===z)--this._eventsCount===0?this._events=Object.create(null):(delete L[x],L.removeListener&&this.emit("removeListener",x,G.listener||z));else if(typeof G!="function"){for(ie=-1,N=G.length-1;N>=0;N--)if(G[N]===z||G[N].listener===z){F=G[N].listener,ie=N;break}if(ie<0)return this;ie===0?G.shift():m(G,ie),G.length===1&&(L[x]=G[0]),L.removeListener!==void 0&&this.emit("removeListener",x,F||z)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(x){var z,G,L;if(G=this._events,G===void 0)return this;if(G.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):G[x]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete G[x]),this;if(arguments.length===0){var ie=Object.keys(G),N;for(L=0;L<ie.length;++L)N=ie[L],N!=="removeListener"&&this.removeAllListeners(N);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(z=G[x],typeof z=="function")this.removeListener(x,z);else if(z!==void 0)for(L=z.length-1;L>=0;L--)this.removeListener(x,z[L]);return this};function p(A,x,z){var G=A._events;if(G===void 0)return[];var L=G[x];return L===void 0?[]:typeof L=="function"?z?[L.listener||L]:[L]:z?y(L):g(L,L.length)}i.prototype.listeners=function(x){return p(this,x,!0)},i.prototype.rawListeners=function(x){return p(this,x,!1)},i.listenerCount=function(A,x){return typeof A.listenerCount=="function"?A.listenerCount(x):w.call(A,x)},i.prototype.listenerCount=w;function w(A){var x=this._events;if(x!==void 0){var z=x[A];if(typeof z=="function")return 1;if(z!==void 0)return z.length}return 0}i.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]};function g(A,x){for(var z=new Array(x),G=0;G<x;++G)z[G]=A[G];return z}function m(A,x){for(;x+1<A.length;x++)A[x]=A[x+1];A.pop()}function y(A){for(var x=new Array(A.length),z=0;z<x.length;++z)x[z]=A[z].listener||A[z];return x}function S(A,x){return new Promise(function(z,G){function L(N){A.removeListener(x,ie),G(N)}function ie(){typeof A.removeListener=="function"&&A.removeListener("error",L),z([].slice.call(arguments))}E(A,x,ie,{once:!0}),x!=="error"&&b(A,L,{once:!0})})}function b(A,x,z){typeof A.on=="function"&&E(A,"error",x,z)}function E(A,x,z,G){if(typeof A.on=="function")G.once?A.once(x,z):A.on(x,z);else if(typeof A.addEventListener=="function")A.addEventListener(x,function L(ie){G.once&&A.removeEventListener(x,L),z(ie)});else throw new TypeError(\'The "emitter" argument must be of type EventEmitter. Received type \'+typeof A)}return fn}var fn,sf,ut,ib,ob,sb,ab,fb,lb,af=yt(()=>{fn={},sf=!1;ut=cd();ut.once;ut.once=function(t,e){return new Promise((r,n)=>{function o(...s){i!==void 0&&t.removeListener("error",i),r(s)}let i;e!=="error"&&(i=s=>{t.removeListener(name,o),n(s)},t.once("error",i)),t.once(e,o)})};ut.on=function(t,e){let r=[],n=[],o=null,i=!1,s={async next(){let u=r.shift();if(u)return createIterResult(u,!1);if(o){let h=Promise.reject(o);return o=null,h}return i?createIterResult(void 0,!0):new Promise((h,d)=>n.push({resolve:h,reject:d}))},async return(){t.removeListener(e,a),t.removeListener("error",l),i=!0;for(let u of n)u.resolve(createIterResult(void 0,!0));return createIterResult(void 0,!0)},throw(u){o=u,t.removeListener(e,a),t.removeListener("error",l)},[Symbol.asyncIterator](){return this}};return t.on(e,a),t.on("error",l),s;function a(...u){let h=n.shift();h?h.resolve(createIterResult(u,!1)):r.push(u)}function l(u){i=!0;let h=n.shift();h?h.reject(u):o=u,s.return()}};({EventEmitter:ib,defaultMaxListeners:ob,init:sb,listenerCount:ab,on:fb,once:lb}=ut)});function Di(t){throw new Error("Node.js process "+t+" is not supported by JSPM core outside of Node.js")}function ud(){!Ht||!Dt||(Ht=!1,Dt.length?dt=Dt.concat(dt):ln=-1,dt.length&&ff())}function ff(){if(!Ht){var t=setTimeout(ud,0);Ht=!0;for(var e=dt.length;e;){for(Dt=dt,dt=[];++ln<e;)Dt&&Dt[ln].run();ln=-1,e=dt.length}Dt=null,Ht=!1,clearTimeout(t)}}function dd(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];dt.push(new lf(t,e)),dt.length===1&&!Ht&&setTimeout(ff,0)}function lf(t,e){this.fun=t,this.array=e}function We(){}function Od(t){Di("_linkedBinding")}function Ud(t){Di("dlopen")}function Md(){return[]}function Bd(){return[]}function Vd(t,e){if(!t)throw new Error(e||"assertion error")}function qd(){return!1}function uh(){return St.now()/1e3}function Oi(t){var e=Math.floor((Date.now()-St.now())*.001),r=St.now()*.001,n=Math.floor(r)+e,o=Math.floor(r%1*1e9);return t&&(n=n-t[0],o=o-t[1],o<0&&(n--,o+=Ri)),[n,o]}function vt(){return et}function _h(t){return[]}var dt,Ht,Dt,ln,hd,pd,yd,gd,wd,bd,md,Sd,vd,Ed,_d,xd,Ad,Id,Td,Rd,Dd,Nd,Pd,kd,Ld,Ni,Cd,Fd,$d,zd,Wd,jd,Gd,Hd,Yd,Kd,Jd,Xd,Zd,Qd,eh,th,rh,nh,ih,oh,sh,ah,fh,lh,ch,St,Ti,Ri,dh,hh,ph,yh,gh,wh,bh,mh,Sh,vh,Eh,et,Pi=yt(()=>{dt=[],Ht=!1,ln=-1;lf.prototype.run=function(){this.fun.apply(null,this.array)};hd="browser",pd="x64",yd="browser",gd={PATH:"/usr/bin",LANG:navigator.language+".UTF-8",PWD:"/",HOME:"/home",TMP:"/tmp"},wd=["/usr/bin/node"],bd=[],md="v16.8.0",Sd={},vd=function(t,e){console.warn((e?e+": ":"")+t)},Ed=function(t){Di("binding")},_d=function(t){return 0},xd=function(){return"/"},Ad=function(t){},Id={name:"node",sourceUrl:"",headersUrl:"",libUrl:""};Td=We,Rd=[];Dd={},Nd=!1,Pd={};kd=We,Ld=We,Ni=function(){return{}},Cd=Ni,Fd=Ni,$d=We,zd=We,Wd=We,jd={};Gd={inspector:!1,debug:!1,uv:!1,ipv6:!1,tls_alpn:!1,tls_sni:!1,tls_ocsp:!1,tls:!1,cached_builtins:!0},Hd=We,Yd=We;Kd=We,Jd=We,Xd=We,Zd=We,Qd=We,eh=void 0,th=void 0,rh=void 0,nh=We,ih=2,oh=1,sh="/bin/usr/node",ah=9229,fh="node",lh=[],ch=We,St={now:typeof performance!="undefined"?performance.now.bind(performance):void 0,timing:typeof performance!="undefined"?performance.timing:void 0};St.now===void 0&&(Ti=Date.now(),St.timing&&St.timing.navigationStart&&(Ti=St.timing.navigationStart),St.now=()=>Date.now()-Ti);Ri=1e9;Oi.bigint=function(t){var e=Oi(t);return typeof BigInt=="undefined"?e[0]*Ri+e[1]:BigInt(e[0]*Ri)+BigInt(e[1])};dh=10,hh={},ph=0;yh=vt,gh=vt,wh=vt,bh=vt,mh=vt,Sh=We,vh=vt,Eh=vt;et={version:md,versions:Sd,arch:pd,platform:yd,release:Id,_rawDebug:Td,moduleLoadList:Rd,binding:Ed,_linkedBinding:Od,_events:hh,_eventsCount:ph,_maxListeners:dh,on:vt,addListener:yh,once:gh,off:wh,removeListener:bh,removeAllListeners:mh,emit:Sh,prependListener:vh,prependOnceListener:Eh,listeners:_h,domain:Dd,_exiting:Nd,config:Pd,dlopen:Ud,uptime:uh,_getActiveRequests:Md,_getActiveHandles:Bd,reallyExit:kd,_kill:Ld,cpuUsage:Ni,resourceUsage:Cd,memoryUsage:Fd,kill:$d,exit:zd,openStdin:Wd,allowedNodeEnvironmentFlags:jd,assert:Vd,features:Gd,_fatalExceptions:Hd,setUncaughtExceptionCaptureCallback:Yd,hasUncaughtExceptionCaptureCallback:qd,emitWarning:vd,nextTick:dd,_tickCallback:Kd,_debugProcess:Jd,_debugEnd:Xd,_startProfilerIdleNotifier:Zd,_stopProfilerIdleNotifier:Qd,stdout:eh,stdin:rh,stderr:th,abort:nh,umask:_d,chdir:Ad,cwd:xd,env:gd,title:hd,argv:wd,execArgv:bd,pid:ih,ppid:oh,execPath:sh,debugPort:ah,hrtime:Oi,argv0:fh,_preload_modules:lh,setSourceMapsEnabled:ch}});function xh(){if(cf)return Sr;cf=!0;var t=at(),e=t.Buffer;function r(o,i){for(var s in o)i[s]=o[s]}e.from&&e.alloc&&e.allocUnsafe&&e.allocUnsafeSlow?Sr=t:(r(t,Sr),Sr.Buffer=n);function n(o,i,s){return e(o,i,s)}return n.prototype=Object.create(e.prototype),r(e,n),n.from=function(o,i,s){if(typeof o=="number")throw new TypeError("Argument must not be a number");return e(o,i,s)},n.alloc=function(o,i,s){if(typeof o!="number")throw new TypeError("Argument must be a number");var a=e(o);return i!==void 0?typeof s=="string"?a.fill(i,s):a.fill(i):a.fill(0),a},n.allocUnsafe=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return e(o)},n.allocUnsafeSlow=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(o)},Sr}function Ah(){if(uf)return Ui;uf=!0;var t=xh().Buffer,e=t.isEncoding||function(S){switch(S=""+S,S&&S.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function r(S){if(!S)return"utf8";for(var b;;)switch(S){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return S;default:if(b)return;S=(""+S).toLowerCase(),b=!0}}function n(S){var b=r(S);if(typeof b!="string"&&(t.isEncoding===e||!e(S)))throw new Error("Unknown encoding: "+S);return b||S}Ui.StringDecoder=o;function o(S){this.encoding=n(S);var b;switch(this.encoding){case"utf16le":this.text=d,this.end=p,b=4;break;case"utf8":this.fillLast=l,b=4;break;case"base64":this.text=w,this.end=g,b=3;break;default:this.write=m,this.end=y;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=t.allocUnsafe(b)}o.prototype.write=function(S){if(S.length===0)return"";var b,E;if(this.lastNeed){if(b=this.fillLast(S),b===void 0)return"";E=this.lastNeed,this.lastNeed=0}else E=0;return E<S.length?b?b+this.text(S,E):this.text(S,E):b||""},o.prototype.end=h,o.prototype.text=u,o.prototype.fillLast=function(S){if(this.lastNeed<=S.length)return S.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);S.copy(this.lastChar,this.lastTotal-this.lastNeed,0,S.length),this.lastNeed-=S.length};function i(S){return S<=127?0:S>>5===6?2:S>>4===14?3:S>>3===30?4:S>>6===2?-1:-2}function s(S,b,E){var A=b.length-1;if(A<E)return 0;var x=i(b[A]);return x>=0?(x>0&&(S.lastNeed=x-1),x):--A<E||x===-2?0:(x=i(b[A]),x>=0?(x>0&&(S.lastNeed=x-2),x):--A<E||x===-2?0:(x=i(b[A]),x>=0?(x>0&&(x===2?x=0:S.lastNeed=x-3),x):0))}function a(S,b,E){if((b[0]&192)!==128)return S.lastNeed=0,"\\uFFFD";if(S.lastNeed>1&&b.length>1){if((b[1]&192)!==128)return S.lastNeed=1,"\\uFFFD";if(S.lastNeed>2&&b.length>2&&(b[2]&192)!==128)return S.lastNeed=2,"\\uFFFD"}}function l(S){var b=this.lastTotal-this.lastNeed,E=a(this,S);if(E!==void 0)return E;if(this.lastNeed<=S.length)return S.copy(this.lastChar,b,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);S.copy(this.lastChar,b,0,S.length),this.lastNeed-=S.length}function u(S,b){var E=s(this,S,b);if(!this.lastNeed)return S.toString("utf8",b);this.lastTotal=E;var A=S.length-(E-this.lastNeed);return S.copy(this.lastChar,0,A),S.toString("utf8",b,A)}function h(S){var b=S&&S.length?this.write(S):"";return this.lastNeed?b+"\\uFFFD":b}function d(S,b){if((S.length-b)%2===0){var E=S.toString("utf16le",b);if(E){var A=E.charCodeAt(E.length-1);if(A>=55296&&A<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=S[S.length-2],this.lastChar[1]=S[S.length-1],E.slice(0,-1)}return E}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=S[S.length-1],S.toString("utf16le",b,S.length-1)}function p(S){var b=S&&S.length?this.write(S):"";if(this.lastNeed){var E=this.lastTotal-this.lastNeed;return b+this.lastChar.toString("utf16le",0,E)}return b}function w(S,b){var E=(S.length-b)%3;return E===0?S.toString("base64",b):(this.lastNeed=3-E,this.lastTotal=3,E===1?this.lastChar[0]=S[S.length-1]:(this.lastChar[0]=S[S.length-2],this.lastChar[1]=S[S.length-1]),S.toString("base64",b,S.length-E))}function g(S){var b=S&&S.length?this.write(S):"";return this.lastNeed?b+this.lastChar.toString("base64",0,3-this.lastNeed):b}function m(S){return S.toString(this.encoding)}function y(S){return S&&S.length?this.write(S):""}return Ui}var Sr,cf,Ui,uf,cn,hb,df=yt(()=>{Ii();Sr={},cf=!1;Ui={},uf=!1;cn=Ah();cn.StringDecoder;hb=cn.StringDecoder});function eo(){return hf||(hf=!0,Mi=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},r=Symbol("test"),n=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var o=42;e[r]=o;for(r in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var i=Object.getOwnPropertySymbols(e);if(i.length!==1||i[0]!==r||!Object.prototype.propertyIsEnumerable.call(e,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var s=Object.getOwnPropertyDescriptor(e,r);if(s.value!==o||s.enumerable!==!0)return!1}return!0}),Mi}function Ih(){return pf||(pf=!0,Bi=Error),Bi}function Th(){return yf||(yf=!0,ki=EvalError),ki}function Rh(){return gf||(gf=!0,Li=RangeError),Li}function Oh(){return wf||(wf=!0,Ci=ReferenceError),Ci}function Mf(){return bf||(bf=!0,Fi=SyntaxError),Fi}function un(){return mf||(mf=!0,$i=TypeError),$i}function Dh(){return Sf||(Sf=!0,zi=URIError),zi}function Nh(){if(vf)return Wi;vf=!0;var t=typeof Symbol!="undefined"&&Symbol,e=eo();return Wi=function(){return typeof t!="function"||typeof Symbol!="function"||typeof t("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},Wi}function Ph(){if(Ef)return ji;Ef=!0;var t={__proto__:null,foo:{}},e=Object;return ji=function(){return{__proto__:t}.foo===t.foo&&!(t instanceof e)},ji}function Uh(){if(_f)return Vi;_f=!0;var t="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,r=Math.max,n="[object Function]",o=function(l,u){for(var h=[],d=0;d<l.length;d+=1)h[d]=l[d];for(var p=0;p<u.length;p+=1)h[p+l.length]=u[p];return h},i=function(l,u){for(var h=[],d=u,p=0;d<l.length;d+=1,p+=1)h[p]=l[d];return h},s=function(a,l){for(var u="",h=0;h<a.length;h+=1)u+=a[h],h+1<a.length&&(u+=l);return u};return Vi=function(l){var u=this;if(typeof u!="function"||e.apply(u)!==n)throw new TypeError(t+u);for(var h=i(arguments,1),d,p=function(){if(this instanceof d){var S=u.apply(this,o(h,arguments));return Object(S)===S?S:this}return u.apply(l,o(h,arguments))},w=r(0,u.length-h.length),g=[],m=0;m<w;m++)g[m]="$"+m;if(d=Function("binder","return function ("+s(g,",")+"){ return binder.apply(this,arguments); }")(p),u.prototype){var y=function(){};y.prototype=u.prototype,d.prototype=new y,y.prototype=null}return d},Vi}function to(){if(xf)return Gi;xf=!0;var t=Uh();return Gi=Function.prototype.bind||t,Gi}function Mh(){if(Af)return Hi;Af=!0;var t=Function.prototype.call,e=Object.prototype.hasOwnProperty,r=to();return Hi=r.call(t,e),Hi}function Er(){if(If)return Yi;If=!0;var t,e=Ih(),r=Th(),n=Rh(),o=Oh(),i=Mf(),s=un(),a=Dh(),l=Function,u=function(ge){try{return l(\'"use strict"; return (\'+ge+").constructor;")()}catch(O){}},h=Object.getOwnPropertyDescriptor;if(h)try{h({},"")}catch(ge){h=null}var d=function(){throw new s},p=h?function(){try{return arguments.callee,d}catch(ge){try{return h(arguments,"callee").get}catch(O){return d}}}():d,w=Nh()(),g=Ph()(),m=Object.getPrototypeOf||(g?function(ge){return ge.__proto__}:null),y={},S=typeof Uint8Array=="undefined"||!m?t:m(Uint8Array),b={__proto__:null,"%AggregateError%":typeof AggregateError=="undefined"?t:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer=="undefined"?t:ArrayBuffer,"%ArrayIteratorPrototype%":w&&m?m([][Symbol.iterator]()):t,"%AsyncFromSyncIteratorPrototype%":t,"%AsyncFunction%":y,"%AsyncGenerator%":y,"%AsyncGeneratorFunction%":y,"%AsyncIteratorPrototype%":y,"%Atomics%":typeof Atomics=="undefined"?t:Atomics,"%BigInt%":typeof BigInt=="undefined"?t:BigInt,"%BigInt64Array%":typeof BigInt64Array=="undefined"?t:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array=="undefined"?t:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView=="undefined"?t:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":e,"%eval%":eval,"%EvalError%":r,"%Float32Array%":typeof Float32Array=="undefined"?t:Float32Array,"%Float64Array%":typeof Float64Array=="undefined"?t:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry=="undefined"?t:FinalizationRegistry,"%Function%":l,"%GeneratorFunction%":y,"%Int8Array%":typeof Int8Array=="undefined"?t:Int8Array,"%Int16Array%":typeof Int16Array=="undefined"?t:Int16Array,"%Int32Array%":typeof Int32Array=="undefined"?t:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":w&&m?m(m([][Symbol.iterator]())):t,"%JSON%":typeof JSON=="object"?JSON:t,"%Map%":typeof Map=="undefined"?t:Map,"%MapIteratorPrototype%":typeof Map=="undefined"||!w||!m?t:m(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise=="undefined"?t:Promise,"%Proxy%":typeof Proxy=="undefined"?t:Proxy,"%RangeError%":n,"%ReferenceError%":o,"%Reflect%":typeof Reflect=="undefined"?t:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set=="undefined"?t:Set,"%SetIteratorPrototype%":typeof Set=="undefined"||!w||!m?t:m(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer=="undefined"?t:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":w&&m?m(""[Symbol.iterator]()):t,"%Symbol%":w?Symbol:t,"%SyntaxError%":i,"%ThrowTypeError%":p,"%TypedArray%":S,"%TypeError%":s,"%Uint8Array%":typeof Uint8Array=="undefined"?t:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray=="undefined"?t:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array=="undefined"?t:Uint16Array,"%Uint32Array%":typeof Uint32Array=="undefined"?t:Uint32Array,"%URIError%":a,"%WeakMap%":typeof WeakMap=="undefined"?t:WeakMap,"%WeakRef%":typeof WeakRef=="undefined"?t:WeakRef,"%WeakSet%":typeof WeakSet=="undefined"?t:WeakSet};if(m)try{null.error}catch(ge){var E=m(m(ge));b["%Error.prototype%"]=E}var A=function ge(O){var J;if(O==="%AsyncFunction%")J=u("async function () {}");else if(O==="%GeneratorFunction%")J=u("function* () {}");else if(O==="%AsyncGeneratorFunction%")J=u("async function* () {}");else if(O==="%AsyncGenerator%"){var _=ge("%AsyncGeneratorFunction%");_&&(J=_.prototype)}else if(O==="%AsyncIteratorPrototype%"){var M=ge("%AsyncGenerator%");M&&m&&(J=m(M.prototype))}return b[O]=J,J},x={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},z=to(),G=Mh(),L=z.call(Function.call,Array.prototype.concat),ie=z.call(Function.apply,Array.prototype.splice),N=z.call(Function.call,String.prototype.replace),F=z.call(Function.call,String.prototype.slice),Y=z.call(Function.call,RegExp.prototype.exec),W=/[^%.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|(["\'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|%$))/g,fe=/\\\\(\\\\)?/g,ue=function(O){var J=F(O,0,1),_=F(O,-1);if(J==="%"&&_!=="%")throw new i("invalid intrinsic syntax, expected closing `%`");if(_==="%"&&J!=="%")throw new i("invalid intrinsic syntax, expected opening `%`");var M=[];return N(O,W,function(D,R,U,X){M[M.length]=U?N(X,fe,"$1"):R||D}),M},pe=function(O,J){var _=O,M;if(G(x,_)&&(M=x[_],_="%"+M[0]+"%"),G(b,_)){var D=b[_];if(D===y&&(D=A(_)),typeof D=="undefined"&&!J)throw new s("intrinsic "+O+" exists, but is not available. Please file an issue!");return{alias:M,name:_,value:D}}throw new i("intrinsic "+O+" does not exist!")};return Yi=function(O,J){if(typeof O!="string"||O.length===0)throw new s("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof J!="boolean")throw new s(\'"allowMissing" argument must be a boolean\');if(Y(/^%?[^%]*%?$/,O)===null)throw new i("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var _=ue(O),M=_.length>0?_[0]:"",D=pe("%"+M+"%",J),R=D.name,U=D.value,X=!1,le=D.alias;le&&(M=le[0],ie(_,L([0,1],le)));for(var ne=1,V=!0;ne<_.length;ne+=1){var H=_[ne],re=F(H,0,1),ye=F(H,-1);if((re===\'"\'||re==="\'"||re==="`"||ye===\'"\'||ye==="\'"||ye==="`")&&re!==ye)throw new i("property names with quotes must have matching quotes");if((H==="constructor"||!V)&&(X=!0),M+="."+H,R="%"+M+"%",G(b,R))U=b[R];else if(U!=null){if(!(H in U)){if(!J)throw new s("base intrinsic for "+O+" exists, but the property is not available.");return}if(h&&ne+1>=_.length){var be=h(U,H);V=!!be,V&&"get"in be&&!("originalValue"in be.get)?U=be.get:U=U[H]}else V=G(U,H),U=U[H];V&&!X&&(b[R]=U)}}return U},Yi}function ro(){if(Tf)return qi;Tf=!0;var t=Er(),e=t("%Object.defineProperty%",!0)||!1;if(e)try{e({},"a",{value:1})}catch(r){e=!1}return qi=e,qi}function dn(){if(Rf)return Ki;Rf=!0;var t=Er(),e=t("%Object.getOwnPropertyDescriptor%",!0);if(e)try{e([],"length")}catch(r){e=null}return Ki=e,Ki}function Bh(){if(Of)return Ji;Of=!0;var t=ro(),e=Mf(),r=un(),n=dn();return Ji=function(i,s,a){if(!i||typeof i!="object"&&typeof i!="function")throw new r("`obj` must be an object or a function`");if(typeof s!="string"&&typeof s!="symbol")throw new r("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new r("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new r("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new r("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new r("`loose`, if provided, must be a boolean");var l=arguments.length>3?arguments[3]:null,u=arguments.length>4?arguments[4]:null,h=arguments.length>5?arguments[5]:null,d=arguments.length>6?arguments[6]:!1,p=!!n&&n(i,s);if(t)t(i,s,{configurable:h===null&&p?p.configurable:!h,enumerable:l===null&&p?p.enumerable:!l,value:a,writable:u===null&&p?p.writable:!u});else if(d||!l&&!u&&!h)i[s]=a;else throw new e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Ji}function kh(){if(Df)return Xi;Df=!0;var t=ro(),e=function(){return!!t};return e.hasArrayLengthDefineBug=function(){if(!t)return null;try{return t([],"length",{value:1}).length!==1}catch(n){return!0}},Xi=e,Xi}function Lh(){if(Nf)return Zi;Nf=!0;var t=Er(),e=Bh(),r=kh()(),n=dn(),o=un(),i=t("%Math.floor%");return Zi=function(a,l){if(typeof a!="function")throw new o("`fn` is not a function");if(typeof l!="number"||l<0||l>4294967295||i(l)!==l)throw new o("`length` must be a positive 32-bit integer");var u=arguments.length>2&&!!arguments[2],h=!0,d=!0;if("length"in a&&n){var p=n(a,"length");p&&!p.configurable&&(h=!1),p&&!p.writable&&(d=!1)}return(h||d||!u)&&(r?e(a,"length",l,!0,!0):e(a,"length",l)),a},Zi}function no(){if(Pf)return vr;Pf=!0;var t=to(),e=Er(),r=Lh(),n=un(),o=e("%Function.prototype.apply%"),i=e("%Function.prototype.call%"),s=e("%Reflect.apply%",!0)||t.call(i,o),a=ro(),l=e("%Math.max%");vr=function(d){if(typeof d!="function")throw new n("a function is required");var p=s(t,i,arguments);return r(p,1+l(0,d.length-(arguments.length-1)),!0)};var u=function(){return s(t,o,arguments)};return a?a(vr,"apply",{value:u}):vr.apply=u,vr}function io(){if(Uf)return Qi;Uf=!0;var t=Er(),e=no(),r=e(t("String.prototype.indexOf"));return Qi=function(o,i){var s=t(o,!!i);return typeof s=="function"&&r(o,".prototype.")>-1?e(s):s},Qi}var Mi,hf,Bi,pf,ki,yf,Li,gf,Ci,wf,Fi,bf,$i,mf,zi,Sf,Wi,vf,ji,Ef,Vi,_f,Gi,xf,Hi,Af,Yi,If,qi,Tf,Ki,Rf,Ji,Of,Xi,Df,Zi,Nf,vr,Pf,Qi,Uf,oo=yt(()=>{Mi={},hf=!1;Bi={},pf=!1;ki={},yf=!1;Li={},gf=!1;Ci={},wf=!1;Fi={},bf=!1;$i={},mf=!1;zi={},Sf=!1;Wi={},vf=!1;ji={},Ef=!1;Vi={},_f=!1;Gi={},xf=!1;Hi={},Af=!1;Yi={},If=!1;qi={},Tf=!1;Ki={},Rf=!1;Ji={},Of=!1;Xi={},Df=!1;Zi={},Nf=!1;vr={},Pf=!1;Qi={},Uf=!1});function kf(){return Bf||(Bf=!0,typeof Object.create=="function"?hn=function(e,r){r&&(e.super_=r,e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:hn=function(e,r){if(r){e.super_=r;var n=function(){};n.prototype=r.prototype,e.prototype=new n,e.prototype.constructor=e}}),hn}var hn,Bf,so=yt(()=>{hn={},Bf=!1});function bo(){if(Lf)return ao;Lf=!0;var t=eo();return ao=function(){return t()&&!!Symbol.toStringTag},ao}function Ch(){if(Cf)return fo;Cf=!0;var t=bo()(),e=io(),r=e("Object.prototype.toString"),n=function(a){return t&&a&&typeof a=="object"&&Symbol.toStringTag in a?!1:r(a)==="[object Arguments]"},o=function(a){return n(a)?!0:a!==null&&typeof a=="object"&&typeof a.length=="number"&&a.length>=0&&r(a)!=="[object Array]"&&r(a.callee)==="[object Function]"},i=function(){return n(arguments)}();return n.isLegacyArguments=o,fo=i?n:o,fo}function Fh(){if(Ff)return lo;Ff=!0;var t=Object.prototype.toString,e=Function.prototype.toString,r=/^\\s*(?:function)?\\*/,n=bo()(),o=Object.getPrototypeOf,i=function(){if(!n)return!1;try{return Function("return function*() {}")()}catch(a){}},s;return lo=function(l){if(typeof l!="function")return!1;if(r.test(e.call(l)))return!0;if(!n){var u=t.call(l);return u==="[object GeneratorFunction]"}if(!o)return!1;if(typeof s=="undefined"){var h=i();s=h?o(h):!1}return o(l)===s},lo}function $h(){if($f)return co;$f=!0;var t=Function.prototype.toString,e=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,r,n;if(typeof e=="function"&&typeof Object.defineProperty=="function")try{r=Object.defineProperty({},"length",{get:function(){throw n}}),n={},e(function(){throw 42},null,r)}catch(b){b!==n&&(e=null)}else e=null;var o=/^\\s*class\\b/,i=function(E){try{var A=t.call(E);return o.test(A)}catch(x){return!1}},s=function(E){try{return i(E)?!1:(t.call(E),!0)}catch(A){return!1}},a=Object.prototype.toString,l="[object Object]",u="[object Function]",h="[object GeneratorFunction]",d="[object HTMLAllCollection]",p="[object HTML document.all class]",w="[object HTMLCollection]",g=typeof Symbol=="function"&&!!Symbol.toStringTag,m=!(0 in[,]),y=function(){return!1};if(typeof document=="object"){var S=document.all;a.call(S)===a.call(document.all)&&(y=function(E){if((m||!E)&&(typeof E=="undefined"||typeof E=="object"))try{var A=a.call(E);return(A===d||A===p||A===w||A===l)&&E("")==null}catch(x){}return!1})}return co=e?function(E){if(y(E))return!0;if(!E||typeof E!="function"&&typeof E!="object")return!1;try{e(E,null,r)}catch(A){if(A!==n)return!1}return!i(E)&&s(E)}:function(E){if(y(E))return!0;if(!E||typeof E!="function"&&typeof E!="object")return!1;if(g)return s(E);if(i(E))return!1;var A=a.call(E);return A!==u&&A!==h&&!/^\\[object HTML/.test(A)?!1:s(E)},co}function zh(){if(zf)return uo;zf=!0;var t=$h(),e=Object.prototype.toString,r=Object.prototype.hasOwnProperty,n=function(l,u,h){for(var d=0,p=l.length;d<p;d++)r.call(l,d)&&(h==null?u(l[d],d,l):u.call(h,l[d],d,l))},o=function(l,u,h){for(var d=0,p=l.length;d<p;d++)h==null?u(l.charAt(d),d,l):u.call(h,l.charAt(d),d,l)},i=function(l,u,h){for(var d in l)r.call(l,d)&&(h==null?u(l[d],d,l):u.call(h,l[d],d,l))},s=function(l,u,h){if(!t(u))throw new TypeError("iterator must be a function");var d;arguments.length>=3&&(d=h),e.call(l)==="[object Array]"?n(l,u,d):typeof l=="string"?o(l,u,d):i(l,u,d)};return uo=s,uo}function Wh(){return Wf||(Wf=!0,ho=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"]),ho}function Vh(){if(jf)return po;jf=!0;var t=Wh(),e=typeof globalThis=="undefined"?jh:globalThis;return po=function(){for(var n=[],o=0;o<t.length;o++)typeof e[t[o]]=="function"&&(n[n.length]=t[o]);return n},po}function Kf(){if(Vf)return yo;Vf=!0;var t=zh(),e=Vh(),r=no(),n=io(),o=dn(),i=n("Object.prototype.toString"),s=bo()(),a=typeof globalThis=="undefined"?Gh:globalThis,l=e(),u=n("String.prototype.slice"),h=Object.getPrototypeOf,d=n("Array.prototype.indexOf",!0)||function(y,S){for(var b=0;b<y.length;b+=1)if(y[b]===S)return b;return-1},p={__proto__:null};s&&o&&h?t(l,function(m){var y=new a[m];if(Symbol.toStringTag in y){var S=h(y),b=o(S,Symbol.toStringTag);if(!b){var E=h(S);b=o(E,Symbol.toStringTag)}p["$"+m]=r(b.get)}}):t(l,function(m){var y=new a[m],S=y.slice||y.set;S&&(p["$"+m]=r(S))});var w=function(y){var S=!1;return t(p,function(b,E){if(!S)try{"$"+b(y)===E&&(S=u(E,1))}catch(A){}}),S},g=function(y){var S=!1;return t(p,function(b,E){if(!S)try{b(y),S=u(E,1)}catch(A){}}),S};return yo=function(y){if(!y||typeof y!="object")return!1;if(!s){var S=u(i(y),8,-1);return d(l,S)>-1?S:S!=="Object"?!1:g(y)}return o?w(y):null},yo}function Hh(){if(Gf)return go;Gf=!0;var t=Kf();return go=function(r){return!!t(r)},go}function Yh(){if(Hf)return _e;Hf=!0;var t=Ch(),e=Fh(),r=Kf(),n=Hh();function o(C){return C.call.bind(C)}var i=typeof BigInt!="undefined",s=typeof Symbol!="undefined",a=o(Object.prototype.toString),l=o(Number.prototype.valueOf),u=o(String.prototype.valueOf),h=o(Boolean.prototype.valueOf);if(i)var d=o(BigInt.prototype.valueOf);if(s)var p=o(Symbol.prototype.valueOf);function w(C,k){if(typeof C!="object")return!1;try{return k(C),!0}catch(te){return!1}}_e.isArgumentsObject=t,_e.isGeneratorFunction=e,_e.isTypedArray=n;function g(C){return typeof Promise!="undefined"&&C instanceof Promise||C!==null&&typeof C=="object"&&typeof C.then=="function"&&typeof C.catch=="function"}_e.isPromise=g;function m(C){return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?ArrayBuffer.isView(C):n(C)||D(C)}_e.isArrayBufferView=m;function y(C){return r(C)==="Uint8Array"}_e.isUint8Array=y;function S(C){return r(C)==="Uint8ClampedArray"}_e.isUint8ClampedArray=S;function b(C){return r(C)==="Uint16Array"}_e.isUint16Array=b;function E(C){return r(C)==="Uint32Array"}_e.isUint32Array=E;function A(C){return r(C)==="Int8Array"}_e.isInt8Array=A;function x(C){return r(C)==="Int16Array"}_e.isInt16Array=x;function z(C){return r(C)==="Int32Array"}_e.isInt32Array=z;function G(C){return r(C)==="Float32Array"}_e.isFloat32Array=G;function L(C){return r(C)==="Float64Array"}_e.isFloat64Array=L;function ie(C){return r(C)==="BigInt64Array"}_e.isBigInt64Array=ie;function N(C){return r(C)==="BigUint64Array"}_e.isBigUint64Array=N;function F(C){return a(C)==="[object Map]"}F.working=typeof Map!="undefined"&&F(new Map);function Y(C){return typeof Map=="undefined"?!1:F.working?F(C):C instanceof Map}_e.isMap=Y;function W(C){return a(C)==="[object Set]"}W.working=typeof Set!="undefined"&&W(new Set);function fe(C){return typeof Set=="undefined"?!1:W.working?W(C):C instanceof Set}_e.isSet=fe;function ue(C){return a(C)==="[object WeakMap]"}ue.working=typeof WeakMap!="undefined"&&ue(new WeakMap);function pe(C){return typeof WeakMap=="undefined"?!1:ue.working?ue(C):C instanceof WeakMap}_e.isWeakMap=pe;function ge(C){return a(C)==="[object WeakSet]"}ge.working=typeof WeakSet!="undefined"&&ge(new WeakSet);function O(C){return ge(C)}_e.isWeakSet=O;function J(C){return a(C)==="[object ArrayBuffer]"}J.working=typeof ArrayBuffer!="undefined"&&J(new ArrayBuffer);function _(C){return typeof ArrayBuffer=="undefined"?!1:J.working?J(C):C instanceof ArrayBuffer}_e.isArrayBuffer=_;function M(C){return a(C)==="[object DataView]"}M.working=typeof ArrayBuffer!="undefined"&&typeof DataView!="undefined"&&M(new DataView(new ArrayBuffer(1),0,1));function D(C){return typeof DataView=="undefined"?!1:M.working?M(C):C instanceof DataView}_e.isDataView=D;var R=typeof SharedArrayBuffer!="undefined"?SharedArrayBuffer:void 0;function U(C){return a(C)==="[object SharedArrayBuffer]"}function X(C){return typeof R=="undefined"?!1:(typeof U.working=="undefined"&&(U.working=U(new R)),U.working?U(C):C instanceof R)}_e.isSharedArrayBuffer=X;function le(C){return a(C)==="[object AsyncFunction]"}_e.isAsyncFunction=le;function ne(C){return a(C)==="[object Map Iterator]"}_e.isMapIterator=ne;function V(C){return a(C)==="[object Set Iterator]"}_e.isSetIterator=V;function H(C){return a(C)==="[object Generator]"}_e.isGeneratorObject=H;function re(C){return a(C)==="[object WebAssembly.Module]"}_e.isWebAssemblyCompiledModule=re;function ye(C){return w(C,l)}_e.isNumberObject=ye;function be(C){return w(C,u)}_e.isStringObject=be;function $(C){return w(C,h)}_e.isBooleanObject=$;function j(C){return i&&w(C,d)}_e.isBigIntObject=j;function K(C){return s&&w(C,p)}_e.isSymbolObject=K;function oe(C){return ye(C)||be(C)||$(C)||j(C)||K(C)}_e.isBoxedPrimitive=oe;function ce(C){return typeof Uint8Array!="undefined"&&(_(C)||X(C))}return _e.isAnyArrayBuffer=ce,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(C){Object.defineProperty(_e,C,{enumerable:!1,value:function(){throw new Error(C+" is not supported in userland")}})}),_e}function qh(){return Yf||(Yf=!0,wo=function(e){return e&&typeof e=="object"&&typeof e.copy=="function"&&typeof e.fill=="function"&&typeof e.readUInt8=="function"}),wo}function Kh(){if(qf)return xe;qf=!0;var t=et,e=Object.getOwnPropertyDescriptors||function(R){for(var U=Object.keys(R),X={},le=0;le<U.length;le++)X[U[le]]=Object.getOwnPropertyDescriptor(R,U[le]);return X},r=/%[sdj%]/g;xe.format=function(D){if(!x(D)){for(var R=[],U=0;U<arguments.length;U++)R.push(s(arguments[U]));return R.join(" ")}for(var U=1,X=arguments,le=X.length,ne=String(D).replace(r,function(H){if(H==="%%")return"%";if(U>=le)return H;switch(H){case"%s":return String(X[U++]);case"%d":return Number(X[U++]);case"%j":try{return JSON.stringify(X[U++])}catch(re){return"[Circular]"}default:return H}}),V=X[U];U<le;V=X[++U])b(V)||!ie(V)?ne+=" "+V:ne+=" "+s(V);return ne},xe.deprecate=function(D,R){if(typeof t!="undefined"&&t.noDeprecation===!0)return D;if(typeof t=="undefined")return function(){return xe.deprecate(D,R).apply(this||_r,arguments)};var U=!1;function X(){if(!U){if(t.throwDeprecation)throw new Error(R);t.traceDeprecation?console.trace(R):console.error(R),U=!0}return D.apply(this||_r,arguments)}return X};var n={},o=/^$/;if(t.env.NODE_DEBUG){var i=t.env.NODE_DEBUG;i=i.replace(/[|\\\\{}()[\\]^$+?.]/g,"\\\\$&").replace(/\\*/g,".*").replace(/,/g,"$|^").toUpperCase(),o=new RegExp("^"+i+"$","i")}xe.debuglog=function(D){if(D=D.toUpperCase(),!n[D])if(o.test(D)){var R=t.pid;n[D]=function(){var U=xe.format.apply(xe,arguments);console.error("%s %d: %s",D,R,U)}}else n[D]=function(){};return n[D]};function s(D,R){var U={seen:[],stylize:l};return arguments.length>=3&&(U.depth=arguments[2]),arguments.length>=4&&(U.colors=arguments[3]),S(R)?U.showHidden=R:R&&xe._extend(U,R),G(U.showHidden)&&(U.showHidden=!1),G(U.depth)&&(U.depth=2),G(U.colors)&&(U.colors=!1),G(U.customInspect)&&(U.customInspect=!0),U.colors&&(U.stylize=a),h(U,D,U.depth)}xe.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function a(D,R){var U=s.styles[R];return U?"\\x1B["+s.colors[U][0]+"m"+D+"\\x1B["+s.colors[U][1]+"m":D}function l(D,R){return D}function u(D){var R={};return D.forEach(function(U,X){R[U]=!0}),R}function h(D,R,U){if(D.customInspect&&R&&Y(R.inspect)&&R.inspect!==xe.inspect&&!(R.constructor&&R.constructor.prototype===R)){var X=R.inspect(U,D);return x(X)||(X=h(D,X,U)),X}var le=d(D,R);if(le)return le;var ne=Object.keys(R),V=u(ne);if(D.showHidden&&(ne=Object.getOwnPropertyNames(R)),F(R)&&(ne.indexOf("message")>=0||ne.indexOf("description")>=0))return p(R);if(ne.length===0){if(Y(R)){var H=R.name?": "+R.name:"";return D.stylize("[Function"+H+"]","special")}if(L(R))return D.stylize(RegExp.prototype.toString.call(R),"regexp");if(N(R))return D.stylize(Date.prototype.toString.call(R),"date");if(F(R))return p(R)}var re="",ye=!1,be=["{","}"];if(y(R)&&(ye=!0,be=["[","]"]),Y(R)){var $=R.name?": "+R.name:"";re=" [Function"+$+"]"}if(L(R)&&(re=" "+RegExp.prototype.toString.call(R)),N(R)&&(re=" "+Date.prototype.toUTCString.call(R)),F(R)&&(re=" "+p(R)),ne.length===0&&(!ye||R.length==0))return be[0]+re+be[1];if(U<0)return L(R)?D.stylize(RegExp.prototype.toString.call(R),"regexp"):D.stylize("[Object]","special");D.seen.push(R);var j;return ye?j=w(D,R,U,V,ne):j=ne.map(function(K){return g(D,R,U,V,K,ye)}),D.seen.pop(),m(j,re,be)}function d(D,R){if(G(R))return D.stylize("undefined","undefined");if(x(R)){var U="\'"+JSON.stringify(R).replace(/^"|"$/g,"").replace(/\'/g,"\\\\\'").replace(/\\\\"/g,\'"\')+"\'";return D.stylize(U,"string")}if(A(R))return D.stylize(""+R,"number");if(S(R))return D.stylize(""+R,"boolean");if(b(R))return D.stylize("null","null")}function p(D){return"["+Error.prototype.toString.call(D)+"]"}function w(D,R,U,X,le){for(var ne=[],V=0,H=R.length;V<H;++V)O(R,String(V))?ne.push(g(D,R,U,X,String(V),!0)):ne.push("");return le.forEach(function(re){re.match(/^\\d+$/)||ne.push(g(D,R,U,X,re,!0))}),ne}function g(D,R,U,X,le,ne){var V,H,re;if(re=Object.getOwnPropertyDescriptor(R,le)||{value:R[le]},re.get?re.set?H=D.stylize("[Getter/Setter]","special"):H=D.stylize("[Getter]","special"):re.set&&(H=D.stylize("[Setter]","special")),O(X,le)||(V="["+le+"]"),H||(D.seen.indexOf(re.value)<0?(b(U)?H=h(D,re.value,null):H=h(D,re.value,U-1),H.indexOf(`\n`)>-1&&(ne?H=H.split(`\n`).map(function(ye){return"  "+ye}).join(`\n`).slice(2):H=`\n`+H.split(`\n`).map(function(ye){return"   "+ye}).join(`\n`))):H=D.stylize("[Circular]","special")),G(V)){if(ne&&le.match(/^\\d+$/))return H;V=JSON.stringify(""+le),V.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(V=V.slice(1,-1),V=D.stylize(V,"name")):(V=V.replace(/\'/g,"\\\\\'").replace(/\\\\"/g,\'"\').replace(/(^"|"$)/g,"\'"),V=D.stylize(V,"string"))}return V+": "+H}function m(D,R,U){var X=D.reduce(function(le,ne){return ne.indexOf(`\n`)>=0,le+ne.replace(/\\u001b\\[\\d\\d?m/g,"").length+1},0);return X>60?U[0]+(R===""?"":R+`\n `)+" "+D.join(`,\n  `)+" "+U[1]:U[0]+R+" "+D.join(", ")+" "+U[1]}xe.types=Yh();function y(D){return Array.isArray(D)}xe.isArray=y;function S(D){return typeof D=="boolean"}xe.isBoolean=S;function b(D){return D===null}xe.isNull=b;function E(D){return D==null}xe.isNullOrUndefined=E;function A(D){return typeof D=="number"}xe.isNumber=A;function x(D){return typeof D=="string"}xe.isString=x;function z(D){return typeof D=="symbol"}xe.isSymbol=z;function G(D){return D===void 0}xe.isUndefined=G;function L(D){return ie(D)&&fe(D)==="[object RegExp]"}xe.isRegExp=L,xe.types.isRegExp=L;function ie(D){return typeof D=="object"&&D!==null}xe.isObject=ie;function N(D){return ie(D)&&fe(D)==="[object Date]"}xe.isDate=N,xe.types.isDate=N;function F(D){return ie(D)&&(fe(D)==="[object Error]"||D instanceof Error)}xe.isError=F,xe.types.isNativeError=F;function Y(D){return typeof D=="function"}xe.isFunction=Y;function W(D){return D===null||typeof D=="boolean"||typeof D=="number"||typeof D=="string"||typeof D=="symbol"||typeof D=="undefined"}xe.isPrimitive=W,xe.isBuffer=qh();function fe(D){return Object.prototype.toString.call(D)}function ue(D){return D<10?"0"+D.toString(10):D.toString(10)}var pe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function ge(){var D=new Date,R=[ue(D.getHours()),ue(D.getMinutes()),ue(D.getSeconds())].join(":");return[D.getDate(),pe[D.getMonth()],R].join(" ")}xe.log=function(){console.log("%s - %s",ge(),xe.format.apply(xe,arguments))},xe.inherits=kf(),xe._extend=function(D,R){if(!R||!ie(R))return D;for(var U=Object.keys(R),X=U.length;X--;)D[U[X]]=R[U[X]];return D};function O(D,R){return Object.prototype.hasOwnProperty.call(D,R)}var J=typeof Symbol!="undefined"?Symbol("util.promisify.custom"):void 0;xe.promisify=function(R){if(typeof R!="function")throw new TypeError(\'The "original" argument must be of type Function\');if(J&&R[J]){if(U=R[J],typeof U!="function")throw new TypeError(\'The "util.promisify.custom" argument must be of type Function\');return Object.defineProperty(U,J,{value:U,enumerable:!1,writable:!1,configurable:!0}),U}function U(){for(var X,le,ne=new Promise(function(re,ye){X=re,le=ye}),V=[],H=0;H<arguments.length;H++)V.push(arguments[H]);V.push(function(re,ye){re?le(re):X(ye)});try{R.apply(this||_r,V)}catch(re){le(re)}return ne}return Object.setPrototypeOf(U,Object.getPrototypeOf(R)),J&&Object.defineProperty(U,J,{value:U,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(U,e(R))},xe.promisify.custom=J;function _(D,R){if(!D){var U=new Error("Promise was rejected with a falsy value");U.reason=D,D=U}return R(D)}function M(D){if(typeof D!="function")throw new TypeError(\'The "original" argument must be of type Function\');function R(){for(var U=[],X=0;X<arguments.length;X++)U.push(arguments[X]);var le=U.pop();if(typeof le!="function")throw new TypeError("The last argument must be of type Function");var ne=this||_r,V=function(){return le.apply(ne,arguments)};D.apply(this||_r,U).then(function(H){t.nextTick(V.bind(null,null,H))},function(H){t.nextTick(_.bind(null,H,V))})}return Object.setPrototypeOf(R,Object.getPrototypeOf(D)),Object.defineProperties(R,e(D)),R}return xe.callbackify=M,xe}var ao,Lf,fo,Cf,lo,Ff,co,$f,uo,zf,ho,Wf,po,jf,jh,yo,Vf,Gh,go,Gf,_e,Hf,wo,Yf,xe,qf,_r,Se,Sb,vb,Eb,_b,xb,Ab,Ib,Tb,Rb,Ob,Db,Nb,Pb,Ub,Mb,Bb,kb,Lb,Cb,Fb,$b,zb,Wb,mo,jb,Vb,Gb,Jf=yt(()=>{oo();so();Pi();ao={},Lf=!1;fo={},Cf=!1;lo={},Ff=!1;co={},$f=!1;uo={},zf=!1;ho={},Wf=!1;po={},jf=!1,jh=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:global;yo={},Vf=!1,Gh=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:global;go={},Gf=!1;_e={},Hf=!1;wo={},Yf=!1;xe={},qf=!1,_r=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:global;Se=Kh();Se.format;Se.deprecate;Se.debuglog;Se.inspect;Se.types;Se.isArray;Se.isBoolean;Se.isNull;Se.isNullOrUndefined;Se.isNumber;Se.isString;Se.isSymbol;Se.isUndefined;Se.isRegExp;Se.isObject;Se.isDate;Se.isError;Se.isFunction;Se.isPrimitive;Se.isBuffer;Se.log;Se.inherits;Se._extend;Se.promisify;Se.callbackify;Sb=Se._extend,vb=Se.callbackify,Eb=Se.debuglog,_b=Se.deprecate,xb=Se.format,Ab=Se.inherits,Ib=Se.inspect,Tb=Se.isArray,Rb=Se.isBoolean,Ob=Se.isBuffer,Db=Se.isDate,Nb=Se.isError,Pb=Se.isFunction,Ub=Se.isNull,Mb=Se.isNullOrUndefined,Bb=Se.isNumber,kb=Se.isObject,Lb=Se.isPrimitive,Cb=Se.isRegExp,Fb=Se.isString,$b=Se.isSymbol,zb=Se.isUndefined,Wb=Se.log,mo=Se.promisify,jb=Se.types,Vb=Se.TextEncoder=globalThis.TextEncoder,Gb=Se.TextDecoder=globalThis.TextDecoder});var jo={};gt(jo,{Duplex:()=>tp,PassThrough:()=>np,Readable:()=>Fo,Stream:()=>sp,Transform:()=>rp,Writable:()=>ep,default:()=>Re,finished:()=>ip,pipeline:()=>op,promises:()=>ap});function ke(){return Xf||(Xf=!0,So={ArrayIsArray(t){return Array.isArray(t)},ArrayPrototypeIncludes(t,e){return t.includes(e)},ArrayPrototypeIndexOf(t,e){return t.indexOf(e)},ArrayPrototypeJoin(t,e){return t.join(e)},ArrayPrototypeMap(t,e){return t.map(e)},ArrayPrototypePop(t,e){return t.pop(e)},ArrayPrototypePush(t,e){return t.push(e)},ArrayPrototypeSlice(t,e,r){return t.slice(e,r)},Error,FunctionPrototypeCall(t,e,...r){return t.call(e,...r)},FunctionPrototypeSymbolHasInstance(t,e){return Function.prototype[Symbol.hasInstance].call(t,e)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(t,e){return Object.defineProperties(t,e)},ObjectDefineProperty(t,e,r){return Object.defineProperty(t,e,r)},ObjectGetOwnPropertyDescriptor(t,e){return Object.getOwnPropertyDescriptor(t,e)},ObjectKeys(t){return Object.keys(t)},ObjectSetPrototypeOf(t,e){return Object.setPrototypeOf(t,e)},Promise,PromisePrototypeCatch(t,e){return t.catch(e)},PromisePrototypeThen(t,e,r){return t.then(e,r)},PromiseReject(t){return Promise.reject(t)},PromiseResolve(t){return Promise.resolve(t)},ReflectApply:Reflect.apply,RegExpPrototypeTest(t,e){return t.test(e)},SafeSet:Set,String,StringPrototypeSlice(t,e,r){return t.slice(e,r)},StringPrototypeToLowerCase(t){return t.toLowerCase()},StringPrototypeToUpperCase(t){return t.toUpperCase()},StringPrototypeTrim(t){return t.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,SymbolDispose:Symbol.dispose||Symbol("Symbol.dispose"),SymbolAsyncDispose:Symbol.asyncDispose||Symbol("Symbol.asyncDispose"),TypedArrayPrototypeSet(t,e,r){return t.set(e,r)},Boolean,Uint8Array}),So}function Ir(){if(Zf)return xr;Zf=!0;let{AbortController:t,AbortSignal:e}=typeof self!="undefined"?self:typeof window!="undefined"?window:void 0;return xr=t,xr.AbortSignal=e,xr.default=t,xr}function je(){if(Qf)return pn;Qf=!0;let t=at(),{kResistStopPropagation:e,SymbolDispose:r}=ke(),n=globalThis.AbortSignal||Ir().AbortSignal,o=globalThis.AbortController||Ir().AbortController,i=Object.getPrototypeOf(async function(){}).constructor,s=globalThis.Blob||t.Blob,a=typeof s!="undefined"?function(p){return p instanceof s}:function(p){return!1},l=(d,p)=>{if(d!==void 0&&(d===null||typeof d!="object"||!("aborted"in d)))throw new ERR_INVALID_ARG_TYPE(p,"AbortSignal",d)},u=(d,p)=>{if(typeof d!="function")throw new ERR_INVALID_ARG_TYPE(p,"Function",d)};class h extends Error{constructor(p){if(!Array.isArray(p))throw new TypeError(`Expected input to be an Array, got ${typeof p}`);let w="";for(let g=0;g<p.length;g++)w+=`    ${p[g].stack}\n`;super(w),this.name="AggregateError",this.errors=p}}return pn={AggregateError:h,kEmptyObject:Object.freeze({}),once(d){let p=!1;return function(...w){p||(p=!0,d.apply(this,w))}},createDeferredPromise:function(){let d,p;return{promise:new Promise((g,m)=>{d=g,p=m}),resolve:d,reject:p}},promisify(d){return new Promise((p,w)=>{d((g,...m)=>g?w(g):p(...m))})},debuglog(){return function(){}},format(d,...p){return d.replace(/%([sdifj])/g,function(...[w,g]){let m=p.shift();return g==="f"?m.toFixed(6):g==="j"?JSON.stringify(m):g==="s"&&typeof m=="object"?`${m.constructor!==Object?m.constructor.name:""} {}`.trim():m.toString()})},inspect(d){switch(typeof d){case"string":if(d.includes("\'"))if(d.includes(\'"\')){if(!d.includes("`")&&!d.includes("${"))return`\\`${d}\\``}else return`"${d}"`;return`\'${d}\'`;case"number":return isNaN(d)?"NaN":Object.is(d,-0)?String(d):d;case"bigint":return`${String(d)}n`;case"boolean":case"undefined":return String(d);case"object":return"{}"}},types:{isAsyncFunction(d){return d instanceof i},isArrayBufferView(d){return ArrayBuffer.isView(d)}},isBlob:a,deprecate(d,p){return d},addAbortListener:ut.addAbortListener||function(p,w){if(p===void 0)throw new ERR_INVALID_ARG_TYPE("signal","AbortSignal",p);l(p,"signal"),u(w,"listener");let g;return p.aborted?queueMicrotask(()=>w()):(p.addEventListener("abort",w,{__proto__:null,once:!0,[e]:!0}),g=()=>{p.removeEventListener("abort",w)}),{__proto__:null,[r](){var m;(m=g)===null||m===void 0||m()}}},AbortSignalAny:n.any||function(p){if(p.length===1)return p[0];let w=new o,g=()=>w.abort();return p.forEach(m=>{l(m,"signals"),m.addEventListener("abort",g,{once:!0})}),w.signal.addEventListener("abort",()=>{p.forEach(m=>m.removeEventListener("abort",g))},{once:!0}),w.signal}},pn.promisify.custom=Symbol.for("nodejs.util.promisify.custom"),pn}function He(){if(el)return vo;el=!0;let{format:t,inspect:e,AggregateError:r}=je(),n=globalThis.AggregateError||r,o=Symbol("kIsNodeError"),i=["string","function","number","object","Function","Object","boolean","bigint","symbol"],s=/^([A-Z][a-z0-9]*)+$/,a="__node_internal_",l={};function u(y,S){if(!y)throw new l.ERR_INTERNAL_ASSERTION(S)}function h(y){let S="",b=y.length,E=y[0]==="-"?1:0;for(;b>=E+4;b-=3)S=`_${y.slice(b-3,b)}${S}`;return`${y.slice(0,b)}${S}`}function d(y,S,b){if(typeof S=="function")return u(S.length<=b.length,`Code: ${y}; The provided arguments length (${b.length}) does not match the required ones (${S.length}).`),S(...b);let E=(S.match(/%[dfijoOs]/g)||[]).length;return u(E===b.length,`Code: ${y}; The provided arguments length (${b.length}) does not match the required ones (${E}).`),b.length===0?S:t(S,...b)}function p(y,S,b){b||(b=Error);class E extends b{constructor(...x){super(d(y,S,x))}toString(){return`${this.name} [${y}]: ${this.message}`}}Object.defineProperties(E.prototype,{name:{value:b.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${y}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),E.prototype.code=y,E.prototype[o]=!0,l[y]=E}function w(y){let S=a+y.name;return Object.defineProperty(y,"name",{value:S}),y}function g(y,S){if(y&&S&&y!==S){if(Array.isArray(S.errors))return S.errors.push(y),S;let b=new n([S,y],S.message);return b.code=S.code,b}return y||S}class m extends Error{constructor(S="The operation was aborted",b=void 0){if(b!==void 0&&typeof b!="object")throw new l.ERR_INVALID_ARG_TYPE("options","Object",b);super(S,b),this.code="ABORT_ERR",this.name="AbortError"}}return p("ERR_ASSERTION","%s",Error),p("ERR_INVALID_ARG_TYPE",(y,S,b)=>{u(typeof y=="string","\'name\' must be a string"),Array.isArray(S)||(S=[S]);let E="The ";y.endsWith(" argument")?E+=`${y} `:E+=`"${y}" ${y.includes(".")?"property":"argument"} `,E+="must be ";let A=[],x=[],z=[];for(let L of S)u(typeof L=="string","All expected entries have to be of type string"),i.includes(L)?A.push(L.toLowerCase()):s.test(L)?x.push(L):(u(L!=="object",\'The value "object" should be written as "Object"\'),z.push(L));if(x.length>0){let L=A.indexOf("object");L!==-1&&(A.splice(A,L,1),x.push("Object"))}if(A.length>0){switch(A.length){case 1:E+=`of type ${A[0]}`;break;case 2:E+=`one of type ${A[0]} or ${A[1]}`;break;default:{let L=A.pop();E+=`one of type ${A.join(", ")}, or ${L}`}}(x.length>0||z.length>0)&&(E+=" or ")}if(x.length>0){switch(x.length){case 1:E+=`an instance of ${x[0]}`;break;case 2:E+=`an instance of ${x[0]} or ${x[1]}`;break;default:{let L=x.pop();E+=`an instance of ${x.join(", ")}, or ${L}`}}z.length>0&&(E+=" or ")}switch(z.length){case 0:break;case 1:z[0].toLowerCase()!==z[0]&&(E+="an "),E+=`${z[0]}`;break;case 2:E+=`one of ${z[0]} or ${z[1]}`;break;default:{let L=z.pop();E+=`one of ${z.join(", ")}, or ${L}`}}if(b==null)E+=`. Received ${b}`;else if(typeof b=="function"&&b.name)E+=`. Received function ${b.name}`;else if(typeof b=="object"){var G;if((G=b.constructor)!==null&&G!==void 0&&G.name)E+=`. Received an instance of ${b.constructor.name}`;else{let L=e(b,{depth:-1});E+=`. Received ${L}`}}else{let L=e(b,{colors:!1});L.length>25&&(L=`${L.slice(0,25)}...`),E+=`. Received type ${typeof b} (${L})`}return E},TypeError),p("ERR_INVALID_ARG_VALUE",(y,S,b="is invalid")=>{let E=e(S);return E.length>128&&(E=E.slice(0,128)+"..."),`The ${y.includes(".")?"property":"argument"} \'${y}\' ${b}. Received ${E}`},TypeError),p("ERR_INVALID_RETURN_VALUE",(y,S,b)=>{var E;let A=b!=null&&(E=b.constructor)!==null&&E!==void 0&&E.name?`instance of ${b.constructor.name}`:`type ${typeof b}`;return`Expected ${y} to be returned from the "${S}" function but got ${A}.`},TypeError),p("ERR_MISSING_ARGS",(...y)=>{u(y.length>0,"At least one arg needs to be specified");let S,b=y.length;switch(y=(Array.isArray(y)?y:[y]).map(E=>`"${E}"`).join(" or "),b){case 1:S+=`The ${y[0]} argument`;break;case 2:S+=`The ${y[0]} and ${y[1]} arguments`;break;default:{let E=y.pop();S+=`The ${y.join(", ")}, and ${E} arguments`}break}return`${S} must be specified`},TypeError),p("ERR_OUT_OF_RANGE",(y,S,b)=>{u(S,\'Missing "range" argument\');let E;return Number.isInteger(b)&&Math.abs(b)>2**32?E=h(String(b)):typeof b=="bigint"?(E=String(b),(b>BigInt(2)**BigInt(32)||b<-(BigInt(2)**BigInt(32)))&&(E=h(E)),E+="n"):E=e(b),`The value of "${y}" is out of range. It must be ${S}. Received ${E}`},RangeError),p("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error),p("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error),p("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error),p("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error),p("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error),p("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),p("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error),p("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error),p("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error),p("ERR_STREAM_WRITE_AFTER_END","write after end",Error),p("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError),vo={AbortError:m,aggregateTwoErrors:w(g),hideStackFrames:w,codes:l},vo}function Tr(){if(tl)return Eo;tl=!0;let{ArrayIsArray:t,ArrayPrototypeIncludes:e,ArrayPrototypeJoin:r,ArrayPrototypeMap:n,NumberIsInteger:o,NumberIsNaN:i,NumberMAX_SAFE_INTEGER:s,NumberMIN_SAFE_INTEGER:a,NumberParseInt:l,ObjectPrototypeHasOwnProperty:u,RegExpPrototypeExec:h,String:d,StringPrototypeToUpperCase:p,StringPrototypeTrim:w}=ke(),{hideStackFrames:g,codes:{ERR_SOCKET_BAD_PORT:m,ERR_INVALID_ARG_TYPE:y,ERR_INVALID_ARG_VALUE:S,ERR_OUT_OF_RANGE:b,ERR_UNKNOWN_SIGNAL:E}}=He(),{normalizeEncoding:A}=je(),{isAsyncFunction:x,isArrayBufferView:z}=je().types,G={};function L(k){return k===(k|0)}function ie(k){return k===k>>>0}let N=/^[0-7]+$/,F="must be a 32-bit unsigned integer or an octal string";function Y(k,te,se){if(typeof k=="undefined"&&(k=se),typeof k=="string"){if(h(N,k)===null)throw new S(te,k,F);k=l(k,8)}return ue(k,te),k}let W=g((k,te,se=a,Z=s)=>{if(typeof k!="number")throw new y(te,"number",k);if(!o(k))throw new b(te,"an integer",k);if(k<se||k>Z)throw new b(te,`>= ${se} && <= ${Z}`,k)}),fe=g((k,te,se=-2147483648,Z=2147483647)=>{if(typeof k!="number")throw new y(te,"number",k);if(!o(k))throw new b(te,"an integer",k);if(k<se||k>Z)throw new b(te,`>= ${se} && <= ${Z}`,k)}),ue=g((k,te,se=!1)=>{if(typeof k!="number")throw new y(te,"number",k);if(!o(k))throw new b(te,"an integer",k);let Z=se?1:0,Ae=4294967295;if(k<Z||k>Ae)throw new b(te,`>= ${Z} && <= ${Ae}`,k)});function pe(k,te){if(typeof k!="string")throw new y(te,"string",k)}function ge(k,te,se=void 0,Z){if(typeof k!="number")throw new y(te,"number",k);if(se!=null&&k<se||Z!=null&&k>Z||(se!=null||Z!=null)&&i(k))throw new b(te,`${se!=null?`>= ${se}`:""}${se!=null&&Z!=null?" && ":""}${Z!=null?`<= ${Z}`:""}`,k)}let O=g((k,te,se)=>{if(!e(se,k)){let Ae="must be one of: "+r(n(se,Ue=>typeof Ue=="string"?`\'${Ue}\'`:d(Ue)),", ");throw new S(te,k,Ae)}});function J(k,te){if(typeof k!="boolean")throw new y(te,"boolean",k)}function _(k,te,se){return k==null||!u(k,te)?se:k[te]}let M=g((k,te,se=null)=>{let Z=_(se,"allowArray",!1),Ae=_(se,"allowFunction",!1);if(!_(se,"nullable",!1)&&k===null||!Z&&t(k)||typeof k!="object"&&(!Ae||typeof k!="function"))throw new y(te,"Object",k)}),D=g((k,te)=>{if(k!=null&&typeof k!="object"&&typeof k!="function")throw new y(te,"a dictionary",k)}),R=g((k,te,se=0)=>{if(!t(k))throw new y(te,"Array",k);if(k.length<se){let Z=`must be longer than ${se}`;throw new S(te,k,Z)}});function U(k,te){R(k,te);for(let se=0;se<k.length;se++)pe(k[se],`${te}[${se}]`)}function X(k,te){R(k,te);for(let se=0;se<k.length;se++)J(k[se],`${te}[${se}]`)}function le(k,te){R(k,te);for(let se=0;se<k.length;se++){let Z=k[se],Ae=`${te}[${se}]`;if(Z==null)throw new y(Ae,"AbortSignal",Z);ye(Z,Ae)}}function ne(k,te="signal"){if(pe(k,te),G[k]===void 0)throw G[p(k)]!==void 0?new E(k+" (signals must use all capital letters)"):new E(k)}let V=g((k,te="buffer")=>{if(!z(k))throw new y(te,["Buffer","TypedArray","DataView"],k)});function H(k,te){let se=A(te),Z=k.length;if(se==="hex"&&Z%2!==0)throw new S("encoding",te,`is invalid for data of length ${Z}`)}function re(k,te="Port",se=!0){if(typeof k!="number"&&typeof k!="string"||typeof k=="string"&&w(k).length===0||+k!==+k>>>0||k>65535||k===0&&!se)throw new m(te,k,se);return k|0}let ye=g((k,te)=>{if(k!==void 0&&(k===null||typeof k!="object"||!("aborted"in k)))throw new y(te,"AbortSignal",k)}),be=g((k,te)=>{if(typeof k!="function")throw new y(te,"Function",k)}),$=g((k,te)=>{if(typeof k!="function"||x(k))throw new y(te,"Function",k)}),j=g((k,te)=>{if(k!==void 0)throw new y(te,"undefined",k)});function K(k,te,se){if(!e(se,k))throw new y(te,`(\'${r(se,"|")}\')`,k)}let oe=/^(?:<[^>]*>)(?:\\s*;\\s*[^;"\\s]+(?:=(")?[^;"\\s]*\\1)?)*$/;function ce(k,te){if(typeof k=="undefined"||!h(oe,k))throw new S(te,k,\'must be an array or string of format "</styles.css>; rel=preload; as=style"\')}function C(k){if(typeof k=="string")return ce(k,"hints"),k;if(t(k)){let te=k.length,se="";if(te===0)return se;for(let Z=0;Z<te;Z++){let Ae=k[Z];ce(Ae,"hints"),se+=Ae,Z!==te-1&&(se+=", ")}return se}throw new S("hints",k,\'must be an array or string of format "</styles.css>; rel=preload; as=style"\')}return Eo={isInt32:L,isUint32:ie,parseFileMode:Y,validateArray:R,validateStringArray:U,validateBooleanArray:X,validateAbortSignalArray:le,validateBoolean:J,validateBuffer:V,validateDictionary:D,validateEncoding:H,validateFunction:be,validateInt32:fe,validateInteger:W,validateNumber:ge,validateObject:M,validateOneOf:O,validatePlainFunction:$,validatePort:re,validateSignalName:ne,validateString:pe,validateUint32:ue,validateUndefined:j,validateUnion:K,validateAbortSignal:ye,validateLinkHeaderValue:C},Eo}function pt(){if(rl)return _o;rl=!0;let{SymbolAsyncIterator:t,SymbolIterator:e,SymbolFor:r}=ke(),n=r("nodejs.stream.destroyed"),o=r("nodejs.stream.errored"),i=r("nodejs.stream.readable"),s=r("nodejs.stream.writable"),a=r("nodejs.stream.disturbed"),l=r("nodejs.webstream.isClosedPromise"),u=r("nodejs.webstream.controllerErrorFunction");function h(_,M=!1){var D;return!!(_&&typeof _.pipe=="function"&&typeof _.on=="function"&&(!M||typeof _.pause=="function"&&typeof _.resume=="function")&&(!_._writableState||((D=_._readableState)===null||D===void 0?void 0:D.readable)!==!1)&&(!_._writableState||_._readableState))}function d(_){var M;return!!(_&&typeof _.write=="function"&&typeof _.on=="function"&&(!_._readableState||((M=_._writableState)===null||M===void 0?void 0:M.writable)!==!1))}function p(_){return!!(_&&typeof _.pipe=="function"&&_._readableState&&typeof _.on=="function"&&typeof _.write=="function")}function w(_){return _&&(_._readableState||_._writableState||typeof _.write=="function"&&typeof _.on=="function"||typeof _.pipe=="function"&&typeof _.on=="function")}function g(_){return!!(_&&!w(_)&&typeof _.pipeThrough=="function"&&typeof _.getReader=="function"&&typeof _.cancel=="function")}function m(_){return!!(_&&!w(_)&&typeof _.getWriter=="function"&&typeof _.abort=="function")}function y(_){return!!(_&&!w(_)&&typeof _.readable=="object"&&typeof _.writable=="object")}function S(_){return g(_)||m(_)||y(_)}function b(_,M){return _==null?!1:M===!0?typeof _[t]=="function":M===!1?typeof _[e]=="function":typeof _[t]=="function"||typeof _[e]=="function"}function E(_){if(!w(_))return null;let M=_._writableState,D=_._readableState,R=M||D;return!!(_.destroyed||_[n]||R!=null&&R.destroyed)}function A(_){if(!d(_))return null;if(_.writableEnded===!0)return!0;let M=_._writableState;return M!=null&&M.errored?!1:typeof(M==null?void 0:M.ended)!="boolean"?null:M.ended}function x(_,M){if(!d(_))return null;if(_.writableFinished===!0)return!0;let D=_._writableState;return D!=null&&D.errored?!1:typeof(D==null?void 0:D.finished)!="boolean"?null:!!(D.finished||M===!1&&D.ended===!0&&D.length===0)}function z(_){if(!h(_))return null;if(_.readableEnded===!0)return!0;let M=_._readableState;return!M||M.errored?!1:typeof(M==null?void 0:M.ended)!="boolean"?null:M.ended}function G(_,M){if(!h(_))return null;let D=_._readableState;return D!=null&&D.errored?!1:typeof(D==null?void 0:D.endEmitted)!="boolean"?null:!!(D.endEmitted||M===!1&&D.ended===!0&&D.length===0)}function L(_){return _&&_[i]!=null?_[i]:typeof(_==null?void 0:_.readable)!="boolean"?null:E(_)?!1:h(_)&&_.readable&&!G(_)}function ie(_){return _&&_[s]!=null?_[s]:typeof(_==null?void 0:_.writable)!="boolean"?null:E(_)?!1:d(_)&&_.writable&&!A(_)}function N(_,M){return w(_)?E(_)?!0:!((M==null?void 0:M.readable)!==!1&&L(_)||(M==null?void 0:M.writable)!==!1&&ie(_)):null}function F(_){var M,D;return w(_)?_.writableErrored?_.writableErrored:(M=(D=_._writableState)===null||D===void 0?void 0:D.errored)!==null&&M!==void 0?M:null:null}function Y(_){var M,D;return w(_)?_.readableErrored?_.readableErrored:(M=(D=_._readableState)===null||D===void 0?void 0:D.errored)!==null&&M!==void 0?M:null:null}function W(_){if(!w(_))return null;if(typeof _.closed=="boolean")return _.closed;let M=_._writableState,D=_._readableState;return typeof(M==null?void 0:M.closed)=="boolean"||typeof(D==null?void 0:D.closed)=="boolean"?(M==null?void 0:M.closed)||(D==null?void 0:D.closed):typeof _._closed=="boolean"&&fe(_)?_._closed:null}function fe(_){return typeof _._closed=="boolean"&&typeof _._defaultKeepAlive=="boolean"&&typeof _._removedConnection=="boolean"&&typeof _._removedContLen=="boolean"}function ue(_){return typeof _._sent100=="boolean"&&fe(_)}function pe(_){var M;return typeof _._consuming=="boolean"&&typeof _._dumped=="boolean"&&((M=_.req)===null||M===void 0?void 0:M.upgradeOrConnect)===void 0}function ge(_){if(!w(_))return null;let M=_._writableState,D=_._readableState,R=M||D;return!R&&ue(_)||!!(R&&R.autoDestroy&&R.emitClose&&R.closed===!1)}function O(_){var M;return!!(_&&((M=_[a])!==null&&M!==void 0?M:_.readableDidRead||_.readableAborted))}function J(_){var M,D,R,U,X,le,ne,V,H,re;return!!(_&&((M=(D=(R=(U=(X=(le=_[o])!==null&&le!==void 0?le:_.readableErrored)!==null&&X!==void 0?X:_.writableErrored)!==null&&U!==void 0?U:(ne=_._readableState)===null||ne===void 0?void 0:ne.errorEmitted)!==null&&R!==void 0?R:(V=_._writableState)===null||V===void 0?void 0:V.errorEmitted)!==null&&D!==void 0?D:(H=_._readableState)===null||H===void 0?void 0:H.errored)!==null&&M!==void 0?M:!((re=_._writableState)===null||re===void 0)&&re.errored))}return _o={isDestroyed:E,kIsDestroyed:n,isDisturbed:O,kIsDisturbed:a,isErrored:J,kIsErrored:o,isReadable:L,kIsReadable:i,kIsClosedPromise:l,kControllerErrorFunction:u,kIsWritable:s,isClosed:W,isDuplexNodeStream:p,isFinished:N,isIterable:b,isReadableNodeStream:h,isReadableStream:g,isReadableEnded:z,isReadableFinished:G,isReadableErrored:Y,isNodeStream:w,isWebStream:S,isWritable:ie,isWritableNodeStream:d,isWritableStream:m,isWritableEnded:A,isWritableFinished:x,isWritableErrored:F,isServerRequest:pe,isServerResponse:ue,willEmitClose:ge,isTransformStream:y},_o}function Et(){if(nl)return yn;nl=!0;let t=et,{AbortError:e,codes:r}=He(),{ERR_INVALID_ARG_TYPE:n,ERR_STREAM_PREMATURE_CLOSE:o}=r,{kEmptyObject:i,once:s}=je(),{validateAbortSignal:a,validateFunction:l,validateObject:u,validateBoolean:h}=Tr(),{Promise:d,PromisePrototypeThen:p,SymbolDispose:w}=ke(),{isClosed:g,isReadable:m,isReadableNodeStream:y,isReadableStream:S,isReadableFinished:b,isReadableErrored:E,isWritable:A,isWritableNodeStream:x,isWritableStream:z,isWritableFinished:G,isWritableErrored:L,isNodeStream:ie,willEmitClose:N,kIsClosedPromise:F}=pt(),Y;function W(O){return O.setHeader&&typeof O.abort=="function"}let fe=()=>{};function ue(O,J,_){var M,D;if(arguments.length===2?(_=J,J=i):J==null?J=i:u(J,"options"),l(_,"callback"),a(J.signal,"options.signal"),_=s(_),S(O)||z(O))return pe(O,J,_);if(!ie(O))throw new n("stream",["ReadableStream","WritableStream","Stream"],O);let R=(M=J.readable)!==null&&M!==void 0?M:y(O),U=(D=J.writable)!==null&&D!==void 0?D:x(O),X=O._writableState,le=O._readableState,ne=()=>{O.writable||re()},V=N(O)&&y(O)===R&&x(O)===U,H=G(O,!1),re=()=>{H=!0,O.destroyed&&(V=!1),!(V&&(!O.readable||R))&&(!R||ye)&&_.call(O)},ye=b(O,!1),be=()=>{ye=!0,O.destroyed&&(V=!1),!(V&&(!O.writable||U))&&(!U||H)&&_.call(O)},$=k=>{_.call(O,k)},j=g(O),K=()=>{j=!0;let k=L(O)||E(O);if(k&&typeof k!="boolean")return _.call(O,k);if(R&&!ye&&y(O,!0)&&!b(O,!1))return _.call(O,new o);if(U&&!H&&!G(O,!1))return _.call(O,new o);_.call(O)},oe=()=>{j=!0;let k=L(O)||E(O);if(k&&typeof k!="boolean")return _.call(O,k);_.call(O)},ce=()=>{O.req.on("finish",re)};W(O)?(O.on("complete",re),V||O.on("abort",K),O.req?ce():O.on("request",ce)):U&&!X&&(O.on("end",ne),O.on("close",ne)),!V&&typeof O.aborted=="boolean"&&O.on("aborted",K),O.on("end",be),O.on("finish",re),J.error!==!1&&O.on("error",$),O.on("close",K),j?t.nextTick(K):X!=null&&X.errorEmitted||le!=null&&le.errorEmitted?V||t.nextTick(oe):(!R&&(!V||m(O))&&(H||A(O)===!1)||!U&&(!V||A(O))&&(ye||m(O)===!1)||le&&O.req&&O.aborted)&&t.nextTick(oe);let C=()=>{_=fe,O.removeListener("aborted",K),O.removeListener("complete",re),O.removeListener("abort",K),O.removeListener("request",ce),O.req&&O.req.removeListener("finish",re),O.removeListener("end",ne),O.removeListener("close",ne),O.removeListener("finish",re),O.removeListener("end",be),O.removeListener("error",$),O.removeListener("close",K)};if(J.signal&&!j){let k=()=>{let te=_;C(),te.call(O,new e(void 0,{cause:J.signal.reason}))};if(J.signal.aborted)t.nextTick(k);else{Y=Y||je().addAbortListener;let te=Y(J.signal,k),se=_;_=s((...Z)=>{te[w](),se.apply(O,Z)})}}return C}function pe(O,J,_){let M=!1,D=fe;if(J.signal)if(D=()=>{M=!0,_.call(O,new e(void 0,{cause:J.signal.reason}))},J.signal.aborted)t.nextTick(D);else{Y=Y||je().addAbortListener;let U=Y(J.signal,D),X=_;_=s((...le)=>{U[w](),X.apply(O,le)})}let R=(...U)=>{M||t.nextTick(()=>_.apply(O,U))};return p(O[F].promise,R,R),fe}function ge(O,J){var _;let M=!1;return J===null&&(J=i),(_=J)!==null&&_!==void 0&&_.cleanup&&(h(J.cleanup,"cleanup"),M=J.cleanup),new d((D,R)=>{let U=ue(O,J,X=>{M&&U(),X?R(X):D()})})}return yn=ue,yn.finished=ge,yn}function Yt(){if(il)return xo;il=!0;let t=et,{aggregateTwoErrors:e,codes:{ERR_MULTIPLE_CALLBACK:r},AbortError:n}=He(),{Symbol:o}=ke(),{kIsDestroyed:i,isDestroyed:s,isFinished:a,isServerRequest:l}=pt(),u=o("kDestroy"),h=o("kConstruct");function d(N,F,Y){N&&(N.stack,F&&!F.errored&&(F.errored=N),Y&&!Y.errored&&(Y.errored=N))}function p(N,F){let Y=this._readableState,W=this._writableState,fe=W||Y;return W!=null&&W.destroyed||Y!=null&&Y.destroyed?(typeof F=="function"&&F(),this):(d(N,W,Y),W&&(W.destroyed=!0),Y&&(Y.destroyed=!0),fe.constructed?w(this,N,F):this.once(u,function(ue){w(this,e(ue,N),F)}),this)}function w(N,F,Y){let W=!1;function fe(ue){if(W)return;W=!0;let pe=N._readableState,ge=N._writableState;d(ue,ge,pe),ge&&(ge.closed=!0),pe&&(pe.closed=!0),typeof Y=="function"&&Y(ue),ue?t.nextTick(g,N,ue):t.nextTick(m,N)}try{N._destroy(F||null,fe)}catch(ue){fe(ue)}}function g(N,F){y(N,F),m(N)}function m(N){let F=N._readableState,Y=N._writableState;Y&&(Y.closeEmitted=!0),F&&(F.closeEmitted=!0),(Y!=null&&Y.emitClose||F!=null&&F.emitClose)&&N.emit("close")}function y(N,F){let Y=N._readableState,W=N._writableState;W!=null&&W.errorEmitted||Y!=null&&Y.errorEmitted||(W&&(W.errorEmitted=!0),Y&&(Y.errorEmitted=!0),N.emit("error",F))}function S(){let N=this._readableState,F=this._writableState;N&&(N.constructed=!0,N.closed=!1,N.closeEmitted=!1,N.destroyed=!1,N.errored=null,N.errorEmitted=!1,N.reading=!1,N.ended=N.readable===!1,N.endEmitted=N.readable===!1),F&&(F.constructed=!0,F.destroyed=!1,F.closed=!1,F.closeEmitted=!1,F.errored=null,F.errorEmitted=!1,F.finalCalled=!1,F.prefinished=!1,F.ended=F.writable===!1,F.ending=F.writable===!1,F.finished=F.writable===!1)}function b(N,F,Y){let W=N._readableState,fe=N._writableState;if(fe!=null&&fe.destroyed||W!=null&&W.destroyed)return this;W!=null&&W.autoDestroy||fe!=null&&fe.autoDestroy?N.destroy(F):F&&(F.stack,fe&&!fe.errored&&(fe.errored=F),W&&!W.errored&&(W.errored=F),Y?t.nextTick(y,N,F):y(N,F))}function E(N,F){if(typeof N._construct!="function")return;let Y=N._readableState,W=N._writableState;Y&&(Y.constructed=!1),W&&(W.constructed=!1),N.once(h,F),!(N.listenerCount(h)>1)&&t.nextTick(A,N)}function A(N){let F=!1;function Y(W){if(F){b(N,W!=null?W:new r);return}F=!0;let fe=N._readableState,ue=N._writableState,pe=ue||fe;fe&&(fe.constructed=!0),ue&&(ue.constructed=!0),pe.destroyed?N.emit(u,W):W?b(N,W,!0):t.nextTick(x,N)}try{N._construct(W=>{t.nextTick(Y,W)})}catch(W){t.nextTick(Y,W)}}function x(N){N.emit(h)}function z(N){return(N==null?void 0:N.setHeader)&&typeof N.abort=="function"}function G(N){N.emit("close")}function L(N,F){N.emit("error",F),t.nextTick(G,N)}function ie(N,F){!N||s(N)||(!F&&!a(N)&&(F=new n),l(N)?(N.socket=null,N.destroy(F)):z(N)?N.abort():z(N.req)?N.req.abort():typeof N.destroy=="function"?N.destroy(F):typeof N.close=="function"?N.close():F?t.nextTick(L,N,F):t.nextTick(G,N),N.destroyed||(N[i]=!0))}return xo={construct:E,destroyer:ie,destroy:p,undestroy:S,errorOrDestroy:b},xo}function $o(){if(ol)return Ao;ol=!0;let{ArrayIsArray:t,ObjectSetPrototypeOf:e}=ke(),{EventEmitter:r}=ut;function n(i){r.call(this,i)}e(n.prototype,r.prototype),e(n,r),n.prototype.pipe=function(i,s){let a=this;function l(m){i.writable&&i.write(m)===!1&&a.pause&&a.pause()}a.on("data",l);function u(){a.readable&&a.resume&&a.resume()}i.on("drain",u),!i._isStdio&&(!s||s.end!==!1)&&(a.on("end",d),a.on("close",p));let h=!1;function d(){h||(h=!0,i.end())}function p(){h||(h=!0,typeof i.destroy=="function"&&i.destroy())}function w(m){g(),r.listenerCount(this,"error")===0&&this.emit("error",m)}o(a,"error",w),o(i,"error",w);function g(){a.removeListener("data",l),i.removeListener("drain",u),a.removeListener("end",d),a.removeListener("close",p),a.removeListener("error",w),i.removeListener("error",w),a.removeListener("end",g),a.removeListener("close",g),i.removeListener("close",g)}return a.on("end",g),a.on("close",g),i.on("close",g),i.emit("pipe",a),i};function o(i,s,a){if(typeof i.prependListener=="function")return i.prependListener(s,a);!i._events||!i._events[s]?i.on(s,a):t(i._events[s])?i._events[s].unshift(a):i._events[s]=[a,i._events[s]]}return Ao={Stream:n,prependListener:o},Ao}function wn(){if(sl)return Ar;sl=!0;let{SymbolDispose:t}=ke(),{AbortError:e,codes:r}=He(),{isNodeStream:n,isWebStream:o,kControllerErrorFunction:i}=pt(),s=Et(),{ERR_INVALID_ARG_TYPE:a}=r,l,u=(h,d)=>{if(typeof h!="object"||!("aborted"in h))throw new a(d,"AbortSignal",h)};return Ar.addAbortSignal=function(d,p){if(u(d,"signal"),!n(p)&&!o(p))throw new a("stream",["ReadableStream","WritableStream","Stream"],p);return Ar.addAbortSignalNoValidate(d,p)},Ar.addAbortSignalNoValidate=function(h,d){if(typeof h!="object"||!("aborted"in h))return d;let p=n(d)?()=>{d.destroy(new e(void 0,{cause:h.reason}))}:()=>{d[i](new e(void 0,{cause:h.reason}))};if(h.aborted)p();else{l=l||je().addAbortListener;let w=l(h,p);s(d,w[t])}return d},Ar}function Jh(){if(al)return Io;al=!0;let{StringPrototypeSlice:t,SymbolIterator:e,TypedArrayPrototypeSet:r,Uint8Array:n}=ke(),{Buffer:o}=at(),{inspect:i}=je();return Io=class{constructor(){this.head=null,this.tail=null,this.length=0}push(a){let l={data:a,next:null};this.length>0?this.tail.next=l:this.head=l,this.tail=l,++this.length}unshift(a){let l={data:a,next:this.head};this.length===0&&(this.tail=l),this.head=l,++this.length}shift(){if(this.length===0)return;let a=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,a}clear(){this.head=this.tail=null,this.length=0}join(a){if(this.length===0)return"";let l=this.head,u=""+l.data;for(;(l=l.next)!==null;)u+=a+l.data;return u}concat(a){if(this.length===0)return o.alloc(0);let l=o.allocUnsafe(a>>>0),u=this.head,h=0;for(;u;)r(l,u.data,h),h+=u.data.length,u=u.next;return l}consume(a,l){let u=this.head.data;if(a<u.length){let h=u.slice(0,a);return this.head.data=u.slice(a),h}return a===u.length?this.shift():l?this._getString(a):this._getBuffer(a)}first(){return this.head.data}*[e](){for(let a=this.head;a;a=a.next)yield a.data}_getString(a){let l="",u=this.head,h=0;do{let d=u.data;if(a>d.length)l+=d,a-=d.length;else{a===d.length?(l+=d,++h,u.next?this.head=u.next:this.head=this.tail=null):(l+=t(d,0,a),this.head=u,u.data=t(d,a));break}++h}while((u=u.next)!==null);return this.length-=h,l}_getBuffer(a){let l=o.allocUnsafe(a),u=a,h=this.head,d=0;do{let p=h.data;if(a>p.length)r(l,p,u-a),a-=p.length;else{a===p.length?(r(l,p,u-a),++d,h.next?this.head=h.next:this.head=this.tail=null):(r(l,new n(p.buffer,p.byteOffset,a),u-a),this.head=h,h.data=p.slice(a));break}++d}while((h=h.next)!==null);return this.length-=d,l}[Symbol.for("nodejs.util.inspect.custom")](a,l){return i(this,tt(Ee({},l),{depth:0,customInspect:!1}))}},Io}function bn(){if(fl)return To;fl=!0;let{MathFloor:t,NumberIsInteger:e}=ke(),{validateInteger:r}=Tr(),{ERR_INVALID_ARG_VALUE:n}=He().codes,o=16*1024,i=16;function s(h,d,p){return h.highWaterMark!=null?h.highWaterMark:d?h[p]:null}function a(h){return h?i:o}function l(h,d){r(d,"value",0),h?i=d:o=d}function u(h,d,p,w){let g=s(d,w,p);if(g!=null){if(!e(g)||g<0){let m=w?`options.${p}`:"options.highWaterMark";throw new n(m,g)}return t(g)}return a(h.objectMode)}return To={getHighWaterMark:u,getDefaultHighWaterMark:a,setDefaultHighWaterMark:l},To}function _l(){if(ll)return Ro;ll=!0;let t=et,{PromisePrototypeThen:e,SymbolAsyncIterator:r,SymbolIterator:n}=ke(),{Buffer:o}=at(),{ERR_INVALID_ARG_TYPE:i,ERR_STREAM_NULL_VALUES:s}=He().codes;function a(l,u,h){let d;if(typeof u=="string"||u instanceof o)return new l(tt(Ee({objectMode:!0},h),{read(){this.push(u),this.push(null)}}));let p;if(u&&u[r])p=!0,d=u[r]();else if(u&&u[n])p=!1,d=u[n]();else throw new i("iterable",["Iterable"],u);let w=new l(Ee({objectMode:!0,highWaterMark:1},h)),g=!1;w._read=function(){g||(g=!0,y())},w._destroy=function(S,b){e(m(S),()=>t.nextTick(b,S),E=>t.nextTick(b,E||S))};async function m(S){let b=S!=null,E=typeof d.throw=="function";if(b&&E){let{value:A,done:x}=await d.throw(S);if(await A,x)return}if(typeof d.return=="function"){let{value:A}=await d.return();await A}}async function y(){for(;;){try{let{value:S,done:b}=p?await d.next():d.next();if(b)w.push(null);else{let E=S&&typeof S.then=="function"?await S:S;if(E===null)throw g=!1,new s;if(w.push(E))continue;g=!1}}catch(S){w.destroy(S)}break}}return w}return Ro=a,Ro}function mn(){if(cl)return Oo;cl=!0;let t=et,{ArrayPrototypeIndexOf:e,NumberIsInteger:r,NumberIsNaN:n,NumberParseInt:o,ObjectDefineProperties:i,ObjectKeys:s,ObjectSetPrototypeOf:a,Promise:l,SafeSet:u,SymbolAsyncDispose:h,SymbolAsyncIterator:d,Symbol:p}=ke();Oo=Z,Z.ReadableState=se;let{EventEmitter:w}=ut,{Stream:g,prependListener:m}=$o(),{Buffer:y}=at(),{addAbortSignal:S}=wn(),b=Et(),E=je().debuglog("stream",T=>{E=T}),A=Jh(),x=Yt(),{getHighWaterMark:z,getDefaultHighWaterMark:G}=bn(),{aggregateTwoErrors:L,codes:{ERR_INVALID_ARG_TYPE:ie,ERR_METHOD_NOT_IMPLEMENTED:N,ERR_OUT_OF_RANGE:F,ERR_STREAM_PUSH_AFTER_EOF:Y,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:W},AbortError:fe}=He(),{validateObject:ue}=Tr(),pe=p("kPaused"),{StringDecoder:ge}=cn,O=_l();a(Z.prototype,g.prototype),a(Z,g);let J=()=>{},{errorOrDestroy:_}=x,M=1,D=2,R=4,U=8,X=16,le=32,ne=64,V=128,H=256,re=512,ye=1024,be=2048,$=4096,j=8192,K=16384,oe=32768,ce=65536,C=1<<17,k=1<<18;function te(T){return{enumerable:!1,get(){return((this||Q).state&T)!==0},set(P){P?(this||Q).state|=T:(this||Q).state&=~T}}}i(se.prototype,{objectMode:te(M),ended:te(D),endEmitted:te(R),reading:te(U),constructed:te(X),sync:te(le),needReadable:te(ne),emittedReadable:te(V),readableListening:te(H),resumeScheduled:te(re),errorEmitted:te(ye),emitClose:te(be),autoDestroy:te($),destroyed:te(j),closed:te(K),closeEmitted:te(oe),multiAwaitDrain:te(ce),readingMore:te(C),dataEmitted:te(k)});function se(T,P,de){typeof de!="boolean"&&(de=P instanceof ht()),(this||Q).state=be|$|X|le,T&&T.objectMode&&((this||Q).state|=M),de&&T&&T.readableObjectMode&&((this||Q).state|=M),(this||Q).highWaterMark=T?z(this||Q,T,"readableHighWaterMark",de):G(!1),(this||Q).buffer=new A,(this||Q).length=0,(this||Q).pipes=[],(this||Q).flowing=null,(this||Q)[pe]=null,T&&T.emitClose===!1&&((this||Q).state&=~be),T&&T.autoDestroy===!1&&((this||Q).state&=~$),(this||Q).errored=null,(this||Q).defaultEncoding=T&&T.defaultEncoding||"utf8",(this||Q).awaitDrainWriters=null,(this||Q).decoder=null,(this||Q).encoding=null,T&&T.encoding&&((this||Q).decoder=new ge(T.encoding),(this||Q).encoding=T.encoding)}function Z(T){if(!((this||Q)instanceof Z))return new Z(T);let P=(this||Q)instanceof ht();(this||Q)._readableState=new se(T,this||Q,P),T&&(typeof T.read=="function"&&((this||Q)._read=T.read),typeof T.destroy=="function"&&((this||Q)._destroy=T.destroy),typeof T.construct=="function"&&((this||Q)._construct=T.construct),T.signal&&!P&&S(T.signal,this||Q)),g.call(this||Q,T),x.construct(this||Q,()=>{(this||Q)._readableState.needReadable&&q(this||Q,(this||Q)._readableState)})}Z.prototype.destroy=x.destroy,Z.prototype._undestroy=x.undestroy,Z.prototype._destroy=function(T,P){P(T)},Z.prototype[w.captureRejectionSymbol]=function(T){this.destroy(T)},Z.prototype[h]=function(){let T;return(this||Q).destroyed||(T=(this||Q).readableEnded?null:new fe,this.destroy(T)),new l((P,de)=>b(this||Q,he=>he&&he!==T?de(he):P(null)))},Z.prototype.push=function(T,P){return Ae(this||Q,T,P,!1)},Z.prototype.unshift=function(T,P){return Ae(this||Q,T,P,!0)};function Ae(T,P,de,he){E("readableAddChunk",P);let we=T._readableState,$e;if((we.state&M)===0&&(typeof P=="string"?(de=de||we.defaultEncoding,we.encoding!==de&&(he&&we.encoding?P=y.from(P,de).toString(we.encoding):(P=y.from(P,de),de=""))):P instanceof y?de="":g._isUint8Array(P)?(P=g._uint8ArrayToBuffer(P),de=""):P!=null&&($e=new ie("chunk",["string","Buffer","Uint8Array"],P))),$e)_(T,$e);else if(P===null)we.state&=~U,c(T,we);else if((we.state&M)!==0||P&&P.length>0)if(he)if((we.state&R)!==0)_(T,new W);else{if(we.destroyed||we.errored)return!1;Ue(T,we,P,!0)}else if(we.ended)_(T,new Y);else{if(we.destroyed||we.errored)return!1;we.state&=~U,we.decoder&&!de?(P=we.decoder.write(P),we.objectMode||P.length!==0?Ue(T,we,P,!1):q(T,we)):Ue(T,we,P,!1)}else he||(we.state&=~U,q(T,we));return!we.ended&&(we.length<we.highWaterMark||we.length===0)}function Ue(T,P,de,he){P.flowing&&P.length===0&&!P.sync&&T.listenerCount("data")>0?((P.state&ce)!==0?P.awaitDrainWriters.clear():P.awaitDrainWriters=null,P.dataEmitted=!0,T.emit("data",de)):(P.length+=P.objectMode?1:de.length,he?P.buffer.unshift(de):P.buffer.push(de),(P.state&ne)!==0&&I(T)),q(T,P)}Z.prototype.isPaused=function(){let T=(this||Q)._readableState;return T[pe]===!0||T.flowing===!1},Z.prototype.setEncoding=function(T){let P=new ge(T);(this||Q)._readableState.decoder=P,(this||Q)._readableState.encoding=(this||Q)._readableState.decoder.encoding;let de=(this||Q)._readableState.buffer,he="";for(let we of de)he+=P.write(we);return de.clear(),he!==""&&de.push(he),(this||Q)._readableState.length=he.length,this||Q};let Le=1073741824;function v(T){if(T>Le)throw new F("size","<= 1GiB",T);return T--,T|=T>>>1,T|=T>>>2,T|=T>>>4,T|=T>>>8,T|=T>>>16,T++,T}function f(T,P){return T<=0||P.length===0&&P.ended?0:(P.state&M)!==0?1:n(T)?P.flowing&&P.length?P.buffer.first().length:P.length:T<=P.length?T:P.ended?P.length:0}Z.prototype.read=function(T){E("read",T),T===void 0?T=NaN:r(T)||(T=o(T,10));let P=(this||Q)._readableState,de=T;if(T>P.highWaterMark&&(P.highWaterMark=v(T)),T!==0&&(P.state&=~V),T===0&&P.needReadable&&((P.highWaterMark!==0?P.length>=P.highWaterMark:P.length>0)||P.ended))return E("read: emitReadable",P.length,P.ended),P.length===0&&P.ended?Bn(this||Q):I(this||Q),null;if(T=f(T,P),T===0&&P.ended)return P.length===0&&Bn(this||Q),null;let he=(P.state&ne)!==0;if(E("need readable",he),(P.length===0||P.length-T<P.highWaterMark)&&(he=!0,E("length less than watermark",he)),P.ended||P.reading||P.destroyed||P.errored||!P.constructed)he=!1,E("reading, ended or constructing",he);else if(he){E("do read"),P.state|=U|le,P.length===0&&(P.state|=ne);try{this._read(P.highWaterMark)}catch($e){_(this||Q,$e)}P.state&=~le,P.reading||(T=f(de,P))}let we;return T>0?we=ms(T,P):we=null,we===null?(P.needReadable=P.length<=P.highWaterMark,T=0):(P.length-=T,P.multiAwaitDrain?P.awaitDrainWriters.clear():P.awaitDrainWriters=null),P.length===0&&(P.ended||(P.needReadable=!0),de!==T&&P.ended&&Bn(this||Q)),we!==null&&!P.errorEmitted&&!P.closeEmitted&&(P.dataEmitted=!0,this.emit("data",we)),we};function c(T,P){if(E("onEofChunk"),!P.ended){if(P.decoder){let de=P.decoder.end();de&&de.length&&(P.buffer.push(de),P.length+=P.objectMode?1:de.length)}P.ended=!0,P.sync?I(T):(P.needReadable=!1,P.emittedReadable=!0,B(T))}}function I(T){let P=T._readableState;E("emitReadable",P.needReadable,P.emittedReadable),P.needReadable=!1,P.emittedReadable||(E("emitReadable",P.flowing),P.emittedReadable=!0,t.nextTick(B,T))}function B(T){let P=T._readableState;E("emitReadable_",P.destroyed,P.length,P.ended),!P.destroyed&&!P.errored&&(P.length||P.ended)&&(T.emit("readable"),P.emittedReadable=!1),P.needReadable=!P.flowing&&!P.ended&&P.length<=P.highWaterMark,ws(T)}function q(T,P){!P.readingMore&&P.constructed&&(P.readingMore=!0,t.nextTick(ee,T,P))}function ee(T,P){for(;!P.reading&&!P.ended&&(P.length<P.highWaterMark||P.flowing&&P.length===0);){let de=P.length;if(E("maybeReadMore read 0"),T.read(0),de===P.length)break}P.readingMore=!1}Z.prototype._read=function(T){throw new N("_read()")},Z.prototype.pipe=function(T,P){let de=this||Q,he=(this||Q)._readableState;he.pipes.length===1&&(he.multiAwaitDrain||(he.multiAwaitDrain=!0,he.awaitDrainWriters=new u(he.awaitDrainWriters?[he.awaitDrainWriters]:[]))),he.pipes.push(T),E("pipe count=%d opts=%j",he.pipes.length,P);let $e=(!P||P.end!==!1)&&T!==t.stdout&&T!==t.stderr?vs:er;he.endEmitted?t.nextTick($e):de.once("end",$e),T.on("unpipe",Ke);function Ke(It,lt){E("onunpipe"),It===de&&lt&&lt.hasUnpiped===!1&&(lt.hasUnpiped=!0,Tc())}function vs(){E("onend"),T.end()}let At,Es=!1;function Tc(){E("cleanup"),T.removeListener("close",Cn),T.removeListener("finish",Fn),At&&T.removeListener("drain",At),T.removeListener("error",Ln),T.removeListener("unpipe",Ke),de.removeListener("end",vs),de.removeListener("end",er),de.removeListener("data",xs),Es=!0,At&&he.awaitDrainWriters&&(!T._writableState||T._writableState.needDrain)&&At()}function _s(){Es||(he.pipes.length===1&&he.pipes[0]===T?(E("false write response, pause",0),he.awaitDrainWriters=T,he.multiAwaitDrain=!1):he.pipes.length>1&&he.pipes.includes(T)&&(E("false write response, pause",he.awaitDrainWriters.size),he.awaitDrainWriters.add(T)),de.pause()),At||(At=ve(de,T),T.on("drain",At))}de.on("data",xs);function xs(It){E("ondata");let lt=T.write(It);E("dest.write",lt),lt===!1&&_s()}function Ln(It){if(E("onerror",It),er(),T.removeListener("error",Ln),T.listenerCount("error")===0){let lt=T._writableState||T._readableState;lt&&!lt.errorEmitted?_(T,It):T.emit("error",It)}}m(T,"error",Ln);function Cn(){T.removeListener("finish",Fn),er()}T.once("close",Cn);function Fn(){E("onfinish"),T.removeListener("close",Cn),er()}T.once("finish",Fn);function er(){E("unpipe"),de.unpipe(T)}return T.emit("pipe",de),T.writableNeedDrain===!0?_s():he.flowing||(E("pipe resume"),de.resume()),T};function ve(T,P){return function(){let he=T._readableState;he.awaitDrainWriters===P?(E("pipeOnDrain",1),he.awaitDrainWriters=null):he.multiAwaitDrain&&(E("pipeOnDrain",he.awaitDrainWriters.size),he.awaitDrainWriters.delete(P)),(!he.awaitDrainWriters||he.awaitDrainWriters.size===0)&&T.listenerCount("data")&&T.resume()}}Z.prototype.unpipe=function(T){let P=(this||Q)._readableState,de={hasUnpiped:!1};if(P.pipes.length===0)return this||Q;if(!T){let we=P.pipes;P.pipes=[],this.pause();for(let $e=0;$e<we.length;$e++)we[$e].emit("unpipe",this||Q,{hasUnpiped:!1});return this||Q}let he=e(P.pipes,T);return he===-1?this||Q:(P.pipes.splice(he,1),P.pipes.length===0&&this.pause(),T.emit("unpipe",this||Q,de),this||Q)},Z.prototype.on=function(T,P){let de=g.prototype.on.call(this||Q,T,P),he=(this||Q)._readableState;return T==="data"?(he.readableListening=this.listenerCount("readable")>0,he.flowing!==!1&&this.resume()):T==="readable"&&!he.endEmitted&&!he.readableListening&&(he.readableListening=he.needReadable=!0,he.flowing=!1,he.emittedReadable=!1,E("on readable",he.length,he.reading),he.length?I(this||Q):he.reading||t.nextTick(Oe,this||Q)),de},Z.prototype.addListener=Z.prototype.on,Z.prototype.removeListener=function(T,P){let de=g.prototype.removeListener.call(this||Q,T,P);return T==="readable"&&t.nextTick(De,this||Q),de},Z.prototype.off=Z.prototype.removeListener,Z.prototype.removeAllListeners=function(T){let P=g.prototype.removeAllListeners.apply(this||Q,arguments);return(T==="readable"||T===void 0)&&t.nextTick(De,this||Q),P};function De(T){let P=T._readableState;P.readableListening=T.listenerCount("readable")>0,P.resumeScheduled&&P[pe]===!1?P.flowing=!0:T.listenerCount("data")>0?T.resume():P.readableListening||(P.flowing=null)}function Oe(T){E("readable nexttick read 0"),T.read(0)}Z.prototype.resume=function(){let T=(this||Q)._readableState;return T.flowing||(E("resume"),T.flowing=!T.readableListening,Ne(this||Q,T)),T[pe]=!1,this||Q};function Ne(T,P){P.resumeScheduled||(P.resumeScheduled=!0,t.nextTick(Te,T,P))}function Te(T,P){E("resume",P.reading),P.reading||T.read(0),P.resumeScheduled=!1,T.emit("resume"),ws(T),P.flowing&&!P.reading&&T.read(0)}Z.prototype.pause=function(){return E("call pause flowing=%j",(this||Q)._readableState.flowing),(this||Q)._readableState.flowing!==!1&&(E("pause"),(this||Q)._readableState.flowing=!1,this.emit("pause")),(this||Q)._readableState[pe]=!0,this||Q};function ws(T){let P=T._readableState;for(E("flow",P.flowing);P.flowing&&T.read()!==null;);}Z.prototype.wrap=function(T){let P=!1;T.on("data",he=>{!this.push(he)&&T.pause&&(P=!0,T.pause())}),T.on("end",()=>{this.push(null)}),T.on("error",he=>{_(this||Q,he)}),T.on("close",()=>{this.destroy()}),T.on("destroy",()=>{this.destroy()}),(this||Q)._read=()=>{P&&T.resume&&(P=!1,T.resume())};let de=s(T);for(let he=1;he<de.length;he++){let we=de[he];(this||Q)[we]===void 0&&typeof T[we]=="function"&&((this||Q)[we]=T[we].bind(T))}return this||Q},Z.prototype[d]=function(){return bs(this||Q)},Z.prototype.iterator=function(T){return T!==void 0&&ue(T,"options"),bs(this||Q,T)};function bs(T,P){typeof T.read!="function"&&(T=Z.wrap(T,{objectMode:!0}));let de=xc(T,P);return de.stream=T,de}function xc(T,P){return nt(this,null,function*(){let de=J;function he(Ke){(this||Q)===T?(de(),de=J):de=Ke}T.on("readable",he);let we,$e=b(T,{writable:!1},Ke=>{we=Ke?L(we,Ke):null,de(),de=J});try{for(;;){let Ke=T.destroyed?null:T.read();if(Ke!==null)yield Ke;else{if(we)throw we;if(we===null)return;yield new ze(new l(he))}}}catch(Ke){throw we=L(we,Ke),we}finally{(we||(P==null?void 0:P.destroyOnReturn)!==!1)&&(we===void 0||T._readableState.autoDestroy)?x.destroyer(T,null):(T.off("readable",he),$e())}})}i(Z.prototype,{readable:{__proto__:null,get(){let T=(this||Q)._readableState;return!!T&&T.readable!==!1&&!T.destroyed&&!T.errorEmitted&&!T.endEmitted},set(T){(this||Q)._readableState&&((this||Q)._readableState.readable=!!T)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return(this||Q)._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!((this||Q)._readableState.readable!==!1&&((this||Q)._readableState.destroyed||(this||Q)._readableState.errored)&&!(this||Q)._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return(this||Q)._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return(this||Q)._readableState&&(this||Q)._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return(this||Q)._readableState.flowing},set:function(T){(this||Q)._readableState&&((this||Q)._readableState.flowing=T)}},readableLength:{__proto__:null,enumerable:!1,get(){return(this||Q)._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return(this||Q)._readableState?(this||Q)._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return(this||Q)._readableState?(this||Q)._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return(this||Q)._readableState?(this||Q)._readableState.errored:null}},closed:{__proto__:null,get(){return(this||Q)._readableState?(this||Q)._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return(this||Q)._readableState?(this||Q)._readableState.destroyed:!1},set(T){(this||Q)._readableState&&((this||Q)._readableState.destroyed=T)}},readableEnded:{__proto__:null,enumerable:!1,get(){return(this||Q)._readableState?(this||Q)._readableState.endEmitted:!1}}}),i(se.prototype,{pipesCount:{__proto__:null,get(){return(this||Q).pipes.length}},paused:{__proto__:null,get(){return(this||Q)[pe]!==!1},set(T){(this||Q)[pe]=!!T}}}),Z._fromList=ms;function ms(T,P){if(P.length===0)return null;let de;return P.objectMode?de=P.buffer.shift():!T||T>=P.length?(P.decoder?de=P.buffer.join(""):P.buffer.length===1?de=P.buffer.first():de=P.buffer.concat(P.length),P.buffer.clear()):de=P.buffer.consume(T,P.decoder),de}function Bn(T){let P=T._readableState;E("endReadable",P.endEmitted),P.endEmitted||(P.ended=!0,t.nextTick(Ac,P,T))}function Ac(T,P){if(E("endReadableNT",T.endEmitted,T.length),!T.errored&&!T.closeEmitted&&!T.endEmitted&&T.length===0){if(T.endEmitted=!0,P.emit("end"),P.writable&&P.allowHalfOpen===!1)t.nextTick(Ic,P);else if(T.autoDestroy){let de=P._writableState;(!de||de.autoDestroy&&(de.finished||de.writable===!1))&&P.destroy()}}}function Ic(T){T.writable&&!T.writableEnded&&!T.destroyed&&T.end()}Z.from=function(T,P){return O(Z,T,P)};let kn;function Ss(){return kn===void 0&&(kn={}),kn}return Z.fromWeb=function(T,P){return Ss().newStreamReadableFromReadableStream(T,P)},Z.toWeb=function(T,P){return Ss().newReadableStreamFromStreamReadable(T,P)},Z.wrap=function(T,P){var de,he;return new Z(tt(Ee({objectMode:(de=(he=T.readableObjectMode)!==null&&he!==void 0?he:T.objectMode)!==null&&de!==void 0?de:!0},P),{destroy(we,$e){x.destroyer(T,we),$e(we)}})).wrap(T)},Oo}function zo(){if(ul)return Do;ul=!0;let t=et,{ArrayPrototypeSlice:e,Error:r,FunctionPrototypeSymbolHasInstance:n,ObjectDefineProperty:o,ObjectDefineProperties:i,ObjectSetPrototypeOf:s,StringPrototypeToLowerCase:a,Symbol:l,SymbolHasInstance:u}=ke();Do=ue,ue.WritableState=W;let{EventEmitter:h}=ut,d=$o().Stream,{Buffer:p}=at(),w=Yt(),{addAbortSignal:g}=wn(),{getHighWaterMark:m,getDefaultHighWaterMark:y}=bn(),{ERR_INVALID_ARG_TYPE:S,ERR_METHOD_NOT_IMPLEMENTED:b,ERR_MULTIPLE_CALLBACK:E,ERR_STREAM_CANNOT_PIPE:A,ERR_STREAM_DESTROYED:x,ERR_STREAM_ALREADY_FINISHED:z,ERR_STREAM_NULL_VALUES:G,ERR_STREAM_WRITE_AFTER_END:L,ERR_UNKNOWN_ENCODING:ie}=He().codes,{errorOrDestroy:N}=w;s(ue.prototype,d.prototype),s(ue,d);function F(){}let Y=l("kOnFinished");function W($,j,K){typeof K!="boolean"&&(K=j instanceof ht()),(this||ae).objectMode=!!($&&$.objectMode),K&&((this||ae).objectMode=(this||ae).objectMode||!!($&&$.writableObjectMode)),(this||ae).highWaterMark=$?m(this||ae,$,"writableHighWaterMark",K):y(!1),(this||ae).finalCalled=!1,(this||ae).needDrain=!1,(this||ae).ending=!1,(this||ae).ended=!1,(this||ae).finished=!1,(this||ae).destroyed=!1;let oe=!!($&&$.decodeStrings===!1);(this||ae).decodeStrings=!oe,(this||ae).defaultEncoding=$&&$.defaultEncoding||"utf8",(this||ae).length=0,(this||ae).writing=!1,(this||ae).corked=0,(this||ae).sync=!0,(this||ae).bufferProcessing=!1,(this||ae).onwrite=_.bind(void 0,j),(this||ae).writecb=null,(this||ae).writelen=0,(this||ae).afterWriteTickInfo=null,fe(this||ae),(this||ae).pendingcb=0,(this||ae).constructed=!0,(this||ae).prefinished=!1,(this||ae).errorEmitted=!1,(this||ae).emitClose=!$||$.emitClose!==!1,(this||ae).autoDestroy=!$||$.autoDestroy!==!1,(this||ae).errored=null,(this||ae).closed=!1,(this||ae).closeEmitted=!1,(this||ae)[Y]=[]}function fe($){$.buffered=[],$.bufferedIndex=0,$.allBuffers=!0,$.allNoop=!0}W.prototype.getBuffer=function(){return e((this||ae).buffered,(this||ae).bufferedIndex)},o(W.prototype,"bufferedRequestCount",{__proto__:null,get(){return(this||ae).buffered.length-(this||ae).bufferedIndex}});function ue($){let j=(this||ae)instanceof ht();if(!j&&!n(ue,this||ae))return new ue($);(this||ae)._writableState=new W($,this||ae,j),$&&(typeof $.write=="function"&&((this||ae)._write=$.write),typeof $.writev=="function"&&((this||ae)._writev=$.writev),typeof $.destroy=="function"&&((this||ae)._destroy=$.destroy),typeof $.final=="function"&&((this||ae)._final=$.final),typeof $.construct=="function"&&((this||ae)._construct=$.construct),$.signal&&g($.signal,this||ae)),d.call(this||ae,$),w.construct(this||ae,()=>{let K=(this||ae)._writableState;K.writing||U(this||ae,K),V(this||ae,K)})}o(ue,u,{__proto__:null,value:function($){return n(this||ae,$)?!0:(this||ae)!==ue?!1:$&&$._writableState instanceof W}}),ue.prototype.pipe=function(){N(this||ae,new A)};function pe($,j,K,oe){let ce=$._writableState;if(typeof K=="function")oe=K,K=ce.defaultEncoding;else{if(!K)K=ce.defaultEncoding;else if(K!=="buffer"&&!p.isEncoding(K))throw new ie(K);typeof oe!="function"&&(oe=F)}if(j===null)throw new G;if(!ce.objectMode)if(typeof j=="string")ce.decodeStrings!==!1&&(j=p.from(j,K),K="buffer");else if(j instanceof p)K="buffer";else if(d._isUint8Array(j))j=d._uint8ArrayToBuffer(j),K="buffer";else throw new S("chunk",["string","Buffer","Uint8Array"],j);let C;return ce.ending?C=new L:ce.destroyed&&(C=new x("write")),C?(t.nextTick(oe,C),N($,C,!0),C):(ce.pendingcb++,ge($,ce,j,K,oe))}ue.prototype.write=function($,j,K){return pe(this||ae,$,j,K)===!0},ue.prototype.cork=function(){(this||ae)._writableState.corked++},ue.prototype.uncork=function(){let $=(this||ae)._writableState;$.corked&&($.corked--,$.writing||U(this||ae,$))},ue.prototype.setDefaultEncoding=function(j){if(typeof j=="string"&&(j=a(j)),!p.isEncoding(j))throw new ie(j);return(this||ae)._writableState.defaultEncoding=j,this||ae};function ge($,j,K,oe,ce){let C=j.objectMode?1:K.length;j.length+=C;let k=j.length<j.highWaterMark;return k||(j.needDrain=!0),j.writing||j.corked||j.errored||!j.constructed?(j.buffered.push({chunk:K,encoding:oe,callback:ce}),j.allBuffers&&oe!=="buffer"&&(j.allBuffers=!1),j.allNoop&&ce!==F&&(j.allNoop=!1)):(j.writelen=C,j.writecb=ce,j.writing=!0,j.sync=!0,$._write(K,oe,j.onwrite),j.sync=!1),k&&!j.errored&&!j.destroyed}function O($,j,K,oe,ce,C,k){j.writelen=oe,j.writecb=k,j.writing=!0,j.sync=!0,j.destroyed?j.onwrite(new x("write")):K?$._writev(ce,j.onwrite):$._write(ce,C,j.onwrite),j.sync=!1}function J($,j,K,oe){--j.pendingcb,oe(K),R(j),N($,K)}function _($,j){let K=$._writableState,oe=K.sync,ce=K.writecb;if(typeof ce!="function"){N($,new E);return}K.writing=!1,K.writecb=null,K.length-=K.writelen,K.writelen=0,j?(j.stack,K.errored||(K.errored=j),$._readableState&&!$._readableState.errored&&($._readableState.errored=j),oe?t.nextTick(J,$,K,j,ce):J($,K,j,ce)):(K.buffered.length>K.bufferedIndex&&U($,K),oe?K.afterWriteTickInfo!==null&&K.afterWriteTickInfo.cb===ce?K.afterWriteTickInfo.count++:(K.afterWriteTickInfo={count:1,cb:ce,stream:$,state:K},t.nextTick(M,K.afterWriteTickInfo)):D($,K,1,ce))}function M({stream:$,state:j,count:K,cb:oe}){return j.afterWriteTickInfo=null,D($,j,K,oe)}function D($,j,K,oe){for(!j.ending&&!$.destroyed&&j.length===0&&j.needDrain&&(j.needDrain=!1,$.emit("drain"));K-- >0;)j.pendingcb--,oe();j.destroyed&&R(j),V($,j)}function R($){if($.writing)return;for(let ce=$.bufferedIndex;ce<$.buffered.length;++ce){var j;let{chunk:C,callback:k}=$.buffered[ce],te=$.objectMode?1:C.length;$.length-=te,k((j=$.errored)!==null&&j!==void 0?j:new x("write"))}let K=$[Y].splice(0);for(let ce=0;ce<K.length;ce++){var oe;K[ce]((oe=$.errored)!==null&&oe!==void 0?oe:new x("end"))}fe($)}function U($,j){if(j.corked||j.bufferProcessing||j.destroyed||!j.constructed)return;let{buffered:K,bufferedIndex:oe,objectMode:ce}=j,C=K.length-oe;if(!C)return;let k=oe;if(j.bufferProcessing=!0,C>1&&$._writev){j.pendingcb-=C-1;let te=j.allNoop?F:Z=>{for(let Ae=k;Ae<K.length;++Ae)K[Ae].callback(Z)},se=j.allNoop&&k===0?K:e(K,k);se.allBuffers=j.allBuffers,O($,j,!0,j.length,se,"",te),fe(j)}else{do{let{chunk:te,encoding:se,callback:Z}=K[k];K[k++]=null;let Ae=ce?1:te.length;O($,j,!1,Ae,te,se,Z)}while(k<K.length&&!j.writing);k===K.length?fe(j):k>256?(K.splice(0,k),j.bufferedIndex=0):j.bufferedIndex=k}j.bufferProcessing=!1}ue.prototype._write=function($,j,K){if((this||ae)._writev)this._writev([{chunk:$,encoding:j}],K);else throw new b("_write()")},ue.prototype._writev=null,ue.prototype.end=function($,j,K){let oe=(this||ae)._writableState;typeof $=="function"?(K=$,$=null,j=null):typeof j=="function"&&(K=j,j=null);let ce;if($!=null){let C=pe(this||ae,$,j);C instanceof r&&(ce=C)}return oe.corked&&(oe.corked=1,this.uncork()),ce||(!oe.errored&&!oe.ending?(oe.ending=!0,V(this||ae,oe,!0),oe.ended=!0):oe.finished?ce=new z("end"):oe.destroyed&&(ce=new x("end"))),typeof K=="function"&&(ce||oe.finished?t.nextTick(K,ce):oe[Y].push(K)),this||ae};function X($){return $.ending&&!$.destroyed&&$.constructed&&$.length===0&&!$.errored&&$.buffered.length===0&&!$.finished&&!$.writing&&!$.errorEmitted&&!$.closeEmitted}function le($,j){let K=!1;function oe(ce){if(K){N($,ce!=null?ce:E());return}if(K=!0,j.pendingcb--,ce){let C=j[Y].splice(0);for(let k=0;k<C.length;k++)C[k](ce);N($,ce,j.sync)}else X(j)&&(j.prefinished=!0,$.emit("prefinish"),j.pendingcb++,t.nextTick(H,$,j))}j.sync=!0,j.pendingcb++;try{$._final(oe)}catch(ce){oe(ce)}j.sync=!1}function ne($,j){!j.prefinished&&!j.finalCalled&&(typeof $._final=="function"&&!j.destroyed?(j.finalCalled=!0,le($,j)):(j.prefinished=!0,$.emit("prefinish")))}function V($,j,K){X(j)&&(ne($,j),j.pendingcb===0&&(K?(j.pendingcb++,t.nextTick((oe,ce)=>{X(ce)?H(oe,ce):ce.pendingcb--},$,j)):X(j)&&(j.pendingcb++,H($,j))))}function H($,j){j.pendingcb--,j.finished=!0;let K=j[Y].splice(0);for(let oe=0;oe<K.length;oe++)K[oe]();if($.emit("finish"),j.autoDestroy){let oe=$._readableState;(!oe||oe.autoDestroy&&(oe.endEmitted||oe.readable===!1))&&$.destroy()}}i(ue.prototype,{closed:{__proto__:null,get(){return(this||ae)._writableState?(this||ae)._writableState.closed:!1}},destroyed:{__proto__:null,get(){return(this||ae)._writableState?(this||ae)._writableState.destroyed:!1},set($){(this||ae)._writableState&&((this||ae)._writableState.destroyed=$)}},writable:{__proto__:null,get(){let $=(this||ae)._writableState;return!!$&&$.writable!==!1&&!$.destroyed&&!$.errored&&!$.ending&&!$.ended},set($){(this||ae)._writableState&&((this||ae)._writableState.writable=!!$)}},writableFinished:{__proto__:null,get(){return(this||ae)._writableState?(this||ae)._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return(this||ae)._writableState?(this||ae)._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return(this||ae)._writableState&&(this||ae)._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return(this||ae)._writableState?(this||ae)._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){let $=(this||ae)._writableState;return $?!$.destroyed&&!$.ending&&$.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return(this||ae)._writableState&&(this||ae)._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return(this||ae)._writableState?(this||ae)._writableState.corked:0}},writableLength:{__proto__:null,get(){return(this||ae)._writableState&&(this||ae)._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return(this||ae)._writableState?(this||ae)._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!((this||ae)._writableState.writable!==!1&&((this||ae)._writableState.destroyed||(this||ae)._writableState.errored)&&!(this||ae)._writableState.finished)}}});let re=w.destroy;ue.prototype.destroy=function($,j){let K=(this||ae)._writableState;return!K.destroyed&&(K.bufferedIndex<K.buffered.length||K[Y].length)&&t.nextTick(R,K),re.call(this||ae,$,j),this||ae},ue.prototype._undestroy=w.undestroy,ue.prototype._destroy=function($,j){j($)},ue.prototype[h.captureRejectionSymbol]=function($){this.destroy($)};let ye;function be(){return ye===void 0&&(ye={}),ye}return ue.fromWeb=function($,j){return be().newStreamWritableFromWritableStream($,j)},ue.toWeb=function($){return be().newWritableStreamFromStreamWritable($)},Do}function Xh(){if(dl)return No;dl=!0;let t=et,e=at(),{isReadable:r,isWritable:n,isIterable:o,isNodeStream:i,isReadableNodeStream:s,isWritableNodeStream:a,isDuplexNodeStream:l,isReadableStream:u,isWritableStream:h}=pt(),d=Et(),{AbortError:p,codes:{ERR_INVALID_ARG_TYPE:w,ERR_INVALID_RETURN_VALUE:g}}=He(),{destroyer:m}=Yt(),y=ht(),S=mn(),b=zo(),{createDeferredPromise:E}=je(),A=_l(),x=globalThis.Blob||e.Blob,z=typeof x!="undefined"?function(W){return W instanceof x}:function(W){return!1},G=globalThis.AbortController||Ir().AbortController,{FunctionPrototypeCall:L}=ke();class ie extends y{constructor(W){super(W),(W==null?void 0:W.readable)===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),(W==null?void 0:W.writable)===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}}No=function Y(W,fe){if(l(W))return W;if(s(W))return F({readable:W});if(a(W))return F({writable:W});if(i(W))return F({writable:!1,readable:!1});if(u(W))return F({readable:S.fromWeb(W)});if(h(W))return F({writable:b.fromWeb(W)});if(typeof W=="function"){let{value:pe,write:ge,final:O,destroy:J}=N(W);if(o(pe))return A(ie,pe,{objectMode:!0,write:ge,final:O,destroy:J});let _=pe==null?void 0:pe.then;if(typeof _=="function"){let M,D=L(_,pe,R=>{if(R!=null)throw new g("nully","body",R)},R=>{m(M,R)});return M=new ie({objectMode:!0,readable:!1,write:ge,final(R){O(async()=>{try{await D,t.nextTick(R,null)}catch(U){t.nextTick(R,U)}})},destroy:J})}throw new g("Iterable, AsyncIterable or AsyncFunction",fe,pe)}if(z(W))return Y(W.arrayBuffer());if(o(W))return A(ie,W,{objectMode:!0,writable:!1});if(u(W==null?void 0:W.readable)&&h(W==null?void 0:W.writable))return ie.fromWeb(W);if(typeof(W==null?void 0:W.writable)=="object"||typeof(W==null?void 0:W.readable)=="object"){let pe=W!=null&&W.readable?s(W==null?void 0:W.readable)?W==null?void 0:W.readable:Y(W.readable):void 0,ge=W!=null&&W.writable?a(W==null?void 0:W.writable)?W==null?void 0:W.writable:Y(W.writable):void 0;return F({readable:pe,writable:ge})}let ue=W==null?void 0:W.then;if(typeof ue=="function"){let pe;return L(ue,W,ge=>{ge!=null&&pe.push(ge),pe.push(null)},ge=>{m(pe,ge)}),pe=new ie({objectMode:!0,writable:!1,read(){}})}throw new w(fe,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],W)};function N(Y){let{promise:W,resolve:fe}=E(),ue=new G,pe=ue.signal;return{value:Y(function(){return nt(this,null,function*(){for(;;){let O=W;W=null;let{chunk:J,done:_,cb:M}=yield new ze(O);if(t.nextTick(M),_)return;if(pe.aborted)throw new p(void 0,{cause:pe.reason});({promise:W,resolve:fe}=E()),yield J}})}(),{signal:pe}),write(O,J,_){let M=fe;fe=null,M({chunk:O,done:!1,cb:_})},final(O){let J=fe;fe=null,J({done:!0,cb:O})},destroy(O,J){ue.abort(),J(O)}}}function F(Y){let W=Y.readable&&typeof Y.readable.read!="function"?S.wrap(Y.readable):Y.readable,fe=Y.writable,ue=!!r(W),pe=!!n(fe),ge,O,J,_,M;function D(R){let U=_;_=null,U?U(R):R&&M.destroy(R)}return M=new ie({readableObjectMode:!!(W!=null&&W.readableObjectMode),writableObjectMode:!!(fe!=null&&fe.writableObjectMode),readable:ue,writable:pe}),pe&&(d(fe,R=>{pe=!1,R&&m(W,R),D(R)}),M._write=function(R,U,X){fe.write(R,U)?X():ge=X},M._final=function(R){fe.end(),O=R},fe.on("drain",function(){if(ge){let R=ge;ge=null,R()}}),fe.on("finish",function(){if(O){let R=O;O=null,R()}})),ue&&(d(W,R=>{ue=!1,R&&m(W,R),D(R)}),W.on("readable",function(){if(J){let R=J;J=null,R()}}),W.on("end",function(){M.push(null)}),M._read=function(){for(;;){let R=W.read();if(R===null){J=M._read;return}if(!M.push(R))return}}),M._destroy=function(R,U){!R&&_!==null&&(R=new p),J=null,ge=null,O=null,_===null?U(R):(_=U,m(fe,R),m(W,R))},M}return No}function ht(){if(hl)return Po;hl=!0;let{ObjectDefineProperties:t,ObjectGetOwnPropertyDescriptor:e,ObjectKeys:r,ObjectSetPrototypeOf:n}=ke();Po=s;let o=mn(),i=zo();n(s.prototype,o.prototype),n(s,o);{let h=r(i.prototype);for(let d=0;d<h.length;d++){let p=h[d];s.prototype[p]||(s.prototype[p]=i.prototype[p])}}function s(h){if(!(this instanceof s))return new s(h);o.call(this,h),i.call(this,h),h?(this.allowHalfOpen=h.allowHalfOpen!==!1,h.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),h.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}t(s.prototype,{writable:Ee({__proto__:null},e(i.prototype,"writable")),writableHighWaterMark:Ee({__proto__:null},e(i.prototype,"writableHighWaterMark")),writableObjectMode:Ee({__proto__:null},e(i.prototype,"writableObjectMode")),writableBuffer:Ee({__proto__:null},e(i.prototype,"writableBuffer")),writableLength:Ee({__proto__:null},e(i.prototype,"writableLength")),writableFinished:Ee({__proto__:null},e(i.prototype,"writableFinished")),writableCorked:Ee({__proto__:null},e(i.prototype,"writableCorked")),writableEnded:Ee({__proto__:null},e(i.prototype,"writableEnded")),writableNeedDrain:Ee({__proto__:null},e(i.prototype,"writableNeedDrain")),destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(h){this._readableState&&this._writableState&&(this._readableState.destroyed=h,this._writableState.destroyed=h)}}});let a;function l(){return a===void 0&&(a={}),a}s.fromWeb=function(h,d){return l().newStreamDuplexFromReadableWritablePair(h,d)},s.toWeb=function(h){return l().newReadableWritablePairFromDuplex(h)};let u;return s.from=function(h){return u||(u=Xh()),u(h,"body")},Po}function xl(){if(pl)return Uo;pl=!0;let{ObjectSetPrototypeOf:t,Symbol:e}=ke();Uo=s;let{ERR_METHOD_NOT_IMPLEMENTED:r}=He().codes,n=ht(),{getHighWaterMark:o}=bn();t(s.prototype,n.prototype),t(s,n);let i=e("kCallback");function s(u){if(!(this instanceof s))return new s(u);let h=u?o(this,u,"readableHighWaterMark",!0):null;h===0&&(u=tt(Ee({},u),{highWaterMark:null,readableHighWaterMark:h,writableHighWaterMark:u.writableHighWaterMark||0})),n.call(this,u),this._readableState.sync=!1,this[i]=null,u&&(typeof u.transform=="function"&&(this._transform=u.transform),typeof u.flush=="function"&&(this._flush=u.flush)),this.on("prefinish",l)}function a(u){typeof this._flush=="function"&&!this.destroyed?this._flush((h,d)=>{if(h){u?u(h):this.destroy(h);return}d!=null&&this.push(d),this.push(null),u&&u()}):(this.push(null),u&&u())}function l(){this._final!==a&&a.call(this)}return s.prototype._final=a,s.prototype._transform=function(u,h,d){throw new r("_transform()")},s.prototype._write=function(u,h,d){let p=this._readableState,w=this._writableState,g=p.length;this._transform(u,h,(m,y)=>{if(m){d(m);return}y!=null&&this.push(y),w.ended||g===p.length||p.length<p.highWaterMark?d():this[i]=d})},s.prototype._read=function(){if(this[i]){let u=this[i];this[i]=null,u()}},Uo}function Al(){if(yl)return Mo;yl=!0;let{ObjectSetPrototypeOf:t}=ke();Mo=r;let e=xl();t(r.prototype,e.prototype),t(r,e);function r(n){if(!(this instanceof r))return new r(n);e.call(this,n)}return r.prototype._transform=function(n,o,i){i(null,n)},Mo}function Wo(){if(gl)return Bo;gl=!0;let t=et,{ArrayIsArray:e,Promise:r,SymbolAsyncIterator:n,SymbolDispose:o}=ke(),i=Et(),{once:s}=je(),a=Yt(),l=ht(),{aggregateTwoErrors:u,codes:{ERR_INVALID_ARG_TYPE:h,ERR_INVALID_RETURN_VALUE:d,ERR_MISSING_ARGS:p,ERR_STREAM_DESTROYED:w,ERR_STREAM_PREMATURE_CLOSE:g},AbortError:m}=He(),{validateFunction:y,validateAbortSignal:S}=Tr(),{isIterable:b,isReadable:E,isReadableNodeStream:A,isNodeStream:x,isTransformStream:z,isWebStream:G,isReadableStream:L,isReadableFinished:ie}=pt(),N=globalThis.AbortController||Ir().AbortController,F,Y,W;function fe(R,U,X){let le=!1;R.on("close",()=>{le=!0});let ne=i(R,{readable:U,writable:X},V=>{le=!V});return{destroy:V=>{le||(le=!0,a.destroyer(R,V||new w("pipe")))},cleanup:ne}}function ue(R){return y(R[R.length-1],"streams[stream.length - 1]"),R.pop()}function pe(R){if(b(R))return R;if(A(R))return ge(R);throw new h("val",["Readable","Iterable","AsyncIterable"],R)}function ge(R){return nt(this,null,function*(){Y||(Y=mn()),yield*zn(Y.prototype[n].call(R))})}async function O(R,U,X,{end:le}){let ne,V=null,H=oe=>{if(oe&&(ne=oe),V){let ce=V;V=null,ce()}},re=()=>new r((oe,ce)=>{ne?ce(ne):V=()=>{ne?ce(ne):oe()}});U.on("drain",H);let ye=i(U,{readable:!1},H);try{U.writableNeedDrain&&await re();try{for(var be=Ge(R),$,j,K;$=!(j=await be.next()).done;$=!1){let oe=j.value;U.write(oe)||await re()}}catch(j){K=[j]}finally{try{$&&(j=be.return)&&await j.call(be)}finally{if(K)throw K[0]}}le&&(U.end(),await re()),X()}catch(oe){X(ne!==oe?u(ne,oe):oe)}finally{ye(),U.off("drain",H)}}async function J(R,U,X,{end:le}){z(U)&&(U=U.writable);let ne=U.getWriter();try{try{for(var V=Ge(R),H,re,ye;H=!(re=await V.next()).done;H=!1){let be=re.value;await ne.ready,ne.write(be).catch(()=>{})}}catch(re){ye=[re]}finally{try{H&&(re=V.return)&&await re.call(V)}finally{if(ye)throw ye[0]}}await ne.ready,le&&await ne.close(),X()}catch(be){try{await ne.abort(be),X(be)}catch($){X($)}}}function _(...R){return M(R,s(ue(R)))}function M(R,U,X){if(R.length===1&&e(R[0])&&(R=R[0]),R.length<2)throw new p("streams");let le=new N,ne=le.signal,V=X==null?void 0:X.signal,H=[];S(V,"options.signal");function re(){ce(new m)}W=W||je().addAbortListener;let ye;V&&(ye=W(V,re));let be,$,j=[],K=0;function oe(se){ce(se,--K===0)}function ce(se,Z){var Ae;if(se&&(!be||be.code==="ERR_STREAM_PREMATURE_CLOSE")&&(be=se),!(!be&&!Z)){for(;j.length;)j.shift()(be);(Ae=ye)===null||Ae===void 0||Ae[o](),le.abort(),Z&&(be||H.forEach(Ue=>Ue()),t.nextTick(U,be,$))}}let C;for(let se=0;se<R.length;se++){let Z=R[se],Ae=se<R.length-1,Ue=se>0,Le=Ae||(X==null?void 0:X.end)!==!1,v=se===R.length-1;if(x(Z)){let f=function(c){c&&c.name!=="AbortError"&&c.code!=="ERR_STREAM_PREMATURE_CLOSE"&&oe(c)};if(Le){let{destroy:c,cleanup:I}=fe(Z,Ae,Ue);j.push(c),E(Z)&&v&&H.push(I)}Z.on("error",f),E(Z)&&v&&H.push(()=>{Z.removeListener("error",f)})}if(se===0)if(typeof Z=="function"){if(C=Z({signal:ne}),!b(C))throw new d("Iterable, AsyncIterable or Stream","source",C)}else b(Z)||A(Z)||z(Z)?C=Z:C=l.from(Z);else if(typeof Z=="function"){if(z(C)){var k;C=pe((k=C)===null||k===void 0?void 0:k.readable)}else C=pe(C);if(C=Z(C,{signal:ne}),Ae){if(!b(C,!0))throw new d("AsyncIterable",`transform[${se-1}]`,C)}else{var te;F||(F=Al());let f=new F({objectMode:!0}),c=(te=C)===null||te===void 0?void 0:te.then;if(typeof c=="function")K++,c.call(C,q=>{$=q,q!=null&&f.write(q),Le&&f.end(),t.nextTick(oe)},q=>{f.destroy(q),t.nextTick(oe,q)});else if(b(C,!0))K++,O(C,f,oe,{end:Le});else if(L(C)||z(C)){let q=C.readable||C;K++,O(q,f,oe,{end:Le})}else throw new d("AsyncIterable or Promise","destination",C);C=f;let{destroy:I,cleanup:B}=fe(C,!1,!0);j.push(I),v&&H.push(B)}}else if(x(Z)){if(A(C)){K+=2;let f=D(C,Z,oe,{end:Le});E(Z)&&v&&H.push(f)}else if(z(C)||L(C)){let f=C.readable||C;K++,O(f,Z,oe,{end:Le})}else if(b(C))K++,O(C,Z,oe,{end:Le});else throw new h("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],C);C=Z}else if(G(Z)){if(A(C))K++,J(pe(C),Z,oe,{end:Le});else if(L(C)||b(C))K++,J(C,Z,oe,{end:Le});else if(z(C))K++,J(C.readable,Z,oe,{end:Le});else throw new h("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],C);C=Z}else C=l.from(Z)}return(ne!=null&&ne.aborted||V!=null&&V.aborted)&&t.nextTick(re),C}function D(R,U,X,{end:le}){let ne=!1;if(U.on("close",()=>{ne||X(new g)}),R.pipe(U,{end:!1}),le){let V=function(){ne=!0,U.end()};ie(R)?t.nextTick(V):R.once("end",V)}else X();return i(R,{readable:!0,writable:!1},V=>{let H=R._readableState;V&&V.code==="ERR_STREAM_PREMATURE_CLOSE"&&H&&H.ended&&!H.errored&&!H.errorEmitted?R.once("end",X).once("error",X):X(V)}),i(U,{readable:!1,writable:!0},X)}return Bo={pipelineImpl:M,pipeline:_},Bo}function Il(){if(wl)return ko;wl=!0;let{pipeline:t}=Wo(),e=ht(),{destroyer:r}=Yt(),{isNodeStream:n,isReadable:o,isWritable:i,isWebStream:s,isTransformStream:a,isWritableStream:l,isReadableStream:u}=pt(),{AbortError:h,codes:{ERR_INVALID_ARG_VALUE:d,ERR_MISSING_ARGS:p}}=He(),w=Et();return ko=function(...m){if(m.length===0)throw new p("streams");if(m.length===1)return e.from(m[0]);let y=[...m];if(typeof m[0]=="function"&&(m[0]=e.from(m[0])),typeof m[m.length-1]=="function"){let F=m.length-1;m[F]=e.from(m[F])}for(let F=0;F<m.length;++F)if(!(!n(m[F])&&!s(m[F]))){if(F<m.length-1&&!(o(m[F])||u(m[F])||a(m[F])))throw new d(`streams[${F}]`,y[F],"must be readable");if(F>0&&!(i(m[F])||l(m[F])||a(m[F])))throw new d(`streams[${F}]`,y[F],"must be writable")}let S,b,E,A,x;function z(F){let Y=A;A=null,Y?Y(F):F?x.destroy(F):!N&&!ie&&x.destroy()}let G=m[0],L=t(m,z),ie=!!(i(G)||l(G)||a(G)),N=!!(o(L)||u(L)||a(L));if(x=new e({writableObjectMode:!!(G!=null&&G.writableObjectMode),readableObjectMode:!!(L!=null&&L.readableObjectMode),writable:ie,readable:N}),ie){if(n(G))x._write=function(Y,W,fe){G.write(Y,W)?fe():S=fe},x._final=function(Y){G.end(),b=Y},G.on("drain",function(){if(S){let Y=S;S=null,Y()}});else if(s(G)){let W=(a(G)?G.writable:G).getWriter();x._write=async function(fe,ue,pe){try{await W.ready,W.write(fe).catch(()=>{}),pe()}catch(ge){pe(ge)}},x._final=async function(fe){try{await W.ready,W.close().catch(()=>{}),b=fe}catch(ue){fe(ue)}}}let F=a(L)?L.readable:L;w(F,()=>{if(b){let Y=b;b=null,Y()}})}if(N){if(n(L))L.on("readable",function(){if(E){let F=E;E=null,F()}}),L.on("end",function(){x.push(null)}),x._read=function(){for(;;){let F=L.read();if(F===null){E=x._read;return}if(!x.push(F))return}};else if(s(L)){let Y=(a(L)?L.readable:L).getReader();x._read=async function(){for(;;)try{let{value:W,done:fe}=await Y.read();if(!x.push(W))return;if(fe){x.push(null);return}}catch(W){return}}}}return x._destroy=function(F,Y){!F&&A!==null&&(F=new h),E=null,S=null,b=null,A===null?Y(F):(A=Y,n(L)&&r(L,F))},x},ko}function Zh(){if(bl)return gn;bl=!0;let t=globalThis.AbortController||Ir().AbortController,{codes:{ERR_INVALID_ARG_VALUE:e,ERR_INVALID_ARG_TYPE:r,ERR_MISSING_ARGS:n,ERR_OUT_OF_RANGE:o},AbortError:i}=He(),{validateAbortSignal:s,validateInteger:a,validateObject:l}=Tr(),u=ke().Symbol("kWeak"),h=ke().Symbol("kResistStopPropagation"),{finished:d}=Et(),p=Il(),{addAbortSignalNoValidate:w}=wn(),{isWritable:g,isNodeStream:m}=pt(),{deprecate:y}=je(),{ArrayPrototypePush:S,Boolean:b,MathFloor:E,Number:A,NumberIsNaN:x,Promise:z,PromiseReject:G,PromiseResolve:L,PromisePrototypeThen:ie,Symbol:N}=ke(),F=N("kEmpty"),Y=N("kEof");function W(V,H){if(H!=null&&l(H,"options"),(H==null?void 0:H.signal)!=null&&s(H.signal,"options.signal"),m(V)&&!g(V))throw new e("stream",V,"must be writable");let re=p(this,V);return H!=null&&H.signal&&w(H.signal,re),re}function fe(V,H){if(typeof V!="function")throw new r("fn",["Function","AsyncFunction"],V);H!=null&&l(H,"options"),(H==null?void 0:H.signal)!=null&&s(H.signal,"options.signal");let re=1;(H==null?void 0:H.concurrency)!=null&&(re=E(H.concurrency));let ye=re-1;return(H==null?void 0:H.highWaterMark)!=null&&(ye=E(H.highWaterMark)),a(re,"options.concurrency",1),a(ye,"options.highWaterMark",0),ye+=re,function(){return nt(this,null,function*(){let $=je().AbortSignalAny([H==null?void 0:H.signal].filter(b)),j=this,K=[],oe={signal:$},ce,C,k=!1,te=0;function se(){k=!0,Z()}function Z(){te-=1,Ae()}function Ae(){C&&!k&&te<re&&K.length<ye&&(C(),C=null)}async function Ue(){try{try{for(var Le=Ge(j),v,f,c;v=!(f=await Le.next()).done;v=!1){let I=f.value;if(k)return;if($.aborted)throw new i;try{if(I=V(I,oe),I===F)continue;I=L(I)}catch(B){I=G(B)}te+=1,ie(I,Z,se),K.push(I),ce&&(ce(),ce=null),!k&&(K.length>=ye||te>=re)&&await new z(B=>{C=B})}}catch(f){c=[f]}finally{try{v&&(f=Le.return)&&await f.call(Le)}finally{if(c)throw c[0]}}K.push(Y)}catch(I){let B=G(I);ie(B,Z,se),K.push(B)}finally{k=!0,ce&&(ce(),ce=null)}}Ue();try{for(;;){for(;K.length>0;){let Le=yield new ze(K[0]);if(Le===Y)return;if($.aborted)throw new i;Le!==F&&(yield Le),K.shift(),Ae()}yield new ze(new z(Le=>{ce=Le}))}}finally{k=!0,C&&(C(),C=null)}})}.call(this)}function ue(V=void 0){return V!=null&&l(V,"options"),(V==null?void 0:V.signal)!=null&&s(V.signal,"options.signal"),function(){return nt(this,null,function*(){let re=0;try{for(var be=Ge(this),$,j,K;$=!(j=yield new ze(be.next())).done;$=!1){let oe=j.value;var ye;if(V!=null&&(ye=V.signal)!==null&&ye!==void 0&&ye.aborted)throw new i({cause:V.signal.reason});yield[re++,oe]}}catch(j){K=[j]}finally{try{$&&(j=be.return)&&(yield new ze(j.call(be)))}finally{if(K)throw K[0]}}})}.call(this)}async function pe(V,H=void 0){try{for(var re=Ge(_.call(this,V,H)),ye,be,$;ye=!(be=await re.next()).done;ye=!1){let j=be.value;return!0}}catch(be){$=[be]}finally{try{ye&&(be=re.return)&&await be.call(re)}finally{if($)throw $[0]}}return!1}async function ge(V,H=void 0){if(typeof V!="function")throw new r("fn",["Function","AsyncFunction"],V);return!await pe.call(this,async(...re)=>!await V(...re),H)}async function O(V,H){try{for(var re=Ge(_.call(this,V,H)),ye,be,$;ye=!(be=await re.next()).done;ye=!1){let j=be.value;return j}}catch(be){$=[be]}finally{try{ye&&(be=re.return)&&await be.call(re)}finally{if($)throw $[0]}}}async function J(V,H){if(typeof V!="function")throw new r("fn",["Function","AsyncFunction"],V);async function re(K,oe){return await V(K,oe),F}try{for(var ye=Ge(fe.call(this,re,H)),be,$,j;be=!($=await ye.next()).done;be=!1){let K=$.value;;}}catch($){j=[$]}finally{try{be&&($=ye.return)&&await $.call(ye)}finally{if(j)throw j[0]}}}function _(V,H){if(typeof V!="function")throw new r("fn",["Function","AsyncFunction"],V);async function re(ye,be){return await V(ye,be)?ye:F}return fe.call(this,re,H)}class M extends n{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}}async function D(V,H,re){var ye;if(typeof V!="function")throw new r("reducer",["Function","AsyncFunction"],V);re!=null&&l(re,"options"),(re==null?void 0:re.signal)!=null&&s(re.signal,"options.signal");let be=arguments.length>1;if(re!=null&&(ye=re.signal)!==null&&ye!==void 0&&ye.aborted){let se=new i(void 0,{cause:re.signal.reason});throw this.once("error",()=>{}),await d(this.destroy(se)),se}let $=new t,j=$.signal;if(re!=null&&re.signal){let se={once:!0,[u]:this,[h]:!0};re.signal.addEventListener("abort",()=>$.abort(),se)}let K=!1;try{try{for(var ce=Ge(this),C,k,te;C=!(k=await ce.next()).done;C=!1){let se=k.value;var oe;if(K=!0,re!=null&&(oe=re.signal)!==null&&oe!==void 0&&oe.aborted)throw new i;be?H=await V(H,se,{signal:j}):(H=se,be=!0)}}catch(k){te=[k]}finally{try{C&&(k=ce.return)&&await k.call(ce)}finally{if(te)throw te[0]}}if(!K&&!be)throw new M}finally{$.abort()}return H}async function R(V){V!=null&&l(V,"options"),(V==null?void 0:V.signal)!=null&&s(V.signal,"options.signal");let H=[];try{for(var ye=Ge(this),be,$,j;be=!($=await ye.next()).done;be=!1){let K=$.value;var re;if(V!=null&&(re=V.signal)!==null&&re!==void 0&&re.aborted)throw new i(void 0,{cause:V.signal.reason});S(H,K)}}catch($){j=[$]}finally{try{be&&($=ye.return)&&await $.call(ye)}finally{if(j)throw j[0]}}return H}function U(V,H){let re=fe.call(this,V,H);return function(){return nt(this,null,function*(){try{for(var be=Ge(re),$,j,K;$=!(j=yield new ze(be.next())).done;$=!1){let oe=j.value;yield*zn(oe)}}catch(j){K=[j]}finally{try{$&&(j=be.return)&&(yield new ze(j.call(be)))}finally{if(K)throw K[0]}}})}.call(this)}function X(V){if(V=A(V),x(V))return 0;if(V<0)throw new o("number",">= 0",V);return V}function le(V,H=void 0){return H!=null&&l(H,"options"),(H==null?void 0:H.signal)!=null&&s(H.signal,"options.signal"),V=X(V),function(){return nt(this,null,function*(){var ye;if(H!=null&&(ye=H.signal)!==null&&ye!==void 0&&ye.aborted)throw new i;try{for(var $=Ge(this),j,K,oe;j=!(K=yield new ze($.next())).done;j=!1){let ce=K.value;var be;if(H!=null&&(be=H.signal)!==null&&be!==void 0&&be.aborted)throw new i;V--<=0&&(yield ce)}}catch(K){oe=[K]}finally{try{j&&(K=$.return)&&(yield new ze(K.call($)))}finally{if(oe)throw oe[0]}}})}.call(this)}function ne(V,H=void 0){return H!=null&&l(H,"options"),(H==null?void 0:H.signal)!=null&&s(H.signal,"options.signal"),V=X(V),function(){return nt(this,null,function*(){var ye;if(H!=null&&(ye=H.signal)!==null&&ye!==void 0&&ye.aborted)throw new i;try{for(var $=Ge(this),j,K,oe;j=!(K=yield new ze($.next())).done;j=!1){let ce=K.value;var be;if(H!=null&&(be=H.signal)!==null&&be!==void 0&&be.aborted)throw new i;if(V-- >0&&(yield ce),V<=0)return}}catch(K){oe=[K]}finally{try{j&&(K=$.return)&&(yield new ze(K.call($)))}finally{if(oe)throw oe[0]}}})}.call(this)}return gn.streamReturningOperators={asIndexedPairs:y(ue,"readable.asIndexedPairs will be removed in a future version."),drop:le,filter:_,flatMap:U,map:fe,take:ne,compose:W},gn.promiseReturningOperators={every:ge,forEach:J,reduce:D,toArray:R,some:pe,find:O},gn}function Tl(){if(ml)return Lo;ml=!0;let{ArrayPrototypePop:t,Promise:e}=ke(),{isIterable:r,isNodeStream:n,isWebStream:o}=pt(),{pipelineImpl:i}=Wo(),{finished:s}=Et();Rl();function a(...l){return new e((u,h)=>{let d,p,w=l[l.length-1];if(w&&typeof w=="object"&&!n(w)&&!r(w)&&!o(w)){let g=t(l);d=g.signal,p=g.end}i(l,(g,m)=>{g?h(g):u(m)},{signal:d,end:p})})}return Lo={finished:s,pipeline:a},Lo}function Rl(){if(Sl)return Co;Sl=!0;let{Buffer:t}=at(),{ObjectDefineProperty:e,ObjectKeys:r,ReflectApply:n}=ke(),{promisify:{custom:o}}=je(),{streamReturningOperators:i,promiseReturningOperators:s}=Zh(),{codes:{ERR_ILLEGAL_CONSTRUCTOR:a}}=He(),l=Il(),{setDefaultHighWaterMark:u,getDefaultHighWaterMark:h}=bn(),{pipeline:d}=Wo(),{destroyer:p}=Yt(),w=Et(),g=Tl(),m=pt(),y=Co=$o().Stream;y.isDestroyed=m.isDestroyed,y.isDisturbed=m.isDisturbed,y.isErrored=m.isErrored,y.isReadable=m.isReadable,y.isWritable=m.isWritable,y.Readable=mn();for(let b of r(i)){let A=function(...x){if(new.target)throw a();return y.Readable.from(n(E,this||vl,x))},E=i[b];e(A,"name",{__proto__:null,value:E.name}),e(A,"length",{__proto__:null,value:E.length}),e(y.Readable.prototype,b,{__proto__:null,value:A,enumerable:!1,configurable:!0,writable:!0})}for(let b of r(s)){let A=function(...x){if(new.target)throw a();return n(E,this||vl,x)},E=s[b];e(A,"name",{__proto__:null,value:E.name}),e(A,"length",{__proto__:null,value:E.length}),e(y.Readable.prototype,b,{__proto__:null,value:A,enumerable:!1,configurable:!0,writable:!0})}y.Writable=zo(),y.Duplex=ht(),y.Transform=xl(),y.PassThrough=Al(),y.pipeline=d;let{addAbortSignal:S}=wn();return y.addAbortSignal=S,y.finished=w,y.destroy=p,y.compose=l,y.setDefaultHighWaterMark=u,y.getDefaultHighWaterMark=h,e(y,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return g}}),e(d,o,{__proto__:null,enumerable:!0,get(){return g.pipeline}}),e(w,o,{__proto__:null,enumerable:!0,get(){return g.finished}}),y.Stream=y,y._isUint8Array=function(E){return E instanceof Uint8Array},y._uint8ArrayToBuffer=function(E){return t.from(E.buffer,E.byteOffset,E.byteLength)},Co}function Qh(){if(El)return Be;El=!0;let t=Rl(),e=Tl(),r=t.Readable.destroy;return Be=t.Readable,Be._uint8ArrayToBuffer=t._uint8ArrayToBuffer,Be._isUint8Array=t._isUint8Array,Be.isDisturbed=t.isDisturbed,Be.isErrored=t.isErrored,Be.isReadable=t.isReadable,Be.Readable=t.Readable,Be.Writable=t.Writable,Be.Duplex=t.Duplex,Be.Transform=t.Transform,Be.PassThrough=t.PassThrough,Be.addAbortSignal=t.addAbortSignal,Be.finished=t.finished,Be.destroy=t.destroy,Be.destroy=r,Be.pipeline=t.pipeline,Be.compose=t.compose,Object.defineProperty(t,"promises",{configurable:!0,enumerable:!0,get(){return e}}),Be.Stream=t.Stream,Be.default=Be,Be}var So,Xf,xr,Zf,pn,Qf,vo,el,Eo,tl,_o,rl,yn,nl,xo,il,Ao,ol,Ar,sl,Io,al,To,fl,Ro,ll,Oo,cl,Q,Do,ul,ae,No,dl,Po,hl,Uo,pl,Mo,yl,Bo,gl,ko,wl,gn,bl,Lo,ml,Co,Sl,vl,Be,El,Re,Fo,ep,tp,rp,np,ip,op,sp,ap,Vo=yt(()=>{Ii();af();Pi();df();Jf();oo();so();So={},Xf=!1;xr={},Zf=!1;pn={},Qf=!1;vo={},el=!1;Eo={},tl=!1;_o={},rl=!1;yn={},nl=!1;xo={},il=!1;Ao={},ol=!1;Ar={},sl=!1;Io={},al=!1;To={},fl=!1;Ro={},ll=!1;Oo={},cl=!1,Q=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:global;Do={},ul=!1,ae=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:global;No={},dl=!1;Po={},hl=!1;Uo={},pl=!1;Mo={},yl=!1;Bo={},gl=!1;ko={},wl=!1;gn={},bl=!1;Lo={},ml=!1;Co={},Sl=!1,vl=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:global;Be={},El=!1;Re=Qh();Re._uint8ArrayToBuffer;Re._isUint8Array;Re.isDisturbed;Re.isErrored;Re.isReadable;Re.Readable;Re.Writable;Re.Duplex;Re.Transform;Re.PassThrough;Re.addAbortSignal;Re.finished;Re.destroy;Re.pipeline;Re.compose;Re.Stream;Fo=Re.Readable;Fo.wrap=function(t,e){return e=Object.assign({objectMode:t.readableObjectMode!=null||t.objectMode!=null||!0},e),e.destroy=function(r,n){t.destroy(r),n(r)},new Fo(e).wrap(t)};ep=Re.Writable,tp=Re.Duplex,rp=Re.Transform,np=Re.PassThrough,ip=Re.finished,op=Re.pipeline,sp=Re.Stream,ap={finished:mo(Re.finished),pipeline:mo(Re.pipeline)}});var Kt=rt(xt=>{"use strict";var Sn=0,Ce=3,fp=2,Nt=1,_t=7,Go=0,lp=3,cp=4,up=5,qt=6,Ol=7,Dl=8,Nl=9,Rr=11,dp=13,Pl=500,Ho=12,Yo=14,hp=15,pp=1,vn=typeof Symbol!="undefined"?Symbol.iterator:"__iterator_symbol__";function Ul(t){t||(t={});var e=t.converterByConstructor;e||(e=new Map),e.set(Map,{name:"Map",toValue:wp}),e.set(Set,{name:"Set",toValue:bp}),e.set(Date,{name:"Date",toValue:mp});var r=t.outlet||t.avoidShareUpdate,n=typeof global!="undefined"&&global.Buffer&&!(t&&t.encoding==="utf16le")?xt.nodeCharEncoder(t):gp(t),o=n.writeString,i=n.writeToken,s=n.startSequence,a=n.endSequence,l=n.writeBuffer,u=t.forProperty,h,d;t.shared&&(h=t.shared.propertyUsed,d=t.shared.propertyUsed);var p=[],w=8,g,m=xt.bufferSymbol||"_bufferSymbol_",y=xt.targetSymbol||"_targetSymbol_",S=0,b=pp++,E=[0,1,2,3,4,5,F,fe,z,G,N];function A(O){i(Nt,O)}function x(O){i(fp,O.length),o(O)}function z(O){var J,_=g.values;if(_){_.resetTo>-1&&_.serializer!==b&&(_.serializer=b,_.resetTo<_.length&&(_.length=_.resetTo),i(Ce,dp),i(Nt,_.resetTo));var M=_.indexOf(O);if(M>-1)return A(M)}if((J=typeof O)=="string"||J==="object"&&O){if(g.writeSharedValue){if(g.writeSharedValue(O,i,b))return}else if(_){var D=_.length;D<12&&(_[D]=O)}}J==="string"?x(O):F(O)}function G(O){var J=typeof O;if(J==="number")if(O>>>0===O||O>0&&O<70368744177664&&O%1===0)i(Nt,O);else{var _=O.toString();x(_)}else J==="object"?F(O):L(O)}function L(O){O===null?i(Ce,Go):O===!1?i(Ce,lp):O===!0?i(Ce,cp):O===void 0?i(Ce,up):ie(O)}function ie(O){var J=typeof O,_;if(J==="object")if(O){var M=O.constructor;if(M!==Object)if(M===Array)J="array";else if(_=e.get(M),_&&_.toValue){if(O=_.toValue(O),J=typeof O,O&&J==="object"&&O.constructor===Array&&(J="array"),g.type===J)return g.extendedType!==_&&(g.extendedType=_,i(Ce,Rr),x(_.name)),E[g.code](O)}else _=!1}else J="undefined";else J==="boolean"?J="undefined":J==="function"&&(O=O.toString(),J="string");g=Y(null,J,_),E[g.code](O)}function N(){i(Ce,Go)}function F(O,J){var _=typeof O;if(_==="object"){if(!O)return i(Ce,Go)}else return _==="string"?x(O):_==="number"&&(O>>>0===O||O>0&&O<70368744177664&&O%1===0)?i(Nt,O):L(O);var M=O,D=M.constructor,R;if(M[y])return pe(O);if(D===Object)R=!1;else{if(D===Array)return g=Y(g.key,"array"),E[g.code](O);if(M.then)return pe(O);if(H=e.get(D),H){if(H.toValue)return L(M)}else{if(M[vn])return g=Y(g.key,"array"),W(M,J);e.set(D,H={name:D.name})}g.constructs!==D&&(i(Ce,Rr),x(H.name),g.constructs=D),R=!0}var U=g;U.resetTo<U.length&&U.serializer!=b&&(U.length=U.resetTo,U.serializer=b),s();var X=0,le=-2,ne=0;for(var V in M)if(!(R&&!M.hasOwnProperty(V))){var O=M[V];_=typeof O,g=U[ne];var D,H=!1;if(_==="object"&&(O?(D=O.constructor,D===Object||(D===Array?_="array":(H=e.get(D),H&&H.toValue?(O=H.toValue(O),_=typeof O,O&&_==="object"&&O.constructor===Array&&(_="array")):O[vn]&&!O.then?_="array":H=!1))):_="undefined"),!g||g.key!==V||g.type!==_&&_!=="boolean"&&_!=="undefined"&&!(_==="string"&&g.type!=="number")||H&&g.extendedType!==D){var re=ne;le>-2&&(ne=le);do g=U[++ne];while(g&&(g.key!==V||g.type!==_&&_!=="boolean"&&_!=="undefined"&&!(_==="string"&&g.type!=="number")||H&&g.extendedType!==D));if(g)i(Sn,ne),le===-2&&(le=re-1);else if(U.getProperty)g=U.getProperty(O,V,_,H,Y,i,re),ne=g.index,re!==ne&&le===-2&&(le=re-1);else{if(re===U.length?ne=re:(i(Sn,ne=U.length),le===-2&&(le=re-1)),ne<U.resetTo){debugger;throw new Error("overwriting frozen property")}g=U[ne]=Y(V,_,H)}}h&&h(g,M,b,X);var ye=g.code;ye>7?ye===8?z(O):G(O):ye===6?F(O):fe(O),ne++,X++}g=U,a(X)}function Y(O,J,_){var M;return M=[],M.key=O,M.type=J,J==="string"?(i(Ce,Dl),M.values=[],M.code=Dl):J==="number"?(i(Ce,Nl),M.code=Nl):J==="object"?(i(Ce,qt),M.code=qt):J==="array"?(i(Ce,Ol),M.code=Ol):J==="boolean"||J==="undefined"?(M.type="object",i(Ce,qt),M.code=qt):(i(Ce,qt),M.code=10,console.error("Unable to write value of type "+J)),typeof O=="string"?x(O):O===null&&(J==="object"||J==="array")||F(O),_&&(M.extendedType=_,i(Ce,Rr),x(_.name)),M}function W(O,J,_){try{_||(i(_t,Ho),_=O[vn]());var M=g;g=M.child||(M.child=M);for(var D;!(D=_.next()).done;)if(E[g.code](D.value,M),J&&n.hasWritten){n.hasWritten=!1,g=M,p.unshift({then:function(R){return W(null,!0,_),R()}});return}}catch(R){throw i(Ce,Rr),i(Nt,Pl),F(Object.assign(new(typeof R=="object"&&R?R.constructor:Error),{name:R&&R.name,message:R&&R.message||R})),R}g!==M.child&&(M.child=g),g=M,i(_t,Yo)}function fe(O){if(!O)L(O);else{if(O[y])return pe(O);if(O.constructor===Array){var J=O.length,_;J>11?(i(_t,Ho),_=!0):i(_t,J);var M=g;g=M[0],M.resetTo<M.length&&M.serializer!=b&&(M.length=M.resetTo,M.serializer=b);for(var D=0,R=0;R<J;R++){var U=O[R],X=typeof U;if(X==="object")if(U){var le=U.constructor;if(le!==Object)if(le===Array)X="array";else{var ne=e.get(le);ne&&ne.toValue?(U=ne.toValue(U),X=typeof U,U&&X==="object"&&U.constructor===Array&&(X="array")):ne=!1}}else X="undefined";if(!g)M.getProperty?g=M.getProperty(U,null,X,ne,Y,i,0):(X==="string"||X==="number"||X==="array"?g=Y(null,X,ne):(g=[],g.type=X,g.key=null,g.code=qt),M[0]=g);else if(g.type!==X&&X!=="boolean"&&X!=="undefined"&&!(X==="string"&&g.type!=="number")||ne&&g.extendedType!==le){D=-1;do g=M[++D];while(g&&(g.type!==X&&X!=="boolean"&&X!=="undefined"&&!(X==="string"&&g.type!=="number")||ne&&g.extendedType!==le));g?i(Sn,D):M.getProperty?g=M.getProperty(U,null,X,ne,Y,i,-1):(i(Sn,D),g=Y(null,X,ne),M[D]=g)}h&&h(g,O,b,R);var V=g.code;V>7?V===8?z(U):G(U):V===6?F(U):fe(U)}_&&i(_t,Yo),g=M}else{if(typeof O=="object"&&O[vn])return W(O);if(X==="string")return x(U);if(X==="number"&&(U>>>0===U||U>0&&U<70368744177664&&U%1===0))return i(Nt,U);L(O)}}}var ue;function pe(O,J){i(_t,hp);var _=g,M=O[y]?{then:D}:{then:function(R){return O.then(function(U){O=U,D(R)},function(U){O=Object.assign(new(typeof U=="object"&&U?U.constructor:Error),{name:U&&U.name,message:U&&U.message||U}),_.upgrade||(i(Ce,Rr),i(Nt,Pl)),D(R)})}};function D(R){if(t.forBlock&&O)t.forBlock(O,_);else{var U=O&&O[m]&&O[m](_);if(U)l(U);else{g=_;var X=p;p=[],F(O,!0),X.unshift.apply(X,p),p=X}}R()}p.push(M)}var ge={serialize:function(O,J){var _=O&&O[m]&&O[m](J);if(_){n.writeBuffer(_);return}J?(g=J,E[g.code](O)):(g=[],g.key=null,F(O,!0))},getSerialized:function(){if(p.length>0){for(var O=[];p.length>0;){var J=!1,_=p.shift().then(function(){J=!0});J||O.push(_)}if(O.length>0)return Promise.all(O).then(function(){return ge.getSerialized()})}return t&&t.encoding==="utf16le"?Buffer.from(n.getSerialized(),"utf16le"):n.getSerialized()},flush:n.flush,setOffset:n.setOffset,finish:n.finish,pendingEncodings:p,getWriters:function(){return{writeProperty:Y,writeToken:i,writeAsDefault:F,writeBuffer:l}}};return ge}function yp(t,e){var r=Ul(e),n=e&&e.shared,o;n&&n.startWrite&&n.startWrite(e.avoidShareUpdate,t),r.serialize(t,n),o=r.getSerialized(),n&&n.endWrite&&n.endWrite(e.avoidShareUpdate,t),r.finish&&r.finish();var i=t&&t[xt.sizeTableSymbol];return i&&(o.sizeTable=i),e&&e.lazy?Buffer.concat([t[xt.sizeTableSymbol],o]):o}xt.serialize=yp;xt.createSerializer=Ul;function gp(){var t="";function e(o,i){var s;if(i<16)s=String.fromCharCode((o<<4|i)^64);else if(i<1024)s=String.fromCharCode((o<<4)+(i>>>6),(i&63)+64);else if(i<65536)s=String.fromCharCode((o<<4)+(i>>>12),i>>>6&63,(i&63)+64);else if(i<4194304)s=String.fromCharCode((o<<4)+(i>>>18),i>>>12&63,i>>>6&63,(i&63)+64);else if(i<268435456)s=String.fromCharCode((o<<4)+(i>>>24),i>>>18&63,i>>>12&63,i>>>6&63,(i&63)+64);else if(i<4294967296)s=String.fromCharCode((o<<4)+(i>>>30),i>>>24&63,i>>>18&63,i>>>12&63,i>>>6&63,(i&63)+64);else if(i<17179869184)s=String.fromCharCode((o<<4)+(i/1073741824>>>0),i>>>24&63,i>>>18&63,i>>>12&63,i>>>6&63,(i&63)+64);else if(i<1099511627776)s=String.fromCharCode((o<<4)+(i/68719476736>>>0),i/1073741824&63,i>>>24&63,i>>>18&63,i>>>12&63,i>>>6&63,(i&63)+64);else if(i<70368744177664)s=String.fromCharCode((o<<4)+(i/4398046511104>>>0),i/68719476736&63,i/1073741824&63,i>>>24&63,i>>>18&63,i>>>12&63,i>>>6&63,(i&63)+64);else throw new Error("Too big of number");t+=s}function r(o){t+=o}function n(){return t}return{writeToken:e,writeString:r,getSerialized:n,startSequence:function(){e(_t,Ho)},endSequence:function(){e(_t,Yo)},getOffset:function(){return-1}}}var Ml=Array.from||function(t,n){var r=[],n=t.constructor===Map;return t.forEach(function(o,i){n?r.push([i,o]):r.push(o)}),r};function wp(t){for(var e=Ml(t),r=0,n=e.length;r<n;r++){var o=e[r];e[r]={key:o[0],value:o[1]}}return e}function bp(t){return Ml(t)}function mp(t){return t.getTime()}});var Ll=rt(kl=>{"use strict";var{Transform:Sp}=(Vo(),Os(jo)),{createSerializer:Bl}=Kt(),qo=class extends Sp{constructor(e){e=e||{},super(e),this.options=e,this.continueWriting=!0}write(e){let r=this.serializer||(this.serializer=Bl({asBlock:!0}));r.serialize(e);let n=r.getSerialized();n.then?(n.then(o=>this.push(o)),this.serializer=null):r.flush(this)}end(e){e&&(this.options.outlet=this,(this.serializer||(this.serializer=Bl(this.options))).serialize(e)),this.serializer.pendingEncodings.length>0?(this.endWhenDone=!0,this.writeNext()):(this.serializer.flush(),this.push(null))}writeBytes(e){try{this.continueWriting=this.push(e)}catch(r){throw r}}_read(){this.continueWriting=!0,!this.pausedForPromise&&this.serializer&&this.endWhenDone&&this.serializer.pendingEncodings.length>0&&this.writeNext()}writeNext(){var e;do{var r=this.serializer.pendingEncodings.length>0;if(e=null,r){if(this.serializer.pendingEncodings.shift().then(()=>{e===!1?(this.pausedForPromise=!1,this.continueWriting||this.serializer.pendingEncodings.length===0?this.writeNext():this.serializer.flush()):e=!0},n=>{console.error(n),this.push(n.toString()),this.push(null)}),!e)e=!1,this.pausedForPromise=!0,this.serializer.flush();else if(!this.continueWriting&&this.serializer.pendingEncodings.length>0){this.serializer.flush();return}}else this.endWhenDone&&(this.serializer.flush(),this.push("]"),this.push(null))}while(e)}};kl.createSerializeStream=()=>new qo});var Or=rt(Ko=>{"use strict";var vp=3,Ep=4,Cl=6,Fl=7,$l=8,zl=9,Wl=11,_p=13,xp=14,Ap=500,Ip=12,Tp=14,Rp=15,im=1024*1024*16;function jl(t){t||(t={});var e,r,n,o=t.classByName||new Map;o.set("Map",Op),o.set("Set",Dp),o.set("Date",Np);var i,s;function a(m,y){if(m.previous=i,m.resume=!0,i=m,!n)throw new Error("Unexpected end of dpack stream");return g.onResume||(g.onResume=function(S,b,E){var A=i;return i=null,g.onResume=null,y<r.length?r=r.slice(y)+S:E?r=S.slice(0,1)+S.slice(1):r=S,n=b,p+=y,e=0,A.reader?A.reader(A):l(A.length,A)}),m.object}function l(m,y){var S=0;y=y||[];var b,E,A,x,z=0,G=0;if(y.resume){if(b=y.previous,b){var x=b.reader?b.reader(b):l(b.length,b),L=b.values;L&&(i?i.values=L:x.nextPosition>-1?L[L.nextPosition++]=x:L.push(x))}y.code&&y.code!==y.thisProperty.code?y.resume=!1:(z=y.i||0,A=y.object,S=y.propertyState||0,G=y.propertyIndex||0,y=y.thisProperty)}for(E=y.code===Fl,A=A||(y.constructs?new y.constructs:E?[]:{});z<m;){var ie,N,F=e,Y=r.charCodeAt(e++);if(Y>=48)Y>12288?(ie=Y>>>12^4,N=Y&4095):(ie=Y>>>4^4,N=Y&15);else if(ie=Y>>>4&11,N=Y&15,Y=r.charCodeAt(e++),N=(N<<6)+(Y&63),!(Y>=64)&&(Y=r.charCodeAt(e++),N=(N<<6)+(Y&63),!(Y>=64)&&(Y=r.charCodeAt(e++),N=(N<<6)+(Y&63),!(Y>=64)&&(Y=r.charCodeAt(e++),N=(N<<6)+(Y&63),!(Y>=64)&&(Y=r.charCodeAt(e++),N=N*64+(Y&63),!(Y>=64)&&(Y=r.charCodeAt(e++),N=N*64+(Y&63),!(Y>=64)&&(Y=r.charCodeAt(e++),N=N*64+(Y&63),!(Y>=0)&&e>r.length)))))))return a({length:m,thisProperty:y,i:z,object:A,propertyIndex:G,propertyState:S},F);if(ie===0){G=N,S=0;continue}if(b=y[G],ie===3)if(N<6)N<3?N===0?x=null:x="Unknown token, type: "+ie+" number: "+N:N===Ep?x=!0:N===vp?x=!1:x=void 0;else{if(N<=zl){if(S===1&&(G++,z++,b=y[G]),G<y.resetTo)throw new Error("Overwriting frozen property");b?b.resume||(x=b.key,b=y[G]=[],b.key=x):(b=y[G]=[],b.key=null),b.code=N,b.parent=y,S=2,N===$l?b.values=[]:N===Fl&&(b[0]=[],b[0].key=null,b[0].code=Cl,b[0].parent=b)}else S=N;continue}else if(ie===2){if(x=r.slice(e,e+=N),e>r.length)return a({length:m,thisProperty:y,i:z,object:A,propertyIndex:G,propertyState:S},F);S<2&&b.code===zl&&(x=+x)}else if(ie===1)x=N;else if(N>13){if(N===Tp)return A;N===Rp&&(x=l(0,b),S=0,t.forDeferred?x=t.forDeferred(x,b):(s||(s=[])).push({property:b,value:x}))}else if(N>=Ip&&(N=2e9),S>1?S===2?(S=0,x=l(N,b)):S===Wl?x=l(N,[{key:null,code:6}]):b.resume&&(b.code||Cl)===b.thisProperty.code?x=l(N,b.thisProperty):x=l(N,b):x=l(N,b),i){if(x===void 0)return i=null,g.onResume=null,a({length:m,thisProperty:y,i:z,object:A,property:b,propertyIndex:G,previousProperty,propertyState:S},F);i.values=b.values instanceof Array?b.values:void 0}if(!b)throw new Error("No property defined for slot"+(y.key?" in "+y.key:""));if(S<2&&b&&b.code===$l){var L=b.values;if(typeof x=="number"){if(x=L[N],x===void 0&&!(N in L))throw new Error("Referencing value that has not been read yet")}else(ie===2||ie===7)&&L&&(L.nextPosition>-1?(b.recordValueReference&&b.recordValueReference(L),L[L.nextPosition++]=x):L.push(x))}if(S>1){if(S===2)b.key=x;else if(S===Wl)if(typeof x=="string"){var W=o.get(x);if(W)W.fromValue?b.fromValue=W.fromValue:b.constructs=W;else if(t.errorOnUnknownClass)throw new Error("Attempt to deserialize to unknown class "+parameter);b.extendedType=W}else b.metadata=x,x===Ap&&(b.fromValue=d);else if(S===_p){var L=b.values||(b.values=[]);L.nextPosition=x}else if(S!==xp)throw new Error("Unknown property type "+S);S=1;continue}else S=0;b.fromValue&&(x=b.fromValue(x)),E&&b.key===null?A.push(x):x!==void 0&&(A[b.key]=x),z++,E||G++}return A}function u(m){throw new Error("Unknown type "+m)}var h;function d(m){var y=typeof global!="undefined"?global:window;if(m&&m.name&&y[m.name]?m=new y[m.name](m.message):typeof m=="string"&&(m=new Error(m)),t.onError)t.onError(m);else throw h=!0,m}var p=0;function w(m){try{if(m&&m.resume){var y=m.previous;S=l(y.length,y),S=m.object||S,m=m.property}else{m=m||[t&&t.shared||{key:null,code:6}];var S=l(1,m)[m[0].key]}for(;;){if(i)return a({reader:w,object:S,property:m});if(!s)return S;var b=s.index||0,E=s[b];if(s.index=b+1,!E){s=s.parent;continue}var A=E.value,x=s;s=[],s.parent=x;var z=E.property,G=l(1,m=[{resume:!0,key:null,thisProperty:z,object:A}]);G=G.null||G[z.key],G!=A&&(Object.assign(A,G),i&&i.object===G&&(i.object=A),G&&G.constructor===Array&&(A.length=G.length,Object.setPrototypeOf(A,Object.getPrototypeOf(G))))}}catch(L){throw h||(L.message="DPack parsing error: "+L.message+" at position: "+(e+p)+" near: "+r.slice(e-10,e+10)),L}}var g={setSource:function(m,y,S){return r=m,e=y||0,p=0,n=S,this},hasMoreData:function(){return r.length>e},isPaused:function(){return i},hasUnfulfilledReferences:function(){return s&&s.length>s.index},getOffset:function(){return e+p},read:w};return g}Ko.parse=function(t,e){var r;if(typeof t=="string")r=t;else if(t&&t.toString)r=t.toString(e&&e.encoding||"utf8");else return t;var n=jl(e).setSource(r);return e&&e.shared?n.read([e.shared]):n.read()};Ko.createParser=jl;var Op={fromValue:function(t){for(var e=new Map,r=0,n=t.length;r<n;r++){var o=t[r];e.set(o.key,o.value)}return e}},Dp={fromValue:function(t){var e=new Set(t);if(e.size===0&&t.length>0)for(var r=0,n=t.length;r<n;r++)e.add(t[r]);return e}},Np={fromValue:function(t){return new Date(t)}}});var Gl=rt(Vl=>{"use strict";var Pp=(Vo(),Os(jo)).Transform,Up=Or().createParser,Mp={objectMode:!0},Jo=class extends Pp{constructor(e){e?e.objectMode=!0:e=Mp,super(e),this.parser=Up(e),this.waitingValues=[]}_transform(e,r,n){var o;try{var i=e.toString(),s=this.parser;for(s.onResume?(o=s.onResume(i,!0),s.isPaused()||this.sendValue(o)):s.setSource(i,0,!0);s.hasMoreData()&&(o=s.read(),!s.isPaused());)this.sendValue(o)}catch(a){console.error(a)}n&&n()}sendValue(e){if(this.parser.hasUnfulfilledReferences())e!==void 0&&this.waitingValues.push(e);else{for(;this.waitingValues.length>0;)this.push(this.waitingValues.shift());e!==void 0&&this.push(e)}}};Vl.createParseStream=()=>new Jo});var Kl=rt(ql=>{var Hl=32768,Yl=[];function Bp(t){var e=t.startOffset||0,r,n=t.outlet,o=Yl.pop();o&&o.length>e+128?r=o.length:(r=(e>>12<<12)+8192,o=Buffer.allocUnsafeSlow(r));var i=t.encoding,s=[];function a(m){if(n)n.writeBytes(o.slice(0,e)),(r<Hl||m>Hl)&&(r=Math.max(r*4,m)),o=Buffer.allocUnsafeSlow(r),e=0,s=[],g.hasWritten=!0;else{r=Math.max(r*4,r+m,8192);var y=o;o=Buffer.allocUnsafeSlow(r),y.copy(o,0,0,e)}}function l(m){(m||n).writeBytes(o.slice(0,e)),e+128>o.length?o=Buffer.allocUnsafeSlow(r=Math.min(Math.max((e>>10<<10)+8192,r),32768)):(o=o.slice(e),r=o.length),e=0,s=[]}function u(m,y){if(y<16)o[e++]=(m<<4)+y^64;else if(y<1024)o[e++]=(m<<4)+(y>>>6),o[e++]=(y&63)+64;else if(y<65536)o[e++]=(m<<4)+(y>>>12),o[e++]=y>>>6&63,o[e++]=(y&63)+64;else if(y<4194304)o[e++]=(m<<4)+(y>>>18),o[e++]=y>>>12&63,o[e++]=y>>>6&63,o[e++]=(y&63)+64;else if(y<268435456)o[e++]=(m<<4)+(y>>>24),o[e++]=y>>>18&63,o[e++]=y>>>12&63,o[e++]=y>>>6&63,o[e++]=(y&63)+64;else if(y<4294967296)o[e++]=(m<<4)+(y>>>30),o[e++]=y>>>24&63,o[e++]=y>>>18&63,o[e++]=y>>>12&63,o[e++]=y>>>6&63,o[e++]=(y&63)+64;else if(y<17179869184)o[e++]=(m<<4)+(y/1073741824>>>0),o[e++]=y>>>24&63,o[e++]=y>>>18&63,o[e++]=y>>>12&63,o[e++]=y>>>6&63,o[e++]=(y&63)+64;else if(y<1099511627776)o[e++]=(m<<4)+(y/68719476736>>>0),o[e++]=y/1073741824&63,o[e++]=y>>>24&63,o[e++]=y>>>18&63,o[e++]=y>>>12&63,o[e++]=y>>>6&63,o[e++]=(y&63)+64;else if(y<70368744177664)o[e++]=(m<<4)+(y/4398046511104>>>0),o[e++]=y/68719476736&63,o[e++]=y/1073741824&63,o[e++]=y>>>24&63,o[e++]=y>>>18&63,o[e++]=y>>>12&63,o[e++]=y>>>6&63,o[e++]=(y&63)+64;else throw new Error("Invalid number "+y);e>r-10&&a(0)}function h(m){var y=m.length;y+e+10>r&&a(y+10),m.copy(o,e),e+=y}function d(m){var y=m.length,S=y*3+10;e+S>r&&a(S+10);var b=i?o.write(m,e,o.length,i):o.utf8Write(m,e,o.length);e+=b}function p(){return o.slice(0,e)}function w(m,y){var S=m.length;e+S+10>r&&a(S+10),o.copy(o,S+y,y,e),m.copy(o,y),e+=S}var g={writeToken:u,writeString:d,writeBuffer:h,getSerialized:p,insertBuffer:w,flush:l,startSequence(){var m=e;o[e++]=60,s.push(m),e>r-10&&a(0)},endSequence(m){var y=s.pop();if(m<12&&y>-1){o[y]=48+m;return}o[e++]=62},finish(){o.length-e>144&&Yl.push(o.slice(e))},getOffset(){return e},setOffset(m){e=m}};return g}ql.nodeCharEncoder=Bp});var Xo=rt(Xl=>{"use strict";function Jl(){var t=this.classByName=new Map;this.converterByConstructor=new Map}Jl.prototype.addExtension=function(t,e,r){e&&t.name!==e&&(t.name=e),this.classByName.set(t.name,r&&r.fromArray?r:t),this.converterByConstructor.set(t,r&&r.toArray?r:t)};Xl.Options=Jl});var xn=rt(rs=>{var kp=Kt().createSerializer,lm=Kt().serialize,Ql=Or().createParser,cm=Xo().Options,_n=0,Lp=3,Zo=7,Jt=6,Pt=7,ec=8,Cp=9,Fp=14,$p=11,zp=12,Wp=14;rs.createSharedStructure=Gp;rs.readSharedStructure=jp;function jp(t){var e=Ql(),r=[];return r.code=6,r.key=null,e.setSource(t+"p").read([r]),tc(r),r.serialized=t,r}function tc(t){t.resetTo=t.length,t.upgrade=rc,t.type=es[t.code],t.isFrozen=!0,Object.defineProperty(t,"serialized",{get(){return this._serialized||(this._serialized=Qo(this))}}),typeof t.values=="object"&&t.values&&(t.values.resetTo=t.values.length,t.lastIndex=t.values.length);for(var e=0,r=t.length;e<r;e++)t[e].index=e,t[e].resumeIndex=e,tc(t[e])}function rc(t){if(!t)return 1;var e;if(t){if(t.insertedFrom===this&&t.insertedVersion===this.version&&(t.recordUpdate||t.isFrozen||t.length==0&&t.code==this.code&&t.values==null))return 0;var r;if(this.code!==t.code&&(r=!0),t.upgrade){var e=ts(this,t);if(r&&(e=2),t.isFrozen&&e>0)return 2;if(t.insertedFrom=this,t.insertedVersion=this.version,e===2){debugger;return console.error("Inserting incompatible block into property"),2}else return 0}else return t.insertedFrom=this,t.insertedVersion=this.version,t.length=0,t.values=null,t.fromValue&&(t.fromValue=null),1}else this.length>0&&(blockBuffer=Buffer.concat([this.serialized,blockBuffer]));return 1}var Vp={string:ec,number:Cp,object:Jt,boolean:Jt,undefined:Jt,array:Pt},Zl=new WeakMap;function Gp(t,e){var r=[];r.key=null,r.code=6,r.type="object";let n=[],o=[];n.iteration=0;var i;class s extends Array{constructor(d){super();let p;this.key=typeof d.key=="string"?Hp(d.key):d.key,this.type=d.type,this.code=d.code,this.count=0,this.comesAfter=[],this.code==ec&&(this.values=[],this.values.resetTo=512,this.values.nextPosition=512,this.previousValues=new Map,this.lastIndex=0,this.repetitions=0)}newProperty(d){return new s(d)}getProperty(d,p,w,g,m,y,S){let b;if(this.insertedFrom){if(A(this.insertedFrom),b)return S!==b.index&&y(_n,E),b;if(this.insertedFrom.getProperty)return this.insertedFrom.getProperty(d,p,w,g,m,y,S);debugger}this.recordUpdate();let E=this.length;return S!==E&&y(_n,E),(w==="boolean"||w==="undefined")&&(w="object"),b=this[E]=new s({key:p,type:w,code:Vp[w]}),b.parent=this,b.index=E,b;function A(x){let z=-1;do b=x[++z];while(b&&(b.key!==p||b.type!==w&&w!=="boolean"&&w!=="undefined"||g&&b.extendedType!==constructor))}}writeSharedValue(d,p,w){let g=this.previousValues.get(d);return g?g.serializer==w?this.repetitions++:(g.serializations++,g.serializer=w):this.previousValues.set(d,g={serializations:1,serializer:w}),this.active||(this.active=2,n.push(this)),!1}propertyUsed(d,p,w,g){if(d.lastSerializer!==w&&(d.lastSerializer=w,d.count++),g!==0){let m=Zl.get(p);m&&d.comesAfter.indexOf(m)===-1&&d.comesAfter.push(m)}Zl.set(p,d)}recordUpdate(){var d=this;do d.version=(d.version||0)+1,d.insertedFrom&&(d.insertedFrom=null),d._serialized&&(d._serialized=null);while(d=d.parent)}readingBlock(d){try{return d()}finally{if(this.readReset(),this.length>500)debugger}}startWrite(d,p){if(n.iteration++,p&&p.constructor===Array){if(this.code!==Pt&&this.version>0)throw new Error("Can not change the root type of a shared object to an array");this.code!=Pt&&this.recordUpdate(),this.code=Pt,this.type="array"}this.writing||(this.writing=!0)}endWrite(){if(this.writing)this.writing=!1;else return;let d=this.iterations=(this.iterations||0)+1;for(let p=0;p<n.length;p++){let w=n[p],g=w.previousValues;if(g&&g.size&&!w.isFrozen){if(!En){w.values.length==0&&d>((w.repetitions||0)+10)*5&&(console.log("changing referenceable to default",w.key),w.previousValues=null,w.code=Jt,w.type="object",w.recordUpdate(),n.splice(p--,1),g=[]);for(let[m,y]of g){let S=w.values;((y.serializations+3)*8<d-(y.startingIteration||(y.startingIteration=d))||S.length>500)&&g.delete(m),y.serializations>50&&y.serializations*3>d&&(S[w.lastIndex++]=m,w.recordUpdate(),console.log("adding value",m,"to",w.key),g.delete(m))}}}else w.active=0,n.splice(p--,1)}n.hasUpdates&&(n.hasUpdates=!1,this.version++,this._serialized||(this._serialized=null),e&&e.onUpdate&&e.onUpdate()),En=i}upgrade(d){return rc.call(this,d)}get serialized(){return this._serialized||(this._serialized=Qo(this))}serializeCommonStructure(d){var p=Math.sqrt(n.iteration);return Qo(this,w=>w.count>=p,d)}}var a=new s(r);if(a.version=0,a.freeze=function(){this.isFrozen=!0,this.reset()},t){var l=Ql({forDeferred(h,d){return d.isBlock=!0,h},parseDeferreds:!0}),u=[];u.code=6,u.key=null,l.setSource(t+"p").read([u]),ts(u,a),n.hasUpdates=!1,a.version=1}return a.key=null,a}var es={6:"object",7:"array",8:"string",9:"number"},En;function Qo(t,e,r){var n=kp(),o=n.getWriters();i(t,!r,!r);function i(a,l,u){if(a.insertedFrom&&a.insertedFrom.serializeCommonStructure)return a=a.insertedFrom,o.writeBuffer(a.serializeCommonStructure(!u));var h=a.code===Pt,d=e?Yp(a.filter(e)):a,p=d.length;if(!(l&&a.code===Jt)){let b=u?null:a.key;o.writeProperty(b,es[a.code]),p===0&&b===null&&(a.code===Jt||a.code===Pt)&&o.writeToken(Zo,0)}if(u&&p>0&&o.writeToken(Lp,Fp),p>0){o.writeToken(Zo,zp);for(var w=0;w<p;w++){var g=d[w];g.index=w,h&&w>0&&o.writeToken(_n,w),i(g,d.code===Pt&&w===0,!1,e)}o.writeToken(Zo,Wp)}var m=!0;if(a.lastIndex>0)for(var w=0,y=a.lastIndex;w<y;w++){var S=a.values[w];m?m=!1:o.writeToken(_n,a.index),o.writeAsDefault(S)}}return n.getSerialized()}function ts(t,e,r,n){var o=0;e.code=t.code,e.type=t.type||es[t.code],r&&(e.isFrozen=!0,e.previousValues&&(e.previousValues=null));let i=t.resetTo>-1?t.resetTo:t.length;e.resetTo>-1&&e.resetTo<e.length&&(e.length=e.resetTo);for(var s=n||0;s<i;s++){var a=e[s],l=t[s];if(a&&(a.key!=l.key||a.extendedType!=l.extendedType||a.code!=l.code&&!(a.code==8&&l.code===6&&(!a.values||!a.values.length)))){if(e.isFrozen)return 2;o=2}if(!a){if(e.isFrozen)return 2;var a=[];a.code=l.code,e.newProperty&&(a=e.newProperty(a)),e[s]=a,l.metadata&&(a.metadata=l.metadata),l.insertedFrom&&(a.insertedFrom=l.insertedFrom,a.insertedVersion=l.insertedVersion),a.parent=e}a.key=l.key,l.values&&l.values.length>0&&(l.values.resetTo>-1&&(l.values.length=l.values.resetTo),(!a.values||l.values.length>(a.values.resetTo>-1?a.values.resetTo:a.values.length))&&(a.values=l.values.slice(0),a.values.nextPosition=l.values.length,a.values.length>=12&&(a.previousValues=null),o==0&&(o=1)));var u=ts(l,a,r);u>o&&(o=u)}if((e.resetTo>-1?e.resetTo:e.length)>i){if(e.recordUpdate)t.metadata=$p,t.recordUpdate();else if(e.isFrozen)return 2}return o}function Hp(t){return t.slice(0,1)+t.slice(1)}function Yp(t){var e=[],r=new Set;function n(o){if(!r.has(o)){r.add(o);for(var i of o.comesAfter)n(i);e.push(o)}}for(let o of t)n(o);return e}});var lc=rt(qe=>{"use strict";var Xt=typeof Symbol!="undefined"?Symbol:function(t){return"symbol-"+t},qp=1,as=Xt("buffer"),Dr=Xt("sizeTable"),dm=Xt("header"),Zt=Xt("parsed"),fs=Xt("shared"),ft=Xt("target"),ns=!1,ic=6,oc=7;function Kp(){}var Nr=Kt();qe.Block=Kp;qe.bufferSymbol=Nr.bufferSymbol=as;qe.parsedSymbol=Zt;qe.sharedSymbol=fs;qe.targetSymbol=Nr.targetSymbol=ft;qe.sizeTableSymbol=Nr.sizeTableSymbol=Dr;var Jp=Nr.serialize,Xp=Nr.createSerializer;qe.asBlock=Zp;function Zp(t,e){if(t&&t[ft])return t;if(Array.isArray(t)){let r=[];return r.parsed=t,r.shared=e,new Proxy(r,An)}return new Proxy({parsed:t,shared:e},An)}qe.isBlock=ls;function ls(t){return t&&t[ft]}qe.makeBlockFromBuffer=sc;function sc(t,e){var r,n;if(t[0]<128)r=t;else{var o=t[0]>>6,i;o===2?i=t.readUInt16BE(0)&16383:i=t.readUInt32BE(0)&1073741823,r=t.slice(i),n=t.slice(0,i)}var s={dpackBuffer:r,sizeTableBuffer:n,shared:e,reassign:function(a){this.buffer=a}};return t.owner=s,new Proxy(s,An)}qe.getLazyHeader=function(t){return t[Dr]};var An={get:function(t,e){if(Fe.hasOwnProperty(e))return Fe[e].call(t);var r=t.parsed;return r||(r=Ye(t)),r[e]},set:function(t,e,r){if(typeof e=="symbol")return t[e]=r,ty(e),!0;throw new Error("No changes are allowed on frozen parsed object, Use dpack copy() function to modify")},deleteProperty:function(){throw new Error("No changes are allowed on frozen parsed object, Use dpack copy() function to modify")},getOwnPropertyDescriptor:function(t,e){var r=Ye(t);return Object.getOwnPropertyDescriptor(r,e)},has:function(t,e){var r=Ye(t);return e in r},ownKeys:function(t){var e=Ye(t),r=Object.keys(e);return Array.isArray(e)&&r.push("length"),r},getPrototypeOf:function(t){var e=Ye(t);return Object.getPrototypeOf(e)}};qe.reassignBuffers=ac;function ac(t,e,r){var n=t[ft],i=n.dpackBuffer;if(r||(r=i.buffer),i&&i.buffer===r){var o=i.byteOffset;n.dpackBuffer=e.slice(o,o+i.length)}var i=n.sizeTableBuffer;if(i&&i.buffer===r){var o=i.byteOffset;n.sizeTableBuffer=e.slice(o,o+i.length)}if(n.parsed){var s=n.parsed;for(var a in s){var l=s[a];ls(l)&&ac(l,e,r)}}}var In={get:function(t,e){if(Fe.hasOwnProperty(e))return Fe[e].call(t);var r=t.cachedParsed;if(r&&r.hasOwnProperty(e)&&!(e=="length"&&Array.isArray(r)))return r[e];var n=t.parsed;n||(n=Ye(t));var o=n[e];return o&&o[ft]&&(r||(t.cachedParsed=r=n instanceof Array?[]:{}),r[e]=o=is(o,t)),o},changed:function(t){t.dpackBuffer=null,t.sizeTableBuffer=null,t.shared=null;var e=t.parsed;if(e||(e=Ye(t)),!t.copied){var r=t.cachedParsed,n=t.parsed=t.cachedParsed=e instanceof Array?[]:{};for(var o in e){var i=r&&r[o];i||(i=e[o],i&&i[ft]&&(i=is(i,t))),n[o]=i}e=n,t.copied=!0}return t.version=qp++,e},checkVersion:function(t){var e=t.cachedParsed;let r=t.version||0;if(e)for(let o in e){var n=e[o];n&&n[ft]&&(r=Math.max(r,this.checkVersion(n[ft])))}return r!=(t.version||0)&&(this.changed(t),t.version=r),r},set:function(t,e,r,n){if(nc.hasOwnProperty(e))return nc[e].call(t,r),!0;var o=In.changed(t);return o[e]=r,!0},deleteProperty:function(t,e){var r=In.changed(t);return delete r[e]},getOwnPropertyDescriptor:function(t,e){var r=Ye(t);return Object.getOwnPropertyDescriptor(r,e)},has:function(t,e){var r=Ye(t);return e in r},ownKeys:function(t){var e=Ye(t),r=Object.keys(e);if(Array.isArray(e)&&r.push("length"),t.copied)for(var n in t.copied)r.indexOf(n)===-1&&r.push(n);return r},getPrototypeOf:function(t){var e=Ye(t);return Object.getPrototypeOf(e)}},Fe={};Fe[as]=function(){return function(t,e){var r=t&&t.upgrade,n;if(this.cachedParsed&&this.dpackBuffer&&In.checkVersion(this),!(this.shared&&this.shared.upgrade)&&r)return this.dpackBuffer?(this.sizeTableBuffer=null,s(this.dpackBuffer,!0)):os(this,this.shared=t);if(this.dpackBuffer||os(this,this.shared),this.shared&&this.shared.upgrade&&this.shared!==t){var o=this.shared.upgrade(t,e);if(o>0){this.sizeTableBuffer=null;var i=this.shared.serialized;if(i.length>0)return o==2&&!(t.isFrozen&&t.resetTo===0)&&(i=s(i)),n=Buffer.concat([i,this.dpackBuffer]),n.mustSequence=!0,n}}else t&&(r||(t.length=0),t.insertedFrom&&(t.insertedFrom=null));return this.dpackBuffer;function s(a){var l=Xp(),u=a[0]===119,h=l.getWriters().writeToken;return u&&(a=a.slice(1)),h(0,1e3),h(3,u?oc:ic),t&&t.key!==null&&l.serialize(t.key),a=Buffer.concat([l.getSerialized(),a]),a.mustSequence=!0,a}}.bind(this)};Fe[ft]=function(){return this};Fe[fs]=function(){return this.shared};Fe[Zt]=function(){return this.parsed||Ye(this)};Fe[Dr]=function(){return this.dpackBuffer||os(this),this.sizeTableBuffer};Fe.then=function(){};Fe.toJSON=function(){return fc};Fe.valueOf=function(){return fc};Fe.entries=function(){return Qp};function Qp(){return this[Zt].entries()}Fe[Symbol.iterator]=function(){var t=this.parsed||Ye(this);return t&&t[Symbol.iterator]&&ey};function ey(){var t=this[Zt];return t&&t[Symbol.iterator]?t[Symbol.iterator]():[][Symbol.iterator]()}Fe.constructor=function(){if(this.parsed)return this.parsed.constructor;if(this.dpackBuffer){let t=this.dpackBuffer[0];if(t>=48&&t<=60)if(this.shared){if(this.shared.code==ic)return Object;if(this.shared.code==oc)return Array}else return Object;else if(t===119)return Array}return Ye(this).constructor};function ty(t){Fe[t]||(Fe[t]=function(){return this[t]})}function fc(){return this[Zt]}function ry(t){return is(t)}function is(t,e){if(!ls(t))return t;let r=Array.isArray(t),n=r?[]:{};return Object.defineProperties(n,{parsed:{get(){return t[Zt]},set(o){Object.defineProperty(this,"parsed",{value:o,writable:!0,enumerable:!0})},configurable:!0},shared:{get(){return t[fs]},set(o){Object.defineProperty(this,"shared",{value:o,writable:!0,enumerable:!0}),this.dpackBuffer=null,this.sizeTableBuffer=null},configurable:!0},dpackBuffer:{get(){return t[ft].dpackBuffer},set(o){Object.defineProperty(this,"dpackBuffer",{value:o,writable:!0,enumerable:!0})},configurable:!0},sizeTableBuffer:{get(){return t[Dr]},set(o){Object.defineProperty(this,"sizeTableBuffer",{value:o,writable:!0,enumerable:!0})},configurable:!0}}),r&&Object.define,new Proxy(n,In)}qe.copy=ry;var nc={};function Ye(t){var e=t.parsed;if(e)return e;var r=t.sizeTableBuffer,n=t.dpackBuffer;if(!r)return t.parsed=ss(n,{freezeObjects:ns,shared:t.shared});var o=r.length,i,s,a=r[0]>>6,l;a===2?(s=r.readUInt16BE(4),l=6):(s=r.readUIntBE(10,6),l=16);for(var u=[],h=[],d=s;l<o;){var a=r[l]>>6,p,w;a<2?a==0?(p=1,w=r[l]):(p=2,w=r.readUInt16BE(l)&16383):a===2?(p=r.readUInt16BE(l)&16383,w=r.readUInt16BE(l+2)):(p=r.readUInt32BE(l)&1073741823,w=r.readUIntBE(l+4,6)),u.push(a<2||a==3&&p==16?void 0:r.slice(l,l+p)),l+=p,h.push(n.slice(d,d+=w))}var g=0,m=t.dpackBuffer.slice(0,s);return t.parsed=ss(m,h.length>0?{shared:t.shared,forDeferred:function(y,S){let b=new y.constructor;return b.dpackBuffer=h[g],b.sizeTableBuffer=u[g++],b.shared=S?S.upgrade?S:{code:S.code,key:null,type:S.type}:null,new Proxy(b,An)},freezeObjects:ns}:{shared:t.shared})}function os(t,e){var r=[],n=[],o=0,i,s={forBlock:function(h,d){var p=h[as](d,!0);if(p.mustSequence)return i=!0,r.push(p),p;var w=h[Dr];if(!w){var g=p.length;g<64?w=Buffer.from([g]):g<16384?w=Buffer.from([g>>8|64,g&255]):(w=Buffer.allocUnsafe(16),w.writeUInt32BE(3221225488),w.writeUIntBE(g,4,6),w.writeUIntBE(g,10,6))}return n.push(w),o+=p.length,r.push(p),p},shared:e,freezeObjects:ns},a=Jp(t.parsed,s);if(r.length==0)return t.dpackBuffer=a;r.unshift(a);var l=t.dpackBuffer=Buffer.concat(r);if(i)return l;var u=Buffer.allocUnsafe(l.length>=65536?16:6);return n.unshift(u),u=t.sizeTableBuffer=Buffer.concat(n),l.length>=65536?(u.writeUInt32BE(u.length+3221225472,0),u.writeUIntBE(l.length,4,6),u.writeUIntBE(a.length,10,6)):(u.writeUInt16BE(u.length|32768,0),u.writeUInt16BE(l.length,2),u.writeUInt16BE(a.length,4)),l}var ss=Or().parse,hm=xn().serializeSharedBlock;qe.parseLazy=function(t,e){return t[0]&128||t[0]>>4===3||t[0]===119?sc(t,e&&e.shared):ss(t,e)}});var uc=rt(Ve=>{Ve.createSerializeStream=Ll().createSerializeStream;Ve.createParseStream=Gl().createParseStream;var cs=Kt();cs.nodeCharEncoder=Kl().nodeCharEncoder;var cc=Or(),ny=Xo().Options;Ve.serialize=cs.serialize;Ve.parse=cc.parse;Ve.createSerializer=cs.createSerializer;Ve.createParser=cc.createParser;var Pr=lc();Ve.parseLazy=Pr.parseLazy;Ve.asBlock=Pr.asBlock;Ve.isBlock=Pr.isBlock;Ve.copy=Pr.copy;Ve.reassignBuffers=Pr.reassignBuffers;Ve.Options=ny;Ve.createSharedStructure=xn().createSharedStructure;Ve.readSharedStructure=xn().readSharedStructure});var _c=rt((Ec,Mn)=>{(function(t,e){"use strict";typeof define=="function"&&define.amd?define(e):typeof Mn=="object"&&Mn.exports?Mn.exports=e():t.log=e()})(Ec,function(){"use strict";var t=function(){},e="undefined",r=typeof window!==e&&typeof window.navigator!==e&&/Trident\\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"],o={},i=null;function s(g,m){var y=g[m];if(typeof y.bind=="function")return y.bind(g);try{return Function.prototype.bind.call(y,g)}catch(S){return function(){return Function.prototype.apply.apply(y,[g,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(g){return g==="debug"&&(g="log"),typeof console===e?!1:g==="trace"&&r?a:console[g]!==void 0?s(console,g):console.log!==void 0?s(console,"log"):t}function u(){for(var g=this.getLevel(),m=0;m<n.length;m++){var y=n[m];this[y]=m<g?t:this.methodFactory(y,g,this.name)}if(this.log=this.debug,typeof console===e&&g<this.levels.SILENT)return"No console available for logging"}function h(g){return function(){typeof console!==e&&(u.call(this),this[g].apply(this,arguments))}}function d(g,m,y){return l(g)||h.apply(this,arguments)}function p(g,m){var y=this,S,b,E,A="loglevel";typeof g=="string"?A+=":"+g:typeof g=="symbol"&&(A=void 0);function x(N){var F=(n[N]||"silent").toUpperCase();if(!(typeof window===e||!A)){try{window.localStorage[A]=F;return}catch(Y){}try{window.document.cookie=encodeURIComponent(A)+"="+F+";"}catch(Y){}}}function z(){var N;if(!(typeof window===e||!A)){try{N=window.localStorage[A]}catch(fe){}if(typeof N===e)try{var F=window.document.cookie,Y=encodeURIComponent(A),W=F.indexOf(Y+"=");W!==-1&&(N=/^([^;]+)/.exec(F.slice(W+Y.length+1))[1])}catch(fe){}return y.levels[N]===void 0&&(N=void 0),N}}function G(){if(!(typeof window===e||!A)){try{window.localStorage.removeItem(A)}catch(N){}try{window.document.cookie=encodeURIComponent(A)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(N){}}}function L(N){var F=N;if(typeof F=="string"&&y.levels[F.toUpperCase()]!==void 0&&(F=y.levels[F.toUpperCase()]),typeof F=="number"&&F>=0&&F<=y.levels.SILENT)return F;throw new TypeError("log.setLevel() called with invalid level: "+N)}y.name=g,y.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},y.methodFactory=m||d,y.getLevel=function(){return E!=null?E:b!=null?b:S},y.setLevel=function(N,F){return E=L(N),F!==!1&&x(E),u.call(y)},y.setDefaultLevel=function(N){b=L(N),z()||y.setLevel(N,!1)},y.resetLevel=function(){E=null,G(),u.call(y)},y.enableAll=function(N){y.setLevel(y.levels.TRACE,N)},y.disableAll=function(N){y.setLevel(y.levels.SILENT,N)},y.rebuild=function(){if(i!==y&&(S=L(i.getLevel())),u.call(y),i===y)for(var N in o)o[N].rebuild()},S=L(i?i.getLevel():"WARN");var ie=z();ie!=null&&(E=L(ie)),u.call(y)}i=new p,i.getLogger=function(m){if(typeof m!="symbol"&&typeof m!="string"||m==="")throw new TypeError("You must supply a name when creating a logger.");var y=o[m];return y||(y=o[m]=new p(m,i.methodFactory)),y};var w=typeof window!==e?window.log:void 0;return i.noConflict=function(){return typeof window!==e&&window.log===i&&(window.log=w),i},i.getLoggers=function(){return o},i.default=i,i})});var Ds={arabic:"ar",armenian:"am",bulgarian:"bg",czech:"cz",danish:"dk",dutch:"nl",english:"en",finnish:"fi",french:"fr",german:"de",greek:"gr",hungarian:"hu",indian:"in",indonesian:"id",irish:"ie",italian:"it",lithuanian:"lt",nepali:"np",norwegian:"no",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"rs",slovenian:"ru",spanish:"es",swedish:"se",tamil:"ta",turkish:"tr",ukrainian:"uk",sanskrit:"sk"},Ns={dutch:/[^A-Za-z\xE0\xE8\xE9\xEC\xF2\xF3\xF90-9_\'-]+/gim,english:/[^A-Za-z\xE0\xE8\xE9\xEC\xF2\xF3\xF90-9_\'-]+/gim,french:/[^a-z0-9\xE4\xE2\xE0\xE9\xE8\xEB\xEA\xEF\xEE\xF6\xF4\xF9\xFC\xFB\u0153\xE7-]+/gim,italian:/[^A-Za-z\xE0\xE8\xE9\xEC\xF2\xF3\xF90-9_\'-]+/gim,norwegian:/[^a-z0-9_\xE6\xF8\xE5\xC6\xD8\xC5\xE4\xC4\xF6\xD6\xFC\xDC]+/gim,portuguese:/[^a-z0-9\xE0-\xFA\xC0-\xDA]/gim,russian:/[^a-z0-9\u0430-\u044F\u0410-\u042F\u0451\u0401]+/gim,spanish:/[^a-z0-9A-Z\xE1-\xFA\xC1-\xDA\xF1\xD1\xFC\xDC]+/gim,swedish:/[^a-z0-9_\xE5\xC5\xE4\xC4\xF6\xD6\xFC\xDC-]+/gim,german:/[^a-z0-9A-Z\xE4\xF6\xFC\xC4\xD6\xDC\xDF]+/gim,finnish:/[^a-z0-9\xE4\xF6\xC4\xD6]+/gim,danish:/[^a-z0-9\xE6\xF8\xE5\xC6\xD8\xC5]+/gim,hungarian:/[^a-z0-9\xE1\xE9\xED\xF3\xF6\u0151\xFA\xFC\u0171\xC1\xC9\xCD\xD3\xD6\u0150\xDA\xDC\u0170]+/gim,romanian:/[^a-z0-9\u0103\xE2\xEE\u0219\u021B\u0102\xC2\xCE\u0218\u021A]+/gim,serbian:/[^a-z0-9\u010D\u0107\u017E\u0161\u0111\u010C\u0106\u017D\u0160\u0110]+/gim,turkish:/[^a-z0-9\xE7\xC7\u011F\u011E\u0131\u0130\xF6\xD6\u015F\u015E\xFC\xDC]+/gim,lithuanian:/[^a-z0-9\u0105\u010D\u0119\u0117\u012F\u0161\u0173\u016B\u017E\u0104\u010C\u0118\u0116\u012E\u0160\u0172\u016A\u017D]+/gim,arabic:/[^a-z0-9\u0623-\u064A]+/gim,nepali:/[^a-z0-9\u0905-\u0939]+/gim,irish:/[^a-z0-9\xE1\xE9\xED\xF3\xFA\xC1\xC9\xCD\xD3\xDA]+/gim,indian:/[^a-z0-9\u0905-\u0939]+/gim,armenian:/[^a-z0-9\u0561-\u0586]+/gim,greek:/[^a-z0-9\u03B1-\u03C9\u03AC-\u03CE]+/gim,indonesian:/[^a-z0-9]+/gim,ukrainian:/[^a-z0-9\u0430-\u044F\u0410-\u042F\u0456\u0457\u0454\u0406\u0407\u0404]+/gim,slovenian:/[^a-z0-9\u010D\u017E\u0161\u010C\u017D\u0160]+/gim,bulgarian:/[^a-z0-9\u0430-\u044F\u0410-\u042F]+/gim,tamil:/[^a-z0-9\u0B85-\u0BB9]+/gim,sanskrit:/[^a-z0-9A-Z\u0101\u012B\u016B\u1E5B\u1E37\u1E43\u1E41\u1E25\u015B\u1E63\u1E6D\u1E0D\u1E47\u1E45\xF1\u1E3B\u1E39\u1E5D]+/gim,czech:/[^A-Z0-9a-z\u011B\u0161\u010D\u0159\u017E\xFD\xE1\xED\xE9\xFA\u016F\xF3\u0165\u010F\u011A\u0160\u010C\u0158\u017D\xDD\xC1\xCD\xC9\xD3\xDA\u016E\u0164\u010E-]+/gim},rr=Object.keys(Ds);function Ps(t){return t!==void 0&&rr.includes(t)?Ds[t]:void 0}var kc=Date.now().toString().slice(5),Lc=0,Us=1024,Ms=BigInt(1e3),Bs=BigInt(1e6),ks=BigInt(1e9);var Wn=65535;function kt(t,e){if(e.length<Wn)Array.prototype.push.apply(t,e);else{let r=e.length;for(let n=0;n<r;n+=Wn)Array.prototype.push.apply(t,e.slice(n,n+Wn))}}function Fs(t,...e){return t.replace(new RegExp("%(?:(?<position>\\\\d+)\\\\$)?(?<width>-?\\\\d*\\\\.?\\\\d*)(?<type>[dfs])","g"),function(...r){let n=r[r.length-1],{width:o,type:i,position:s}=n,a=s?e[Number.parseInt(s)-1]:e.shift(),l=o===""?0:Number.parseInt(o);switch(i){case"d":return a.toString().padStart(l,"0");case"f":{let u=a,[h,d]=o.split(".").map(p=>Number.parseFloat(p));return typeof d=="number"&&d>=0&&(u=u.toFixed(d)),typeof h=="number"&&h>=0?u.toString().padStart(l,"0"):u.toString()}case"s":return l<0?a.toString().padEnd(-l," "):a.toString().padStart(l," ");default:return a}})}function $s(t,e=2){if(t===0)return"0 Bytes";let r=e<0?0:e,n=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(t)/Math.log(Us));return`${parseFloat((t/Math.pow(Us,o)).toFixed(r))} ${n[o]}`}function Cc(){return typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope}function Fc(){return typeof process!="undefined"&&process.release&&process.release.name==="node"}function Ls(){return BigInt(Math.floor(performance.now()*1e6))}function wt(t){return typeof t=="number"&&(t=BigInt(t)),t<Ms?`${t}ns`:t<Bs?`${t/Ms}\\u03BCs`:t<ks?`${t/Bs}ms`:`${t/ks}s`}function Xe(){var t;return Cc()?Ls():Fc()||typeof process!="undefined"&&typeof((t=process==null?void 0:process.hrtime)==null?void 0:t.bigint)=="function"?process.hrtime.bigint():typeof performance!="undefined"?Ls():BigInt(0)}function Lt(){return`${kc}-${Lc++}`}function Ur(t,e){return Object.hasOwn===void 0?Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0:Object.hasOwn(t,e)?t[e]:void 0}function Mr(t,e){return e[1]===t[1]?t[0]-e[0]:e[1]-t[1]}function zs(t){if(t.length===0)return[];if(t.length===1)return t[0];for(let r=1;r<t.length;r++)if(t[r].length<t[0].length){let n=t[0];t[0]=t[r],t[r]=n}let e=new Map;for(let r of t[0])e.set(r,1);for(let r=1;r<t.length;r++){let n=0;for(let o of t[r]){let i=e.get(o);i===r&&(e.set(o,i+1),n++)}if(n===0)return[]}return t[0].filter(r=>{let n=e.get(r);return n!==void 0&&e.set(r,0),n===t.length})}function nr(t,e){let r={},n=e.length;for(let o=0;o<n;o++){let i=e[o],s=i.split("."),a=t,l=s.length;for(let u=0;u<l;u++)if(a=a[s[u]],typeof a=="object"){if(a!==null&&"lat"in a&&"lon"in a&&typeof a.lat=="number"&&typeof a.lon=="number"){a=r[i]=a;break}else if(!Array.isArray(a)&&a!==null&&u===l-1){a=void 0;break}}else if((a===null||typeof a!="object")&&u<l-1){a=void 0;break}typeof a!="undefined"&&(r[i]=a)}return r}function Ct(t,e){return nr(t,[e])[e]}var $c={cm:.01,m:1,km:1e3,ft:.3048,yd:.9144,mi:1609.344};function Br(t,e){let r=$c[e];if(r===void 0)throw new Error(me("INVALID_DISTANCE_SUFFIX",t).message);return t*r}function kr(t,e){t.hits=t.hits.map(r=>tt(Ee({},r),{document:Ee(Ee({},r.document),e.reduce((n,o)=>{var l;let i=o.split("."),s=i.pop(),a=n;for(let u of i)a[u]=(l=a[u])!=null?l:{},a=a[u];return a[s]=null,n},r.document))}))}function Me(t){var e;return Array.isArray(t)?t.some(r=>Me(r)):((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="AsyncFunction"}var Cs="intersection"in new Set;function Lr(...t){if(t.length===0)return new Set;if(t.length===1)return t[0];if(t.length===2){let n=t[0],o=t[1];if(Cs)return n.intersection(o);let i=new Set,s=n.size<o.size?n:o,a=s===n?o:n;for(let l of s)a.has(l)&&i.add(l);return i}let e={index:0,size:t[0].size};for(let n=1;n<t.length;n++)t[n].size<e.size&&(e.index=n,e.size=t[n].size);if(Cs){let n=t[e.index];for(let o=0;o<t.length;o++)o!==e.index&&(n=n.intersection(t[o]));return n}let r=t[e.index];for(let n=0;n<t.length;n++){if(n===e.index)continue;let o=t[n];for(let i of r)o.has(i)||r.delete(i)}return r}var zc="union"in new Set;function it(t,e){return zc?t?t.union(e):e:t?new Set([...t,...e]):new Set(e)}function jn(t){if(typeof SharedArrayBuffer!="undefined"&&typeof Atomics!="undefined"){let e=new Int32Array(new SharedArrayBuffer(4));if((t>0&&t<1/0)===!1)throw typeof t!="number"&&typeof t!="bigint"?TypeError("sleep: ms must be a number"):RangeError("sleep: ms must be a number that is greater than 0 but less than Infinity");Atomics.wait(e,0,0,Number(t))}else{if((t>0&&t<1/0)===!1)throw typeof t!="number"&&typeof t!="bigint"?TypeError("sleep: ms must be a number"):RangeError("sleep: ms must be a number that is greater than 0 but less than Infinity");let r=Date.now()+Number(t);for(;r>Date.now(););}}var Wc=rr.join(`\n - `),jc={NO_LANGUAGE_WITH_CUSTOM_TOKENIZER:"Do not pass the language option to create when using a custom tokenizer.",LANGUAGE_NOT_SUPPORTED:`Language "%s" is not supported.\nSupported languages are:\n - ${Wc}`,INVALID_STEMMER_FUNCTION_TYPE:"config.stemmer property must be a function.",MISSING_STEMMER:\'As of version 1.0.0 @orama/orama does not ship non English stemmers by default. To solve this, please explicitly import and specify the "%s" stemmer from the package @orama/stemmers. See https://docs.orama.com/open-source/text-analysis/stemming for more information.\',CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY:"Custom stop words array must only contain strings.",UNSUPPORTED_COMPONENT:\'Unsupported component "%s".\',COMPONENT_MUST_BE_FUNCTION:\'The component "%s" must be a function.\',COMPONENT_MUST_BE_FUNCTION_OR_ARRAY_FUNCTIONS:\'The component "%s" must be a function or an array of functions.\',INVALID_SCHEMA_TYPE:\'Unsupported schema type "%s" at "%s". Expected "string", "boolean" or "number" or array of them.\',DOCUMENT_ID_MUST_BE_STRING:\'Document id must be of type "string". Got "%s" instead.\',DOCUMENT_ALREADY_EXISTS:\'A document with id "%s" already exists.\',DOCUMENT_DOES_NOT_EXIST:\'A document with id "%s" does not exists.\',MISSING_DOCUMENT_PROPERTY:\'Missing searchable property "%s".\',INVALID_DOCUMENT_PROPERTY:\'Invalid document property "%s": expected "%s", got "%s"\',UNKNOWN_INDEX:\'Invalid property name "%s". Expected a wildcard string ("*") or array containing one of the following properties: %s\',INVALID_BOOST_VALUE:"Boost value must be a number greater than, or less than 0.",INVALID_FILTER_OPERATION:"You can only use one operation per filter, you requested %d.",SCHEMA_VALIDATION_FAILURE:\'Cannot insert document due schema validation failure on "%s" property.\',INVALID_SORT_SCHEMA_TYPE:\'Unsupported sort schema type "%s" at "%s". Expected "string" or "number".\',CANNOT_SORT_BY_ARRAY:\'Cannot configure sort for "%s" because it is an array (%s).\',UNABLE_TO_SORT_ON_UNKNOWN_FIELD:\'Unable to sort on unknown field "%s". Allowed fields: %s\',SORT_DISABLED:"Sort is disabled. Please read the documentation at https://docs.oramasearch for more information.",UNKNOWN_GROUP_BY_PROPERTY:\'Unknown groupBy property "%s".\',INVALID_GROUP_BY_PROPERTY:\'Invalid groupBy property "%s". Allowed types: "%s", but given "%s".\',UNKNOWN_FILTER_PROPERTY:\'Unknown filter property "%s".\',INVALID_VECTOR_SIZE:\'Vector size must be a number greater than 0. Got "%s" instead.\',INVALID_VECTOR_VALUE:\'Vector value must be a number greater than 0. Got "%s" instead.\',INVALID_INPUT_VECTOR:`Property "%s" was declared as a %s-dimensional vector, but got a %s-dimensional vector instead.\nInput vectors must be of the size declared in the schema, as calculating similarity between vectors of different sizes can lead to unexpected results.`,WRONG_SEARCH_PROPERTY_TYPE:\'Property "%s" is not searchable. Only "string" properties are searchable.\',FACET_NOT_SUPPORTED:`Facet doens\'t support the type "%s".`,INVALID_DISTANCE_SUFFIX:\'Invalid distance suffix "%s". Valid suffixes are: cm, m, km, mi, yd, ft.\',INVALID_SEARCH_MODE:\'Invalid search mode "%s". Valid modes are: "fulltext", "vector", "hybrid".\',MISSING_VECTOR_AND_SECURE_PROXY:"No vector was provided and no secure proxy was configured. Please provide a vector or configure an Orama Secure Proxy to perform hybrid search.",MISSING_TERM:\'"term" is a required parameter when performing hybrid search. Please provide a search term.\',INVALID_VECTOR_INPUT:\'Invalid "vector" property. Expected an object with "value" and "property" properties, but got "%s" instead.\',PLUGIN_CRASHED:"A plugin crashed during initialization. Please check the error message for more information:",PLUGIN_SECURE_PROXY_NOT_FOUND:`Could not find \'@orama/secure-proxy-plugin\' installed in your Orama instance.\nPlease install it before proceeding with creating an answer session.\nRead more at https://docs.orama.com/open-source/plugins/plugin-secure-proxy#plugin-secure-proxy\n`,PLUGIN_SECURE_PROXY_MISSING_CHAT_MODEL:`Could not find a chat model defined in the secure proxy plugin configuration.\nPlease provide a chat model before proceeding with creating an answer session.\nRead more at https://docs.orama.com/open-source/plugins/plugin-secure-proxy#plugin-secure-proxy\n`,ANSWER_SESSION_LAST_MESSAGE_IS_NOT_ASSISTANT:"The last message in the session is not an assistant message. Cannot regenerate non-assistant messages.",PLUGIN_COMPONENT_CONFLICT:\'The component "%s" is already defined. The plugin "%s" is trying to redefine it.\'};function me(t,...e){var n;let r=new Error(Fs((n=jc[t])!=null?n:`Unsupported Orama Error code: ${t}`,...e));return r.code=t,"captureStackTrace"in Error.prototype&&Error.captureStackTrace(r),r}function Vn(t){return{raw:Number(t),formatted:wt(t)}}function Gn(t){if(t.id){if(typeof t.id!="string")throw me("DOCUMENT_ID_MUST_BE_STRING",typeof t.id);return t.id}return Lt()}function Cr(t,e){for(let[r,n]of Object.entries(e)){let o=t[r];if(typeof o!="undefined"&&!(n==="geopoint"&&typeof o=="object"&&typeof o.lon=="number"&&typeof o.lat=="number")&&!(n==="enum"&&(typeof o=="string"||typeof o=="number"))){if(n==="enum[]"&&Array.isArray(o)){let i=o.length;for(let s=0;s<i;s++)if(typeof o[s]!="string"&&typeof o[s]!="number")return r+"."+s;continue}if(ot(n)){let i=$r(n);if(!Array.isArray(o)||o.length!==i)throw me("INVALID_INPUT_VECTOR",r,i,o.length);continue}if(Tt(n)){if(!Array.isArray(o))return r;let i=Fr(n),s=o.length;for(let a=0;a<s;a++)if(typeof o[a]!==i)return r+"."+a;continue}if(typeof n=="object"){if(!o||typeof o!="object")return r;let i=Cr(o,n);if(i)return r+"."+i;continue}if(typeof o!==n)return r}}}var Vc={string:!1,number:!1,boolean:!1,enum:!1,geopoint:!1,"string[]":!0,"number[]":!0,"boolean[]":!0,"enum[]":!0},Gc={"string[]":"string","number[]":"number","boolean[]":"boolean","enum[]":"enum"};function Hn(t){return t==="geopoint"}function ot(t){return typeof t=="string"&&/^vector\\[\\d+\\]$/.test(t)}function Tt(t){return typeof t=="string"&&Vc[t]}function Fr(t){return Gc[t]}function $r(t){let e=Number(t.slice(7,-1));switch(!0){case isNaN(e):throw me("INVALID_VECTOR_VALUE",t);case e<=0:throw me("INVALID_VECTOR_SIZE",t);default:return e}}var Wr={};gt(Wr,{count:()=>Js,create:()=>Vs,createDocumentsStore:()=>qn,get:()=>Gs,getAll:()=>Ys,getMultiple:()=>Hs,load:()=>Xs,remove:()=>Ks,save:()=>Zs,store:()=>qs});var zr={};gt(zr,{createInternalDocumentIDStore:()=>Yn,getDocumentIdFromInternalId:()=>Ze,getInternalDocumentId:()=>Pe,load:()=>js,save:()=>Ws});function Yn(){return{idToInternalId:new Map,internalIdToId:[],save:Ws,load:js}}function Ws(t){return{internalIdToId:t.internalIdToId}}function js(t,e){let{internalIdToId:r}=e;t.internalDocumentIDStore.idToInternalId.clear(),t.internalDocumentIDStore.internalIdToId=[];let n=r.length;for(let o=0;o<n;o++){let i=r[o];t.internalDocumentIDStore.idToInternalId.set(i,o+1),t.internalDocumentIDStore.internalIdToId.push(i)}}function Pe(t,e){if(typeof e=="string"){let r=t.idToInternalId.get(e);if(r)return r;let n=t.idToInternalId.size+1;return t.idToInternalId.set(e,n),t.internalIdToId.push(e),n}return e>t.internalIdToId.length?Pe(t,e.toString()):e}function Ze(t,e){if(t.internalIdToId.length<e)throw new Error(`Invalid internalId ${e}`);return t.internalIdToId[e-1]}function Vs(t,e){return{sharedInternalDocumentStore:e,docs:{},count:0}}function Gs(t,e){let r=Pe(t.sharedInternalDocumentStore,e);return t.docs[r]}function Hs(t,e){let r=e.length,n=Array.from({length:r});for(let o=0;o<r;o++){let i=Pe(t.sharedInternalDocumentStore,e[o]);n[o]=t.docs[i]}return n}function Ys(t){return t.docs}function qs(t,e,r,n){return typeof t.docs[r]!="undefined"?!1:(t.docs[r]=n,t.count++,!0)}function Ks(t,e){let r=Pe(t.sharedInternalDocumentStore,e);return typeof t.docs[r]=="undefined"?!1:(delete t.docs[r],t.count--,!0)}function Js(t){return t.count}function Xs(t,e){let r=e;return{docs:r.docs,count:r.count,sharedInternalDocumentStore:t}}function Zs(t){return{docs:t.docs,count:t.count}}function qn(){return{create:Vs,get:Gs,getMultiple:Hs,getAll:Ys,store:qs,remove:Ks,count:Js,load:Xs,save:Zs}}var Qs=["beforeInsert","afterInsert","beforeRemove","afterRemove","beforeUpdate","afterUpdate","beforeSearch","afterSearch","beforeInsertMultiple","afterInsertMultiple","beforeRemoveMultiple","afterRemoveMultiple","beforeUpdateMultiple","afterUpdateMultiple","beforeLoad","afterLoad","afterCreate"];function ea(t,e){var o;let r=[],n=(o=t.plugins)==null?void 0:o.length;if(!n)return r;for(let i=0;i<n;i++)try{let s=t.plugins[i];typeof s[e]=="function"&&r.push(s[e])}catch(s){throw console.error("Caught error in getAllPluginsByHook:",s),me("PLUGIN_CRASHED")}return r}var ta=["tokenizer","index","documentsStore","sorter"],Kn=["validateSchema","getDocumentIndexId","getDocumentProperties","formatElapsedTime"];function Qe(t,e,r,n){if(t.some(Me))return(async()=>{for(let i of t)await i(e,r,n)})();for(let i of t)i(e,r,n)}function ir(t,e,r){if(t.some(Me))return(async()=>{for(let o of t)await o(e,r)})();for(let o of t)o(e,r)}function Ft(t,e,r,n,o){if(t.some(Me))return(async()=>{for(let s of t)await s(e,r,n,o)})();for(let s of t)s(e,r,n,o)}function $t(t,e,r,n){if(t.some(Me))return(async()=>{for(let i of t)await i(e,r,n)})();for(let i of t)i(e,r,n)}function ra(t,e){if(t.some(Me))return(async()=>{for(let n of t)await n(e)})();for(let n of t)n(e)}var Gr={};gt(Gr,{calculateResultScores:()=>Zn,create:()=>Xn,createIndex:()=>Qn,getSearchableProperties:()=>ba,getSearchablePropertiesWithTypes:()=>ma,insert:()=>ha,insertDocumentScoreParameters:()=>la,insertTokenScoreParameters:()=>ca,insertVector:()=>pa,load:()=>Sa,remove:()=>ya,removeDocumentScoreParameters:()=>ua,removeTokenScoreParameters:()=>da,save:()=>va,search:()=>ga,searchByWhereClause:()=>wa});var Rt=class t{constructor(e,r){Ie(this,"k");Ie(this,"v");Ie(this,"l",null);Ie(this,"r",null);Ie(this,"h",1);this.k=e,this.v=new Set(r)}updateHeight(){this.h=Math.max(t.getHeight(this.l),t.getHeight(this.r))+1}static getHeight(e){return e?e.h:0}getBalanceFactor(){return t.getHeight(this.l)-t.getHeight(this.r)}rotateLeft(){let e=this.r;return this.r=e.l,e.l=this,this.updateHeight(),e.updateHeight(),e}rotateRight(){let e=this.l;return this.l=e.r,e.r=this,this.updateHeight(),e.updateHeight(),e}toJSON(){return{k:this.k,v:Array.from(this.v),l:this.l?this.l.toJSON():null,r:this.r?this.r.toJSON():null,h:this.h}}static fromJSON(e){let r=new t(e.k,e.v);return r.l=e.l?t.fromJSON(e.l):null,r.r=e.r?t.fromJSON(e.r):null,r.h=e.h,r}},or=class t{constructor(e,r){Ie(this,"root",null);Ie(this,"insertCount",0);e!==void 0&&r!==void 0&&(this.root=new Rt(e,r))}insert(e,r,n=1e3){this.root=this.insertNode(this.root,e,r,n)}insertMultiple(e,r,n=1e3){for(let o of r)this.insert(e,o,n)}rebalance(){this.root&&(this.root=this.rebalanceNode(this.root))}toJSON(){return{root:this.root?this.root.toJSON():null,insertCount:this.insertCount}}static fromJSON(e){let r=new t;return r.root=e.root?Rt.fromJSON(e.root):null,r.insertCount=e.insertCount||0,r}insertNode(e,r,n,o){if(e===null)return new Rt(r,[n]);let i=[],s=e,a=null;for(;s!==null;)if(i.push({parent:a,node:s}),r<s.k)if(s.l===null){s.l=new Rt(r,[n]),i.push({parent:s,node:s.l});break}else a=s,s=s.l;else if(r>s.k)if(s.r===null){s.r=new Rt(r,[n]),i.push({parent:s,node:s.r});break}else a=s,s=s.r;else return s.v.add(n),e;let l=!1;this.insertCount++%o===0&&(l=!0);for(let u=i.length-1;u>=0;u--){let{parent:h,node:d}=i[u];if(d.updateHeight(),l){let p=this.rebalanceNode(d);h?h.l===d?h.l=p:h.r===d&&(h.r=p):e=p}}return e}rebalanceNode(e){let r=e.getBalanceFactor();if(r>1){if(e.l&&e.l.getBalanceFactor()>=0)return e.rotateRight();if(e.l)return e.l=e.l.rotateLeft(),e.rotateRight()}if(r<-1){if(e.r&&e.r.getBalanceFactor()<=0)return e.rotateLeft();if(e.r)return e.r=e.r.rotateRight(),e.rotateLeft()}return e}find(e){let r=this.findNodeByKey(e);return r?r.v:null}contains(e){return this.find(e)!==null}getSize(){let e=0,r=[],n=this.root;for(;n||r.length>0;){for(;n;)r.push(n),n=n.l;n=r.pop(),e++,n=n.r}return e}isBalanced(){if(!this.root)return!0;let e=[this.root];for(;e.length>0;){let r=e.pop(),n=r.getBalanceFactor();if(Math.abs(n)>1)return!1;r.l&&e.push(r.l),r.r&&e.push(r.r)}return!0}remove(e){this.root=this.removeNode(this.root,e)}removeDocument(e,r){let n=this.findNodeByKey(e);n&&(n.v.size===1?this.root=this.removeNode(this.root,e):n.v=new Set([...n.v.values()].filter(o=>o!==r)))}findNodeByKey(e){let r=this.root;for(;r;)if(e<r.k)r=r.l;else if(e>r.k)r=r.r;else return r;return null}removeNode(e,r){if(e===null)return null;let n=[],o=e;for(;o!==null&&o.k!==r;)n.push(o),r<o.k?o=o.l:o=o.r;if(o===null)return e;if(o.l===null||o.r===null){let i=o.l?o.l:o.r;if(n.length===0)e=i;else{let s=n[n.length-1];s.l===o?s.l=i:s.r=i}}else{let i=o,s=o.r;for(;s.l!==null;)i=s,s=s.l;o.k=s.k,o.v=s.v,i.l===s?i.l=s.r:i.r=s.r,o=i}n.push(o);for(let i=n.length-1;i>=0;i--){let s=n[i];s.updateHeight();let a=this.rebalanceNode(s);if(i>0){let l=n[i-1];l.l===s?l.l=a:l.r===s&&(l.r=a)}else e=a}return e}rangeSearch(e,r){let n=new Set,o=[],i=this.root;for(;i||o.length>0;){for(;i;)o.push(i),i=i.l;if(i=o.pop(),i.k>=e&&i.k<=r&&(n=it(n,i.v)),i.k>r)break;i=i.r}return n}greaterThan(e,r=!1){let n=new Set,o=[],i=this.root;for(;i||o.length>0;){for(;i;)o.push(i),i=i.r;if(i=o.pop(),r&&i.k>=e||!r&&i.k>e)n=it(n,i.v);else if(i.k<=e)break;i=i.l}return n}lessThan(e,r=!1){let n=new Set,o=[],i=this.root;for(;i||o.length>0;){for(;i;)o.push(i),i=i.l;if(i=o.pop(),r&&i.k<=e||!r&&i.k<e)n=it(n,i.v);else if(i.k>e)break;i=i.r}return n}};var sr=class t{constructor(){Ie(this,"numberToDocumentId");this.numberToDocumentId=new Map}insert(e,r){this.numberToDocumentId.has(e)?this.numberToDocumentId.get(e).add(r):this.numberToDocumentId.set(e,new Set([r]))}find(e){let r=this.numberToDocumentId.get(e);return r?Array.from(r):null}remove(e){this.numberToDocumentId.delete(e)}removeDocument(e,r){let n=this.numberToDocumentId.get(r);n&&(n.delete(e),n.size===0&&this.numberToDocumentId.delete(r))}contains(e){return this.numberToDocumentId.has(e)}getSize(){let e=0;for(let r of this.numberToDocumentId.values())e+=r.size;return e}filter(e){let r=Object.keys(e);if(r.length!==1)throw new Error("Invalid operation");let n=r[0];switch(n){case"eq":{let o=e[n],i=this.numberToDocumentId.get(o);return i?Array.from(i):[]}case"in":{let o=e[n],i=new Set;for(let s of o){let a=this.numberToDocumentId.get(s);if(a)for(let l of a)i.add(l)}return Array.from(i)}case"nin":{let o=new Set(e[n]),i=new Set;for(let[s,a]of this.numberToDocumentId.entries())if(!o.has(s))for(let l of a)i.add(l);return Array.from(i)}default:throw new Error("Invalid operation")}}filterArr(e){let r=Object.keys(e);if(r.length!==1)throw new Error("Invalid operation");let n=r[0];switch(n){case"containsAll":{let i=e[n].map(a=>{var l;return(l=this.numberToDocumentId.get(a))!=null?l:new Set});if(i.length===0)return[];let s=i.reduce((a,l)=>new Set([...a].filter(u=>l.has(u))));return Array.from(s)}case"containsAny":{let i=e[n].map(a=>{var l;return(l=this.numberToDocumentId.get(a))!=null?l:new Set});if(i.length===0)return[];let s=i.reduce((a,l)=>new Set([...a,...l]));return Array.from(s)}default:throw new Error("Invalid operation")}}static fromJSON(e){if(!e.numberToDocumentId)throw new Error("Invalid Flat Tree JSON");let r=new t;for(let[n,o]of e.numberToDocumentId)r.numberToDocumentId.set(n,new Set(o));return r}toJSON(){return{numberToDocumentId:Array.from(this.numberToDocumentId.entries()).map(([e,r])=>[e,Array.from(r)])}}};function na(t,e,r){if(r<0)return-1;if(t===e)return 0;let n=t.length,o=e.length;if(n===0)return o<=r?o:-1;if(o===0)return n<=r?n:-1;let i=Math.abs(n-o);if(t.startsWith(e))return i<=r?i:-1;if(e.startsWith(t))return 0;if(i>r)return-1;let s=[];for(let a=0;a<=n;a++){s[a]=[a];for(let l=1;l<=o;l++)s[a][l]=a===0?l:0}for(let a=1;a<=n;a++){let l=1/0;for(let u=1;u<=o;u++)t[a-1]===e[u-1]?s[a][u]=s[a-1][u-1]:s[a][u]=Math.min(s[a-1][u]+1,s[a][u-1]+1,s[a-1][u-1]+1),l=Math.min(l,s[a][u]);if(l>r)return-1}return s[n][o]<=r?s[n][o]:-1}function ia(t,e,r){let n=na(t,e,r);return{distance:n,isBounded:n>=0}}function Jn(t,e,r){let n=na(t,e,r);return{distance:n,isBounded:n>=0}}var jr=class t{constructor(e,r,n){Ie(this,"k");Ie(this,"s");Ie(this,"c",new Map);Ie(this,"d",new Set);Ie(this,"e");Ie(this,"w","");this.k=e,this.s=r,this.e=n}updateParent(e){this.w=e.w+this.s}addDocument(e){this.d.add(e)}removeDocument(e){return this.d.delete(e)}findAllWords(e,r,n,o){let i=[this];for(;i.length>0;){let s=i.pop();if(s.e){let{w:a,d:l}=s;if(n&&a!==r)continue;if(Ur(e,a)!==null)if(o)if(Math.abs(r.length-a.length)<=o&&Jn(r,a,o).isBounded)e[a]=[];else continue;else e[a]=[];if(Ur(e,a)!=null&&l.size>0){let u=e[a];for(let h of l)u.includes(h)||u.push(h)}}s.c.size>0&&i.push(...s.c.values())}return e}insert(e,r){let n=this,o=0,i=e.length;for(;o<i;){let s=e[o],a=n.c.get(s);if(a){let l=a.s,u=l.length,h=0;for(;h<u&&o+h<i&&l[h]===e[o+h];)h++;if(h===u){if(n=a,o+=h,o===i){a.e||(a.e=!0),a.addDocument(r);return}continue}let d=l.slice(0,h),p=l.slice(h),w=e.slice(o+h),g=new t(d[0],d,!1);if(n.c.set(d[0],g),g.updateParent(n),a.s=p,a.k=p[0],g.c.set(p[0],a),a.updateParent(g),w){let m=new t(w[0],w,!0);m.addDocument(r),g.c.set(w[0],m),m.updateParent(g)}else g.e=!0,g.addDocument(r);return}else{let l=new t(s,e.slice(o),!0);l.addDocument(r),n.c.set(s,l),l.updateParent(n);return}}n.e||(n.e=!0),n.addDocument(r)}_findLevenshtein(e,r,n,o,i){let s=[{node:this,index:r,tolerance:n}];for(;s.length>0;){let{node:a,index:l,tolerance:u}=s.pop();if(a.w.startsWith(e)){a.findAllWords(i,e,!1,0);continue}if(u<0)continue;if(a.e){let{w:d,d:p}=a;if(d&&(Jn(e,d,o).isBounded&&(i[d]=[]),Ur(i,d)!==void 0&&p.size>0)){let w=new Set(i[d]);for(let g of p)w.add(g);i[d]=Array.from(w)}}if(l>=e.length)continue;let h=e[l];if(a.c.has(h)){let d=a.c.get(h);s.push({node:d,index:l+1,tolerance:u})}s.push({node:a,index:l+1,tolerance:u-1});for(let[d,p]of a.c)s.push({node:p,index:l,tolerance:u-1}),d!==h&&s.push({node:p,index:l+1,tolerance:u-1})}}find(e){let{term:r,exact:n,tolerance:o}=e;if(o&&!n){let i={};return this._findLevenshtein(r,0,o,o,i),i}else{let i=this,s=0,a=r.length;for(;s<a;){let u=r[s],h=i.c.get(u);if(h){let d=h.s,p=d.length,w=0;for(;w<p&&s+w<a&&d[w]===r[s+w];)w++;if(w===p)i=h,s+=w;else if(s+w===a){if(n)return{};{let g={};return h.findAllWords(g,r,n,o),g}}else return{}}else return{}}let l={};return i.findAllWords(l,r,n,o),l}}contains(e){let r=this,n=0,o=e.length;for(;n<o;){let i=e[n],s=r.c.get(i);if(s){let a=s.s,l=a.length,u=0;for(;u<l&&n+u<o&&a[u]===e[n+u];)u++;if(u<l)return!1;n+=l,r=s}else return!1}return!0}removeWord(e){if(!e)return!1;let r=this,n=e.length,o=[];for(let i=0;i<n;i++){let s=e[i];if(r.c.has(s)){let a=r.c.get(s);o.push({parent:r,character:s}),i+=a.s.length-1,r=a}else return!1}for(r.d.clear(),r.e=!1;o.length>0&&r.c.size===0&&!r.e&&r.d.size===0;){let{parent:i,character:s}=o.pop();i.c.delete(s),r=i}return!0}removeDocumentByWord(e,r,n=!0){if(!e)return!0;let o=this,i=e.length;for(let s=0;s<i;s++){let a=e[s];if(o.c.has(a)){let l=o.c.get(a);s+=l.s.length-1,o=l,n&&o.w!==e||o.removeDocument(r)}else return!1}return!0}static getCommonPrefix(e,r){let n=Math.min(e.length,r.length),o=0;for(;o<n&&e.charCodeAt(o)===r.charCodeAt(o);)o++;return e.slice(0,o)}toJSON(){var e,r;return{w:this.w,s:this.s,e:this.e,k:this.k,d:Array.from(this.d),c:(r=Array.from((e=this.c)==null?void 0:e.entries()))==null?void 0:r.map(([n,o])=>[n,o.toJSON()])}}static fromJSON(e){var n;let r=new t(e.k,e.s,e.e);return r.w=e.w,r.d=new Set(e.d),r.c=new Map((n=e==null?void 0:e.c)==null?void 0:n.map(([o,i])=>[o,t.fromJSON(i)])),r}},ar=class t extends jr{constructor(){super("","",!1)}static fromJSON(e){var n;let r=new t;return r.w=e.w,r.s=e.s,r.e=e.e,r.k=e.k,r.d=new Set(e.d),r.c=new Map((n=e.c)==null?void 0:n.map(([o,i])=>[o,jr.fromJSON(i)])),r}toJSON(){return super.toJSON()}};var Vr=class t{constructor(e,r){Ie(this,"point");Ie(this,"docIDs");Ie(this,"left");Ie(this,"right");Ie(this,"parent");this.point=e,this.docIDs=new Set(r),this.left=null,this.right=null,this.parent=null}toJSON(){return{point:this.point,docIDs:Array.from(this.docIDs),left:this.left?this.left.toJSON():null,right:this.right?this.right.toJSON():null}}static fromJSON(e,r=null){let n=new t(e.point,e.docIDs);return n.parent=r,e.left&&(n.left=t.fromJSON(e.left,n)),e.right&&(n.right=t.fromJSON(e.right,n)),n}},fr=class t{constructor(){Ie(this,"root");Ie(this,"nodeMap");this.root=null,this.nodeMap=new Map}getPointKey(e){return`${e.lon},${e.lat}`}insert(e,r){let n=this.getPointKey(e),o=this.nodeMap.get(n);if(o){r.forEach(l=>o.docIDs.add(l));return}let i=new Vr(e,r);if(this.nodeMap.set(n,i),this.root==null){this.root=i;return}let s=this.root,a=0;for(;;){if(a%2===0)if(e.lon<s.point.lon){if(s.left==null){s.left=i,i.parent=s;return}s=s.left}else{if(s.right==null){s.right=i,i.parent=s;return}s=s.right}else if(e.lat<s.point.lat){if(s.left==null){s.left=i,i.parent=s;return}s=s.left}else{if(s.right==null){s.right=i,i.parent=s;return}s=s.right}a++}}contains(e){let r=this.getPointKey(e);return this.nodeMap.has(r)}getDocIDsByCoordinates(e){let r=this.getPointKey(e),n=this.nodeMap.get(r);return n?Array.from(n.docIDs):null}removeDocByID(e,r){let n=this.getPointKey(e),o=this.nodeMap.get(n);o&&(o.docIDs.delete(r),o.docIDs.size===0&&(this.nodeMap.delete(n),this.deleteNode(o)))}deleteNode(e){let r=e.parent,n=e.left?e.left:e.right;n&&(n.parent=r),r?r.left===e?r.left=n:r.right===e&&(r.right=n):(this.root=n,this.root&&(this.root.parent=null))}searchByRadius(e,r,n=!0,o="asc",i=!1){let s=i?t.vincentyDistance:t.haversineDistance,a=[{node:this.root,depth:0}],l=[];for(;a.length>0;){let{node:u,depth:h}=a.pop();if(u==null)continue;let d=s(e,u.point);(n?d<=r:d>r)&&l.push({point:u.point,docIDs:Array.from(u.docIDs)}),u.left!=null&&a.push({node:u.left,depth:h+1}),u.right!=null&&a.push({node:u.right,depth:h+1})}return o&&l.sort((u,h)=>{let d=s(e,u.point),p=s(e,h.point);return o.toLowerCase()==="asc"?d-p:p-d}),l}searchByPolygon(e,r=!0,n=null,o=!1){let i=[{node:this.root,depth:0}],s=[];for(;i.length>0;){let{node:l,depth:u}=i.pop();if(l==null)continue;l.left!=null&&i.push({node:l.left,depth:u+1}),l.right!=null&&i.push({node:l.right,depth:u+1});let h=t.isPointInPolygon(e,l.point);(h&&r||!h&&!r)&&s.push({point:l.point,docIDs:Array.from(l.docIDs)})}let a=t.calculatePolygonCentroid(e);if(n){let l=o?t.vincentyDistance:t.haversineDistance;s.sort((u,h)=>{let d=l(a,u.point),p=l(a,h.point);return n.toLowerCase()==="asc"?d-p:p-d})}return s}toJSON(){return{root:this.root?this.root.toJSON():null}}static fromJSON(e){let r=new t;return e.root&&(r.root=Vr.fromJSON(e.root),r.buildNodeMap(r.root)),r}buildNodeMap(e){if(e==null)return;let r=this.getPointKey(e.point);this.nodeMap.set(r,e),e.left&&this.buildNodeMap(e.left),e.right&&this.buildNodeMap(e.right)}static calculatePolygonCentroid(e){let r=0,n=0,o=0,i=e.length;for(let a=0,l=i-1;a<i;l=a++){let u=e[a].lon,h=e[a].lat,d=e[l].lon,p=e[l].lat,w=u*p-d*h;r+=w,n+=(u+d)*w,o+=(h+p)*w}r/=2;let s=6*r;return n/=s,o/=s,{lon:n,lat:o}}static isPointInPolygon(e,r){let n=!1,o=r.lon,i=r.lat,s=e.length;for(let a=0,l=s-1;a<s;l=a++){let u=e[a].lon,h=e[a].lat,d=e[l].lon,p=e[l].lat;h>i!=p>i&&o<(d-u)*(i-h)/(p-h)+u&&(n=!n)}return n}static haversineDistance(e,r){let n=Math.PI/180,o=e.lat*n,i=r.lat*n,s=(r.lat-e.lat)*n,a=(r.lon-e.lon)*n,l=Math.sin(s/2)*Math.sin(s/2)+Math.cos(o)*Math.cos(i)*Math.sin(a/2)*Math.sin(a/2);return 6371e3*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))}static vincentyDistance(e,r){let o=.0033528106647474805,i=(1-o)*6378137,s=Math.PI/180,a=e.lat*s,l=r.lat*s,u=(r.lon-e.lon)*s,h=Math.atan((1-o)*Math.tan(a)),d=Math.atan((1-o)*Math.tan(l)),p=Math.sin(h),w=Math.cos(h),g=Math.sin(d),m=Math.cos(d),y=u,S,b=1e3,E,A,x,z,G,L;do{let fe=Math.sin(y),ue=Math.cos(y);if(E=Math.sqrt(m*fe*(m*fe)+(w*g-p*m*ue)*(w*g-p*m*ue)),E===0)return 0;A=p*g+w*m*ue,x=Math.atan2(E,A),z=w*m*fe/E,G=1-z*z,L=A-2*p*g/G,isNaN(L)&&(L=0);let pe=o/16*G*(4+o*(4-3*G));S=y,y=u+(1-pe)*o*z*(x+pe*E*(L+pe*A*(-1+2*L*L)))}while(Math.abs(y-S)>1e-12&&--b>0);if(b===0)return NaN;let ie=G*(6378137*6378137-i*i)/(i*i),N=1+ie/16384*(4096+ie*(-768+ie*(320-175*ie))),F=ie/1024*(256+ie*(-128+ie*(74-47*ie))),Y=F*E*(L+F/4*(A*(-1+2*L*L)-F/6*L*(-3+4*E*E)*(-3+4*L*L)));return i*N*(x-Y)}};var lr=class t{constructor(){Ie(this,"true");Ie(this,"false");this.true=new Set,this.false=new Set}insert(e,r){r?this.true.add(e):this.false.add(e)}delete(e,r){r?this.true.delete(e):this.false.delete(e)}getSize(){return this.true.size+this.false.size}toJSON(){return{true:Array.from(this.true),false:Array.from(this.false)}}static fromJSON(e){let r=new t;return r.true=new Set(e.true),r.false=new Set(e.false),r}};function oa(t,e,r,n,o,{k:i,b:s,d:a}){return Math.log(1+(r-e+.5)/(e+.5))*(a+t*(i+1))/(t+i*(1-s+s*n/o))}var cr=class t{constructor(e){Ie(this,"size");Ie(this,"vectors",new Map);this.size=e}add(e,r){r instanceof Float32Array||(r=new Float32Array(r));let n=sa(r,this.size);this.vectors.set(e,[n,r])}remove(e){this.vectors.delete(e)}find(e,r,n){return e instanceof Float32Array||(e=new Float32Array(e)),Hc(e,n,this.vectors,this.size,r)}toJSON(){let e=[];for(let[r,[n,o]]of this.vectors)e.push([r,[n,Array.from(o)]]);return{size:this.size,vectors:e}}static fromJSON(e){let r=e,n=new t(r.size);for(let[o,[i,s]]of r.vectors)n.vectors.set(o,[i,new Float32Array(s)]);return n}};function sa(t,e){let r=0;for(let n=0;n<e;n++)r+=t[n]*t[n];return Math.sqrt(r)}function Hc(t,e,r,n,o){let i=sa(t,n),s=[],a=e||r.keys();for(let l of a){let u=r.get(l);if(!u)continue;let h=u[0],d=u[1],p=0;for(let g=0;g<n;g++)p+=t[g]*d[g];let w=p/(i*h);w>=o&&s.push([l,w])}return s}function la(t,e,r,n,o){var s;let i=Pe(t.sharedInternalDocumentStore,r);t.avgFieldLength[e]=(((s=t.avgFieldLength[e])!=null?s:0)*(o-1)+n.length)/o,t.fieldLengths[e][i]=n.length,t.frequencies[e][i]={}}function ca(t,e,r,n,o){var l;let i=0;for(let u of n)u===o&&i++;let s=Pe(t.sharedInternalDocumentStore,r),a=i/n.length;t.frequencies[e][s][o]=a,o in t.tokenOccurrences[e]||(t.tokenOccurrences[e][o]=0),t.tokenOccurrences[e][o]=((l=t.tokenOccurrences[e][o])!=null?l:0)+1}function ua(t,e,r,n){let o=Pe(t.sharedInternalDocumentStore,r);n>1?t.avgFieldLength[e]=(t.avgFieldLength[e]*n-t.fieldLengths[e][o])/(n-1):t.avgFieldLength[e]=void 0,t.fieldLengths[e][o]=void 0,t.frequencies[e][o]=void 0}function da(t,e,r){t.tokenOccurrences[e][r]--}function Xn(t,e,r,n,o=""){n||(n={sharedInternalDocumentStore:e,indexes:{},vectorIndexes:{},searchableProperties:[],searchablePropertiesWithTypes:{},frequencies:{},tokenOccurrences:{},avgFieldLength:{},fieldLengths:{}});for(let[i,s]of Object.entries(r)){let a=`${o}${o?".":""}${i}`;if(typeof s=="object"&&!Array.isArray(s)){Xn(t,e,s,n,a);continue}if(ot(s))n.searchableProperties.push(a),n.searchablePropertiesWithTypes[a]=s,n.vectorIndexes[a]={type:"Vector",node:new cr($r(s)),isArray:!1};else{let l=/\\[/.test(s);switch(s){case"boolean":case"boolean[]":n.indexes[a]={type:"Bool",node:new lr,isArray:l};break;case"number":case"number[]":n.indexes[a]={type:"AVL",node:new or(0,[]),isArray:l};break;case"string":case"string[]":n.indexes[a]={type:"Radix",node:new ar,isArray:l},n.avgFieldLength[a]=0,n.frequencies[a]={},n.tokenOccurrences[a]={},n.fieldLengths[a]={};break;case"enum":case"enum[]":n.indexes[a]={type:"Flat",node:new sr,isArray:l};break;case"geopoint":n.indexes[a]={type:"BKD",node:new fr,isArray:l};break;default:throw me("INVALID_SCHEMA_TYPE",Array.isArray(s)?"array":s,a)}n.searchableProperties.push(a),n.searchablePropertiesWithTypes[a]=s}}return n}function Yc(t,e,r,n,o,i,s,a){return l=>{var d;let{type:u,node:h}=e.indexes[r];switch(u){case"Bool":{h[l?"true":"false"].add(n);break}case"AVL":{let p=(d=a==null?void 0:a.avlRebalanceThreshold)!=null?d:1;h.insert(l,n,p);break}case"Radix":{let p=i.tokenize(l,o,r,!1);t.insertDocumentScoreParameters(e,r,n,p,s);for(let w of p)t.insertTokenScoreParameters(e,r,n,p,w),h.insert(w,n);break}case"Flat":{h.insert(l,n);break}case"BKD":{h.insert(l,[n]);break}}}}function ha(t,e,r,n,o,i,s,a,l,u,h){if(ot(s))return pa(e,r,i,n,o);let d=Yc(t,e,r,o,a,l,u,h);if(!Tt(s))return d(i);let p=i,w=p.length;for(let g=0;g<w;g++)d(p[g])}function pa(t,e,r,n,o){t.vectorIndexes[e].node.add(o,r)}function aa(t,e,r,n,o,i,s,a,l,u){if(ot(s))return e.vectorIndexes[r].node.remove(o),!0;let{type:h,node:d}=e.indexes[r];switch(h){case"AVL":return d.removeDocument(i,o),!0;case"Bool":return d[i?"true":"false"].delete(o),!0;case"Radix":{let p=l.tokenize(i,a,r);t.removeDocumentScoreParameters(e,r,n,u);for(let w of p)t.removeTokenScoreParameters(e,r,w),d.removeDocumentByWord(w,o);return!0}case"Flat":return d.removeDocument(o,i),!0;case"BKD":return d.removeDocByID(i,o),!1}}function ya(t,e,r,n,o,i,s,a,l,u){if(!Tt(s))return aa(t,e,r,n,o,i,s,a,l,u);let h=Fr(s),d=i,p=d.length;for(let w=0;w<p;w++)aa(t,e,r,n,o,d[w],h,a,l,u);return!0}function Zn(t,e,r,n,o,i,s,a,l,u){var S,b,E;let h=Array.from(n),d=t.avgFieldLength[e],p=t.fieldLengths[e],w=t.tokenOccurrences[e],g=t.frequencies[e],m=typeof w[r]=="number"&&(S=w[r])!=null?S:0,y=h.length;for(let A=0;A<y;A++){let x=h[A];if(l&&!l.has(x))continue;u.has(x)||u.set(x,new Map);let z=u.get(x);z.set(e,(z.get(e)||0)+1);let G=(E=(b=g==null?void 0:g[x])==null?void 0:b[r])!=null?E:0,L=oa(G,m,o,p[x],d,i);s.has(x)?s.set(x,s.get(x)+L*a):s.set(x,L*a)}}function qc(t,e,r,n,o,i,s,a,l,u,h,d){let p=n.length;for(let w=0;w<p;w++){let g=n[w],m=e.find({term:g,exact:o,tolerance:i}),y=Object.keys(m),S=y.length;for(let b=0;b<S;b++){let E=y[b],A=m[E];Zn(t,r,E,A,u,l,s,a,h,d)}}}function ga(t,e,r,n,o,i,s,a,l,u,h,d=0){var b;let p=r.tokenize(e,n),w=p.length||1,g=new Map,m=new Map;for(let E of o){if(!(E in t.indexes))continue;let A=t.indexes[E],{type:x}=A;if(x!=="Radix")throw me("WRONG_SEARCH_PROPERTY_TYPE",E);let z=(b=a[E])!=null?b:1;if(z<=0)throw me("INVALID_BOOST_VALUE",z);p.length===0&&!e&&p.push(""),qc(t,A.node,E,p,i,s,m,z,l,u,h,g)}let y=Array.from(m.entries()).map(([E,A])=>[E,A]).sort((E,A)=>A[1]-E[1]);if(y.length===0)return[];if(d===1)return y;let S=y.filter(([E])=>{let A=g.get(E);return A?Array.from(A.values()).some(x=>x===w):!1});if(d===0)return S;if(S.length>0){let E=y.filter(([x])=>!S.some(([z])=>z===x)),A=Math.ceil(E.length*d);return[...S,...E.slice(0,A)]}return y}function wa(t,e,r,n){let o=Object.keys(r),i=o.reduce((s,a)=>Ee({[a]:new Set},s),{});for(let s of o){let a=r[s];if(typeof t.indexes[s]=="undefined")throw me("UNKNOWN_FILTER_PROPERTY",s);let{node:l,type:u,isArray:h}=t.indexes[s];if(u==="Bool"){let p=l,w=a?p.true:p.false;i[s]=it(i[s],w);continue}if(u==="BKD"){let p;if("radius"in a)p="radius";else if("polygon"in a)p="polygon";else throw new Error(`Invalid operation ${a}`);if(p==="radius"){let{value:w,coordinates:g,unit:m="m",inside:y=!0,highPrecision:S=!1}=a[p],b=Br(w,m),E=l.searchByRadius(g,b,y,void 0,S);i[s]=fa(i[s],E)}else{let{coordinates:w,inside:g=!0,highPrecision:m=!1}=a[p],y=l.searchByPolygon(w,g,void 0,m);i[s]=fa(i[s],y)}continue}if(u==="Radix"&&(typeof a=="string"||Array.isArray(a))){for(let p of[a].flat()){let w=e.tokenize(p,n,s);for(let g of w){let m=l.find({term:g,exact:!0});i[s]=Kc(i[s],m)}}continue}let d=Object.keys(a);if(d.length>1)throw me("INVALID_FILTER_OPERATION",d.length);if(u==="Flat"){let p=new Set(h?l.filterArr(a):l.filter(a));i[s]=it(i[s],p);continue}if(u==="AVL"){let p=d[0],w=a[p],g;switch(p){case"gt":{g=l.greaterThan(w,!1);break}case"gte":{g=l.greaterThan(w,!0);break}case"lt":{g=l.lessThan(w,!1);break}case"lte":{g=l.lessThan(w,!0);break}case"eq":{let m=l.find(w);g=m!=null?m:new Set;break}case"between":{let[m,y]=w;g=l.rangeSearch(m,y);break}default:throw me("INVALID_FILTER_OPERATION",p)}i[s]=it(i[s],g)}}return Lr(...Object.values(i))}function ba(t){return t.searchableProperties}function ma(t){return t.searchablePropertiesWithTypes}function Sa(t,e){let{indexes:r,vectorIndexes:n,searchableProperties:o,searchablePropertiesWithTypes:i,frequencies:s,tokenOccurrences:a,avgFieldLength:l,fieldLengths:u}=e,h={},d={};for(let p of Object.keys(r)){let{node:w,type:g,isArray:m}=r[p];switch(g){case"Radix":h[p]={type:"Radix",node:ar.fromJSON(w),isArray:m};break;case"Flat":h[p]={type:"Flat",node:sr.fromJSON(w),isArray:m};break;case"AVL":h[p]={type:"AVL",node:or.fromJSON(w),isArray:m};break;case"BKD":h[p]={type:"BKD",node:fr.fromJSON(w),isArray:m};break;case"Bool":h[p]={type:"Bool",node:lr.fromJSON(w),isArray:m};break;default:h[p]=r[p]}}for(let p of Object.keys(n))d[p]={type:"Vector",isArray:!1,node:cr.fromJSON(n[p])};return{sharedInternalDocumentStore:t,indexes:h,vectorIndexes:d,searchableProperties:o,searchablePropertiesWithTypes:i,frequencies:s,tokenOccurrences:a,avgFieldLength:l,fieldLengths:u}}function va(t){let{indexes:e,vectorIndexes:r,searchableProperties:n,searchablePropertiesWithTypes:o,frequencies:i,tokenOccurrences:s,avgFieldLength:a,fieldLengths:l}=t,u={};for(let d of Object.keys(r))u[d]=r[d].node.toJSON();let h={};for(let d of Object.keys(e)){let{type:p,node:w,isArray:g}=e[d];p==="Flat"||p==="Radix"||p==="AVL"||p==="BKD"||p==="Bool"?h[d]={type:p,node:w.toJSON(),isArray:g}:(h[d]=e[d],h[d].node=h[d].node.toJSON())}return{indexes:h,vectorIndexes:u,searchableProperties:n,searchablePropertiesWithTypes:o,frequencies:i,tokenOccurrences:s,avgFieldLength:a,fieldLengths:l}}function Qn(){return{create:Xn,insert:ha,remove:ya,insertDocumentScoreParameters:la,insertTokenScoreParameters:ca,removeDocumentScoreParameters:ua,removeTokenScoreParameters:da,calculateResultScores:Zn,search:ga,searchByWhereClause:wa,getSearchableProperties:ba,getSearchablePropertiesWithTypes:ma,load:Sa,save:va}}function fa(t,e){t||(t=new Set);let r=e.length;for(let n=0;n<r;n++){let o=e[n].docIDs,i=o.length;for(let s=0;s<i;s++)t.add(o[s])}return t}function Kc(t,e){t||(t=new Set);let r=Object.keys(e),n=r.length;for(let o=0;o<n;o++){let i=e[r[o]],s=i.length;for(let a=0;a<s;a++)t.add(i[a])}return t}var Hr={};gt(Hr,{createSorter:()=>ti,load:()=>xa,save:()=>Aa});function Ea(t,e,r,n,o){let i={language:t.tokenizer.language,sharedInternalDocumentStore:e,enabled:!0,isSorted:!0,sortableProperties:[],sortablePropertiesWithTypes:{},sorts:{}};for(let[s,a]of Object.entries(r)){let l=`${o}${o?".":""}${s}`;if(!n.includes(l)){if(typeof a=="object"&&!Array.isArray(a)){let u=Ea(t,e,a,n,l);kt(i.sortableProperties,u.sortableProperties),i.sorts=Ee(Ee({},i.sorts),u.sorts),i.sortablePropertiesWithTypes=Ee(Ee({},i.sortablePropertiesWithTypes),u.sortablePropertiesWithTypes);continue}if(!ot(a))switch(a){case"boolean":case"number":case"string":i.sortableProperties.push(l),i.sortablePropertiesWithTypes[l]=a,i.sorts[l]={docs:new Map,orderedDocsToRemove:new Map,orderedDocs:[],type:a};break;case"geopoint":case"enum":continue;case"enum[]":case"boolean[]":case"number[]":case"string[]":continue;default:throw me("INVALID_SORT_SCHEMA_TYPE",Array.isArray(a)?"array":a,l)}}}return i}function Jc(t,e,r,n){return(n==null?void 0:n.enabled)!==!1?Ea(t,e,r,(n||{}).unsortableProperties||[],""):{disabled:!0}}function Xc(t,e,r,n){if(!t.enabled)return;t.isSorted=!1;let o=Pe(t.sharedInternalDocumentStore,r),i=t.sorts[e];i.orderedDocsToRemove.has(o)&&ei(t,e),i.docs.set(o,i.orderedDocs.length),i.orderedDocs.push([o,n])}function _a(t){if(t.isSorted||!t.enabled)return;let e=Object.keys(t.sorts);for(let r of e)tu(t,r);t.isSorted=!0}function Zc(t,e,r){return e[1].localeCompare(r[1],Ps(t))}function Qc(t,e){return t[1]-e[1]}function eu(t,e){return e[1]?-1:1}function tu(t,e){let r=t.sorts[e],n;switch(r.type){case"string":n=Zc.bind(null,t.language);break;case"number":n=Qc.bind(null);break;case"boolean":n=eu.bind(null);break}r.orderedDocs.sort(n);let o=r.orderedDocs.length;for(let i=0;i<o;i++){let s=r.orderedDocs[i][0];r.docs.set(s,i)}}function ru(t){let e=Object.keys(t.sorts);for(let r of e)ei(t,r)}function ei(t,e){let r=t.sorts[e];r.orderedDocsToRemove.size&&(r.orderedDocs=r.orderedDocs.filter(n=>!r.orderedDocsToRemove.has(n[0])),r.orderedDocsToRemove.clear())}function nu(t,e,r){if(!t.enabled)return;let n=t.sorts[e],o=Pe(t.sharedInternalDocumentStore,r);n.docs.get(o)&&(n.docs.delete(o),n.orderedDocsToRemove.set(o,!0))}function iu(t,e,r){if(!t.enabled)throw me("SORT_DISABLED");let n=r.property,o=r.order==="DESC",i=t.sorts[n];if(!i)throw me("UNABLE_TO_SORT_ON_UNKNOWN_FIELD",n,t.sortableProperties.join(", "));return ei(t,n),_a(t),e.sort((s,a)=>{let l=i.docs.get(Pe(t.sharedInternalDocumentStore,s[0])),u=i.docs.get(Pe(t.sharedInternalDocumentStore,a[0])),h=typeof l!="undefined",d=typeof u!="undefined";return!h&&!d?0:h?d?o?u-l:l-u:-1:1}),e}function ou(t){return t.enabled?t.sortableProperties:[]}function su(t){return t.enabled?t.sortablePropertiesWithTypes:{}}function xa(t,e){let r=e;if(!r.enabled)return{enabled:!1};let n=Object.keys(r.sorts).reduce((o,i)=>{let{docs:s,orderedDocs:a,type:l}=r.sorts[i];return o[i]={docs:new Map(Object.entries(s).map(([u,h])=>[+u,h])),orderedDocsToRemove:new Map,orderedDocs:a,type:l},o},{});return{sharedInternalDocumentStore:t,language:r.language,sortableProperties:r.sortableProperties,sortablePropertiesWithTypes:r.sortablePropertiesWithTypes,sorts:n,enabled:!0,isSorted:r.isSorted}}function Aa(t){if(!t.enabled)return{enabled:!1};ru(t),_a(t);let e=Object.keys(t.sorts).reduce((r,n)=>{let{docs:o,orderedDocs:i,type:s}=t.sorts[n];return r[n]={docs:Object.fromEntries(o.entries()),orderedDocs:i,type:s},r},{});return{language:t.language,sortableProperties:t.sortableProperties,sortablePropertiesWithTypes:t.sortablePropertiesWithTypes,sorts:e,enabled:t.enabled,isSorted:t.isSorted}}function ti(){return{create:Jc,insert:Xc,remove:nu,save:Aa,load:xa,sortBy:iu,getSortableProperties:ou,getSortablePropertiesWithTypes:su}}var Jr={};gt(Jr,{createTokenizer:()=>Kr,normalizeToken:()=>dr});var au=[65,65,65,65,65,65,65,67,69,69,69,69,73,73,73,73,69,78,79,79,79,79,79,null,79,85,85,85,85,89,80,115,97,97,97,97,97,97,97,99,101,101,101,101,105,105,105,105,101,110,111,111,111,111,111,null,111,117,117,117,117,121,112,121,65,97,65,97,65,97,67,99,67,99,67,99,67,99,68,100,68,100,69,101,69,101,69,101,69,101,69,101,71,103,71,103,71,103,71,103,72,104,72,104,73,105,73,105,73,105,73,105,73,105,73,105,74,106,75,107,107,76,108,76,108,76,108,76,108,76,108,78,110,78,110,78,110,110,78,110,79,111,79,111,79,111,79,111,82,114,82,114,82,114,83,115,83,115,83,115,83,115,84,116,84,116,84,116,85,117,85,117,85,117,85,117,85,117,85,117,87,119,89,121,89,90,122,90,122,90,122,115];function fu(t){return t<192||t>383?t:au[t-192]||t}function Ia(t){let e=[];for(let r=0;r<t.length;r++)e[r]=fu(t.charCodeAt(r));return String.fromCharCode(...e)}var lu={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},cu={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},uu="[^aeiou]",qr="[aeiouy]",st=uu+"[^aeiouy]*",ur=qr+"[aeiou]*",ri="^("+st+")?"+ur+st,du="^("+st+")?"+ur+st+"("+ur+")?$",Yr="^("+st+")?"+ur+st+ur+st,Ta="^("+st+")?"+qr;function Ra(t){var l,u;let e,r,n,o,i,s;if(t.length<3)return t;let a=t.substring(0,1);if(a=="y"&&(t=a.toUpperCase()+t.substring(1)),n=/^(.+?)(ss|i)es$/,o=/^(.+?)([^s])s$/,n.test(t)?t=t.replace(n,"$1$2"):o.test(t)&&(t=t.replace(o,"$1$2")),n=/^(.+?)eed$/,o=/^(.+?)(ed|ing)$/,n.test(t)){let h=n.exec(t);n=new RegExp(ri),n.test(h[1])&&(n=/.$/,t=t.replace(n,""))}else o.test(t)&&(e=o.exec(t)[1],o=new RegExp(Ta),o.test(e)&&(t=e,o=/(at|bl|iz)$/,i=new RegExp("([^aeiouylsz])\\\\1$"),s=new RegExp("^"+st+qr+"[^aeiouwxy]$"),o.test(t)?t=t+"e":i.test(t)?(n=/.$/,t=t.replace(n,"")):s.test(t)&&(t=t+"e")));if(n=/^(.+?)y$/,n.test(t)){let h=n.exec(t);e=h==null?void 0:h[1],n=new RegExp(Ta),e&&n.test(e)&&(t=e+"i")}if(n=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,n.test(t)){let h=n.exec(t);e=h==null?void 0:h[1],r=h==null?void 0:h[2],n=new RegExp(ri),e&&n.test(e)&&(t=e+lu[r])}if(n=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,n.test(t)){let h=n.exec(t);e=h==null?void 0:h[1],r=h==null?void 0:h[2],n=new RegExp(ri),e&&n.test(e)&&(t=e+cu[r])}if(n=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,o=/^(.+?)(s|t)(ion)$/,n.test(t)){let h=n.exec(t);e=h==null?void 0:h[1],n=new RegExp(Yr),e&&n.test(e)&&(t=e)}else if(o.test(t)){let h=o.exec(t);e=(u=(l=h==null?void 0:h[1])!=null?l:""+(h==null?void 0:h[2]))!=null?u:"",o=new RegExp(Yr),o.test(e)&&(t=e)}if(n=/^(.+?)e$/,n.test(t)){let h=n.exec(t);e=h==null?void 0:h[1],n=new RegExp(Yr),o=new RegExp(du),i=new RegExp("^"+st+qr+"[^aeiouwxy]$"),e&&(n.test(e)||o.test(e)&&!i.test(e))&&(t=e)}return n=/ll$/,o=new RegExp(Yr),n.test(t)&&o.test(t)&&(n=/.$/,t=t.replace(n,"")),a=="y"&&(t=a.toLowerCase()+t.substring(1)),t}function dr(t,e,r=!0){var o;let n=`${this.language}:${t}:${e}`;return r&&this.normalizationCache.has(n)?this.normalizationCache.get(n):(o=this.stopWords)!=null&&o.includes(e)?(r&&this.normalizationCache.set(n,""),""):(this.stemmer&&!this.stemmerSkipProperties.has(t)&&(e=this.stemmer(e)),e=Ia(e),r&&this.normalizationCache.set(n,e),e)}function hu(t){for(;t[t.length-1]==="";)t.pop();for(;t[0]==="";)t.shift();return t}function Oa(t,e,r,n=!0){if(e&&e!==this.language)throw me("LANGUAGE_NOT_SUPPORTED",e);if(typeof t!="string")return[t];let o=this.normalizeToken.bind(this,r!=null?r:""),i;if(r&&this.tokenizeSkipProperties.has(r))i=[o(t,n)];else{let a=Ns[this.language];i=t.toLowerCase().split(a).map(l=>o(l,n)).filter(Boolean)}let s=hu(i);return this.allowDuplicates?s:Array.from(new Set(s))}function Kr(t={}){if(!t.language)t.language="english";else if(!rr.includes(t.language))throw me("LANGUAGE_NOT_SUPPORTED",t.language);let e;if(t.stemming||t.stemmer&&!("stemming"in t))if(t.stemmer){if(typeof t.stemmer!="function")throw me("INVALID_STEMMER_FUNCTION_TYPE");e=t.stemmer}else if(t.language==="english")e=Ra;else throw me("MISSING_STEMMER",t.language);let r;if(t.stopWords!==!1){if(r=[],Array.isArray(t.stopWords))r=t.stopWords;else if(typeof t.stopWords=="function")r=t.stopWords(r);else if(t.stopWords)throw me("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY");if(!Array.isArray(r))throw me("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY");for(let o of r)if(typeof o!="string")throw me("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY")}let n={tokenize:Oa,language:t.language,stemmer:e,stemmerSkipProperties:new Set(t.stemmerSkipProperties?[t.stemmerSkipProperties].flat():[]),tokenizeSkipProperties:new Set(t.tokenizeSkipProperties?[t.tokenizeSkipProperties].flat():[]),stopWords:r,allowDuplicates:!!t.allowDuplicates,normalizeToken:dr,normalizationCache:new Map};return n.tokenize=Oa.bind(n),n.normalizeToken=dr,n}function pu(t){let e={formatElapsedTime:Vn,getDocumentIndexId:Gn,getDocumentProperties:nr,validateSchema:Cr};for(let r of Kn){let n=r;if(t[n]){if(typeof t[n]!="function")throw me("COMPONENT_MUST_BE_FUNCTION",n)}else t[n]=e[n]}for(let r of Object.keys(t))if(!ta.includes(r)&&!Kn.includes(r))throw me("UNSUPPORTED_COMPONENT",r)}function hr({schema:t,sort:e,language:r,components:n,id:o,plugins:i}){var S;n||(n={});for(let b of i!=null?i:[]){if(!("getComponents"in b)||typeof b.getComponents!="function")continue;let E=b.getComponents(t),A=Object.keys(E);for(let x of A)if(n[x])throw me("PLUGIN_COMPONENT_CONFLICT",x,b.name);n=Ee(Ee({},n),E)}o||(o=Lt());let s=n.tokenizer,a=n.index,l=n.documentsStore,u=n.sorter;if(s?s.tokenize?s=s:s=Kr(s):s=Kr({language:r!=null?r:"english"}),n.tokenizer&&r)throw me("NO_LANGUAGE_WITH_CUSTOM_TOKENIZER");let h=Yn();a||(a=Qn()),u||(u=ti()),l||(l=qn()),pu(n);let{getDocumentProperties:d,getDocumentIndexId:p,validateSchema:w,formatElapsedTime:g}=n,m={data:{},caches:{},schema:t,tokenizer:s,index:a,sorter:u,documentsStore:l,internalDocumentIDStore:h,getDocumentProperties:d,getDocumentIndexId:p,validateSchema:w,beforeInsert:[],afterInsert:[],beforeRemove:[],afterRemove:[],beforeUpdate:[],afterUpdate:[],beforeSearch:[],afterSearch:[],beforeInsertMultiple:[],afterInsertMultiple:[],beforeRemoveMultiple:[],afterRemoveMultiple:[],afterUpdateMultiple:[],beforeUpdateMultiple:[],afterCreate:[],formatElapsedTime:g,id:o,plugins:i,version:yu()};m.data={index:m.index.create(m,h,t),docs:m.documentsStore.create(m,h),sorting:m.sorter.create(m,h,t,e)};for(let b of Qs)m[b]=((S=m[b])!=null?S:[]).concat(ea(m,b));let y=m.afterCreate;return y&&ra(y,m),m}function yu(){return"{{VERSION}}"}function pr(t){return t.documentsStore.count(t.data.docs)}var ni={};gt(ni,{documentsStore:()=>Wr,formatElapsedTime:()=>Vn,getDocumentIndexId:()=>Gn,getDocumentProperties:()=>nr,getInnerType:()=>Fr,getVectorSize:()=>$r,index:()=>Gr,internalDocumentIDStore:()=>zr,isArrayType:()=>Tt,isGeoPointType:()=>Hn,isVectorType:()=>ot,sorter:()=>Hr,tokenizer:()=>Jr,validateSchema:()=>Cr});var Xr="fulltext",ii="hybrid",oi="vector";var bt=Symbol("orama.insertions"),mt=Symbol("orama.removals");var Da,Na,Pa=(Na=(Da=globalThis.process)==null?void 0:Da.emitWarning)!=null?Na:function(e,r){console.warn(`[WARNING] [${r.code}] ${e}`)};function si(t){typeof t[bt]!="number"&&(queueMicrotask(()=>{t[bt]=void 0}),t[bt]=0),t[bt]>1e3?(Pa("Orama\'s insert operation is synchronous. Please avoid inserting a large number of document in a single operation in order not to block the main thread or, in alternative, please use insertMultiple.",{code:"ORAMA0001"}),t[bt]=-1):t[bt]>=0&&t[bt]++}function ai(t){typeof t[mt]!="number"&&(queueMicrotask(()=>{t[mt]=void 0}),t[mt]=0),t[mt]>1e3?(Pa("Orama\'s remove operation is synchronous. Please avoid removing a large number of document in a single operation in order not to block the main thread, in alternative, please use updateMultiple.",{code:"ORAMA0002"}),t[mt]=-1):t[mt]>=0&&t[mt]++}function zt(t,e,r,n,o){let i=t.validateSchema(e,t.schema);if(i)throw me("SCHEMA_VALIDATION_FAILURE",i);return Me(t.beforeInsert)||Me(t.afterInsert)||Me(t.index.beforeInsert)||Me(t.index.insert)||Me(t.index.afterInsert)?bu(t,e,r,n,o):mu(t,e,r,n,o)}var gu=new Set(["enum","enum[]"]),wu=new Set(["string","number"]);async function bu(t,e,r,n,o){let{index:i,docs:s}=t.data,a=t.getDocumentIndexId(e);if(typeof a!="string")throw me("DOCUMENT_ID_MUST_BE_STRING",typeof a);let l=Pe(t.internalDocumentIDStore,a);if(!t.documentsStore.store(s,a,l,e))throw me("DOCUMENT_ALREADY_EXISTS",a);let u=t.documentsStore.count(s);n||await Qe(t.beforeInsert,t,a,e);let h=t.index.getSearchableProperties(i),d=t.index.getSearchablePropertiesWithTypes(i),p=t.getDocumentProperties(e,h);for(let[w,g]of Object.entries(p)){if(typeof g=="undefined")continue;let m=typeof g,y=d[w];Ua(m,y,w,g)}return await Su(t,a,h,p,u,r,e,o),n||await Qe(t.afterInsert,t,a,e),si(t),a}function mu(t,e,r,n,o){let{index:i,docs:s}=t.data,a=t.getDocumentIndexId(e);if(typeof a!="string")throw me("DOCUMENT_ID_MUST_BE_STRING",typeof a);let l=Pe(t.internalDocumentIDStore,a);if(!t.documentsStore.store(s,a,l,e))throw me("DOCUMENT_ALREADY_EXISTS",a);let u=t.documentsStore.count(s);n||Qe(t.beforeInsert,t,a,e);let h=t.index.getSearchableProperties(i),d=t.index.getSearchablePropertiesWithTypes(i),p=t.getDocumentProperties(e,h);for(let[w,g]of Object.entries(p)){if(typeof g=="undefined")continue;let m=typeof g,y=d[w];Ua(m,y,w,g)}return vu(t,a,h,p,u,r,e,o),n||Qe(t.afterInsert,t,a,e),si(t),a}function Ua(t,e,r,n){if(!(Hn(e)&&typeof n=="object"&&typeof n.lon=="number"&&typeof n.lat=="number")&&!(ot(e)&&Array.isArray(n))&&!(Tt(e)&&Array.isArray(n))&&!(gu.has(e)&&wu.has(t))&&t!==e)throw me("INVALID_DOCUMENT_PROPERTY",r,e,t)}async function Su(t,e,r,n,o,i,s,a){var h,d,p,w;for(let g of r){let m=n[g];if(typeof m=="undefined")continue;let y=t.index.getSearchablePropertiesWithTypes(t.data.index)[g];await((d=(h=t.index).beforeInsert)==null?void 0:d.call(h,t.data.index,g,e,m,y,i,t.tokenizer,o));let S=t.internalDocumentIDStore.idToInternalId.get(e);await t.index.insert(t.index,t.data.index,g,e,S,m,y,i,t.tokenizer,o,a),await((w=(p=t.index).afterInsert)==null?void 0:w.call(p,t.data.index,g,e,m,y,i,t.tokenizer,o))}let l=t.sorter.getSortableProperties(t.data.sorting),u=t.getDocumentProperties(s,l);for(let g of l){let m=u[g];if(typeof m=="undefined")continue;let y=t.sorter.getSortablePropertiesWithTypes(t.data.sorting)[g];t.sorter.insert(t.data.sorting,g,e,m,y,i)}}function vu(t,e,r,n,o,i,s,a){var h,d,p,w;for(let g of r){let m=n[g];if(typeof m=="undefined")continue;let y=t.index.getSearchablePropertiesWithTypes(t.data.index)[g],S=Pe(t.internalDocumentIDStore,e);(d=(h=t.index).beforeInsert)==null||d.call(h,t.data.index,g,e,m,y,i,t.tokenizer,o),t.index.insert(t.index,t.data.index,g,e,S,m,y,i,t.tokenizer,o,a),(w=(p=t.index).afterInsert)==null||w.call(p,t.data.index,g,e,m,y,i,t.tokenizer,o)}let l=t.sorter.getSortableProperties(t.data.sorting),u=t.getDocumentProperties(s,l);for(let g of l){let m=u[g];if(typeof m=="undefined")continue;let y=t.sorter.getSortablePropertiesWithTypes(t.data.sorting)[g];t.sorter.insert(t.data.sorting,g,e,m,y,i)}}function fi(t,e,r,n,o,i){return Me(t.afterInsertMultiple)||Me(t.beforeInsertMultiple)||Me(t.index.beforeInsert)||Me(t.index.insert)||Me(t.index.afterInsert)?Eu(t,e,r,n,o,i):_u(t,e,r,n,o,i)}async function Eu(t,e,r=1e3,n,o,i=0){let s=[],a=async u=>{let h=Math.min(u+r,e.length),d=e.slice(u,h);for(let p of d){let w={avlRebalanceThreshold:d.length},g=await zt(t,p,n,o,w);s.push(g)}return h};return await(async()=>{let u=0;for(;u<e.length;){let h=Date.now();if(u=await a(u),i>0){let d=Date.now()-h,p=i-d;p>0&&jn(p)}}})(),o||await ir(t.afterInsertMultiple,t,e),s}function _u(t,e,r=1e3,n,o,i=0){let s=[],a=0;function l(){let h=e.slice(a*r,(a+1)*r);if(h.length===0)return!1;for(let d of h){let p={avlRebalanceThreshold:h.length},w=zt(t,d,n,o,p);s.push(w)}return a++,!0}function u(){let h=Date.now();for(;l();)if(i>0){let p=Date.now()-h;if(p>=i){let w=i-p%i;w>0&&jn(w)}}}return u(),o||ir(t.afterInsertMultiple,t,e),s}function Zr(t,e,r,n){return Me(t.index.beforeRemove)||Me(t.index.remove)||Me(t.index.afterRemove)?xu(t,e,r,n):Au(t,e,r,n)}async function xu(t,e,r,n){var y,S,b,E;let o=!0,{index:i,docs:s}=t.data,a=t.documentsStore.get(s,e);if(!a)return!1;let l=Pe(t.internalDocumentIDStore,e),u=Ze(t.internalDocumentIDStore,l),h=t.documentsStore.count(s);n||await Qe(t.beforeRemove,t,u);let d=t.index.getSearchableProperties(i),p=t.index.getSearchablePropertiesWithTypes(i),w=t.getDocumentProperties(a,d);for(let A of d){let x=w[A];if(typeof x=="undefined")continue;let z=p[A];await((S=(y=t.index).beforeRemove)==null?void 0:S.call(y,t.data.index,A,u,x,z,r,t.tokenizer,h)),await t.index.remove(t.index,t.data.index,A,e,l,x,z,r,t.tokenizer,h)||(o=!1),await((E=(b=t.index).afterRemove)==null?void 0:E.call(b,t.data.index,A,u,x,z,r,t.tokenizer,h))}let g=await t.sorter.getSortableProperties(t.data.sorting),m=await t.getDocumentProperties(a,g);for(let A of g)typeof m[A]!="undefined"&&t.sorter.remove(t.data.sorting,A,e);return n||await Qe(t.afterRemove,t,u),t.documentsStore.remove(t.data.docs,e,l),ai(t),o}function Au(t,e,r,n){var y,S,b,E;let o=!0,{index:i,docs:s}=t.data,a=t.documentsStore.get(s,e);if(!a)return!1;let l=Pe(t.internalDocumentIDStore,e),u=Ze(t.internalDocumentIDStore,l),h=t.documentsStore.count(s);n||Qe(t.beforeRemove,t,u);let d=t.index.getSearchableProperties(i),p=t.index.getSearchablePropertiesWithTypes(i),w=t.getDocumentProperties(a,d);for(let A of d){let x=w[A];if(typeof x=="undefined")continue;let z=p[A];(S=(y=t.index).beforeRemove)==null||S.call(y,t.data.index,A,u,x,z,r,t.tokenizer,h),t.index.remove(t.index,t.data.index,A,e,l,x,z,r,t.tokenizer,h)||(o=!1),(E=(b=t.index).afterRemove)==null||E.call(b,t.data.index,A,u,x,z,r,t.tokenizer,h)}let g=t.sorter.getSortableProperties(t.data.sorting),m=t.getDocumentProperties(a,g);for(let A of g)typeof m[A]!="undefined"&&t.sorter.remove(t.data.sorting,A,e);return n||Qe(t.afterRemove,t,u),t.documentsStore.remove(t.data.docs,e,l),ai(t),o}function Iu(t,e){return t[1]-e[1]}function Tu(t,e){return e[1]-t[1]}function Ru(t="desc"){return t.toLowerCase()==="asc"?Iu:Tu}function Wt(t,e,r){var u,h;let n={},o=e.map(([d])=>d),i=t.documentsStore.getMultiple(t.data.docs,o),s=Object.keys(r),a=t.index.getSearchablePropertiesWithTypes(t.data.index);for(let d of s){let p;if(a[d]==="number"){let{ranges:w}=r[d],g=w.length,m=Array.from({length:g});for(let y=0;y<g;y++){let S=w[y];m[y]=[`${S.from}-${S.to}`,0]}p=Object.fromEntries(m)}n[d]={count:0,values:p!=null?p:{}}}let l=i.length;for(let d=0;d<l;d++){let p=i[d];for(let w of s){let g=w.includes(".")?Ct(p,w):p[w],m=a[w],y=n[w].values;switch(m){case"number":{let S=r[w].ranges;Ma(S,y)(g);break}case"number[]":{let S=new Set,b=r[w].ranges,E=Ma(b,y,S);for(let A of g)E(A);break}case"boolean":case"enum":case"string":{Ba(y,m)(g);break}case"boolean[]":case"enum[]":case"string[]":{let E=Ba(y,m==="boolean[]"?"boolean":"string",new Set);for(let A of g)E(A);break}default:throw me("FACET_NOT_SUPPORTED",m)}}}for(let d of s){let p=n[d];if(p.count=Object.keys(p.values).length,a[d]==="string"){let w=r[d],g=Ru(w.sort);p.values=Object.fromEntries(Object.entries(p.values).sort(g).slice((u=w.offset)!=null?u:0,(h=w.limit)!=null?h:10))}}return n}function Ma(t,e,r){return n=>{for(let o of t){let i=`${o.from}-${o.to}`;r!=null&&r.has(i)||n>=o.from&&n<=o.to&&(e[i]===void 0?e[i]=1:(e[i]++,r==null||r.add(i)))}}}function Ba(t,e,r){let n=e==="boolean"?"false":"";return o=>{var s,a;let i=(s=o==null?void 0:o.toString())!=null?s:n;r!=null&&r.has(i)||(t[i]=((a=t[i])!=null?a:0)+1,r==null||r.add(i))}}var Ou={reducer:(t,e,r,n)=>(e[n]=r,e),getInitialValue:t=>Array.from({length:t})},ka=["string","number","boolean"];function jt(t,e,r){var S;let n=r.properties,o=n.length,i=t.index.getSearchablePropertiesWithTypes(t.data.index);for(let b=0;b<o;b++){let E=n[b];if(typeof i[E]=="undefined")throw me("UNKNOWN_GROUP_BY_PROPERTY",E);if(!ka.includes(i[E]))throw me("INVALID_GROUP_BY_PROPERTY",E,ka.join(", "),i[E])}let s=e.map(([b])=>Ze(t.internalDocumentIDStore,b)),a=t.documentsStore.getMultiple(t.data.docs,s),l=a.length,u=r.maxResult||Number.MAX_SAFE_INTEGER,h=[],d={};for(let b=0;b<o;b++){let E=n[b],A={property:E,perValue:{}},x=new Set;for(let z=0;z<l;z++){let G=a[z],L=Ct(G,E);if(typeof L=="undefined")continue;let ie=typeof L!="boolean"?L:""+L,N=(S=A.perValue[ie])!=null?S:{indexes:[],count:0};N.count>=u||(N.indexes.push(z),N.count++,A.perValue[ie]=N,x.add(L))}h.push(Array.from(x)),d[E]=A}let p=La(h),w=p.length,g=[];for(let b=0;b<w;b++){let E=p[b],A=E.length,x={values:[],indexes:[]},z=[];for(let G=0;G<A;G++){let L=E[G],ie=n[G];z.push(d[ie].perValue[typeof L!="boolean"?L:""+L].indexes),x.values.push(L)}x.indexes=zs(z).sort((G,L)=>G-L),x.indexes.length!==0&&g.push(x)}let m=g.length,y=Array.from({length:m});for(let b=0;b<m;b++){let E=g[b],A=r.reduce||Ou,x=E.indexes.map(ie=>({id:s[ie],score:e[ie][1],document:a[ie]})),z=A.reducer.bind(null,E.values),G=A.getInitialValue(E.indexes.length),L=x.reduce(z,G);y[b]={values:E.values,result:L}}return y}function La(t,e=0){if(e+1===t.length)return t[e].map(i=>[i]);let r=t[e],n=La(t,e+1),o=[];for(let i of r)for(let s of n){let a=[i];kt(a,s),o.push(a)}return o}function ci(t,e,r){var h;let{term:n,properties:o}=e,i=t.data.index,s=t.caches.propertiesToSearch;if(!s){let d=t.index.getSearchablePropertiesWithTypes(i);s=t.index.getSearchableProperties(i),s=s.filter(p=>d[p].startsWith("string")),t.caches.propertiesToSearch=s}if(o&&o!=="*"){for(let d of o)if(!s.includes(d))throw me("UNKNOWN_INDEX",d,s.join(", "));s=s.filter(d=>o.includes(d))}let a=Object.keys((h=e.where)!=null?h:{}).length>0,l;a&&(l=t.index.searchByWhereClause(i,t.tokenizer,e.where,r));let u;if(n||o){let d=pr(t);u=t.index.search(i,n||"",t.tokenizer,r,s,e.exact||!1,e.tolerance||0,e.boost||{},Du(e.relevance),d,l,e.threshold!==void 0&&e.threshold!==null?e.threshold:1)}else u=(l?Array.from(l):Object.keys(t.documentsStore.getAll(t.data.docs))).map(p=>[+p,0]);return u}function Ca(t,e,r){var a,l;let n=Xe();function o(){let u=Object.keys(t.data.index.vectorIndexes),h=e.facets&&Object.keys(e.facets).length>0,{limit:d=10,offset:p=0,distinctOn:w,includeVectors:g=!1}=e,m=e.preflight===!0,y=ci(t,e,r);if(e.sortBy)if(typeof e.sortBy=="function"){let E=y.map(([z])=>z),x=t.documentsStore.getMultiple(t.data.docs,E).map((z,G)=>[y[G][0],y[G][1],z]);x.sort(e.sortBy),y=x.map(([z,G])=>[z,G])}else y=t.sorter.sortBy(t.data.sorting,y,e.sortBy).map(([E,A])=>[Pe(t.internalDocumentIDStore,E),A]);else y=y.sort(Mr);let S;m||(S=w?Fa(t,y,p,d,w):Qr(t,y,p,d));let b={elapsed:{formatted:"",raw:0},hits:[],count:y.length};if(typeof S!="undefined"&&(b.hits=S.filter(Boolean),g||kr(b,u)),h){let E=Wt(t,y,e.facets);b.facets=E}return e.groupBy&&(b.groups=jt(t,y,e.groupBy)),b.elapsed=t.formatElapsedTime(Xe()-n),b}async function i(){t.beforeSearch&&await $t(t.beforeSearch,t,e,r);let u=o();return t.afterSearch&&await Ft(t.afterSearch,t,e,r,u),u}return((a=t.beforeSearch)==null?void 0:a.length)||((l=t.afterSearch)==null?void 0:l.length)?i():o()}var li={k:1.2,b:.75,d:.5};function Du(t){var r,n,o;let e=t!=null?t:{};return e.k=(r=e.k)!=null?r:li.k,e.b=(n=e.b)!=null?n:li.b,e.d=(o=e.d)!=null?o:li.d,e}function ui(t,e,r){var u,h;let n=e.vector;if(n&&(!("value"in n)||!("property"in n)))throw me("INVALID_VECTOR_INPUT",Object.keys(n).join(", "));let o=t.data.index.vectorIndexes[n.property],i=o.node.size;if((n==null?void 0:n.value.length)!==i)throw(n==null?void 0:n.property)===void 0||(n==null?void 0:n.value.length)===void 0?me("INVALID_INPUT_VECTOR","undefined",i,"undefined"):me("INVALID_INPUT_VECTOR",n.property,i,n.value.length);let s=t.data.index,a;return Object.keys((u=e.where)!=null?u:{}).length>0&&(a=t.index.searchByWhereClause(s,t.tokenizer,e.where,r)),o.node.find(n.value,(h=e.similarity)!=null?h:.8,a)}function di(t,e,r="english"){var a,l;let n=Xe();function o(){var A,x,z;let u=ui(t,e,r).sort(Mr),h=[];e.facets&&Object.keys(e.facets).length>0&&(h=Wt(t,u,e.facets));let p=e.vector.property,w=(A=e.includeVectors)!=null?A:!1,g=(x=e.limit)!=null?x:10,m=(z=e.offset)!=null?z:0,y=Array.from({length:g});for(let G=0;G<g;G++){let L=u[G+m];if(!L)break;let ie=t.data.docs.docs[L[0]];if(ie){w||(ie[p]=null);let N={id:Ze(t.internalDocumentIDStore,L[0]),score:L[1],document:ie};y[G]=N}}let S=[];e.groupBy&&(S=jt(t,u,e.groupBy));let E=Xe()-n;return Ee(Ee({count:u.length,hits:y.filter(Boolean),elapsed:{raw:Number(E),formatted:wt(E)}},h?{facets:h}:{}),S?{groups:S}:{})}async function i(){t.beforeSearch&&await $t(t.beforeSearch,t,e,r);let u=o();return t.afterSearch&&await Ft(t.afterSearch,t,e,r,u),u}return((a=t.beforeSearch)==null?void 0:a.length)||((l=t.afterSearch)==null?void 0:l.length)?i():o()}function Pu(t,e,r){var s;let n=Uu(ci(t,e,r)),o=ui(t,e,r),i=e.hybridWeights;return Bu(n,o,(s=e.term)!=null?s:"",i)}function za(t,e,r){var a,l;let n=Xe();function o(){var E,A,x;let u=Pu(t,e,r),h;e.facets&&Object.keys(e.facets).length>0&&(h=Wt(t,u,e.facets));let p;e.groupBy&&(p=jt(t,u,e.groupBy));let w=(E=e.offset)!=null?E:0,g=(A=e.limit)!=null?A:10,m=Qr(t,u,w,g).filter(Boolean),y=Xe(),S=Ee(Ee({count:u.length,elapsed:{raw:Number(y-n),formatted:wt(y-n)},hits:m},h?{facets:h}:{}),p?{groups:p}:{});if(!((x=e.includeVectors)!=null?x:!1)){let z=Object.keys(t.data.index.vectorIndexes);kr(S,z)}return S}async function i(){t.beforeSearch&&await $t(t.beforeSearch,t,e,r);let u=o();return t.afterSearch&&await Ft(t.afterSearch,t,e,r,u),u}return((a=t.beforeSearch)==null?void 0:a.length)||((l=t.afterSearch)==null?void 0:l.length)?i():o()}function hi(t){return t[1]}function Uu(t){let e=Math.max.apply(Math,t.map(hi));return t.map(([r,n])=>[r,n/e])}function $a(t,e){return t/e}function Mu(t,e){return(r,n)=>r*t+n*e}function Bu(t,e,r,n){var w;let o=Math.max.apply(Math,t.map(hi)),i=Math.max.apply(Math,e.map(hi)),s=n&&n.text&&n.vector,{text:a,vector:l}=s?n:ku(r),u=new Map,h=t.length,d=Mu(a,l);for(let g=0;g<h;g++){let[m,y]=t[g],S=$a(y,o),b=d(S,0);u.set(m,b)}let p=e.length;for(let g=0;g<p;g++){let[m,y]=e[g],S=$a(y,i),b=(w=u.get(m))!=null?w:0;u.set(m,b+d(0,S))}return[...u].sort((g,m)=>m[1]-g[1])}function ku(t){return{text:.5,vector:.5}}function yr(t,e,r){var o;let n=(o=e.mode)!=null?o:Xr;if(n===Xr)return Ca(t,e,r);if(n===oi)return di(t,e);if(n===ii)return za(t,e);throw me("INVALID_SEARCH_MODE",n)}function Fa(t,e,r,n,o){let i=t.data.docs,s=new Map,a=[],l=new Set,u=e.length,h=0;for(let d=0;d<u;d++){let p=e[d];if(typeof p=="undefined")continue;let[w,g]=p;if(l.has(w))continue;let m=t.documentsStore.get(i,w),y=Ct(m,o);if(!(typeof y=="undefined"||s.has(y))&&(s.set(y,!0),h++,!(h<=r)&&(a.push({id:Ze(t.internalDocumentIDStore,w),score:g,document:m}),l.add(w),h>=r+n)))break}return a}function Qr(t,e,r,n){let o=t.data.docs,i=Array.from({length:n}),s=new Set;for(let a=r;a<n+r;a++){let l=e[a];if(typeof l=="undefined")break;let[u,h]=l;if(!s.has(u)){let d=t.documentsStore.get(o,u);i[a]={id:Ze(t.internalDocumentIDStore,u),score:h,document:d},s.add(u)}}return i}function pi(t,e){t.internalDocumentIDStore.load(t,e.internalDocumentIDStore),t.data.index=t.index.load(t.internalDocumentIDStore,e.index),t.data.docs=t.documentsStore.load(t.internalDocumentIDStore,e.docs),t.data.sorting=t.sorter.load(t.internalDocumentIDStore,e.sorting),t.tokenizer.language=e.language}function yi(t){return{internalDocumentIDStore:t.internalDocumentIDStore.save(t.internalDocumentIDStore),index:t.index.save(t.data.index),docs:t.documentsStore.save(t.data.docs),sorting:t.sorter.save(t.data.sorting),language:t.tokenizer.language}}var gi={};gt(gi,{boundedLevenshtein:()=>ia,convertDistanceToMeters:()=>Br,formatBytes:()=>$s,formatNanoseconds:()=>wt,getNanosecondsTime:()=>Xe,normalizeToken:()=>dr,safeArrayPush:()=>kt,setIntersection:()=>Lr,setUnion:()=>it,uniqueId:()=>Lt});var ct=4294967295;function Wa(t,e,r){var n=r/4294967296,o=r;t.setUint32(e,n),t.setUint32(e+4,o)}function en(t,e,r){var n=Math.floor(r/4294967296),o=r;t.setUint32(e,n),t.setUint32(e+4,o)}function tn(t,e){var r=t.getInt32(e),n=t.getUint32(e+4);return r*4294967296+n}function ja(t,e){var r=t.getUint32(e),n=t.getUint32(e+4);return r*4294967296+n}var wi,bi,mi,rn=(typeof process=="undefined"||((wi=process==null?void 0:process.env)===null||wi===void 0?void 0:wi.TEXT_ENCODING)!=="never")&&typeof TextEncoder!="undefined"&&typeof TextDecoder!="undefined";function Si(t){for(var e=t.length,r=0,n=0;n<e;){var o=t.charCodeAt(n++);if((o&4294967168)===0){r++;continue}else if((o&4294965248)===0)r+=2;else{if(o>=55296&&o<=56319&&n<e){var i=t.charCodeAt(n);(i&64512)===56320&&(++n,o=((o&1023)<<10)+(i&1023)+65536)}(o&4294901760)===0?r+=3:r+=4}}return r}function Va(t,e,r){for(var n=t.length,o=r,i=0;i<n;){var s=t.charCodeAt(i++);if((s&4294967168)===0){e[o++]=s;continue}else if((s&4294965248)===0)e[o++]=s>>6&31|192;else{if(s>=55296&&s<=56319&&i<n){var a=t.charCodeAt(i);(a&64512)===56320&&(++i,s=((s&1023)<<10)+(a&1023)+65536)}(s&4294901760)===0?(e[o++]=s>>12&15|224,e[o++]=s>>6&63|128):(e[o++]=s>>18&7|240,e[o++]=s>>12&63|128,e[o++]=s>>6&63|128)}e[o++]=s&63|128}}var gr=rn?new TextEncoder:void 0,Ga=rn?typeof process!="undefined"&&((bi=process==null?void 0:process.env)===null||bi===void 0?void 0:bi.TEXT_ENCODING)!=="force"?200:0:ct;function Cu(t,e,r){e.set(gr.encode(t),r)}function Fu(t,e,r){gr.encodeInto(t,e.subarray(r))}var Ha=gr!=null&&gr.encodeInto?Fu:Cu,$u=4096;function nn(t,e,r){for(var n=e,o=n+r,i=[],s="";n<o;){var a=t[n++];if((a&128)===0)i.push(a);else if((a&224)===192){var l=t[n++]&63;i.push((a&31)<<6|l)}else if((a&240)===224){var l=t[n++]&63,u=t[n++]&63;i.push((a&31)<<12|l<<6|u)}else if((a&248)===240){var l=t[n++]&63,u=t[n++]&63,h=t[n++]&63,d=(a&7)<<18|l<<12|u<<6|h;d>65535&&(d-=65536,i.push(d>>>10&1023|55296),d=56320|d&1023),i.push(d)}else i.push(a);i.length>=$u&&(s+=String.fromCharCode.apply(String,i),i.length=0)}return i.length>0&&(s+=String.fromCharCode.apply(String,i)),s}var zu=rn?new TextDecoder:null,Ya=rn?typeof process!="undefined"&&((mi=process==null?void 0:process.env)===null||mi===void 0?void 0:mi.TEXT_DECODER)!=="force"?200:0:ct;function qa(t,e,r){var n=t.subarray(e,e+r);return zu.decode(n)}var wr=function(){function t(e,r){this.type=e,this.data=r}return t}();var Wu=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Je=function(t){Wu(e,t);function e(r){var n=t.call(this,r)||this,o=Object.create(e.prototype);return Object.setPrototypeOf(n,o),Object.defineProperty(n,"name",{configurable:!0,enumerable:!1,value:e.name}),n}return e}(Error);var ju=-1,Vu=4294967296-1,Gu=17179869184-1;function Hu(t){var e=t.sec,r=t.nsec;if(e>=0&&r>=0&&e<=Gu)if(r===0&&e<=Vu){var n=new Uint8Array(4),o=new DataView(n.buffer);return o.setUint32(0,e),n}else{var i=e/4294967296,s=e&4294967295,n=new Uint8Array(8),o=new DataView(n.buffer);return o.setUint32(0,r<<2|i&3),o.setUint32(4,s),n}else{var n=new Uint8Array(12),o=new DataView(n.buffer);return o.setUint32(0,r),en(o,4,e),n}}function Yu(t){var e=t.getTime(),r=Math.floor(e/1e3),n=(e-r*1e3)*1e6,o=Math.floor(n/1e9);return{sec:r+o,nsec:n-o*1e9}}function qu(t){if(t instanceof Date){var e=Yu(t);return Hu(e)}else return null}function Ku(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:{var r=e.getUint32(0),n=0;return{sec:r,nsec:n}}case 8:{var o=e.getUint32(0),i=e.getUint32(4),r=(o&3)*4294967296+i,n=o>>>2;return{sec:r,nsec:n}}case 12:{var r=tn(e,4),n=e.getUint32(0);return{sec:r,nsec:n}}default:throw new Je("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(t.length))}}function Ju(t){var e=Ku(t);return new Date(e.sec*1e3+e.nsec/1e6)}var Ka={type:ju,encode:qu,decode:Ju};var on=function(){function t(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(Ka)}return t.prototype.register=function(e){var r=e.type,n=e.encode,o=e.decode;if(r>=0)this.encoders[r]=n,this.decoders[r]=o;else{var i=1+r;this.builtInEncoders[i]=n,this.builtInDecoders[i]=o}},t.prototype.tryToEncode=function(e,r){for(var n=0;n<this.builtInEncoders.length;n++){var o=this.builtInEncoders[n];if(o!=null){var i=o(e,r);if(i!=null){var s=-1-n;return new wr(s,i)}}}for(var n=0;n<this.encoders.length;n++){var o=this.encoders[n];if(o!=null){var i=o(e,r);if(i!=null){var s=n;return new wr(s,i)}}}return e instanceof wr?e:null},t.prototype.decode=function(e,r,n){var o=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return o?o(e,r,n):new wr(r,e)},t.defaultCodec=new t,t}();function Vt(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t instanceof ArrayBuffer?new Uint8Array(t):Uint8Array.from(t)}function Ja(t){if(t instanceof ArrayBuffer)return new DataView(t);var e=Vt(t);return new DataView(e.buffer,e.byteOffset,e.byteLength)}var Xu=100,Zu=2048,Xa=function(){function t(e,r,n,o,i,s,a,l){e===void 0&&(e=on.defaultCodec),r===void 0&&(r=void 0),n===void 0&&(n=Xu),o===void 0&&(o=Zu),i===void 0&&(i=!1),s===void 0&&(s=!1),a===void 0&&(a=!1),l===void 0&&(l=!1),this.extensionCodec=e,this.context=r,this.maxDepth=n,this.initialBufferSize=o,this.sortKeys=i,this.forceFloat32=s,this.ignoreUndefined=a,this.forceIntegerToFloat=l,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return t.prototype.reinitializeState=function(){this.pos=0},t.prototype.encodeSharedRef=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)},t.prototype.encode=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)},t.prototype.doEncode=function(e,r){if(r>this.maxDepth)throw new Error("Too deep objects in depth ".concat(r));e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.encodeObject(e,r)},t.prototype.ensureBufferSizeToWrite=function(e){var r=this.pos+e;this.view.byteLength<r&&this.resizeBuffer(r*2)},t.prototype.resizeBuffer=function(e){var r=new ArrayBuffer(e),n=new Uint8Array(r),o=new DataView(r);n.set(this.bytes),this.view=o,this.bytes=n},t.prototype.encodeNil=function(){this.writeU8(192)},t.prototype.encodeBoolean=function(e){e===!1?this.writeU8(194):this.writeU8(195)},t.prototype.encodeNumber=function(e){Number.isSafeInteger(e)&&!this.forceIntegerToFloat?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):(this.writeU8(211),this.writeI64(e)):this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))},t.prototype.writeStringHeader=function(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error("Too long string: ".concat(e," bytes in UTF-8"))},t.prototype.encodeString=function(e){var r=5,n=e.length;if(n>Ga){var o=Si(e);this.ensureBufferSizeToWrite(r+o),this.writeStringHeader(o),Ha(e,this.bytes,this.pos),this.pos+=o}else{var o=Si(e);this.ensureBufferSizeToWrite(r+o),this.writeStringHeader(o),Va(e,this.bytes,this.pos),this.pos+=o}},t.prototype.encodeObject=function(e,r){var n=this.extensionCodec.tryToEncode(e,this.context);if(n!=null)this.encodeExtension(n);else if(Array.isArray(e))this.encodeArray(e,r);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,r);else throw new Error("Unrecognized object: ".concat(Object.prototype.toString.apply(e)))},t.prototype.encodeBinary=function(e){var r=e.byteLength;if(r<256)this.writeU8(196),this.writeU8(r);else if(r<65536)this.writeU8(197),this.writeU16(r);else if(r<4294967296)this.writeU8(198),this.writeU32(r);else throw new Error("Too large binary: ".concat(r));var n=Vt(e);this.writeU8a(n)},t.prototype.encodeArray=function(e,r){var n=e.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else if(n<4294967296)this.writeU8(221),this.writeU32(n);else throw new Error("Too large array: ".concat(n));for(var o=0,i=e;o<i.length;o++){var s=i[o];this.doEncode(s,r+1)}},t.prototype.countWithoutUndefined=function(e,r){for(var n=0,o=0,i=r;o<i.length;o++){var s=i[o];e[s]!==void 0&&n++}return n},t.prototype.encodeMap=function(e,r){var n=Object.keys(e);this.sortKeys&&n.sort();var o=this.ignoreUndefined?this.countWithoutUndefined(e,n):n.length;if(o<16)this.writeU8(128+o);else if(o<65536)this.writeU8(222),this.writeU16(o);else if(o<4294967296)this.writeU8(223),this.writeU32(o);else throw new Error("Too large map object: ".concat(o));for(var i=0,s=n;i<s.length;i++){var a=s[i],l=e[a];this.ignoreUndefined&&l===void 0||(this.encodeString(a),this.doEncode(l,r+1))}},t.prototype.encodeExtension=function(e){var r=e.data.length;if(r===1)this.writeU8(212);else if(r===2)this.writeU8(213);else if(r===4)this.writeU8(214);else if(r===8)this.writeU8(215);else if(r===16)this.writeU8(216);else if(r<256)this.writeU8(199),this.writeU8(r);else if(r<65536)this.writeU8(200),this.writeU16(r);else if(r<4294967296)this.writeU8(201),this.writeU32(r);else throw new Error("Too large extension object: ".concat(r));this.writeI8(e.type),this.writeU8a(e.data)},t.prototype.writeU8=function(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++},t.prototype.writeU8a=function(e){var r=e.length;this.ensureBufferSizeToWrite(r),this.bytes.set(e,this.pos),this.pos+=r},t.prototype.writeI8=function(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++},t.prototype.writeU16=function(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2},t.prototype.writeI16=function(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2},t.prototype.writeU32=function(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4},t.prototype.writeI32=function(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4},t.prototype.writeF32=function(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4},t.prototype.writeF64=function(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8},t.prototype.writeU64=function(e){this.ensureBufferSizeToWrite(8),Wa(this.view,this.pos,e),this.pos+=8},t.prototype.writeI64=function(e){this.ensureBufferSizeToWrite(8),en(this.view,this.pos,e),this.pos+=8},t}();var Qu={};function vi(t,e){e===void 0&&(e=Qu);var r=new Xa(e.extensionCodec,e.context,e.maxDepth,e.initialBufferSize,e.sortKeys,e.forceFloat32,e.ignoreUndefined,e.forceIntegerToFloat);return r.encodeSharedRef(t)}function sn(t){return"".concat(t<0?"-":"","0x").concat(Math.abs(t).toString(16).padStart(2,"0"))}var ed=16,td=16,Za=function(){function t(e,r){e===void 0&&(e=ed),r===void 0&&(r=td),this.maxKeyLength=e,this.maxLengthPerKey=r,this.hit=0,this.miss=0,this.caches=[];for(var n=0;n<this.maxKeyLength;n++)this.caches.push([])}return t.prototype.canBeCached=function(e){return e>0&&e<=this.maxKeyLength},t.prototype.find=function(e,r,n){var o=this.caches[n-1];e:for(var i=0,s=o;i<s.length;i++){for(var a=s[i],l=a.bytes,u=0;u<n;u++)if(l[u]!==e[r+u])continue e;return a.str}return null},t.prototype.store=function(e,r){var n=this.caches[e.length-1],o={bytes:e,str:r};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=o:n.push(o)},t.prototype.decode=function(e,r,n){var o=this.find(e,r,n);if(o!=null)return this.hit++,o;this.miss++;var i=nn(e,r,n),s=Uint8Array.prototype.slice.call(e,r,r+n);return this.store(s,i),i},t}();var rd=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function a(h){try{u(n.next(h))}catch(d){s(d)}}function l(h){try{u(n.throw(h))}catch(d){s(d)}}function u(h){h.done?i(h.value):o(h.value).then(a,l)}u((n=n.apply(t,e||[])).next())})},Ei=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(h){return l([u,h])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=u[0]&2?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,o=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){r.label=u[1];break}if(u[0]===6&&r.label<i[1]){r.label=i[1],i=u;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(u);break}i[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(h){u=[6,h],o=0}finally{n=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},Qa=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof __values=="function"?__values(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=t[i]&&function(s){return new Promise(function(a,l){s=t[i](s),o(a,l,s.done,s.value)})}}function o(i,s,a,l){Promise.resolve(l).then(function(u){i({value:u,done:a})},s)}},Gt=function(t){return this instanceof Gt?(this.v=t,this):new Gt(t)},nd=function(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),o,i=[];return o={},s("next"),s("throw"),s("return"),o[Symbol.asyncIterator]=function(){return this},o;function s(p){n[p]&&(o[p]=function(w){return new Promise(function(g,m){i.push([p,w,g,m])>1||a(p,w)})})}function a(p,w){try{l(n[p](w))}catch(g){d(i[0][3],g)}}function l(p){p.value instanceof Gt?Promise.resolve(p.value.v).then(u,h):d(i[0][2],p)}function u(p){a("next",p)}function h(p){a("throw",p)}function d(p,w){p(w),i.shift(),i.length&&a(i[0][0],i[0][1])}},id=function(t){var e=typeof t;return e==="string"||e==="number"},br=-1,xi=new DataView(new ArrayBuffer(0)),od=new Uint8Array(xi.buffer),_i=function(){try{xi.getInt8(0)}catch(t){return t.constructor}throw new Error("never reached")}(),ef=new _i("Insufficient data"),sd=new Za,tf=function(){function t(e,r,n,o,i,s,a,l){e===void 0&&(e=on.defaultCodec),r===void 0&&(r=void 0),n===void 0&&(n=ct),o===void 0&&(o=ct),i===void 0&&(i=ct),s===void 0&&(s=ct),a===void 0&&(a=ct),l===void 0&&(l=sd),this.extensionCodec=e,this.context=r,this.maxStrLength=n,this.maxBinLength=o,this.maxArrayLength=i,this.maxMapLength=s,this.maxExtLength=a,this.keyDecoder=l,this.totalPos=0,this.pos=0,this.view=xi,this.bytes=od,this.headByte=br,this.stack=[]}return t.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=br,this.stack.length=0},t.prototype.setBuffer=function(e){this.bytes=Vt(e),this.view=Ja(this.bytes),this.pos=0},t.prototype.appendBuffer=function(e){if(this.headByte===br&&!this.hasRemaining(1))this.setBuffer(e);else{var r=this.bytes.subarray(this.pos),n=Vt(e),o=new Uint8Array(r.length+n.length);o.set(r),o.set(n,r.length),this.setBuffer(o)}},t.prototype.hasRemaining=function(e){return this.view.byteLength-this.pos>=e},t.prototype.createExtraByteError=function(e){var r=this,n=r.view,o=r.pos;return new RangeError("Extra ".concat(n.byteLength-o," of ").concat(n.byteLength," byte(s) found at buffer[").concat(e,"]"))},t.prototype.decode=function(e){this.reinitializeState(),this.setBuffer(e);var r=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return r},t.prototype.decodeMulti=function(e){return Ei(this,function(r){switch(r.label){case 0:this.reinitializeState(),this.setBuffer(e),r.label=1;case 1:return this.hasRemaining(1)?[4,this.doDecodeSync()]:[3,3];case 2:return r.sent(),[3,1];case 3:return[2]}})},t.prototype.decodeAsync=function(e){var r,n,o,i;return rd(this,void 0,void 0,function(){var s,a,l,u,h,d,p,w;return Ei(this,function(g){switch(g.label){case 0:s=!1,g.label=1;case 1:g.trys.push([1,6,7,12]),r=Qa(e),g.label=2;case 2:return[4,r.next()];case 3:if(n=g.sent(),!!n.done)return[3,5];if(l=n.value,s)throw this.createExtraByteError(this.totalPos);this.appendBuffer(l);try{a=this.doDecodeSync(),s=!0}catch(m){if(!(m instanceof _i))throw m}this.totalPos+=this.pos,g.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return u=g.sent(),o={error:u},[3,12];case 7:return g.trys.push([7,,10,11]),n&&!n.done&&(i=r.return)?[4,i.call(r)]:[3,9];case 8:g.sent(),g.label=9;case 9:return[3,11];case 10:if(o)throw o.error;return[7];case 11:return[7];case 12:if(s){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,a]}throw h=this,d=h.headByte,p=h.pos,w=h.totalPos,new RangeError("Insufficient data in parsing ".concat(sn(d)," at ").concat(w," (").concat(p," in the current buffer)"))}})})},t.prototype.decodeArrayStream=function(e){return this.decodeMultiAsync(e,!0)},t.prototype.decodeStream=function(e){return this.decodeMultiAsync(e,!1)},t.prototype.decodeMultiAsync=function(e,r){return nd(this,arguments,function(){var o,i,s,a,l,u,h,d,p;return Ei(this,function(w){switch(w.label){case 0:o=r,i=-1,w.label=1;case 1:w.trys.push([1,13,14,19]),s=Qa(e),w.label=2;case 2:return[4,Gt(s.next())];case 3:if(a=w.sent(),!!a.done)return[3,12];if(l=a.value,r&&i===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(l),o&&(i=this.readArraySize(),o=!1,this.complete()),w.label=4;case 4:w.trys.push([4,9,,10]),w.label=5;case 5:return[4,Gt(this.doDecodeSync())];case 6:return[4,w.sent()];case 7:return w.sent(),--i===0?[3,8]:[3,5];case 8:return[3,10];case 9:if(u=w.sent(),!(u instanceof _i))throw u;return[3,10];case 10:this.totalPos+=this.pos,w.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return h=w.sent(),d={error:h},[3,19];case 14:return w.trys.push([14,,17,18]),a&&!a.done&&(p=s.return)?[4,Gt(p.call(s))]:[3,16];case 15:w.sent(),w.label=16;case 16:return[3,18];case 17:if(d)throw d.error;return[7];case 18:return[7];case 19:return[2]}})})},t.prototype.doDecodeSync=function(){e:for(;;){var e=this.readHeadByte(),r=void 0;if(e>=224)r=e-256;else if(e<192)if(e<128)r=e;else if(e<144){var n=e-128;if(n!==0){this.pushMapState(n),this.complete();continue e}else r={}}else if(e<160){var n=e-144;if(n!==0){this.pushArrayState(n),this.complete();continue e}else r=[]}else{var o=e-160;r=this.decodeUtf8String(o,0)}else if(e===192)r=null;else if(e===194)r=!1;else if(e===195)r=!0;else if(e===202)r=this.readF32();else if(e===203)r=this.readF64();else if(e===204)r=this.readU8();else if(e===205)r=this.readU16();else if(e===206)r=this.readU32();else if(e===207)r=this.readU64();else if(e===208)r=this.readI8();else if(e===209)r=this.readI16();else if(e===210)r=this.readI32();else if(e===211)r=this.readI64();else if(e===217){var o=this.lookU8();r=this.decodeUtf8String(o,1)}else if(e===218){var o=this.lookU16();r=this.decodeUtf8String(o,2)}else if(e===219){var o=this.lookU32();r=this.decodeUtf8String(o,4)}else if(e===220){var n=this.readU16();if(n!==0){this.pushArrayState(n),this.complete();continue e}else r=[]}else if(e===221){var n=this.readU32();if(n!==0){this.pushArrayState(n),this.complete();continue e}else r=[]}else if(e===222){var n=this.readU16();if(n!==0){this.pushMapState(n),this.complete();continue e}else r={}}else if(e===223){var n=this.readU32();if(n!==0){this.pushMapState(n),this.complete();continue e}else r={}}else if(e===196){var n=this.lookU8();r=this.decodeBinary(n,1)}else if(e===197){var n=this.lookU16();r=this.decodeBinary(n,2)}else if(e===198){var n=this.lookU32();r=this.decodeBinary(n,4)}else if(e===212)r=this.decodeExtension(1,0);else if(e===213)r=this.decodeExtension(2,0);else if(e===214)r=this.decodeExtension(4,0);else if(e===215)r=this.decodeExtension(8,0);else if(e===216)r=this.decodeExtension(16,0);else if(e===199){var n=this.lookU8();r=this.decodeExtension(n,1)}else if(e===200){var n=this.lookU16();r=this.decodeExtension(n,2)}else if(e===201){var n=this.lookU32();r=this.decodeExtension(n,4)}else throw new Je("Unrecognized type byte: ".concat(sn(e)));this.complete();for(var i=this.stack;i.length>0;){var s=i[i.length-1];if(s.type===0)if(s.array[s.position]=r,s.position++,s.position===s.size)i.pop(),r=s.array;else continue e;else if(s.type===1){if(!id(r))throw new Je("The type of key must be string or number but "+typeof r);if(r==="__proto__")throw new Je("The key __proto__ is not allowed");s.key=r,s.type=2;continue e}else if(s.map[s.key]=r,s.readCount++,s.readCount===s.size)i.pop(),r=s.map;else{s.key=null,s.type=1;continue e}}return r}},t.prototype.readHeadByte=function(){return this.headByte===br&&(this.headByte=this.readU8()),this.headByte},t.prototype.complete=function(){this.headByte=br},t.prototype.readArraySize=function(){var e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new Je("Unrecognized array type byte: ".concat(sn(e)))}}},t.prototype.pushMapState=function(e){if(e>this.maxMapLength)throw new Je("Max length exceeded: map length (".concat(e,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:1,size:e,key:null,readCount:0,map:{}})},t.prototype.pushArrayState=function(e){if(e>this.maxArrayLength)throw new Je("Max length exceeded: array length (".concat(e,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:0,size:e,array:new Array(e),position:0})},t.prototype.decodeUtf8String=function(e,r){var n;if(e>this.maxStrLength)throw new Je("Max length exceeded: UTF-8 byte length (".concat(e,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+r+e)throw ef;var o=this.pos+r,i;return this.stateIsMapKey()&&(!((n=this.keyDecoder)===null||n===void 0)&&n.canBeCached(e))?i=this.keyDecoder.decode(this.bytes,o,e):e>Ya?i=qa(this.bytes,o,e):i=nn(this.bytes,o,e),this.pos+=r+e,i},t.prototype.stateIsMapKey=function(){if(this.stack.length>0){var e=this.stack[this.stack.length-1];return e.type===1}return!1},t.prototype.decodeBinary=function(e,r){if(e>this.maxBinLength)throw new Je("Max length exceeded: bin length (".concat(e,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(e+r))throw ef;var n=this.pos+r,o=this.bytes.subarray(n,n+e);return this.pos+=r+e,o},t.prototype.decodeExtension=function(e,r){if(e>this.maxExtLength)throw new Je("Max length exceeded: ext length (".concat(e,") > maxExtLength (").concat(this.maxExtLength,")"));var n=this.view.getInt8(this.pos+r),o=this.decodeBinary(e,r+1);return this.extensionCodec.decode(o,n,this.context)},t.prototype.lookU8=function(){return this.view.getUint8(this.pos)},t.prototype.lookU16=function(){return this.view.getUint16(this.pos)},t.prototype.lookU32=function(){return this.view.getUint32(this.pos)},t.prototype.readU8=function(){var e=this.view.getUint8(this.pos);return this.pos++,e},t.prototype.readI8=function(){var e=this.view.getInt8(this.pos);return this.pos++,e},t.prototype.readU16=function(){var e=this.view.getUint16(this.pos);return this.pos+=2,e},t.prototype.readI16=function(){var e=this.view.getInt16(this.pos);return this.pos+=2,e},t.prototype.readU32=function(){var e=this.view.getUint32(this.pos);return this.pos+=4,e},t.prototype.readI32=function(){var e=this.view.getInt32(this.pos);return this.pos+=4,e},t.prototype.readU64=function(){var e=ja(this.view,this.pos);return this.pos+=8,e},t.prototype.readI64=function(){var e=tn(this.view,this.pos);return this.pos+=8,e},t.prototype.readF32=function(){var e=this.view.getFloat32(this.pos);return this.pos+=4,e},t.prototype.readF64=function(){var e=this.view.getFloat64(this.pos);return this.pos+=8,e},t}();var ad={};function Ai(t,e){e===void 0&&(e=ad);var r=new tf(e.extensionCodec,e.context,e.maxStrLength,e.maxBinLength,e.maxArrayLength,e.maxMapLength,e.maxExtLength);return r.decode(t)}var Tn=Rs(uc(),1);function us(t){return`Unsupported serialization format: ${t}`}function ds(){return typeof process!="undefined"&&process.versions!==void 0?"node":typeof Deno!="undefined"?"deno":typeof Bun!="undefined"?"bun":typeof window!="undefined"?"browser":"unknown"}var hs={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15},dc=Object.keys(hs);function iy(t){let e=new Uint8Array(Math.floor(t.length/2));t=t.toLowerCase();for(let r=0;r<t.length;r++){let n=hs[t[r*2]],o=hs[t[r*2+1]];if(n===void 0||o===void 0)break;e[r]=n<<4|o}return e}function oy(t){return Array.from(t||[]).map(e=>dc[e>>4]+dc[e&15]).join("")}async function hc(t,e="binary",r){r||(r=ds());let n=await yi(t),o;switch(e){case"json":o=JSON.stringify(n);break;case"dpack":o=Tn.serialize(n);break;case"binary":{let i=vi(n);r==="node"?(o=Buffer.from(i.buffer,i.byteOffset,i.byteLength),o=o.toString("hex")):o=oy(i)}break;default:throw new Error(us(e))}return o}async function pc(t,e,r){r||(r=ds());let n=hr({schema:{__placeholder:"string"}}),o;switch(t){case"json":o=JSON.parse(e.toString());break;case"dpack":o=Tn.parse(e);break;case"binary":r==="node"?e=Buffer.from(e.toString(),"hex"):e=iy(e),o=Ai(e);break;default:throw new Error(us(t))}return pi(n,o),n}var gc=Symbol("Comlink.proxy"),sy=Symbol("Comlink.endpoint"),ay=Symbol("Comlink.releaseProxy"),ps=Symbol("Comlink.finalizer"),On=Symbol("Comlink.thrown"),wc=t=>typeof t=="object"&&t!==null||typeof t=="function",fy={canHandle:t=>wc(t)&&t[gc],serialize(t){let{port1:e,port2:r}=new MessageChannel;return Un(t,e),[r,[r]]},deserialize(t){return t.start(),dy(t)}},ly={canHandle:t=>wc(t)&&On in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},bc=new Map([["proxy",fy],["throw",ly]]);function cy(t,e){for(let r of t)if(e===r||r==="*"||r instanceof RegExp&&r.test(e))return!0;return!1}function Un(t,e=globalThis,r=["*"]){e.addEventListener("message",function n(o){if(!o||!o.data)return;if(!cy(r,o.origin)){console.warn(`Invalid origin \'${o.origin}\' for comlink proxy`);return}let{id:i,type:s,path:a}=Object.assign({path:[]},o.data),l=(o.data.argumentList||[]).map(Ut),u;try{let h=a.slice(0,-1).reduce((p,w)=>p[w],t),d=a.reduce((p,w)=>p[w],t);switch(s){case"GET":u=d;break;case"SET":h[a.slice(-1)[0]]=Ut(o.data.value),u=!0;break;case"APPLY":u=d.apply(h,l);break;case"CONSTRUCT":{let p=new d(...l);u=wy(p)}break;case"ENDPOINT":{let{port1:p,port2:w}=new MessageChannel;Un(t,w),u=gy(p,[p])}break;case"RELEASE":u=void 0;break;default:return}}catch(h){u={value:h,[On]:0}}Promise.resolve(u).catch(h=>({value:h,[On]:0})).then(h=>{let[d,p]=Pn(h);e.postMessage(Object.assign(Object.assign({},d),{id:i}),p),s==="RELEASE"&&(e.removeEventListener("message",n),mc(e),ps in t&&typeof t[ps]=="function"&&t[ps]())}).catch(h=>{let[d,p]=Pn({value:new TypeError("Unserializable return value"),[On]:0});e.postMessage(Object.assign(Object.assign({},d),{id:i}),p)})}),e.start&&e.start()}function uy(t){return t.constructor.name==="MessagePort"}function mc(t){uy(t)&&t.close()}function dy(t,e){let r=new Map;return t.addEventListener("message",function(o){let{data:i}=o;if(!i||!i.id)return;let s=r.get(i.id);if(s)try{s(i)}finally{r.delete(i.id)}}),ys(t,r,[],e)}function Rn(t){if(t)throw new Error("Proxy has been released and is not useable")}function Sc(t){return Qt(t,new Map,{type:"RELEASE"}).then(()=>{mc(t)})}var Dn=new WeakMap,Nn="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{let e=(Dn.get(t)||0)-1;Dn.set(t,e),e===0&&Sc(t)});function hy(t,e){let r=(Dn.get(e)||0)+1;Dn.set(e,r),Nn&&Nn.register(t,e,t)}function py(t){Nn&&Nn.unregister(t)}function ys(t,e,r=[],n=function(){}){let o=!1,i=new Proxy(n,{get(s,a){if(Rn(o),a===ay)return()=>{py(i),Sc(t),e.clear(),o=!0};if(a==="then"){if(r.length===0)return{then:()=>i};let l=Qt(t,e,{type:"GET",path:r.map(u=>u.toString())}).then(Ut);return l.then.bind(l)}return ys(t,e,[...r,a])},set(s,a,l){Rn(o);let[u,h]=Pn(l);return Qt(t,e,{type:"SET",path:[...r,a].map(d=>d.toString()),value:u},h).then(Ut)},apply(s,a,l){Rn(o);let u=r[r.length-1];if(u===sy)return Qt(t,e,{type:"ENDPOINT"}).then(Ut);if(u==="bind")return ys(t,e,r.slice(0,-1));let[h,d]=yc(l);return Qt(t,e,{type:"APPLY",path:r.map(p=>p.toString()),argumentList:h},d).then(Ut)},construct(s,a){Rn(o);let[l,u]=yc(a);return Qt(t,e,{type:"CONSTRUCT",path:r.map(h=>h.toString()),argumentList:l},u).then(Ut)}});return hy(i,t),i}function yy(t){return Array.prototype.concat.apply([],t)}function yc(t){let e=t.map(Pn);return[e.map(r=>r[0]),yy(e.map(r=>r[1]))]}var vc=new WeakMap;function gy(t,e){return vc.set(t,e),t}function wy(t){return Object.assign(t,{[gc]:!0})}function Pn(t){for(let[e,r]of bc)if(r.canHandle(t)){let[n,o]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},o]}return[{type:"RAW",value:t},vc.get(t)||[]]}function Ut(t){switch(t.type){case"HANDLER":return bc.get(t.name).deserialize(t.value);case"RAW":return t.value}}function Qt(t,e,r,n){return new Promise(o=>{let i=by();e.set(i,o),t.start&&t.start(),t.postMessage(Object.assign({id:i},r),n)})}function by(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var Mt=Rs(_c());var gs=class{constructor(){this.hasChanges=!1;this.db=null}setLogLevel(e){Mt.default.setLevel(e),Mt.default.info(`Worker log level set to: ${Mt.default.getLevel()}`)}async init(e,r,n,o){this.adapter=e,this.vectorSize=r,this.filepath=n,this.db=null,this.schema={path:"string",pathHash:"string",title:"string",embedding:`vector[${this.vectorSize}]`,lastUpdated:"number",content:"string",chunkIndex:"number",totalChunks:"number"};try{if(await this.adapter.exists(this.filepath)&&o){let s=await this.adapter.read(this.filepath);this.db=await pc("json",s)}else this.db=await hr({schema:this.schema});this.hasChanges=!1}catch(i){Mt.default.error("Failed to load database",i)}}async persist(){let e=performance.now();if(Mt.default.info("Starting persist() operation"),!this.filepath)throw new Error("No filepath specified for saving");if(!this.hasChanges||!this.db)return;let r=await hc(this.db,"json");if(r===void 0)throw new Error("Failed to persist database");typeof r=="string"?await this.adapter.write(this.filepath,r):await this.adapter.writeBinary(this.filepath,r),this.hasChanges=!1;let o=performance.now()-e;Mt.default.info(`Completed persist() operation in ${o.toFixed(2)}ms`)}async put(e){if(!this.db)throw new Error("Database not loaded");let r=await this.calculatePathHash(e.path),n=tt(Ee({},e),{pathHash:r});await zt(this.db,n),this.hasChanges=!0}async putMulti(e){if(!this.db)throw new Error("Database not loaded");let r=await Promise.all(e.map(async n=>tt(Ee({},n),{pathHash:await this.calculatePathHash(n.path)})));await fi(this.db,r),this.hasChanges=!0}async calculatePathHash(e){let n=new TextEncoder().encode(e),o=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(o)).map(s=>s.toString(16).padStart(2,"0")).join("")}async removeByPath(e){if(!this.db)throw new Error("Database not loaded");let r=await this.calculatePathHash(e),n=await yr(this.db,{term:r,properties:["pathHash"],exact:!0,limit:100});if(n.hits.length>0){for(let o of n.hits)await Zr(this.db,o.id);return this.hasChanges=!0,!0}return!1}async findSimilarChunks(e,r,n,o){if(!this.db)throw new Error("Database not loaded");let i=r*2,s=0,a=[];for(;;){let l={mode:"vector",vector:{value:e,property:"embedding"},similarity:n!=null?n:0,limit:i,offset:s},u=await yr(this.db,l);if(u.hits.length===0)break;let h=u.hits.filter(d=>o?!o.includes(d.document.path):!0);if(a=a.concat(h.map(d=>{let p=d.document;return{chunk:{path:p.path,title:p.title,content:p.content,chunkIndex:p.chunkIndex,totalChunks:p.totalChunks,embedding:p.embedding},score:d.score}})),a.length>=r){a=a.slice(0,r);break}s+=i}return a}count(){if(!this.db)throw new Error("Database not loaded");return pr(this.db)}};Un(gs);\n/*! Bundled license information:\n\n@jspm/core/nodelibs/browser/chunk-DtuTasat.js:\n  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)\n\n@jspm/core/nodelibs/browser/chunk-CcCWfKp1.js:\n  (*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)\n\ncomlink/dist/esm/comlink.mjs:\n  (**\n   * @license\n   * Copyright 2019 Google LLC\n   * SPDX-License-Identifier: Apache-2.0\n   *)\n*/\n')}var qs=class{constructor(e){this.vault=e;this.workerManager=new li("OramaWorker")}async init(e,r,n){await(await this.workerManager.initialize(nc)).init(lo(this.vault.adapter),e,r,n)}async persist(){this.workerManager.ensureInitialized(),await this.workerManager.getWorker().persist()}async put(e){this.workerManager.ensureInitialized(),await this.workerManager.getWorker().put(e.toDTO())}async putMulti(e){this.workerManager.ensureInitialized(),await this.workerManager.getWorker().putMulti(e.map(n=>n.toDTO()))}async removeByPath(e){return this.workerManager.ensureInitialized(),await this.workerManager.getWorker().removeByPath(e)}async findSimilarChunks(e,r,n,i){return this.workerManager.ensureInitialized(),await this.workerManager.getWorker().findSimilarChunks(e,r,n,i).then(s=>s.map(a=>({...a,chunk:si.fromDTO(a.chunk)})))}async count(){return this.workerManager.ensureInitialized(),await this.workerManager.getWorker().count()}setLogLevel(e){co.default.setLevel(e),co.default.info(`OramaNoteChunkRepository log level set to: ${co.default.getLevel()}`),this.workerManager.updateLogLevel(e)}async dispose(){try{await this.workerManager.dispose()}catch(e){co.default.error("Error during OramaNoteChunkRepository disposal:",e)}}};var ny=require("obsidian"),iy=Z(fo()),oy=Z(J_());function X_(t,e,r,n){switch(r.noteDisplayMode){case"path":return t.path;case"smart":return n&&n.filter(o=>o!==t&&o.basename===t.basename).length>0?t.path:e;case"title":default:return e}}var ty=require("obsidian"),Yt=Z(fo()),J=Z(Sp()),hS=({collapsed:t,onToggleCollapse:e})=>(0,J.jsx)("div",{className:"tree-item-self is-clickable",onClick:e,onKeyDown:n=>{(n.key==="Enter"||n.key===" ")&&(e(),n.preventDefault())},children:(0,J.jsx)("div",{className:`similar-notes-title tree-item-itself is-clickable ${t?"is-collapsed":""}`,children:(0,J.jsx)("div",{className:"tree-item-inner",children:"Similar notes"})})}),mS=({preview:t,sourceChunk:e,isOpen:r})=>(0,J.jsxs)("div",{className:`search-result-file-matches ${r?"":"is-collapsed"}`,children:[(0,J.jsx)("div",{className:"search-result-file-match tappable",children:t}),e&&(0,J.jsxs)("div",{className:"search-result-file-match tappable",children:[(0,J.jsx)("div",{style:{fontWeight:"bold",textAlign:"center"},children:"Source"}),(0,J.jsx)("div",{style:{textAlign:"left"},children:e})]})]}),gS=({note:t,onNoteClick:e,onContextMenu:r,noteDisplayMode:n,allSimilarNotes:i})=>{let[o,s]=(0,Yt.useState)(!0),[a,l]=(0,Yt.useState)(!1),[u,c]=(0,Yt.useState)(!1),d=200;return(0,Yt.useEffect)(()=>{if(o){c(!0);let f=setTimeout(()=>{l(!1),c(!1)},d);return()=>clearTimeout(f)}else{l(!0),c(!0);let f=setTimeout(()=>{c(!1)},20);return()=>clearTimeout(f)}},[o]),(0,J.jsxs)("div",{className:o?"tree-item search-result is-collapsed":"tree-item search-result",children:[(0,J.jsxs)("div",{className:"tree-item-self search-result-file-title is-clickable",draggable:"true",onClick:f=>e(f,t.file),onKeyDown:()=>{},onContextMenu:f=>r(f,t.file),children:[(0,J.jsx)("div",{className:o?"tree-item-icon collapse-icon is-collapsed":"tree-item-icon collapse-icon",onKeyDown:()=>{},onClick:f=>{f.stopPropagation(),s(_=>!_)},children:(0,J.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"svg-icon right-triangle",children:[(0,J.jsx)("title",{children:"collapse-icon"}),(0,J.jsx)("path",{d:"M3 8L12 17L21 8"})]})}),(0,J.jsx)("div",{className:"tree-item-inner",title:t.file.path,children:X_(t.file,t.title,{noteDisplayMode:n},i.map(f=>f.file))}),(0,J.jsx)("div",{className:"tree-item-flair-outer",children:(0,J.jsx)("div",{className:"tree-item-flair",children:t.similarity.toFixed(2)})})]}),a&&(0,J.jsx)(mS,{preview:t.preview,sourceChunk:t.sourceChunk,isOpen:!u})]})},_S=({similarNotes:t,onNoteClick:e,onContextMenu:r,noteDisplayMode:n})=>t.length===0?(0,J.jsx)("div",{className:"search-result-container",children:(0,J.jsx)("div",{className:"search-empty-state",children:"No similar notes found."})}):(0,J.jsx)("div",{className:"search-result-container",children:(0,J.jsx)("div",{className:"search-results-children",children:t.map(i=>(0,J.jsx)(gS,{note:i,onNoteClick:e,onContextMenu:r,noteDisplayMode:n,allSimilarNotes:t},i.file.path))})}),yS=({workspace:t,vaultName:e,leaf:r,bottomViewModelSubject$:n})=>{let[i,o]=(0,Yt.useState)(!1),[s,a]=(0,Yt.useState)([]),[l,u]=(0,Yt.useState)("title"),c=w=>{r.file===w.currentFile&&(a(w.similarNoteEntries),u(w.noteDisplayMode))};(0,Yt.useEffect)(()=>{let w=n.subscribe(c);return()=>w.unsubscribe()},[n]);let d=(w,b=!1)=>{t.openLinkText(w.path,"",b)};return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)("div",{className:"nav-header"}),(0,J.jsxs)("div",{className:"similar-notes-pane",children:[(0,J.jsx)(hS,{collapsed:i,onToggleCollapse:()=>{o(!i)}}),!i&&(0,J.jsx)(_S,{similarNotes:s,onNoteClick:(w,b)=>{w.preventDefault(),d(b,w.ctrlKey||w.metaKey)},onContextMenu:(w,b)=>{w.preventDefault();let m=new ty.Menu;m.addItem(h=>h.setTitle("Open link").onClick(()=>{d(b,!1)})),m.addItem(h=>h.setTitle("Open in new tab").onClick(()=>{d(b,!0)})),m.addSeparator(),m.addItem(h=>h.setTitle("Copy Obsidian URL").onClick(()=>{let g=`obsidian://open?vault=${e}&file=${b.path}`;navigator.clipboard.writeText(g)})),m.showAtMouseEvent(w.nativeEvent)},noteDisplayMode:l})]})]})},ry=yS;var gl=class extends ny.Component{constructor(r,n,i,o,s){super();this.workspace=r;this.vaultName=n;this.leaf=i;this.parentEl=o;this.bottomViewModelSubject$=s;this.containerEl=o.createDiv({cls:"embedded-similar-notes"}),this.root=(0,oy.createRoot)(this.containerEl),this.render()}render(){this.root.render(iy.createElement(ry,{workspace:this.workspace,vaultName:this.vaultName,leaf:this.leaf,bottomViewModelSubject$:this.bottomViewModelSubject$}))}getContainerEl(){return this.containerEl}unload(){this.root.unmount(),this.containerEl.remove()}};var sy=require("obsidian"),_l=class{constructor(e,r){this.app=e;this.similarNoteCoordinator=r;this.noteBottomViewMap=new Map}async onActiveLeafChange(e){if(!e||!(e.view instanceof sy.MarkdownView)||this.noteBottomViewMap.has(e.view))return;let r=await this.createAndAttachNoteBottomView(e.view);if(!r)throw new Error("Failed to create similar notes view");this.noteBottomViewMap.set(e.view,r)}async onLayoutChange(){let e=this.app.workspace.getLeavesOfType("markdown");for(let r of this.noteBottomViewMap.keys())e.includes(r.leaf)||(this.noteBottomViewMap.get(r)?.unload(),this.noteBottomViewMap.delete(r))}async onUnload(){for(let e of this.noteBottomViewMap.values())e.unload()}async createAndAttachNoteBottomView(e){let r=e.containerEl.querySelector(".embedded-backlinks");if(!r||!r?.parentElement||!e.file)return null;let n=new gl(this.app.workspace,this.app.vault.getName(),e,r.parentElement,this.similarNoteCoordinator.getNoteBottomViewModelObservable()),i=n.getContainerEl();return r.parentElement.insertBefore(i,r),n}};var as=Z(Qe());var Tp=function(t,e){return Tp=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},Tp(t,e)};function Yr(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Tp(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}function os(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function zi(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o}function ji(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))}function St(t){return typeof t=="function"}function yl(t){var e=function(n){Error.call(n),n.stack=new Error().stack},r=t(e);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var wl=yl(function(t){return function(r){t(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function ss(t,e){if(t){var r=t.indexOf(e);0<=r&&t.splice(r,1)}}var Bi=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,r,n,i,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=os(s),l=a.next();!l.done;l=a.next()){var u=l.value;u.remove(this)}}catch(w){e={error:w}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}else s.remove(this);var c=this.initialTeardown;if(St(c))try{c()}catch(w){o=w instanceof wl?w.errors:[w]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var p=os(d),f=p.next();!f.done;f=p.next()){var _=f.value;try{ay(_)}catch(w){o=o??[],w instanceof wl?o=ji(ji([],zi(o)),zi(w.errors)):o.push(w)}}}catch(w){n={error:w}}finally{try{f&&!f.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}}if(o)throw new wl(o)}},t.prototype.add=function(e){var r;if(e&&e!==this)if(this.closed)ay(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(e)}},t.prototype._hasParent=function(e){var r=this._parentage;return r===e||Array.isArray(r)&&r.includes(e)},t.prototype._addParent=function(e){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(e),r):r?[r,e]:e},t.prototype._removeParent=function(e){var r=this._parentage;r===e?this._parentage=null:Array.isArray(r)&&ss(r,e)},t.prototype.remove=function(e){var r=this._finalizers;r&&ss(r,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}();var Mp=Bi.EMPTY;function vl(t){return t instanceof Bi||t&&"closed"in t&&St(t.remove)&&St(t.add)&&St(t.unsubscribe)}function ay(t){St(t)?t():t.unsubscribe()}var Bt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Ui={setTimeout:function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=Ui.delegate;return i?.setTimeout?i.setTimeout.apply(i,ji([t,e],zi(r))):setTimeout.apply(void 0,ji([t,e],zi(r)))},clearTimeout:function(t){var e=Ui.delegate;return(e?.clearTimeout||clearTimeout)(t)},delegate:void 0};function ly(t){Ui.setTimeout(function(){var e=Bt.onUnhandledError;if(e)e(t);else throw t})}function kp(){}var uy=function(){return Ep("C",void 0,void 0)}();function cy(t){return Ep("E",void 0,t)}function dy(t){return Ep("N",t,void 0)}function Ep(t,e,r){return{kind:t,value:e,error:r}}var En=null;function Vi(t){if(Bt.useDeprecatedSynchronousErrorHandling){var e=!En;if(e&&(En={errorThrown:!1,error:null}),t(),e){var r=En,n=r.errorThrown,i=r.error;if(En=null,n)throw i}}else t()}function py(t){Bt.useDeprecatedSynchronousErrorHandling&&En&&(En.errorThrown=!0,En.error=t)}var Ip=function(t){Yr(e,t);function e(r){var n=t.call(this)||this;return n.isStopped=!1,r?(n.destination=r,vl(r)&&r.add(n)):n.destination=xS,n}return e.create=function(r,n,i){return new xl(r,n,i)},e.prototype.next=function(r){this.isStopped?Cp(dy(r),this):this._next(r)},e.prototype.error=function(r){this.isStopped?Cp(cy(r),this):(this.isStopped=!0,this._error(r))},e.prototype.complete=function(){this.isStopped?Cp(uy,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(r){this.destination.next(r)},e.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Bi);var wS=Function.prototype.bind;function Pp(t,e){return wS.call(t,e)}var vS=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var r=this.partialObserver;if(r.next)try{r.next(e)}catch(n){bl(n)}},t.prototype.error=function(e){var r=this.partialObserver;if(r.error)try{r.error(e)}catch(n){bl(n)}else bl(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(r){bl(r)}},t}(),xl=function(t){Yr(e,t);function e(r,n,i){var o=t.call(this)||this,s;if(St(r)||!r)s={next:r??void 0,error:n??void 0,complete:i??void 0};else{var a;o&&Bt.useDeprecatedNextContext?(a=Object.create(r),a.unsubscribe=function(){return o.unsubscribe()},s={next:r.next&&Pp(r.next,a),error:r.error&&Pp(r.error,a),complete:r.complete&&Pp(r.complete,a)}):s=r}return o.destination=new vS(s),o}return e}(Ip);function bl(t){Bt.useDeprecatedSynchronousErrorHandling?py(t):ly(t)}function bS(t){throw t}function Cp(t,e){var r=Bt.onStoppedNotification;r&&Ui.setTimeout(function(){return r(t,e)})}var xS={closed:!0,next:kp,error:bS,complete:kp};var fy=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function hy(t){return t}function my(t){return t.length===0?hy:t.length===1?t[0]:function(r){return t.reduce(function(n,i){return i(n)},r)}}var Ap=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(e,r,n){var i=this,o=TS(e)?e:new xl(e,r,n);return Vi(function(){var s=i,a=s.operator,l=s.source;o.add(a?a.call(o,l):l?i._subscribe(o):i._trySubscribe(o))}),o},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(r){e.error(r)}},t.prototype.forEach=function(e,r){var n=this;return r=gy(r),new r(function(i,o){var s=new xl({next:function(a){try{e(a)}catch(l){o(l),s.unsubscribe()}},error:o,complete:i});n.subscribe(s)})},t.prototype._subscribe=function(e){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(e)},t.prototype[fy]=function(){return this},t.prototype.pipe=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return my(e)(this)},t.prototype.toPromise=function(e){var r=this;return e=gy(e),new e(function(n,i){var o;r.subscribe(function(s){return o=s},function(s){return i(s)},function(){return n(o)})})},t.create=function(e){return new t(e)},t}();function gy(t){var e;return(e=t??Bt.Promise)!==null&&e!==void 0?e:Promise}function SS(t){return t&&St(t.next)&&St(t.error)&&St(t.complete)}function TS(t){return t&&t instanceof Ip||SS(t)&&vl(t)}var _y=yl(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}});var Ue=function(t){Yr(e,t);function e(){var r=t.call(this)||this;return r.closed=!1,r.currentObservers=null,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return e.prototype.lift=function(r){var n=new yy(this,this);return n.operator=r,n},e.prototype._throwIfClosed=function(){if(this.closed)throw new _y},e.prototype.next=function(r){var n=this;Vi(function(){var i,o;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var s=os(n.currentObservers),a=s.next();!a.done;a=s.next()){var l=a.value;l.next(r)}}catch(u){i={error:u}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}}})},e.prototype.error=function(r){var n=this;Vi(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=r;for(var i=n.observers;i.length;)i.shift().error(r)}})},e.prototype.complete=function(){var r=this;Vi(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var n=r.observers;n.length;)n.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(r){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,r)},e.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},e.prototype._innerSubscribe=function(r){var n=this,i=this,o=i.hasError,s=i.isStopped,a=i.observers;return o||s?Mp:(this.currentObservers=null,a.push(r),new Bi(function(){n.currentObservers=null,ss(a,r)}))},e.prototype._checkFinalizedStatuses=function(r){var n=this,i=n.hasError,o=n.thrownError,s=n.isStopped;i?r.error(o):s&&r.complete()},e.prototype.asObservable=function(){var r=new Ap;return r.source=this,r},e.create=function(r,n){return new yy(r,n)},e}(Ap);var yy=function(t){Yr(e,t);function e(r,n){var i=t.call(this)||this;return i.destination=r,i.source=n,i}return e.prototype.next=function(r){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,r)},e.prototype.error=function(r){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,r)},e.prototype.complete=function(){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||n===void 0||n.call(r)},e.prototype._subscribe=function(r){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(r))!==null&&i!==void 0?i:Mp},e}(Ue);var Pn=function(t){Yr(e,t);function e(r){var n=t.call(this)||this;return n._value=r,n}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(r){var n=t.prototype._subscribe.call(this,r);return!n.closed&&r.next(this._value),n},e.prototype.getValue=function(){var r=this,n=r.hasError,i=r.thrownError,o=r._value;if(n)throw i;return this._throwIfClosed(),o},e.prototype.next=function(r){t.prototype.next.call(this,this._value=r)},e}(Ue);var Sl=class{constructor(e,r,n,i,o,s,a,l){this.noteRepository=e;this.noteChunkRepository=r;this.noteChangeQueue=n;this.noteChunkingService=i;this.embeddingService=o;this.similarNoteCoordinator=s;this.settingsService=a;this.app=l;this.fileChangeLoopTimer=null;this.noteChangeCount$=new Pn(0)}startLoop(){let e=async()=>{let r=this.noteChangeQueue.getFileChangeCount();this.noteChangeCount$.next(r);let n=await this.noteChangeQueue.pollFileChanges(1);if(n.length===0){this.fileChangeLoopTimer=setTimeout(e,1e3);return}let i=n[0];as.default.info("processing change",i.path),i.reason==="deleted"?await this.processDeletedNote(i.path):await this.processUpdatedNote(i.path),await this.noteChangeQueue.markNoteChangeProcessed(i),e()};e()}stopLoop(){this.fileChangeLoopTimer&&clearTimeout(this.fileChangeLoopTimer)}getNoteChangeCount$(){return this.noteChangeCount$.asObservable()}async processDeletedNote(e){await this.noteChunkRepository.removeByPath(e)}async processUpdatedNote(e){let r=await this.noteRepository.findByPath(e,!this.settingsService.get().includeFrontmatter);if(!r||!r.content)return;let i=this.settingsService.get().excludeRegexPatterns||[],o={...r};if(i.length>0){let c=r.content;for(let d of i)try{let p=new RegExp(d,"gm");c=c.replace(p,"")}catch(p){as.default.warn(`Invalid RegExp pattern: ${d}`,p)}o.content=c}let s=await this.noteChunkingService.split(o);if(s.length===0)return;let a=await Promise.all(s.map(async c=>c.withEmbedding(await this.embeddingService.embedText(c.content))));as.default.info("chunks",a);let l=await this.noteChunkRepository.removeByPath(r.path);await this.noteChunkRepository.putMulti(a),as.default.info("count of chunks in embedding store",await this.noteChunkRepository.count());let u=this.app.workspace.getActiveFile();u&&u.path===r.path&&this.similarNoteCoordinator.emitNoteBottomViewModelFromPath(r.path)}};var MS={autoSaveInterval:10,modelProvider:"builtin",modelId:"sentence-transformers/all-MiniLM-L6-v2",includeFrontmatter:!1,showSourceChunk:!1,useGPU:!0,excludeRegexPatterns:[],regexpTestInputText:"",noteDisplayMode:"title"},Tl=class{constructor(e){this.plugin=e;this.newSettingsObservable$=new Ue}async load(){let e=await this.plugin.loadData();this.settings={...MS,...e}}async save(){await this.plugin.saveData(this.settings)}get(){return this.settings}getNewSettingsObservable(){return this.newSettingsObservable$.asObservable()}async update(e){this.settings={...this.settings,...e},await this.save(),this.newSettingsObservable$.next(e)}};var kS=20,Ml=class{constructor(e,r,n,i){this.vault=e;this.noteRepository=r;this.similarNoteFinder=n;this.settingsService=i;this.noteBottomViewModel$=new Pn({currentFile:null,similarNoteEntries:[],noteDisplayMode:"title"});this.cache=new Map;let o=this.noteBottomViewModel$.value;this.noteBottomViewModel$.next({...o,noteDisplayMode:this.settingsService.get().noteDisplayMode}),this.settingsService.getNewSettingsObservable().subscribe(s=>{s.includeFrontmatter!==void 0&&this.cache.clear();let a=this.noteBottomViewModel$.value;this.noteBottomViewModel$.next({...a,noteDisplayMode:this.settingsService.get().noteDisplayMode})})}getNoteBottomViewModelObservable(){return this.noteBottomViewModel$.asObservable()}async onFileOpen(e){e&&this.emitNoteBottomViewModel(e)}async emitNoteBottomViewModelFromPath(e){let r=this.vault.getFileByPath(e);r&&this.emitNoteBottomViewModel(r)}async emitNoteBottomViewModel(e){let r=await this.getSimilarNotes(e);this.noteBottomViewModel$.next({currentFile:e,similarNoteEntries:r,noteDisplayMode:this.settingsService.get().noteDisplayMode})}async getSimilarNotes(e){let r=this.cache.get(e.path);if(r&&r.mtime===e.stat.mtime)return r.notes;let n=await this.noteRepository.findByFile(e,!this.settingsService.get().includeFrontmatter),i=await this.similarNoteFinder.findSimilarNotes(n),o=this.settingsService.get().showSourceChunk,s=i.map(a=>({file:this.vault.getFileByPath(a.path),title:a.title,similarity:a.similarity,preview:a.similarChunk,sourceChunk:o?a.sourceChunk:void 0})).filter(a=>a.file!==null);if(this.cache.set(e.path,{mtime:e.stat.mtime,notes:s}),this.cache.size>kS){let a=this.cache.keys().next().value;this.cache.delete(a)}return s}};var Wi=Z(Qe()),Cn=class{constructor(e="http://localhost:11434"){this.baseUrl=e.endsWith("/")?e.slice(0,-1):e}async getModels(){try{let e=await fetch(`${this.baseUrl}/api/tags`);if(!e.ok)throw new Error(`Failed to fetch models: ${e.statusText}`);let r=await e.json();return!r.models||!Array.isArray(r.models)?(Wi.default.warn("Ollama API returned invalid models data",r),[]):r.models}catch(e){throw Wi.default.error("Failed to fetch Ollama models",e),e}}async getModelNames(){return(await this.getModels()).map(r=>r.name)}async generateEmbedding(e,r){try{let n=await fetch(`${this.baseUrl}/api/embeddings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:e,prompt:r})});if(!n.ok){let o=await n.text();throw new Error(`Failed to generate embedding: ${n.statusText}. ${o}`)}let i=await n.json();if(!i.embedding||!Array.isArray(i.embedding))throw new Error("Invalid embedding response from Ollama");return i.embedding}catch(n){throw Wi.default.error("Failed to generate embedding",n),n}}async testConnection(){try{return(await fetch(`${this.baseUrl}/api/tags`)).ok}catch(e){return Wi.default.error("Failed to connect to Ollama server",e),!1}}async testModel(e){try{return await this.generateEmbedding(e,"test"),!0}catch(r){return Wi.default.error(`Failed to test model ${e}`,r),!1}}setBaseUrl(e){this.baseUrl=e.endsWith("/")?e.slice(0,-1):e}getBaseUrl(){return this.baseUrl}};var en=Z(Qe()),X=require("obsidian");var kl=require("obsidian"),ls=class extends kl.Modal{constructor(e,r,n,i){super(e),this.setContent(r),new kl.Setting(this.contentEl).addButton(o=>o.setButtonText("Continue").setCta().onClick(()=>{this.close(),n()})).addButton(o=>o.setButtonText("Cancel").onClick(()=>{this.close(),i()}))}};var El=class extends X.PluginSettingTab{constructor(r,n,i){super(r.app,r);this.plugin=r;this.settingsService=n;this.indexedNoteCount=0;this.subscription=null;i&&this.setMTimeStore(i)}setMTimeStore(r){this.subscription&&this.subscription.unsubscribe(),this.mTimeStore=r,this.indexedNoteCount=this.mTimeStore.getCurrentIndexedNoteCount(),this.subscription=this.mTimeStore.getIndexedNoteCount$().subscribe(n=>{this.indexedNoteCount=n,this.containerEl.isShown()&&this.display()})}onClose(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null)}display(){let r=this.settingsService.get(),{containerEl:n}=this;n.empty(),this.tempModelProvider=this.tempModelProvider??r.modelProvider,this.tempModelId=this.tempModelId??r.modelId,this.tempOllamaUrl=this.tempOllamaUrl??r.ollamaUrl,this.tempOllamaModel=this.tempOllamaModel??r.ollamaModel,this.tempUseGPU=this.tempUseGPU??r.useGPU,new X.Setting(n).setName("Auto-save interval").setDesc("How often to save changes to disk (in minutes)").addText(y=>{y.setValue(r.autoSaveInterval.toString()).onChange(async v=>{await this.settingsService.update({autoSaveInterval:Number.parseInt(v,10)})})}),new X.Setting(n).setName("Model").setHeading();let i=r.modelProvider==="builtin"&&r.useGPU?" (GPU)":"",o=r.modelProvider==="builtin"?`Built-in: ${r.modelId}${i}`:r.modelProvider==="ollama"?`Ollama: ${r.ollamaModel||"Not configured"}`:"Not configured";if(new X.Setting(n).setName("Current model").setDesc(o),new X.Setting(n).setName("Model provider").setDesc("Choose between built-in models or Ollama").addDropdown(y=>{y.addOption("builtin","Built-in Models").addOption("ollama","Ollama").setValue(this.tempModelProvider||"builtin").onChange(v=>{this.tempModelProvider=v,this.display()})}),this.tempModelProvider==="builtin"){let y=["sentence-transformers/all-MiniLM-L6-v2","sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2"];new X.Setting(n).setName("Recommended models").setDesc("Select from recommended embedding models").addDropdown(v=>{for(let x of y)v.addOption(x,x);v.setValue(this.tempModelId||r.modelId),v.onChange(x=>{this.tempModelId=x,this.display()})}),new X.Setting(n).setName("Custom model").setDesc("Enter a custom model ID from Hugging Face").addText(v=>{v.setValue(this.tempModelId||"").onChange(x=>{this.tempModelId=x,this.updateApplyButtonState(r)})}),new X.Setting(n).setName("Use GPU acceleration").setDesc("If enabled, WebGPU will be used for model inference. Disable if you experience issues with GPU acceleration.").addToggle(v=>{v.setValue(this.tempUseGPU??r.useGPU).onChange(x=>{this.tempUseGPU=x,setTimeout(()=>{this.display()},150)})})}else if(this.tempModelProvider==="ollama"){let y=this.tempOllamaUrl||r.ollamaUrl||"http://localhost:11434",v=new Cn(y),x=[],k=null,E=async()=>{k=null;try{x=await v.getModelNames()}catch(D){k=D instanceof Error?D.message:"Failed to fetch models",x=[]}};new X.Setting(n).setName("Ollama server URL").setDesc("URL of your Ollama server (default: http://localhost:11434)").addText(D=>{D.setPlaceholder("http://localhost:11434").setValue(y).onChange(ge=>{this.tempOllamaUrl=ge,v.setBaseUrl(ge),this.display()})});let H=new X.Setting(n).setName("Ollama model").setDesc("Select an Ollama model for embeddings"),C;H.addDropdown(D=>{C=D,D.addOption("","Loading models..."),D.setValue(this.tempOllamaModel||""),D.onChange(ge=>{this.tempOllamaModel=ge,this.display()})}),H.addButton(D=>{D.setButtonText("Refresh").setTooltip("Refresh model list").onClick(async()=>{await E(),this.display()})}),E().then(()=>{C.selectEl.empty(),k?C.addOption("",`Error: ${k}`):x.length===0?C.addOption("","No models found"):(C.addOption("","Select a model"),x.forEach(D=>{C.addOption(D,D)}),this.tempOllamaModel&&x.includes(this.tempOllamaModel)&&C.setValue(this.tempOllamaModel))}),new X.Setting(n).setName("Test connection").setDesc("Test the connection to Ollama server and selected model").addButton(D=>{D.setButtonText("Test").onClick(async()=>{let ge=this.tempOllamaModel;if(!ge){new X.Notice("Please select a model first");return}new X.Notice(`Testing connection to ${y} with model ${ge}...`);try{await v.testModel(ge)?new X.Notice("Connection successful! Model is ready for embeddings."):new X.Notice("Connection failed: Model test failed")}catch(un){new X.Notice(`Connection failed: ${un}`)}})})}let s=this.hasModelChanges(r),a=this.tempModelProvider==="builtin"?"Load & Apply":"Apply Changes",l=s?"Apply the selected model configuration. This will rebuild the similarity index.":"No changes to apply. Modify settings above to enable this button.";new X.Setting(n).setName("Apply model changes").setDesc(l).addButton(y=>{this.applyButton=y,y.setButtonText(a).setDisabled(!s).onClick(async()=>{s&&await this.applyModelChanges(r)}),s&&y.setCta()}),new X.Setting(n).setName("Index").setHeading(),new X.Setting(n).setName("Indexed notes").setDesc(`Number of notes currently in the similarity index: ${this.indexedNoteCount}`),new X.Setting(n).setName("Reindex notes").setDesc("Rebuild the similarity index for all notes").addButton(y=>{y.setButtonText("Reindex").onClick(async()=>{await this.plugin.reindexNotes()})}),new X.Setting(n).setName("Include frontmatter in indexing and search").setDesc("If enabled, the frontmatter of each note will be included in the similarity index and search.").addToggle(y=>{y.setValue(r.includeFrontmatter).onChange(async v=>{await this.settingsService.update({includeFrontmatter:v})})});let u=()=>{let v=h?.value||"";try{let k=this.settingsService.get().excludeRegexPatterns;for(let E of k){let H=new RegExp(E,"gm");v=v.replace(H,"")}g.value=v}catch(x){g.value=`Error processing RegExp: ${x.message}`}};new X.Setting(n).setName("Exclude content from indexing").setDesc("Enter regular expressions to exclude content from indexing (one per line). Note: Only applies to newly modified notes. Use Reindex to apply to all notes.").addTextArea(y=>{y.inputEl.rows=5,y.inputEl.cols=40,y.setValue(r.excludeRegexPatterns.join(`
`));let v=new Map,x="similar-notes-regexp-error",k=()=>{let E=y.inputEl,H=E.value.split(`
`);if(E.removeClass(x),E.title="",v.size>0){E.addClass(x);let C=Array.from(v.entries()).map(([D,ge])=>`Line ${D+1}: ${ge}`).join(`
`);E.title=C}};y.onChange(async E=>{v.clear();let H=E.split(`
`),C=[];H.forEach((D,ge)=>{if(D.trim().length!==0)try{new RegExp(D),C.push(D)}catch(un){v.set(ge,un.message)}}),k(),await this.settingsService.update({excludeRegexPatterns:C}),u()})});let c=n.createDiv("similar-notes-regexp-tester");c.addClass("setting-item"),c.createDiv("setting-item-info").createDiv("setting-item-description").setText("Test your regular expressions against sample text");let f=c.createDiv("setting-item-control similar-notes-regexp-tester-content"),_=f.createDiv("similar-notes-test-input-container"),w=f.createDiv("similar-notes-test-output-container");_.createDiv("similar-notes-test-label").setText("Input text:"),w.createDiv("similar-notes-test-label").setText("Result (content that will be indexed):");let h=_.createEl("textarea");h.rows=8,h.cols=30,h.placeholder="Enter text to test against your regular expressions",h.value=r.regexpTestInputText||"";let g=w.createEl("textarea");g.rows=8,g.cols=30,g.readOnly=!0,g.placeholder="Filtered content will appear here",h.addEventListener("input",()=>{this.settingsService.update({regexpTestInputText:h.value}),u()}),setTimeout(()=>u(),0),new X.Setting(n).setName("Display").setHeading(),new X.Setting(n).setName("Note display mode").setDesc("Choose how note names are displayed in the results").addDropdown(y=>{y.addOption("title","Title only").addOption("path","Full path").addOption("smart","Smart (path when duplicates exist)").setValue(r.noteDisplayMode).onChange(async v=>{await this.settingsService.update({noteDisplayMode:v})})}),new X.Setting(n).setName("Show source chunk in results").setDesc("If enabled, the source chunk (the part of your current note used for similarity search) will be shown in the results").addToggle(y=>{y.setValue(r.showSourceChunk).onChange(async v=>{await this.settingsService.update({showSourceChunk:v})})}),new X.Setting(n).setName("Debug").setHeading(),new X.Setting(n).setName("Log level").setDesc("Set the logging level for debugging purposes").addDropdown(y=>{y.addOption(en.default.levels.TRACE.toString(),"TRACE").addOption(en.default.levels.DEBUG.toString(),"DEBUG").addOption(en.default.levels.INFO.toString(),"INFO").addOption(en.default.levels.WARN.toString(),"WARN").addOption(en.default.levels.ERROR.toString(),"ERROR").addOption(en.default.levels.SILENT.toString(),"SILENT").setValue(en.default.getLevel().toString()).onChange(v=>{this.plugin.setLogLevel(Number(v))})})}hasModelChanges(r){return this.tempModelProvider!==r.modelProvider||this.tempModelProvider==="builtin"&&this.tempModelId&&this.tempModelId!==r.modelId||this.tempModelProvider==="ollama"&&(this.tempOllamaUrl!==r.ollamaUrl||this.tempOllamaModel!==r.ollamaModel)||this.tempModelProvider==="builtin"&&this.tempUseGPU!==r.useGPU}async applyModelChanges(r){if(this.tempModelProvider==="builtin"){let n=this.tempModelId||r.modelId,i="The model will be downloaded from Hugging Face (this might take a while) and all your notes will be reindexed. Do you want to continue?";new ls(this.app,i,async()=>{await this.settingsService.update({modelProvider:this.tempModelProvider,modelId:n,useGPU:this.tempUseGPU??r.useGPU}),this.plugin.changeModel(n),this.clearTempState(),this.display()},()=>{}).open()}else if(this.tempModelProvider==="ollama"){let n="Your embedding model will be changed and all notes will be reindexed. Do you want to continue?";new ls(this.app,n,async()=>{await this.settingsService.update({modelProvider:this.tempModelProvider,ollamaUrl:this.tempOllamaUrl,ollamaModel:this.tempOllamaModel}),this.plugin.changeModel(this.tempOllamaModel||""),this.clearTempState(),this.display()},()=>{}).open()}}clearTempState(){this.tempModelProvider=void 0,this.tempModelId=void 0,this.tempOllamaUrl=void 0,this.tempOllamaModel=void 0,this.tempUseGPU=void 0}updateApplyButtonState(r){if(!this.applyButton)return;let n=this.hasModelChanges(r),i=this.tempModelProvider==="builtin"?"Load & Apply":"Apply Changes";this.applyButton.setButtonText(i).setDisabled(!n),n?this.applyButton.setCta():this.applyButton.removeCta()}};var wy=require("obsidian"),Pl=class{constructor(e,r,n,i){this.plugin=e;this.noteChangeCount$=r;this.modelBusy$=n;this.downloadProgress$=i;this.lastNotifiedThreshold=null;this.modelBusyItem=this.plugin.addStatusBarItem(),this.modelDownloadProgressItem=this.plugin.addStatusBarItem(),this.noteCountItem=this.plugin.addStatusBarItem(),this.downloadProgress$.subscribe(o=>{o<100?(this.modelDownloadProgressItem.setText(`${Math.floor(o)}%`),this.modelDownloadProgressItem.show()):this.modelDownloadProgressItem.hide()}),this.noteChangeCount$.subscribe(o=>{if(o>10){this.noteCountItem.setText(`${o} to index`),this.noteCountItem.show();let s=Math.floor((o-1)/100)*100+100;this.lastNotifiedThreshold!==null&&s<this.lastNotifiedThreshold&&new wy.Notice(`Similar Notes: ${o} notes remaining to index`),this.lastNotifiedThreshold=s}else this.noteCountItem.hide(),this.lastNotifiedThreshold=null})}setStatus(e){e==="ready"?this.modelBusyItem.setText(""):e==="error"&&(this.modelBusyItem.setText("Error loading model"),this.modelBusyItem.show())}dispose(){this.noteCountItem.remove(),this.modelBusyItem.remove(),this.modelDownloadProgressItem.remove()}};var In=Z(Qe());var us=Z(Qe());function $p(){return uo('var S0=Object.create;var li=Object.defineProperty,I0=Object.defineProperties,F0=Object.getOwnPropertyDescriptor,$0=Object.getOwnPropertyDescriptors,A0=Object.getOwnPropertyNames,ii=Object.getOwnPropertySymbols,D0=Object.getPrototypeOf,rc=Object.prototype.hasOwnProperty,rf=Object.prototype.propertyIsEnumerable;var ec=(e,r)=>(r=Symbol[e])?r:Symbol.for("Symbol."+e),O0=e=>{throw TypeError(e)};var tc=(e,r,t)=>r in e?li(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,Fe=(e,r)=>{for(var t in r||(r={}))rc.call(r,t)&&tc(e,t,r[t]);if(ii)for(var t of ii(r))rf.call(r,t)&&tc(e,t,r[t]);return e},Ct=(e,r)=>I0(e,$0(r));var ka=(e=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(e,{get:(r,t)=>(typeof require!="undefined"?require:r)[t]}):e)(function(e){if(typeof require!="undefined")return require.apply(this,arguments);throw Error(\'Dynamic require of "\'+e+\'" is not supported\')});var ns=(e,r)=>{var t={};for(var s in e)rc.call(e,s)&&r.indexOf(s)<0&&(t[s]=e[s]);if(e!=null&&ii)for(var s of ii(e))r.indexOf(s)<0&&rf.call(e,s)&&(t[s]=e[s]);return t};var Er=(e,r)=>()=>(e&&(r=e(e=0)),r);var L0=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),sc=(e,r)=>{for(var t in r)li(e,t,{get:r[t],enumerable:!0})},z0=(e,r,t,s)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of A0(r))!rc.call(e,o)&&o!==t&&li(e,o,{get:()=>r[o],enumerable:!(s=F0(r,o))||s.enumerable});return e};var B0=(e,r,t)=>(t=e!=null?S0(D0(e)):{},z0(r||!e||!e.__esModule?li(t,"default",{value:e,enumerable:!0}):t,e));var ee=(e,r,t)=>tc(e,typeof r!="symbol"?r+"":r,t);var R0=function(e,r){this[0]=e,this[1]=r};var sf=e=>{var r=e[ec("asyncIterator")],t=!1,s,o={};return r==null?(r=e[ec("iterator")](),s=a=>o[a]=n=>r[a](n)):(r=r.call(e),s=a=>o[a]=n=>{if(t){if(t=!1,a==="throw")throw n;return n}return t=!0,{done:!1,value:new R0(new Promise(i=>{var l=r[a](n);l instanceof Object||O0("Object expected"),i(l)}),1)}}),o[ec("iterator")]=()=>o,s("next"),"throw"in r?s("throw"):o.throw=a=>{throw a},"return"in r&&s("return"),o};var pf=L0((_f,hi)=>{(function(e,r){"use strict";typeof define=="function"&&define.amd?define(r):typeof hi=="object"&&hi.exports?hi.exports=r():e.log=r()})(_f,function(){"use strict";var e=function(){},r="undefined",t=typeof window!==r&&typeof window.navigator!==r&&/Trident\\/|MSIE /.test(window.navigator.userAgent),s=["trace","debug","info","warn","error"],o={},a=null;function n(h,v){var E=h[v];if(typeof E.bind=="function")return E.bind(h);try{return Function.prototype.bind.call(E,h)}catch(M){return function(){return Function.prototype.apply.apply(E,[h,arguments])}}}function i(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(h){return h==="debug"&&(h="log"),typeof console===r?!1:h==="trace"&&t?i:console[h]!==void 0?n(console,h):console.log!==void 0?n(console,"log"):e}function c(){for(var h=this.getLevel(),v=0;v<s.length;v++){var E=s[v];this[E]=v<h?e:this.methodFactory(E,h,this.name)}if(this.log=this.debug,typeof console===r&&h<this.levels.SILENT)return"No console available for logging"}function _(h){return function(){typeof console!==r&&(c.call(this),this[h].apply(this,arguments))}}function d(h,v,E){return l(h)||_.apply(this,arguments)}function u(h,v){var E=this,M,w,C,x="loglevel";typeof h=="string"?x+=":"+h:typeof h=="symbol"&&(x=void 0);function T(A){var N=(s[A]||"silent").toUpperCase();if(!(typeof window===r||!x)){try{window.localStorage[x]=N;return}catch(W){}try{window.document.cookie=encodeURIComponent(x)+"="+N+";"}catch(W){}}}function S(){var A;if(!(typeof window===r||!x)){try{A=window.localStorage[x]}catch(J){}if(typeof A===r)try{var N=window.document.cookie,W=encodeURIComponent(x),R=N.indexOf(W+"=");R!==-1&&(A=/^([^;]+)/.exec(N.slice(R+W.length+1))[1])}catch(J){}return E.levels[A]===void 0&&(A=void 0),A}}function g(){if(!(typeof window===r||!x)){try{window.localStorage.removeItem(x)}catch(A){}try{window.document.cookie=encodeURIComponent(x)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(A){}}}function P(A){var N=A;if(typeof N=="string"&&E.levels[N.toUpperCase()]!==void 0&&(N=E.levels[N.toUpperCase()]),typeof N=="number"&&N>=0&&N<=E.levels.SILENT)return N;throw new TypeError("log.setLevel() called with invalid level: "+A)}E.name=h,E.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},E.methodFactory=v||d,E.getLevel=function(){return C!=null?C:w!=null?w:M},E.setLevel=function(A,N){return C=P(A),N!==!1&&T(C),c.call(E)},E.setDefaultLevel=function(A){w=P(A),S()||E.setLevel(A,!1)},E.resetLevel=function(){C=null,g(),c.call(E)},E.enableAll=function(A){E.setLevel(E.levels.TRACE,A)},E.disableAll=function(A){E.setLevel(E.levels.SILENT,A)},E.rebuild=function(){if(a!==E&&(M=P(a.getLevel())),c.call(E),a===E)for(var A in o)o[A].rebuild()},M=P(a?a.getLevel():"WARN");var $=S();$!=null&&(C=P($)),c.call(E)}a=new u,a.getLogger=function(v){if(typeof v!="symbol"&&typeof v!="string"||v==="")throw new TypeError("You must supply a name when creating a logger.");var E=o[v];return E||(E=o[v]=new u(v,a.methodFactory)),E};var f=typeof window!==r?window.log:void 0;return a.noConflict=function(){return typeof window!==r&&window.log===a&&(window.log=f),a},a.getLoggers=function(){return o},a.default=a,a})});var fi,Sa,mf,eT,hf,nc=Er(()=>{fi=new Map,Sa=[],mf=(e,r,t)=>{if(r&&typeof r.init=="function"&&typeof r.createInferenceSessionHandler=="function"){let s=fi.get(e);if(s===void 0)fi.set(e,{backend:r,priority:t});else{if(s.priority>t)return;if(s.priority===t&&s.backend!==r)throw new Error(`cannot register backend "${e}" using priority ${t}`)}if(t>=0){let o=Sa.indexOf(e);o!==-1&&Sa.splice(o,1);for(let a=0;a<Sa.length;a++)if(fi.get(Sa[a]).priority<=t){Sa.splice(a,0,e);return}Sa.push(e)}return}throw new TypeError("not a valid backend")},eT=async e=>{let r=fi.get(e);if(!r)return"backend not found.";if(r.initialized)return r.backend;if(r.aborted)return r.error;{let t=!!r.initPromise;try{return t||(r.initPromise=r.backend.init(e)),await r.initPromise,r.initialized=!0,r.backend}catch(s){return t||(r.error=`${s}`,r.aborted=!0),r.error}finally{delete r.initPromise}}},hf=async e=>{let r=e.executionProviders||[],t=r.map(l=>typeof l=="string"?l:l.name),s=t.length===0?Sa:t,o,a=[],n=new Set;for(let l of s){let c=await eT(l);typeof c=="string"?a.push({name:l,err:c}):(o||(o=c),o===c&&n.add(l))}if(!o)throw new Error(`no available backend found. ERR: ${a.map(l=>`[${l.name}] ${l.err}`).join(", ")}`);for(let{name:l,err:c}of a)t.includes(l)&&console.warn(`removing requested execution provider "${l}" from session options because it is not available: ${c}`);let i=r.filter(l=>n.has(typeof l=="string"?l:l.name));return[o,new Proxy(e,{get:(l,c)=>c==="executionProviders"?i:Reflect.get(l,c)})]}});var ff=Er(()=>{nc()});var gf,Mf=Er(()=>{gf="1.21.0"});var wf,cs,ic=Er(()=>{Mf();wf="warning",cs={wasm:{},webgl:{},webgpu:{},versions:{common:gf},set logLevel(e){if(e!==void 0){if(typeof e!="string"||["verbose","info","warning","error","fatal"].indexOf(e)===-1)throw new Error(`Unsupported logging level: ${e}`);wf=e}},get logLevel(){return wf}};Object.defineProperty(cs,"logLevel",{enumerable:!0})});var tT,bf=Er(()=>{ic();tT=cs});var vf,xf,yf=Er(()=>{vf=(e,r)=>{let t=typeof document!="undefined"?document.createElement("canvas"):new OffscreenCanvas(1,1);t.width=e.dims[3],t.height=e.dims[2];let s=t.getContext("2d");if(s!=null){let o,a;(r==null?void 0:r.tensorLayout)!==void 0&&r.tensorLayout==="NHWC"?(o=e.dims[2],a=e.dims[3]):(o=e.dims[3],a=e.dims[2]);let n=(r==null?void 0:r.format)!==void 0?r.format:"RGB",i=r==null?void 0:r.norm,l,c;i===void 0||i.mean===void 0?l=[255,255,255,255]:typeof i.mean=="number"?l=[i.mean,i.mean,i.mean,i.mean]:(l=[i.mean[0],i.mean[1],i.mean[2],0],i.mean[3]!==void 0&&(l[3]=i.mean[3])),i===void 0||i.bias===void 0?c=[0,0,0,0]:typeof i.bias=="number"?c=[i.bias,i.bias,i.bias,i.bias]:(c=[i.bias[0],i.bias[1],i.bias[2],0],i.bias[3]!==void 0&&(c[3]=i.bias[3]));let _=a*o,d=0,u=_,f=_*2,h=-1;n==="RGBA"?(d=0,u=_,f=_*2,h=_*3):n==="RGB"?(d=0,u=_,f=_*2):n==="RBG"&&(d=0,f=_,u=_*2);for(let v=0;v<a;v++)for(let E=0;E<o;E++){let M=(e.data[d++]-c[0])*l[0],w=(e.data[u++]-c[1])*l[1],C=(e.data[f++]-c[2])*l[2],x=h===-1?255:(e.data[h++]-c[3])*l[3];s.fillStyle="rgba("+M+","+w+","+C+","+x+")",s.fillRect(E,v,1,1)}if("toDataURL"in t)return t.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},xf=(e,r)=>{let t=typeof document!="undefined"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),s;if(t!=null){let o,a,n;(r==null?void 0:r.tensorLayout)!==void 0&&r.tensorLayout==="NHWC"?(o=e.dims[2],a=e.dims[1],n=e.dims[3]):(o=e.dims[3],a=e.dims[2],n=e.dims[1]);let i=r!==void 0&&r.format!==void 0?r.format:"RGB",l=r==null?void 0:r.norm,c,_;l===void 0||l.mean===void 0?c=[255,255,255,255]:typeof l.mean=="number"?c=[l.mean,l.mean,l.mean,l.mean]:(c=[l.mean[0],l.mean[1],l.mean[2],255],l.mean[3]!==void 0&&(c[3]=l.mean[3])),l===void 0||l.bias===void 0?_=[0,0,0,0]:typeof l.bias=="number"?_=[l.bias,l.bias,l.bias,l.bias]:(_=[l.bias[0],l.bias[1],l.bias[2],0],l.bias[3]!==void 0&&(_[3]=l.bias[3]));let d=a*o;if(r!==void 0&&(r.format!==void 0&&n===4&&r.format!=="RGBA"||n===3&&r.format!=="RGB"&&r.format!=="BGR"))throw new Error("Tensor format doesn\'t match input tensor dims");let u=4,f=0,h=1,v=2,E=3,M=0,w=d,C=d*2,x=-1;i==="RGBA"?(M=0,w=d,C=d*2,x=d*3):i==="RGB"?(M=0,w=d,C=d*2):i==="RBG"&&(M=0,C=d,w=d*2),s=t.createImageData(o,a);for(let T=0;T<a*o;f+=u,h+=u,v+=u,E+=u,T++)s.data[f]=(e.data[M++]-_[0])*c[0],s.data[h]=(e.data[w++]-_[1])*c[1],s.data[v]=(e.data[C++]-_[2])*c[2],s.data[E]=x===-1?255:(e.data[x++]-_[3])*c[3]}else throw new Error("Can not access image data");return s}});var lc,Tf,Pf,Ef,kf,Cf,Sf=Er(()=>{gi();lc=(e,r)=>{var T,S,g;if(e===void 0)throw new Error("Image buffer must be defined");if(r.height===void 0||r.width===void 0)throw new Error("Image height and width must be defined");if(r.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:t,width:s}=r,o=(T=r.norm)!=null?T:{mean:255,bias:0},a,n;typeof o.mean=="number"?a=[o.mean,o.mean,o.mean,o.mean]:a=[o.mean[0],o.mean[1],o.mean[2],(S=o.mean[3])!=null?S:255],typeof o.bias=="number"?n=[o.bias,o.bias,o.bias,o.bias]:n=[o.bias[0],o.bias[1],o.bias[2],(g=o.bias[3])!=null?g:0];let i=r.format!==void 0?r.format:"RGBA",l=r.tensorFormat!==void 0&&r.tensorFormat!==void 0?r.tensorFormat:"RGB",c=t*s,_=l==="RGBA"?new Float32Array(c*4):new Float32Array(c*3),d=4,u=0,f=1,h=2,v=3,E=0,M=c,w=c*2,C=-1;i==="RGB"&&(d=3,u=0,f=1,h=2,v=-1),l==="RGBA"?C=c*3:l==="RBG"?(E=0,w=c,M=c*2):l==="BGR"&&(w=0,M=c,E=c*2);for(let P=0;P<c;P++,u+=d,h+=d,f+=d,v+=d)_[E++]=(e[u]+n[0])/a[0],_[M++]=(e[f]+n[1])/a[1],_[w++]=(e[h]+n[2])/a[2],C!==-1&&v!==-1&&(_[C++]=(e[v]+n[3])/a[3]);return l==="RGBA"?new Hr("float32",_,[1,4,t,s]):new Hr("float32",_,[1,3,t,s])},Tf=async(e,r)=>{let t=typeof HTMLImageElement!="undefined"&&e instanceof HTMLImageElement,s=typeof ImageData!="undefined"&&e instanceof ImageData,o=typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap,a=typeof e=="string",n,i=r!=null?r:{},l=()=>{if(typeof document!="undefined")return document.createElement("canvas");if(typeof OffscreenCanvas!="undefined")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},c=_=>typeof HTMLCanvasElement!="undefined"&&_ instanceof HTMLCanvasElement||_ instanceof OffscreenCanvas?_.getContext("2d"):null;if(t){let _=l();_.width=e.width,_.height=e.height;let d=c(_);if(d!=null){let u=e.height,f=e.width;if(r!==void 0&&r.resizedHeight!==void 0&&r.resizedWidth!==void 0&&(u=r.resizedHeight,f=r.resizedWidth),r!==void 0){if(i=r,r.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");i.tensorFormat="RGBA",i.height=u,i.width=f}else i.tensorFormat="RGBA",i.height=u,i.width=f;d.drawImage(e,0,0),n=d.getImageData(0,0,f,u).data}else throw new Error("Can not access image data")}else if(s){let _,d;if(r!==void 0&&r.resizedWidth!==void 0&&r.resizedHeight!==void 0?(_=r.resizedHeight,d=r.resizedWidth):(_=e.height,d=e.width),r!==void 0&&(i=r),i.format="RGBA",i.height=_,i.width=d,r!==void 0){let u=l();u.width=d,u.height=_;let f=c(u);if(f!=null)f.putImageData(e,0,0),n=f.getImageData(0,0,d,_).data;else throw new Error("Can not access image data")}else n=e.data}else if(o){if(r===void 0)throw new Error("Please provide image config with format for Imagebitmap");let _=l();_.width=e.width,_.height=e.height;let d=c(_);if(d!=null){let u=e.height,f=e.width;return d.drawImage(e,0,0,f,u),n=d.getImageData(0,0,f,u).data,i.height=u,i.width=f,lc(n,i)}else throw new Error("Can not access image data")}else{if(a)return new Promise((_,d)=>{let u=l(),f=c(u);if(!e||!f)return d();let h=new Image;h.crossOrigin="Anonymous",h.src=e,h.onload=()=>{u.width=h.width,u.height=h.height,f.drawImage(h,0,0,u.width,u.height);let v=f.getImageData(0,0,u.width,u.height);i.height=u.height,i.width=u.width,_(lc(v.data,i))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(n!==void 0)return lc(n,i);throw new Error("Input data provided is not supported - aborted tensor creation")},Pf=(e,r)=>{let{width:t,height:s,download:o,dispose:a}=r,n=[1,s,t,4];return new Hr({location:"texture",type:"float32",texture:e,dims:n,download:o,dispose:a})},Ef=(e,r)=>{let{dataType:t,dims:s,download:o,dispose:a}=r;return new Hr({location:"gpu-buffer",type:t!=null?t:"float32",gpuBuffer:e,dims:s,download:o,dispose:a})},kf=(e,r)=>{let{dataType:t,dims:s,download:o,dispose:a}=r;return new Hr({location:"ml-tensor",type:t!=null?t:"float32",mlTensor:e,dims:s,download:o,dispose:a})},Cf=(e,r,t)=>new Hr({location:"cpu-pinned",type:e,data:r,dims:t!=null?t:[r.length]})});var Ia,Yo,If,Ff,$f=Er(()=>{Ia=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),Yo=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),If=!1,Ff=()=>{if(!If){If=!0;let e=typeof BigInt64Array!="undefined"&&BigInt64Array.from,r=typeof BigUint64Array!="undefined"&&BigUint64Array.from,t=globalThis.Float16Array,s=typeof t!="undefined"&&t.from;e&&(Ia.set("int64",BigInt64Array),Yo.set(BigInt64Array,"int64")),r&&(Ia.set("uint64",BigUint64Array),Yo.set(BigUint64Array,"uint64")),s?(Ia.set("float16",t),Yo.set(t,"float16")):Ia.set("float16",Uint16Array)}}});var Af,Df,Of=Er(()=>{gi();Af=e=>{let r=1;for(let t=0;t<e.length;t++){let s=e[t];if(typeof s!="number"||!Number.isSafeInteger(s))throw new TypeError(`dims[${t}] must be an integer, got: ${s}`);if(s<0)throw new RangeError(`dims[${t}] must be a non-negative integer, got: ${s}`);r*=s}return r},Df=(e,r)=>{switch(e.location){case"cpu":return new Hr(e.type,e.data,r);case"cpu-pinned":return new Hr({location:"cpu-pinned",data:e.data,type:e.type,dims:r});case"texture":return new Hr({location:"texture",texture:e.texture,type:e.type,dims:r});case"gpu-buffer":return new Hr({location:"gpu-buffer",gpuBuffer:e.gpuBuffer,type:e.type,dims:r});case"ml-tensor":return new Hr({location:"ml-tensor",mlTensor:e.mlTensor,type:e.type,dims:r});default:throw new Error(`tensorReshape: tensor location ${e.location} is not supported`)}}});var Hr,gi=Er(()=>{yf();Sf();$f();Of();Hr=class{constructor(r,t,s){Ff();let o,a;if(typeof r=="object"&&"location"in r)switch(this.dataLocation=r.location,o=r.type,a=r.dims,r.location){case"cpu-pinned":{let i=Ia.get(o);if(!i)throw new TypeError(`unsupported type "${o}" to create tensor from pinned buffer`);if(!(r.data instanceof i))throw new TypeError(`buffer should be of type ${i.name}`);this.cpuData=r.data;break}case"texture":{if(o!=="float32")throw new TypeError(`unsupported type "${o}" to create tensor from texture`);this.gpuTextureData=r.texture,this.downloader=r.download,this.disposer=r.dispose;break}case"gpu-buffer":{if(o!=="float32"&&o!=="float16"&&o!=="int32"&&o!=="int64"&&o!=="uint32"&&o!=="uint8"&&o!=="bool"&&o!=="uint4"&&o!=="int4")throw new TypeError(`unsupported type "${o}" to create tensor from gpu buffer`);this.gpuBufferData=r.gpuBuffer,this.downloader=r.download,this.disposer=r.dispose;break}case"ml-tensor":{if(o!=="float32"&&o!=="float16"&&o!=="int32"&&o!=="int64"&&o!=="uint32"&&o!=="uint64"&&o!=="int8"&&o!=="uint8"&&o!=="bool"&&o!=="uint4"&&o!=="int4")throw new TypeError(`unsupported type "${o}" to create tensor from MLTensor`);this.mlTensorData=r.mlTensor,this.downloader=r.download,this.disposer=r.dispose;break}default:throw new Error(`Tensor constructor: unsupported location \'${this.dataLocation}\'`)}else{let i,l;if(typeof r=="string")if(o=r,l=s,r==="string"){if(!Array.isArray(t))throw new TypeError("A string tensor\'s data must be a string array.");i=t}else{let c=Ia.get(r);if(c===void 0)throw new TypeError(`Unsupported tensor type: ${r}.`);if(Array.isArray(t)){if(r==="float16"&&c===Uint16Array||r==="uint4"||r==="int4")throw new TypeError(`Creating a ${r} tensor from number array is not supported. Please use ${c.name} as data.`);r==="uint64"||r==="int64"?i=c.from(t,BigInt):i=c.from(t)}else if(t instanceof c)i=t;else if(t instanceof Uint8ClampedArray)if(r==="uint8")i=Uint8Array.from(t);else throw new TypeError("A Uint8ClampedArray tensor\'s data must be type of uint8");else if(r==="float16"&&t instanceof Uint16Array&&c!==Uint16Array)i=new globalThis.Float16Array(t.buffer,t.byteOffset,t.length);else throw new TypeError(`A ${o} tensor\'s data must be type of ${c}`)}else if(l=t,Array.isArray(r)){if(r.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let c=typeof r[0];if(c==="string")o="string",i=r;else if(c==="boolean")o="bool",i=Uint8Array.from(r);else throw new TypeError(`Invalid element type of data array: ${c}.`)}else if(r instanceof Uint8ClampedArray)o="uint8",i=Uint8Array.from(r);else{let c=Yo.get(r.constructor);if(c===void 0)throw new TypeError(`Unsupported type for tensor data: ${r.constructor}.`);o=c,i=r}if(l===void 0)l=[i.length];else if(!Array.isArray(l))throw new TypeError("A tensor\'s dims must be a number array");a=l,this.cpuData=i,this.dataLocation="cpu"}let n=Af(a);if(this.cpuData&&n!==this.cpuData.length&&!((o==="uint4"||o==="int4")&&Math.ceil(n/2)===this.cpuData.length))throw new Error(`Tensor\'s size(${n}) does not match data length(${this.cpuData.length}).`);this.type=o,this.dims=a,this.size=n}static async fromImage(r,t){return Tf(r,t)}static fromTexture(r,t){return Pf(r,t)}static fromGpuBuffer(r,t){return Ef(r,t)}static fromMLTensor(r,t){return kf(r,t)}static fromPinnedBuffer(r,t,s){return Cf(r,t,s)}toDataURL(r){return vf(this,r)}toImageData(r){return xf(this,r)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(r){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let t=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=t,r&&this.disposer&&(this.disposer(),this.disposer=void 0),t}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(r){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return Df(this,r)}}});var Fa,cc=Er(()=>{gi();Fa=Hr});var Lf,zf,Mi,wi,dc=Er(()=>{ic();Lf=(e,r)=>{(typeof cs.trace=="undefined"?!cs.wasm.trace:!cs.trace)||console.timeStamp(`${e}::ORT::${r}`)},zf=(e,r)=>{var o;let t=((o=new Error().stack)==null?void 0:o.split(/\\r\\n|\\r|\\n/g))||[],s=!1;for(let a=0;a<t.length;a++){if(s&&!t[a].includes("TRACE_FUNC")){let n=`FUNC_${e}::${t[a].trim().split(" ")[1]}`;r&&(n+=`::${r}`),Lf("CPU",n);return}t[a].includes("TRACE_FUNC")&&(s=!0)}},Mi=e=>{(typeof cs.trace=="undefined"?!cs.wasm.trace:!cs.trace)||zf("BEGIN",e)},wi=e=>{(typeof cs.trace=="undefined"?!cs.wasm.trace:!cs.trace)||zf("END",e)}});var bi,Bf=Er(()=>{nc();cc();dc();bi=class e{constructor(r){this.handler=r}async run(r,t,s){Mi();let o={},a={};if(typeof r!="object"||r===null||r instanceof Fa||Array.isArray(r))throw new TypeError("\'feeds\' must be an object that use input names as keys and OnnxValue as corresponding values.");let n=!0;if(typeof t=="object"){if(t===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(t instanceof Fa)throw new TypeError("\'fetches\' cannot be a Tensor");if(Array.isArray(t)){if(t.length===0)throw new TypeError("\'fetches\' cannot be an empty array.");n=!1;for(let c of t){if(typeof c!="string")throw new TypeError("\'fetches\' must be a string array or an object.");if(this.outputNames.indexOf(c)===-1)throw new RangeError(`\'fetches\' contains invalid output name: ${c}.`);o[c]=null}if(typeof s=="object"&&s!==null)a=s;else if(typeof s!="undefined")throw new TypeError("\'options\' must be an object.")}else{let c=!1,_=Object.getOwnPropertyNames(t);for(let d of this.outputNames)if(_.indexOf(d)!==-1){let u=t[d];(u===null||u instanceof Fa)&&(c=!0,n=!1,o[d]=u)}if(c){if(typeof s=="object"&&s!==null)a=s;else if(typeof s!="undefined")throw new TypeError("\'options\' must be an object.")}else a=t}}else if(typeof t!="undefined")throw new TypeError("Unexpected argument[1]: must be \'fetches\' or \'options\'.");for(let c of this.inputNames)if(typeof r[c]=="undefined")throw new Error(`input \'${c}\' is missing in \'feeds\'.`);if(n)for(let c of this.outputNames)o[c]=null;let i=await this.handler.run(r,o,a),l={};for(let c in i)if(Object.hasOwnProperty.call(i,c)){let _=i[c];_ instanceof Fa?l[c]=_:l[c]=new Fa(_.type,_.data,_.dims)}return wi(),l}async release(){return this.handler.dispose()}static async create(r,t,s,o){Mi();let a,n={};if(typeof r=="string"){if(a=r,typeof t=="object"&&t!==null)n=t;else if(typeof t!="undefined")throw new TypeError("\'options\' must be an object.")}else if(r instanceof Uint8Array){if(a=r,typeof t=="object"&&t!==null)n=t;else if(typeof t!="undefined")throw new TypeError("\'options\' must be an object.")}else if(r instanceof ArrayBuffer||typeof SharedArrayBuffer!="undefined"&&r instanceof SharedArrayBuffer){let _=r,d=0,u=r.byteLength;if(typeof t=="object"&&t!==null)n=t;else if(typeof t=="number"){if(d=t,!Number.isSafeInteger(d))throw new RangeError("\'byteOffset\' must be an integer.");if(d<0||d>=_.byteLength)throw new RangeError(`\'byteOffset\' is out of range [0, ${_.byteLength}).`);if(u=r.byteLength-d,typeof s=="number"){if(u=s,!Number.isSafeInteger(u))throw new RangeError("\'byteLength\' must be an integer.");if(u<=0||d+u>_.byteLength)throw new RangeError(`\'byteLength\' is out of range (0, ${_.byteLength-d}].`);if(typeof o=="object"&&o!==null)n=o;else if(typeof o!="undefined")throw new TypeError("\'options\' must be an object.")}else if(typeof s!="undefined")throw new TypeError("\'byteLength\' must be a number.")}else if(typeof t!="undefined")throw new TypeError("\'options\' must be an object.");a=new Uint8Array(_,d,u)}else throw new TypeError("Unexpected argument[0]: must be \'path\' or \'buffer\'.");let[i,l]=await hf(n),c=await i.createInferenceSessionHandler(a,l);return wi(),new e(c)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}}});var rT,Rf=Er(()=>{Bf();rT=bi});var Nf=Er(()=>{});var jf=Er(()=>{});var Vf=Er(()=>{});var Wf=Er(()=>{});var uc={};sc(uc,{InferenceSession:()=>rT,TRACE:()=>Lf,TRACE_FUNC_BEGIN:()=>Mi,TRACE_FUNC_END:()=>wi,Tensor:()=>Fa,env:()=>tT,registerBackend:()=>mf});var Uf=Er(()=>{ff();bf();Rf();cc();Nf();jf();dc();Vf();Wf()});var su={};sc(su,{InferenceSession:()=>Sd,TRACE:()=>fn,TRACE_FUNC_BEGIN:()=>$s,TRACE_FUNC_END:()=>bs,Tensor:()=>Fs,default:()=>xP,env:()=>nr,registerBackend:()=>Ba});var Is,kd,sT,aT,oT,nT,Ve,ho,iT,hn,Zo,oa,Ba,Gf,yb,Tb,lT,Pb,cT,_c,ws,Eb,nr,dT,kb,Cb,uT,vi,Sb,Ib,Fb,$b,Ab,_T,La,dn,pc,Db,pT,Ob,Lb,mT,us,Cd,Fs,zb,fn,mc,$s,bs,Bb,Rb,hT,Sd,fT,gT,MT,wT,bT,jb,As,Id,Vb,hc,fc,Wb,vT,Ub,gc,Mc,Gb,Kf,xT,wc,ud,Hf,ds,Kb,xi,qf,Qf,bc,Xf,vc,Hb,xc,qb,Fd,yc,yi,en,Tc,Jf,Yf,Zf,$d,sr,Va,Ss,zi,Zt,Ad,Qb,yT,eg,tg,rg,tn,sg,Xb,TT,uo,qs,za,Dd,Bi,Od,Ld,_d,bt,zd,Jb,ag,og,ng,ig,Bd,lg,jt,Qs,cg,po,we,Ri,Yb,Zb,ev,St,Rd,tv,pd,Pc,dg,Ec,ug,kc,Cc,Sc,_g,rv,PT,Ti,pg,sv,ET,Nd,Ic,Pi,Ei,mg,hg,Fc,md,fg,av,kT,gg,qt,mr,mo,ki,Ar,Xr,pt,pr,hd,_o,la,ct,rn,Ee,nt,ov,jd,Mg,nv,$t,wg,$c,bg,vg,xg,yg,_s,iv,lv,ca,Tg,Pg,Eg,kg,Cg,Sg,Ig,Fg,$g,Ag,Ts,cv,dv,uv,_v,pv,mv,hv,fv,gv,Mv,CT,Ps,Dg,Ni,fd,Es,Og,Lg,zg,Bg,Rg,Ng,jg,Vg,Wg,Ug,ks,wv,bv,vv,xv,yv,Tv,Pv,Ev,kv,Cv,Vd,Ac,Sv,Iv,gd,ST,Gg,Ci,Kg,Hg,qg,gn,Qg,Fv,Wd,Xg,Jg,Yg,$v,IT,Zg,eM,Av,FT,tM,Kt,Dv,Ov,Lv,zv,Bv,Rv,Nv,jv,Vv,rM,Wv,Uv,Gv,Kv,_n,Hv,Li,qv,Qv,Xv,Jv,Yv,Zv,ex,tx,rx,sx,ax,ox,nx,ix,lx,cx,Dc,dx,Md,wd,ux,_x,px,sM,aM,mx,Ud,oM,nM,hx,$T,iM,lM,Cs,fx,gx,Mx,wx,bx,vx,xx,yx,Tx,Px,AT,cM,dM,uM,_M,Ex,kx,DT,Ra,Na,ja,Gd,Wa,Nr,Cx,Kd,Sx,OT,mn,Hd,qd,pM,mM,bd,Oc,hM,vd,fM,ji,Qd,gM,Ix,LT,MM,Lc,sn,wM,zc,bM,Fx,$x,zT,Ax,Dx,BT,vM,Si,xM,Ii,xd,Bc,yM,TM,yd,RT,Ox,NT,PM,EM,kM,Rc,Lx,CM,Nc,SM,zx,jT,IM,Bx,Rx,VT,FM,$M,AM,Nx,jx,WT,Fi,an,jc,DM,OM,LM,zM,Vc,BM,Vx,Wx,UT,RM,Wc,NM,jM,Ux,GT,VM,Gx,KT,WM,UM,Kx,Hx,HT,GM,qx,Qx,qT,KM,HM,Xx,Jx,QT,qM,QM,Yx,Zx,XT,XM,JM,ey,ty,JT,Ns,Hs,$a,Aa,YM,ZM,ew,tw,rw,sw,aw,ow,ry,sy,YT,es,nw,ay,Uc,iw,pn,oy,ny,lw,cw,dw,uw,Td,iy,ly,cy,_w,Vi,dy,uy,pw,mw,Gc,hw,_y,ZT,Kc,fw,gw,py,eP,Mw,ww,my,tP,bw,hy,rP,vw,xw,yw,fy,gy,sP,Tw,Pw,Ew,kw,Cw,Sw,Iw,Fw,My,aP,on,Hc,qc,Qc,Xc,$w,Aw,Jc,Yc,wy,by,Zc,vy,xy,ed,yy,Ty,Py,Ey,oP,Dw,Ow,ky,Cy,nP,Lw,zw,Sy,iP,Bw,td,rd,Rw,Iy,Fy,lP,Nw,jw,Vw,sd,Ww,Uw,Gw,Kw,Hw,qw,Qw,Xw,ad,Jw,Yw,Zw,eb,tb,$y,Ay,cP,rb,sb,Dy,dP,ab,nn,ob,od,nb,ib,Oy,Ly,uP,lb,cb,zy,By,_P,nd,db,ub,_b,Ry,pP,pb,mb,Ny,mP,jy,hP,Vy,fP,Wy,hb,fb,gb,Uy,gP,Gy,$i,Mb,Ky,MP,wb,Xd,Jd,na,bb,id,Wi,Yd,Zd,ld,eu,tu,ru,qy,ia,is,co,ln,cn,Ai,cd,Di,Da,Oa,vb,Qy,Xy,Jy,Yy,Zy,e0,t0,r0,dd,xb,s0,wP,a0,Pd,Ed,o0,bP,vP,xP,n0=Er(()=>{Is={};kd=Object.defineProperty,sT=Object.getOwnPropertyDescriptor,aT=Object.getOwnPropertyNames,oT=Object.prototype.hasOwnProperty,nT=(e=>typeof ka<"u"?ka:typeof Proxy<"u"?new Proxy(e,{get:(r,t)=>(typeof ka<"u"?ka:r)[t]}):e)(function(e){if(typeof ka<"u")return ka.apply(this,arguments);throw Error(\'Dynamic require of "\'+e+\'" is not supported\')}),Ve=(e,r)=>()=>(e&&(r=e(e=0)),r),ho=(e,r)=>{for(var t in r)kd(e,t,{get:r[t],enumerable:!0})},iT=(e,r,t,s)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of aT(r))!oT.call(e,o)&&o!==t&&kd(e,o,{get:()=>r[o],enumerable:!(s=sT(r,o))||s.enumerable});return e},hn=e=>iT(kd({},"__esModule",{value:!0}),e),Tb=Ve(()=>{"use strict";Zo=new Map,oa=[],Ba=(e,r,t)=>{if(r&&typeof r.init=="function"&&typeof r.createInferenceSessionHandler=="function"){let s=Zo.get(e);if(s===void 0)Zo.set(e,{backend:r,priority:t});else{if(s.priority>t)return;if(s.priority===t&&s.backend!==r)throw new Error(`cannot register backend "${e}" using priority ${t}`)}if(t>=0){let o=oa.indexOf(e);o!==-1&&oa.splice(o,1);for(let a=0;a<oa.length;a++)if(Zo.get(oa[a]).priority<=t){oa.splice(a,0,e);return}oa.push(e)}return}throw new TypeError("not a valid backend")},Gf=async e=>{let r=Zo.get(e);if(!r)return"backend not found.";if(r.initialized)return r.backend;if(r.aborted)return r.error;{let t=!!r.initPromise;try{return t||(r.initPromise=r.backend.init(e)),await r.initPromise,r.initialized=!0,r.backend}catch(s){return t||(r.error=`${s}`,r.aborted=!0),r.error}finally{delete r.initPromise}}},yb=async e=>{let r=e.executionProviders||[],t=r.map(l=>typeof l=="string"?l:l.name),s=t.length===0?oa:t,o,a=[],n=new Set;for(let l of s){let c=await Gf(l);typeof c=="string"?a.push({name:l,err:c}):(o||(o=c),o===c&&n.add(l))}if(!o)throw new Error(`no available backend found. ERR: ${a.map(l=>`[${l.name}] ${l.err}`).join(", ")}`);for(let{name:l,err:c}of a)t.includes(l)&&console.warn(`removing requested execution provider "${l}" from session options because it is not available: ${c}`);let i=r.filter(l=>n.has(typeof l=="string"?l:l.name));return[o,new Proxy(e,{get:(l,c)=>c==="executionProviders"?i:Reflect.get(l,c)})]}}),lT=Ve(()=>{"use strict";Tb()}),cT=Ve(()=>{"use strict";Pb="1.22.0-dev.20250409-89f8206ba4"}),Eb=Ve(()=>{"use strict";cT(),_c="warning",ws={wasm:{},webgl:{},webgpu:{},versions:{common:Pb},set logLevel(e){if(e!==void 0){if(typeof e!="string"||["verbose","info","warning","error","fatal"].indexOf(e)===-1)throw new Error(`Unsupported logging level: ${e}`);_c=e}},get logLevel(){return _c}},Object.defineProperty(ws,"logLevel",{enumerable:!0})}),dT=Ve(()=>{"use strict";Eb(),nr=ws}),uT=Ve(()=>{"use strict";kb=(e,r)=>{let t=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);t.width=e.dims[3],t.height=e.dims[2];let s=t.getContext("2d");if(s!=null){let o,a;(r==null?void 0:r.tensorLayout)!==void 0&&r.tensorLayout==="NHWC"?(o=e.dims[2],a=e.dims[3]):(o=e.dims[3],a=e.dims[2]);let n=(r==null?void 0:r.format)!==void 0?r.format:"RGB",i=r==null?void 0:r.norm,l,c;i===void 0||i.mean===void 0?l=[255,255,255,255]:typeof i.mean=="number"?l=[i.mean,i.mean,i.mean,i.mean]:(l=[i.mean[0],i.mean[1],i.mean[2],0],i.mean[3]!==void 0&&(l[3]=i.mean[3])),i===void 0||i.bias===void 0?c=[0,0,0,0]:typeof i.bias=="number"?c=[i.bias,i.bias,i.bias,i.bias]:(c=[i.bias[0],i.bias[1],i.bias[2],0],i.bias[3]!==void 0&&(c[3]=i.bias[3]));let _=a*o,d=0,u=_,f=_*2,h=-1;n==="RGBA"?(d=0,u=_,f=_*2,h=_*3):n==="RGB"?(d=0,u=_,f=_*2):n==="RBG"&&(d=0,f=_,u=_*2);for(let v=0;v<a;v++)for(let E=0;E<o;E++){let M=(e.data[d++]-c[0])*l[0],w=(e.data[u++]-c[1])*l[1],C=(e.data[f++]-c[2])*l[2],x=h===-1?255:(e.data[h++]-c[3])*l[3];s.fillStyle="rgba("+M+","+w+","+C+","+x+")",s.fillRect(E,v,1,1)}if("toDataURL"in t)return t.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},Cb=(e,r)=>{let t=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),s;if(t!=null){let o,a,n;(r==null?void 0:r.tensorLayout)!==void 0&&r.tensorLayout==="NHWC"?(o=e.dims[2],a=e.dims[1],n=e.dims[3]):(o=e.dims[3],a=e.dims[2],n=e.dims[1]);let i=r!==void 0&&r.format!==void 0?r.format:"RGB",l=r==null?void 0:r.norm,c,_;l===void 0||l.mean===void 0?c=[255,255,255,255]:typeof l.mean=="number"?c=[l.mean,l.mean,l.mean,l.mean]:(c=[l.mean[0],l.mean[1],l.mean[2],255],l.mean[3]!==void 0&&(c[3]=l.mean[3])),l===void 0||l.bias===void 0?_=[0,0,0,0]:typeof l.bias=="number"?_=[l.bias,l.bias,l.bias,l.bias]:(_=[l.bias[0],l.bias[1],l.bias[2],0],l.bias[3]!==void 0&&(_[3]=l.bias[3]));let d=a*o;if(r!==void 0&&(r.format!==void 0&&n===4&&r.format!=="RGBA"||n===3&&r.format!=="RGB"&&r.format!=="BGR"))throw new Error("Tensor format doesn\'t match input tensor dims");let u=4,f=0,h=1,v=2,E=3,M=0,w=d,C=d*2,x=-1;i==="RGBA"?(M=0,w=d,C=d*2,x=d*3):i==="RGB"?(M=0,w=d,C=d*2):i==="RBG"&&(M=0,C=d,w=d*2),s=t.createImageData(o,a);for(let T=0;T<a*o;f+=u,h+=u,v+=u,E+=u,T++)s.data[f]=(e.data[M++]-_[0])*c[0],s.data[h]=(e.data[w++]-_[1])*c[1],s.data[v]=(e.data[C++]-_[2])*c[2],s.data[E]=x===-1?255:(e.data[x++]-_[3])*c[3]}else throw new Error("Can not access image data");return s}}),_T=Ve(()=>{"use strict";Cd(),vi=(e,r)=>{var x,T,S;if(e===void 0)throw new Error("Image buffer must be defined");if(r.height===void 0||r.width===void 0)throw new Error("Image height and width must be defined");if(r.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:t,width:s}=r,o=(x=r.norm)!=null?x:{mean:255,bias:0},a,n;typeof o.mean=="number"?a=[o.mean,o.mean,o.mean,o.mean]:a=[o.mean[0],o.mean[1],o.mean[2],(T=o.mean[3])!=null?T:255],typeof o.bias=="number"?n=[o.bias,o.bias,o.bias,o.bias]:n=[o.bias[0],o.bias[1],o.bias[2],(S=o.bias[3])!=null?S:0];let i=r.format!==void 0?r.format:"RGBA",l=r.tensorFormat!==void 0&&r.tensorFormat!==void 0?r.tensorFormat:"RGB",c=t*s,_=l==="RGBA"?new Float32Array(c*4):new Float32Array(c*3),d=4,u=0,f=1,h=2,v=3,E=0,M=c,w=c*2,C=-1;i==="RGB"&&(d=3,u=0,f=1,h=2,v=-1),l==="RGBA"?C=c*3:l==="RBG"?(E=0,w=c,M=c*2):l==="BGR"&&(w=0,M=c,E=c*2);for(let g=0;g<c;g++,u+=d,h+=d,f+=d,v+=d)_[E++]=(e[u]+n[0])/a[0],_[M++]=(e[f]+n[1])/a[1],_[w++]=(e[h]+n[2])/a[2],C!==-1&&v!==-1&&(_[C++]=(e[v]+n[3])/a[3]);return l==="RGBA"?new us("float32",_,[1,4,t,s]):new us("float32",_,[1,3,t,s])},Sb=async(e,r)=>{let t=typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement,s=typeof ImageData<"u"&&e instanceof ImageData,o=typeof ImageBitmap<"u"&&e instanceof ImageBitmap,a=typeof e=="string",n,i=r!=null?r:{},l=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},c=_=>typeof HTMLCanvasElement<"u"&&_ instanceof HTMLCanvasElement||_ instanceof OffscreenCanvas?_.getContext("2d"):null;if(t){let _=l();_.width=e.width,_.height=e.height;let d=c(_);if(d!=null){let u=e.height,f=e.width;if(r!==void 0&&r.resizedHeight!==void 0&&r.resizedWidth!==void 0&&(u=r.resizedHeight,f=r.resizedWidth),r!==void 0){if(i=r,r.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");i.tensorFormat="RGBA",i.height=u,i.width=f}else i.tensorFormat="RGBA",i.height=u,i.width=f;d.drawImage(e,0,0),n=d.getImageData(0,0,f,u).data}else throw new Error("Can not access image data")}else if(s){let _,d;if(r!==void 0&&r.resizedWidth!==void 0&&r.resizedHeight!==void 0?(_=r.resizedHeight,d=r.resizedWidth):(_=e.height,d=e.width),r!==void 0&&(i=r),i.format="RGBA",i.height=_,i.width=d,r!==void 0){let u=l();u.width=d,u.height=_;let f=c(u);if(f!=null)f.putImageData(e,0,0),n=f.getImageData(0,0,d,_).data;else throw new Error("Can not access image data")}else n=e.data}else if(o){if(r===void 0)throw new Error("Please provide image config with format for Imagebitmap");let _=l();_.width=e.width,_.height=e.height;let d=c(_);if(d!=null){let u=e.height,f=e.width;return d.drawImage(e,0,0,f,u),n=d.getImageData(0,0,f,u).data,i.height=u,i.width=f,vi(n,i)}else throw new Error("Can not access image data")}else{if(a)return new Promise((_,d)=>{let u=l(),f=c(u);if(!e||!f)return d();let h=new Image;h.crossOrigin="Anonymous",h.src=e,h.onload=()=>{u.width=h.width,u.height=h.height,f.drawImage(h,0,0,u.width,u.height);let v=f.getImageData(0,0,u.width,u.height);i.height=u.height,i.width=u.width,_(vi(v.data,i))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(n!==void 0)return vi(n,i);throw new Error("Input data provided is not supported - aborted tensor creation")},Ib=(e,r)=>{let{width:t,height:s,download:o,dispose:a}=r,n=[1,s,t,4];return new us({location:"texture",type:"float32",texture:e,dims:n,download:o,dispose:a})},Fb=(e,r)=>{let{dataType:t,dims:s,download:o,dispose:a}=r;return new us({location:"gpu-buffer",type:t!=null?t:"float32",gpuBuffer:e,dims:s,download:o,dispose:a})},$b=(e,r)=>{let{dataType:t,dims:s,download:o,dispose:a}=r;return new us({location:"ml-tensor",type:t!=null?t:"float32",mlTensor:e,dims:s,download:o,dispose:a})},Ab=(e,r,t)=>new us({location:"cpu-pinned",type:e,data:r,dims:t!=null?t:[r.length]})}),pT=Ve(()=>{"use strict";La=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),dn=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),pc=!1,Db=()=>{if(!pc){pc=!0;let e=typeof BigInt64Array<"u"&&BigInt64Array.from,r=typeof BigUint64Array<"u"&&BigUint64Array.from,t=globalThis.Float16Array,s=typeof t<"u"&&t.from;e&&(La.set("int64",BigInt64Array),dn.set(BigInt64Array,"int64")),r&&(La.set("uint64",BigUint64Array),dn.set(BigUint64Array,"uint64")),s?(La.set("float16",t),dn.set(t,"float16")):La.set("float16",Uint16Array)}}}),mT=Ve(()=>{"use strict";Cd(),Ob=e=>{let r=1;for(let t=0;t<e.length;t++){let s=e[t];if(typeof s!="number"||!Number.isSafeInteger(s))throw new TypeError(`dims[${t}] must be an integer, got: ${s}`);if(s<0)throw new RangeError(`dims[${t}] must be a non-negative integer, got: ${s}`);r*=s}return r},Lb=(e,r)=>{switch(e.location){case"cpu":return new us(e.type,e.data,r);case"cpu-pinned":return new us({location:"cpu-pinned",data:e.data,type:e.type,dims:r});case"texture":return new us({location:"texture",texture:e.texture,type:e.type,dims:r});case"gpu-buffer":return new us({location:"gpu-buffer",gpuBuffer:e.gpuBuffer,type:e.type,dims:r});case"ml-tensor":return new us({location:"ml-tensor",mlTensor:e.mlTensor,type:e.type,dims:r});default:throw new Error(`tensorReshape: tensor location ${e.location} is not supported`)}}}),Cd=Ve(()=>{"use strict";uT(),_T(),pT(),mT(),us=class{constructor(e,r,t){Db();let s,o;if(typeof e=="object"&&"location"in e)switch(this.dataLocation=e.location,s=e.type,o=e.dims,e.location){case"cpu-pinned":{let n=La.get(s);if(!n)throw new TypeError(`unsupported type "${s}" to create tensor from pinned buffer`);if(!(e.data instanceof n))throw new TypeError(`buffer should be of type ${n.name}`);this.cpuData=e.data;break}case"texture":{if(s!=="float32")throw new TypeError(`unsupported type "${s}" to create tensor from texture`);this.gpuTextureData=e.texture,this.downloader=e.download,this.disposer=e.dispose;break}case"gpu-buffer":{if(s!=="float32"&&s!=="float16"&&s!=="int32"&&s!=="int64"&&s!=="uint32"&&s!=="uint8"&&s!=="bool"&&s!=="uint4"&&s!=="int4")throw new TypeError(`unsupported type "${s}" to create tensor from gpu buffer`);this.gpuBufferData=e.gpuBuffer,this.downloader=e.download,this.disposer=e.dispose;break}case"ml-tensor":{if(s!=="float32"&&s!=="float16"&&s!=="int32"&&s!=="int64"&&s!=="uint32"&&s!=="uint64"&&s!=="int8"&&s!=="uint8"&&s!=="bool"&&s!=="uint4"&&s!=="int4")throw new TypeError(`unsupported type "${s}" to create tensor from MLTensor`);this.mlTensorData=e.mlTensor,this.downloader=e.download,this.disposer=e.dispose;break}default:throw new Error(`Tensor constructor: unsupported location \'${this.dataLocation}\'`)}else{let n,i;if(typeof e=="string")if(s=e,i=t,e==="string"){if(!Array.isArray(r))throw new TypeError("A string tensor\'s data must be a string array.");n=r}else{let l=La.get(e);if(l===void 0)throw new TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(r)){if(e==="float16"&&l===Uint16Array||e==="uint4"||e==="int4")throw new TypeError(`Creating a ${e} tensor from number array is not supported. Please use ${l.name} as data.`);e==="uint64"||e==="int64"?n=l.from(r,BigInt):n=l.from(r)}else if(r instanceof l)n=r;else if(r instanceof Uint8ClampedArray)if(e==="uint8")n=Uint8Array.from(r);else throw new TypeError("A Uint8ClampedArray tensor\'s data must be type of uint8");else if(e==="float16"&&r instanceof Uint16Array&&l!==Uint16Array)n=new globalThis.Float16Array(r.buffer,r.byteOffset,r.length);else throw new TypeError(`A ${s} tensor\'s data must be type of ${l}`)}else if(i=r,Array.isArray(e)){if(e.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let l=typeof e[0];if(l==="string")s="string",n=e;else if(l==="boolean")s="bool",n=Uint8Array.from(e);else throw new TypeError(`Invalid element type of data array: ${l}.`)}else if(e instanceof Uint8ClampedArray)s="uint8",n=Uint8Array.from(e);else{let l=dn.get(e.constructor);if(l===void 0)throw new TypeError(`Unsupported type for tensor data: ${e.constructor}.`);s=l,n=e}if(i===void 0)i=[n.length];else if(!Array.isArray(i))throw new TypeError("A tensor\'s dims must be a number array");o=i,this.cpuData=n,this.dataLocation="cpu"}let a=Ob(o);if(this.cpuData&&a!==this.cpuData.length&&!((s==="uint4"||s==="int4")&&Math.ceil(a/2)===this.cpuData.length))throw new Error(`Tensor\'s size(${a}) does not match data length(${this.cpuData.length}).`);this.type=s,this.dims=o,this.size=a}static async fromImage(e,r){return Sb(e,r)}static fromTexture(e,r){return Ib(e,r)}static fromGpuBuffer(e,r){return Fb(e,r)}static fromMLTensor(e,r){return $b(e,r)}static fromPinnedBuffer(e,r,t){return Ab(e,r,t)}toDataURL(e){return kb(this,e)}toImageData(e){return Cb(this,e)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(e){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let r=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=r,e&&this.disposer&&(this.disposer(),this.disposer=void 0),r}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(e){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return Lb(this,e)}}}),zb=Ve(()=>{"use strict";Cd(),Fs=us}),Bb=Ve(()=>{"use strict";Eb(),fn=(e,r)=>{(typeof ws.trace>"u"?!ws.wasm.trace:!ws.trace)||console.timeStamp(`${e}::ORT::${r}`)},mc=(e,r)=>{var o;let t=((o=new Error().stack)==null?void 0:o.split(/\\r\\n|\\r|\\n/g))||[],s=!1;for(let a=0;a<t.length;a++){if(s&&!t[a].includes("TRACE_FUNC")){let n=`FUNC_${e}::${t[a].trim().split(" ")[1]}`;r&&(n+=`::${r}`),fn("CPU",n);return}t[a].includes("TRACE_FUNC")&&(s=!0)}},$s=e=>{(typeof ws.trace>"u"?!ws.wasm.trace:!ws.trace)||mc("BEGIN",e)},bs=e=>{(typeof ws.trace>"u"?!ws.wasm.trace:!ws.trace)||mc("END",e)}}),hT=Ve(()=>{"use strict";Tb(),zb(),Bb(),Rb=class Nb{constructor(r){this.handler=r}async run(r,t,s){$s();let o={},a={};if(typeof r!="object"||r===null||r instanceof Fs||Array.isArray(r))throw new TypeError("\'feeds\' must be an object that use input names as keys and OnnxValue as corresponding values.");let n=!0;if(typeof t=="object"){if(t===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(t instanceof Fs)throw new TypeError("\'fetches\' cannot be a Tensor");if(Array.isArray(t)){if(t.length===0)throw new TypeError("\'fetches\' cannot be an empty array.");n=!1;for(let c of t){if(typeof c!="string")throw new TypeError("\'fetches\' must be a string array or an object.");if(this.outputNames.indexOf(c)===-1)throw new RangeError(`\'fetches\' contains invalid output name: ${c}.`);o[c]=null}if(typeof s=="object"&&s!==null)a=s;else if(typeof s<"u")throw new TypeError("\'options\' must be an object.")}else{let c=!1,_=Object.getOwnPropertyNames(t);for(let d of this.outputNames)if(_.indexOf(d)!==-1){let u=t[d];(u===null||u instanceof Fs)&&(c=!0,n=!1,o[d]=u)}if(c){if(typeof s=="object"&&s!==null)a=s;else if(typeof s<"u")throw new TypeError("\'options\' must be an object.")}else a=t}}else if(typeof t<"u")throw new TypeError("Unexpected argument[1]: must be \'fetches\' or \'options\'.");for(let c of this.inputNames)if(typeof r[c]>"u")throw new Error(`input \'${c}\' is missing in \'feeds\'.`);if(n)for(let c of this.outputNames)o[c]=null;let i=await this.handler.run(r,o,a),l={};for(let c in i)if(Object.hasOwnProperty.call(i,c)){let _=i[c];_ instanceof Fs?l[c]=_:l[c]=new Fs(_.type,_.data,_.dims)}return bs(),l}async release(){return this.handler.dispose()}static async create(r,t,s,o){$s();let a,n={};if(typeof r=="string"){if(a=r,typeof t=="object"&&t!==null)n=t;else if(typeof t<"u")throw new TypeError("\'options\' must be an object.")}else if(r instanceof Uint8Array){if(a=r,typeof t=="object"&&t!==null)n=t;else if(typeof t<"u")throw new TypeError("\'options\' must be an object.")}else if(r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer){let _=r,d=0,u=r.byteLength;if(typeof t=="object"&&t!==null)n=t;else if(typeof t=="number"){if(d=t,!Number.isSafeInteger(d))throw new RangeError("\'byteOffset\' must be an integer.");if(d<0||d>=_.byteLength)throw new RangeError(`\'byteOffset\' is out of range [0, ${_.byteLength}).`);if(u=r.byteLength-d,typeof s=="number"){if(u=s,!Number.isSafeInteger(u))throw new RangeError("\'byteLength\' must be an integer.");if(u<=0||d+u>_.byteLength)throw new RangeError(`\'byteLength\' is out of range (0, ${_.byteLength-d}].`);if(typeof o=="object"&&o!==null)n=o;else if(typeof o<"u")throw new TypeError("\'options\' must be an object.")}else if(typeof s<"u")throw new TypeError("\'byteLength\' must be a number.")}else if(typeof t<"u")throw new TypeError("\'options\' must be an object.");a=new Uint8Array(_,d,u)}else throw new TypeError("Unexpected argument[0]: must be \'path\' or \'buffer\'.");let[i,l]=await yb(n),c=await i.createInferenceSessionHandler(a,l);return bs(),new Nb(c)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),fT=Ve(()=>{"use strict";hT(),Sd=Rb}),gT=Ve(()=>{"use strict"}),MT=Ve(()=>{"use strict"}),wT=Ve(()=>{"use strict"}),bT=Ve(()=>{"use strict"}),jb={};ho(jb,{InferenceSession:()=>Sd,TRACE:()=>fn,TRACE_FUNC_BEGIN:()=>$s,TRACE_FUNC_END:()=>bs,Tensor:()=>Fs,env:()=>nr,registerBackend:()=>Ba});As=Ve(()=>{"use strict";lT(),dT(),fT(),zb(),gT(),MT(),Bb(),wT(),bT()}),Id=Ve(()=>{"use strict"}),Vb={};ho(Vb,{default:()=>Wb});vT=Ve(()=>{"use strict";var e;qy(),Va(),Fd(),hc="ort-wasm-proxy-worker",fc=((e=globalThis.self)==null?void 0:e.name)===hc,fc&&(self.onmessage=r=>{let{type:t,in:s}=r.data;try{switch(t){case"init-wasm":$d(s.wasm).then(()=>{Xd(s).then(()=>{postMessage({type:t})},o=>{postMessage({type:t,err:o})})},o=>{postMessage({type:t,err:o})});break;case"init-ep":{let{epName:o,env:a}=s;Jd(a,o).then(()=>{postMessage({type:t})},n=>{postMessage({type:t,err:n})});break}case"copy-from":{let{buffer:o}=s,a=Wi(o);postMessage({type:t,out:a});break}case"create":{let{model:o,options:a}=s;Yd(o,a).then(n=>{postMessage({type:t,out:n})},n=>{postMessage({type:t,err:n})});break}case"release":Zd(s),postMessage({type:t});break;case"run":{let{sessionId:o,inputIndices:a,inputs:n,outputIndices:i,options:l}=s;eu(o,a,n,i,new Array(i.length).fill(null),l).then(c=>{c.some(_=>_[3]!=="cpu")?postMessage({type:t,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:t,out:c},ru([...n,...c]))},c=>{postMessage({type:t,err:c})});break}case"end-profiling":tu(s),postMessage({type:t});break;default:}}catch(o){postMessage({type:t,err:o})}}),Wb=fc?null:r=>new Worker(r!=null?r:ds,{type:"module",name:hc})}),Ub={};ho(Ub,{default:()=>Gb});xT=Ve(()=>{"use strict";var e,r;Mc=(gc=Is.url,async function(t={}){var to,qo;var s,o,a=t,n=new Promise((p,y)=>{s=p,o=y}),i=typeof window=="object",l=typeof WorkerGlobalScope<"u",c=l&&((to=self.name)==null?void 0:to.startsWith("em-pthread"));a.mountExternalData=(p,y)=>{p.startsWith("./")&&(p=p.substring(2)),(a.Eb||(a.Eb=new Map)).set(p,y)},a.unmountExternalData=()=>{delete a.Eb};var _=(qo=globalThis.SharedArrayBuffer)!=null?qo:new WebAssembly.Memory({initial:0,maximum:0,pc:!0}).buffer.constructor;let d=p=>async(...y)=>{var F;try{if(a.Fb)throw Error("Session already started");let z=a.Fb={dc:y[0],errors:[]},U=await p(...y);if(a.Fb!==z)throw Error("Session mismatch");(F=a.Jb)==null||F.flush();let le=z.errors;if(0<le.length){let ye=await Promise.all(le);if(ye=ye.filter(Oe=>Oe),0<ye.length)throw Error(ye.join(`\n`))}return U}finally{a.Fb=null}};a.jsepInit=(p,y)=>{if(p==="webgpu"){[a.Jb,a.Ub,a.Yb,a.Kb,a.Xb,a.jb,a.Zb,a.ac,a.Vb,a.Wb,a.$b]=y;let F=a.Jb;a.jsepRegisterBuffer=(z,U,le,ye)=>F.registerBuffer(z,U,le,ye),a.jsepGetBuffer=z=>F.getBuffer(z),a.jsepCreateDownloader=(z,U,le)=>F.createDownloader(z,U,le),a.jsepOnCreateSession=z=>{F.onCreateSession(z)},a.jsepOnReleaseSession=z=>{F.onReleaseSession(z)},a.jsepOnRunStart=z=>F.onRunStart(z),a.bc=(z,U)=>{F.upload(z,U)}}else if(p==="webnn"){let F=y[0];[a.nc,a.Nb,a.webnnEnsureTensor,a.Ob,a.webnnDownloadTensor]=y.slice(1),a.webnnReleaseTensorId=a.Nb,a.webnnUploadTensor=a.Ob,a.webnnOnRunStart=z=>F.onRunStart(z),a.webnnOnRunEnd=F.onRunEnd.bind(F),a.webnnRegisterMLContext=(z,U)=>{F.registerMLContext(z,U)},a.webnnOnReleaseSession=z=>{F.onReleaseSession(z)},a.webnnCreateMLTensorDownloader=(z,U)=>F.createMLTensorDownloader(z,U),a.webnnRegisterMLTensor=(z,U,le,ye)=>F.registerMLTensor(z,U,le,ye),a.webnnCreateMLContext=z=>F.createMLContext(z),a.webnnRegisterMLConstant=(z,U,le,ye,Oe,Xe)=>F.registerMLConstant(z,U,le,ye,Oe,a.Eb,Xe),a.webnnRegisterGraphInput=F.registerGraphInput.bind(F),a.webnnIsGraphInput=F.isGraphInput.bind(F),a.webnnCreateTemporaryTensor=F.createTemporaryTensor.bind(F),a.webnnIsInt64Supported=F.isInt64Supported.bind(F)}};let u=()=>{let p=(y,F,z)=>(...U)=>{let le=Vt,ye=F==null?void 0:F();U=y(...U);let Oe=F==null?void 0:F();return ye!==Oe&&(y=Oe,z(ye),F=z=null),Vt!=le?new Promise((Xe,ot)=>{zr={resolve:Xe,reject:ot}}):U};(()=>{for(let y of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])a[y]=p(a[y],()=>a[y],F=>a[y]=F)})(),d!==void 0&&(a._OrtRun=d(a._OrtRun),a._OrtRunWithBinding=d(a._OrtRunWithBinding)),u=void 0};a.asyncInit=()=>{u==null||u()};var f,h,v=Object.assign({},a),E=(p,y)=>{throw y},M="";(i||l)&&(l?M=self.location.href:typeof document<"u"&&document.currentScript&&(M=document.currentScript.src),gc&&(M=gc),M=M.startsWith("blob:")?"":M.slice(0,M.replace(/[?#].*/,"").lastIndexOf("/")+1),l&&(h=p=>{var y=new XMLHttpRequest;return y.open("GET",p,!1),y.responseType="arraybuffer",y.send(null),new Uint8Array(y.response)}),f=async p=>{if(B(p))return new Promise((F,z)=>{var U=new XMLHttpRequest;U.open("GET",p,!0),U.responseType="arraybuffer",U.onload=()=>{U.status==200||U.status==0&&U.response?F(U.response):z(U.status)},U.onerror=z,U.send(null)});var y=await fetch(p,{credentials:"same-origin"});if(y.ok)return y.arrayBuffer();throw Error(y.status+" : "+y.url)});var w=console.log.bind(console),C=console.error.bind(console),x=w,T=C;Object.assign(a,v),v=null;var S,g,P,$,A,N,W,R,J,H,q,X,ae,ce=a.wasmBinary,he=!1,B=p=>p.startsWith("file://");function D(){return S.buffer!=$.buffer&&j(),$}function K(){return S.buffer!=$.buffer&&j(),A}function re(){return S.buffer!=$.buffer&&j(),N}function me(){return S.buffer!=$.buffer&&j(),W}function oe(){return S.buffer!=$.buffer&&j(),R}function ge(){return S.buffer!=$.buffer&&j(),J}function ze(){return S.buffer!=$.buffer&&j(),H}function We(){return S.buffer!=$.buffer&&j(),ae}if(c){let p=function(y){try{var F=y.data,z=F.Bb;if(z==="load"){let U=[];self.onmessage=le=>U.push(le),self.startWorker=()=>{postMessage({Bb:"loaded"});for(let le of U)p(le);self.onmessage=p};for(let le of F.Rb)a[le]&&!a[le].proxy||(a[le]=(...ye)=>{postMessage({Bb:"callHandler",Qb:le,args:ye})},le=="print"&&(x=a[le]),le=="printErr"&&(T=a[le]));S=F.kc,j(),ie(F.lc)}else if(z==="run"){te(F.Ab),Xa(F.Ab,0,0,1,0,0),L(),Ge(F.Ab),Y||(Ro(),Y=!0);try{Me(F.fc,F.Hb)}catch(U){if(U!="unwind")throw U}}else F.target!=="setimmediate"&&(z==="checkMailbox"?Y&&Be():z&&(T(`worker: received unknown command ${z}`),T(F)))}catch(U){throw Ja(),U}};var Ce=p,ie,Y=!1;T=function(...y){y=y.join(" "),console.error(y)},self.alert=function(...y){postMessage({Bb:"alert",text:y.join(" "),ic:Ma()})},self.onunhandledrejection=y=>{throw y.reason||y},self.onmessage=p}function j(){var p=S.buffer;a.HEAP8=$=new Int8Array(p),a.HEAP16=N=new Int16Array(p),a.HEAPU8=A=new Uint8Array(p),a.HEAPU16=W=new Uint16Array(p),a.HEAP32=R=new Int32Array(p),a.HEAPU32=J=new Uint32Array(p),a.HEAPF32=H=new Float32Array(p),a.HEAPF64=ae=new Float64Array(p),a.HEAP64=q=new BigInt64Array(p),a.HEAPU64=X=new BigUint64Array(p)}function fe(){c?startWorker(a):mt.Ca()}c||(S=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),j());var ve,Ie=0,xe=null;function ke(){if(--Ie==0&&xe){var p=xe;xe=null,p()}}function Pe(p){throw T(p="Aborted("+p+")"),he=!0,p=new WebAssembly.RuntimeError(p+". Build with -sASSERTIONS for more info."),o(p),p}function He(){return{a:{L:Ke,Aa:qe,b:Se,$:Xt,A:vt,pa:yt,X:er,Z:br,qa:hr,na:Ir,ga:tr,ma:kr,J:jr,Y:Yr,V:vs,oa:Ds,W:Os,va:Ls,E:ps,Q:ts,O:ua,D:pa,u:zs,r:ma,P:ha,z:ne,R:de,ja:be,T:Je,aa:Rt,M:vr,F:Ht,ia:Ge,sa:Ut,t:ls,Ba:fs,w:Mr,o:Zr,l:wn,c:hs,n:bn,j:xn,v:yn,p:Tn,f:Pn,s:Mo,m:En,e:kn,k:wo,i:Cn,g:bo,d:Sn,da:vo,ea:yo,fa:Ga,ba:To,ca:Po,N:Eo,xa:$n,ua:ko,h:Co,C:On,G:So,ta:An,x:Ws,ra:Ln,U:Ui,q:Fn,y:zn,K:Gi,S:Bn,za:Rn,ya:Nn,ka:$o,la:Ao,_:Et,B:qa,I:Do,ha:Oo,H:zo,a:S,wa:et}}}var Ue={829644:(p,y,F,z,U)=>{if(a===void 0||!a.Eb)return 1;if((p=Ye(Number(p>>>0))).startsWith("./")&&(p=p.substring(2)),!(p=a.Eb.get(p)))return 2;if(y=Number(y>>>0),F=Number(F>>>0),z=Number(z>>>0),y+F>p.byteLength)return 3;try{let le=p.subarray(y,y+F);switch(U){case 0:K().set(le,z>>>0);break;case 1:a.mc?a.mc(z,le):a.bc(z,le);break;default:return 4}return 0}catch(le){return 4}},830468:(p,y,F)=>{a.Ob(p,K().subarray(y>>>0,y+F>>>0))},830532:()=>a.nc(),830574:p=>{a.Nb(p)},830611:()=>{a.Vb()},830642:()=>{a.Wb()},830671:()=>{a.$b()},830696:p=>a.Ub(p),830729:p=>a.Yb(p),830761:(p,y,F)=>{a.Kb(Number(p),Number(y),Number(F),!0)},830824:(p,y,F)=>{a.Kb(Number(p),Number(y),Number(F))},830881:()=>typeof wasmOffsetConverter<"u",830938:p=>{a.jb("Abs",p,void 0)},830989:p=>{a.jb("Neg",p,void 0)},831040:p=>{a.jb("Floor",p,void 0)},831093:p=>{a.jb("Ceil",p,void 0)},831145:p=>{a.jb("Reciprocal",p,void 0)},831203:p=>{a.jb("Sqrt",p,void 0)},831255:p=>{a.jb("Exp",p,void 0)},831306:p=>{a.jb("Erf",p,void 0)},831357:p=>{a.jb("Sigmoid",p,void 0)},831412:(p,y,F)=>{a.jb("HardSigmoid",p,{alpha:y,beta:F})},831491:p=>{a.jb("Log",p,void 0)},831542:p=>{a.jb("Sin",p,void 0)},831593:p=>{a.jb("Cos",p,void 0)},831644:p=>{a.jb("Tan",p,void 0)},831695:p=>{a.jb("Asin",p,void 0)},831747:p=>{a.jb("Acos",p,void 0)},831799:p=>{a.jb("Atan",p,void 0)},831851:p=>{a.jb("Sinh",p,void 0)},831903:p=>{a.jb("Cosh",p,void 0)},831955:p=>{a.jb("Asinh",p,void 0)},832008:p=>{a.jb("Acosh",p,void 0)},832061:p=>{a.jb("Atanh",p,void 0)},832114:p=>{a.jb("Tanh",p,void 0)},832166:p=>{a.jb("Not",p,void 0)},832217:(p,y,F)=>{a.jb("Clip",p,{min:y,max:F})},832286:p=>{a.jb("Clip",p,void 0)},832338:(p,y)=>{a.jb("Elu",p,{alpha:y})},832396:p=>{a.jb("Gelu",p,void 0)},832448:p=>{a.jb("Relu",p,void 0)},832500:(p,y)=>{a.jb("LeakyRelu",p,{alpha:y})},832564:(p,y)=>{a.jb("ThresholdedRelu",p,{alpha:y})},832634:(p,y)=>{a.jb("Cast",p,{to:y})},832692:p=>{a.jb("Add",p,void 0)},832743:p=>{a.jb("Sub",p,void 0)},832794:p=>{a.jb("Mul",p,void 0)},832845:p=>{a.jb("Div",p,void 0)},832896:p=>{a.jb("Pow",p,void 0)},832947:p=>{a.jb("Equal",p,void 0)},833e3:p=>{a.jb("Greater",p,void 0)},833055:p=>{a.jb("GreaterOrEqual",p,void 0)},833117:p=>{a.jb("Less",p,void 0)},833169:p=>{a.jb("LessOrEqual",p,void 0)},833228:(p,y,F,z,U)=>{a.jb("ReduceMean",p,{keepDims:!!y,noopWithEmptyAxes:!!F,axes:z?Array.from(oe().subarray(Number(z)>>>0,Number(U)>>>0)):[]})},833403:(p,y,F,z,U)=>{a.jb("ReduceMax",p,{keepDims:!!y,noopWithEmptyAxes:!!F,axes:z?Array.from(oe().subarray(Number(z)>>>0,Number(U)>>>0)):[]})},833577:(p,y,F,z,U)=>{a.jb("ReduceMin",p,{keepDims:!!y,noopWithEmptyAxes:!!F,axes:z?Array.from(oe().subarray(Number(z)>>>0,Number(U)>>>0)):[]})},833751:(p,y,F,z,U)=>{a.jb("ReduceProd",p,{keepDims:!!y,noopWithEmptyAxes:!!F,axes:z?Array.from(oe().subarray(Number(z)>>>0,Number(U)>>>0)):[]})},833926:(p,y,F,z,U)=>{a.jb("ReduceSum",p,{keepDims:!!y,noopWithEmptyAxes:!!F,axes:z?Array.from(oe().subarray(Number(z)>>>0,Number(U)>>>0)):[]})},834100:(p,y,F,z,U)=>{a.jb("ReduceL1",p,{keepDims:!!y,noopWithEmptyAxes:!!F,axes:z?Array.from(oe().subarray(Number(z)>>>0,Number(U)>>>0)):[]})},834273:(p,y,F,z,U)=>{a.jb("ReduceL2",p,{keepDims:!!y,noopWithEmptyAxes:!!F,axes:z?Array.from(oe().subarray(Number(z)>>>0,Number(U)>>>0)):[]})},834446:(p,y,F,z,U)=>{a.jb("ReduceLogSum",p,{keepDims:!!y,noopWithEmptyAxes:!!F,axes:z?Array.from(oe().subarray(Number(z)>>>0,Number(U)>>>0)):[]})},834623:(p,y,F,z,U)=>{a.jb("ReduceSumSquare",p,{keepDims:!!y,noopWithEmptyAxes:!!F,axes:z?Array.from(oe().subarray(Number(z)>>>0,Number(U)>>>0)):[]})},834803:(p,y,F,z,U)=>{a.jb("ReduceLogSumExp",p,{keepDims:!!y,noopWithEmptyAxes:!!F,axes:z?Array.from(oe().subarray(Number(z)>>>0,Number(U)>>>0)):[]})},834983:p=>{a.jb("Where",p,void 0)},835036:(p,y,F)=>{a.jb("Transpose",p,{perm:y?Array.from(oe().subarray(Number(y)>>>0,Number(F)>>>0)):[]})},835160:(p,y,F,z)=>{a.jb("DepthToSpace",p,{blocksize:y,mode:Ye(F),format:z?"NHWC":"NCHW"})},835293:(p,y,F,z)=>{a.jb("DepthToSpace",p,{blocksize:y,mode:Ye(F),format:z?"NHWC":"NCHW"})},835426:(p,y,F,z,U,le,ye,Oe,Xe,ot,Tt,Nt,Jt,yr,Gs)=>{a.jb("ConvTranspose",p,{format:Xe?"NHWC":"NCHW",autoPad:y,dilations:[F],group:z,kernelShape:[U],pads:[le,ye],strides:[Oe],wIsConst:()=>!!D()[ot>>>0],outputPadding:Tt?Array.from(oe().subarray(Number(Tt)>>>0,Number(Nt)>>>0)):[],outputShape:Jt?Array.from(oe().subarray(Number(Jt)>>>0,Number(yr)>>>0)):[],activation:Ye(Gs)})},835859:(p,y,F,z,U,le,ye,Oe,Xe,ot,Tt,Nt,Jt,yr)=>{a.jb("ConvTranspose",p,{format:Oe?"NHWC":"NCHW",autoPad:y,dilations:Array.from(oe().subarray(Number(F)>>>0,2+(Number(F)>>>0)>>>0)),group:z,kernelShape:Array.from(oe().subarray(Number(U)>>>0,2+(Number(U)>>>0)>>>0)),pads:Array.from(oe().subarray(Number(le)>>>0,4+(Number(le)>>>0)>>>0)),strides:Array.from(oe().subarray(Number(ye)>>>0,2+(Number(ye)>>>0)>>>0)),wIsConst:()=>!!D()[Xe>>>0],outputPadding:ot?Array.from(oe().subarray(Number(ot)>>>0,Number(Tt)>>>0)):[],outputShape:Nt?Array.from(oe().subarray(Number(Nt)>>>0,Number(Jt)>>>0)):[],activation:Ye(yr)})},836520:(p,y,F,z,U,le,ye,Oe,Xe,ot,Tt,Nt,Jt,yr,Gs)=>{a.jb("ConvTranspose",p,{format:Xe?"NHWC":"NCHW",autoPad:y,dilations:[F],group:z,kernelShape:[U],pads:[le,ye],strides:[Oe],wIsConst:()=>!!D()[ot>>>0],outputPadding:Tt?Array.from(oe().subarray(Number(Tt)>>>0,Number(Nt)>>>0)):[],outputShape:Jt?Array.from(oe().subarray(Number(Jt)>>>0,Number(yr)>>>0)):[],activation:Ye(Gs)})},836953:(p,y,F,z,U,le,ye,Oe,Xe,ot,Tt,Nt,Jt,yr)=>{a.jb("ConvTranspose",p,{format:Oe?"NHWC":"NCHW",autoPad:y,dilations:Array.from(oe().subarray(Number(F)>>>0,2+(Number(F)>>>0)>>>0)),group:z,kernelShape:Array.from(oe().subarray(Number(U)>>>0,2+(Number(U)>>>0)>>>0)),pads:Array.from(oe().subarray(Number(le)>>>0,4+(Number(le)>>>0)>>>0)),strides:Array.from(oe().subarray(Number(ye)>>>0,2+(Number(ye)>>>0)>>>0)),wIsConst:()=>!!D()[Xe>>>0],outputPadding:ot?Array.from(oe().subarray(Number(ot)>>>0,Number(Tt)>>>0)):[],outputShape:Nt?Array.from(oe().subarray(Number(Nt)>>>0,Number(Jt)>>>0)):[],activation:Ye(yr)})},837614:(p,y)=>{a.jb("GlobalAveragePool",p,{format:y?"NHWC":"NCHW"})},837705:(p,y,F,z,U,le,ye,Oe,Xe,ot,Tt,Nt,Jt,yr)=>{a.jb("AveragePool",p,{format:yr?"NHWC":"NCHW",auto_pad:y,ceil_mode:F,count_include_pad:z,storage_order:U,dilations:le?Array.from(oe().subarray(Number(le)>>>0,Number(ye)>>>0)):[],kernel_shape:Oe?Array.from(oe().subarray(Number(Oe)>>>0,Number(Xe)>>>0)):[],pads:ot?Array.from(oe().subarray(Number(ot)>>>0,Number(Tt)>>>0)):[],strides:Nt?Array.from(oe().subarray(Number(Nt)>>>0,Number(Jt)>>>0)):[]})},838184:(p,y)=>{a.jb("GlobalAveragePool",p,{format:y?"NHWC":"NCHW"})},838275:(p,y,F,z,U,le,ye,Oe,Xe,ot,Tt,Nt,Jt,yr)=>{a.jb("AveragePool",p,{format:yr?"NHWC":"NCHW",auto_pad:y,ceil_mode:F,count_include_pad:z,storage_order:U,dilations:le?Array.from(oe().subarray(Number(le)>>>0,Number(ye)>>>0)):[],kernel_shape:Oe?Array.from(oe().subarray(Number(Oe)>>>0,Number(Xe)>>>0)):[],pads:ot?Array.from(oe().subarray(Number(ot)>>>0,Number(Tt)>>>0)):[],strides:Nt?Array.from(oe().subarray(Number(Nt)>>>0,Number(Jt)>>>0)):[]})},838754:(p,y)=>{a.jb("GlobalMaxPool",p,{format:y?"NHWC":"NCHW"})},838841:(p,y,F,z,U,le,ye,Oe,Xe,ot,Tt,Nt,Jt,yr)=>{a.jb("MaxPool",p,{format:yr?"NHWC":"NCHW",auto_pad:y,ceil_mode:F,count_include_pad:z,storage_order:U,dilations:le?Array.from(oe().subarray(Number(le)>>>0,Number(ye)>>>0)):[],kernel_shape:Oe?Array.from(oe().subarray(Number(Oe)>>>0,Number(Xe)>>>0)):[],pads:ot?Array.from(oe().subarray(Number(ot)>>>0,Number(Tt)>>>0)):[],strides:Nt?Array.from(oe().subarray(Number(Nt)>>>0,Number(Jt)>>>0)):[]})},839316:(p,y)=>{a.jb("GlobalMaxPool",p,{format:y?"NHWC":"NCHW"})},839403:(p,y,F,z,U,le,ye,Oe,Xe,ot,Tt,Nt,Jt,yr)=>{a.jb("MaxPool",p,{format:yr?"NHWC":"NCHW",auto_pad:y,ceil_mode:F,count_include_pad:z,storage_order:U,dilations:le?Array.from(oe().subarray(Number(le)>>>0,Number(ye)>>>0)):[],kernel_shape:Oe?Array.from(oe().subarray(Number(Oe)>>>0,Number(Xe)>>>0)):[],pads:ot?Array.from(oe().subarray(Number(ot)>>>0,Number(Tt)>>>0)):[],strides:Nt?Array.from(oe().subarray(Number(Nt)>>>0,Number(Jt)>>>0)):[]})},839878:(p,y,F,z,U)=>{a.jb("Gemm",p,{alpha:y,beta:F,transA:z,transB:U})},839982:p=>{a.jb("MatMul",p,void 0)},840036:(p,y,F,z)=>{a.jb("ArgMax",p,{keepDims:!!y,selectLastIndex:!!F,axis:z})},840144:(p,y,F,z)=>{a.jb("ArgMin",p,{keepDims:!!y,selectLastIndex:!!F,axis:z})},840252:(p,y)=>{a.jb("Softmax",p,{axis:y})},840315:(p,y)=>{a.jb("Concat",p,{axis:y})},840375:(p,y,F,z,U)=>{a.jb("Split",p,{axis:y,numOutputs:F,splitSizes:z?Array.from(oe().subarray(Number(z)>>>0,Number(U)>>>0)):[]})},840531:p=>{a.jb("Expand",p,void 0)},840585:(p,y)=>{a.jb("Gather",p,{axis:Number(y)})},840656:(p,y)=>{a.jb("GatherElements",p,{axis:Number(y)})},840735:(p,y)=>{a.jb("GatherND",p,{batch_dims:Number(y)})},840814:(p,y,F,z,U,le,ye,Oe,Xe,ot,Tt)=>{a.jb("Resize",p,{antialias:y,axes:F?Array.from(oe().subarray(Number(F)>>>0,Number(z)>>>0)):[],coordinateTransformMode:Ye(U),cubicCoeffA:le,excludeOutside:ye,extrapolationValue:Oe,keepAspectRatioPolicy:Ye(Xe),mode:Ye(ot),nearestMode:Ye(Tt)})},841176:(p,y,F,z,U,le,ye)=>{a.jb("Slice",p,{starts:y?Array.from(oe().subarray(Number(y)>>>0,Number(F)>>>0)):[],ends:z?Array.from(oe().subarray(Number(z)>>>0,Number(U)>>>0)):[],axes:le?Array.from(oe().subarray(Number(le)>>>0,Number(ye)>>>0)):[]})},841440:p=>{a.jb("Tile",p,void 0)},841492:(p,y,F)=>{a.jb("InstanceNormalization",p,{epsilon:y,format:F?"NHWC":"NCHW"})},841606:(p,y,F)=>{a.jb("InstanceNormalization",p,{epsilon:y,format:F?"NHWC":"NCHW"})},841720:p=>{a.jb("Range",p,void 0)},841773:(p,y)=>{a.jb("Einsum",p,{equation:Ye(y)})},841854:(p,y,F,z,U)=>{a.jb("Pad",p,{mode:y,value:F,pads:z?Array.from(oe().subarray(Number(z)>>>0,Number(U)>>>0)):[]})},841997:(p,y,F,z,U,le)=>{a.jb("BatchNormalization",p,{epsilon:y,momentum:F,spatial:!!U,trainingMode:!!z,format:le?"NHWC":"NCHW"})},842166:(p,y,F,z,U,le)=>{a.jb("BatchNormalization",p,{epsilon:y,momentum:F,spatial:!!U,trainingMode:!!z,format:le?"NHWC":"NCHW"})},842335:(p,y,F)=>{a.jb("CumSum",p,{exclusive:Number(y),reverse:Number(F)})},842432:(p,y,F)=>{a.jb("DequantizeLinear",p,{axis:y,blockSize:F})},842522:(p,y,F,z,U)=>{a.jb("GridSample",p,{align_corners:y,mode:Ye(F),padding_mode:Ye(z),format:U?"NHWC":"NCHW"})},842692:(p,y,F,z,U)=>{a.jb("GridSample",p,{align_corners:y,mode:Ye(F),padding_mode:Ye(z),format:U?"NHWC":"NCHW"})},842862:(p,y)=>{a.jb("ScatterND",p,{reduction:Ye(y)})},842947:(p,y,F,z,U,le,ye,Oe,Xe)=>{a.jb("Attention",p,{numHeads:y,isUnidirectional:F,maskFilterValue:z,scale:U,doRotary:le,qkvHiddenSizes:ye?Array.from(oe().subarray(Number(Oe)>>>0,Number(Oe)+ye>>>0)):[],pastPresentShareBuffer:!!Xe})},843219:p=>{a.jb("BiasAdd",p,void 0)},843274:p=>{a.jb("BiasSplitGelu",p,void 0)},843335:p=>{a.jb("FastGelu",p,void 0)},843391:(p,y,F,z,U,le,ye,Oe,Xe,ot,Tt,Nt,Jt,yr,Gs,Vn)=>{a.jb("Conv",p,{format:Nt?"NHWC":"NCHW",auto_pad:y,dilations:F?Array.from(oe().subarray(Number(F)>>>0,Number(z)>>>0)):[],group:U,kernel_shape:le?Array.from(oe().subarray(Number(le)>>>0,Number(ye)>>>0)):[],pads:Oe?Array.from(oe().subarray(Number(Oe)>>>0,Number(Xe)>>>0)):[],strides:ot?Array.from(oe().subarray(Number(ot)>>>0,Number(Tt)>>>0)):[],w_is_const:()=>!!D()[Number(Jt)>>>0],activation:Ye(yr),activation_params:Gs?Array.from(ze().subarray(Number(Gs)>>>0,Number(Vn)>>>0)):[]})},843975:p=>{a.jb("Gelu",p,void 0)},844027:(p,y,F,z,U,le,ye,Oe,Xe)=>{a.jb("GroupQueryAttention",p,{numHeads:y,kvNumHeads:F,scale:z,softcap:U,doRotary:le,rotaryInterleaved:ye,smoothSoftmax:Oe,localWindowSize:Xe})},844244:(p,y,F,z)=>{a.jb("LayerNormalization",p,{axis:y,epsilon:F,simplified:!!z})},844355:(p,y,F,z)=>{a.jb("LayerNormalization",p,{axis:y,epsilon:F,simplified:!!z})},844466:(p,y,F,z,U,le)=>{a.jb("MatMulNBits",p,{k:y,n:F,accuracyLevel:z,bits:U,blockSize:le})},844593:(p,y,F,z,U,le)=>{a.jb("MultiHeadAttention",p,{numHeads:y,isUnidirectional:F,maskFilterValue:z,scale:U,doRotary:le})},844752:(p,y)=>{a.jb("QuickGelu",p,{alpha:y})},844816:(p,y,F,z,U)=>{a.jb("RotaryEmbedding",p,{interleaved:!!y,numHeads:F,rotaryEmbeddingDim:z,scale:U})},844955:(p,y,F)=>{a.jb("SkipLayerNormalization",p,{epsilon:y,simplified:!!F})},845057:(p,y,F)=>{a.jb("SkipLayerNormalization",p,{epsilon:y,simplified:!!F})},845159:(p,y,F,z)=>{a.jb("GatherBlockQuantized",p,{gatherAxis:y,quantizeAxis:F,blockSize:z})},845280:p=>{a.Zb(p)},845314:(p,y)=>a.ac(Number(p),Number(y),a.Fb.dc,a.Fb.errors)};function qe(p,y,F){return _r(async()=>{await a.Xb(Number(p),Number(y),Number(F))})}function Ke(){return typeof wasmOffsetConverter<"u"}class Re{constructor(y){ee(this,"name","ExitStatus");this.message=`Program terminated with exit(${y})`,this.status=y}}var tt=p=>{p.terminate(),p.onmessage=()=>{}},Qe=[],at=p=>{At.length==0&&(G(),se(At[0]));var y=At.pop();if(!y)return 6;Bt.push(y),ft[p.Ab]=y,y.Ab=p.Ab;var F={Bb:"run",fc:p.ec,Hb:p.Hb,Ab:p.Ab};return y.postMessage(F,p.Mb),0},it=0,Ne=(p,y,...F)=>{for(var z=2*F.length,U=xa(),le=Za(8*z),ye=le>>>3,Oe=0;Oe<F.length;Oe++){var Xe=F[Oe];typeof Xe=="bigint"?(q[ye+2*Oe]=BigInt(1),q[ye+2*Oe+1]=Xe):(q[ye+2*Oe]=BigInt(0),We()[ye+2*Oe+1>>>0]=Xe)}return p=No(p,0,z,le,y),va(U),p};function et(p){if(c)return Ne(0,1,p);if(P=p,!(0<it)){for(var y of Bt)tt(y);for(y of At)tt(y);At=[],Bt=[],ft={},he=!0}E(0,new Re(p))}function _t(p){if(c)return Ne(1,0,p);Et(p)}var Et=p=>{if(P=p,c)throw _t(p),"unwind";et(p)},At=[],Bt=[],ar=[],ft={},Jr=p=>{var y=p.Ab;delete ft[y],At.push(p),Bt.splice(Bt.indexOf(p),1),p.Ab=0,jo(y)};function L(){ar.forEach(p=>p())}var se=p=>new Promise(y=>{p.onmessage=U=>{var le=(U=U.data).Bb;if(U.Gb&&U.Gb!=Ma()){var ye=ft[U.Gb];ye?ye.postMessage(U,U.Mb):T(`Internal error! Worker sent a message "${le}" to target pthread ${U.Gb}, but that thread no longer exists!`)}else le==="checkMailbox"?Be():le==="spawnThread"?at(U):le==="cleanupThread"?Jr(ft[U.hc]):le==="loaded"?(p.loaded=!0,y(p)):le==="alert"?alert(`Thread ${U.ic}: ${U.text}`):U.target==="setimmediate"?p.postMessage(U):le==="callHandler"?a[U.Qb](...U.args):le&&T(`worker sent an unknown command ${le}`)},p.onerror=U=>{throw T(`worker sent an error! ${U.filename}:${U.lineno}: ${U.message}`),U};var F,z=[];for(F of[])a.propertyIsEnumerable(F)&&z.push(F);p.postMessage({Bb:"load",Rb:z,kc:S,lc:g})});function G(){var p=new Worker((()=>{let y=URL;return Is.url>"file:"&&Is.url<"file;"?new y("ort.bundle.min.mjs",Is.url):new URL(Is.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});At.push(p)}var te=p=>{j();var y=ge()[p+52>>>2>>>0];p=ge()[p+56>>>2>>>0],Ya(y,y-p),va(y)},Me=(p,y)=>{it=0,p=Uo(p,y),0<it?P=p:ba(p)};class je{constructor(y){this.Ib=y-24}}function Se(p,y,F){var z=new je(p>>>=0);throw y>>>=0,F>>>=0,ge()[z.Ib+16>>>2>>>0]=0,ge()[z.Ib+4>>>2>>>0]=y,ge()[z.Ib+8>>>2>>>0]=F,p}function Dt(p,y,F,z){return c?Ne(2,1,p,y,F,z):Xt(p,y,F,z)}function Xt(p,y,F,z){if(p>>>=0,F>>>=0,z>>>=0,_===void 0)return 6;var U=[];return c&&U.length===0?Dt(p,y>>>=0,F,z):(p={ec:F,Ab:p,Hb:z,Mb:U},c?(p.Bb="spawnThread",postMessage(p,U),0):at(p))}var ht=typeof TextDecoder<"u"?new TextDecoder:void 0,Ot=(p,y=0,F=NaN)=>{var z=(y>>>=0)+F;for(F=y;p[F]&&!(F>=z);)++F;if(16<F-y&&p.buffer&&ht)return ht.decode(p.buffer instanceof ArrayBuffer?p.subarray(y,F):p.slice(y,F));for(z="";y<F;){var U=p[y++];if(128&U){var le=63&p[y++];if((224&U)==192)z+=String.fromCharCode((31&U)<<6|le);else{var ye=63&p[y++];65536>(U=(240&U)==224?(15&U)<<12|le<<6|ye:(7&U)<<18|le<<12|ye<<6|63&p[y++])?z+=String.fromCharCode(U):(U-=65536,z+=String.fromCharCode(55296|U>>10,56320|1023&U))}}else z+=String.fromCharCode(U)}return z},Ye=(p,y)=>(p>>>=0)?Ot(K(),p,y):"";function vt(p,y,F){return c?Ne(3,1,p,y,F):0}function yt(p,y){if(c)return Ne(4,1,p,y)}var zt=p=>{for(var y=0,F=0;F<p.length;++F){var z=p.charCodeAt(F);127>=z?y++:2047>=z?y+=2:55296<=z&&57343>=z?(y+=4,++F):y+=3}return y},It=(p,y,F)=>{var z=K();if(y>>>=0,0<F){var U=y;F=y+F-1;for(var le=0;le<p.length;++le){var ye=p.charCodeAt(le);if(55296<=ye&&57343>=ye&&(ye=65536+((1023&ye)<<10)|1023&p.charCodeAt(++le)),127>=ye){if(y>=F)break;z[y++>>>0]=ye}else{if(2047>=ye){if(y+1>=F)break;z[y++>>>0]=192|ye>>6}else{if(65535>=ye){if(y+2>=F)break;z[y++>>>0]=224|ye>>12}else{if(y+3>=F)break;z[y++>>>0]=240|ye>>18,z[y++>>>0]=128|ye>>12&63}z[y++>>>0]=128|ye>>6&63}z[y++>>>0]=128|63&ye}}z[y>>>0]=0,p=y-U}else p=0;return p};function er(p,y){if(c)return Ne(5,1,p,y)}function br(p,y,F){if(c)return Ne(6,1,p,y,F)}function hr(p,y,F){return c?Ne(7,1,p,y,F):0}function Ir(p,y){if(c)return Ne(8,1,p,y)}function tr(p,y,F){if(c)return Ne(9,1,p,y,F)}function kr(p,y,F,z){if(c)return Ne(10,1,p,y,F,z)}function jr(p,y,F,z){if(c)return Ne(11,1,p,y,F,z)}function Yr(p,y,F,z){if(c)return Ne(12,1,p,y,F,z)}function vs(p){if(c)return Ne(13,1,p)}function Ds(p,y){if(c)return Ne(14,1,p,y)}function Os(p,y,F){if(c)return Ne(15,1,p,y,F)}var Vr,Wr,Ls=()=>Pe(""),Dr=p=>{for(var y="";K()[p>>>0];)y+=Vr[K()[p++>>>0]];return y},qr={},Ae={},Ze={};function rt(p,y,F={}){return function(z,U,le={}){var ye=U.name;if(!z)throw new Wr(`type "${ye}" must have a positive integer typeid pointer`);if(Ae.hasOwnProperty(z)){if(le.Sb)return;throw new Wr(`Cannot register type \'${ye}\' twice`)}Ae[z]=U,delete Ze[z],qr.hasOwnProperty(z)&&(U=qr[z],delete qr[z],U.forEach(Oe=>Oe()))}(p,y,F)}var or=(p,y,F)=>{switch(y){case 1:return F?z=>D()[z>>>0]:z=>K()[z>>>0];case 2:return F?z=>re()[z>>>1>>>0]:z=>me()[z>>>1>>>0];case 4:return F?z=>oe()[z>>>2>>>0]:z=>ge()[z>>>2>>>0];case 8:return F?z=>q[z>>>3]:z=>X[z>>>3];default:throw new TypeError(`invalid integer width (${y}): ${p}`)}};function ps(p,y,F){F>>>=0,rt(p>>>=0,{name:y=Dr(y>>>0),fromWireType:z=>z,toWireType:function(z,U){if(typeof U!="bigint"&&typeof U!="number")throw U=U===null?"null":(z=typeof U)=="object"||z==="array"||z==="function"?U.toString():""+U,new TypeError(`Cannot convert "${U}" to ${this.name}`);return typeof U=="number"&&(U=BigInt(U)),U},Cb:Ur,readValueFromPointer:or(y,F,y.indexOf("u")==-1),Db:null})}var Ur=8;function ts(p,y,F,z){rt(p>>>=0,{name:y=Dr(y>>>0),fromWireType:function(U){return!!U},toWireType:function(U,le){return le?F:z},Cb:Ur,readValueFromPointer:function(U){return this.fromWireType(K()[U>>>0])},Db:null})}var ms=[],Or=[];function hs(p){9<(p>>>=0)&&--Or[p+1]==0&&(Or[p]=void 0,ms.push(p))}var fr=p=>{if(!p)throw new Wr("Cannot use deleted val. handle = "+p);return Or[p]},gr=p=>{switch(p){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let y=ms.pop()||Or.length;return Or[y]=p,Or[y+1]=1,y}};function js(p){return this.fromWireType(ge()[p>>>2>>>0])}var da={name:"emscripten::val",fromWireType:p=>{var y=fr(p);return hs(p),y},toWireType:(p,y)=>gr(y),Cb:Ur,readValueFromPointer:js,Db:null};function ua(p){return rt(p>>>0,da)}var _a=(p,y)=>{switch(y){case 4:return function(F){return this.fromWireType(ze()[F>>>2>>>0])};case 8:return function(F){return this.fromWireType(We()[F>>>3>>>0])};default:throw new TypeError(`invalid float width (${y}): ${p}`)}};function pa(p,y,F){F>>>=0,rt(p>>>=0,{name:y=Dr(y>>>0),fromWireType:z=>z,toWireType:(z,U)=>U,Cb:Ur,readValueFromPointer:_a(y,F),Db:null})}function zs(p,y,F,z,U){if(p>>>=0,F>>>=0,y=Dr(y>>>0),U===-1&&(U=4294967295),U=Oe=>Oe,z===0){var le=32-8*F;U=Oe=>Oe<<le>>>le}var ye=y.includes("unsigned")?function(Oe,Xe){return Xe>>>0}:function(Oe,Xe){return Xe};rt(p,{name:y,fromWireType:U,toWireType:ye,Cb:Ur,readValueFromPointer:or(y,F,z!==0),Db:null})}function ma(p,y,F){function z(le){var ye=ge()[le>>>2>>>0];return le=ge()[le+4>>>2>>>0],new U(D().buffer,le,ye)}var U=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][y];rt(p>>>=0,{name:F=Dr(F>>>0),fromWireType:z,Cb:Ur,readValueFromPointer:z},{Sb:!0})}function ha(p,y){rt(p>>>=0,{name:y=Dr(y>>>0),fromWireType:function(F){for(var z,U=ge()[F>>>2>>>0],le=F+4,ye=le,Oe=0;Oe<=U;++Oe){var Xe=le+Oe;Oe!=U&&K()[Xe>>>0]!=0||(ye=Ye(ye,Xe-ye),z===void 0?z=ye:(z+="\\0",z+=ye),ye=Xe+1)}return ss(F),z},toWireType:function(F,z){z instanceof ArrayBuffer&&(z=new Uint8Array(z));var U=typeof z=="string";if(!(U||z instanceof Uint8Array||z instanceof Uint8ClampedArray||z instanceof Int8Array))throw new Wr("Cannot pass non-string to std::string");var le=U?zt(z):z.length,ye=wa(4+le+1),Oe=ye+4;if(ge()[ye>>>2>>>0]=le,U)It(z,Oe,le+1);else if(U)for(U=0;U<le;++U){var Xe=z.charCodeAt(U);if(255<Xe)throw ss(ye),new Wr("String has UTF-16 code units that do not fit in 8 bits");K()[Oe+U>>>0]=Xe}else for(U=0;U<le;++U)K()[Oe+U>>>0]=z[U];return F!==null&&F.push(ss,ye),ye},Cb:Ur,readValueFromPointer:js,Db(F){ss(F)}})}var Xs=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,fa=(p,y)=>{for(var F=p>>1,z=F+y/2;!(F>=z)&&me()[F>>>0];)++F;if(32<(F<<=1)-p&&Xs)return Xs.decode(K().slice(p,F));for(F="",z=0;!(z>=y/2);++z){var U=re()[p+2*z>>>1>>>0];if(U==0)break;F+=String.fromCharCode(U)}return F},Bs=(p,y,F)=>{if(F!=null||(F=2147483647),2>F)return 0;var z=y;F=(F-=2)<2*p.length?F/2:p.length;for(var U=0;U<F;++U){var le=p.charCodeAt(U);re()[y>>>1>>>0]=le,y+=2}return re()[y>>>1>>>0]=0,y-z},ue=p=>2*p.length,I=(p,y)=>{for(var F=0,z="";!(F>=y/4);){var U=oe()[p+4*F>>>2>>>0];if(U==0)break;++F,65536<=U?(U-=65536,z+=String.fromCharCode(55296|U>>10,56320|1023&U)):z+=String.fromCharCode(U)}return z},V=(p,y,F)=>{if(y>>>=0,F!=null||(F=2147483647),4>F)return 0;var z=y;F=z+F-4;for(var U=0;U<p.length;++U){var le=p.charCodeAt(U);if(55296<=le&&57343>=le&&(le=65536+((1023&le)<<10)|1023&p.charCodeAt(++U)),oe()[y>>>2>>>0]=le,(y+=4)+4>F)break}return oe()[y>>>2>>>0]=0,y-z},Z=p=>{for(var y=0,F=0;F<p.length;++F){var z=p.charCodeAt(F);55296<=z&&57343>=z&&++F,y+=4}return y};function ne(p,y,F){if(p>>>=0,y>>>=0,F=Dr(F>>>=0),y===2)var z=fa,U=Bs,le=ue,ye=Oe=>me()[Oe>>>1>>>0];else y===4&&(z=I,U=V,le=Z,ye=Oe=>ge()[Oe>>>2>>>0]);rt(p,{name:F,fromWireType:Oe=>{for(var Xe,ot=ge()[Oe>>>2>>>0],Tt=Oe+4,Nt=0;Nt<=ot;++Nt){var Jt=Oe+4+Nt*y;Nt!=ot&&ye(Jt)!=0||(Tt=z(Tt,Jt-Tt),Xe===void 0?Xe=Tt:(Xe+="\\0",Xe+=Tt),Tt=Jt+y)}return ss(Oe),Xe},toWireType:(Oe,Xe)=>{if(typeof Xe!="string")throw new Wr(`Cannot pass non-string to C++ string type ${F}`);var ot=le(Xe),Tt=wa(4+ot+y);return ge()[Tt>>>2>>>0]=ot/y,U(Xe,Tt+4,ot+y),Oe!==null&&Oe.push(ss,Tt),Tt},Cb:Ur,readValueFromPointer:js,Db(Oe){ss(Oe)}})}function de(p,y){rt(p>>>=0,{Tb:!0,name:y=Dr(y>>>0),Cb:0,fromWireType:()=>{},toWireType:()=>{}})}function be(p){Xa(p>>>0,!l,1,!i,131072,!1),L()}var $e=p=>{if(!he)try{if(p(),!(0<it))try{c?ba(P):Et(P)}catch(y){y instanceof Re||y=="unwind"||E(0,y)}}catch(y){y instanceof Re||y=="unwind"||E(0,y)}};function Ge(p){p>>>=0,typeof Atomics.jc=="function"&&(Atomics.jc(oe(),p>>>2,p).value.then(Be),p+=128,Atomics.store(oe(),p>>>2,1))}var Be=()=>{var p=Ma();p&&(Ge(p),$e(Wo))};function Je(p,y){(p>>>=0)==y>>>0?setTimeout(Be):c?postMessage({Gb:p,Bb:"checkMailbox"}):(p=ft[p])&&p.postMessage({Bb:"checkMailbox"})}var wt=[];function Rt(p,y,F,z,U){for(y>>>=0,z/=2,wt.length=z,F=U>>>0>>>3,U=0;U<z;U++)wt[U]=q[F+2*U]?q[F+2*U+1]:We()[F+2*U+1>>>0];return(y?Ue[y]:jn[p])(...wt)}var vr=()=>{it=0};function Ht(p){p>>>=0,c?postMessage({Bb:"cleanupThread",hc:p}):Jr(ft[p])}function Ut(p){}var ir=(p,y)=>{var F=Ae[p];if(F===void 0)throw p=Qa(p),F=Dr(p),ss(p),new Wr(`${y} has unknown type ${F}`);return F},lr=(p,y,F)=>{var z=[];return p=p.toWireType(z,F),z.length&&(ge()[y>>>2>>>0]=gr(z)),p};function ls(p,y,F){return y>>>=0,F>>>=0,p=fr(p>>>0),y=ir(y,"emval::as"),lr(y,F,p)}function fs(p,y){return y>>>=0,p=fr(p>>>0),(y=ir(y,"emval::as")).toWireType(null,p)}var cr=p=>{try{p()}catch(y){Pe(y)}},Cr=0,Vt=null,xr=0,Fr=[],rs={},gs={},Lr=0,zr=null,Sr=[];function _r(p){return function(y){if(!he){if(Cr===0){var F=!1,z=!1;y((U=0)=>{if(!he&&(xr=U,F=!0,z)){Cr=2,cr(()=>Ko(Vt)),typeof MainLoop<"u"&&MainLoop.Pb&&MainLoop.resume(),U=!1;try{var le=function(){var Xe=oe()[Vt+8>>>2>>>0];return Xe=mt[gs[Xe]],--it,Xe()}()}catch(Xe){le=Xe,U=!0}var ye=!1;if(!Vt){var Oe=zr;Oe&&(zr=null,(U?Oe.reject:Oe.resolve)(le),ye=!0)}if(U&&!ye)throw le}}),z=!0,F||(Cr=1,Vt=function(){var U=wa(65548),le=U+12;ge()[U>>>2>>>0]=le,ge()[U+4>>>2>>>0]=le+65536,le=Fr[0];var ye=rs[le];return ye===void 0&&(ye=Lr++,rs[le]=ye,gs[ye]=le),le=ye,oe()[U+8>>>2>>>0]=le,U}(),typeof MainLoop<"u"&&MainLoop.Pb&&MainLoop.pause(),cr(()=>Go(Vt)))}else Cr===2?(Cr=0,cr(Ho),ss(Vt),Vt=null,Sr.forEach($e)):Pe(`invalid state: ${Cr}`);return xr}}(y=>{p().then(y)})}function Mr(p){return p>>>=0,_r(async()=>{var y=await fr(p);return gr(y)})}var ur=[];function Zr(p,y,F,z){return F>>>=0,z>>>=0,(p=ur[p>>>0])(null,y=fr(y>>>0),F,z)}var Ms={},Vs=p=>{var y=Ms[p];return y===void 0?Dr(p):y};function wn(p,y,F,z,U){return F>>>=0,z>>>=0,U>>>=0,(p=ur[p>>>0])(y=fr(y>>>0),y[F=Vs(F)],z,U)}var fo=()=>typeof globalThis=="object"?globalThis:Function("return this")();function bn(p){return(p>>>=0)==0?gr(fo()):(p=Vs(p),gr(fo()[p]))}var vn=p=>{var y=ur.length;return ur.push(p),y},Js=(p,y)=>{for(var F=Array(p),z=0;z<p;++z)F[z]=ir(ge()[y+4*z>>>2>>>0],"parameter "+z);return F},go=(p,y)=>Object.defineProperty(y,"name",{value:p});function xn(p,y,F){var z=(y=Js(p,y>>>0)).shift();p--;var U=`return function (obj, func, destructorsRef, args) {\n`,le=0,ye=[];F===0&&ye.push("obj");for(var Oe=["retType"],Xe=[z],ot=0;ot<p;++ot)ye.push("arg"+ot),Oe.push("argType"+ot),Xe.push(y[ot]),U+=`  var arg${ot} = argType${ot}.readValueFromPointer(args${le?"+"+le:""});\n`,le+=y[ot].Cb;return U+=`  var rv = ${F===1?"new func":"func.call"}(${ye.join(", ")});\n`,z.Tb||(Oe.push("emval_returnValue"),Xe.push(lr),U+=`  return emval_returnValue(retType, destructorsRef, rv);\n`),Oe.push(U+`};\n`),p=function(Tt){var Nt=Function;if(!(Nt instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof Nt} which is not a function`);var Jt=go(Nt.name||"unknownFunctionName",function(){});return Jt.prototype=Nt.prototype,Jt=new Jt,(Tt=Nt.apply(Jt,Tt))instanceof Object?Tt:Jt}(Oe)(...Xe),F=`methodCaller<(${y.map(Tt=>Tt.name).join(", ")}) => ${z.name}>`,vn(go(F,p))}function yn(p){return p=Vs(p>>>0),gr(a[p])}function Tn(p,y){return y>>>=0,p=fr(p>>>0),y=fr(y),gr(p[y])}function Pn(p){9<(p>>>=0)&&(Or[p+1]+=1)}function Mo(){return gr([])}function En(p){p=fr(p>>>0);for(var y=Array(p.length),F=0;F<p.length;F++)y[F]=p[F];return gr(y)}function kn(p){return gr(Vs(p>>>0))}function wo(){return gr({})}function Cn(p){for(var y=fr(p>>>=0);y.length;){var F=y.pop();y.pop()(F)}hs(p)}function bo(p,y,F){y>>>=0,F>>>=0,p=fr(p>>>0),y=fr(y),F=fr(F),p[y]=F}function Sn(p,y){return y>>>=0,p=(p=ir(p>>>0,"_emval_take_value")).readValueFromPointer(y),gr(p)}function vo(p,y){p=-9007199254740992>p||9007199254740992<p?NaN:Number(p),y>>>=0,p=new Date(1e3*p),oe()[y>>>2>>>0]=p.getUTCSeconds(),oe()[y+4>>>2>>>0]=p.getUTCMinutes(),oe()[y+8>>>2>>>0]=p.getUTCHours(),oe()[y+12>>>2>>>0]=p.getUTCDate(),oe()[y+16>>>2>>>0]=p.getUTCMonth(),oe()[y+20>>>2>>>0]=p.getUTCFullYear()-1900,oe()[y+24>>>2>>>0]=p.getUTCDay(),p=(p.getTime()-Date.UTC(p.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,oe()[y+28>>>2>>>0]=p}var In=p=>p%4==0&&(p%100!=0||p%400==0),xo=[0,31,60,91,121,152,182,213,244,274,305,335],Ua=[0,31,59,90,120,151,181,212,243,273,304,334];function yo(p,y){p=-9007199254740992>p||9007199254740992<p?NaN:Number(p),y>>>=0,p=new Date(1e3*p),oe()[y>>>2>>>0]=p.getSeconds(),oe()[y+4>>>2>>>0]=p.getMinutes(),oe()[y+8>>>2>>>0]=p.getHours(),oe()[y+12>>>2>>>0]=p.getDate(),oe()[y+16>>>2>>>0]=p.getMonth(),oe()[y+20>>>2>>>0]=p.getFullYear()-1900,oe()[y+24>>>2>>>0]=p.getDay();var F=(In(p.getFullYear())?xo:Ua)[p.getMonth()]+p.getDate()-1|0;oe()[y+28>>>2>>>0]=F,oe()[y+36>>>2>>>0]=-60*p.getTimezoneOffset(),F=new Date(p.getFullYear(),6,1).getTimezoneOffset();var z=new Date(p.getFullYear(),0,1).getTimezoneOffset();p=0|(F!=z&&p.getTimezoneOffset()==Math.min(z,F)),oe()[y+32>>>2>>>0]=p}function Ga(p){p>>>=0;var y=new Date(oe()[p+20>>>2>>>0]+1900,oe()[p+16>>>2>>>0],oe()[p+12>>>2>>>0],oe()[p+8>>>2>>>0],oe()[p+4>>>2>>>0],oe()[p>>>2>>>0],0),F=oe()[p+32>>>2>>>0],z=y.getTimezoneOffset(),U=new Date(y.getFullYear(),6,1).getTimezoneOffset(),le=new Date(y.getFullYear(),0,1).getTimezoneOffset(),ye=Math.min(le,U);return 0>F?oe()[p+32>>>2>>>0]=+(U!=le&&ye==z):0<F!=(ye==z)&&(U=Math.max(le,U),y.setTime(y.getTime()+6e4*((0<F?ye:U)-z))),oe()[p+24>>>2>>>0]=y.getDay(),F=(In(y.getFullYear())?xo:Ua)[y.getMonth()]+y.getDate()-1|0,oe()[p+28>>>2>>>0]=F,oe()[p>>>2>>>0]=y.getSeconds(),oe()[p+4>>>2>>>0]=y.getMinutes(),oe()[p+8>>>2>>>0]=y.getHours(),oe()[p+12>>>2>>>0]=y.getDate(),oe()[p+16>>>2>>>0]=y.getMonth(),oe()[p+20>>>2>>>0]=y.getYear(),p=y.getTime(),BigInt(isNaN(p)?-1:p/1e3)}function To(p,y,F,z,U,le,ye){return c?Ne(16,1,p,y,F,z,U,le,ye):-52}function Po(p,y,F,z,U,le){if(c)return Ne(17,1,p,y,F,z,U,le)}var Ys={},Fn=()=>performance.timeOrigin+performance.now();function Eo(p,y){if(c)return Ne(18,1,p,y);if(Ys[p]&&(clearTimeout(Ys[p].id),delete Ys[p]),!y)return 0;var F=setTimeout(()=>{delete Ys[p],$e(()=>Vo(p,performance.timeOrigin+performance.now()))},y);return Ys[p]={id:F,qc:y},0}function $n(p,y,F,z){p>>>=0,y>>>=0,F>>>=0,z>>>=0;var U=new Date().getFullYear(),le=new Date(U,0,1).getTimezoneOffset();U=new Date(U,6,1).getTimezoneOffset();var ye=Math.max(le,U);ge()[p>>>2>>>0]=60*ye,oe()[y>>>2>>>0]=+(le!=U),p=(y=Oe=>{var Xe=Math.abs(Oe);return`UTC${0<=Oe?"-":"+"}${String(Math.floor(Xe/60)).padStart(2,"0")}${String(Xe%60).padStart(2,"0")}`})(le),y=y(U),U<le?(It(p,F,17),It(y,z,17)):(It(p,z,17),It(y,F,17))}var An=()=>Date.now(),Dn=1;function ko(p,y,F){if(!(0<=p&&3>=p))return 28;if(p===0)p=Date.now();else{if(!Dn)return 52;p=performance.timeOrigin+performance.now()}return q[F>>>0>>>3]=BigInt(Math.round(1e6*p)),0}var Ka=[],ga=(p,y)=>{Ka.length=0;for(var F;F=K()[p++>>>0];){var z=F!=105;y+=(z&=F!=112)&&y%8?4:0,Ka.push(F==112?ge()[y>>>2>>>0]:F==106?q[y>>>3]:F==105?oe()[y>>>2>>>0]:We()[y>>>3>>>0]),y+=z?8:4}return Ka};function Co(p,y,F){return p>>>=0,y=ga(y>>>0,F>>>0),Ue[p](...y)}function On(p,y,F){return p>>>=0,y=ga(y>>>0,F>>>0),Ue[p](...y)}var So=()=>{};function Ws(p,y){return T(Ye(p>>>0,y>>>0))}var Ln=()=>{throw it+=1,"unwind"};function Ui(){return 4294901760}var zn=()=>navigator.hardwareConcurrency;function Gi(){return Pe("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function Bn(p){p>>>=0;var y=K().length;if(p<=y||4294901760<p)return!1;for(var F=1;4>=F;F*=2){var z=y*(1+.2/F);z=Math.min(z,p+100663296);e:{z=(Math.min(4294901760,65536*Math.ceil(Math.max(p,z)/65536))-S.buffer.byteLength+65535)/65536|0;try{S.grow(z),j();var U=1;break e}catch(le){}U=void 0}if(U)return!0}return!1}var Zs=()=>(Pe("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),Us={},Io=p=>{p.forEach(y=>{var F=Zs();F&&(Us[F]=y)})};function Rn(){var p=Error().stack.toString().split(`\n`);return p[0]=="Error"&&p.shift(),Io(p),Us.Lb=Zs(),Us.cc=p,Us.Lb}function Nn(p,y,F){if(p>>>=0,y>>>=0,Us.Lb==p)var z=Us.cc;else(z=Error().stack.toString().split(`\n`))[0]=="Error"&&z.shift(),Io(z);for(var U=3;z[U]&&Zs()!=p;)++U;for(p=0;p<F&&z[p+U];++p)oe()[y+4*p>>>2>>>0]=Zs();return p}var Ha,ea={},Fo=()=>{if(!Ha){var p,y={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(p in ea)ea[p]===void 0?delete y[p]:y[p]=ea[p];var F=[];for(p in y)F.push(`${p}=${y[p]}`);Ha=F}return Ha};function $o(p,y){if(c)return Ne(19,1,p,y);p>>>=0,y>>>=0;var F=0;return Fo().forEach((z,U)=>{var le=y+F;for(U=ge()[p+4*U>>>2>>>0]=le,le=0;le<z.length;++le)D()[U++>>>0]=z.charCodeAt(le);D()[U>>>0]=0,F+=z.length+1}),0}function Ao(p,y){if(c)return Ne(20,1,p,y);p>>>=0,y>>>=0;var F=Fo();ge()[p>>>2>>>0]=F.length;var z=0;return F.forEach(U=>z+=U.length+1),ge()[y>>>2>>>0]=z,0}function qa(p){return c?Ne(21,1,p):52}function Do(p,y,F,z){return c?Ne(22,1,p,y,F,z):52}function Oo(p,y,F,z){return c?Ne(23,1,p,y,F,z):70}var Lo=[null,[],[]];function zo(p,y,F,z){if(c)return Ne(24,1,p,y,F,z);y>>>=0,F>>>=0,z>>>=0;for(var U=0,le=0;le<F;le++){var ye=ge()[y>>>2>>>0],Oe=ge()[y+4>>>2>>>0];y+=8;for(var Xe=0;Xe<Oe;Xe++){var ot=K()[ye+Xe>>>0],Tt=Lo[p];ot===0||ot===10?((p===1?x:T)(Ot(Tt)),Tt.length=0):Tt.push(ot)}U+=Oe}return ge()[z>>>2>>>0]=U,0}c||function(){for(var p=a.numThreads-1;p--;)G();Qe.unshift(()=>{Ie++,function(y){c?y():Promise.all(At.map(se)).then(y)}(()=>ke())})}();for(var Bo=Array(256),ta=0;256>ta;++ta)Bo[ta]=String.fromCharCode(ta);Vr=Bo,Wr=a.BindingError=class extends Error{constructor(p){super(p),this.name="BindingError"}},a.InternalError=class extends Error{constructor(p){super(p),this.name="InternalError"}},Or.push(0,1,void 0,1,null,1,!0,1,!1,1),a.count_emval_handles=()=>Or.length/2-5-ms.length;var mt,jn=[et,_t,Dt,vt,yt,er,br,hr,Ir,tr,kr,jr,Yr,vs,Ds,Os,To,Po,Eo,$o,Ao,qa,Do,Oo,zo];(async function(){function p(z,U){return mt=z.exports,mt=function(){var le=mt,ye={};for(let[Oe,Xe]of Object.entries(le))ye[Oe]=typeof Xe=="function"?(...ot)=>{Fr.push(Oe);try{return Xe(...ot)}finally{he||(Fr.pop(),Vt&&Cr===1&&Fr.length===0&&(Cr=0,it+=1,cr(eo),typeof Fibers<"u"&&Fibers.rc()))}}:Xe;return ye}(),mt=function(){var le=mt,ye=Xe=>ot=>Xe(ot)>>>0,Oe=Xe=>()=>Xe()>>>0;return(le=Object.assign({},le)).Da=ye(le.Da),le.fb=Oe(le.fb),le.hb=ye(le.hb),le.tb=ye(le.tb),le.ub=Oe(le.ub),le.__cxa_get_exception_ptr=ye(le.__cxa_get_exception_ptr),le}(),ar.push(mt.ib),g=U,ke(),mt}Ie++;var y=He();if(a.instantiateWasm)return new Promise(z=>{a.instantiateWasm(y,(U,le)=>{p(U,le),z(U.exports)})});if(c)return new Promise(z=>{ie=U=>{var le=new WebAssembly.Instance(U,He());z(p(le,U))}});ve!=null||(ve=a.locateFile?a.locateFile?a.locateFile("ort-wasm-simd-threaded.jsep.wasm",M):M+"ort-wasm-simd-threaded.jsep.wasm":new URL("ort-wasm-simd-threaded.jsep.wasm",Is.url).href);try{var F=await async function(z){var U=ve;if(!ce&&typeof WebAssembly.instantiateStreaming=="function"&&!B(U))try{var le=fetch(U,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(le,z)}catch(ye){T(`wasm streaming compile failed: ${ye}`),T("falling back to ArrayBuffer instantiation")}return async function(ye,Oe){try{var Xe=await async function(ot){if(!ce)try{var Tt=await f(ot);return new Uint8Array(Tt)}catch(Nt){}if(ot==ve&&ce)ot=new Uint8Array(ce);else{if(!h)throw"both async and sync fetching of the wasm failed";ot=h(ot)}return ot}(ye);return await WebAssembly.instantiate(Xe,Oe)}catch(ot){T(`failed to asynchronously prepare wasm: ${ot}`),Pe(ot)}}(U,z)}(y);return p(F.instance,F.module)}catch(z){return o(z),Promise.reject(z)}})();var Qa=p=>(Qa=mt.Da)(p),Ro=()=>(Ro=mt.Ea)();a._OrtInit=(p,y)=>(a._OrtInit=mt.Fa)(p,y),a._OrtGetLastError=(p,y)=>(a._OrtGetLastError=mt.Ga)(p,y),a._OrtCreateSessionOptions=(p,y,F,z,U,le,ye,Oe,Xe,ot)=>(a._OrtCreateSessionOptions=mt.Ha)(p,y,F,z,U,le,ye,Oe,Xe,ot),a._OrtAppendExecutionProvider=(p,y,F,z,U)=>(a._OrtAppendExecutionProvider=mt.Ia)(p,y,F,z,U),a._OrtAddFreeDimensionOverride=(p,y,F)=>(a._OrtAddFreeDimensionOverride=mt.Ja)(p,y,F),a._OrtAddSessionConfigEntry=(p,y,F)=>(a._OrtAddSessionConfigEntry=mt.Ka)(p,y,F),a._OrtReleaseSessionOptions=p=>(a._OrtReleaseSessionOptions=mt.La)(p),a._OrtCreateSession=(p,y,F)=>(a._OrtCreateSession=mt.Ma)(p,y,F),a._OrtReleaseSession=p=>(a._OrtReleaseSession=mt.Na)(p),a._OrtGetInputOutputCount=(p,y,F)=>(a._OrtGetInputOutputCount=mt.Oa)(p,y,F),a._OrtGetInputOutputMetadata=(p,y,F,z)=>(a._OrtGetInputOutputMetadata=mt.Pa)(p,y,F,z),a._OrtFree=p=>(a._OrtFree=mt.Qa)(p),a._OrtCreateTensor=(p,y,F,z,U,le)=>(a._OrtCreateTensor=mt.Ra)(p,y,F,z,U,le),a._OrtGetTensorData=(p,y,F,z,U)=>(a._OrtGetTensorData=mt.Sa)(p,y,F,z,U),a._OrtReleaseTensor=p=>(a._OrtReleaseTensor=mt.Ta)(p),a._OrtCreateRunOptions=(p,y,F,z)=>(a._OrtCreateRunOptions=mt.Ua)(p,y,F,z),a._OrtAddRunConfigEntry=(p,y,F)=>(a._OrtAddRunConfigEntry=mt.Va)(p,y,F),a._OrtReleaseRunOptions=p=>(a._OrtReleaseRunOptions=mt.Wa)(p),a._OrtCreateBinding=p=>(a._OrtCreateBinding=mt.Xa)(p),a._OrtBindInput=(p,y,F)=>(a._OrtBindInput=mt.Ya)(p,y,F),a._OrtBindOutput=(p,y,F,z)=>(a._OrtBindOutput=mt.Za)(p,y,F,z),a._OrtClearBoundOutputs=p=>(a._OrtClearBoundOutputs=mt._a)(p),a._OrtReleaseBinding=p=>(a._OrtReleaseBinding=mt.$a)(p),a._OrtRunWithBinding=(p,y,F,z,U)=>(a._OrtRunWithBinding=mt.ab)(p,y,F,z,U),a._OrtRun=(p,y,F,z,U,le,ye,Oe)=>(a._OrtRun=mt.bb)(p,y,F,z,U,le,ye,Oe),a._OrtEndProfiling=p=>(a._OrtEndProfiling=mt.cb)(p),a._JsepOutput=(p,y,F)=>(a._JsepOutput=mt.db)(p,y,F),a._JsepGetNodeName=p=>(a._JsepGetNodeName=mt.eb)(p);var Ma=()=>(Ma=mt.fb)(),ss=a._free=p=>(ss=a._free=mt.gb)(p),wa=a._malloc=p=>(wa=a._malloc=mt.hb)(p),Xa=(p,y,F,z,U,le)=>(Xa=mt.kb)(p,y,F,z,U,le),Ja=()=>(Ja=mt.lb)(),No=(p,y,F,z,U)=>(No=mt.mb)(p,y,F,z,U),jo=p=>(jo=mt.nb)(p),ba=p=>(ba=mt.ob)(p),Vo=(p,y)=>(Vo=mt.pb)(p,y),Wo=()=>(Wo=mt.qb)(),Ya=(p,y)=>(Ya=mt.rb)(p,y),va=p=>(va=mt.sb)(p),Za=p=>(Za=mt.tb)(p),xa=()=>(xa=mt.ub)(),Uo=a.dynCall_ii=(p,y)=>(Uo=a.dynCall_ii=mt.vb)(p,y),Go=p=>(Go=mt.wb)(p),eo=()=>(eo=mt.xb)(),Ko=p=>(Ko=mt.yb)(p),Ho=()=>(Ho=mt.zb)();return a.stackSave=()=>xa(),a.stackRestore=p=>va(p),a.stackAlloc=p=>Za(p),a.setValue=function(p,y,F="i8"){switch(F.endsWith("*")&&(F="*"),F){case"i1":case"i8":D()[p>>>0]=y;break;case"i16":re()[p>>>1>>>0]=y;break;case"i32":oe()[p>>>2>>>0]=y;break;case"i64":q[p>>>3]=BigInt(y);break;case"float":ze()[p>>>2>>>0]=y;break;case"double":We()[p>>>3>>>0]=y;break;case"*":ge()[p>>>2>>>0]=y;break;default:Pe(`invalid type for setValue: ${F}`)}},a.getValue=function(p,y="i8"){switch(y.endsWith("*")&&(y="*"),y){case"i1":case"i8":return D()[p>>>0];case"i16":return re()[p>>>1>>>0];case"i32":return oe()[p>>>2>>>0];case"i64":return q[p>>>3];case"float":return ze()[p>>>2>>>0];case"double":return We()[p>>>3>>>0];case"*":return ge()[p>>>2>>>0];default:Pe(`invalid type for getValue: ${y}`)}},a.UTF8ToString=Ye,a.stringToUTF8=It,a.lengthBytesUTF8=zt,function p(){if(0<Ie)xe=p;else if(c)s(a),fe();else{for(;0<Qe.length;)Qe.shift()(a);0<Ie?xe=p:(a.calledRun=!0,he||(fe(),s(a)))}}(),a.PTR_SIZE=4,n}),Gb=Mc,Kf=(r=(e=globalThis.self)==null?void 0:e.name)==null?void 0:r.startsWith("em-pthread"),Kf&&Mc()}),Fd=Ve(()=>{"use strict";Id(),wc=typeof location>"u"?void 0:location.origin,ud=Is.url>"file:"&&Is.url<"file;",Hf=()=>{if(ud){let e=URL;return new URL(new e("ort.bundle.min.mjs",Is.url).href,wc).href}return Is.url},ds=Hf(),Kb=()=>{if(ds&&!ds.startsWith("blob:"))return ds.substring(0,ds.lastIndexOf("/")+1)},xi=(e,r)=>{try{let t=r!=null?r:ds;return(t?new URL(e,t):new URL(e)).origin===wc}catch(t){return!1}},qf=(e,r)=>{let t=r!=null?r:ds;try{return(t?new URL(e,t):new URL(e)).href}catch(s){return}},Qf=(e,r)=>`${r!=null?r:"./"}${e}`,bc=async e=>{let r=await(await fetch(e,{credentials:"same-origin"})).blob();return URL.createObjectURL(r)},Xf=async e=>(await import(e)).default,vc=(vT(),hn(Vb)).default,Hb=async()=>{if(!ds)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(xi(ds))return[void 0,vc()];let e=await bc(ds);return[e,vc(e)]},xc=(xT(),hn(Ub)).default,qb=async(e,r,t)=>{if(!e&&!r&&xc&&ds&&xi(ds))return[void 0,xc];{let s="ort-wasm-simd-threaded.jsep.mjs",o=e!=null?e:qf(s,r),a=t&&o&&!xi(o,r),n=a?await bc(o):o!=null?o:Qf(s,r);return[a?n:void 0,await Xf(n)]}}}),Va=Ve(()=>{"use strict";Fd(),yi=!1,en=!1,Tc=!1,Jf=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch(e){return!1}},Yf=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch(e){return!1}},Zf=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch(e){return!1}},$d=async e=>{var v,E;if(yi)return Promise.resolve();if(en)throw new Error("multiple calls to \'initializeWebAssembly()\' detected.");if(Tc)throw new Error("previous call to \'initializeWebAssembly()\' failed.");en=!0;let r=e.initTimeout,t=e.numThreads;if(e.simd!==!1){if(e.simd==="relaxed"){if(!Zf())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!Yf())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let s=Jf();t>1&&!s&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+t+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),e.numThreads=t=1);let o=e.wasmPaths,a=typeof o=="string"?o:void 0,n=o==null?void 0:o.mjs,i=(v=n==null?void 0:n.href)!=null?v:n,l=o==null?void 0:o.wasm,c=(E=l==null?void 0:l.href)!=null?E:l,_=e.wasmBinary,[d,u]=await qb(i,a,t>1),f=!1,h=[];if(r>0&&h.push(new Promise(M=>{setTimeout(()=>{f=!0,M()},r)})),h.push(new Promise((M,w)=>{let C={numThreads:t};if(_)C.wasmBinary=_;else if(c||a)C.locateFile=x=>c!=null?c:a+x;else if(i&&i.indexOf("blob:")!==0)C.locateFile=x=>new URL(x,i).href;else if(d){let x=Kb();x&&(C.locateFile=T=>x+T)}u(C).then(x=>{en=!1,yi=!0,yc=x,M(),d&&URL.revokeObjectURL(d)},x=>{en=!1,Tc=!0,w(x)})})),await Promise.race(h),f)throw new Error(`WebAssembly backend initializing failed due to timeout: ${r}ms`)},sr=()=>{if(yi&&yc)return yc;throw new Error("WebAssembly is not initialized yet.")}}),Ad=Ve(()=>{"use strict";Va(),Ss=(e,r)=>{let t=sr(),s=t.lengthBytesUTF8(e)+1,o=t._malloc(s);return t.stringToUTF8(e,o,s),r.push(o),o},zi=(e,r,t,s)=>{if(typeof e=="object"&&e!==null){if(t.has(e))throw new Error("Circular reference in options");t.add(e)}Object.entries(e).forEach(([o,a])=>{let n=r?r+o:o;if(typeof a=="object")zi(a,n+".",t,s);else if(typeof a=="string"||typeof a=="number")s(n,a.toString());else if(typeof a=="boolean")s(n,a?"1":"0");else throw new Error(`Can\'t handle extra config type: ${typeof a}`)})},Zt=e=>{let r=sr(),t=r.stackSave();try{let s=r.PTR_SIZE,o=r.stackAlloc(2*s);r._OrtGetLastError(o,o+s);let a=Number(r.getValue(o,s===4?"i32":"i64")),n=r.getValue(o+s,"*"),i=n?r.UTF8ToString(n):"";throw new Error(`${e} ERROR_CODE: ${a}, ERROR_MESSAGE: ${i}`)}finally{r.stackRestore(t)}}}),yT=Ve(()=>{"use strict";Va(),Ad(),Qb=e=>{let r=sr(),t=0,s=[],o=e||{};try{if((e==null?void 0:e.logSeverityLevel)===void 0)o.logSeverityLevel=2;else if(typeof e.logSeverityLevel!="number"||!Number.isInteger(e.logSeverityLevel)||e.logSeverityLevel<0||e.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${e.logSeverityLevel}`);if((e==null?void 0:e.logVerbosityLevel)===void 0)o.logVerbosityLevel=0;else if(typeof e.logVerbosityLevel!="number"||!Number.isInteger(e.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${e.logVerbosityLevel}`);(e==null?void 0:e.terminate)===void 0&&(o.terminate=!1);let a=0;return(e==null?void 0:e.tag)!==void 0&&(a=Ss(e.tag,s)),t=r._OrtCreateRunOptions(o.logSeverityLevel,o.logVerbosityLevel,!!o.terminate,a),t===0&&Zt("Can\'t create run options."),(e==null?void 0:e.extra)!==void 0&&zi(e.extra,"",new WeakSet,(n,i)=>{let l=Ss(n,s),c=Ss(i,s);r._OrtAddRunConfigEntry(t,l,c)!==0&&Zt(`Can\'t set a run config entry: ${n} - ${i}.`)}),[t,s]}catch(a){throw t!==0&&r._OrtReleaseRunOptions(t),s.forEach(n=>r._free(n)),a}}}),TT=Ve(()=>{"use strict";Va(),Ad(),eg=e=>{switch(e){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${e}`)}},tg=e=>{switch(e){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${e}`)}},rg=e=>{e.extra||(e.extra={}),e.extra.session||(e.extra.session={});let r=e.extra.session;r.use_ort_model_bytes_directly||(r.use_ort_model_bytes_directly="1"),e.executionProviders&&e.executionProviders.some(t=>(typeof t=="string"?t:t.name)==="webgpu")&&(e.enableMemPattern=!1)},tn=(e,r,t,s)=>{let o=Ss(r,s),a=Ss(t,s);sr()._OrtAddSessionConfigEntry(e,o,a)!==0&&Zt(`Can\'t set a session config entry: ${r} - ${t}.`)},sg=async(e,r,t)=>{for(let s of r){let o=typeof s=="string"?s:s.name,a=[];switch(o){case"webnn":if(o="WEBNN",typeof s!="string"){let _=s==null?void 0:s.deviceType;_&&tn(e,"deviceType",_,t)}break;case"webgpu":if(o="JS",typeof s!="string"){let _=s;if(_!=null&&_.preferredLayout){if(_.preferredLayout!=="NCHW"&&_.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either \'NCHW\' or \'NHWC\': ${_.preferredLayout}`);tn(e,"preferredLayout",_.preferredLayout,t)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${o}`)}let n=Ss(o,t),i=a.length,l=0,c=0;if(i>0){l=sr()._malloc(i*sr().PTR_SIZE),t.push(l),c=sr()._malloc(i*sr().PTR_SIZE),t.push(c);for(let _=0;_<i;_++)sr().setValue(l+_*sr().PTR_SIZE,a[_][0],"*"),sr().setValue(c+_*sr().PTR_SIZE,a[_][1],"*")}await sr()._OrtAppendExecutionProvider(e,n,l,c,i)!==0&&Zt(`Can\'t append execution provider: ${o}.`)}},Xb=async e=>{var a,n,i,l;let r=sr(),t=0,s=[],o=e||{};rg(o);try{let c=eg((a=o.graphOptimizationLevel)!=null?a:"all"),_=tg((n=o.executionMode)!=null?n:"sequential"),d=typeof o.logId=="string"?Ss(o.logId,s):0,u=(i=o.logSeverityLevel)!=null?i:2;if(!Number.isInteger(u)||u<0||u>4)throw new Error(`log serverity level is not valid: ${u}`);let f=(l=o.logVerbosityLevel)!=null?l:0;if(!Number.isInteger(f)||f<0||f>4)throw new Error(`log verbosity level is not valid: ${f}`);let h=typeof o.optimizedModelFilePath=="string"?Ss(o.optimizedModelFilePath,s):0;if(t=r._OrtCreateSessionOptions(c,!!o.enableCpuMemArena,!!o.enableMemPattern,_,!!o.enableProfiling,0,d,u,f,h),t===0&&Zt("Can\'t create session options."),o.executionProviders&&await sg(t,o.executionProviders,s),o.enableGraphCapture!==void 0){if(typeof o.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${o.enableGraphCapture}`);tn(t,"enableGraphCapture",o.enableGraphCapture.toString(),s)}if(o.freeDimensionOverrides)for(let[v,E]of Object.entries(o.freeDimensionOverrides)){if(typeof v!="string")throw new Error(`free dimension override name must be a string: ${v}`);if(typeof E!="number"||!Number.isInteger(E)||E<0)throw new Error(`free dimension override value must be a non-negative integer: ${E}`);let M=Ss(v,s);r._OrtAddFreeDimensionOverride(t,M,E)!==0&&Zt(`Can\'t set a free dimension override: ${v} - ${E}.`)}return o.extra!==void 0&&zi(o.extra,"",new WeakSet,(v,E)=>{tn(t,v,E,s)}),[t,s]}catch(c){throw t!==0&&r._OrtReleaseSessionOptions(t)!==0&&Zt("Can\'t release session options."),s.forEach(_=>r._free(_)),c}}}),bt=Ve(()=>{"use strict";uo=e=>{switch(e){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${e}`)}},qs=e=>{switch(e){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${e}`)}},za=(e,r)=>{let t=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][e],s=typeof r=="number"?r:r.reduce((o,a)=>o*a,1);return t>0?Math.ceil(s*t):void 0},Dd=e=>{switch(e){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${e}`)}},Bi=e=>{switch(e){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${e}`)}},Od=e=>e==="float32"||e==="float16"||e==="int32"||e==="int64"||e==="uint32"||e==="uint8"||e==="bool"||e==="uint4"||e==="int4",Ld=e=>e==="float32"||e==="float16"||e==="int32"||e==="int64"||e==="uint32"||e==="uint64"||e==="int8"||e==="uint8"||e==="bool"||e==="uint4"||e==="int4",_d=e=>{switch(e){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${e}`)}}}),Jb=Ve(()=>{"use strict";Id(),zd=async e=>{if(typeof e=="string")if(0)try{}catch(a){if(a.code==="ERR_FS_FILE_TOO_LARGE")try{for(var r=Xz(i),t,s,o;t=!(s=await r.next()).done;t=!1){let c=s.value;;}}catch(s){o=[s]}finally{try{t&&(s=r.return)&&await s.call(r)}finally{if(o)throw o[0]}}}else{let a=await fetch(e);if(!a.ok)throw new Error(`failed to load external data file: ${e}`);let n=a.headers.get("Content-Length"),i=n?parseInt(n,10):0;if(i<1073741824)return new Uint8Array(await a.arrayBuffer());{if(!a.body)throw new Error(`failed to load external data file: ${e}, no response body.`);let l=a.body.getReader(),c;try{c=new ArrayBuffer(i)}catch(d){if(d instanceof RangeError){let u=Math.ceil(i/65536);c=new WebAssembly.Memory({initial:u,maximum:u}).buffer}else throw d}let _=0;for(;;){let{done:d,value:u}=await l.read();if(d)break;let f=u.byteLength;new Uint8Array(c,_,f).set(u),_+=f}return new Uint8Array(c,0,i)}}else return e instanceof Blob?new Uint8Array(await e.arrayBuffer()):e instanceof Uint8Array?e:new Uint8Array(e)}}),Qs=Ve(()=>{"use strict";bt(),ag=["V","I","W","E","F"],og=(e,r)=>{console.log(`[${ag[e]},${new Date().toISOString()}]${r}`)},Bd=(e,r)=>{ng=e,ig=r},lg=(e,r)=>{let t=Bi(e),s=Bi(ng);t>=s&&og(t,typeof r=="function"?r():r)},jt=(...e)=>{ig&&lg(...e)}}),St=Ve(()=>{"use strict";cg=class{static calcMatMulShape(e,r){return e[1]!==r[0]?void 0:[e[0],r[1]]}},po=class{static calcShape(e,r,t=!1){let s=e.length,o=r.length;if(s===0)return r;if(o===0)return e;let a=Math.max(e.length,r.length),n=new Array(a);if(t){if(s<2||o<2)return;let i=cg.calcMatMulShape([e[s-2],e[s-1]],[r[o-2],r[o-1]]);if(i===void 0)return;[n[a-2],n[a-1]]=i}for(let i=t?3:1;i<=a;i++){let l=s-i<0?1:e[s-i],c=o-i<0?1:r[o-i];if(l!==c&&l>1&&c>1)return;let _=Math.max(l,c);if(l&&c)n[a-i]=Math.max(l,c);else{if(_>1)return;n[a-i]=0}}return n}static isValidBroadcast(e,r){let t=e.length,s=r.length;if(t>s)return!1;for(let o=1;o<=t;o++)if(e[t-o]!==1&&e[t-o]!==r[s-o])return!1;return!0}},we=class Oi{static size(r){return Oi.getSizeFromDimensionRange(r,0,r.length)}static convertShape(r,t=4){let s=r.length;if(s===0)return[];let o=new Array(s),a=s-1;for(;a>=0;){if(r[a]%t===0){o[a]=r[a]/t;break}if(t%r[a]!==0)throw new Error("cannot convert shape");o[a]=1,t/=r[a],a--}for(a--;a>=0;a--)o[a]=r[a];return o}static sizeFromDimension(r,t){if(t<0||t>r.length)throw new Error(`invalid dimension of ${t} for sizeFromDimension as Tensor has ${r.length} dimensions.`);return Oi.getSizeFromDimensionRange(r,t,r.length)}static sizeToDimension(r,t){if(t<0||t>r.length)throw new Error(`invalid dimension of ${t} for sizeToDimension as Tensor has ${r.length} dimensions.`);return Oi.getSizeFromDimensionRange(r,0,t)}static getSizeFromDimensionRange(r,t,s){let o=1;for(let a=t;a<s;a++){if(r[a]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");o*=Number(r[a])}return o}static computeStrides(r){let t=r.length;if(t===0)return[];if(t===1)return[1];let s=new Array(t);s[t-1]=1,s[t-2]=r[t-1];for(let o=t-3;o>=0;--o)s[o]=s[o+1]*r[o+1];return s}static normalizeAxis(r,t){if(r<-t&&r>=t)throw new Error("unsupported axis for this operation.");return r<0?r+t:r}static normalizeAxes(r,t){return r.map(s=>this.normalizeAxis(s,t!=null?t:r.length))}static sortBasedOnPerm(r,t){return t?t.map(s=>r[s]):r.slice().reverse()}static padShape(r,t){let s=r.length;return r.map((o,a)=>o+t[a]+t[a+s])}static areEqual(r,t){return r.length!==t.length?!1:r.every((s,o)=>s===t[o])}},Ri=class un{static adjustPoolAttributes(r,t,s,o,a,n){if(!r&&s.length!==t.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(r)for(let i=0;i<t.length-2;i++)i>=s.length?s.push(t[i+2]):s[i]=t[i+2];for(let i=0;i<s.length;i++)if(i<o.length){if(o[i]<0)throw new Error("strides should be greater than or equal to 1")}else o.push(1);for(let i=0;i<s.length;i++)if(i<a.length){if(a[i]<0)throw new Error("dilations should be greater than or equal to 1")}else a.push(1);for(let i=0;i<s.length*2;i++)if(i<n.length){if(n[i]<0)throw new Error("pad should be greater than or equal to 1")}else n.push(0);for(let i=0;i<s.length;i++){if(s[i]<=0)throw new Error("kernel shapes need to be greater than 0");if(n[i]>=s[i]||n[i+s.length]>=s[i])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(r,t,s,o,a,n,i){if(i){if(a.length!==2*(r.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(t.length!==r.length-2)throw new Error("length of strides should be the length of data dimensions");if(o.length!==r.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let l=0;l<r.length-2;l++)un.adjustPadAndReturnShape(r[l+(n?1:2)],t[l],s[l],o[l],a,l,l+r.length-2,i)}}static computePoolOutputShape(r,t,s,o,a,n,i){if(t.length<=0)throw new Error("input shape must be of size greater than 0");let l=[t[0],t[1]];return un.computeShapeHelper(r,t,l,s,o,a,n,i),l}static computeConvOutputShape(r,t,s,o,a,n,i){if(r.length<=0||t.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let l=[r[0],t[0]];return un.computeShapeHelper(!1,r,l,s,o,a,n,i),l}static computeShapeHelper(r,t,s,o,a,n,i,l){if(r)for(let c=0;c<t.length-2;c++)s.push(1);else for(let c=0;c<t.length-2;c++)s.push(un.adjustPadAndReturnShape(t[c+2],o[c],a[c],n[c],i,c,c+t.length-2,l))}static adjustPadAndReturnShape(r,t,s,o,a,n,i,l){let c=s*(o-1)+1;if(l&&l!=="NOTSET")switch(l){case"VALID":return a[n]=0,a[i]=0,Math.floor((r-c)/t+1);case"SAME_LOWER":case"SAME_UPPER":if(s!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let _=((r+t-1)/t-1)*t+o-r;return a[n]=Math.floor(l==="SAME_LOWER"?(_+1)/2:_/2),a[i]=_-a[n],Math.floor((r+_-o)/t+1)}default:throw new Error("Unsupported AutoPad type")}else return Math.floor((r+a[n]+a[i]-c)/t+1)}},Yb=class{static getShapeOfGemmResult(e,r,t,s,o){if(e.length!==2||t.length!==2)throw new Error("shape need to be of size 2");let a,n,i;r?(a=e[1],n=e[0]):(a=e[0],n=e[1]);let l=-1;if(s?(i=t[0],l=1):(i=t[1],l=0),t[l]!==n)throw new Error("dimension mismatch");if(a<=0||i<=0||n<=0)throw new Error("invalid shape specified");if(o&&!po.isValidBroadcast(o,[a,i]))throw new Error("gemm: invalid bias shape for broadcast");return[a,i,n]}},Zb=-34028234663852886e22,ev=34028234663852886e22}),tv=Ve(()=>{"use strict";bt(),Rd=(e,r)=>new(Dd(r))(e)}),PT=Ve(()=>{"use strict";Qs(),pd=(e,r=!0)=>{if(e.byteLength%8!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 8 (BigInt).");let t=e.byteLength/8,s=new BigInt64Array(e.buffer,e.byteOffset,t),o=new Int32Array(t);for(let a=0;a<t;a++){let n=s[a];if(n>BigInt(2147483647)||n<-BigInt(2147483648))throw new Error(`Overflow occurred when converting BigInt to Int32 at index ${a}: ${n}`);o[a]=Number(n)}return r?new Uint8Array(o.buffer):o},Pc=(e,r=!0)=>{if(e.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (Int32).");let t=e.byteLength/4,s=new Int32Array(e.buffer,e.byteOffset,t),o=BigInt64Array.from(s,BigInt);return r?new Uint8Array(o.buffer):o},dg=1,Ec=()=>dg++,ug=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),kc=(e,r)=>{let t=ug.get(e);if(!t)throw new Error("Unsupported data type.");return r.length>0?Math.ceil(r.reduce((s,o)=>s*o)*t/8):0},Cc=class{constructor(e){this.shouldConvertInt64toInt32=!1,this.isInt64ToInt32Converted=!1;let{sessionId:r,context:t,tensor:s,dataType:o,shape:a,shouldConvertInt64toInt32:n=!1}=e;this.sessionId=r,this.mlContext=t,this.mlTensor=s,this.dataType=o,this.tensorShape=a,this.shouldConvertInt64toInt32=n}get tensor(){return this.mlTensor}get type(){return this.dataType}get shape(){return this.tensorShape}get byteLength(){return kc(this.dataType,this.tensorShape)}destroy(){jt("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(e){this.mlContext.writeTensor(this.mlTensor,e)}async read(e,r){if(e){let t=await this.mlContext.readTensor(this.mlTensor),s=Pc(new Uint8Array(t));if(r){(r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)).set(s);return}else return s.buffer}else return r?this.mlContext.readTensor(this.mlTensor,r):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(e,r,t){return this.mlContext===e&&this.dataType===r&&this.tensorShape.length===t.length&&this.tensorShape.every((s,o)=>s===t[o])}setIsInt64ToInt32Converted(e){this.isInt64ToInt32Converted=e}},Sc=class{constructor(e,r){this.tensorManager=e,this.wrapper=r}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(e,r,t,s){let o=r,a=this.tensorManager.getMLContext(e),n=o==="int64"&&!a.opSupportLimits().input.dataTypes.includes("int64");if(n&&(o="int32",jt("verbose",()=>"[WebNN] TensorIdTracker.ensureTensor: convert dataType from int64 to int32")),this.wrapper){if(this.wrapper.canReuseTensor(a,o,t))return this.wrapper.tensor;if(s){if(this.wrapper.byteLength!==kc(o,t))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let i=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(e,o,t,i,!0,!0,n),s&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(e){let r=e;if(this.wrapper)if(this.wrapper.shouldConvertInt64toInt32&&(r=pd(e,!0),this.wrapper.setIsInt64ToInt32Converted(!0)),r.byteLength===this.wrapper.byteLength){this.wrapper.write(r);return}else jt("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor();this.activeUpload?this.activeUpload.set(r):this.activeUpload=new Uint8Array(r)}async download(e){var r,t,s;if(this.activeUpload){let o=(r=this.wrapper)!=null&&r.isInt64ToInt32Converted?Pc(this.activeUpload):this.activeUpload;if(e){e instanceof ArrayBuffer?new Uint8Array(e).set(o):new Uint8Array(e.buffer,e.byteOffset,e.byteLength).set(o);return}else return o.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return e?this.wrapper.read((t=this.wrapper)==null?void 0:t.shouldConvertInt64toInt32,e):this.wrapper.read((s=this.wrapper)==null?void 0:s.shouldConvertInt64toInt32)}},_g=class{constructor(e){this.backend=e,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(e){let r=this.backend.getMLContext(e);if(!r)throw new Error("MLContext not found for session.");return r}reserveTensorId(){let e=Ec();return this.tensorTrackersById.set(e,new Sc(this)),e}releaseTensorId(e){let r=this.tensorTrackersById.get(e);r&&(this.tensorTrackersById.delete(e),r.tensorWrapper&&this.releaseTensor(r.tensorWrapper))}async ensureTensor(e,r,t,s,o){jt("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${r}, dataType: ${t}, shape: ${s}, copyOld: ${o}}`);let a=this.tensorTrackersById.get(r);if(!a)throw new Error("Tensor not found.");return a.ensureTensor(e,t,s,o)}upload(e,r){let t=this.tensorTrackersById.get(e);if(!t)throw new Error("Tensor not found.");t.upload(r)}async download(e,r){jt("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${e}, dstBuffer: ${r==null?void 0:r.byteLength}}`);let t=this.tensorTrackersById.get(e);if(!t)throw new Error("Tensor not found.");return t.download(r)}releaseTensorsForSession(e){for(let r of this.freeTensors)r.sessionId===e&&r.destroy();this.freeTensors=this.freeTensors.filter(r=>r.sessionId!==e)}registerTensor(e,r,t,s){let o=this.getMLContext(e),a=Ec(),n=new Cc({sessionId:e,context:o,tensor:r,dataType:t,shape:s});return this.tensorTrackersById.set(a,new Sc(this,n)),this.externalTensors.add(n),a}async getCachedTensor(e,r,t,s,o,a,n=!1){let i=this.getMLContext(e);for(let[c,_]of this.freeTensors.entries())if(_.canReuseTensor(i,r,t)){jt("verbose",()=>`[WebNN] Reusing tensor {dataType: ${r}, shape: ${t}}`);let d=this.freeTensors.splice(c,1)[0];return d.sessionId=e,d}jt("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${r}, shape: ${t}}`);let l=await i.createTensor({dataType:r,shape:t,dimensions:t,usage:s,writable:o,readable:a});return new Cc({sessionId:e,context:i,tensor:l,dataType:r,shape:t,shouldConvertInt64toInt32:n})}releaseTensor(e){this.externalTensors.has(e)&&this.externalTensors.delete(e),this.freeTensors.push(e)}},rv=(...e)=>new _g(...e)}),ET=Ve(()=>{"use strict";bt(),Va(),tv(),PT(),Qs(),Ti=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),pg=(e,r)=>{if(e===r)return!0;if(e===void 0||r===void 0)return!1;let t=Object.keys(e).sort(),s=Object.keys(r).sort();return t.length===s.length&&t.every((o,a)=>o===s[a]&&e[o]===r[o])},sv=class{constructor(e){this.tensorManager=rv(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.temporaryGraphInputs=[],this.temporarySessionTensorIds=new Map,Bd(e.logLevel,!!e.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(e){jt("verbose",()=>`[WebNN] onRunStart {sessionId: ${e}}`),this.activeSessionId=e}onRunEnd(e){jt("verbose",()=>`[WebNN] onRunEnd {sessionId: ${e}}`);let r=this.temporarySessionTensorIds.get(e);if(r){for(let t of r)jt("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${t}}`),this.tensorManager.releaseTensorId(t);this.temporarySessionTensorIds.delete(e),this.activeSessionId=void 0}}async createMLContext(e){if(e instanceof GPUDevice){let t=this.mlContextCache.findIndex(s=>s.gpuDevice===e);if(t!==-1)return this.mlContextCache[t].mlContext;{let s=await navigator.ml.createContext(e);return this.mlContextCache.push({gpuDevice:e,mlContext:s}),s}}else if(e===void 0){let t=this.mlContextCache.findIndex(s=>s.options===void 0&&s.gpuDevice===void 0);if(t!==-1)return this.mlContextCache[t].mlContext;{let s=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:s}),s}}let r=this.mlContextCache.findIndex(t=>pg(t.options,e));if(r!==-1)return this.mlContextCache[r].mlContext;{let t=await navigator.ml.createContext(e);return this.mlContextCache.push({options:e,mlContext:t}),t}}registerMLContext(e,r){this.mlContextBySessionId.set(e,r);let t=this.sessionIdsByMLContext.get(r);t||(t=new Set,this.sessionIdsByMLContext.set(r,t)),t.add(e),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(e,this.temporaryGraphInputs),this.temporaryGraphInputs=[])}onReleaseSession(e){this.sessionGraphInputs.delete(e);let r=this.mlContextBySessionId.get(e);if(!r)return;this.tensorManager.releaseTensorsForSession(e),this.mlContextBySessionId.delete(e);let t=this.sessionIdsByMLContext.get(r);if(t.delete(e),t.size===0){this.sessionIdsByMLContext.delete(r);let s=this.mlContextCache.findIndex(o=>o.mlContext===r);s!==-1&&this.mlContextCache.splice(s,1)}}getMLContext(e){return this.mlContextBySessionId.get(e)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(e){jt("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${e}}`),this.tensorManager.releaseTensorId(e)}async ensureTensor(e,r,t,s,o){let a=Ti.get(t);if(!a)throw new Error(`Unsupported ONNX data type: ${t}`);return this.tensorManager.ensureTensor(e!=null?e:this.currentSessionId,r,a,s,o)}async createTemporaryTensor(e,r,t){jt("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${r}, shape: ${t}}`);let s=Ti.get(r);if(!s)throw new Error(`Unsupported ONNX data type: ${r}`);let o=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(e,o,s,t,!1);let a=this.temporarySessionTensorIds.get(e);return a?a.push(o):this.temporarySessionTensorIds.set(e,[o]),o}uploadTensor(e,r){if(!sr().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");jt("verbose",()=>`[WebNN] uploadTensor {tensorId: ${e}, data: ${r.byteLength}}`),this.tensorManager.upload(e,r)}async downloadTensor(e,r){return this.tensorManager.download(e,r)}createMLTensorDownloader(e,r){return async()=>{let t=await this.tensorManager.download(e);return Rd(t,r)}}registerMLTensor(e,r,t,s){let o=Ti.get(t);if(!o)throw new Error(`Unsupported ONNX data type: ${t}`);let a=this.tensorManager.registerTensor(e,r,o,s);return jt("verbose",()=>`[WebNN] registerMLTensor {tensor: ${r}, dataType: ${o}, dimensions: ${s}} -> {tensorId: ${a}}`),a}registerMLConstant(e,r,t,s,o,a,n=!1){if(!a)throw new Error("External mounted files are not available.");let i=e;e.startsWith("./")&&(i=e.substring(2));let l=a.get(i);if(!l)throw new Error(`File with name ${i} not found in preloaded files.`);if(r+t>l.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let c=l.slice(r,r+t).buffer,_;switch(o.dataType){case"float32":_=new Float32Array(c);break;case"float16":_=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(c):new Uint16Array(c);break;case"int32":_=new Int32Array(c);break;case"uint32":_=new Uint32Array(c);break;case"int64":n?(_=pd(new Uint8Array(c),!1),o.dataType="int32"):_=new BigInt64Array(c);break;case"uint64":_=new BigUint64Array(c);break;case"int8":_=new Int8Array(c);break;case"int4":case"uint4":case"uint8":_=new Uint8Array(c);break;default:throw new Error(`Unsupported data type: ${o.dataType} in creating WebNN Constant from external data.`)}return jt("verbose",()=>`[WebNN] registerMLConstant {dataType: ${o.dataType}, shape: ${o.shape}}} ${n?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),s.constant(o,_)}registerGraphInput(e){this.temporaryGraphInputs.push(e)}isGraphInput(e,r){let t=this.sessionGraphInputs.get(e);return t?t.includes(r):!1}isInt64Supported(e){var r;return!!((r=this.mlContextBySessionId.get(e))!=null&&r.opSupportLimits().input.dataTypes.includes("int64"))}flush(){}}}),Nd=Ve(()=>{"use strict"}),kT=Ve(()=>{"use strict";Qs(),Nd(),Ic=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),Pi=[],Ei=e=>Math.ceil(Number(e)/16)*16,mg=e=>{for(let r=0;r<Pi.length;r++){let t=Pi[r];if(e<=t)return t}return Math.ceil(e/16)*16},hg=1,Fc=()=>hg++,md=async(e,r,t,s)=>{let o=Ei(t),a=e.device.createBuffer({size:o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let n=e.getCommandEncoder();e.endComputePass(),n.copyBufferToBuffer(r,0,a,0,o),e.flush(),await a.mapAsync(GPUMapMode.READ);let i=a.getMappedRange();if(s){let l=s();return l.set(new Uint8Array(i,0,t)),l}else return new Uint8Array(i.slice(0,t))}finally{a.destroy()}},fg=class{constructor(e){this.backend=e,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map;for(let[r]of Ic)Pi.push(r),this.freeBuffers.set(r,[]),this.freeUniformBuffers.set(r,[]);this.sessionCount=0}upload(e,r){let t=r.buffer,s=r.byteOffset,o=r.byteLength,a=Ei(o),n=this.storageCache.get(e);if(!n)throw new Error("gpu data for uploading does not exist");if(Number(n.originalSize)!==o)throw new Error(`inconsistent data size. gpu data size=${n.originalSize}, data size=${o}`);let i=this.backend.device.createBuffer({mappedAtCreation:!0,size:a,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),l=i.getMappedRange();new Uint8Array(l).set(new Uint8Array(t,s,o)),i.unmap();let c=this.backend.device.createCommandEncoder();c.copyBufferToBuffer(i,0,n.gpuData.buffer,0,a),this.backend.device.queue.submit([c.finish()]),i.destroy(),jt("verbose",()=>`[WebGPU] GpuDataManager.upload(id=${e})`)}memcpy(e,r){let t=this.storageCache.get(e);if(!t)throw new Error("source gpu data for memcpy does not exist");let s=this.storageCache.get(r);if(!s)throw new Error("destination gpu data for memcpy does not exist");if(t.originalSize!==s.originalSize)throw new Error("inconsistent source and destination gpu data size");let o=Ei(t.originalSize),a=this.backend.getCommandEncoder();this.backend.endComputePass(),a.copyBufferToBuffer(t.gpuData.buffer,0,s.gpuData.buffer,0,o)}registerExternalBuffer(e,r,t){let s;if(t){if(s=t[0],e===t[1])return jt("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${r}) => id=${s}, buffer is the same, skip.`),s;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error(`Registering a different external buffer under graph capture mode is not supported yet.\n             Please use the previous external buffer!`)}else s=Fc();return this.storageCache.set(s,{gpuData:{id:s,type:0,buffer:e},originalSize:r}),jt("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${r}) => id=${s}, registered.`),s}unregisterExternalBuffer(e){e!==void 0&&(this.storageCache.delete(e),jt("verbose",()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${e}`))}create(e,r=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let t=mg(e),s,o=(r&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,a=(r&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(o||a){let i=(o?this.freeBuffers:this.freeUniformBuffers).get(t);i?i.length>0?s=i.pop():s=this.backend.device.createBuffer({size:t,usage:r}):s=this.backend.device.createBuffer({size:t,usage:r})}else s=this.backend.device.createBuffer({size:t,usage:r});let n={id:Fc(),type:0,buffer:s};return this.storageCache.set(n.id,{gpuData:n,originalSize:Number(e)}),jt("verbose",()=>`[WebGPU] GpuDataManager.create(size=${e}) => id=${n.id}`),n}get(e){var r;return(r=this.storageCache.get(e))==null?void 0:r.gpuData}release(e){let r=typeof e=="bigint"?Number(e):e,t=this.storageCache.get(r);if(!t){if(this.storageCache.size===0)return 0;throw new Error("releasing data does not exist")}return jt("verbose",()=>`[WebGPU] GpuDataManager.release(id=${r}), gpuDataId=${t.gpuData.id}`),this.storageCache.delete(r),this.buffersPending.push(t.gpuData.buffer),t.originalSize}async download(e,r){let t=this.storageCache.get(Number(e));if(!t)throw new Error("data does not exist");await md(this.backend,t.gpuData.buffer,t.originalSize,r)}refreshPendingBuffers(){if(this.buffersPending.length!==0)if(this.backend.sessionStatus==="default"){for(let e of this.buffersPending){let r=Ic.get(e.size);if((e.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let t=this.freeBuffers.get(e.size)||[];r===void 0||t.length>=r?e.destroy():t.push(e)}else if((e.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let t=this.freeUniformBuffers.get(e.size)||[];r===void 0||t.length>=r?e.destroy():t.push(e)}else e.destroy()}this.buffersPending=[]}else{let e=this.capturedPendingBuffers.get(this.backend.currentSessionId);e||(e=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,e));for(let r of this.buffersPending)e.push(r);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(e=>{e.forEach(r=>{r.destroy()})}),this.freeUniformBuffers.forEach(e=>{e.forEach(r=>{r.destroy()})}),this.storageCache.forEach(e=>{e.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(e=>{e.forEach(r=>{r.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(e){let r=this.capturedPendingBuffers.get(e);r&&(r.forEach(t=>{t.destroy()}),this.capturedPendingBuffers.delete(e)),this.sessionCount-=1,this.sessionCount===0&&(jt("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(t=>{t.gpuData.buffer.destroy()}),this.storageCache=new Map)}},av=(...e)=>new fg(...e)}),mr=Ve(()=>{"use strict";gg=class{constructor(e){Object.assign(this,e)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(e=>`${this[e]}`).join(";")),this.key}},qt=e=>new gg(e)}),$t=Ve(()=>{"use strict";bt(),St(),mo=64,ki=(e,r)=>{if(r===3)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(e)){case 10:return r>1?`vec${r}<f16>`:"f16";case 1:return r>1?`vec${r}<f32>`:"f32";case 6:return r>1?`vec${r}<i32>`:"i32";case 12:return r>1?`vec${r}<u32>`:"u32";case 7:if(r>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(r>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(r!==4)throw new Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw new Error(`Unknown data type: ${e}`)}},Ar=(e,r=1)=>{let t=ki(e,r);return typeof t=="string"?t:t[0]},Xr=(e,r=1)=>{let t=ki(e,r);return typeof t=="string"?t:t[1]},pt=(...e)=>{let r=[];return e.forEach(t=>{t.length!==0&&r.push({type:12,data:t},{type:12,data:we.computeStrides(t)})}),r},pr=e=>e%4===0?4:e%2===0?2:1,hd=(e="f32",r,t="0")=>!r||r===1?`${e}(${t})`:`vec${r}<${e}>(${t})`,_o=(e,r,t)=>e==="f32"?t:r===1?`f32(${t})`:`vec${r}<f32>(${t})`,la=(e,r)=>r===4?`(${e}.x + ${e}.y + ${e}.z + ${e}.w)`:r===2?`(${e}.x + ${e}.y)`:r===3?`(${e}.x + ${e}.y + ${e}.z)`:e,ct=(e,r,t,s)=>e.startsWith("uniforms.")&&t>4?typeof r=="string"?s==="f16"?`${e}[(${r}) / 8][(${r}) % 8 / 4][(${r}) % 8 % 4]`:`${e}[(${r}) / 4][(${r}) % 4]`:s==="f16"?`${e}[${Math.floor(r/8)}][${Math.floor(r%8/4)}][${r%8%4}]`:`${e}[${Math.floor(r/4)}][${r%4}]`:t>1?`${e}[${r}]`:e,rn=(e,r,t,s,o)=>{let a=typeof t=="number",n=a?t:t.length,i=[...new Array(n).keys()],l=n<2?"u32":n<=4?`vec${n}<u32>`:`array<u32, ${n}>`,c=ki(r,o),_=typeof c=="string"?c:c[1],d=typeof c=="string"?c:c[0],u={indices:l,value:_,storage:d,tensor:r},f=B=>typeof B=="string"?B:`${B}u`,h={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},v=a?"uniforms.":"",E=`${v}${e}_shape`,M=`${v}${e}_strides`,w="";for(let B=0;B<n-1;B++)w+=`\n    let dim${B} = current / ${ct(M,B,n)};\n    let rest${B} = current % ${ct(M,B,n)};\n    indices[${B}] = dim${B};\n    current = rest${B};\n    `;w+=`indices[${n-1}] = current;`;let C=n<2?"":`\n  fn o2i_${e}(offset: u32) -> ${u.indices} {\n    var indices: ${u.indices};\n    var current = offset;\n    ${w}\n    return indices;\n  }`,x=B=>(h.offsetToIndices=!0,n<2?B:`o2i_${e}(${B})`),T=[];if(n>=2)for(let B=n-1;B>=0;B--)T.push(`${ct(M,B,n)} * (indices[${B}])`);let S=n<2?"":`\n  fn i2o_${e}(indices: ${u.indices}) -> u32 {\n    return ${T.join("+")};\n  }`,g=B=>(h.indicesToOffset=!0,n<2?B:`i2o_${e}(${B})`),P=(...B)=>n===0?"0u":`${u.indices}(${B.map(f).join(",")})`,$=(B,D)=>n<2?`${B}`:`${ct(B,D,n)}`,A=(B,D,K)=>n<2?`${B}=${K};`:`${ct(B,D,n)}=${K};`,N={},W=(B,D)=>{h.broadcastedIndicesToOffset=!0;let K=`${D.name}broadcastedIndicesTo${e}Offset`;if(K in N)return`${K}(${B})`;let re=[];for(let me=n-1;me>=0;me--){let oe=D.indicesGet("outputIndices",me+D.rank-n);re.push(`${$(M,me)} * (${oe} % ${$(E,me)})`)}return N[K]=`fn ${K}(outputIndices: ${D.type.indices}) -> u32 {\n             return ${re.length>0?re.join("+"):"0u"};\n           }`,`${K}(${B})`},R=(B,D)=>(()=>{if(u.storage===u.value)return`${e}[${B}]=${D};`;if(u.storage==="vec2<u32>"&&u.value==="i32")return`${e}[${B}]=vec2<u32>(u32(${D}), select(0u, 0xFFFFFFFFu, ${D} < 0));`;if(u.storage==="vec2<u32>"&&u.value==="u32")return`${e}[${B}]=vec2<u32>(u32(${D}), 0u);`;if(u.storage==="u32"&&u.value==="vec4<bool>")return`${e}[${B}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${D}));`;throw new Error(`not supported combination of storage type ${u.storage} and value type ${u.value} yet`)})(),J=B=>(()=>{if(u.storage===u.value)return`${e}[${B}]`;if(u.storage==="vec2<u32>"&&u.value==="i32")return`i32(${e}[${B}].x)`;if(u.storage==="vec2<u32>"&&u.value==="u32")return`u32(${e}[${B}].x)`;if(u.storage==="u32"&&u.value==="vec4<bool>")return`vec4<bool>(bool(${e}[${B}] & 0xFFu), bool(${e}[${B}] & 0xFF00u), bool(${e}[${B}] & 0xFF0000u), bool(${e}[${B}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${u.storage} and value type ${u.value} yet`)})(),H=n<2?"":`\n  fn get_${e}ByIndices(indices: ${u.indices}) -> ${_} {\n    return ${J(`i2o_${e}(indices)`)};\n  }`,q=n<2?"":(()=>{let B=i.map(K=>`d${K}: u32`).join(", "),D=i.map(K=>`d${K}`).join(", ");return`\n  fn get_${e}(${B}) -> ${_} {\n    return get_${e}ByIndices(${P(D)});\n  }`})(),X=(...B)=>{if(B.length!==n)throw new Error(`indices length must be ${n}`);let D=B.map(f).join(",");return n===0?J("0u"):n===1?J(D[0]):(h.get=!0,h.getByIndices=!0,h.indicesToOffset=!0,`get_${e}(${D})`)},ae=B=>n<2?J(B):(h.getByIndices=!0,h.indicesToOffset=!0,`get_${e}ByIndices(${B})`),ce=n<2?"":`\n  fn set_${e}ByIndices(indices: ${u.indices}, value: ${_}) {\n    ${R(`i2o_${e}(indices)`,"value")}\n  }`,he=n<2?"":(()=>{let B=i.map(K=>`d${K}: u32`).join(", "),D=i.map(K=>`d${K}`).join(", ");return`\n  fn set_${e}(${B}, value: ${_}) {\n    set_${e}ByIndices(${P(D)}, value);\n  }`})();return{impl:()=>{let B=[],D=!1;return h.offsetToIndices&&(B.push(C),D=!0),h.indicesToOffset&&(B.push(S),D=!0),h.broadcastedIndicesToOffset&&(Object.values(N).forEach(K=>B.push(K)),D=!0),h.set&&(B.push(he),D=!0),h.setByIndices&&(B.push(ce),D=!0),h.get&&(B.push(q),D=!0),h.getByIndices&&(B.push(H),D=!0),!a&&D&&B.unshift(`const ${E} = ${u.indices}(${t.join(",")});`,`const ${M} = ${u.indices}(${we.computeStrides(t).join(",")});`),B.join(`\n`)},type:u,offsetToIndices:x,indicesToOffset:g,broadcastedIndicesToOffset:W,indices:P,indicesGet:$,indicesSet:A,set:(...B)=>{if(B.length!==n+1)throw new Error(`indices length must be ${n}`);let D=B[n];if(typeof D!="string")throw new Error("value must be string");let K=B.slice(0,n).map(f).join(",");return n===0?R("0u",D):n===1?R(K[0],D):(h.set=!0,h.setByIndices=!0,h.indicesToOffset=!0,`set_${e}(${K}, ${D})`)},setByOffset:R,setByIndices:(B,D)=>n<2?R(B,D):(h.setByIndices=!0,h.indicesToOffset=!0,`set_${e}ByIndices(${B}, ${D});`),get:X,getByOffset:J,getByIndices:ae,usage:s,name:e,strides:M,shape:E,rank:n}},Ee=(e,r,t,s=1)=>rn(e,r,t,"input",s),nt=(e,r,t,s=1)=>rn(e,r,t,"output",s),ov=(e,r,t)=>rn(e,r,t,"atomicOutput",1),jd=(e,r,t,s=1)=>rn(e,r,t,"internal",s),Mg=class{constructor(e,r){this.normalizedDispatchGroup=e,this.limits=r,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(e){return`if (global_idx >= ${typeof e=="number"?`${e}u`:e}) { return; }`}mainStart(e=mo){let r=typeof e=="number"?e:e[0],t=typeof e=="number"?1:e[1],s=typeof e=="number"?1:e[2];if(r>this.limits.maxComputeWorkgroupSizeX||t>this.limits.maxComputeWorkgroupSizeY||s>this.limits.maxComputeWorkgroupSizeZ)throw new Error(`workgroup size [${r}, ${t}, ${s}] exceeds the maximum workgroup size [${this.limits.maxComputeWorkgroupSizeX}, ${this.limits.maxComputeWorkgroupSizeY}, ${this.limits.maxComputeWorkgroupSizeZ}].`);if(r*t*s>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error(`workgroup size [${r}, ${t}, ${s}] exceeds the maximum workgroup invocations ${this.limits.maxComputeInvocationsPerWorkgroup}.`);let o=this.normalizedDispatchGroup[1]===1&&this.normalizedDispatchGroup[2]===1,a=o?`@builtin(global_invocation_id) global_id : vec3<u32>,\n    @builtin(workgroup_id) workgroup_id : vec3<u32>,\n    @builtin(local_invocation_index) local_idx : u32,\n    @builtin(local_invocation_id) local_id : vec3<u32>`:`@builtin(global_invocation_id) global_id : vec3<u32>,\n                                             @builtin(local_invocation_id) local_id : vec3<u32>,\n    @builtin(local_invocation_index) local_idx : u32,\n    @builtin(workgroup_id) workgroup_id : vec3<u32>,\n    @builtin(num_workgroups) num_workgroups : vec3<u32>`,n=o?`let global_idx = global_id.x;\n         let workgroup_index = workgroup_id.x;`:`let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +\n             workgroup_id.y * num_workgroups[0] + workgroup_id.x;\n         let global_idx = workgroup_index * ${r*t*s}u + local_idx;`;return`@compute @workgroup_size(${r}, ${t}, ${s})\n  fn main(${a}) {\n    ${n}\n  `}appendVariableUniforms(e){e.rank!==0&&(e.shape.startsWith("uniforms.")&&this.uniforms.push({name:e.shape.replace("uniforms.",""),type:"u32",length:e.rank}),e.strides.startsWith("uniforms.")&&this.uniforms.push({name:e.strides.replace("uniforms.",""),type:"u32",length:e.rank}))}declareVariable(e,r){if(e.usage==="internal")throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(e),this.appendVariableUniforms(e);let t=e.usage==="input"?"read":"read_write",s=e.usage==="atomicOutput"?"atomic<i32>":e.type.storage;return`@group(0) @binding(${r}) var<storage, ${t}> ${e.name}: array<${s}>;`}declareVariables(...e){return e.map(r=>this.declareVariable(r,this.variableIndex++)).join(`\n`)}registerInternalVariable(e){if(e.usage!=="internal")throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(e),this.appendVariableUniforms(e)}registerInternalVariables(...e){return e.forEach(r=>this.registerInternalVariable(r)),this}registerUniform(e,r,t=1){return this.uniforms.push({name:e,type:r,length:t}),this}registerUniforms(e){return this.uniforms=this.uniforms.concat(e),this}uniformDeclaration(){if(this.uniforms.length===0)return"";let e=[];for(let{name:r,type:t,length:s}of this.uniforms)if(s&&s>4)t==="f16"?e.push(`@align(16) ${r}:array<mat2x4<${t}>, ${Math.ceil(s/8)}>`):e.push(`${r}:array<vec4<${t}>, ${Math.ceil(s/4)}>`);else{let o=s==null||s===1?t:`vec${s}<${t}>`;e.push(`${r}:${o}`)}return`\n      struct Uniforms { ${e.join(", ")} };\n      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(e=>e.impl()).join(`\n`)+this.internalVariables.map(e=>e.impl()).join(`\n`)}get variablesInfo(){if(this.uniforms.length===0)return;let e=r=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(r)];return this.uniforms.map(r=>{var t;return[e(r.type),(t=r.length)!=null?t:1]})}},nv=(e,r)=>new Mg(e,r)}),ca=Ve(()=>{"use strict";bt(),St(),mr(),$t(),wg=(e,r)=>{if(!e||e.length!==1)throw new Error("Transpose requires 1 input.");if(r.length!==0&&r.length!==e[0].dims.length)throw new Error(`perm size ${r.length} does not match input rank ${e[0].dims.length}`)},$c=(e,r)=>r.length!==0?r:[...new Array(e).keys()].reverse(),bg=(e,r)=>we.sortBasedOnPerm(e,$c(e.length,r)),vg=(e,r,t,s)=>{let o=`fn perm(i: ${s.type.indices}) -> ${t.type.indices} {\n    var a: ${t.type.indices};`;for(let a=0;a<r;++a)o+=`a[${e[a]}]=i[${a}];`;return o+="return a;}"},xg=(e,r)=>{let t=[],s=[];for(let o=0;o<e.length;++o)e[o]!==1&&t.push(e[o]),e[r[o]]!==1&&s.push(r[o]);return{newShape:t,newPerm:s}},yg=(e,r)=>{let t=0;for(let s=0;s<e.length;++s)if(r[e[s]]!==1){if(e[s]<t)return!1;t=e[s]}return!0},_s=(e,r)=>{let t=e.dataType,s=e.dims.length,o=$c(s,r),a=bg(e.dims,o),n=e.dims,i=a,l=s<2||yg(o,e.dims),c;if(l)return c=h=>{let v=Ee("input",t,n,4),E=nt("output",t,i,4);return`\n  ${h.registerUniform("output_size","u32").declareVariables(v,E)}\n  ${h.mainStart()}\n    ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n    output[global_idx] = input[global_idx];\n  }`},{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let h=we.size(a);return{outputs:[{dims:a,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(h/64/4)},programUniforms:[{type:12,data:Math.ceil(h/4)}]}},getShaderSource:c};let{newShape:_,newPerm:d}=xg(e.dims,o),u=we.areEqual(d,[2,3,1]),f=we.areEqual(d,[3,1,2]);if(_.length===2||u||f){n=u?[_[0],_[1]*_[2]]:f?[_[0]*_[1],_[2]]:_,i=[n[1],n[0]];let h=16;return c=v=>{let E=Ee("a",t,n.length),M=nt("output",t,i.length);return`\n  ${v.registerUniform("output_size","u32").declareVariables(E,M)}\n  var<workgroup> tile : array<array<${M.type.value}, ${h+1}>, ${h}>;\n  ${v.mainStart([h,h,1])}\n    let stride = (uniforms.output_shape[1] - 1) / ${h} + 1;\n    let workgroup_id_x = workgroup_index % stride;\n    let workgroup_id_y = workgroup_index / stride;\n    let input_col = workgroup_id_y * ${h}u + local_id.x;\n    let input_row = workgroup_id_x * ${h}u + local_id.y;\n    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {\n      tile[local_id.y][local_id.x] = ${E.getByIndices(`${E.type.indices}(input_row, input_col)`)};\n    }\n    workgroupBarrier();\n\n    let output_col = workgroup_id_x * ${h}u + local_id.x;\n    let output_row = workgroup_id_y * ${h}u + local_id.y;\n    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {\n      ${M.setByIndices(`${M.type.indices}(output_row, output_col)`,"tile[local_id.x][local_id.y]")}\n    }\n  }`},{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let v=we.size(a);return{outputs:[{dims:a,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(i[1]/h),y:Math.ceil(i[0]/h)},programUniforms:[{type:12,data:v},...pt(n,i)]}},getShaderSource:c}}return c=h=>{let v=Ee("a",t,n.length),E=nt("output",t,i.length);return`\n  ${h.registerUniform("output_size","u32").declareVariables(v,E)}\n\n  ${vg(o,s,v,E)}\n\n  ${h.mainStart()}\n    ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n\n    let indices = ${E.offsetToIndices("global_idx")};\n    let aIndices = perm(indices);\n\n    ${E.setByOffset("global_idx",v.getByIndices("aIndices"))}\n  }`},{name:"Transpose",shaderCache:{hint:`${r}`,inputDependencies:["rank"]},getRunData:()=>{let h=we.size(a);return{outputs:[{dims:a,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:[{type:12,data:h},...pt(n,i)]}},getShaderSource:c}},iv=(e,r)=>{wg(e.inputs,r.perm),e.compute(_s(e.inputs[0],r.perm))},lv=e=>qt({perm:e.perm})}),CT=Ve(()=>{"use strict";bt(),St(),$t(),Vd(),ca(),Tg={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},Pg={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},Eg={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},kg={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},Cg=(e,r)=>{let t=[];for(let s=r-e;s<r;++s)t.push(s);return t},Sg=(e,r)=>{let t=[],s=e.length;for(let a=0;a<s;a++)r.indexOf(a)===-1&&t.push(e[a]);let o=r.map(a=>e[a]);return[t,o]},Ig=(e,r)=>{let t=e.length+r.length,s=[],o=0;for(let a=0;a<t;a++)r.indexOf(a)===-1?s.push(e[o++]):s.push(1);return s},Fg=(e,r)=>{for(let t=0;t<e.length;++t)if(e[e.length-t-1]!==r-1-t)return!1;return!0},$g=(e,r)=>{let t=[];if(!Fg(e,r)){for(let s=0;s<r;++s)e.indexOf(s)===-1&&t.push(s);e.forEach(s=>t.push(s))}return t},Ag=(e,r,t,s,o,a,n)=>{let i=t[0].dims,l=we.size(a),c=we.size(n),_=Ee("_A",t[0].dataType,i),d=nt("output",o,a),u=64;l===1&&(u=256);let f=`\n          var<workgroup> aBestValues : array<f32, ${u}>;\n       `,h=v=>`\n        ${v.registerUniform("reduceSize","u32").declareVariables(_,d)}\n        ${f}\n        fn DIV_CEIL(a : u32, b : u32) -> u32 {\n          return ((a - 1u) / b + 1u);\n         }\n         ${v.mainStart(u)}\n\n          let outputIndex = global_idx / ${u};\n          let offset = outputIndex * uniforms.reduceSize;\n\n          var bestValue = f32(${Eg[s]});\n          let Length = uniforms.reduceSize;\n          for (var k = local_idx; k < Length; k = k + ${u}) {\n           let candidate = f32(${_.getByOffset("offset + k")});\n           bestValue = ${Tg[s]};\n          }\n          aBestValues[local_idx] = bestValue;\n          workgroupBarrier();\n\n         var reduceSize = min(Length, ${u}u);\n         for (var currentSize = reduceSize / 2u; reduceSize > 1u;\n             currentSize = reduceSize / 2u) {\n           let interval = DIV_CEIL(reduceSize, 2u);\n           if (local_idx < currentSize) {\n            let candidate = aBestValues[local_idx + interval];\n            bestValue = ${Pg[s]};\n            aBestValues[local_idx] = bestValue;\n           }\n           reduceSize = interval;\n           workgroupBarrier();\n         }\n\n         if (local_idx == 0u) {\n          ${d.setByOffset("outputIndex",`${s==="mean"?`${d.type.storage}(bestValue / f32(uniforms.reduceSize))`:`${d.type.storage}(${kg[s]})`}`)};\n         }\n        }`;return{name:e,shaderCache:{hint:`${r};${u}`,inputDependencies:["type"]},getShaderSource:h,getRunData:()=>({outputs:[{dims:a,dataType:o}],dispatchGroup:{x:l},programUniforms:[{type:12,data:c}]})}},Ts=(e,r,t,s)=>{let o=e.inputs.length===1?t:fd(e.inputs,t),a=o.axes;a.length===0&&!o.noopWithEmptyAxes&&(a=e.inputs[0].dims.map((f,h)=>h));let n=we.normalizeAxes(a,e.inputs[0].dims.length),i=n,l=e.inputs[0],c=$g(i,e.inputs[0].dims.length);c.length>0&&(l=e.compute(_s(e.inputs[0],c),{inputs:[0],outputs:[-1]})[0],i=Cg(i.length,l.dims.length));let[_,d]=Sg(l.dims,i),u=_;o.keepDims&&(u=Ig(_,n)),e.compute(Ag(r,o.cacheKey,[l],s,e.inputs[0].dataType,u,d),{inputs:[l]})},cv=(e,r)=>{Ts(e,"ReduceMeanShared",r,"mean")},dv=(e,r)=>{Ts(e,"ReduceL1Shared",r,"l1")},uv=(e,r)=>{Ts(e,"ReduceL2Shared",r,"l2")},_v=(e,r)=>{Ts(e,"ReduceLogSumExpShared",r,"logSumExp")},pv=(e,r)=>{Ts(e,"ReduceMaxShared",r,"max")},mv=(e,r)=>{Ts(e,"ReduceMinShared",r,"min")},hv=(e,r)=>{Ts(e,"ReduceProdShared",r,"prod")},fv=(e,r)=>{Ts(e,"ReduceSumShared",r,"sum")},gv=(e,r)=>{Ts(e,"ReduceSumSquareShared",r,"sumSquare")},Mv=(e,r)=>{Ts(e,"ReduceLogSumShared",r,"logSum")}}),Vd=Ve(()=>{"use strict";bt(),St(),mr(),$t(),CT(),Ps=e=>{if(!e||e.length===0||e.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(e.length===2&&e[1].dims.length!==1)throw new Error("Invalid axes input dims.")},Dg=e=>["","",`var value = ${e.getByIndices("input_indices")};`,""],Ni=(e,r,t,s,o,a,n=!1,i=!1)=>{let l=[],c=t[0].dims,_=c.length,d=we.normalizeAxes(o,_),u=!i&&d.length===0;c.forEach((v,E)=>{u||d.indexOf(E)>=0?n&&l.push(1):l.push(v)});let f=l.length,h=we.size(l);return{name:e,shaderCache:r,getShaderSource:v=>{let E=[],M=Ee("_A",t[0].dataType,_),w=nt("output",a,f),C=s(M,w,d),x=C[2];for(let T=0,S=0;T<_;T++)u||d.indexOf(T)>=0?(n&&S++,x=`for(var j${T}: u32 = 0; j${T} < ${c[T]}; j${T}++) {\n                  ${C[2].includes("last_index")?`let last_index = j${T};`:""}\n                  ${M.indicesSet("input_indices",T,`j${T}`)}\n                  ${x}\n                }`):(E.push(`${M.indicesSet("input_indices",T,w.indicesGet("output_indices",S))};`),S++);return`\n\n        ${v.registerUniform("output_size","u32").declareVariables(M,w)}\n\n        ${v.mainStart()}\n          ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n          var input_indices: ${M.type.indices};\n          let output_indices = ${w.offsetToIndices("global_idx")};\n\n          ${E.join(`\n`)}\n          ${C[0]}       // init ops for reduce max/min\n          ${C[1]}\n          ${x}\n          ${C[3]}\n          ${C.length===4?w.setByOffset("global_idx","value"):C.slice(4).join(`\n`)}\n        }`},getRunData:()=>({outputs:[{dims:l,dataType:a}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:[{type:12,data:h},...pt(c,l)]})}},fd=(e,r)=>{let t=[];return e[1].dims[0]>0&&e[1].getBigInt64Array().forEach(s=>t.push(Number(s))),qt({axes:t,keepDims:r.keepDims,noopWithEmptyAxes:r.noopWithEmptyAxes})},Es=(e,r,t,s)=>{let o=e.inputs,a=o.length===1?t:fd(o,t);e.compute(Ni(r,{hint:a.cacheKey,inputDependencies:["rank"]},[o[0]],a.noopWithEmptyAxes&&a.axes.length===0?Dg:s,a.axes,o[0].dataType,a.keepDims,a.noopWithEmptyAxes),{inputs:[0]})},Og=(e,r)=>{Ps(e.inputs),Es(e,"ReduceLogSum",r,(t,s)=>[`var value = ${s.type.storage}(0);`,"",`value += ${t.getByIndices("input_indices")};`,"value = log(value);"])},Lg=(e,r)=>{Ps(e.inputs),Es(e,"ReduceL1",r,(t,s)=>[`var value = ${s.type.storage}(0);`,"",`value += abs(${t.getByIndices("input_indices")});`,""])},zg=(e,r)=>{Ps(e.inputs),Es(e,"ReduceL2",r,(t,s)=>[`var t = ${s.type.value}(0); var value = ${s.type.value}(0);`,"",`t = ${t.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"])},Bg=(e,r)=>{Ps(e.inputs),Es(e,"ReduceLogSumExp",r,(t,s)=>[`var value = ${s.type.storage}(0);`,"",`value += exp(${t.getByIndices("input_indices")});`,"value = log(value);"])},Rg=(e,r)=>{Ps(e.inputs),Es(e,"ReduceMax",r,(t,s,o)=>{let a=[];for(let n=0;n<t.rank;n++)(o.indexOf(n)>=0||o.length===0)&&a.push(t.indicesSet("input_indices",n,0));return[`${a.join(`\n`)}`,`var value = ${t.getByIndices("input_indices")};`,`value = max(value, ${t.getByIndices("input_indices")});`,""]})},Ng=(e,r)=>{Ps(e.inputs),Es(e,"ReduceMean",r,(t,s,o)=>{let a=1;for(let n=0;n<t.rank;n++)(o.indexOf(n)>=0||o.length===0)&&(a*=e.inputs[0].dims[n]);return["var sum = f32(0);","",`sum += f32(${t.getByIndices("input_indices")});`,`let value = ${s.type.value}(sum / ${a});`]})},jg=(e,r)=>{Ps(e.inputs),Es(e,"ReduceMin",r,(t,s,o)=>{let a=[];for(let n=0;n<t.rank;n++)(o.indexOf(n)>=0||o.length===0)&&a.push(`input_indices[${n}] = 0;`);return[`${a.join(`\n`)}`,`var value = ${t.getByIndices("input_indices")};`,`value = min(value, ${t.getByIndices("input_indices")});`,""]})},Vg=(e,r)=>{Ps(e.inputs),Es(e,"ReduceProd",r,(t,s)=>[`var value = ${s.type.storage}(1);`,"",`value *= ${t.getByIndices("input_indices")};`,""])},Wg=(e,r)=>{Ps(e.inputs),Es(e,"ReduceSum",r,(t,s)=>[`var value = ${s.type.storage}(0);`,"",`value += ${t.getByIndices("input_indices")};`,""])},Ug=(e,r)=>{Ps(e.inputs),Es(e,"ReduceSumSquare",r,(t,s)=>[`var t = ${s.type.value}(0); var value = ${s.type.value}(0);`,"",`t = ${t.getByIndices("input_indices")}; value += t * t;`,""])},ks=(e,r,t)=>{if(r.length===0)return t;let s=1,o=1;for(let a=0;a<r.length;a++)r.indexOf(a)===-1?s*=e[a]:o*=e[a];return o<32&&s>1024},wv=(e,r)=>{ks(e.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?Ng(e,r):cv(e,r)},bv=(e,r)=>{ks(e.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?Lg(e,r):dv(e,r)},vv=(e,r)=>{ks(e.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?zg(e,r):uv(e,r)},xv=(e,r)=>{ks(e.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?Bg(e,r):_v(e,r)},yv=(e,r)=>{ks(e.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?Rg(e,r):pv(e,r)},Tv=(e,r)=>{ks(e.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?jg(e,r):mv(e,r)},Pv=(e,r)=>{ks(e.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?Vg(e,r):hv(e,r)},Ev=(e,r)=>{ks(e.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?Wg(e,r):fv(e,r)},kv=(e,r)=>{ks(e.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?Ug(e,r):gv(e,r)},Cv=(e,r)=>{ks(e.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?Og(e,r):Mv(e,r)}}),ST=Ve(()=>{"use strict";bt(),mr(),Vd(),Ac=e=>{if(!e||e.length===0||e.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(e[0].dataType!==1)throw new Error("Invalid input type.")},Sv=(e,r)=>{Ac(e.inputs);let t=(s,o,a)=>{let n=[];for(let i=0;i<s.rank;i++)(a.indexOf(i)>=0||a.length===0)&&n.push(`input_indices[${i}] = 0;`);return[`${n.join(`\n`)}`,`var value = ${s.getByIndices("input_indices")};\nvar best_index : i32 = 0;`,`if (${s.getByIndices("input_indices")} ${r.selectLastIndex>0?"<=":"<"} value) {\n         value = ${s.getByIndices("input_indices")};\n         best_index = i32(last_index);\n       }`,"",o.setByOffset("global_idx","best_index")]};e.compute(Ni("ArgMin",{hint:r.cacheKey,inputDependencies:["rank"]},[e.inputs[0]],t,[r.axis],7,r.keepDims),{inputs:[0]})},Iv=(e,r)=>{Ac(e.inputs);let t=(s,o,a)=>{let n=[];for(let i=0;i<s.rank;i++)(a.indexOf(i)>=0||a.length===0)&&n.push(`input_indices[${i}] = 0;`);return[`${n.join(`\n`)}`,`var value = ${s.getByIndices("input_indices")};\nvar best_index : i32 = 0;`,`if (${s.getByIndices("input_indices")} ${r.selectLastIndex>0?">=":">"} value) {\n         value = ${s.getByIndices("input_indices")};\n         best_index = i32(last_index);\n       }`,"",o.setByOffset("global_idx","best_index")]};e.compute(Ni("argMax",{hint:r.cacheKey,inputDependencies:["rank"]},[e.inputs[0]],t,[r.axis],7,r.keepDims),{inputs:[0]})},gd=e=>qt(e)}),Wd=Ve(()=>{"use strict";bt(),St(),Nd(),$t(),Gg=(e,r)=>{let t=e[0],s=e[1],o=e[2],a=e[3],n=e[4],i=e[5];if(n&&i)throw new Error("Attention cannot have both past and attention_bias");if(t.dims.length!==3)throw new Error(\'Input "input" must have 3 dimensions\');let l=t.dims[0],c=t.dims[1],_=t.dims[2];if(o.dims.length!==1)throw new Error(\'Input "bias" is expected to have 1 dimensions\');if(s.dims.length!==2)throw new Error(\'Input "weights" is expected to have 2 dimensions\');if(s.dims[0]!==_)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(o.dims[0]!==s.dims[1])throw new Error(\'Input "bias" dimension 0 should have same length as dimension 1 of input "weights"\');let d=o.dims[0]/3,u=d,f=u;if(r.qkvHiddenSizes.length>0){if(r.qkvHiddenSizes.length!==3)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let C of r.qkvHiddenSizes)if(C%r.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");d=r.qkvHiddenSizes[0],u=r.qkvHiddenSizes[1],f=r.qkvHiddenSizes[2]}let h=c;if(d!==u)throw new Error("qkv_hidden_sizes first element should be same as the second");if(o.dims[0]!==d+u+f)throw new Error(\'Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes\');let v=0;if(n){if(u!==f)throw new Error(\'Input "past" expect k_hidden_size == v_hidden_size\');if(n.dims.length!==5)throw new Error(\'Input "past" must have 5 dimensions\');if(n.dims[0]!==2)throw new Error(\'Input "past" first dimension must be 2\');if(n.dims[1]!==l)throw new Error(\'Input "past" second dimension must be batch_size\');if(n.dims[2]!==r.numHeads)throw new Error(\'Input "past" third dimension must be num_heads\');if(n.dims[4]!==u/r.numHeads)throw new Error(\'Input "past" fifth dimension must be k_hidden_size / num_heads\');r.pastPresentShareBuffer||(v=n.dims[3])}let E=h+v,M=-1,w=0;if(a)throw new Error("Mask not supported");if(n)throw new Error("past is not supported");if(i){if(i.dims.length!==4)throw new Error(\'Input "attention_bias" must have 4 dimensions\');if(i.dims[0]!==l||i.dims[1]!==r.numHeads||i.dims[2]!==c||i.dims[3]!==E)throw new Error(\'Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)\')}return{batchSize:l,sequenceLength:c,pastSequenceLength:v,kvSequenceLength:h,totalSequenceLength:E,maxSequenceLength:M,inputHiddenSize:_,hiddenSize:d,vHiddenSize:f,headSize:Math.floor(d/r.numHeads),vHeadSize:Math.floor(f/r.numHeads),numHeads:r.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:r.maskFilterValue,maskType:w,scale:r.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},Ci=(e,r,t)=>r&&e?`\n      let total_sequence_length_input = u32(${r.getByOffset("0")});\n      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);\n      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;\n      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;\n      total_sequence_length = u32(${e==null?void 0:e.getByOffset("batchIdx")}) + 1;\n      var past_sequence_length: u32 = 0;\n      if (is_first_prompt == false) {\n        past_sequence_length = total_sequence_length - sequence_length;\n      }\n       `:`\n    ${t?"let past_sequence_length = uniforms.past_sequence_length":""};\n    let present_sequence_length = total_sequence_length;\n    `,Kg=(e,r,t,s,o,a,n,i)=>{let l=pr(n?1:a),c=64,_=a/l;_<c&&(c=32);let d=Math.ceil(a/l/c),u=[{type:12,data:r},{type:12,data:t},{type:12,data:s},{type:12,data:o},{type:12,data:_},{type:12,data:d}],f=Ar(e.dataType,l),h=Xr(1,l),v=["type"];n&&v.push("type"),i&&v.push("type");let E=M=>{let w=nt("x",e.dataType,e.dims,l),C=[w],x=n?Ee("seq_lens",n.dataType,n.dims):void 0;x&&C.push(x);let T=i?Ee("total_sequence_length_input",i.dataType,i.dims):void 0;T&&C.push(T);let S=Xr(e.dataType),g=[{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}];return`\n  var<workgroup> thread_max: array<f32, ${c}>;\n  var<workgroup> thread_sum: array<f32, ${c}>;\n  ${M.registerUniforms(g).declareVariables(...C)}\n  ${M.mainStart([c,1,1])}\n    let batchIdx = workgroup_id.z / uniforms.num_heads;\n    let headIdx = workgroup_id.z % uniforms.num_heads;\n    let sequence_length = uniforms.sequence_length;\n    var total_sequence_length = uniforms.total_sequence_length;\n    ${Ci(x,T,!1)}\n    let local_offset = local_idx * uniforms.elements_per_thread;\n    let offset = (global_idx / ${c}) * uniforms.total_sequence_length + local_offset;\n    let seq_causal_length = ${n?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length"};\n    var thread_max_vector = ${h}(-3.402823e+38f);\n    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {\n      thread_max_vector = max(${h}(x[offset + i]), thread_max_vector);\n    }\n    thread_max[local_idx] = ${(()=>{switch(l){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error(`Unsupported components: ${l}`)}})()};\n    workgroupBarrier();\n\n    var max_value =  f32(-3.402823e+38f);\n    for (var i = 0u; i < ${c}; i++) {\n      max_value = max(thread_max[i], max_value);\n    }\n\n    var sum_vector = ${h}(0);\n    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {\n      sum_vector += exp(${h}(x[offset + i]) - max_value);\n    }\n    thread_sum[local_idx] = ${(()=>{switch(l){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error(`Unsupported components: ${l}`)}})()};\n    workgroupBarrier();\n\n    var sum: f32 = 0;\n    for (var i = 0u; i < ${c}; i++) {\n      sum += thread_sum[i];\n    }\n\n    if (sum == 0) {\n      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {\n        x[offset + i] = ${w.type.value}(${S}(1.0) / ${S}(seq_causal_length));\n      }\n    } else {\n      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {\n        var f32input = ${h}(x[offset + i]);\n        x[offset + i] = ${w.type.value}(exp(f32input - max_value) / sum);\n      }\n    }\n      ${n?`\n        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {\n          x[offset + total_seq_id] = ${w.type.value}(${S}(0));\n        }`:""};\n  }`};return{name:"AttentionProbsSoftmax",shaderCache:{hint:`${c};${f};${l}`,inputDependencies:v},getShaderSource:E,getRunData:()=>({outputs:[],dispatchGroup:{x:1,y:o,z:r*t},programUniforms:u})}},Hg=(e,r,t,s,o,a,n,i,l)=>{let c=n+a.kvSequenceLength,_=[a.batchSize,a.numHeads,a.sequenceLength,c],d=e>1&&s,u=a.kvNumHeads?a.kvNumHeads:a.numHeads,f=d?[a.batchSize,u,c,a.headSize]:void 0,h=a.nReps?a.nReps:1,v=a.scale===0?1/Math.sqrt(a.headSize):a.scale,E=pr(a.headSize),M=a.headSize/E,w=12,C={x:Math.ceil(c/w),y:Math.ceil(a.sequenceLength/w),z:a.batchSize*a.numHeads},x=[{type:12,data:a.sequenceLength},{type:12,data:M},{type:12,data:c},{type:12,data:a.numHeads},{type:12,data:a.headSize},{type:1,data:v},{type:12,data:n},{type:12,data:a.kvSequenceLength},{type:12,data:h}],T=d&&s&&we.size(s.dims)>0,S=["type","type"];T&&S.push("type"),o&&S.push("type"),i&&S.push("type"),l&&S.push("type");let g=[{dims:_,dataType:r.dataType,gpuDataType:0}];d&&g.push({dims:f,dataType:r.dataType,gpuDataType:0});let P=$=>{let A=Ee("q",r.dataType,r.dims,E),N=Ee("key",t.dataType,t.dims,E),W=[A,N];if(T){let ce=Ee("past_key",s.dataType,s.dims,E);W.push(ce)}o&&W.push(Ee("attention_bias",o.dataType,o.dims));let R=i?Ee("seq_lens",i.dataType,i.dims):void 0;R&&W.push(R);let J=l?Ee("total_sequence_length_input",l.dataType,l.dims):void 0;J&&W.push(J);let H=nt("output",r.dataType,_),q=[H];d&&q.push(nt("present_key",r.dataType,f,E));let X=Xr(1,E),ae=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`\n  const TILE_SIZE = ${w}u;\n\n  var<workgroup> tileQ: array<${A.type.storage}, ${w*w}>;\n  var<workgroup> tileK: array<${A.type.storage}, ${w*w}>;\n  ${$.registerUniforms(ae).declareVariables(...W,...q)}\n  ${$.mainStart([w,w,1])}\n    // x holds the N and y holds the M\n    let headIdx = workgroup_id.z % uniforms.num_heads;\n    let kvHeadIdx = ${h===1?"headIdx":"headIdx / uniforms.n_reps"};\n    let kv_num_heads = ${h===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};\n    let batchIdx = workgroup_id.z / uniforms.num_heads;\n    let m = workgroup_id.y * TILE_SIZE;\n    let n = workgroup_id.x * TILE_SIZE;\n    let sequence_length = uniforms.M;\n    var total_sequence_length = uniforms.N;\n    ${Ci(R,J,!0)}\n    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;\n    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;\n    ${T&&d?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":""};\n    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;\n    ${d?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":""}\n    var value = ${X}(0);\n    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {\n      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {\n        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];\n      }\n      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {\n        var idx = TILE_SIZE * local_id.y + local_id.x;\n      ${T&&d?`\n              if (n + local_id.y < past_sequence_length) {\n                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];\n              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {\n                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];\n              }`:`\n          if (n + local_id.y < uniforms.kv_sequence_length) {\n            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];\n          }`}\n      ${d?`if (n + local_id.y < present_sequence_length) {\n        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];\n      }`:""}\n      }\n      workgroupBarrier();\n\n      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {\n          value += ${X}(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);\n      }\n\n      workgroupBarrier();\n    }\n\n    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {\n      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;\n      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;\n      var sum: f32 = ${(()=>{switch(E){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error(`Unsupported components: ${E}`)}})()};\n        output[outputIdx] = ${H.type.value} (sum * uniforms.alpha) + ${o?"attention_bias[outputIdx]":"0.0"};\n    }\n  }`};return{name:"AttentionProbs",shaderCache:{hint:`${E};${o!==void 0};${s!==void 0};${e}`,inputDependencies:S},getRunData:()=>({outputs:g,dispatchGroup:C,programUniforms:x}),getShaderSource:P}},qg=(e,r,t,s,o,a,n=void 0,i=void 0)=>{let l=a+o.kvSequenceLength,c=o.nReps?o.nReps:1,_=o.vHiddenSize*c,d=e>1&&s,u=o.kvNumHeads?o.kvNumHeads:o.numHeads,f=d?[o.batchSize,u,l,o.headSize]:void 0,h=[o.batchSize,o.sequenceLength,_],v=12,E={x:Math.ceil(o.vHeadSize/v),y:Math.ceil(o.sequenceLength/v),z:o.batchSize*o.numHeads},M=[{type:12,data:o.sequenceLength},{type:12,data:l},{type:12,data:o.vHeadSize},{type:12,data:o.numHeads},{type:12,data:o.headSize},{type:12,data:_},{type:12,data:a},{type:12,data:o.kvSequenceLength},{type:12,data:c}],w=d&&s&&we.size(s.dims)>0,C=["type","type"];w&&C.push("type"),n&&C.push("type"),i&&C.push("type");let x=[{dims:h,dataType:r.dataType,gpuDataType:0}];d&&x.push({dims:f,dataType:r.dataType,gpuDataType:0});let T=S=>{let g=Ee("probs",r.dataType,r.dims),P=Ee("v",t.dataType,t.dims),$=[g,P];w&&$.push(Ee("past_value",s.dataType,s.dims));let A=n?Ee("seq_lens",n.dataType,n.dims):void 0;n&&$.push(A);let N=i?Ee("total_sequence_length_input",i.dataType,i.dims):void 0;i&&$.push(N);let W=[nt("output",r.dataType,h)];d&&W.push(nt("present_value",r.dataType,f));let R=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`\n  const TILE_SIZE = ${v}u;\n  var<workgroup> tileQ: array<${g.type.value}, ${v*v}>;\n  var<workgroup> tileV: array<${g.type.value}, ${v*v}>;\n  ${S.registerUniforms(R).declareVariables(...$,...W)}\n  ${S.mainStart([v,v,1])}\n   let headIdx = workgroup_id.z % uniforms.num_heads;\n   let batchIdx = workgroup_id.z / uniforms.num_heads;\n   let kvHeadIdx = ${c===1?"headIdx":"headIdx / uniforms.n_reps"};\n   let kv_num_heads = ${c===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};\n   let m = global_id.y;\n   let n = global_id.x;\n   let sequence_length = uniforms.M;\n   var total_sequence_length = uniforms.K;\n   ${Ci(A,N,!0)}\n   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;\n   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch\n   ${w&&d?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":""};\n   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;\n   ${d?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":""}\n   var value = ${g.type.storage}(0);\n   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {\n      if (m < uniforms.M && w + local_id.x < uniforms.K) {\n        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];\n      }\n      if (n < uniforms.N && w + local_id.y < uniforms.K) {\n        var idx = TILE_SIZE * local_id.y + local_id.x;\n        ${w&&d?`\n        if (w + local_id.y < past_sequence_length) {\n          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];\n        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {\n          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];\n        }\n      `:`\n            if (w + local_id.y < uniforms.kv_sequence_length) {\n              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];\n            }`}\n        ${d?`\n            if (w + local_id.y < present_sequence_length) {\n          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];\n        }`:""}\n      }\n     workgroupBarrier();\n     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {\n       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];\n     }\n     workgroupBarrier();\n   }\n\n   // we need to transpose output from BNSH_v to BSND_v\n   if (m < uniforms.M && n < uniforms.N) {\n     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size\n       + headIdx * uniforms.N + n;\n     output[outputIdx] = value;\n   }\n  }`};return{name:"AttentionScore",shaderCache:{hint:`${s!==void 0};${e}`,inputDependencies:C},getRunData:()=>({outputs:x,dispatchGroup:E,programUniforms:M}),getShaderSource:T}},gn=(e,r,t,s,o,a,n,i,l,c,_=void 0,d=void 0)=>{let u=Math.min(e.outputCount,1+(n?1:0)+(i?1:0)),f=u>1?c.pastSequenceLength:0,h=f+c.kvSequenceLength,v=l&&we.size(l.dims)>0?l:void 0,E=[r,t];u>1&&n&&we.size(n.dims)>0&&E.push(n),v&&E.push(v),_&&E.push(_),d&&E.push(d);let M=e.compute(Hg(u,r,t,n,v,c,f,_,d),{inputs:E,outputs:u>1?[-1,1]:[-1]})[0];e.compute(Kg(M,c.batchSize,c.numHeads,f,c.sequenceLength,h,_,d),{inputs:_&&d?[M,_,d]:[M],outputs:[]});let w=[M,s];u>1&&i&&we.size(i.dims)>0&&w.push(i),_&&w.push(_),d&&w.push(d),e.compute(qg(u,M,s,i,c,f,_,d),{inputs:w,outputs:u>1?[0,2]:[0]})},Qg=(e,r)=>{let t=[r.batchSize,r.numHeads,r.sequenceLength,r.headSize],s=r.sequenceLength,o=r.inputHiddenSize,a=r.headSize,n=12,i={x:Math.ceil(r.headSize/n),y:Math.ceil(r.sequenceLength/n),z:r.batchSize*r.numHeads},l=[e.inputs[0],e.inputs[1],e.inputs[2]],c=[{type:12,data:s},{type:12,data:o},{type:12,data:a},{type:12,data:r.numHeads},{type:12,data:r.headSize},{type:12,data:r.hiddenSize},{type:12,data:r.hiddenSize+r.hiddenSize+r.vHiddenSize}],_=d=>{let u=nt("output_q",l[0].dataType,t),f=nt("output_k",l[0].dataType,t),h=nt("output_v",l[0].dataType,t),v=Ee("input",l[0].dataType,l[0].dims),E=Ee("weight",l[1].dataType,l[1].dims),M=Ee("bias",l[2].dataType,l[2].dims),w=v.type.storage,C=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}];return`\n  const TILE_SIZE = ${n}u;\n  var<workgroup> tileInput: array<${w}, ${n*n}>;\n  var<workgroup> tileWeightQ: array<${w}, ${n*n}>;\n  var<workgroup> tileWeightK: array<${w}, ${n*n}>;\n  var<workgroup> tileWeightV: array<${w}, ${n*n}>;\n  ${d.registerUniforms(C).declareVariables(v,E,M,u,f,h)}\n  ${d.mainStart([n,n,1])}\n    let batchIndex = workgroup_id.z / uniforms.num_heads;\n    let headNumber = workgroup_id.z % uniforms.num_heads;\n    let m = global_id.y;\n    let n = global_id.x;\n\n    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;\n    let biasOffsetQ = headNumber * uniforms.head_size;\n    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;\n    let biasOffsetV = uniforms.hidden_size + biasOffsetK;\n\n    var valueQ = ${w}(0);\n    var valueK = ${w}(0);\n    var valueV = ${w}(0);\n    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {\n      if (m < uniforms.M && w + local_id.x < uniforms.K) {\n        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];\n      }\n      if (n < uniforms.N && w + local_id.y < uniforms.K) {\n        let offset = n + (w + local_id.y) * uniforms.ldb;\n        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];\n        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];\n        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];\n      }\n      workgroupBarrier();\n      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {\n        let inputTileOffset = TILE_SIZE * local_id.y + k;\n        let weightTileOffset = TILE_SIZE * k + local_id.x;\n        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];\n        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];\n        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];\n      }\n\n      workgroupBarrier();\n    }\n\n    let headOffset = (m * uniforms.N + n) % uniforms.head_size;\n    valueQ += bias[headOffset + biasOffsetQ];\n    valueK += bias[headOffset + biasOffsetK];\n    valueV += bias[headOffset + biasOffsetV];\n\n    let offset = workgroup_id.z * uniforms.M * uniforms.N;\n    if (m < uniforms.M && n < uniforms.N) {\n      let outputIdx = offset + m * uniforms.N + n;\n      output_q[outputIdx] = valueQ;\n      output_k[outputIdx] = valueK;\n      output_v[outputIdx] = valueV;\n    }\n  }`};return e.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:t,dataType:e.inputs[0].dataType,gpuDataType:0},{dims:t,dataType:e.inputs[0].dataType,gpuDataType:0},{dims:t,dataType:e.inputs[0].dataType,gpuDataType:0}],dispatchGroup:i,programUniforms:c}),getShaderSource:_},{inputs:l,outputs:[-1,-1,-1]})},Fv=(e,r)=>{let t=Gg(e.inputs,r),[s,o,a]=Qg(e,t);return gn(e,s,o,a,e.inputs[4],void 0,void 0,void 0,e.inputs[5],t)}}),IT=Ve(()=>{"use strict";As(),bt(),St(),mr(),$t(),Xg=(e,r)=>{if(!e||e.length!==5)throw new Error("BatchNormalization requires 5 inputs");let t=(s,o,a)=>{let n=o.length;if(n!==s.length)throw new Error(`${a}: num dimensions != ${n}`);o.forEach((i,l)=>{if(i!==s[l])throw new Error(`${a}: dim[${l}] do not match`)})};if(e[0].dims.length>1){let s=r.format==="NHWC"?r.spatial?e[0].dims.slice(-1):e[0].dims.slice(-1).concat(e[0].dims.slice(1,e[0].dims.length-1)):e[0].dims.slice(1,r.spatial?2:void 0);t(e[1].dims,s,"Invalid input scale"),t(e[2].dims,s,"Invalid input B"),t(e[3].dims,s,"Invalid input mean"),t(e[4].dims,s,"Invalid input var")}else t(e[1].dims,[1],"Invalid input scale"),t(e[2].dims,[1],"Invalid input B"),t(e[3].dims,[1],"Invalid input mean"),t(e[4].dims,[1],"Invalid input var")},Jg=(e,r)=>{let{epsilon:t,spatial:s,format:o}=r,a=e[0].dims,n=s?pr(a[a.length-1]):1,i=o==="NHWC"&&a.length>1?n:1,l=we.size(a)/n,c=s,_=c?a.length:a,d=Ee("x",e[0].dataType,e[0].dims,n),u=Ee("scale",e[1].dataType,e[1].dims,i),f=Ee("bias",e[2].dataType,e[2].dims,i),h=Ee("inputMean",e[3].dataType,e[3].dims,i),v=Ee("inputVar",e[4].dataType,e[4].dims,i),E=nt("y",e[0].dataType,_,n),M=()=>{let C="";if(s)C=`let cOffset = ${a.length===1?"0u":o==="NHWC"?`outputIndices[${a.length-1}] / ${n}`:"outputIndices[1]"};`;else if(o==="NCHW")C=`\n            ${E.indicesSet("outputIndices","0","0")}\n            let cOffset = ${E.indicesToOffset("outputIndices")};`;else{C=`var cIndices = ${u.type.indices}(0);\n                       cIndices[0] = outputIndices[${a.length-1}];`;for(let x=1;x<u.rank;x++)C+=`cIndices[${x}] = outputIndices[${x}];`;C+=`let cOffset = ${u.indicesToOffset("cIndices")};`}return C},w=C=>`\n  const epsilon = ${t};\n  ${C.registerUniform("outputSize","u32").declareVariables(d,u,f,h,v,E)}\n  ${C.mainStart()}\n  ${C.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n    var outputIndices = ${E.offsetToIndices(`global_idx * ${n}`)};\n    ${M()}\n    let scale = ${u.getByOffset("cOffset")};\n    let bias = ${f.getByOffset("cOffset")};\n    let inputMean = ${h.getByOffset("cOffset")};\n    let inputVar = ${v.getByOffset("cOffset")};\n    let x = ${d.getByOffset("global_idx")};\n    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;\n    ${E.setByOffset("global_idx","value")}\n  }`;return{name:"BatchNormalization",shaderCache:{hint:`${r.epsilon}_${r.format}_${s}_${n}`,inputDependencies:c?["rank","type","type","type","type"]:void 0},getShaderSource:w,getRunData:()=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:c?[{type:12,data:l},...pt(a)]:[{type:12,data:l}]})}},Yg=e=>qt(e),$v=(e,r)=>{let{inputs:t,outputCount:s}=e,o=Yg(Ct(Fe({},r),{outputCount:s}));if(nr.webgpu.validateInputContent&&Xg(t,o),r.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");e.compute(Jg(t,o))}}),FT=Ve(()=>{"use strict";St(),$t(),Zg=e=>{if(e[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(e[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(e[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(e[0].dims[2]!==e[1].dims[0])throw new Error("last dimension of input and bias are not the same")},eM=e=>{let r=e[0].dims,t=e[0].dims[2],s=we.size(r)/4,o=e[0].dataType,a=Ee("input",o,r,4),n=Ee("bias",o,[t],4),i=Ee("residual",o,r,4),l=nt("output",o,r,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)}}),getShaderSource:c=>`\n  const channels = ${t}u / 4;\n  ${c.declareVariables(a,n,i,l)}\n\n  ${c.mainStart()}\n    ${c.guardAgainstOutOfBoundsWorkgroupSizes(s)}\n    let value = ${a.getByOffset("global_idx")}\n      + ${n.getByOffset("global_idx % channels")} + ${i.getByOffset("global_idx")};\n    ${l.setByOffset("global_idx","value")}\n  }`}},Av=e=>{Zg(e.inputs),e.compute(eM(e.inputs))}}),Ud=Ve(()=>{"use strict";bt(),St(),mr(),$t(),tM=(e,r,t,s,o,a,n)=>{let i=Math.ceil(r/4),l="";typeof o=="string"?l=`${o}(a)`:l=o("a");let c=Ee("inputData",t,[i],4),_=nt("outputData",s,[i],4),d=[{name:"vec_size",type:"u32"}];return n&&d.push(...n),`\n      ${e.registerUniforms(d).declareVariables(c,_)}\n\n  ${a!=null?a:""}\n\n  ${e.mainStart()}\n    ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}\n\n    let a = ${c.getByOffset("global_idx")};\n    ${_.setByOffset("global_idx",l)}\n  }`},Kt=(e,r,t,s,o,a=e.dataType,n,i)=>{let l=[{type:12,data:Math.ceil(we.size(e.dims)/4)}];return n&&l.push(...n),{name:r,shaderCache:{hint:o,inputDependencies:["type"]},getShaderSource:c=>tM(c,we.size(e.dims),e.dataType,a,t,s,i),getRunData:c=>({outputs:[{dims:e.dims,dataType:a}],dispatchGroup:{x:Math.ceil(we.size(c[0].dims)/64/4)},programUniforms:l})}},Dv=e=>{e.compute(Kt(e.inputs[0],"Abs","abs"))},Ov=e=>{e.compute(Kt(e.inputs[0],"Acos","acos"))},Lv=e=>{e.compute(Kt(e.inputs[0],"Acosh","acosh"))},zv=e=>{e.compute(Kt(e.inputs[0],"Asin","asin"))},Bv=e=>{e.compute(Kt(e.inputs[0],"Asinh","asinh"))},Rv=e=>{e.compute(Kt(e.inputs[0],"Atan","atan"))},Nv=e=>{e.compute(Kt(e.inputs[0],"Atanh","atanh"))},jv=e=>qt(e),Vv=(e,r)=>{let t;switch(r.to){case 10:t="vec4<f16>";break;case 1:t="vec4<f32>";break;case 12:t="vec4<u32>";break;case 6:t="vec4<i32>";break;case 9:t="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute \'to\' from \'Cast\' operator): ${r.to}`)}e.compute(Kt(e.inputs[0],"Cast",t,void 0,r.cacheKey,r.to))},rM=e=>{let r,t,s=e.length>=2&&e[1].data!==0,o=e.length>=3&&e[2].data!==0;switch(e[0].dataType){case 1:r=s?e[1].getFloat32Array()[0]:-34028234663852886e22,t=o?e[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:r=s?e[1].getUint16Array()[0]:64511,t=o?e[2].getUint16Array()[0]:31743;break;default:throw new Error("Unsupport data type")}return qt({min:r,max:t})},Wv=(e,r)=>{let t=r||rM(e.inputs),s=Xr(e.inputs[0].dataType);e.compute(Kt(e.inputs[0],"Clip",o=>`clamp(${o}, vec4<${s}>(uniforms.min), vec4<${s}>(uniforms.max))`,void 0,t.cacheKey,void 0,[{type:e.inputs[0].dataType,data:t.min},{type:e.inputs[0].dataType,data:t.max}],[{name:"min",type:s},{name:"max",type:s}]),{inputs:[0]})},Uv=e=>{e.compute(Kt(e.inputs[0],"Ceil","ceil"))},Gv=e=>{e.compute(Kt(e.inputs[0],"Cos","cos"))},Kv=e=>{e.compute(Kt(e.inputs[0],"Cosh","cosh"))},_n=e=>qt(e),Hv=(e,r)=>{let t=Xr(e.inputs[0].dataType);e.compute(Kt(e.inputs[0],"Elu",s=>`elu_vf32(${s})`,`\n  const elu_alpha_ = ${t}(${r.alpha});\n\n  fn elu_f32(a: ${t}) -> ${t} {\n  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);\n  }\n\n  fn elu_vf32(v: vec4<${t}>) -> vec4<${t}> {\n  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));\n  }`,r.cacheKey))},Li=(e="f32")=>`\nconst r0: ${e} = 0.3275911;\nconst r1: ${e} = 0.254829592;\nconst r2: ${e} = -0.284496736;\nconst r3: ${e} = 1.421413741;\nconst r4: ${e} = -1.453152027;\nconst r5: ${e} = 1.061405429;\n\nfn erf_vf32(v: vec4<${e}>) -> vec4<${e}> {\n  let absv = abs(v);\n  let x = 1.0 / (1.0 + r0 * absv);\n  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));\n}`,qv=e=>{let r=Xr(e.inputs[0].dataType);e.compute(Kt(e.inputs[0],"Erf",t=>`erf_vf32(${t})`,Li(r)))},Qv=e=>{e.compute(Kt(e.inputs[0],"Exp","exp"))},Xv=e=>{e.compute(Kt(e.inputs[0],"Floor","floor"))},Jv=e=>{let r=Xr(e.inputs[0].dataType);e.compute(Kt(e.inputs[0],"Gelu",t=>`0.5 * ${t} * (1.0 + erf_vf32(${t} * 0.7071067811865475))`,Li(r)))},Yv=(e,r)=>{let t=Xr(e.inputs[0].dataType);e.compute(Kt(e.inputs[0],"LeakyRelu",s=>`select(leaky_relu_alpha_ * ${s}, ${s}, ${s} >= vec4<${t}>(0.0))`,`const leaky_relu_alpha_ = ${t}(${r.alpha});`,r.cacheKey))},Zv=e=>{e.compute(Kt(e.inputs[0],"Not",r=>`!${r}`))},ex=e=>{e.compute(Kt(e.inputs[0],"Neg",r=>`-${r}`))},tx=e=>{e.compute(Kt(e.inputs[0],"Reciprocal",r=>`1.0/${r}`))},rx=e=>{let r=Xr(e.inputs[0].dataType);e.compute(Kt(e.inputs[0],"Relu",t=>`select(vec4<${r}>(0.0), ${t}, ${t} > vec4<${r}>(0.0))`))},sx=e=>{e.compute(Kt(e.inputs[0],"Sigmoid",r=>`(1.0 / (1.0 + exp(-${r})))`))},ax=e=>qt(e),ox=(e,r)=>{let t=Xr(e.inputs[0].dataType);e.compute(Kt(e.inputs[0],"HardSigmoid",s=>`max(vec4<${t}>(0.0), min(vec4<${t}>(1.0), ${r.alpha} * ${s} + vec4<${t}>(${r.beta})))`,void 0,r.cacheKey))},nx=e=>{e.compute(Kt(e.inputs[0],"Sin","sin"))},ix=e=>{e.compute(Kt(e.inputs[0],"Sinh","sinh"))},lx=e=>{e.compute(Kt(e.inputs[0],"Sqrt","sqrt"))},cx=e=>{e.compute(Kt(e.inputs[0],"Tan","tan"))},Dc=e=>`sign(${e}) * (1 - exp(-2 * abs(${e}))) / (1 + exp(-2 * abs(${e})))`,dx=e=>{e.compute(Kt(e.inputs[0],"Tanh",Dc))},Md=(e="f32")=>`\nconst fast_gelu_a: ${e} = 0.5;\nconst fast_gelu_b: ${e} = 0.7978845608028654;\nconst fast_gelu_c: ${e} = 0.035677408136300125;\n\nfn tanh_v(v: vec4<${e}>) -> vec4<${e}> {\n  return ${Dc("v")};\n}\n`,wd=e=>`(fast_gelu_a + fast_gelu_a * tanh_v(${e} * (fast_gelu_c * ${e} * ${e} + fast_gelu_b))) * ${e}`,ux=e=>{let r=Xr(e.inputs[0].dataType);e.compute(Kt(e.inputs[0],"FastGelu",wd,Md(r),void 0,e.inputs[0].dataType))},_x=(e,r)=>{let t=Xr(e.inputs[0].dataType);return e.compute(Kt(e.inputs[0],"ThresholdedRelu",s=>`select(vec4<${t}>(0.0), ${s}, ${s} > thresholded_relu_alpha_)`,`const thresholded_relu_alpha_ = vec4<${t}>(${r.alpha});`,r.cacheKey)),0},px=e=>{e.compute(Kt(e.inputs[0],"Log","log"))},sM=(e,r)=>`\nconst alpha = vec4<${e}>(${r});\nconst one = ${e}(1.0);\nconst zero = ${e}(0.0);\n\nfn quick_gelu_impl(x: vec4<${e}>) -> vec4<${e}> {\n  let v = x *alpha;\n  var x1 : vec4<${e}>;\n  for (var i = 0; i < 4; i = i + 1) {\n    if (v[i] >= zero) {\n      x1[i] = one / (one + exp(-v[i]));\n    } else {\n      x1[i] = one - one / (one + exp(v[i]));\n    }\n  }\n  return x * x1;\n}\n`,aM=e=>`quick_gelu_impl(${e})`,mx=(e,r)=>{let t=Xr(e.inputs[0].dataType);e.compute(Kt(e.inputs[0],"QuickGelu",aM,sM(t,r.alpha),r.cacheKey,e.inputs[0].dataType))}}),$T=Ve(()=>{"use strict";St(),$t(),Ud(),oM=e=>{if(e[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(e[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(e[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(e[0].dims[2]!==e[1].dims[0])throw new Error("last dimension of input and bias are not the same")},nM=e=>{let r=e[0].dims.slice();r[2]=r[2]/2;let t=Ee("input",e[0].dataType,e[0].dims,4),s=Ee("bias",e[0].dataType,[e[0].dims[2]],4),o=nt("output",e[0].dataType,r,4),a=we.size(r)/4,n=Ar(e[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(a/64)}}),getShaderSource:i=>`\n  const M_SQRT2 = sqrt(2.0);\n  const halfChannels = ${e[0].dims[2]/4/2}u;\n\n  ${i.declareVariables(t,s,o)}\n\n  ${Li(n)}\n\n  ${i.mainStart()}\n    ${i.guardAgainstOutOfBoundsWorkgroupSizes(a)}\n    let biasIdx = global_idx % halfChannels;\n    let batchIndex = global_idx / halfChannels;\n    let inputOffset = biasIdx + batchIndex * halfChannels * 2;\n    let valueLeft = input[inputOffset] + bias[biasIdx];\n    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];\n    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);\n\n    ${o.setByOffset("global_idx","valueLeft * geluRight")}\n  }`}},hx=e=>{oM(e.inputs),e.compute(nM(e.inputs))}}),AT=Ve(()=>{"use strict";bt(),St(),$t(),iM=(e,r,t,s,o,a,n,i,l,c,_,d)=>{let u,f;typeof i=="string"?u=f=(w,C)=>`${i}((${w}),(${C}))`:typeof i=="function"?u=f=i:(u=i.scalar,f=i.vector);let h=nt("outputData",_,s.length,4),v=Ee("aData",l,r.length,4),E=Ee("bData",c,t.length,4),M;if(o)if(a){let w=we.size(r)===1,C=we.size(t)===1,x=r.length>0&&r[r.length-1]%4===0,T=t.length>0&&t[t.length-1]%4===0;w||C?M=h.setByOffset("global_idx",f(w?`${v.type.value}(${v.getByOffset("0")}.x)`:v.getByOffset("global_idx"),C?`${E.type.value}(${E.getByOffset("0")}.x)`:E.getByOffset("global_idx"))):M=`\n            let outputIndices = ${h.offsetToIndices("global_idx * 4u")};\n            let offsetA = ${v.broadcastedIndicesToOffset("outputIndices",h)};\n            let offsetB = ${E.broadcastedIndicesToOffset("outputIndices",h)};\n            ${h.setByOffset("global_idx",f(n||x?v.getByOffset("offsetA / 4u"):`${v.type.value}(${v.getByOffset("offsetA / 4u")}[offsetA % 4u])`,n||T?E.getByOffset("offsetB / 4u"):`${E.type.value}(${E.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}\n          `}else M=h.setByOffset("global_idx",f(v.getByOffset("global_idx"),E.getByOffset("global_idx")));else{if(!a)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let w=(C,x,T="")=>{let S=`aData[indexA${x}][componentA${x}]`,g=`bData[indexB${x}][componentB${x}]`;return`\n            let outputIndices${x} = ${h.offsetToIndices(`global_idx * 4u + ${x}u`)};\n            let offsetA${x} = ${v.broadcastedIndicesToOffset(`outputIndices${x}`,h)};\n            let offsetB${x} = ${E.broadcastedIndicesToOffset(`outputIndices${x}`,h)};\n            let indexA${x} = offsetA${x} / 4u;\n            let indexB${x} = offsetB${x} / 4u;\n            let componentA${x} = offsetA${x} % 4u;\n            let componentB${x} = offsetB${x} % 4u;\n            ${C}[${x}] = ${T}(${u(S,g)});\n          `};_===9?M=`\n            var data = vec4<u32>(0);\n            ${w("data",0,"u32")}\n            ${w("data",1,"u32")}\n            ${w("data",2,"u32")}\n            ${w("data",3,"u32")}\n            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:M=`\n            ${w("outputData[global_idx]",0)}\n            ${w("outputData[global_idx]",1)}\n            ${w("outputData[global_idx]",2)}\n            ${w("outputData[global_idx]",3)}\n          `}return`\n        ${e.registerUniform("vec_size","u32").declareVariables(v,E,h)}\n\n        ${d!=null?d:""}\n\n        ${e.mainStart()}\n        ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}\n        ${M}\n      }`},lM=(e,r,t,s,o,a,n=t.dataType)=>{let i=t.dims.map(v=>{var E;return(E=Number(v))!=null?E:1}),l=s.dims.map(v=>{var E;return(E=Number(v))!=null?E:1}),c=!we.areEqual(i,l),_=i,d=we.size(i),u=!1,f=!1,h=[c];if(c){let v=po.calcShape(i,l,!1);if(!v)throw new Error("Can\'t perform binary op on the given tensors");_=v.slice(),d=we.size(_);let E=we.size(i)===1,M=we.size(l)===1,w=i.length>0&&i[i.length-1]%4===0,C=l.length>0&&l[l.length-1]%4===0;h.push(E),h.push(M),h.push(w),h.push(C);let x=1;for(let T=1;T<_.length;T++){let S=i[i.length-T],g=l[l.length-T];if(S===g)x*=S;else break}x%4===0?(f=!0,u=!0):(E||M||w||C)&&(u=!0)}else u=!0;return h.push(u),{name:e,shaderCache:{hint:r+h.map(v=>v.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:v=>iM(v,i,l,_,u,c,f,o,t.dataType,s.dataType,n,a),getRunData:()=>({outputs:[{dims:_,dataType:n}],dispatchGroup:{x:Math.ceil(d/64/4)},programUniforms:[{type:12,data:Math.ceil(we.size(_)/4)},...pt(i,l,_)]})}},Cs=(e,r,t,s,o,a)=>{e.compute(lM(r,o!=null?o:"",e.inputs[0],e.inputs[1],t,s,a))},fx=e=>{Cs(e,"Add",(r,t)=>`${r}+${t}`)},gx=e=>{Cs(e,"Div",(r,t)=>`${r}/${t}`)},Mx=e=>{Cs(e,"Equal",{scalar:(r,t)=>`u32(${r}==${t})`,vector:(r,t)=>`vec4<u32>(${r}==${t})`},void 0,void 0,9)},wx=e=>{Cs(e,"Mul",(r,t)=>`${r}*${t}`)},bx=e=>{let r=Ee("input",e.inputs[0].dataType,e.inputs[0].dims).type.value;Cs(e,"Pow",{scalar:(t,s)=>`pow_custom(${t},${s})`,vector:(t,s)=>`pow_vector_custom(${t},${s})`},`\n    fn pow_custom(a : ${r}, b : ${r}) -> ${r} {\n      if (b == ${r}(0.0)) {\n        return ${r}(1.0);\n      } else if (a < ${r}(0.0) && f32(b) != floor(f32(b))) {\n        return ${r}(pow(f32(a), f32(b))); // NaN\n      }\n      return select(sign(a), ${r}(1.0), round(f32(abs(b) % ${r}(2.0))) != 1.0) * ${r}(${r==="i32"?"round":""}(pow(f32(abs(a)), f32(b))));\n    }\n    fn pow_vector_custom(a : vec4<${r}>, b : vec4<${r}>) -> vec4<${r}> {\n      // TODO: implement vectorized pow\n      return vec4<${r}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));\n    }\n      `)},vx=e=>{Cs(e,"Sub",(r,t)=>`${r}-${t}`)},xx=e=>{Cs(e,"Greater",{scalar:(r,t)=>`u32(${r}>${t})`,vector:(r,t)=>`vec4<u32>(${r}>${t})`},void 0,void 0,9)},yx=e=>{Cs(e,"Less",{scalar:(r,t)=>`u32(${r}<${t})`,vector:(r,t)=>`vec4<u32>(${r}<${t})`},void 0,void 0,9)},Tx=e=>{Cs(e,"GreaterOrEqual",{scalar:(r,t)=>`u32(${r}>=${t})`,vector:(r,t)=>`vec4<u32>(${r}>=${t})`},void 0,void 0,9)},Px=e=>{Cs(e,"LessOrEqual",{scalar:(r,t)=>`u32(${r}<=${t})`,vector:(r,t)=>`vec4<u32>(${r}<=${t})`},void 0,void 0,9)}}),DT=Ve(()=>{"use strict";bt(),St(),mr(),$t(),cM=(e,r)=>{if(!e||e.length<1)throw new Error("too few inputs");let t=0,s=e[t],o=s.dataType,a=s.dims.length;e.forEach((n,i)=>{if(i!==t){if(n.dataType!==o)throw new Error("input tensors should be one type");if(n.dims.length!==a)throw new Error("input tensors should have the same shape");n.dims.forEach((l,c)=>{if(c!==r&&l!==s.dims[c])throw new Error("non concat dimensions must match")})}})},dM=(e,r)=>`\n  fn calculateInputIndex(index: u32) -> u32 {\n    let sizeInConcatAxis = array<u32, ${e}u>(${r});\n    for (var i: u32 = 0u; i < ${e}; i += 1u ) {\n      if (index < sizeInConcatAxis[i]) {\n        return i;\n      }\n    }\n    return ${e}u;\n  }`,uM=(e,r)=>{let t=e.length,s=[];for(let o=0;o<t;++o){let a=r.setByOffset("global_idx",e[o].getByIndices("indices"));t===1?s.push(a):o===0?s.push(`if (inputIndex == ${o}u) { ${a} }`):o===t-1?s.push(`else { ${a} }`):s.push(`else if (inputIndex == ${o}) { ${a} }`)}return s.join(`\n`)},_M=(e,r,t,s)=>{let o=we.size(t),a=new Array(e.length),n=new Array(e.length),i=0,l=[],c=[],_=[{type:12,data:o}];for(let v=0;v<e.length;++v)i+=e[v].dims[r],a[v]=i,c.push(e[v].dims.length),n[v]=Ee(`input${v}`,s,c[v]),l.push("rank"),_.push({type:12,data:a[v]});for(let v=0;v<e.length;++v)_.push(...pt(e[v].dims));_.push(...pt(t));let d=nt("output",s,t.length),u=d.indicesGet("indices",r),f=Array.from(Array(a.length).keys()).map(v=>`uniforms.sizeInConcatAxis${v}`).join(","),h=v=>`\n\n  ${(()=>{v.registerUniform("outputSize","u32");for(let E=0;E<e.length;E++)v.registerUniform(`sizeInConcatAxis${E}`,"u32");return v.declareVariables(...n,d)})()}\n\n  ${dM(a.length,f)}\n\n  ${v.mainStart()}\n    ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n\n    var indices = ${d.offsetToIndices("global_idx")};\n\n    let inputIndex = calculateInputIndex(${u});\n    if (inputIndex != 0u) {\n      let sizeInConcatAxis = array<u32, ${a.length}u>(${f});\n      ${u} -= sizeInConcatAxis[inputIndex - 1u];\n    }\n\n    ${uM(n,d)}\n  }`;return{name:"Concat",shaderCache:{hint:`${r}`,inputDependencies:l},getRunData:()=>({outputs:[{dims:t,dataType:s}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:_}),getShaderSource:h}},Ex=(e,r)=>{let t=e.inputs,s=t[0].dims,o=we.normalizeAxis(r.axis,s.length);cM(t,o);let a=s.slice();a[o]=t.reduce((i,l)=>i+(l.dims.length>o?l.dims[o]:0),0);let n=t.filter(i=>we.size(i.dims)>0);e.compute(_M(n,o,a,t[0].dataType),{inputs:n})},kx=e=>qt({axis:e.axis})}),Wa=Ve(()=>{"use strict";bt(),St(),Ra=(e,r,t="f32")=>{switch(e.activation){case"Relu":return`value = max(value, ${r}(0.0));`;case"Sigmoid":return`value = (${r}(1.0) / (${r}(1.0) + exp(-value)));`;case"Clip":return`value = clamp(value, ${r}(${t}(uniforms.clip_min)), ${r}(${t}(uniforms.clip_max)));`;case"HardSigmoid":return`value = max(${r}(0.0), min(${r}(1.0), ${t}(uniforms.alpha) * value + ${t}(uniforms.beta)));`;case"LeakyRelu":return`value = select(${t}(uniforms.alpha) * value, value, value >= ${r}(0.0));`;case"Tanh":return`let e2x = exp(-2.0 * abs(value));\n              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);\n        `;case"":return"";default:throw new Error(`Unsupported activation ${e.activation}`)}},Na=(e,r)=>{e.activation==="Clip"?r.push({type:1,data:e.clipMax},{type:1,data:e.clipMin}):e.activation==="HardSigmoid"?r.push({type:1,data:e.alpha},{type:1,data:e.beta}):e.activation==="LeakyRelu"&&r.push({type:1,data:e.alpha})},ja=(e,r)=>{e.activation==="Clip"?r.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):e.activation==="HardSigmoid"?r.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):e.activation==="LeakyRelu"&&r.push({name:"alpha",type:"f32"})},Gd=e=>{let r=(e==null?void 0:e.activation)||"";if(r==="HardSigmoid"){let[t,s]=(e==null?void 0:e.activation_params)||[.2,.5];return{activation:r,alpha:t,beta:s}}else if(r==="Clip"){let[t,s]=(e==null?void 0:e.activation_params)||[Zb,ev];return{activation:r,clipMax:s,clipMin:t}}else if(r==="LeakyRelu"){let[t]=(e==null?void 0:e.activation_params)||[.01];return{activation:r,alpha:t}}return{activation:r}}}),Kd=Ve(()=>{"use strict";Nr=(e,r)=>{switch(e){case 1:return r;case 2:return`vec2<${r}>`;case 3:return`vec3<${r}>`;case 4:return`vec4<${r}>`;default:throw new Error(`${e}-component is not supported.`)}},Cx=e=>`\n      ${e?"value = value + getBiasByOutputCoords(coords);":""}\n      `}),OT=Ve(()=>{"use strict";Sx=e=>`\nfn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {\n  return dot(coords, vec4<i32>(\n      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));\n}\nfn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {\n  return dot(coords, vec4<i32>(\n    i32(${e}.x), i32(${e}.y), i32(${e}.z), 1));\n}\n`}),qd=Ve(()=>{"use strict";bt(),St(),$t(),Wa(),mn=(e,r,t,s,o)=>{let a=s-t;return`\n      ${Array.from({length:t}).map((n,i)=>`\n      if (${ct(r.shape,i,r.rank)} != 1) {\n        ${r.indicesSet(e,i,ct(o,i+a,s))}\n      } else {\n        ${r.indicesSet(e,i,0)}\n      }`).join("")}\n`},Hd=(e,r,t,s,o=!1,a)=>{let n=e[0].dims,i=e[1].dims,l=n[n.length-2],c=i[i.length-1],_=n[n.length-1],d=pr(c),u=pr(_),f=pr(l),h=we.size(t)/d/f,v=e.length>2,E=s?s.slice(0,-2):t.slice(0,-2),M=[we.size(E),l,c],w=[{type:12,data:h},{type:12,data:l},{type:12,data:c},{type:12,data:_}];Na(r,w),w.push(...pt(E,n,i)),v&&w.push(...pt(e[2].dims)),w.push(...pt(M));let C=x=>{let T=jd("batch_dims",e[0].dataType,E.length),S=Ee("a",e[0].dataType,n.length,u),g=Ee("b",e[1].dataType,i.length,d),P=nt("output",e[0].dataType,M.length,d),$=Ar(P.type.tensor),A=Ra(r,P.type.value,$),N=[S,g],W="";if(v){let H=o?d:1;N.push(Ee("bias",e[2].dataType,e[2].dims.length,H)),W=`${o?`value += bias[col / ${H}];`:`value += ${P.type.value}(bias[row + i]);`}`}let R=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];ja(r,R);let J=()=>{let H=`var a_data: ${S.type.value};`;for(let q=0;q<u;q++)H+=`\n              let b_data${q} = b[(b_offset + (k + ${q}) * uniforms.N + col) / ${d}];`;for(let q=0;q<f;q++){H+=`a_data = a[(a_offset + (row + ${q}) * uniforms.K + k) / ${u}];`;for(let X=0;X<u;X++)H+=`\n            values[${q}] = fma(${g.type.value}(a_data${u===1?"":`[${X}]`}), b_data${X}, values[${q}]);\n`}return H};return`\n  ${x.registerUniforms(R).registerInternalVariables(T).declareVariables(...N,P)}\n  ${x.mainStart()}\n    ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n    let col = (global_idx % (uniforms.N / ${d})) * ${d};\n    var index1 = global_idx / (uniforms.N / ${d});\n    let stride1 = uniforms.M / ${f};\n    let row = (index1 % stride1) * ${f};\n    let batch = index1 / stride1;\n\n    ${t.length===2?"":`let batch_indices = ${T.offsetToIndices("batch")};`}\n\n    var a_indices: ${S.type.indices};\n    ${mn("a_indices",S,S.rank-2,T.rank,"batch_indices")}\n    ${S.indicesSet("a_indices",S.rank-2,0)}\n    ${S.indicesSet("a_indices",S.rank-1,0)}\n    let a_offset = ${S.indicesToOffset("a_indices")};\n\n    var b_indices: ${g.type.indices};\n    ${mn("b_indices",g,g.rank-2,T.rank,"batch_indices")}\n    ${g.indicesSet("b_indices",g.rank-2,0)}\n    ${g.indicesSet("b_indices",g.rank-1,0)}\n    let b_offset = ${g.indicesToOffset("b_indices")};\n    var values: array<${P.type.value}, ${f}>;\n    for (var k: u32 = 0u; k < uniforms.K; k = k + ${u}) {\n      ${J()}\n    }\n    for (var i = 0u; i < ${f}u; i++) {\n      var value = values[i];\n      ${W}\n      ${A}\n      let cur_indices = ${P.type.indices}(batch, row + i, col);\n      let offset = ${P.indicesToOffset("cur_indices")};\n      ${P.setByOffset(`offset / ${d}`,"value")};\n    }\n  }\n  `};return{name:"MatMulNaive",shaderCache:{hint:`${r.activation};${d};${u};${f};${o}`,inputDependencies:v?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:a?a(t):t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:w}),getShaderSource:C}}}),Qd=Ve(()=>{"use strict";bt(),St(),$t(),Wa(),qd(),Kd(),pM=(e,r)=>e?`\n        mm_Asub[inputRow][inputCol] = mm_readA(batch,\n          kStart + inputRow,\n          globalRowStart / innerElementSize + inputCol${r?", batchIndices":""});\n        `:`\n        mm_Asub[inputRow][inputCol] = mm_readA(batch,\n          globalRow + innerRow,\n          kStart / innerElementSize + inputCol${r?", batchIndices":""});\n        `,mM=(e,r)=>e?`\n        let ACached0 = mm_Asub[k * innerElementSize][localRow];\n        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];\n        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];\n        ${r===3?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}\n        for (var i = 0; i < rowPerThread; i = i + 1) {\n          acc[i] = BCached0 * ACached0[i] + acc[i];\n          acc[i] = BCached1 * ACached1[i] + acc[i];\n          acc[i] = BCached2 * ACached2[i] + acc[i];\n          ${r===3?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}\n        }`:`\n        for (var i = 0; i < rowPerThread; i = i + 1) {\n          let ACached = mm_Asub[tileRow + i][k];\n          acc[i] = BCached0 * ACached.x + acc[i];\n          acc[i] = BCached1 * ACached.y + acc[i];\n          acc[i] = BCached2 * ACached.z + acc[i];\n          ${r===3?"":"acc[i] = BCached3 * ACached.w + acc[i];"}\n        }`,bd=(e,r,t="f32",s,o=!1,a=32,n=!1,i=32)=>{let l=r[1]*e[1],c=r[0]*e[0],_=o?l:a,d=o?a:l,u=_/r[0],f=a/r[1];if(!((o&&u===4&&e[1]===4||!o&&(u===3||u===4))&&_%r[0]===0&&a%r[1]===0&&e[0]===4))throw new Error(`If transposeA ${o} is true, innerElementSize ${u} and workPerThread[1] ${e[1]} must be 4.\n      Otherwise, innerElementSize ${u} must be 3 or 4.\n  tileAWidth ${_} must be divisible by workgroupSize[0]${r[0]}. tileInner ${a} must be divisible by workgroupSize[1] ${r[1]}. colPerThread ${e[0]} must be 4.`);return`\nvar<workgroup> mm_Asub: array<array<vec${u}<${t}>, ${_/u}>, ${d}>;\nvar<workgroup> mm_Bsub: array<array<vec4<${t}>, ${c/e[0]}>, ${a}>;\n\nconst rowPerThread = ${e[1]};\nconst colPerThread = ${e[0]};\nconst innerElementSize = ${u};\nconst tileInner = ${a};\n\n@compute @workgroup_size(${r[0]}, ${r[1]}, ${r[2]})\nfn main(@builtin(local_invocation_id) localId : vec3<u32>,\n        @builtin(global_invocation_id) globalId : vec3<u32>,\n        @builtin(workgroup_id) workgroupId : vec3<u32>) {\n  let localRow = i32(localId.y);\n  let tileRow = localRow * rowPerThread;\n  let tileCol = i32(localId.x);\n\n  let globalRow =i32(globalId.y) * rowPerThread;\n  let globalCol = i32(globalId.x);\n  let batch = ${n?"0":"i32(globalId.z)"};\n  ${s?`let batchIndices = ${s.offsetToIndices("u32(batch)")};`:""}\n  let globalRowStart = i32(workgroupId.y) * ${l};\n\n  let num_tiles = ${n?`${Math.ceil(i/a)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};\n  var kStart = ${n?`i32(globalId.z) * ${i}`:"0"};\n\n  var acc: array<vec4<${t}>, rowPerThread>;\n\n  // Loop over shared dimension.\n  let tileRowB = localRow * ${f};\n  for (var t = 0; t < num_tiles; t = t + 1) {\n      // Load one tile of A into local memory.\n      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n          let inputRow = tileRow + innerRow;\n          let inputCol = tileCol;\n          ${pM(o,s)}\n      }\n\n      // Load one tile of B into local memory.\n      for (var innerRow = 0; innerRow < ${f}; innerRow = innerRow + 1) {\n          let inputRow = tileRowB + innerRow;\n          let inputCol = tileCol;\n          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${s?", batchIndices":""});\n      }\n      kStart = kStart + tileInner;\n      workgroupBarrier();\n\n      // Compute acc values for a single thread.\n      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {\n          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];\n          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];\n          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];\n          ${u===3?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}\n\n          ${mM(o,u)}\n      }\n\n      workgroupBarrier();\n  }\n\n  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);\n  }\n}`},Oc=(e,r)=>e?`\n            mm_Asub[inputRow][inputCol] = mm_readA(batch,\n              kStart + inputRow,\n              globalRowStart + inputCol${r?", batchIndices":""});\n            `:`\n            mm_Asub[inputRow][inputCol] = mm_readA(batch,\n              globalRowStart + inputRow,\n              kStart + inputCol${r?", batchIndices":""});\n            `,hM=e=>e?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",vd=(e,r,t="f32",s,o=!1,a=32,n=!1,i=32,l=!1)=>{let c=e[1]*r[1],_=e[0]*r[0],d=o?c:a,u=o?a:c;if(!(u%r[1]===0&&d%r[0]===0&&a%r[1]===0))throw new Error(`tileAHight ${u} must be divisible by workgroupSize[1]${r[1]}, tileAWidth ${d} must be divisible by workgroupSize[0]${r[0]}, tileInner ${a} must be divisible by workgroupSize[1]${r[1]}`);let f=u/r[1],h=d/r[0],v=a/r[1],E=l?`\n    let localRow = i32(localId.y);\n    let localCol = i32(localId.x);\n    let globalRowStart = i32(workgroupId.y) * ${c};\n    let globalColStart = i32(workgroupId.x) * ${_};\n\n    // Loop over shared dimension.\n    for (var t = 0; t < num_tiles; t = t + 1) {\n      // Load one tile of A into local memory.\n      for (var inputRow = localRow; inputRow < ${u}; inputRow = inputRow + ${r[1]}) {\n        for (var inputCol = localCol; inputCol < ${d}; inputCol = inputCol + ${r[0]}) {\n          ${Oc(o,s)}\n        }\n      }\n      // Load one tile of B into local memory.\n      for (var inputRow = localRow; inputRow < ${a}; inputRow = inputRow + ${r[1]}) {\n            for (var inputCol = localCol; inputCol < ${_}; inputCol = inputCol + ${r[0]}) {\n          mm_Bsub[inputRow][inputCol] = mm_readB(batch,\n            kStart + inputRow,\n            globalColStart + inputCol${s?", batchIndices":""});\n        }\n      }\n      kStart = kStart + tileInner;\n      workgroupBarrier();\n\n      // Compute acc values for a single thread.\n      var BCached : array<${t}, colPerThread>;\n      for (var k = 0; k < tileInner; k = k + 1) {\n        for (var inner = 0; inner < colPerThread; inner = inner + 1) {\n          BCached[inner] = mm_Bsub[k][localCol + inner * ${r[0]}];\n        }\n        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n          let ACached = ${o?`mm_Asub[k][localRow + innerRow * ${r[1]}];`:`mm_Asub[localRow + innerRow * ${r[1]}][k];`}\n          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n            acc[innerRow][innerCol] = acc[innerRow][innerCol] +\n                ACached * BCached[innerCol];\n          }\n        }\n      }\n      workgroupBarrier();\n    }\n    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n      let gRow = globalRowStart + localRow + innerRow * ${r[1]};\n      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n        let gCol = globalColStart + localCol + innerCol * ${r[0]};\n        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);\n      }\n    }\n    `:`\nlet tileRow = i32(localId.y) * rowPerThread;\nlet tileCol = i32(localId.x) * colPerThread;\n\nlet globalRow = i32(globalId.y) * rowPerThread;\nlet globalCol = i32(globalId.x) * colPerThread;\nlet globalRowStart = i32(workgroupId.y) * ${c};\n\nlet tileRowA = i32(localId.y) * ${f};\nlet tileColA = i32(localId.x) * ${h};\nlet tileRowB = i32(localId.y) * ${v};\n// Loop over shared dimension.\nfor (var t = 0; t < num_tiles; t = t + 1) {\n  // Load one tile of A into local memory.\n  for (var innerRow = 0; innerRow < ${f}; innerRow = innerRow + 1) {\n    for (var innerCol = 0; innerCol < ${h}; innerCol = innerCol + 1) {\n      let inputRow = tileRowA + innerRow;\n      let inputCol = tileColA + innerCol;\n      ${Oc(o,s)}\n    }\n  }\n\n  // Load one tile of B into local memory.\n  for (var innerRow = 0; innerRow < ${v}; innerRow = innerRow + 1) {\n    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n      let inputRow = tileRowB + innerRow;\n      let inputCol = tileCol + innerCol;\n      mm_Bsub[inputRow][inputCol] = mm_readB(batch,\n        kStart + inputRow,\n        globalCol + innerCol${s?", batchIndices":""});\n    }\n  }\n  kStart = kStart + tileInner;\n  workgroupBarrier();\n\n  // Compute acc values for a single thread.\n  var BCached : array<${t}, colPerThread>;\n  for (var k = 0; k < tileInner; k = k + 1) {\n    for (var inner = 0; inner < colPerThread; inner = inner + 1) {\n      BCached[inner] = mm_Bsub[k][tileCol + inner];\n    }\n\n    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n      ${hM(o)}\n      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];\n      }\n    }\n  }\n\n  workgroupBarrier();\n}\n\nfor (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n    mm_write(batch, globalRow + innerRow, globalCol + innerCol,\n        acc[innerRow][innerCol]);\n  }\n}\n`;return`\n  var<workgroup> mm_Asub : array<array<${t}, ${d}>, ${u}>;\n  var<workgroup> mm_Bsub : array<array<${t}, ${_}>, ${a}>;\n  const rowPerThread = ${e[1]};\n  const colPerThread = ${e[0]};\n  const tileInner = ${a};\n\n@compute @workgroup_size(${r[0]}, ${r[1]}, ${r[2]})\nfn main(@builtin(local_invocation_id) localId : vec3<u32>,\n        @builtin(global_invocation_id) globalId : vec3<u32>,\n        @builtin(workgroup_id) workgroupId : vec3<u32>) {\n    let batch = ${n?"0":"i32(globalId.z)"};\n    ${s?`let batchIndices = ${s.offsetToIndices("u32(batch)")};`:""}\n    let num_tiles = ${n?`${Math.ceil(i/a)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};\n    var kStart = ${n?`i32(globalId.z) * ${i}`:"0"};\n\n    var acc : array<array<${t}, colPerThread>, rowPerThread>;\n    ${E}\n  }\n`},fM=(e,r,t,s,o=!1)=>{let[a,n,i,l]=s,c=Ar(s[0].type.tensor);return`\n    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${a.type.indices}) -> ${Nr(e,c)} {\n      var value = ${Nr(e,c)}(0.0);\n      let col = colIn * ${e};\n      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)\n      {\n        var aIndices: ${n.type.indices};\n        ${mn("aIndices",n,n.rank-2,a.rank,"batchIndices")}\n        ${n.indicesSet("aIndices",n.rank-2,"u32(row)")}\n        ${n.indicesSet("aIndices",n.rank-1,"u32(colIn)")}\n        value = ${n.getByIndices("aIndices")};\n      }\n      return value;\n    }\n\n    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${a.type.indices}) -> ${Nr(e,c)} {\n      var value = ${Nr(e,c)}(0.0);\n      let col = colIn * ${e};\n      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)\n      {\n        var bIndices: ${i.type.indices};\n        ${mn("bIndices",i,i.rank-2,a.rank,"batchIndices")}\n        ${i.indicesSet("bIndices",i.rank-2,"u32(row)")}\n        ${i.indicesSet("bIndices",i.rank-1,"u32(colIn)")}\n        value = ${i.getByIndices("bIndices")};\n      }\n      return value;\n    }\n\n    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${Nr(e,c)}) {\n      let col = colIn * ${e};\n      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {\n        var value = valueIn;\n        let coords = vec3<i32>(batch, row, colIn);\n        ${r?`value = value + ${o?"bias[colIn]":`${Nr(e,c)}(bias[row])`};`:""}\n        ${t}\n        ${l.setByIndices("vec3<u32>(coords)","value")}\n      }\n    }\n    `},ji=(e,r,t,s,o=!1,a)=>{let n=e[0].dims,i=e[1].dims,l=n.slice(0,-2),c=i.slice(0,-2),_=s?s.slice(0,-2):t.slice(0,-2),d=we.size(_),u=n[n.length-2],f=n[n.length-1],h=i[i.length-1],v=f%4===0&&h%4===0,E=u<=8?[4,1,1]:[4,4,1],M=[8,8,1],w=[Math.ceil(h/M[0]/E[0]),Math.ceil(u/M[1]/E[1]),Math.ceil(d/M[2]/E[2])],C=v?4:1,x=[...l,u,f/C],T=x.length,S=[...c,f,h/C],g=S.length,P=[d,u,h/C],$=[{type:6,data:u},{type:6,data:h},{type:6,data:f}];Na(r,$),$.push(...pt(_,x,S));let A=["rank","rank"],N=e.length>2;N&&($.push(...pt(e[2].dims)),A.push("rank")),$.push(...pt(P));let W=R=>{let J=_.length,H=jd("batchDims",e[0].dataType,J,1),q=Ar(e[0].dataType),X=Ee("a",e[0].dataType,T,C),ae=Ee("b",e[1].dataType,g,C),ce=nt("result",e[0].dataType,P.length,C),he=[X,ae];if(N){let me=o?C:1;he.push(Ee("bias",e[2].dataType,e[2].dims.length,me))}let B=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];ja(r,B);let D=Ar(ce.type.tensor),K=Ra(r,ce.type.value,D),re=fM(C,N,K,[H,X,ae,ce],o);return`\n  ${R.registerUniforms(B).registerInternalVariables(H).declareVariables(...he,ce)}\n  ${re}\n  ${v?bd(E,M,q,H):vd(E,M,q,H)}\n                   `};return{name:"MatMul",shaderCache:{hint:`${E};${r.activation};${v};${o}`,inputDependencies:A},getRunData:()=>({outputs:[{dims:a?a(t):t,dataType:e[0].dataType}],dispatchGroup:{x:w[0],y:w[1],z:w[2]},programUniforms:$}),getShaderSource:W}}}),LT=Ve(()=>{"use strict";bt(),Qs(),$t(),Wa(),Kd(),OT(),Qd(),gM=(e,r,t,s,o=!1,a,n=4,i=4,l=4,c="f32")=>{let _=$=>{switch($){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${c}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${$} is not supported.`)}},d=$=>{switch($){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${$} is not supported.`)}},u=e?`\n    let coord = vec4<i32>(batch, xRow, xCol, xCh);\n    `:`\n    let coord = vec4<i32>(batch, xCh, xRow, xCol);\n    `,f=e?`\n    let coords = vec4<i32>(\n      batch,\n      row / outWidth,\n      row % outWidth,\n      col);\n    `:`\n    let coords = vec4<i32>(\n      batch,\n      row,\n      col / outWidth,\n      col % outWidth);\n    `,h=e?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",v=e?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",E=e?"row":"col",M=e?"col":"row",w=`\n    let inChannels = i32(uniforms.w_shape[2]);\n    let outWidth = ${e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};\n    let outRow = ${E} / outWidth;\n    let outCol = ${E} % outWidth;\n\n    let WRow = ${M} / (i32(uniforms.w_shape[1]) * inChannels);\n    let WCol = ${M} / inChannels % i32(uniforms.w_shape[1]);\n    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];\n    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];\n    let xCh = ${M} % inChannels;\n    var resData = ${Nr(n,c)}(0.0);\n    // The bounds checking is always needed since we use it to pad zero for\n    // the \'same\' padding type.\n    if (xRow >= 0 && xRow < ${h} && xCol >= 0 && xCol < ${v}) {\n      ${u}\n      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));\n      ${_(n)}\n    }\n    return resData;`,C=e?r&&s?`\n    let col = colIn * ${n};\n    ${w}`:`\n    let col = colIn * ${n};\n    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {\n      ${w}\n    }\n    return ${Nr(n,c)}(0.0);`:s&&t?`\n    let col = colIn * ${n};\n    ${w}`:`\n    let col = colIn * ${n};\n    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {\n      ${w}\n    }\n    return ${Nr(n,c)}(0.0);`,x=e?s&&t?d(i):`\n    let col = colIn * ${i};\n    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {\n      ${d(i)}\n    }\n    return ${Nr(i,c)}(0.0);`:`\n    let col = colIn * ${i};\n    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {\n      ${d(i)}\n    }\n    return ${Nr(i,c)}(0.0);`,T=Nr(l,c),S=Nr(e?n:i,c),g=Nr(e?i:n,c),P=Ra(a,T,c);return`\n    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${S} {\n      ${e?C:x}\n    }\n\n    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${g} {\n      ${e?x:C}\n    }\n\n    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${T}) {\n      let col = colIn * ${l};\n      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)\n      {\n      var value = valueIn;\n      let outWidth = ${e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};\n      ${f}\n      ${Cx(o)}\n      ${P}\n      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);\n      }\n    }`},Ix=(e,r,t,s,o,a,n,i,l)=>{let c=r.format==="NHWC",_=c?e[0].dims[3]:e[0].dims[1],d=t[0],u=c?t[2]:t[3],f=c?t[1]:t[2],h=c?t[3]:t[1],v=c&&(_%4===0||_%3===0)&&h%4===0,E=c?h:u*f,M=c?u*f:h,w=[8,8,1],C=s<=8?[4,1,1]:[4,4,1],x=[Math.ceil(E/w[0]/C[0]),Math.ceil(M/w[1]/C[1]),Math.ceil(d/w[2]/C[2])];jt("verbose",()=>`[conv2d_mm_webgpu] dispatch = ${x}`);let T=v?c&&_%4!==0?3:4:1,S=w[1]*C[1],g=w[0]*C[0],P=Math.max(w[0]*T,w[1]),$=s%S===0,A=o%g===0,N=a%P===0,W=v?[T,4,4]:[1,1,1],R=[{type:6,data:s},{type:6,data:o},{type:6,data:a},{type:6,data:[r.pads[0],r.pads[1]]},{type:6,data:r.strides},{type:6,data:r.dilations}];Na(r,R),R.push(...pt(e[0].dims,e[1].dims));let J=["rank","rank"];n&&(R.push(...pt(e[2].dims)),J.push("rank")),R.push(...pt(t));let H=q=>{let X=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];ja(r,X);let ae=v?4:1,ce=Ar(e[0].dataType),he=`\n      fn setOutputAtIndex(flatIndex : i32, value : ${v?`vec4<${ce}>`:ce}) {\n        result[flatIndex] = ${v?`vec4<${ce}>`:ce}(value);\n      }\n      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${v?`vec4<${ce}>`:ce}) {\n        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));\n        setOutputAtIndex(flatIndex ${v?"/ 4":""}, value);\n      }`,B=Ee("x",e[0].dataType,e[0].dims.length,T===3?1:T),D=Ee("w",e[1].dataType,e[1].dims.length,ae),K=[B,D],re=nt("result",e[0].dataType,t.length,ae);if(n){let me=Ee("bias",e[2].dataType,e[2].dims.length,ae);K.push(me),he+=`\n        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${v?`vec4<${ce}>`:ce} {\n          return bias[coords.${c?"w":"y"}${v?"/ 4":""}];\n        }`}return`\n        ${Sx("uniforms.result_strides")}\n        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,\n        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,\n        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };\n        ${q.registerUniforms(X).declareVariables(...K,re)}\n        ${he}\n        ${gM(c,$,A,N,n,r,W[0],W[1],W[2],ce)}\n        ${v?bd(C,w,ce,void 0,!c,P):vd(C,w,ce,void 0,!c,P,!1,void 0,i)}`};return{name:"Conv2DMatMul",shaderCache:{hint:`${r.cacheKey};${T};${v};${$};${A};${N};${S};${g};${P}`,inputDependencies:J},getRunData:()=>({outputs:[{dims:l?l(t):t,dataType:e[0].dataType}],dispatchGroup:{x:x[0],y:x[1],z:x[2]},programUniforms:R}),getShaderSource:H}}}),zT=Ve(()=>{"use strict";bt(),Qs(),St(),$t(),Wa(),Kd(),MM=e=>{let r=1;for(let t=0;t<e.length;t++)r*=e[t];return r},Lc=e=>typeof e=="number"?[e,e,e]:e,sn=(e,r)=>r<=1?e:e+(e-1)*(r-1),wM=(e,r,t,s=1)=>{let o=sn(r,s);return Math.floor((e[0]*(t-1)-t+o)/2)},zc=(e,r,t,s,o)=>{o==null&&(o=wM(e,r[0],s[0]));let a=[0,0,0,t];for(let n=0;n<3;n++)e[n]+2*o>=r[n]&&(a[n]=Math.trunc((e[n]-r[n]+2*o)/s[n]+1));return a},bM=(e,r,t,s,o,a,n,i,l,c)=>{let _,d,u,f;if(e==="VALID"&&(e=0),typeof e=="number"){_={top:e,bottom:e,left:e,right:e,front:e,back:e};let h=zc([r,t,s,1],[i,l,c],1,[o,a,n],e);d=h[0],u=h[1],f=h[2]}else if(Array.isArray(e)){if(!e.every((v,E,M)=>v===M[0]))throw Error(`Unsupported padding parameter: ${e}`);_={top:e[0],bottom:e[1],left:e[2],right:e[3],front:e[4],back:e[5]};let h=zc([r,t,s,1],[i,l,c],1,[o,a,n],e[0]);d=h[0],u=h[1],f=h[2]}else if(e==="SAME_UPPER"){d=Math.ceil(r/o),u=Math.ceil(t/a),f=Math.ceil(s/n);let h=(d-1)*o+i-r,v=(u-1)*a+l-t,E=(f-1)*n+c-s,M=Math.floor(h/2),w=h-M,C=Math.floor(v/2),x=v-C,T=Math.floor(E/2),S=E-T;_={top:C,bottom:x,left:T,right:S,front:M,back:w}}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:_,outDepth:d,outHeight:u,outWidth:f}},Fx=(e,r,t,s,o,a=!1,n="channelsLast")=>{let i,l,c,_,d;if(n==="channelsLast")[i,l,c,_,d]=e;else if(n==="channelsFirst")[i,d,l,c,_]=e;else throw new Error(`Unknown dataFormat ${n}`);let[u,,f,h,v]=r,[E,M,w]=Lc(t),[C,x,T]=Lc(s),S=sn(f,C),g=sn(h,x),P=sn(v,T),{padInfo:$,outDepth:A,outHeight:N,outWidth:W}=bM(o,l,c,_,E,M,w,S,g,P),R=a?u*d:u,J=[0,0,0,0,0];return n==="channelsFirst"?J=[i,R,A,N,W]:n==="channelsLast"&&(J=[i,A,N,W,R]),{batchSize:i,dataFormat:n,inDepth:l,inHeight:c,inWidth:_,inChannels:d,outDepth:A,outHeight:N,outWidth:W,outChannels:R,padInfo:$,strideDepth:E,strideHeight:M,strideWidth:w,filterDepth:f,filterHeight:h,filterWidth:v,effectiveFilterDepth:S,effectiveFilterHeight:g,effectiveFilterWidth:P,dilationDepth:C,dilationHeight:x,dilationWidth:T,inShape:e,outShape:J,filterShape:r}},$x=(e,r,t,s,o,a)=>{let n=a==="channelsLast",i=n?e[0].dims[3]:e[0].dims[1],l=!1,c=[64,1,1],_={x:t.map((w,C)=>C)},d=[Math.ceil(MM(_.x.map(w=>t[w]))/c[0]),1,1];jt("verbose",()=>`[conv3d_naive_webgpu] dispatch = ${d}`);let u=l?n&&i%4!==0?3:4:1,f=we.size(t),h=[{type:12,data:f},{type:12,data:s},{type:12,data:o},{type:12,data:r.strides},{type:12,data:r.dilations}];Na(r,h),h.push(...pt(e[0].dims,e[1].dims));let v=["rank","rank"],E=e.length===3;E&&(h.push(...pt(e[2].dims)),v.push("rank")),h.push(...pt(t));let M=w=>{let C=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:s.length},{name:"pads",type:"u32",length:o.length},{name:"strides",type:"u32",length:r.strides.length},{name:"dilations",type:"u32",length:r.dilations.length}];ja(r,C);let x=l?4:1,T=Ar(e[0].dataType),S=Ee("x",e[0].dataType,e[0].dims.length,u===3?1:u),g=Ee("W",e[1].dataType,e[1].dims.length,x),P=[S,g],$=nt("result",e[0].dataType,t.length,x),A="";if(E){let R=Ee("bias",e[2].dataType,e[2].dims.length,x);P.push(R),A+=`\n        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ${l?`vec4<${T}>`:T} {\n          return bias[${n?ct("coords",4,5):ct("coords",1,5)}${l?"/ 4":""}];\n        }`}let N=Nr(u,T),W=Ra(r,N,T);return`\n            ${A}\n            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {\n              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);\n              return ${S.getByIndices("aIndices")};\n            }\n            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {\n              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);\n              return ${g.getByIndices("aIndices")};\n            }\n          ${w.registerUniforms(C).declareVariables(...P,$)}\n          ${w.mainStart()}\n          ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n              let coords = ${$.offsetToIndices("global_idx")};\n              let batch = ${ct("coords",0,S.rank)};\n              let d2 = ${n?ct("coords",S.rank-1,S.rank):ct("coords",1,S.rank)};\n              let xFRCCorner = vec3<u32>(${n?ct("coords",1,S.rank):ct("coords",2,S.rank)},\n              ${n?ct("coords",2,S.rank):ct("coords",3,S.rank)},\n              ${n?ct("coords",3,S.rank):ct("coords",4,S.rank)}) * uniforms.strides - uniforms.pads;\n              let xFCorner = xFRCCorner.x;\n              let xRCorner = xFRCCorner.y;\n              let xCCorner = xFRCCorner.z;\n              let xShapeY = ${n?ct("uniforms.x_shape",1,S.rank):ct("uniforms.x_shape",2,S.rank)};\n              let xShapeZ = ${n?ct("uniforms.x_shape",2,S.rank):ct("uniforms.x_shape",3,S.rank)};\n              let xShapeW = ${n?ct("uniforms.x_shape",3,S.rank):ct("uniforms.x_shape",4,S.rank)};\n              let xShapeU = ${n?ct("uniforms.x_shape",4,S.rank):ct("uniforms.x_shape",1,S.rank)};\n              let inputDepthNearestVec4 = (xShapeU / 4) * 4;\n              let inputDepthVec4Remainder = xShapeU % 4;\n\n              var value = 0.0;\n              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {\n                let xF = xFCorner + wF * uniforms.dilations[0];\n                if (xF < 0 || xF >= xShapeY) {\n                  continue;\n                }\n\n                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {\n                  let xR = xRCorner + wR * uniforms.dilations[1];\n                  if (xR < 0 || xR >= xShapeZ) {\n                    continue;\n                  }\n\n                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {\n                    let xC = xCCorner + wC * uniforms.dilations[2];\n                    if (xC < 0 || xC >= xShapeW) {\n                      continue;\n                    }\n\n                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {\n                      ${n?`let xValues = vec4<f32>(\n                               getX(batch, xF, xR, xC, d1),\n                               getX(batch, xF, xR, xC, d1 + 1),\n                               getX(batch, xF, xR, xC, d1 + 2),\n                               getX(batch, xF, xR, xC, d1 + 3));\n                            `:`let xValues = vec4<f32>(\n                               getX(batch, d1, xF, xR, xC),\n                               getX(batch, d1 + 1, xF, xR, xC),\n                               getX(batch, d1 + 2, xF, xR, xC),\n                               getX(batch, d1 + 3, xF, xR, xC));\n                            `}\n                            let wValues = vec4<f32>(\n                              getW(d2, d1, wF, wR, wC),\n                              getW(d2, d1 + 1, wF, wR, wC),\n                              getW(d2, d1 + 2, wF, wR, wC),\n                              getW(d2, d1 + 3, wF, wR, wC));\n                      value += dot(xValues, wValues);\n                    }\n                    if (inputDepthVec4Remainder == 1) {\n                        ${n?`value += getX(batch, xF, xR, xC, inputDepthNearestVec4)\n                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`:`value += getX(batch, inputDepthNearestVec4, xF, xR, xC)\n                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`}\n                    } else if (inputDepthVec4Remainder == 2) {\n                      ${n?`let xValues = vec2<f32>(\n                        getX(batch, xF, xR, xC, inputDepthNearestVec4),\n                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));\n                      `:`let xValues = vec2<f32>(\n                        getX(batch, inputDepthNearestVec4, xF, xR, xC),\n                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));\n                    `}\n                    let wValues = vec2<f32>(\n                      getW(d2, inputDepthNearestVec4, wF, wR, wC),\n                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));\n                      value += dot(xValues, wValues);\n                    } else if (inputDepthVec4Remainder == 3) {\n                      ${n?`let xValues = vec3<f32>(\n                        getX(batch, xF, xR, xC, inputDepthNearestVec4),\n                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),\n                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));\n                      `:`let xValues = vec3<f32>(\n                        getX(batch, inputDepthNearestVec4, xF, xR, xC),\n                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),\n                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));\n                    `}\n                    let wValues = vec3<f32>(\n                      getW(d2, inputDepthNearestVec4, wF, wR, wC),\n                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),\n                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));\n                      value += dot(xValues, wValues);\n                    }\n                  }\n                }\n              }\n              ${E?"value = value + getBiasByOutputCoords(coords)":""};\n              ${W}\n              result[global_idx] = f32(value);\n          }`};return{name:"Conv3DNaive",shaderCache:{hint:`${r.cacheKey};${n};${u};${E}`,inputDependencies:v},getRunData:()=>({outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:d[0],y:d[1],z:d[2]},programUniforms:h}),getShaderSource:M}}}),BT=Ve(()=>{"use strict";bt(),St(),$t(),Wa(),Ax=(e,r,t,s)=>{let o=e.length>2,a=o?"value += b[output_channel];":"",n=e[0].dims,i=e[1].dims,l=r.format==="NHWC",c=l?t[3]:t[1],_=c/r.group,d=l&&_>=4?pr(c):1,u=we.size(t)/d,f=[{type:12,data:u},{type:12,data:r.dilations},{type:12,data:[r.strides[0],r.strides[1]]},{type:12,data:[r.pads[0],r.pads[1]]},{type:12,data:_}];Na(r,f),f.push(...pt(n,[i[0],i[1],i[2],i[3]/d]));let h=o?["rank","rank","rank"]:["rank","rank"];f.push(...pt([t[0],t[1],t[2],t[3]/d]));let v=E=>{let M=nt("output",e[0].dataType,t.length,d),w=Ar(M.type.tensor),C=Ra(r,M.type.value,w),x=Ee("x",e[0].dataType,n.length),T=Ee("w",e[1].dataType,i.length,d),S=[x,T];o&&S.push(Ee("b",e[2].dataType,e[2].dims,d));let g=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:r.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];ja(r,g);let P=l?`\n      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {\n        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];\n\n        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {\n          continue;\n        }\n\n        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {\n          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];\n          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {\n            continue;\n          }\n\n          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {\n            let input_channel = in_channel_offset + wInChannel;\n            let xVal = ${x.get("batch","xHeight","xWidth","input_channel")};\n            let wVal = ${T.get("wHeight","wWidth","wInChannel","output_channel")};\n            value += xVal * wVal;\n          }\n        }\n      }\n      `:`\n      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {\n        let input_channel = in_channel_offset + wInChannel;\n        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {\n          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];\n\n          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {\n            continue;\n          }\n\n          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {\n            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];\n            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {\n              continue;\n            }\n\n            let xVal = ${x.get("batch","input_channel","xHeight","xWidth")};\n            let wVal = ${T.get("output_channel","wInChannel","wHeight","wWidth")};\n            value += xVal * wVal;\n          }\n        }\n      }\n      `;return`\n  ${E.registerUniforms(g).declareVariables(...S,M)}\n\n  ${E.mainStart()}\n    ${E.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n\n    let outputIndices = ${M.offsetToIndices("global_idx")};\n    let batch: u32 = outputIndices[0];\n    let output_channel: u32 = outputIndices[${l?3:1}];\n    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${l?1:2}], outputIndices[${l?2:3}]) * uniforms.strides - uniforms.pads;\n    let group_id: u32 = output_channel * ${d} / uniforms.output_channels_per_group;\n    var in_channel_offset = group_id * uniforms.w_shape[${l?2:1}];\n\n    var value: ${M.type.value} = ${M.type.value}(0);\n    ${P}\n    ${a}\n    ${C}\n    ${M.setByOffset("global_idx","value")}\n  }`};return{name:"GroupedConv",shaderCache:{hint:`${r.cacheKey}_${d}`,inputDependencies:h},getRunData:()=>({outputs:[{dims:s?s(t):t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:f}),getShaderSource:v}},Dx=(e,r,t,s)=>{let o=e.length>2,a=pr(t[3]),n=pr(t[2]),i=we.size(t)/a/n,l=[e[0].dims[0],e[0].dims[1],e[0].dims[2],e[0].dims[3]/a],c=[e[1].dims[0],e[1].dims[1],e[1].dims[2],e[1].dims[3]/a],_=[t[0],t[1],t[2],t[3]/a],d=[{type:12,data:i},{type:6,data:[r.strides[0],r.strides[1]]},{type:6,data:[r.pads[0],r.pads[1]]}];Na(r,d),d.push(...pt(l,c,_));let u=(n-1)*r.strides[1]+c[1],f=h=>{let v=nt("output",e[0].dataType,_.length,a),E=Ar(v.type.tensor),M=Ra(r,v.type.value,E),w=Ee("x",e[0].dataType,l.length,a),C=Ee("w",e[1].dataType,c.length,a),x=[w,C];o&&x.push(Ee("b",e[2].dataType,e[2].dims,a));let T=o?"value += b[output_channel];":"",S=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return ja(r,S),`\n  ${h.registerUniforms(S).declareVariables(...x,v)}\n  ${h.mainStart()}\n    ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n    let width0 = uniforms.output_shape[3];\n    let output_channel = global_idx % width0;\n    var index1 = global_idx / width0;\n    let width1 = uniforms.output_shape[2] / ${n}u;\n    let col = (index1 % width1) * ${n}u;\n    index1 = index1 / width1;\n    let row = index1 % uniforms.output_shape[1];\n    let batch = index1 / uniforms.output_shape[1];\n\n    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;\n\n    var x_vals: array<${w.type.value}, ${u}>;\n    var values: array<${v.type.value}, ${n}>;\n    let input_channel = output_channel;\n    // Use constant instead of uniform can give better performance for w\'s height/width.\n    for (var w_height: u32 = 0u; w_height < ${c[0]}; w_height++) {\n      let x_height = x_corner.x + i32(w_height);\n      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {\n        for (var i = 0; i < ${u}; i++) {\n          let x_width = x_corner.y + i;\n          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {\n            x_vals[i] = ${w.get("batch","u32(x_height)","u32(x_width)","input_channel")};\n          } else {\n            x_vals[i] = ${w.type.value}(0);\n          }\n        }\n        for (var w_width: u32 = 0u; w_width < ${c[1]}; w_width++) {\n          let w_val = ${C.get("w_height","w_width","0","output_channel")};\n          for (var i = 0u; i < ${n}u; i++) {\n            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);\n          }\n        }\n      }\n    }\n\n    for (var i = 0u; i < ${n}u; i++) {\n      var value = values[i];\n      ${T}\n      ${M}\n      ${v.set("batch","row","col + i","output_channel","value")};\n    }\n  }`};return{name:"GroupedConv-Vectorize",shaderCache:{hint:`${r.cacheKey};${a};${n};${u};${c[0]};${c[1]}`,inputDependencies:o?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:s?s(t):t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:d}),getShaderSource:f}}}),RT=Ve(()=>{"use strict";St(),LT(),zT(),Qd(),BT(),Wa(),qd(),ca(),vM=(e,r,t,s,o,a)=>{let n=e[0],i=e.slice(a?1:2,a?3:4),l=i.length,c=r[0],_=r.slice(2).map((u,f)=>u+(u-1)*(t[f]-1)),d=i.map((u,f)=>u+s[f]+s[f+l]).map((u,f)=>Math.floor((u-_[f]+o[f])/o[f]));return d.splice(0,0,n),d.splice(a?3:1,0,c),d},Si=[2,3,1,0],xM=(e,r)=>{if(!e||e.length!==2&&e.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(e[0].dims.length>5)throw new Error("greater than 5D is not supported");if(e[0].dims.length!==e[1].dims.length)throw new Error("filter does not have same dimension as input");let t=e[0].dims[r.format==="NHWC"?e[0].dims.length-1:1],s=e[1].dims[1]*r.group;if(t!==s)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(e.length===3&&(e[2].dims.length!==1||e[1].dims[0]!==e[2].dims[0]))throw new Error("invalid bias");let o=e[0].dims.length-2;if(r.dilations.length!==o)throw new Error(`dilations should be ${o}D`);if(r.strides.length!==o)throw new Error(`strides should be ${o}D`);if(r.pads.length!==o*2)throw new Error(`pads should be ${o*2}D`);if(r.kernelShape.length!==0&&r.kernelShape.length!==e[1].dims.length-2)throw new Error("invalid kernel shape")},Ii=(e,r)=>{let t=e.kernelShape.slice();t.length<r[1].dims.length-2&&t.push(...Array(r[1].dims.length-2-t.length).fill(0));for(let a=2;a<r[1].dims.length;++a)t[a-2]===0&&(t[a-2]=r[1].dims[a]);let s=e.pads.slice();Ri.adjustPadsBasedOnAutoPad(r[0].dims,e.strides,e.dilations,t,s,e.format==="NHWC",e.autoPad);let o=Object.assign({},e);return Object.assign(o,{kernelShape:t,pads:s}),o},xd=e=>{let r=Gd(e),t=e.format,s=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][e.auto_pad],o=e.dilations,a=e.group,n=e.kernel_shape,i=e.pads,l=e.strides,c=e.w_is_const();return Ct(Fe({autoPad:s,format:t,dilations:o,group:a,kernelShape:n,pads:i,strides:l,wIsConst:c},r),{cacheKey:`${e.format};${r.activation};`})},Bc=(e,r,t,s)=>{var S,g,P;let o=t.format==="NHWC",a=vM(r[0].dims,r[1].dims,t.dilations,t.pads,t.strides,o);if(t.group!==1){let $=[r[0]];if(o){let A=(S=e.kernelCustomData.wT)!=null?S:e.compute(_s(r[1],Si),{inputs:[1],outputs:[t.wIsConst?-2:-1]})[0];t.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=A),$.push(A)}else $.push(r[1]);r.length===3&&$.push(r[2]),!e.adapterInfo.isArchitecture("ampere")&&o&&r[1].dims[0]===t.group&&r[1].dims[1]===1&&t.dilations[0]===1&&t.dilations[1]===1?e.compute(Dx($,t,a,s),{inputs:$}):e.compute(Ax($,t,a,s),{inputs:$});return}let n=r.length===3,i=r[0].dims[o?1:2],l=r[0].dims[o?2:3],c=r[0].dims[o?3:1],_=r[1].dims[2],d=r[1].dims[3],u=a[o?1:2],f=a[o?2:3],h=a[o?3:1],v=o&&_===i&&d===l&&t.pads[0]===0&&t.pads[1]===0;if(v||_===1&&d===1&&t.dilations[0]===1&&t.dilations[1]===1&&t.strides[0]===1&&t.strides[1]===1&&t.pads[0]===0&&t.pads[1]===0){let $=a[0],A,N,W,R=[];if(o){let q=(g=e.kernelCustomData.wT)!=null?g:e.compute(_s(r[1],Si),{inputs:[1],outputs:[t.wIsConst?-2:-1]})[0];if(t.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=q),v){let X=i*l*c;A=r[0].reshape([1,$,X]),N=q.reshape([1,X,h]),W=[1,$,h]}else A=r[0].reshape([$,i*l,c]),N=q.reshape([1,c,h]),W=[$,u*f,h];R.push(A),R.push(N)}else A=r[0].reshape([$,c,i*l]),N=r[1].reshape([1,h,c]),W=[$,h,u*f],R.push(N),R.push(A);n&&R.push(r[2]);let J=W[2],H=R[0].dims[R[0].dims.length-1];J<8&&H<8?e.compute(Hd(R,t,a,W,o,s),{inputs:R}):e.compute(ji(R,t,a,W,o,s),{inputs:R});return}let E=!0,M=(P=e.kernelCustomData.wT)!=null?P:e.compute(_s(r[1],Si),{inputs:[1],outputs:[t.wIsConst?-2:-1]})[0];t.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=M);let w=[r[0],M];n&&w.push(r[2]);let C=o?u*f:h,x=o?h:u*f,T=_*d*c;e.compute(Ix(w,t,a,C,x,T,n,E,s),{inputs:w})},yM=(e,r)=>{let t=r.format==="NHWC",s=[e.inputs[0].reshape(t?[e.inputs[0].dims[0],1,e.inputs[0].dims[1],e.inputs[0].dims[2]]:[e.inputs[0].dims[0],e.inputs[0].dims[1],1,e.inputs[0].dims[2]]),e.inputs[1].reshape([e.inputs[1].dims[0],e.inputs[1].dims[1],1,e.inputs[1].dims[2]])];e.inputs.length===3&&s.push(e.inputs[2]);let o=[0,r.pads[0],0,r.pads[1]],a=[1].concat(r.strides),n=[1].concat(r.dilations),i=[1].concat(r.kernelShape),l=Ii(Ct(Fe({},r),{pads:o,strides:a,dilations:n,kernelShape:i}),s);Bc(e,s,l,c=>t?[c[0],c[2],c[3]]:[c[0],c[1],c[3]])},TM=(e,r,t)=>{let s=t.format==="NHWC"?"channelsLast":"channelsFirst",o=Ii(t,r),a=t.autoPad==="NOTSET"?t.pads:t.autoPad,n=Fx(r[0].dims,r[1].dims,t.strides,t.dilations,a,!1,s);e.compute($x(r,o,n.outShape,[n.filterDepth,n.filterHeight,n.filterWidth],[n.padInfo.front,n.padInfo.top,n.padInfo.left],s))},yd=(e,r)=>{if(xM(e.inputs,r),e.inputs[0].dims.length===3)yM(e,r);else if(e.inputs[0].dims.length===5)TM(e,e.inputs,r);else{let t=Ii(r,e.inputs);Bc(e,e.inputs,t)}}}),NT=Ve(()=>{"use strict";bt(),Qs(),St(),$t(),Ox=(e,r,t)=>{let s=e.length>2,o=r.outputShape,a=r.format==="NHWC",n=r.group,i=e[1].dims,l=i[2]/n,c=i[3],_=a?pr(l):1,d=a&&c===1&&l>=4,u=d?Math.floor(l/4)*4:Math.floor(l/_)*_,f=l-u,h=a?pr(c):1,v=a?c===1?_:h:1,E=we.size(o)/h,M=[Math.ceil(E/64),1,1];jt("verbose",()=>`[conv2d_backprop_webgpu] dispatch = ${M}`);let w=["rank","rank"],C=[r.strides[0],r.strides[1]],x=[r.kernelShape[a?1:2],r.kernelShape[a?2:3]],T=[r.dilations[0],r.dilations[1]],S=[x[0]+(r.dilations[0]<=1?0:(r.kernelShape[a?1:2]-1)*(r.dilations[0]-1)),x[1]+(r.dilations[1]<=1?0:(r.kernelShape[a?2:3]-1)*(r.dilations[1]-1))],g=[S[0]-1-Math.floor((r.pads[0]+r.pads[2])/2),S[1]-1-Math.floor((r.pads[1]+r.pads[3])/2)],P=[{type:12,data:E},{type:12,data:C},{type:12,data:x},{type:12,data:T},{type:12,data:S},{type:6,data:g},{type:12,data:u},{type:12,data:l},{type:12,data:c},...pt(e[0].dims,e[1].dims)];s&&(P.push(...pt(e[2].dims)),w.push("rank")),P.push(...pt(o));let $=A=>{let N=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:C.length},{name:"filter_dims",type:"u32",length:x.length},{name:"dilations",type:"u32",length:x.length},{name:"effective_filter_dims",type:"u32",length:S.length},{name:"pads",type:"i32",length:g.length},{name:"input_channels_per_group_int",type:"u32"},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],W=Ar(e[0].dataType),R=a?1:2,J=a?2:3,H=a?3:1,q=Ee("W",e[1].dataType,e[1].dims.length,v),X=Ee("Dy",e[0].dataType,e[0].dims.length,_),ae=[X,q];s&&ae.push(Ee("bias",e[2].dataType,[o[H]].length,h));let ce=nt("result",e[0].dataType,o.length,h),he=()=>{let K="";if(d)_===4?K+=`\n        let xValue = ${X.getByOffset("x_offset")};\n        let wValue = ${q.getByOffset("w_offset")};\n        dotProd = dotProd + dot(xValue, wValue);\n        x_offset += 1u;\n        w_offset += 1u;`:_===2?K+=`\n          dotProd = dotProd + dot(vec4<${W}>(${X.getByOffset("x_offset")}, ${X.getByOffset("x_offset + 1u")}), vec4<${W}>(${q.getByOffset("w_offset")}, ${q.getByOffset("w_offset + 1u")}));\n          x_offset += 2u;\n          w_offset += 2u;`:_===1&&(K+=`\n          dotProd = dotProd + dot(vec4<${W}>(${X.getByOffset("x_offset")}, ${X.getByOffset("x_offset + 1u")}, ${X.getByOffset("x_offset + 2u")}, ${X.getByOffset("x_offset + 3u")}), vec4<${W}>(${q.getByOffset("w_offset")}, ${q.getByOffset("w_offset + 1u")}, ${q.getByOffset("w_offset + 2u")}, ${q.getByOffset("w_offset + 3u")}));\n          x_offset += 4u;\n          w_offset += 4u;`);else if(K+=`\n                  let xValue = ${a?X.getByOffset(`${X.indicesToOffset(`${X.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${_}`):X.get("batch","inputChannel","idyR","idyC")};\n        `,_===1)K+=`\n          let w_offset = ${q.indicesToOffset(`${q.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)};\n          let wValue = ${q.getByOffset(`w_offset / ${v}`)};\n          dotProd = dotProd + xValue * wValue;`;else for(let re=0;re<_;re++)K+=`\n            let wValue${re} = ${q.getByOffset(`${q.indicesToOffset(`${q.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel + ${re}, wOutChannel)`)} / ${v}`)};\n            dotProd = dotProd + xValue[${re}] * wValue${re};`;return K},B=()=>{if(f===0)return"";if(!d)throw new Error(`packInputAs4 ${d} is not true.`);let K="";if(_===1){K+="dotProd = dotProd";for(let re=0;re<f;re++)K+=`\n            + ${X.getByOffset(`x_offset + ${re}`)} * ${q.getByOffset(`w_offset + ${re}`)}`;K+=";"}else if(_===2){if(f!==2)throw new Error(`Invalid inputChannelsRemainder ${f}.`);K+=`\n          let xValue = ${X.getByOffset("x_offset")};\n          let wValue = ${q.getByOffset("w_offset")};\n          dotProd = dotProd + dot(xValue, wValue);`}return K},D=`\n            let outputIndices = ${ce.offsetToIndices(`global_idx * ${h}`)};\n            let batch = ${ce.indicesGet("outputIndices",0)};\n            let d1 = ${ce.indicesGet("outputIndices",H)};\n            let r = ${ce.indicesGet("outputIndices",R)};\n            let c = ${ce.indicesGet("outputIndices",J)};\n            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;\n            let dyRCorner = dyCorner.x;\n            let dyCCorner = dyCorner.y;\n            let groupId = d1 / uniforms.output_channels_per_group;\n            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;\n            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n            // ? = to be determined. : = across all values in that axis.\n            var dotProd = ${ce.type.value}(0.0);\n            var wR: u32 = 0;\n            if (uniforms.dilations.x == 1) {\n              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0\n              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);\n            }\n            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {\n              if (wR % uniforms.dilations.x != 0) {\n                continue;\n              }\n              let dyR = (${W}(dyRCorner) + ${W}(wR)) / ${W}(uniforms.strides[0]);\n              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;\n              if (dyR < 0.0 || dyR >= ${W}(uniforms.Dy_shape[${R}]) || fract(dyR) > 0.0 ||\n                  wRPerm < 0) {\n                continue;\n              }\n              let idyR: u32 = u32(dyR);\n              var wC: u32 = 0;\n              if (uniforms.dilations.y == 1) {\n                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0\n                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);\n              }\n              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {\n                if (wC % uniforms.dilations.y != 0) {\n                  continue;\n                }\n                let dyC = (${W}(dyCCorner) + ${W}(wC)) / ${W}(uniforms.strides.y);\n                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;\n                if (dyC < 0.0 || dyC >= ${W}(uniforms.Dy_shape[${J}]) ||\n                    fract(dyC) > 0.0 || wCPerm < 0) {\n                  continue;\n                }\n                let idyC: u32 = u32(dyC);\n                var inputChannel = groupId * uniforms.input_channels_per_group;\n                ${d?`\n                var x_offset = ${X.indicesToOffset(`${X.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${_};\n                var w_offset = ${q.indicesToOffset(`${q.type.indices}(wRPerm, wCPerm, inputChannel, wOutChannel)`)} / ${v};\n                  `:""}\n                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group_int; d2 = d2 + ${d?4:_}) {\n                  ${he()}\n                  inputChannel = inputChannel + ${d?4:_};\n                }\n                ${B()}\n                wC = wC + uniforms.strides.y - 1;\n              }\n              wR = wR + uniforms.strides[0] - 1;\n            }\n            let value = dotProd${s?` + bias[d1 / ${h}]`:""};\n            ${ce.setByOffset("global_idx","value")};\n          `;return`\n    ${A.registerUniforms(N).declareVariables(...ae,ce)}\n      ${A.mainStart()}\n      ${A.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")};\n    ${D}}`};return{name:"ConvTranspose2D",shaderCache:{hint:`${r.cacheKey};${_}${v}${h}${d}${f}`,inputDependencies:w},getRunData:()=>({dispatchGroup:{x:M[0],y:M[1],z:M[2]},outputs:[{dims:t?t(o):o,dataType:e[0].dataType}],programUniforms:P}),getShaderSource:$}}}),jT=Ve(()=>{"use strict";NT(),Wa(),ca(),PM=(e,r,t,s,o,a)=>(e-1)*r+t+(s-1)*o+1-a,EM=(e,r,t,s,o)=>{let a=Math.floor(e/2);r==="SAME_UPPER"?(t[s]=a,t[o]=e-a):r==="SAME_LOWER"&&(t[s]=e-a,t[o]=a)},kM=(e,r,t,s,o,a,n,i,l,c)=>{let _=e.length-2,d=c.length===0;l.length<_&&l.push(...Array(_-l.length).fill(0));let u=e[0],f=r[i?3:1]*o;for(let h=0,v=e.length-_-(i?1:0);h<_;++h,++v){let E=e[v],M=d?E*n[h]:c[h],w=PM(E,n[h],a[h],r[v],t[h],M);EM(w,s,a,h,h+_),d&&c.push(n[h]*(E-1)+l[h]+(r[v]-1)*t[h]+1-a[h]-a[h+_])}c.splice(0,0,u),c.splice(i?3:1,0,f)},Rc=(e,r)=>{let t=e.kernelShape.slice();if(e.kernelShape.length===0||e.kernelShape.reduce((d,u)=>d*u,1)===0){t.length=0;for(let d=2;d<r[1].dims.length;++d)t.push(r[1].dims[d])}let s=e.format==="NHWC";t.splice(0,0,r[1].dims[0]),t.splice(s?3:1,0,r[1].dims[1]);let o=e.pads.slice(),a=e.outputShape.slice(),n=e.outputPadding.slice(),i=r[0].dims,l=e.dilations.slice();if(l.reduce((d,u)=>d+u,0)===0){let d=r[0].dims.length-2;l=new Array(d).fill(1)}let c=e.strides.slice();if(c.reduce((d,u)=>d+u,0)===0){let d=r[0].dims.length-2;c=new Array(d).fill(1)}kM(i,t,l,e.autoPad,e.group,o,c,s,n,a);let _=Object.assign({},e);return Object.assign(_,{kernelShape:t,pads:o,outputPadding:n,outputShape:a,dilations:l,strides:c}),_},Lx=e=>{let r=Gd(e),t=e.format,s=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof e.autoPad>"u"?0:e.autoPad],o=e.dilations,a=e.group,n=e.kernelShape,i=e.pads,l=e.strides,c=e.wIsConst(),_=e.outputPadding,d=e.outputShape;return Ct(Fe({autoPad:s,format:t,dilations:o,group:a,kernelShape:n,outputPadding:_,outputShape:d,pads:i,strides:l,wIsConst:c},r),{cacheKey:`${e.format};${r.activation};`})},CM=(e,r)=>{if(!e||e.length!==2&&e.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(e[0].dims.length!==4&&e[0].dims.length!==3)throw new Error("currently only support 2-dimensional conv");if(e[0].dims.length!==e[1].dims.length)throw new Error("filter does not have same dimension as input");let t=e[0].dims[r.format==="NHWC"?e[0].dims.length-1:1],s=e[1].dims[0];if(t!==s)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let o=e[1].dims[1]*r.group;if(e.length===3&&(e[2].dims.length!==1||e[2].dims[0]!==o))throw new Error("invalid bias");let a=e[0].dims.length-2;if(r.dilations.reduce((n,i)=>n+i,0)>0&&r.dilations.length!==a)throw new Error(`dilations should be ${a}D`);if(r.strides.reduce((n,i)=>n+i,0)>0&&r.strides.length!==a)throw new Error(`strides should be ${a}D`);if(r.pads.reduce((n,i)=>n+i,0)>0&&r.pads.length!==a*2)throw new Error(`pads should be ${a*2}D`);if(r.outputPadding.length!==a&&r.outputPadding.length!==0)throw new Error(`output_padding should be ${a}D`);if(r.kernelShape.reduce((n,i)=>n+i,0)>0&&r.kernelShape.length!==0&&r.kernelShape.length!==e[1].dims.length-2)throw new Error("invalid kernel shape");if(r.outputShape.length!==0&&r.outputShape.length!==e[0].dims.length-2)throw new Error("invalid output shape")},Nc=(e,r,t,s)=>{var n;let o=(n=e.kernelCustomData.wT)!=null?n:e.compute(_s(r[1],[2,3,0,1]),{inputs:[1],outputs:[t.wIsConst?-2:-1]})[0];t.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=o);let a=[r[0],o];r.length===3&&a.push(r[2]),e.compute(Ox(a,t,s),{inputs:a})},SM=(e,r)=>{let t=r.format==="NHWC",s=[e.inputs[0].reshape(t?[e.inputs[0].dims[0],1,e.inputs[0].dims[1],e.inputs[0].dims[2]]:[e.inputs[0].dims[0],e.inputs[0].dims[1],1,e.inputs[0].dims[2]]),e.inputs[1].reshape([e.inputs[1].dims[0],e.inputs[1].dims[1],1,e.inputs[1].dims[2]])];e.inputs.length===3&&s.push(e.inputs[2]);let o=r.kernelShape;(o.length===0||o[0]===0)&&(o=[e.inputs[1].dims[2]]);let a=r.dilations;(a.length===0||a[0]===0)&&(a=[1]);let n=r.strides;(n.length===0||n[0]===0)&&(n=[1]);let i=r.pads;i.length===0&&(i=[0,0]),i=[0,i[0],0,i[1]],n=[1].concat(n),a=[1].concat(a),o=[1].concat(o);let l=r.outputPadding;l=[0].concat(l);let c=Rc(Ct(Fe({},r),{pads:i,strides:n,dilations:a,kernelShape:o,outputPadding:l}),s);Nc(e,s,c,_=>t?[_[0],_[2],_[3]]:[_[0],_[1],_[3]])},zx=(e,r)=>{if(CM(e.inputs,r),e.inputs[0].dims.length===3)SM(e,r);else{let t=Rc(r,e.inputs);Nc(e,e.inputs,t)}}}),VT=Ve(()=>{"use strict";bt(),St(),mr(),$t(),IM=(e,r,t,s)=>{let o=we.size(r),a=r.length,n=Ee("input",e,a),i=nt("output",e,a),l=t.dataType===6?t.getInt32Array()[0]:Number(t.getBigInt64Array()[0]),c=we.normalizeAxis(l,a),_=d=>{let u=` i32(${n.indicesGet("inputIndices","uniforms.axis")}) `,f=ct("uniforms.input_shape","uniforms.axis",a),h=s.reverse?u+(s.exclusive?" + 1":""):"0",v=s.reverse?f:u+(s.exclusive?"":" + 1");return`\n                ${d.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(n,i)}\n                ${d.mainStart()}\n                  ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n                  var inputIndices = ${i.offsetToIndices("global_idx")};\n                  var sum = ${i.type.value}(0);\n                  let first : i32 = ${h};\n                  let last : i32 = ${v};\n                  for (var i : i32 = first; i < last; i++) {\n                    ${n.indicesSet("inputIndices","uniforms.axis","u32(i)")};\n                    sum = sum + ${n.getByIndices("inputIndices")};\n                  }\n                  ${i.setByOffset("global_idx","sum")};\n                }`};return{name:"CumSum",shaderCache:{hint:s.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:r,dataType:e}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:[{type:12,data:o},{type:12,data:c},...pt(r,r)]}),getShaderSource:_}},Bx=(e,r)=>{let t=e.inputs[0].dims,s=e.inputs[0].dataType,o=e.inputs[1];e.compute(IM(s,t,o,r),{inputs:[0]})},Rx=e=>{let r=e.exclusive===1,t=e.reverse===1;return qt({exclusive:r,reverse:t})}}),WT=Ve(()=>{"use strict";bt(),St(),mr(),$t(),FM=e=>{if(!e||e.length!==1)throw new Error("DepthToSpace requires 1 input.");if(e[0].dims.length!==4)throw new Error("DepthToSpace requires 4D input.")},$M=(e,r,t,s)=>{let o=[];o.push(`fn perm(i: ${s.type.indices}) -> ${t.type.indices} {\n    var a: ${t.type.indices};`);for(let a=0;a<r;++a)o.push(t.indicesSet("a",e[a],`i[${a}]`));return o.push("return a;}"),o.join(`\n`)},AM=(e,r)=>{let t,s,o,a,n,i,l=r.format==="NHWC",c=r.blocksize,_=r.mode==="DCR";l?([t,s,o,a]=e.dims,n=_?[t,s,o,c,c,a/c**2]:[t,s,o,a/c**2,c,c],i=_?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([t,s,o,a]=[e.dims[0],e.dims[2],e.dims[3],e.dims[1]],n=_?[t,c,c,a/c**2,s,o]:[t,a/c**2,c,c,s,o],i=_?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let d=e.reshape(n),u=d.dims.length,f=e.dataType,h=Ee("a",f,u),v=nt("output",f,u),E=M=>`\n  ${M.registerUniform("output_size","u32").declareVariables(h,v)}\n\n  ${$M(i,u,h,v)}\n\n  ${M.mainStart()}\n    ${M.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n\n    let indices = ${v.offsetToIndices("global_idx")};\n    let aIndices = perm(indices);\n\n    ${v.setByOffset("global_idx",h.getByIndices("aIndices"))}\n  }`;return{name:"DepthToSpace",shaderCache:{hint:`${e.dims};${r.blocksize};${r.mode}`,inputDependencies:["rank"]},getRunData:M=>{let w=l?[t,s*c,o*c,a/c**2]:[t,a/c**2,s*c,o*c],C=we.size(w),x=d.dims,T=we.sortBasedOnPerm(x,i);return{outputs:[{dims:w,dataType:M[0].dataType}],dispatchGroup:{x:Math.ceil(C/64)},programUniforms:[{type:12,data:C},...pt(x,T)]}},getShaderSource:E}},Nx=(e,r)=>{FM(e.inputs),e.compute(AM(e.inputs[0],r))},jx=e=>qt({blocksize:e.blocksize,mode:e.mode,format:e.format})}),UT=Ve(()=>{"use strict";bt(),St(),mr(),$t(),Fi="[a-zA-Z]|\\\\.\\\\.\\\\.",an="("+Fi+")+",jc="^"+an+"$",DM="("+an+",)*"+an,OM="^"+DM+"$",LM=class{constructor(e=-1){this.symbolToIndices=new Map,this.inputIndex=e}addSymbol(e,r){let t=this.symbolToIndices.get(e);t===void 0?t=[r]:t.push(r),this.symbolToIndices.set(e,t)}},zM=class{constructor(e,r){var o;this.equation=r,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[t,s]=r.includes("->")?r.split("->",2):[r,""];if(!t.match(RegExp(OM)))throw new Error("Invalid LHS term");if(t.split(",").forEach((a,n)=>{let i=e[n].dims.slice();if(!a.match(RegExp(jc)))throw new Error("Invalid LHS term");let l=this.processTerm(a,!0,i,n);this.lhs.push(l)}),s==="")s+=[...this.symbolToInfo.entries()].filter(([a,n])=>n.count===1||a==="...").map(([a])=>a).join("");else if(!s.match(RegExp(an)))throw new Error("Invalid RHS");(o=s.match(RegExp(Fi,"g")))==null||o.forEach(a=>{if(a==="...")this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let n=this.symbolToInfo.get(a);if(n===void 0)throw new Error("Invalid RHS symbol");this.outputDims.push(n.dimValue)}}),this.rhs=this.processTerm(s,!1,this.outputDims)}addSymbol(e,r,t){let s=this.symbolToInfo.get(e);if(s!==void 0){if(s.dimValue!==r&&s.count!==1)throw new Error("Dimension mismatch");s.count++,s.inputIndices.push(t)}else s={count:1,dimValue:r,inputIndices:[t]};this.symbolToInfo.set(e,s)}processTerm(e,r,t,s=-1){let o=t.length,a=!1,n=[],i=0;if(!e.match(RegExp(jc))&&!r&&e!=="")throw new Error("Invalid LHS term");let l=e.match(RegExp(Fi,"g")),c=new LM(s);return l==null||l.forEach((_,d)=>{if(_==="..."){if(a)throw new Error("Only one ellipsis is allowed per input term");a=!0;let u=o-l.length+1;if(u<0)throw new Error("Ellipsis out of bounds");if(n=t.slice(i,i+u),this.hasEllipsis){if(this.ellipsisDims.length!==n.length||this.ellipsisDims.toString()!==n.toString())throw new Error("Ellipsis dimensions mismatch")}else if(r)this.hasEllipsis=!0,this.ellipsisDims=n;else throw new Error("Ellipsis must be specified in the LHS");for(let f=0;f<n.length;f++){let h=String.fromCharCode(48+f);c.addSymbol(h,d+f),this.addSymbol(h,t[i++],s)}}else c.addSymbol(_,d+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(_,t[i++],s)}),c}},Vc=e=>e+"_max",BM=(e,r,t,s)=>{let o=e.map(c=>c.length).map((c,_)=>Ee(`input${_}`,r,c)),a=we.size(s),n=nt("output",r,s.length),i=[...t.symbolToInfo.keys()].filter(c=>!t.rhs.symbolToIndices.has(c)),l=c=>{let _=[],d="var prod = 1.0;",u="var sum = 0.0;",f="sum += prod;",h=[],v=[],E=[],M=[],w=t.symbolToInfo.size===t.rhs.symbolToIndices.size;t.symbolToInfo.forEach((x,T)=>{var S;if(t.rhs.symbolToIndices.has(T)){let g=(S=t.rhs.symbolToIndices.get(T))==null?void 0:S[0];g!==void 0&&t.lhs.forEach((P,$)=>{if(x.inputIndices.includes($)){let A=P.symbolToIndices.get(T);if(A===void 0)throw new Error("Invalid symbol error");A.forEach(N=>{_.push(`${o[$].indicesSet(`input${$}Indices`,N,n.indicesGet("outputIndices",g))}`)})}})}else t.lhs.forEach((g,P)=>{if(x.inputIndices.includes(P)){let $=g.symbolToIndices.get(T);if($===void 0)throw new Error("Invalid symbol error");$.forEach(A=>{h.push(`${o[P].indicesSet(`input${P}Indices`,A,`${T}`)}`)}),M.push(`prod *= ${o[P].getByIndices(`input${P}Indices`)};`)}}),v.push(`for(var ${T}: u32 = 0; ${T} < uniforms.${Vc(T)}; ${T}++) {`),E.push("}")});let C=w?[..._,`let sum = ${o.map((x,T)=>x.getByIndices(`input${T}Indices`)).join(" * ")};`]:[..._,u,...v,...h,d,...M,f,...E];return`\n            ${c.registerUniforms(i.map(x=>({name:`${Vc(x)}`,type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...o,n)}\n\n            ${c.mainStart()}\n            ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n            var outputIndices = ${n.offsetToIndices("global_idx")};\n            ${o.map((x,T)=>`var input${T}Indices: ${o[T].type.indices};`).join(`\n`)}\n            ${C.join(`\n`)};\n            ${n.setByOffset("global_idx","sum")};\n          }`};return{name:"Einsum",shaderCache:{hint:t.equation,inputDependencies:e.map(()=>"rank")},getRunData:()=>{let c=i.filter(d=>t.symbolToInfo.has(d)).map(d=>{var u;return{type:12,data:((u=t.symbolToInfo.get(d))==null?void 0:u.dimValue)||0}});c.push({type:12,data:a});let _=e.map((d,u)=>[...pt(d)]).reduce((d,u)=>d.concat(u),c);return _.push(...pt(s)),{outputs:[{dims:s,dataType:r}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:_}},getShaderSource:l}},Vx=(e,r)=>{let t=new zM(e.inputs,r.equation),s=t.outputDims,o=e.inputs.map((a,n)=>a.dims);e.compute(BM(o,e.inputs[0].dataType,t,s))},Wx=e=>{let r=e.equation.replace(/\\s+/g,"");return qt({equation:r})}}),GT=Ve(()=>{"use strict";bt(),St(),$t(),RM=e=>{if(!e||e.length!==2)throw new Error("Expand requires 2 input.");let r=e[0].dims,t=Array.from(e[1].getBigInt64Array(),Number),s=t.length<r.length?0:t.length-r.length,o=r.length<t.length?0:r.length-t.length;for(;s<t.length&&o<r.length;++s,++o)if(t[s]!==r[o]&&t[s]!==1&&r[o]!==1)throw new Error("Expand requires shape to be broadcastable to input")},Wc=(e,r)=>{let t=e.length-r.length,s=[];for(let o=0;o<t;++o)s.push(e[o]);for(let o=0;o<r.length;++o)s.push(r[o]===1?e[o+t]:r[o]);return s},NM=(e,r)=>e.length>r.length?Wc(e,r):Wc(r,e),jM=e=>{let r=e[0].dims,t=Array.from(e[1].getBigInt64Array(),Number),s=NM(r,t),o=e[0].dataType,a=o===9||we.size(r)===1,n=o===9||r.length>0&&r[r.length-1]%4===0?4:1,i=a||s.length>0&&s[s.length-1]%4===0?4:1,l=Math.ceil(we.size(s)/i),c=d=>{let u=Ee("input",o,r.length,n),f=nt("output",o,s.length,i),h;if(o===9){let v=(E,M,w="")=>`\n          let outputIndices${M} = ${f.offsetToIndices(`outputOffset + ${M}u`)};\n          let offset${M} = ${u.broadcastedIndicesToOffset(`outputIndices${M}`,f)};\n          let index${M} = offset${M} / 4u;\n          let component${M} = offset${M} % 4u;\n          ${E}[${M}] = ${w}(${u.getByOffset(`index${M}`)}[component${M}]);\n        `;h=`\n        let outputOffset = global_idx * ${i};\n        var data = vec4<u32>(0);\n        ${v("data",0,"u32")}\n        ${v("data",1,"u32")}\n        ${v("data",2,"u32")}\n        ${v("data",3,"u32")}\n        ${f.setByOffset("global_idx","data")}\n      }`}else h=`\n        let outputIndices = ${f.offsetToIndices(`global_idx * ${i}`)};\n        let inputOffset = ${u.broadcastedIndicesToOffset("outputIndices",f)};\n        let data = ${f.type.value}(${u.getByOffset(`inputOffset / ${n}`)});\n        ${f.setByOffset("global_idx","data")}\n      }`;return`\n    ${d.registerUniform("vec_size","u32").declareVariables(u,f)}\n    ${d.mainStart()}\n    ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}\n    ${h}`},_=[{type:12,data:l},...pt(r,s)];return{name:"Expand",shaderCache:{hint:`${s.length};${n}${i}`,inputDependencies:["rank"]},getShaderSource:c,getRunData:()=>({outputs:[{dims:s,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:_})}},Ux=e=>{RM(e.inputs),e.compute(jM(e.inputs),{inputs:[0]})}}),KT=Ve(()=>{"use strict";bt(),St(),$t(),Ud(),VM=e=>{let r=e[0].dataType,t=we.size(e[0].dims),s=we.size(e[1].dims),o=s%4===0,a=n=>{let i=Ee("x",r,[1],4),l=Ee("bias",r,[1],4),c=nt("y",r,[1],4),_=[{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}],d=f=>`\n      let bias${f}_offset: u32 = (global_idx * 4 + ${f}) % uniforms.bias_size;\n      let bias${f} = ${l.getByOffset(`bias${f}_offset / 4`)}[bias${f}_offset % 4];`,u=o?`\n      let bias = ${l.getByOffset("global_idx % (uniforms.bias_size / 4)")};`:`${d(0)}${d(1)}${d(2)}${d(3)}\n      let bias = ${i.type.value}(bias0, bias1, bias2, bias3);`;return`${n.registerUniforms(_).declareVariables(i,l,c)}\n\n    ${Md(Xr(r))}\n\n    ${n.mainStart(mo)}\n      ${n.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size")}\n\n      let x = ${i.getByOffset("global_idx")};\n      ${u}\n      let x_in = x + bias;\n      ${c.setByOffset("global_idx",wd("x_in"))}\n    }`};return{name:"FastGeluWithBias",shaderCache:{hint:`${o}`,inputDependencies:["type","type"]},getShaderSource:a,getRunData:n=>({outputs:[{dims:n[0].dims,dataType:n[0].dataType}],programUniforms:[{type:12,data:Math.ceil(t/4)},{type:12,data:s}],dispatchGroup:{x:Math.ceil(t/mo/4)}})}},Gx=e=>{e.inputs.length<2||we.size(e.inputs[1].dims)===0?ux(e):e.compute(VM(e.inputs))}}),HT=Ve(()=>{"use strict";bt(),St(),mr(),$t(),WM=e=>{if(!e||e.length!==2)throw new Error("Gather requires 2 inputs.")},UM=(e,r)=>{let t=e[0].dims,s=e[1].dims,o=t.length,a=we.normalizeAxis(r.axis,o),n=t.slice(0);n.splice(a,1,...s);let i=t[a],l=e[0].dataType===9?4:1,c=Math.ceil(we.size(n)/l),_=[{type:12,data:c},{type:6,data:i},{type:12,data:a},...pt(e[0].dims,e[1].dims,n)],d=u=>{let f=Ee("data",e[0].dataType,e[0].dims.length,l),h=Ee("inputIndices",e[1].dataType,e[1].dims.length),v=nt("output",e[0].dataType,n.length,l),E=w=>{let C=s.length,x=`var indicesIndices${w}  = ${h.type.indices}(0);`;for(let T=0;T<C;T++)x+=`${C>1?`indicesIndices${w}[${T}]`:`indicesIndices${w}`} = ${n.length>1?`outputIndices${w}[uniforms.axis + ${T}]`:`outputIndices${w}`};`;x+=`\n          var idx${w} = ${h.getByIndices(`indicesIndices${w}`)};\n          if (idx${w} < 0) {\n            idx${w} = idx${w} + uniforms.axisDimLimit;\n          }\n          var dataIndices${w} : ${f.type.indices};\n        `;for(let T=0,S=0;T<o;T++)T===a?(x+=`${o>1?`dataIndices${w}[${T}]`:`dataIndices${w}`} = u32(idx${w});`,S+=C):(x+=`${o>1?`dataIndices${w}[${T}]`:`dataIndices${w}`} = ${n.length>1?`outputIndices${w}[${S}]`:`outputIndices${w}`};`,S++);return x},M;if(e[0].dataType===9){let w=(C,x,T="")=>`\n          let outputIndices${x} = ${v.offsetToIndices(`outputOffset + ${x}u`)};\n          ${E(x)};\n          let offset${x} = ${f.indicesToOffset(`dataIndices${x}`)};\n          let index${x} = offset${x} / 4u;\n          let component${x} = offset${x} % 4u;\n          ${C}[${x}] = ${T}(${f.getByOffset(`index${x}`)}[component${x}]);\n        `;M=`\n        let outputOffset = global_idx * ${l};\n        var value = vec4<u32>(0);\n        ${w("value",0,"u32")}\n        ${w("value",1,"u32")}\n        ${w("value",2,"u32")}\n        ${w("value",3,"u32")}\n        ${v.setByOffset("global_idx","value")}\n      `}else M=`\n      let outputIndices = ${v.offsetToIndices("global_idx")};\n      ${E("")};\n      let value = ${f.getByIndices("dataIndices")};\n      ${v.setByOffset("global_idx","value")};\n      `;return`\n      ${u.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(f,h,v)}\n      ${u.mainStart()}\n        ${u.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n        ${M}\n      }`};return{name:"Gather",shaderCache:{hint:r.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:_}),getShaderSource:d}},Kx=e=>qt({axis:e.axis}),Hx=(e,r)=>{let t=e.inputs;WM(t),e.compute(UM(e.inputs,r))}}),qT=Ve(()=>{"use strict";bt(),St(),$t(),GM=(e,r,t,s,o,a,n,i,l)=>{let c=[{type:12,data:a},{type:12,data:s},{type:12,data:o},{type:12,data:t},{type:12,data:n},{type:12,data:i},{type:12,data:l}],_=[a];c.push(...pt(r.dims,_));let d=u=>{let f=Ee("indices_data",r.dataType,r.dims.length),h=nt("input_slice_offsets_data",12,1,1),v=[f,h],E=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:o.length},{name:"sizes_from_slice_dims_data",type:"u32",length:t.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return`\n  ${u.registerUniforms(E).declareVariables(...v)}\n  ${u.mainStart()}\n    ${u.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n    let batch_idx = global_idx / uniforms.num_slices_per_batch;\n    let base_offset = batch_idx * uniforms.input_batch_stride;\n\n    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;\n    var relative_slice_offset = 0;\n    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {\n      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);\n      let input_dim_idx = uniforms.batch_dims + dim_idx;\n      if (index < 0) {\n        ${o.length===1?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);"}\n      }\n      ${t.length===1?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);"}\n    }\n\n    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);\n  }`};return e.compute({name:"computeSliceOffsets",shaderCache:{hint:`${o.length}_${t.length}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:_,dataType:e.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:c}),getShaderSource:d},{inputs:[r],outputs:[-1]})[0]},qx=(e,r)=>{let t=e.inputs,s=t[0].dims,o=t[0].dataType,a=t[1].dims,n=a[a.length-1],i=we.sizeToDimension(a,a.length-1),l=we.sizeFromDimension(s,r.batchDims+n),c=we.sizeToDimension(s,r.batchDims),_=we.sizeFromDimension(s,r.batchDims),d=i/c,u=new Array(n),f=l;for(let x=0;x<n;++x)u[n-1-x]=f,f*=s[r.batchDims+n-1-x];let h=GM(e,t[1],u,r.batchDims,s,i,d,_,n),v=r.batchDims+n;if(v>s.length)throw new Error("last dimension of indices must not be larger than rank of input tensor");let E=a.slice(0,-1).concat(s.slice(v)),M=we.size(E),w=[{type:12,data:M},{type:12,data:l},...pt(t[0].dims,h.dims,E)],C=x=>{let T=Ee("data",t[0].dataType,t[0].dims.length),S=Ee("slice_offsets",12,h.dims.length),g=nt("output",t[0].dataType,E.length);return`\n          ${x.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables(T,S,g)}\n            ${x.mainStart()}\n            ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];\n          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];\n        }`};e.compute({name:"GatherND",shaderCache:{hint:r.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:E,dataType:o}],dispatchGroup:{x:Math.ceil(M/64)},programUniforms:w}),getShaderSource:C},{inputs:[t[0],h]})},Qx=e=>({batchDims:e.batch_dims,cacheKey:""})}),QT=Ve(()=>{"use strict";bt(),St(),mr(),$t(),KM=(e,r)=>{if(e.length<3||e.length>4)throw new Error("GatherBlockQuantized requires 3 or 4 inputs.");let t=we.normalizeAxis(r.quantizeAxis,e[0].dims.length),s=r.blockSize,o=e[0],a=e[2],n=e.length===4?e[3]:void 0;if(a.dims.length!==o.dims.length||!o.dims.map((i,l)=>l===t?Math.ceil(i/s)===a.dims[l]:i===a.dims[l]).reduce((i,l)=>i&&l,!0))throw new Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(n){if(n.dataType!==o.dataType)throw new Error("Zero point must have the same data type as the input tensor.");if(n.dims.length!==a.dims.length||!n.dims.map((i,l)=>i===a.dims[l]).reduce((i,l)=>i&&l,!0))throw new Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},HM=(e,r)=>{let t=e[0].dims,s=e[1].dims,o=t.length,a=we.normalizeAxis(r.gatherAxis,o),n=we.normalizeAxis(r.quantizeAxis,o),i=t.slice(0);i.splice(a,1,...s);let l=we.size(i),c=e[2].dataType,_=e[0].dataType===22,d=[{type:12,data:l},{type:12,data:n},{type:12,data:a},{type:12,data:r.blockSize},...pt(...e.map((f,h)=>f.dims),i)],u=f=>{let h=Ee("data",e[0].dataType,e[0].dims.length),v=Ee("inputIndices",e[1].dataType,e[1].dims.length),E=Ee("scales",e[2].dataType,e[2].dims.length),M=e.length>3?Ee("zeroPoint",e[3].dataType,e[3].dims.length):void 0,w=nt("output",c,i.length),C=[h,v,E];M&&C.push(M);let x=[{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}];return`\n        ${f.registerUniforms(x).declareVariables(...C,w)}\n        ${f.mainStart()}\n        let output_indices = ${w.offsetToIndices("global_idx")};\n        var indices_indices = ${v.type.indices}(0);\n        ${s.length>1?`\n          for (var i: u32 = 0; i < ${s.length}; i++) {\n            let index = ${w.indicesGet("output_indices","uniforms.gather_axis + i")};\n            ${v.indicesSet("indices_indices","i","index")};\n          }`:`indices_indices = ${w.indicesGet("output_indices","uniforms.gather_axis")};`};\n        var data_indices = ${h.type.indices}(0);\n        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {\n          let index = ${w.indicesGet("output_indices","i")};\n          ${h.indicesSet("data_indices","i","index")};\n        }\n        var index_from_indices = ${v.getByIndices("indices_indices")};\n        if (index_from_indices < 0) {\n          index_from_indices += ${t[a]};\n        }\n        ${h.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)")};\n        for (var i = uniforms.gather_axis + 1; i < ${i.length}; i++) {\n          let index = ${w.indicesGet("output_indices",`i + ${s.length} - 1`)};\n          ${h.indicesSet("data_indices","i","index")};\n        }\n        let data_offset = ${h.indicesToOffset("data_indices")};\n        let data_index = data_offset % 8;\n        // Convert 4-bit packed data to 8-bit packed data.\n        let packed_4bit_quantized_data = ${h.getByOffset("data_offset / 8")};\n        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;\n        let quantized_data_vec = ${_?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_quantized_data));\n        let quantized_data = quantized_data_vec[data_index / 2];\n        var scale_indices = data_indices;\n        let quantize_axis_index = ${E.indicesGet("data_indices","uniforms.quantize_axis")} / uniforms.block_size;\n        ${E.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index")};\n        var scale = ${E.getByIndices("scale_indices")};\n        ${M?`\n              let zero_point_indices = scale_indices;\n              let zero_point_offset = ${M.indicesToOffset("zero_point_indices")};\n              let zero_point_index = zero_point_offset % 8;\n              let packed_4bit_zero_points = ${M.getByOffset("zero_point_offset / 8")};\n              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;\n              let zero_point_vec = ${_?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_zero_points));\n              let zero_point = zero_point_vec[zero_point_index / 2];`:"var zero_point = 0"};\n        let dequantized_data = ${Xr(c)}(quantized_data - zero_point) * scale;\n        ${w.setByOffset("global_idx","dequantized_data")};\n    }`};return{name:"GatherBlockQuantized",shaderCache:{hint:`${r.cacheKey};${e.filter((f,h)=>h!==1).map(f=>f.dims.join("_")).join(";")}`,inputDependencies:Array.from({length:e.length},(f,h)=>"rank")},getRunData:()=>({outputs:[{dims:i,dataType:c}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:d}),getShaderSource:u}},Xx=(e,r)=>{let t=e.inputs;KM(t,r),e.compute(HM(e.inputs,r))},Jx=e=>qt({blockSize:e.blockSize,gatherAxis:e.gatherAxis,quantizeAxis:e.quantizeAxis})}),XT=Ve(()=>{"use strict";bt(),St(),mr(),$t(),qM=e=>{if(!e||e.length!==2)throw new Error("GatherElements requires 2 inputs.");if(e[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(e[0].dims.length!==e[1].dims.length)throw new Error(`GatherElements requires that the data input and\n                     indices input tensors be of same rank.`)},QM=(e,r)=>{let t=e[0].dims,s=e[0].dataType,o=t.length,a=e[1].dims,n=e[1].dataType,i=we.normalizeAxis(r.axis,o),l=t[i],c=a.slice(0),_=we.size(c),d=Ee("input",s,o),u=Ee("indicesInput",n,a.length),f=nt("output",s,c.length),h=[{type:12,data:_},{type:6,data:l},{type:12,data:i}];return h.push(...pt(t,a,c)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:c,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(_/64)},programUniforms:h}),getShaderSource:v=>`\n      ${v.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(d,u,f)}\n      ${v.mainStart()}\n      ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n\n      let outputIndices = ${f.offsetToIndices("global_idx")};\n\n      var idx = ${u.getByOffset("global_idx")};\n      if (idx < 0) {\n        idx = idx + uniforms.axisDimLimit;\n      }\n      var inputIndices = ${d.type.indices}(outputIndices);\n      ${d.indicesSet("inputIndices","uniforms.axis","u32(idx)")};\n      let value = ${d.getByIndices("inputIndices")};\n\n      ${f.setByOffset("global_idx","value")};\n  }`}},Yx=e=>qt({axis:e.axis}),Zx=(e,r)=>{let t=e.inputs;qM(t),e.compute(QM(e.inputs,r))}}),JT=Ve(()=>{"use strict";bt(),St(),$t(),XM=e=>{if(!e)throw new Error("Input is missing");if(e.length<2||e.length>3)throw new Error("Invaid input number.");if(e.length===3&&e[2].dims.length>2)throw new Error("Invalid input shape of C");if(e[0].dataType!==e[1].dataType||e.length===3&&e[0].dataType!==e[2].dataType)throw new Error("Input types are mismatched")},JM=(e,r)=>{let t=e[0].dims.slice(),s=e[1].dims.slice(),[o,a,n]=Yb.getShapeOfGemmResult(t,r.transA,s,r.transB,e.length===3?e[2].dims:void 0),i=[o,a];if(!i)throw new Error("Can\'t use gemm on the given tensors");let l=16,c=Math.ceil(a/l),_=Math.ceil(o/l),d=!0,u=we.size(i),f=[{type:12,data:d?c:u},{type:12,data:o},{type:12,data:a},{type:12,data:n},{type:1,data:r.alpha},{type:1,data:r.beta}],h=["type","type"];e.length===3&&(f.push(...pt(e[2].dims)),h.push("rank")),f.push(...pt(i));let v=M=>{let w="";r.transA&&r.transB?w="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":r.transA&&!r.transB?w="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!r.transA&&r.transB?w="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!r.transA&&!r.transB&&(w="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let C=r.alpha===1?"":"value *= uniforms.alpha;",x=Ee("a",e[0].dataType,e[0].dims),T=Ee("b",e[1].dataType,e[1].dims),S=x.type.value,g=null,P=[x,T];e.length===3&&(g=Ee("c",e[2].dataType,e[2].dims.length),P.push(g));let $=nt("output",e[0].dataType,i.length);P.push($);let A=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}];return`\n  ${M.registerUniforms(A).declareVariables(...P)}\n\n  ${M.mainStart()}\n    ${M.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n\n    let m = global_idx / uniforms.N;\n    let n = global_idx % uniforms.N;\n\n    var value = ${S}(0);\n    for (var k: u32 = 0u; k < uniforms.K; k++) {\n      ${w}\n    }\n\n    ${C}\n    ${g!=null?`let cOffset = ${g.broadcastedIndicesToOffset("vec2(m, n)",$)}; value += ${S}(uniforms.beta) * ${g.getByOffset("cOffset")};`:""}\n    output[global_idx] = value;\n  }`},E=M=>{let w=Ee("a",e[0].dataType,e[0].dims),C=Ee("b",e[1].dataType,e[1].dims),x=null,T=[w,C];e.length===3&&(x=Ee("c",e[2].dataType,e[2].dims.length),T.push(x));let S=nt("output",e[0].dataType,i.length);T.push(S);let g=[{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}],P="",$="";r.transA&&r.transB?($=`\n      var col = tile_row_start + local_id.x;\n      var row = k_start + local_id.y;\n      if (col < uniforms.M && row < uniforms.K) {\n        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];\n      } else {\n        tile_a[local_id.y][local_id.x] = ${w.type.value}(0);\n      }\n\n      col = k_start + local_id.x;\n      row = tile_col_start + local_id.y;\n      if (col < uniforms.K && row < uniforms.N) {\n        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];\n      } else {\n        tile_b[local_id.y][local_id.x] = ${C.type.value}(0);\n      }\n      `,P="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):r.transA&&!r.transB?($=`\n      var col = tile_row_start + local_id.x;\n      var row = k_start + local_id.y;\n      if (col < uniforms.M && row < uniforms.K) {\n        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];\n      } else {\n        tile_a[local_id.y][local_id.x] = ${w.type.value}(0);\n      }\n\n      col = tile_col_start + local_id.x;\n      row = k_start + local_id.y;\n      if (col < uniforms.N && row < uniforms.K) {\n        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];\n      } else {\n        tile_b[local_id.y][local_id.x] = ${C.type.value}(0);\n      }\n      `,P="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!r.transA&&r.transB?($=`\n      var col = k_start + local_id.x;\n      var row = tile_row_start + local_id.y;\n      if (col < uniforms.K && row < uniforms.M) {\n        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];\n      } else {\n        tile_a[local_id.y][local_id.x] = ${w.type.value}(0);\n      }\n\n      col = k_start + local_id.x;\n      row = tile_col_start + local_id.y;\n      if (col < uniforms.K && row < uniforms.N) {\n        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];\n      } else {\n        tile_b[local_id.y][local_id.x] = ${C.type.value}(0);\n      }\n      `,P="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):!r.transA&&!r.transB&&($=`\n      var col = k_start + local_id.x;\n      var row = tile_row_start + local_id.y;\n      if (col < uniforms.K && row < uniforms.M) {\n        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];\n      } else {\n        tile_a[local_id.y][local_id.x] = ${w.type.value}(0);\n      }\n\n      col = tile_col_start + local_id.x;\n      row = k_start + local_id.y;\n      if (col < uniforms.N && row < uniforms.K) {\n        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];\n      } else {\n        tile_b[local_id.y][local_id.x] = ${C.type.value}(0);\n      }\n      `,P="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let A=r.alpha===1?"":"value *= uniforms.alpha;";return`\n  ${M.registerUniforms(g).declareVariables(...T)}\n  var<workgroup> tile_a: array<array<${w.type.storage}, ${l}>, ${l}>;\n  var<workgroup> tile_b: array<array<${C.type.storage}, ${l}>, ${l}>;\n  ${M.mainStart([l,l,1])}\n    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ${l};\n    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ${l};\n    let num_tiles = (uniforms.K - 1) / ${l} + 1;\n    var k_start = 0u;\n    var value = ${S.type.value}(0);\n    for (var t: u32 = 0u; t < num_tiles; t++) {\n      ${$}\n      k_start = k_start + ${l};\n      workgroupBarrier();\n\n      for (var k: u32 = 0u; k < ${l}; k++) {\n        ${P}\n      }\n      workgroupBarrier();\n    }\n\n    ${A}\n    let m = tile_row_start + local_id.y;\n    let n = tile_col_start + local_id.x;\n    ${x!=null?`let cOffset = ${x.broadcastedIndicesToOffset("vec2(m, n)",S)}; value += ${S.type.value}(uniforms.beta) * ${x.getByOffset("cOffset")};`:""}\n    if (m < uniforms.M && n < uniforms.N) {\n      output[m * uniforms.N + n] = value;\n    }\n  }`};return d?{name:"GemmShared",shaderCache:{hint:`${r.cacheKey}`,inputDependencies:h},getRunData:()=>({outputs:[{dims:i,dataType:e[0].dataType}],dispatchGroup:{x:c*_},programUniforms:f}),getShaderSource:E}:{name:"Gemm",shaderCache:{hint:`${r.cacheKey}`,inputDependencies:h},getRunData:()=>({outputs:[{dims:i,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:f}),getShaderSource:v}},ey=e=>{let r=e.transA,t=e.transB,s=e.alpha,o=e.beta;return{transA:r,transB:t,alpha:s,beta:o,cacheKey:`${e.transA};${e.transB};${e.alpha===1}`}},ty=(e,r)=>{XM(e.inputs),e.compute(JM(e.inputs,r))}}),YT=Ve(()=>{"use strict";bt(),St(),mr(),$t(),[Ns,Hs,$a,Aa]=[0,1,2,3],YM=e=>{if(e[0].dims.length!==4)throw new Error("only 4-D tensor is supported.");if(e[0].dims.length!==e[1].dims.length)throw new Error("input dimensions must be equal to grid dimensions");if(e[0].dims.length-2!==e[1].dims[e[1].dims.length-1])throw new Error(`last dimension of grid must be equal to ${e[0].dims.length-2}`);if(e[0].dims[0]!==e[1].dims[0])throw new Error("grid batch size must match input batch size")},ZM=`\n  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {\n    let cubic_alpha = -0.75f;\n    let x_abs = abs(x);\n    var coeffs: vec4<f32>;\n    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);\n    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);\n    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);\n    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);\n    return coeffs;\n  }\n`,ew=e=>`\n  fn gs_bicubic_interpolate(p: mat4x4<${e}>, x: f32, y: f32) -> ${e} {\n    var v: vec4<f32>;\n    var coeffs = gs_get_cubic_coeffs(x);\n    for (var i = 0; i < 4; i++) {\n      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];\n    }\n    coeffs = gs_get_cubic_coeffs(y);\n    let pixel = ${e}(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);\n    return pixel;\n  }\n`,tw=e=>`\n  fn gs_denormalize(n: f32, length: i32) -> f32 {\n    ${e.alignCorners===0?`\n    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]\n    return ((n + 1.0) * f32(length) - 1.0) / 2.0;\n    `:`\n    // alignCorners: true => [-1, 1] to [0, length - 1]\n    return (n + 1.0) / 2.0 * (f32(length - 1));\n    `}\n  }\n`,rw=e=>`\n  ${e.paddingMode==="reflection"?`\n      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {\n        var dx = 0.0;\n        var fx = f32(x);\n        let range = x_max - x_min;\n        if (fx < x_min) {\n          dx = x_min - fx;\n          let n = u32(dx / range);\n          let r = dx - f32(n) * range;\n          if (n % 2 == 0) {\n            fx = x_min + r;\n          } else {\n            fx = x_max - r;\n          }\n        } else if (fx > x_max) {\n          dx = fx - x_max;\n          let n = u32(dx / range);\n          let r = dx - f32(n) * range;\n          if (n % 2 == 0) {\n            fx = x_max - r;\n          } else {\n            fx = x_min + r;\n          }\n        }\n        return u32(fx);\n      }`:""}\n`,sw=(e,r,t)=>`\n  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ${r} {\n     var pixel = ${r}(0);\n     var indices = vec4<u32>(0);\n     indices[${Ns}] = batch;\n     indices[${Hs}] = channel;`+(()=>{switch(t.paddingMode){case"zeros":return`\n          if (r >= 0 && r < H && c >=0 && c < W) {\n            indices[${$a}] = u32(r);\n            indices[${Aa}] = u32(c);\n          } else {\n            return ${r}(0);\n          }\n        `;case"border":return`\n          indices[${$a}] = u32(clamp(r, 0, H - 1));\n          indices[${Aa}] = u32(clamp(c, 0, W - 1));\n        `;case"reflection":return`\n          indices[${$a}] = gs_reflect(r, border[1], border[3]);\n          indices[${Aa}] = gs_reflect(c, border[0], border[2]);\n        `;default:throw new Error(`padding mode ${t.paddingMode} is not supported`)}})()+`\n    return ${e.getByIndices("indices")};\n  }\n`,aw=(e,r,t)=>(()=>{switch(t.mode){case"nearest":return`\n          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[${Ns}], indices[${Hs}], border);\n        `;case"bilinear":return`\n          let x1 = i32(floor(x));\n          let y1 = i32(floor(y));\n          let x2 = x1 + 1;\n          let y2 = y1 + 1;\n\n          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[${Ns}], indices[${Hs}], border);\n          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[${Ns}], indices[${Hs}], border);\n          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[${Ns}], indices[${Hs}], border);\n          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[${Ns}], indices[${Hs}], border);\n\n          let dx2 = ${r}(f32(x2) - x);\n          let dx1 = ${r}(x - f32(x1));\n          let dy2 = ${r}(f32(y2) - y);\n          let dy1 = ${r}(y - f32(y1));\n          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);\n        `;case"bicubic":return`\n          let x0 = i32(floor(x)) - 1;\n          let y0 = i32(floor(y)) - 1;\n          var p: mat4x4<${r}>;\n          for (var h = 0; h < 4; h++) {\n            for (var w = 0; w < 4; w++) {\n              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[${Ns}], indices[${Hs}], border);\n            }\n          }\n\n          let dx = x - f32(x0 + 1);\n          let dy = y - f32(y0 + 1);\n          let result = gs_bicubic_interpolate(p, dx, dy);\n        `;default:throw new Error(`mode ${t.mode} is not supported`)}})()+`${e.setByOffset("global_idx","result")}`,ow=(e,r)=>{let t=Ee("x",e[0].dataType,e[0].dims.length),s=[e[1].dims[0],e[1].dims[1],e[1].dims[2]],o=Ee("grid",e[1].dataType,s.length,2),a=[e[0].dims[0],e[0].dims[1],e[1].dims[1],e[1].dims[2]];r.format==="NHWC"&&(a=[e[0].dims[0],e[1].dims[1],e[1].dims[2],e[0].dims[3]],[Ns,Hs,$a,Aa]=[0,3,1,2]);let n=nt("output",e[0].dataType,a.length),i=t.type.value,l=we.size(a),c=[{type:12,data:l},...pt(e[0].dims,s,a)],_=d=>`\n  ${d.registerUniform("output_size","u32").declareVariables(t,o,n)}\n  ${ZM}\n  ${ew(i)}\n  ${tw(r)}\n  ${rw(r)}\n  ${sw(t,i,r)}\n\n  ${d.mainStart()}\n    ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n      let H_in = i32(uniforms.x_shape[${$a}]);\n      let W_in = i32(uniforms.x_shape[${Aa}]);\n\n      ${r.alignCorners===0?`\n      let x_min = -0.5;\n      let x_max = f32(W_in) - 0.5;\n      let y_min = -0.5;\n      let y_max = f32(H_in) - 0.5;\n      `:`\n      let x_min = 0.0;\n      let x_max = f32(W_in) - 1.0;\n      let y_min = 0.0;\n      let y_max = f32(H_in) - 1.0;\n      `};\n      let border = vec4<f32>(x_min, y_min, x_max, y_max);\n\n      let indices = ${n.offsetToIndices("global_idx")};\n      var grid_indices = vec3<u32>(indices[${Ns}], indices[${$a}], indices[${Aa}]);\n      let nxy = ${o.getByIndices("grid_indices")};\n      var x = gs_denormalize(f32(nxy[0]), W_in);\n      var y = gs_denormalize(f32(nxy[1]), H_in);\n\n      ${aw(n,i,r)}\n  }`;return{name:"GridSample",shaderCache:{hint:`${r.cacheKey}`,inputDependencies:["type","type"]},getRunData:d=>{let u=we.size(a);return{outputs:[{dims:a,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:c}},getShaderSource:_}},ry=(e,r)=>{YM(e.inputs),e.compute(ow(e.inputs,r))},sy=e=>qt({alignCorners:e.align_corners,mode:e.mode,paddingMode:e.padding_mode,format:e.format})}),ny=Ve(()=>{"use strict";bt(),St(),mr(),Nd(),Wd(),$t(),ca(),es=(e,r)=>e.length>r&&e[r].dims.length>0?e[r]:void 0,nw=(e,r)=>{let t=e[0],s=es(e,1),o=es(e,2),a=es(e,3),n=es(e,4),i=es(e,5),l=es(e,6),c=es(e,7);if(t.dims.length!==3&&t.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let _=t.dims[0],d=t.dims[1],u=t.dims.length===3?t.dims[2]:r.numHeads*t.dims[4],f=d,h=0,v=0,E=Math.floor(u/r.numHeads);if(l&&c&&we.size(l.dims)&&we.size(c.dims)){if(l.dims.length!==4)throw new Error(\'Input "past_key" is expected to have 4 dimensions\');if(l.dims[0]!==_||l.dims[1]!==r.numHeads||l.dims[3]!==E)throw new Error(\'Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)\');if(c.dims[0]!==_||c.dims[1]!==r.numHeads||c.dims[3]!==E)throw new Error(\'Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)\');if(l.dims[2]!==c.dims[2])throw new Error(\'Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)\');if(c.dims.length!==4)throw new Error(\'Input "past_value" is expected to have 4 dimensions\');h=l.dims[2],v=l.dims[2]}else if(l&&we.size(l.dims)||c&&we.size(c.dims))throw new Error(\'Input "past_key" and "past_value" shall be both present or both absent\');let M;if(s&&we.size(s.dims)>0){if(t.dims.length!==3)throw new Error(\'Input "query" is expected to have 3 dimensions when key is given\');if(s.dims.length<3||s.dims.length>5)throw new Error(\'Input "key" is expected to have 3, 4, or 5 dimensions\');if(t.dims[0]!==s.dims[0])throw new Error(\'Input "query" and "key" shall have same dim 0 (batch size)\');if(s.dims.length===3){if(s.dims[2]!==t.dims[2])throw new Error(\'Input "query" and "key" shall have same dim 2 (hidden_size)\');M=2,f=s.dims[1]}else if(s.dims.length===5){if(s.dims[2]!==r.numHeads||s.dims[3]!==2||s.dims[4]!==E)throw new Error(\'Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv\');if(o)throw new Error(\'Expect "value" be none when "key" has packed kv format.\');M=5,f=s.dims[1]}else{if(s.dims[1]!==r.numHeads||s.dims[3]!==E)throw new Error(\'Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key\');M=0,f=s.dims[2]}}else{if(t.dims.length!==5)throw new Error(\'Input "query" is expected to have 5 dimensions when key is empty\');if(t.dims[2]!==r.numHeads||t.dims[3]!==3)throw new Error(\'Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv\');M=3}if(a&&we.size(a.dims)>0){if(a.dims.length!==1)throw new Error(\'Input "bias" is expected to have 1 dimension\');if(s&&s.dims.length===5&&s.dims[3]===2)throw new Error("bias is not allowed for packed kv.")}let w=h+f,C=0;if(n&&we.size(n.dims)>0){C=8;let g=n.dims;throw g.length===1?g[0]===_?C=1:g[0]===3*_+2&&(C=3):g.length===2&&g[0]===_&&g[1]===w&&(C=5),C===8?new Error(\'Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)\'):new Error("Mask not supported")}let x=!1,T=u;if(o&&we.size(o.dims)>0){if(o.dims.length!==3&&o.dims.length!==4)throw new Error(\'Input "value" is expected to have 3 or 4 dimensions\');if(t.dims[0]!==o.dims[0])throw new Error(\'Input "query" and "value" shall have same dim 0 (batch_size)\');if(o.dims.length===3){if(f!==o.dims[1])throw new Error(\'Input "key" and "value" shall have the same dim 1 (kv_sequence_length)\');T=o.dims[2]}else{if(f!==o.dims[2])throw new Error(\'Input "key" and "value" shall have the same dim 2 (kv_sequence_length)\');T=o.dims[1]*o.dims[3],x=!0}}let S=!1;if(n&&we.size(n.dims)>0)throw new Error("Key padding mask is not supported");if(i&&we.size(i.dims)>0){if(i.dims.length!==4)throw new Error(\'Input "attention_bias" is expected to have 4 dimensions\');if(i.dims[0]!==_||i.dims[1]!==r.numHeads||i.dims[2]!==d||i.dims[3]!==w)throw new Error(\'Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)\')}return{batchSize:_,sequenceLength:d,pastSequenceLength:h,kvSequenceLength:f,totalSequenceLength:w,maxSequenceLength:v,inputHiddenSize:0,hiddenSize:u,vHiddenSize:T,headSize:E,vHeadSize:Math.floor(T/r.numHeads),numHeads:r.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:r.maskFilterValue,maskType:C,scale:r.scale,broadcastResPosBias:S,passPastInKv:x,qkvFormat:M}},ay=e=>qt(Fe({},e)),Uc=qt({perm:[0,2,1,3]}),iw=(e,r,t,s,o,a,n)=>{let i=[s,o,a],l=we.size(i),c=[{type:12,data:l},{type:12,data:n},{type:12,data:a}],_=d=>{let u=nt("qkv_with_bias",r.dataType,i),f=Ee("qkv",r.dataType,i),h=Ee("bias",t.dataType,i),v=[{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}];return`\n  ${d.registerUniforms(v).declareVariables(f,h,u)}\n  ${d.mainStart()}\n    ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;\n\n    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];\n  }`};return e.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:i,dataType:r.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:c}),getShaderSource:_},{inputs:[r,t],outputs:[-1]})[0]},pn=(e,r,t,s,o,a,n,i)=>{let l=a;if(n&&we.size(n.dims)>0){if(s===1)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return l=iw(e,a,n,r,s,t*o,i),l=l.reshape([r,s,t,o]),t===1||s===1?l:e.compute(_s(l,Uc.perm),{inputs:[l],outputs:[-1]})[0]}else return a.dims.length===3&&(l=a.reshape([r,s,t,o])),t===1||s===1?l:e.compute(_s(l,Uc.perm),{inputs:[l],outputs:[-1]})[0]},oy=(e,r)=>{let t=nw(e.inputs,r),s=e.inputs[0],o=es(e.inputs,1),a=es(e.inputs,2),n=es(e.inputs,3),i=es(e.inputs,4),l=es(e.inputs,5),c=es(e.inputs,6),_=es(e.inputs,7);if(s.dims.length===5)throw new Error("Packed QKV is not implemented");if((o==null?void 0:o.dims.length)===5)throw new Error("Packed KV is not implemented");let d=o&&a&&o.dims.length===4&&a.dims.length===4,u=pn(e,t.batchSize,t.numHeads,t.sequenceLength,t.headSize,s,n,0);if(d)return gn(e,u,o,a,i,void 0,c,_,l,t);if(!o||!a)throw new Error("key and value must be provided");let f=pn(e,t.batchSize,t.numHeads,t.kvSequenceLength,t.headSize,o,n,t.hiddenSize),h=pn(e,t.batchSize,t.numHeads,t.kvSequenceLength,t.vHeadSize,a,n,2*t.hiddenSize);gn(e,u,f,h,i,void 0,c,_,l,t)}}),cy=Ve(()=>{"use strict";bt(),St(),mr(),$t(),lw=e=>{if(!e||e.length<1)throw new Error("too few inputs")},cw=(e,r)=>{let t=[],s=r.numOutputs;return e[1].dims[0]>0&&(e[1].getBigInt64Array().forEach(o=>t.push(Number(o))),s=t.length),qt({numOutputs:s,axis:r.axis,splitSizes:t})},dw=e=>`\nfn calculateOutputIndex(index: u32) -> u32 {\n    for (var i: u32 = 0u; i < ${e}u; i += 1u ) {\n    if (index < ${ct("uniforms.size_in_split_axis","i",e)}) {\n        return i;\n    }\n    }\n    return ${e}u;\n}`,uw=e=>{let r=e.length,t=[];for(let s=0;s<r;++s){let o=e[s].setByIndices("indices","input[global_idx]");r===1?t.push(o):s===0?t.push(`if (output_number == ${s}u) { ${o} }`):s===r-1?t.push(`else { ${o} }`):t.push(`else if (output_number == ${s}) { ${o} }`)}return`\n      fn writeBufferData(output_number: u32, indices: ${e[0].type.indices}, global_idx: u32) {\n        ${t.join(`\n`)}\n      }`},Td=(e,r)=>{let t=e[0].dims,s=we.size(t),o=e[0].dataType,a=we.normalizeAxis(r.axis,t.length),n=new Array(r.numOutputs),i=Ee("input",o,t.length),l=new Array(r.numOutputs),c=[],_=[],d=0,u=[{type:12,data:s}];for(let h=0;h<r.numOutputs;h++){d+=r.splitSizes[h],l[h]=d;let v=t.slice();v[a]=r.splitSizes[h],_.push(v),n[h]=nt(`output${h}`,o,v.length),c.push({dims:_[h],dataType:e[0].dataType})}u.push({type:12,data:l},...pt(t,..._));let f=h=>`\n  ${h.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",l.length).declareVariables(i,...n)}\n  ${dw(l.length)}\n  ${uw(n)}\n\n  ${h.mainStart()}\n    ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}\n\n    var indices = ${i.offsetToIndices("global_idx")};\n    var index = ${i.indicesGet("indices",a)};\n    let output_number = calculateOutputIndex(index);\n    if (output_number != 0) {\n      index -= ${ct("uniforms.size_in_split_axis","output_number - 1u",l.length)};\n      ${i.indicesSet("indices",a,"index")};\n    }\n    writeBufferData(output_number, indices, global_idx);\n  }`;return{name:"Split",shaderCache:{hint:r.cacheKey,inputDependencies:["rank"]},getShaderSource:f,getRunData:()=>({outputs:c,dispatchGroup:{x:Math.ceil(s/64)},programUniforms:u})}},iy=(e,r)=>{lw(e.inputs);let t=e.inputs.length===1?r:cw(e.inputs,r);e.compute(Td(e.inputs,t),{inputs:[0]})},ly=e=>{let r=e.axis,t=e.splitSizes,s=e.numOutputs<0?t.length:e.numOutputs;if(s!==t.length)throw new Error("numOutputs and splitSizes lengh must be equal");return qt({axis:r,numOutputs:s,splitSizes:t})}}),uy=Ve(()=>{"use strict";bt(),St(),mr(),$t(),_w=(e,r)=>{let[t,s,o,a]=e,{numHeads:n,rotaryEmbeddingDim:i}=r;if(t.dims.length!==3&&t.dims.length!==4)throw new Error(`Input \'x\' is expected to have 3 or 4 dimensions, got ${t.dims.length}`);if(!we.areEqual(s.dims,[])&&!we.areEqual(s.dims,[1])&&s.dims.length!==2)throw new Error(`Input \'position_ids\' is expected to have 0, 1, or 2 dimensions, got ${s.dims.length}`);if(o.dims.length!==2)throw new Error(`Input \'cos_cache\' is expected to have 2 dimensions, got ${o.dims.length}`);if(a.dims.length!==2)throw new Error(`Input \'sin_cache\' is expected to have 2 dimensions, got ${a.dims.length}`);if(!we.areEqual(o.dims,a.dims))throw new Error("Inputs \'cos_cache\' and \'sin_cache\' are expected to have the same shape");if(i>0&&n===0)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let l=t.dims[0],c=t.dims[t.dims.length-2],_=o.dims[0],d=we.sizeFromDimension(t.dims,1)/c,u=i===0?o.dims[1]*2:d/n;if(i>u)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(s.dims.length===2){if(l!==s.dims[0])throw new Error(`Input \'position_ids\' dimension 0 should be of size batch_size, got ${s.dims[0]}`);if(c!==s.dims[1])throw new Error(`Input \'position_ids\' dimension 1 should be of size sequence_length, got ${s.dims[1]}`)}if(u/2!==o.dims[1]&&i/2!==o.dims[1])throw new Error(`Input \'cos_cache\' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ${o.dims[1]}`);if(c>_)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},Vi=(e,r)=>{let{interleaved:t,numHeads:s,rotaryEmbeddingDim:o,scale:a}=r,n=e[0].dims[0],i=we.sizeFromDimension(e[0].dims,1),l=e[0].dims[e[0].dims.length-2],c=i/l,_=e[2].dims[1],d=o===0?_*2:c/s,u=new Array(n,l,c/d,d-_),f=we.computeStrides(u),h=[{type:1,data:a},{type:12,data:u},{type:12,data:f},...e[0].dims.length===3?new Array({type:12,data:[i,c,d,1]}):[],...e[0].dims.length===4?new Array({type:12,data:[i,d,l*d,1]}):[],...pt(e[0].dims,e[1].dims,e[2].dims,e[3].dims,e[0].dims)],v=E=>{let M=Ee("input",e[0].dataType,e[0].dims.length),w=Ee("position_ids",e[1].dataType,e[1].dims.length),C=Ee("cos_cache",e[2].dataType,e[2].dims.length),x=Ee("sin_cache",e[3].dataType,e[3].dims.length),T=nt("output",e[0].dataType,e[0].dims.length);return E.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:u.length},{name:"global_strides",type:"u32",length:f.length},{name:"input_output_strides",type:"u32",length:f.length}]),`\n        ${E.declareVariables(M,w,C,x,T)}\n\n        ${E.mainStart(mo)}\n          let half_rotary_emb_dim = uniforms.${C.name}_shape[1];\n          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;\n          let size = uniforms.global_shape[0] * uniforms.global_strides[0];\n          ${E.guardAgainstOutOfBoundsWorkgroupSizes("size")}\n\n          if (bsnh[3] < half_rotary_emb_dim) {\n            let position_ids_idx =\n                ${w.broadcastedIndicesToOffset("bsnh.xy",nt("",w.type.tensor,2))};\n            let position_id =\n                u32(${w.getByOffset("position_ids_idx")}) + select(0, bsnh[1], position_ids_idx == 0);\n            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ${t});\n            let j = i + select(half_rotary_emb_dim, 1, ${t});\n            let re = ${M.getByOffset("i")} * ${C.get("position_id","bsnh[3]")} -\n                ${M.getByOffset("j")} * ${x.get("position_id","bsnh[3]")};\n            ${T.setByOffset("i","re")}\n            let im = ${M.getByOffset("i")} * ${x.get("position_id","bsnh[3]")} +\n                ${M.getByOffset("j")} * ${C.get("position_id","bsnh[3]")};\n            ${T.setByOffset("j","im")}\n          } else {\n            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;\n            ${T.setByOffset("k",M.getByOffset("k"))}\n          }\n        }`};return{name:"RotaryEmbedding",shaderCache:{hint:qt({interleaved:t}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:v,getRunData:()=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(we.size(u)/mo)},programUniforms:h})}},dy=(e,r)=>{_w(e.inputs,r),e.compute(Vi(e.inputs,r))}}),ZT=Ve(()=>{"use strict";mr(),bt(),Wd(),ny(),cy(),ca(),uy(),$t(),pw=(e,r)=>{if(r.doRotary&&e.length<=7)throw new Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let t=e[0],s=e[1],o=e[2],a=e[3],n=e[4];if(r.doRotary!==0&&e.length<=7)throw new Error("cos_cast and sin_cache are expected if do_rotary attribute is non-zero");if(r.localWindowSize!==-1)throw new Error("Local attention is not supported");if(r.softcap!==0)throw new Error("Softcap is not supported");if(r.rotaryInterleaved!==0)throw new Error("Rotary interleaved is not supported");if(r.smoothSoftmax)throw new Error("Smooth softmax is not supported");if(t.dims.length!==3&&t.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let i=!1,l=t.dims[0],c=t.dims[1],_=t.dims.length===3?i?t.dims[2]/3:t.dims[2]:r.numHeads*t.dims[4],d=c,u=0,f=!s||s.dims.length===0,h=Math.floor(f?_/(r.numHeads+2*r.kvNumHeads):_/r.numHeads);f&&(_=h*r.numHeads);let v=a&&a.dims.length!==0,E=n&&n.dims.length!==0;if(v&&a.dims.length===4&&a.dims[0]===l&&a.dims[1]!==r.kvNumHeads&&a.dims[2]===r.kvNumHeads&&a.dims[3]===h)throw new Error("BSNH pastKey/pastValue is not supported");if(v&&E){if(a.dims.length!==4)throw new Error(\'Input "past_key" is expected to have 4 dimensions\');if(n.dims.length!==4)throw new Error(\'Input "past_value" is expected to have 4 dimensions\');u=a.dims[2]}else if(v||E)throw new Error(\'Input "past_key" and "past_value" shall be both present or both absent\');let M=1;if(s&&s.dims.length>0){if(t.dims.length!==3)throw new Error(\'Input "query" is expected to have 3 dimensions when key is given\');if(s.dims.length<3||s.dims.length>5)throw new Error(\'Input "key" is expected to have 3, 4, or 5 dimensions\');if(t.dims[0]!==s.dims[0])throw new Error(\'Input "query" and "key" shall have same dim 0 (batch size)\');if(s.dims.length===3){if(t.dims[2]%s.dims[2]!==0)throw new Error(\'Dimension 2 of "query" should be a multiple of "key"\');d=s.dims[1]}else if(s.dims.length===5){if(s.dims[2]!==r.numHeads||s.dims[3]!==2||s.dims[4]!==h)throw new Error(\'Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv\');if(o)throw new Error(\'Expect "value" be none when "key" has packed kv format.\');d=s.dims[1]}else{if(s.dims[1]!==r.numHeads||s.dims[3]!==h)throw new Error(\'Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key\');d=s.dims[2]}}else{if(t.dims.length!==3&&t.dims.length!==5)throw new Error(\'Input "query" is expected to have 3 or 5 dimensions when key is empty\');if(t.dims.length===5&&(t.dims[2]!==r.numHeads||t.dims[3]!==3))throw new Error(\'Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv\');M=3}let w=0,C=!1,x=r.kvNumHeads?h*r.kvNumHeads:_;if(o&&o.dims.length>0){if(o.dims.length!==3&&o.dims.length!==4)throw new Error(\'Input "value" is expected to have 3 or 4 dimensions\');if(t.dims[0]!==o.dims[0])throw new Error(\'Input "query" and "value" shall have same dim 0 (batch_size)\');if(o.dims.length===3){if(d!==o.dims[1])throw new Error(\'Input "key" and "value" shall have the same dim 1 (kv_sequence_length)\');x=o.dims[2]}else{if(d!==o.dims[2])throw new Error(\'Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)\');x=o.dims[1]*o.dims[3],C=!0}}let T=e.length>4?e[5]:void 0;if(T&&T.dims.length!==1&&T.dims[0]!==l)throw new Error(\'Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size\');return{batchSize:l,sequenceLength:c,pastSequenceLength:u,kvSequenceLength:d,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:_,vHiddenSize:x,headSize:h,vHeadSize:Math.floor(x/r.kvNumHeads),numHeads:r.numHeads,kvNumHeads:r.kvNumHeads,nReps:r.numHeads/r.kvNumHeads,pastPresentShareBuffer:!1,maskType:w,scale:r.scale,broadcastResPosBias:!1,passPastInKv:C,qkvFormat:M}},mw=qt({perm:[0,2,1,3]}),Gc=(e,r,t)=>{let s=r,o=t.kvNumHeads;return r.dims.length===3&&t.kvSequenceLength!==0&&(s=r.reshape([t.batchSize,t.kvSequenceLength,o,t.headSize]),s=e.compute(_s(s,mw.perm),{inputs:[s],outputs:[-1]})[0]),s},hw=(e,r,t,s)=>{let o=7,a=["type","type"],n=[e*r],i=e*r,l=[{type:12,data:i},{type:12,data:r},{type:12,data:e}],c=_=>{let d=Ee("seq_lens",t.dataType,t.dims),u=Ee("total_seq_lens",s.dataType,s.dims),f=nt("pos_ids",o,n),h=[{name:"output_size",type:"u32"},{name:"sequence_length",type:"u32"},{name:"batch_size",type:"u32"}];return`\n  ${_.registerUniforms(h).declareVariables(d,u,f)}\n  ${_.mainStart()}\n    ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n    let total_sequence_length = u32(${u.getByOffset("0")});\n    let is_subsequent_prompt = uniforms.sequence_length > 1 && uniforms.sequence_length != total_sequence_length;\n    let is_first_prompt = !is_subsequent_prompt && uniforms.sequence_length == total_sequence_length;\n    let batch_idx = global_idx / uniforms.sequence_length;\n    let sequence_idx = i32(global_idx % uniforms.sequence_length);\n    var pos_id: i32 = 0;\n    let seqlen = ${d.getByOffset("batch_idx")};\n    let total_seqlen = seqlen + 1;\n    if (is_first_prompt) {\n      if (sequence_idx < total_seqlen) {\n        pos_id = sequence_idx;\n      } else {\n        pos_id = 1;\n      }\n      ${f.setByOffset("global_idx","pos_id")}\n    } else if (is_subsequent_prompt) {\n      let past_seqlen = total_seqlen - i32(uniforms.sequence_length);\n      if (past_seqlen + sequence_idx < total_seqlen) {\n        pos_id = past_seqlen + sequence_idx;\n      } else {\n        pos_id = 1;\n      }\n      ${f.setByOffset("global_idx","pos_id")}\n    } else if (global_idx < uniforms.batch_size) {\n      ${f.setByOffset("global_idx","seqlen")}\n    };\n  }\n  `};return{name:"GeneratePositionIds",shaderCache:{hint:`${e};${r}`,inputDependencies:a},getRunData:()=>({outputs:[{dims:n,dataType:o}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:l}),getShaderSource:c}},_y=(e,r)=>{var x;let t=pw(e.inputs,r);if(e.inputs[0].dims.length===5)throw new Error("Packed QKV is not implemented");if(((x=e.inputs[1])==null?void 0:x.dims.length)===5)throw new Error("Packed KV is not implemented");let s=e.inputs[0],o=e.inputs[1]&&e.inputs[1].dims.length>0?e.inputs[1]:void 0,a=e.inputs[2]&&e.inputs[2].dims.length>0?e.inputs[2]:void 0,n=e.inputs[3]&&e.inputs[3].dims.length!==0?e.inputs[3]:void 0,i=e.inputs[4]&&e.inputs[4].dims.length!==0?e.inputs[4]:void 0,l=e.inputs.length>4?e.inputs[5]:void 0,c=e.inputs.length>5?e.inputs[6]:void 0,_=t.kvNumHeads?t.kvNumHeads:t.numHeads,d=qt({axis:2,numOutputs:3,splitSizes:[t.numHeads*t.headSize,_*t.headSize,_*t.headSize]}),[u,f,h]=!o&&!a?e.compute(Td([s],d),{inputs:[s],outputs:[-1,-1,-1]}):[s,o,a],v,E;if(r.doRotary){let T=e.compute(hw(t.batchSize,t.sequenceLength,l,c),{inputs:[l,c],outputs:[-1]})[0],S=e.inputs[7],g=e.inputs[8],P=qt({interleaved:r.rotaryInterleaved!==0,numHeads:t.numHeads,rotaryEmbeddingDim:0,scale:r.scale}),$=[u,T,S,g],A=[-1];v=e.compute(Vi($,P),{inputs:$,outputs:A})[0],$.splice(0,1,f);let N=qt({interleaved:r.rotaryInterleaved!==0,numHeads:t.kvNumHeads,rotaryEmbeddingDim:0,scale:r.scale});E=e.compute(Vi($,N),{inputs:$,outputs:A})[0]}let M=pn(e,t.batchSize,t.numHeads,t.sequenceLength,t.headSize,r.doRotary?v:u,void 0,0),w=Gc(e,r.doRotary?E:f,t),C=Gc(e,h,t);gn(e,M,w,C,void 0,void 0,n,i,void 0,t,l,c)}}),eP=Ve(()=>{"use strict";bt(),St(),ca(),$t(),Kc=(e,r,t,s,o,a,n,i)=>{let l=pr(a),c=l===1?"f32":`vec${l}f`,_=l===1?"vec2f":`mat2x${l}f`,d=o*n,u=64;d===1&&(u=256);let f=[o,n,a/l],h=[o,n,2],v=["rank","type","type"],E=[];E.push(...pt(f,h));let M=w=>{let C=Ee("x",r.dataType,3,l),x=Ee("scale",t.dataType,t.dims),T=Ee("bias",s.dataType,s.dims),S=nt("output",1,3,2),g=[C,x,T,S];return`\n  var<workgroup> workgroup_shared : array<${_}, ${u}>;\n  const workgroup_size = ${u}u;\n  ${w.declareVariables(...g)}\n  ${w.mainStart(u)}\n    let batch = workgroup_index / uniforms.x_shape[1];\n    let channel = workgroup_index % uniforms.x_shape[1];\n    let hight = uniforms.x_shape[2];\n    // initialize workgroup memory\n    var sum = ${c}(0);\n    var squared_sum = ${c}(0);\n    for (var h = local_idx; h < hight; h += workgroup_size) {\n      let value = ${c}(${C.get("batch","channel","h")});\n      sum += value;\n      squared_sum += value * value;\n    }\n    workgroup_shared[local_idx] = ${_}(sum, squared_sum);\n    workgroupBarrier();\n\n    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {\n      if (local_idx < currSize) {\n        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];\n      }\n      workgroupBarrier();\n    }\n    if (local_idx == 0) {\n      let sum_final = ${la("workgroup_shared[0][0]",l)} / f32(hight * ${l});\n      let squared_sum_final = ${la("workgroup_shared[0][1]",l)} / f32(hight * ${l});\n\n      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(${i}));\n      let channel_scale = inv_std_dev * f32(scale[channel]);\n      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;\n      output[workgroup_index] = vec2f(channel_scale, channel_shift);\n    }\n  }`};return e.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${l};${i};${u}`,inputDependencies:v},getRunData:()=>({outputs:[{dims:h,dataType:1}],dispatchGroup:{x:d},programUniforms:E}),getShaderSource:M},{inputs:[r,t,s],outputs:[-1]})[0]},fw=(e,r,t)=>{let s=r[0].dims,o=s,a=2,n=s[0],i=s[1],l=we.sizeFromDimension(s,a),c=pr(l),_=we.size(o)/c,d=Kc(e,r[0],r[1],r[2],n,l,i,t.epsilon),u=[n,i,l/c],f=[n,i],h=["type","none"],v=E=>{let M=Ee("x",r[0].dataType,u.length,c),w=Ee("scale_shift",1,f.length,2),C=nt("output",r[0].dataType,u.length,c),x=[M,w,C];return`\n  ${E.registerUniform("output_size","u32").declareVariables(...x)}\n  ${E.mainStart()}\n  ${E.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n      let outputIndices = ${C.offsetToIndices("global_idx")};\n      let batch = outputIndices[0];\n      let channel = outputIndices[1];\n      let scale_shift = ${w.getByIndices("vec2<u32>(batch, channel)")};\n      let value = ${M.getByOffset("global_idx")} * ${C.type.value}(scale_shift.x) + ${C.type.value}(scale_shift.y);\n      ${C.setByOffset("global_idx","value")};\n  }`};e.compute({name:"InstanceNormalization",shaderCache:{hint:`${c}`,inputDependencies:h},getRunData:()=>({outputs:[{dims:o,dataType:r[0].dataType}],dispatchGroup:{x:Math.ceil(_/64)},programUniforms:[{type:12,data:_},...pt(u,f,u)]}),getShaderSource:v},{inputs:[r[0],d]})},gw=(e,r,t)=>{let s=r[0].dims,o=s,a=s[0],n=s[s.length-1],i=we.sizeFromDimension(s,1)/n,l=pr(n),c=we.size(o)/l,_=[{type:12,data:i},{type:12,data:Math.floor(n/l)}],d=["type","type"],u=!1,f=[0,s.length-1];for(let M=0;M<s.length-2;M++)u=u||s[M+1]!==1,f.push(M+1);u=u&&s[s.length-1]!==1;let h=u?e.compute(_s(e.inputs[0],f),{inputs:[e.inputs[0]],outputs:[-1]})[0]:e.inputs[0].reshape(Array.from({length:s.length},(M,w)=>s[f[w]])),v=Kc(e,h,r[1],r[2],a,i,n,t.epsilon),E=M=>{let w=Ar(r[0].dataType),C=l===1?"vec2f":`mat${l}x2f`,x=g=>{let P=g===0?"x":"y",$=l===1?"f32":`vec${l}f`;switch(l){case 1:return`${w}(${$}(scale.${P}))`;case 2:return`vec2<${w}>(${$}(scale[0].${P}, scale[1].${P}))`;case 4:return`vec4<${w}>(${$}(scale[0].${P}, scale[1].${P}, scale[2].${P}, scale[3].${P}))`;default:throw new Error(`Not supported compoents ${l}`)}},T=Ee("input",r[0].dataType,r[0].dims,l),S=nt("output",r[0].dataType,o,l);return`\n  @group(0) @binding(0) var<storage, read> input : array<${T.type.storage}>;\n  @group(0) @binding(1) var<storage, read> scale_input : array<${C}>;\n  @group(0) @binding(2) var<storage, read_write> output : array<${S.type.storage}>;\n  struct Uniforms {H: u32, C : u32};\n  @group(0) @binding(3) var<uniform> uniforms: Uniforms;\n\n  ${M.mainStart()}\n    let current_image_number = global_idx / (uniforms.C * uniforms.H);\n    let current_channel_number = global_idx % uniforms.C;\n\n    let scale_offset = current_image_number * uniforms.C + current_channel_number;\n    let scale = scale_input[scale_offset];\n    output[global_idx] = fma(input[global_idx], ${x(0)}, ${x(1)});\n  }`};e.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${l}`,inputDependencies:d},getRunData:()=>({outputs:[{dims:o,dataType:r[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:_}),getShaderSource:E},{inputs:[r[0],v]})},py=(e,r)=>{r.format==="NHWC"?gw(e,e.inputs,r):fw(e,e.inputs,r)}}),tP=Ve(()=>{"use strict";bt(),St(),$t(),Mw=e=>{if(!e||e.length<2)throw new Error("layerNorm requires at least 2 inputs.")},ww=(e,r,t)=>{let s=r.simplified,o=e[0].dims,a=e[1],n=!s&&e[2],i=o,l=we.normalizeAxis(r.axis,o.length),c=we.sizeToDimension(o,l),_=we.sizeFromDimension(o,l),d=we.size(a.dims),u=n?we.size(n.dims):0;if(d!==_||n&&u!==_)throw new Error(`Size of X.shape()[axis:] == ${_}.\n       Size of scale and bias (if provided) must match this.\n       Got scale size of ${d} and bias size of ${u}`);let f=[];for(let T=0;T<o.length;++T)T<l?f.push(o[T]):f.push(1);let h=pr(_),v=["type","type"],E=[{type:12,data:c},{type:1,data:_},{type:12,data:Math.floor(_/h)},{type:1,data:r.epsilon}];n&&v.push("type");let M=t>1,w=t>2,C=T=>{let S=Ar(e[0].dataType),g=[Ee("x",e[0].dataType,e[0].dims,h),Ee("scale",a.dataType,a.dims,h)];n&&g.push(Ee("bias",n.dataType,n.dims,h)),g.push(nt("output",e[0].dataType,i,h)),M&&g.push(nt("mean_data_output",1,f)),w&&g.push(nt("inv_std_output",1,f));let P=[{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}];return`\n  ${T.registerUniforms(P).declareVariables(...g)}\n  ${T.mainStart()}\n    ${T.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}\n    let offset = global_idx * uniforms.norm_size_vectorized;\n    var mean_vector = ${hd("f32",h)};\n    var mean_square_vector = ${hd("f32",h)};\n\n    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {\n      let value = ${_o(S,h,"x[h + offset]")};\n      mean_vector += value;\n      mean_square_vector += value * value;\n    }\n    let mean = ${la("mean_vector",h)} / uniforms.norm_size;\n    let inv_std_dev = inverseSqrt(${la("mean_square_vector",h)} / uniforms.norm_size ${s?"":"- mean * mean"} + uniforms.epsilon);\n\n    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {\n      let f32input = ${_o(S,h,"x[j + offset]")};\n      let f32scale = ${_o(S,h,"scale[j]")};\n      output[j + offset] = ${g[0].type.value}((f32input ${s?"":"- mean"}) * inv_std_dev * f32scale\n        ${n?`+ ${_o(S,h,"bias[j]")}`:""}\n      );\n    }\n\n    ${M?"mean_data_output[global_idx] = mean":""};\n    ${w?"inv_std_output[global_idx] = inv_std_dev":""};\n  }`},x=[{dims:i,dataType:e[0].dataType}];return M&&x.push({dims:f,dataType:1}),w&&x.push({dims:f,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${h};${t};${s}`,inputDependencies:v},getRunData:()=>({outputs:x,dispatchGroup:{x:Math.ceil(c/64)},programUniforms:E}),getShaderSource:C}},my=(e,r)=>{Mw(e.inputs),e.compute(ww(e.inputs,r,e.outputCount))}}),rP=Ve(()=>{"use strict";St(),qd(),Qd(),bw=e=>{if(!e||e.length!==2)throw new Error("MatMul requires 2 inputs.");if(e[0].dims[e[0].dims.length-1]!==e[1].dims[e[1].dims.length-2])throw new Error("shared dimension does not match.")},hy=e=>{bw(e.inputs);let r=po.calcShape(e.inputs[0].dims,e.inputs[1].dims,!0);if(!r)throw new Error("Can\'t use matmul on the given tensors");let t=r[r.length-1],s=e.inputs[0].dims[e.inputs[0].dims.length-1];if(t<8&&s<8)e.compute(Hd(e.inputs,{activation:""},r));else{let o=r[r.length-2],a=we.size(e.inputs[0].dims.slice(0,-2)),n=we.size(e.inputs[1].dims.slice(0,-2));if(a!==1&&o===1&&n===1){let i=e.inputs[0].reshape([1,a,s]),l=e.inputs[1].reshape([1,s,t]),c=[1,a,t],_=[i,l];e.compute(ji(_,{activation:""},r,c),{inputs:_})}else e.compute(ji(e.inputs,{activation:""},r))}}}),sP=Ve(()=>{"use strict";bt(),St(),mr(),$t(),vw=(e,r)=>{if(e.length<3||e.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let t=e[0],s=t.dims.length;if(t.dims[s-1]!==r.k)throw new Error("The last dim of input shape does not match the k value");let o=Math.floor((r.k+r.blockSize-1)/r.blockSize),a=r.blockSize/8*r.bits,n=e[1];if(!we.areEqual(n.dims,[r.n,o,a]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let i=e[2].dims;if(we.size(i)!==r.n*o)throw new Error("scales input size error.");if(e.length===4){let l=e[3].dims,c=r.bits>4?r.n*o:r.n*Math.floor((o+1)/2);if(we.size(l)!==c)throw new Error("zeroPoints input size error.")}},xw=(e,r)=>{let t=e[0].dims,s=t.length,o=t[s-2],a=r.k,n=r.n,i=t.slice(0,s-2),l=we.size(i),c=e[1].dims[2]/4,_=e[0].dataType,d=pr(r.k),u=pr(c),f=pr(n),h=i.concat([o,n]),v=o>1&&n/f%2===0?2:1,E=we.size(h)/f/v,M=64,w=[],C=[l,o,a/d],x=we.convertShape(e[1].dims).slice();x.splice(-1,1,c/u),w.push(...pt(C)),w.push(...pt(x)),w.push(...pt(e[2].dims)),e.length===4&&w.push(...pt(we.convertShape(e[3].dims)));let T=[l,o,n/f];w.push(...pt(T));let S=g=>{let P=C.length,$=Ee("a",e[0].dataType,P,d),A=Ee("b",12,x.length,u),N=Ee("scales",e[2].dataType,e[2].dims.length),W=[$,A,N],R=e.length===4?Ee("zero_points",12,e[3].dims.length):void 0;R&&W.push(R);let J=T.length,H=nt("output",e[0].dataType,J,f),q=Ar(e[0].dataType),X=(()=>{switch(d){case 1:return`array<${q}, 8>`;case 2:return`mat4x2<${q}>`;case 4:return`mat2x4<${q}>`;default:throw new Error(`${d}-component is not supported.`)}})(),ae=()=>{let B=`\n          // reuse a data\n            var input_offset = ${$.indicesToOffset(`${$.type.indices}(batch, row, word_offset)`)};\n            var a_data: ${X};\n            for (var j: u32 = 0; j < ${8/d}; j++) {\n              a_data[j] = ${$.getByOffset("input_offset")};\n              input_offset++;\n            }\n          `;for(let D=0;D<f*v;D++)B+=`\n            b_value = ${u===1?`b${D}_data`:`b${D}_data[i]`};\n            b_value_lower = unpack4xU8(b_value & b_mask);\n            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);\n            b_quantized_values = ${X}(${Array.from({length:4},(K,re)=>`${q}(b_value_lower[${re}]), ${q}(b_value_upper[${re}])`).join(", ")});\n            b_dequantized_values = ${d===1?`${X}(${Array.from({length:8},(K,re)=>`(b_quantized_values[${re}] - ${R?`zero_point${D}`:"zero_point"}) * scale${D}`).join(", ")});`:`(b_quantized_values - ${X}(${Array(8).fill(`${R?`zero_point${D}`:"zero_point"}`).join(",")})) * scale${D};`};\n            workgroup_shared[local_id.x * ${v} + ${Math.floor(D/f)}]${f>1?`[${D%f}]`:""} += ${Array.from({length:8/d},(K,re)=>`${d===1?`a_data[${re}] * b_dequantized_values[${re}]`:`dot(a_data[${re}], b_dequantized_values[${re}])`}`).join(" + ")};\n          `;return B},ce=()=>{let B=`\n            var col_index = col * ${f};\n            ${R?`\n            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;\n            var zero_point_byte_count: u32;\n            var zero_point_word_index: u32;\n            var zero_point_byte_offset: u32;\n            let zero_point_nibble_offset: u32 = block & 0x1u;\n            var zero_point_bits_offset: u32;\n            var zero_point_word: u32;`:`\n            // The default zero point is 8 for unsigned 4-bit quantization.\n            let zero_point = ${q}(8);`}\n            `;for(let D=0;D<f*v;D++)B+=`\n            let scale${D} = ${N.getByOffset("col_index * nBlocksPerCol + block")};\n            ${R?`\n            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);\n            zero_point_word_index = zero_point_byte_count >> 0x2u;\n            zero_point_byte_offset = zero_point_byte_count & 0x3u;\n            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);\n            zero_point_word = ${R.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;\n            let zero_point${D} = ${q}((zero_point_word) & 0xFu);`:""}\n            col_index += 1;`;return B},he=()=>{let B=`col_index = col * ${f};`;for(let D=0;D<f*v;D++)B+=`\n            let b${D}_data = ${A.getByIndices(`${A.type.indices}(col_index, block, word)`)};\n            col_index += 1;`;return B+=`\n            var b_value: u32;\n            let b_mask: u32 = 0x0F0F0F0Fu;\n            var b_value_lower: vec4<u32>;\n            var b_value_upper: vec4<u32>;\n            var b_quantized_values: ${X};\n            var b_dequantized_values: ${X};`,B};return`\n        var<workgroup> workgroup_shared: array<${H.type.value}, ${v*M}>;\n        ${g.declareVariables(...W,H)}\n        ${g.mainStart([M,1,1])}\n          let output_indices = ${H.offsetToIndices(`(global_idx / ${M}) * ${v}`)};\n          let col = output_indices[2];\n          let row = output_indices[1];\n          let batch = output_indices[0];\n          let nBlocksPerCol = uniforms.b_shape[1];\n\n          for (var block = local_id.x; block < nBlocksPerCol; block += ${M}) {\n            //process one block\n            var word_offset: u32 = block * ${r.blockSize/d};\n            ${ce()}\n            for (var word: u32 = 0; word < ${c}; word += ${u}) {\n              ${he()}\n              for (var i: u32 = 0; i < ${u}; i++) {\n                ${ae()}\n                word_offset += ${8/d};\n              }\n            }\n          }\n          workgroupBarrier();\n\n          if (local_id.x < ${v}) {\n            var output_value: ${H.type.value} = ${H.type.value}(0);\n            var workgroup_shared_offset: u32 = local_id.x;\n            for (var b: u32 = 0u; b < ${M}u; b++) {\n              output_value += workgroup_shared[workgroup_shared_offset];\n              workgroup_shared_offset += ${v};\n            }\n            ${H.setByIndices(`${H.type.indices}(batch, row, col + local_id.x)`,"output_value")};\n          }\n        }`};return{name:"MatMulNBits",shaderCache:{hint:`${r.blockSize};${r.bits};${d};${u};${f};${v};${M}`,inputDependencies:Array(e.length).fill("rank")},getRunData:()=>({outputs:[{dims:h,dataType:_}],dispatchGroup:{x:E},programUniforms:w}),getShaderSource:S}},yw=(e,r)=>{let t=e[0].dims,s=t.length,o=t[s-2],a=r.k,n=r.n,i=t.slice(0,s-2),l=we.size(i),c=e[1].dims[2]/4,_=e[0].dataType,d=pr(r.k),u=pr(c),f=i.concat([o,n]),h=128,v=n%8===0?8:n%4===0?4:1,E=h/v,M=E*u*8,w=M/d,C=M/r.blockSize,x=we.size(f)/v,T=[],S=[l,o,a/d],g=we.convertShape(e[1].dims).slice();g.splice(-1,1,c/u),T.push(...pt(S)),T.push(...pt(g)),T.push(...pt(e[2].dims)),e.length===4&&T.push(...pt(we.convertShape(e[3].dims)));let P=[l,o,n];T.push(...pt(P));let $=A=>{let N=S.length,W=Ee("a",e[0].dataType,N,d),R=Ee("b",12,g.length,u),J=Ee("scales",e[2].dataType,e[2].dims.length),H=[W,R,J],q=e.length===4?Ee("zero_points",12,e[3].dims.length):void 0;q&&H.push(q);let X=P.length,ae=nt("output",e[0].dataType,X),ce=Ar(e[0].dataType),he=()=>{switch(d){case 1:return`\n          let a_data0 = vec4<${ce}>(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);\n          let a_data1 = vec4<${ce}>(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);`;case 2:return`\n          let a_data0 = vec4<${ce}>(sub_a[word_offset], sub_a[word_offset + 1]);\n          let a_data1 = vec4<${ce}>(sub_a[word_offset + 2], sub_a[word_offset + 3]);`;case 4:return`\n          let a_data0 = sub_a[word_offset];\n          let a_data1 = sub_a[word_offset + 1];`;default:throw new Error(`${d}-component is not supported.`)}};return`\n        var<workgroup> sub_a: array<${W.type.value}, ${w}>;\n        var<workgroup> inter_results: array<array<${ae.type.value}, ${E}>, ${v}>;\n        ${A.declareVariables(...H,ae)}\n        ${A.mainStart([E,v,1])}\n          let output_indices = ${ae.offsetToIndices(`workgroup_index * ${v}`)};\n          let col = output_indices[2];\n          let row = output_indices[1];\n          let batch = output_indices[0];\n          let n_blocks_per_col = uniforms.b_shape[1];\n          let num_tiles =  (n_blocks_per_col - 1) / ${C} + 1;\n\n          // Loop over shared dimension.\n          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {\n            let a_col_start = tile * ${w};\n            // load one tile A data into shared memory.\n            for (var a_offset = local_idx; a_offset < ${w}; a_offset += ${h})\n            {\n              let a_col = a_col_start + a_offset;\n              if (a_col < uniforms.a_shape[2])\n              {\n                sub_a[a_offset] = ${W.getByIndices(`${W.type.indices}(batch, row, a_col)`)};\n              } else {\n                sub_a[a_offset] = ${W.type.value}(0);\n              }\n            }\n            workgroupBarrier();\n\n            // each thread process one block\n            let b_row = col + local_id.y;\n            let block = tile * ${C} + local_id.x;\n            ${q?`\n            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;\n            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);\n            let zero_point_word_index = zero_point_byte_count >> 0x2u;\n            let zero_point_byte_offset = zero_point_byte_count & 0x3u;\n            let zero_point_nibble_offset: u32 = block & 0x1u;\n            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);\n            let zero_point_word = ${q.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;\n            let zero_point = ${ce}((zero_point_word) & 0xFu);`:`\n            // The default zero point is 8 for unsigned 4-bit quantization.\n            let zero_point = ${ce}(8);`}\n            let scale = ${J.getByOffset("b_row * n_blocks_per_col + block")};\n            let b_data = ${R.getByIndices(`${R.type.indices}(b_row, block, 0)`)};\n            var word_offset = local_id.x * ${r.blockSize/d};\n            for (var i: u32 = 0; i < ${u}; i++) {\n              ${he()}\n              let b_value = ${u===1?"b_data":"b_data[i]"};\n              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);\n              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);\n              let b_quantized_values = mat2x4<${ce}>(${Array.from({length:4},(B,D)=>`${ce}(b_value_lower[${D}]), ${ce}(b_value_upper[${D}])`).join(", ")});\n              let b_dequantized_values = (b_quantized_values - mat2x4<${ce}>(${Array(8).fill("zero_point").join(",")})) * scale;\n              inter_results[local_id.y][local_id.x] += ${Array.from({length:2},(B,D)=>`${`dot(a_data${D}, b_dequantized_values[${D}])`}`).join(" + ")};\n              word_offset += ${8/d};\n            }\n            workgroupBarrier();\n          }\n\n          if (local_idx < ${v}) {\n            var output_value: ${ae.type.value} = ${ae.type.value}(0);\n            for (var b = 0u; b < ${E}; b++) {\n              output_value += inter_results[local_idx][b];\n            }\n            if (col + local_idx < uniforms.output_shape[2])\n            {\n              ${ae.setByIndices(`${ae.type.indices}(batch, row, col + local_idx)`,"output_value")}\n            }\n          }\n        }`};return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:`${r.blockSize};${d};${u};${E};${v}`,inputDependencies:Array(e.length).fill("rank")},getRunData:()=>({outputs:[{dims:f,dataType:_}],dispatchGroup:{x},programUniforms:T}),getShaderSource:$}},fy=(e,r)=>{vw(e.inputs,r),r.blockSize===32&&e.adapterInfo.isVendor("intel")&&e.adapterInfo.isArchitecture("gen-12lp")?e.compute(yw(e.inputs,r)):e.compute(xw(e.inputs,r))},gy=e=>qt(e)}),aP=Ve(()=>{"use strict";bt(),St(),$t(),Tw=e=>{if(!e||e.length<1)throw new Error("Too few inputs");if(e[0].dataType!==1&&e[0].dataType!==10)throw new Error("Input type must be float or float16.");if(e.length>=2){let r=e[0].dims.length*2===e[1].dims[0];if(e.length===4&&(r=e[3].dims[0]*2===e[1].dims[0]),!r)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},Pw=(e,r,t)=>{let s="";for(let o=r-1;o>=0;--o)s+=`\n            k = i32(${e.indicesGet("indices",o)}) - ${ct("uniforms.pads",o,t)};\n            if (k < 0) {\n              break;\n            }\n            if (k >= i32(${ct("uniforms.x_shape",o,r)})) {\n              break;\n            }\n            offset += k * i32(${ct("uniforms.x_strides",o,r)});\n        `;return`\n          value = ${e.type.value}(uniforms.constant_value);\n          for (var i = 0; i < 1; i++) {\n            var offset = 0;\n            var k = 0;\n            ${s}\n            value = x[offset];\n          }\n      `},Ew=(e,r,t)=>{let s="";for(let o=r-1;o>=0;--o)s+=`\n                k = i32(${e.indicesGet("indices",o)}) - ${ct("uniforms.pads",o,t)};\n                if (k < 0) {\n                  k = -k;\n                }\n                {\n                  let _2n_1 = 2 * (i32(${ct("uniforms.x_shape",o,r)}) - 1);\n                  k = k % _2n_1;\n                  if(k >= i32(${ct("uniforms.x_shape",o,r)})) {\n                    k = _2n_1 - k;\n                  }\n                }\n                offset += k * i32(${ct("uniforms.x_strides",o,r)});\n            `;return`\n              var offset = 0;\n              var k = 0;\n              ${s}\n              value = x[offset];\n          `},kw=(e,r,t)=>{let s="";for(let o=r-1;o>=0;--o)s+=`\n                k = i32(${e.indicesGet("indices",o)}) - ${ct("uniforms.pads",o,t)};\n                if (k < 0) {\n                  k = 0;\n                }\n                if (k >= i32(${ct("uniforms.x_shape",o,r)})) {\n                  k = i32(${ct("uniforms.x_shape",o,r)}) - 1;\n                }\n                offset += k * i32(${ct("uniforms.x_strides",o,r)});\n            `;return`\n              var offset = 0;\n              var k = 0;\n              ${s}\n              value = x[offset];\n          `},Cw=(e,r,t)=>{let s="";for(let o=r-1;o>=0;--o)s+=`\n                k = i32(${e.indicesGet("indices",o)}) - ${ct("uniforms.pads",o,t)};\n                if (k < 0)  {\n                  k += i32(${ct("uniforms.x_shape",o,r)}]);\n                }\n                if (k >= i32(${ct("uniforms.x_shape",o,r)})) {\n                  k -= i32(${ct("uniforms.x_shape",o,r)});\n                }\n                offset += k * i32(${ct("uniforms.x_strides",o,r)});\n            `;return`\n              var offset = 0;\n              var k = 0;\n              ${s}\n              value = x[offset];\n          `},Sw=(e,r,t)=>{switch(t.mode){case 0:return Pw(e,r,t.pads.length);case 1:return Ew(e,r,t.pads.length);case 2:return kw(e,r,t.pads.length);case 3:return Cw(e,r,t.pads.length);default:throw new Error("Invalid mode")}},Iw=(e,r)=>{let t=we.padShape(e[0].dims.slice(),r.pads),s=e[0].dims,o=we.size(t),a=[{type:12,data:o},{type:6,data:r.pads}],n=e.length>=3&&e[2].data;r.mode===0&&a.push({type:n?e[2].dataType:1,data:r.value}),a.push(...pt(e[0].dims,t));let i=["rank"],l=c=>{let _=nt("output",e[0].dataType,t.length),d=Ee("x",e[0].dataType,s.length),u=d.type.value,f=Sw(_,s.length,r),h=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:r.pads.length}];return r.mode===0&&h.push({name:"constant_value",type:n?u:"f32"}),`\n            ${c.registerUniforms(h).declareVariables(d,_)}\n            ${c.mainStart()}\n            ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n\n            let indices = ${_.offsetToIndices("global_idx")};\n\n            var value = ${u}(0);\n            ${f}\n            output[global_idx] = value;\n        }`};return{name:"Pad",shaderCache:{hint:`${r.mode}${n}`,inputDependencies:i},getRunData:()=>({outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(we.size(t)/64)},programUniforms:a}),getShaderSource:l}},Fw=(e,r)=>{if(e.length>1){let t=e[1].getBigInt64Array(),s=e.length>=3&&e[2].data?e[2].dataType===10?e[2].getUint16Array()[0]:e[2].getFloat32Array()[0]:0,o=e[0].dims.length,a=new Int32Array(2*o).fill(0);if(e.length>=4){let i=e[3].getBigInt64Array();for(let l=0;l<i.length;l++)a[Number(i[l])]=Number(t[l]),a[Number(i[l])+o]=Number(t[l+i.length])}else t.forEach((i,l)=>a[Number(l)]=Number(i));let n=[];return a.forEach(i=>n.push(i)),{mode:r.mode,value:s,pads:n}}else return r},My=(e,r)=>{Tw(e.inputs);let t=Fw(e.inputs,r);e.compute(Iw(e.inputs,t),{inputs:[0]})}}),oP=Ve(()=>{"use strict";As(),bt(),St(),$t(),on=e=>{if(nr.webgpu.validateInputContent&&(!e||e.length!==1))throw new Error("Pool ops requires 1 input.")},Hc=(e,r,t)=>{let s=r.format==="NHWC",o=e.dims.slice();s&&o.splice(1,0,o.pop());let a=Object.hasOwnProperty.call(r,"dilations"),n=r.kernelShape.slice(),i=r.strides.slice(),l=a?r.dilations.slice():[],c=r.pads.slice();Ri.adjustPoolAttributes(t,o,n,i,l,c);let _=Ri.computePoolOutputShape(t,o,i,l,n,c,r.autoPad),d=Object.assign({},r);a?Object.assign(d,{kernelShape:n,strides:i,pads:c,dilations:l,cacheKey:r.cacheKey}):Object.assign(d,{kernelShape:n,strides:i,pads:c,cacheKey:r.cacheKey});let u=_.slice();return u.push(u.splice(1,1)[0]),[d,s?u:_]},qc=(e,r)=>{let t=r.format==="NHWC",s=we.size(e),o=we.size(r.kernelShape),a=[{type:12,data:s},{type:12,data:o}],n=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(r.kernelShape.length<=2){let i=r.kernelShape[r.kernelShape.length-1],l=r.strides[r.strides.length-1],c=r.pads[r.pads.length/2-1],_=r.pads[r.pads.length-1],d=!!(c+_);a.push({type:12,data:i},{type:12,data:l},{type:12,data:c},{type:12,data:_}),n.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let u=!1;if(r.kernelShape.length===2){let f=r.kernelShape[r.kernelShape.length-2],h=r.strides[r.strides.length-2],v=r.pads[r.pads.length/2-2],E=r.pads[r.pads.length-2];u=!!(v+E),a.push({type:12,data:f},{type:12,data:h},{type:12,data:v},{type:12,data:E}),n.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[a,n,!0,d,u]}else{if(t)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let i=we.computeStrides(r.kernelShape);a.push({type:12,data:i},{type:12,data:r.pads},{type:12,data:r.strides}),n.push({name:"kernelStrides",type:"u32",length:i.length},{name:"pads",type:"u32",length:r.pads.length},{name:"strides",type:"u32",length:r.strides.length});let l=r.pads.reduce((c,_)=>c+_);return[a,n,!!l,!1,!1]}},Qc=(e,r,t,s,o,a,n,i,l,c,_,d)=>{let u=o.format==="NHWC",f=r.type.value,h=nt("output",r.type.tensor,s);if(o.kernelShape.length<=2){let v="",E="",M="",w=t-(u?2:1);if(_?v=`\n                for (var i: u32 = 0u; i < uniforms.kw; i++) {\n                  xIndices[${w}] = indices[${w}] * uniforms.sw - uniforms.pwStart + i;\n                  if (xIndices[${w}] < 0 || xIndices[${w}]\n                      >= uniforms.x_shape[${w}]) {\n                    pad++;\n                    continue;\n                  }\n                  let x_val = x[${r.indicesToOffset("xIndices")}];\n                  ${a}\n                }`:v=`\n                for (var i: u32 = 0u; i < uniforms.kw; i++) {\n                  xIndices[${w}] = indices[${w}] * uniforms.sw - uniforms.pwStart + i;\n                  let x_val = x[${r.indicesToOffset("xIndices")}];\n                  ${a}\n                }`,o.kernelShape.length===2){let C=t-(u?3:2);d?E=`\n                for (var j: u32 = 0u; j < uniforms.kh; j++) {\n                  xIndices[${C}] = indices[${C}] * uniforms.sh - uniforms.phStart + j;\n                  if (xIndices[${C}] < 0 || xIndices[${C}] >= uniforms.x_shape[${C}]) {\n                    pad += i32(uniforms.kw);\n                    continue;\n                  }\n              `:E=`\n                for (var j: u32 = 0u; j < uniforms.kh; j++) {\n                  xIndices[${C}] = indices[${C}] * uniforms.sh - uniforms.phStart + j;\n                `,M=`\n              }\n            `}return`\n            ${e.registerUniforms(l).declareVariables(r,h)}\n\n            ${e.mainStart()}\n              ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n\n              let indices = ${h.offsetToIndices("global_idx")};\n              var xIndices = ${h.offsetToIndices("global_idx")};\n\n              var value = ${f}(${i});\n              var pad = 0;\n              ${E}\n              ${v}\n              ${M}\n              ${n}\n\n              output[global_idx] = value;\n            }`}else{if(u)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let v=o.kernelShape.length,E=o.pads.length,M="";return c?M=`\n                if (xIndices[j] >= uniforms.x_shape[j]) {\n                  pad++;\n                  isPad = true;\n                  break;\n                }\n              }\n              if (!isPad) {\n                let x_val = x[${r.indicesToOffset("xIndices")}];\n                ${a}\n              }`:M=`\n              }\n              let x_val = x[${r.indicesToOffset("xIndices")}];\n              ${a}\n            `,`\n            ${e.registerUniforms(l).declareVariables(r,h)}\n\n            ${e.mainStart()}\n              ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n              let indices = ${h.offsetToIndices("global_idx")};\n              var xIndices = ${h.offsetToIndices("global_idx")};\n\n              var offsets: array<u32, ${v}>;\n\n              var value = ${f}(${i});\n              var pad = 0;\n              var isPad = false;\n\n              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {\n                var offset = i;\n                for (var j = 0u; j < ${v-1}u; j++) {\n                  offsets[j] = offset / ${ct("uniforms.kernelStrides","j",v)};\n                  offset -= offsets[j] * ${ct("uniforms.kernelStrides","j",v)};\n                }\n                offsets[${v-1}] = offset;\n\n                isPad = false;\n                for (var j = ${t-v}u; j < ${t}u; j++) {\n                  xIndices[j] = indices[j] * ${ct("uniforms.strides",`j - ${t-v}u`,v)}\n                    + offsets[j - ${t-v}u] - ${ct("uniforms.pads","j - 2u",E)};\n                  ${M}\n              }\n              ${n}\n\n              output[global_idx] = value;\n            }`}},Xc=e=>`${e.format};${e.ceilMode};${e.autoPad};${e.kernelShape.length}`,$w=e=>`${Xc(e)};${e.countIncludePad}`,Aw=e=>`${Xc(e)};${e.storageOrder};${e.dilations}`,Jc=e=>({format:e.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][e.auto_pad],ceilMode:e.ceil_mode,kernelShape:e.kernel_shape,strides:e.strides,pads:e.pads}),Yc=(e,r,t,s)=>{let[o,a]=Hc(r,s,t),n=Ee("x",r.dataType,r.dims.length),i=n.type.value,l="value += x_val;",c="";o.countIncludePad?c+=`value /= ${i}(uniforms.kernelSize);`:c+=`value /= ${i}(i32(uniforms.kernelSize) - pad);`;let[_,d,u,f,h]=qc(a,o);_.push(...pt(r.dims,a));let v=["rank"];return{name:e,shaderCache:{hint:`${s.cacheKey};${u};${f};${h}`,inputDependencies:v},getRunData:()=>({outputs:[{dims:a,dataType:r.dataType}],dispatchGroup:{x:Math.ceil(we.size(a)/64)},programUniforms:_}),getShaderSource:E=>Qc(E,n,r.dims.length,a.length,o,l,c,0,d,u,f,h)}},wy=e=>{let r=e.count_include_pad!==0,t=Jc(e);if(t.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let s=Ct(Fe({countIncludePad:r},t),{cacheKey:""});return Ct(Fe({},s),{cacheKey:$w(s)})},by=(e,r)=>{on(e.inputs),e.compute(Yc("AveragePool",e.inputs[0],!1,r))},Zc={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},vy=e=>{let r=e.format;return Ct(Fe({format:r},Zc),{cacheKey:r})},xy=(e,r)=>{on(e.inputs),e.compute(Yc("GlobalAveragePool",e.inputs[0],!0,r))},ed=(e,r,t,s)=>{let[o,a]=Hc(r,s,t),n=`\n      value = max(x_val, value);\n    `,i="",l=Ee("x",r.dataType,r.dims.length),c=["rank"],[_,d,u,f,h]=qc(a,o);return _.push(...pt(r.dims,a)),{name:e,shaderCache:{hint:`${s.cacheKey};${u};${f};${h}`,inputDependencies:c},getRunData:()=>({outputs:[{dims:a,dataType:r.dataType}],dispatchGroup:{x:Math.ceil(we.size(a)/64)},programUniforms:_}),getShaderSource:v=>Qc(v,l,r.dims.length,a.length,o,n,i,r.dataType===10?-65504:-1e5,d,u,f,h)}},yy=(e,r)=>{on(e.inputs),e.compute(ed("MaxPool",e.inputs[0],!1,r))},Ty=e=>{let r=e.storage_order,t=e.dilations,s=Jc(e);if(r!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(s.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let o=Ct(Fe({storageOrder:r,dilations:t},s),{cacheKey:""});return Ct(Fe({},o),{cacheKey:Aw(o)})},Py=e=>{let r=e.format;return Ct(Fe({format:r},Zc),{cacheKey:r})},Ey=(e,r)=>{on(e.inputs),e.compute(ed("GlobalMaxPool",e.inputs[0],!0,r))}}),nP=Ve(()=>{"use strict";bt(),St(),mr(),$t(),Dw=(e,r)=>{if(e.length<2||e.length>3)throw new Error("DequantizeLinear requires 2 or 3 inputs.");if(e.length===3&&e[1].dims===e[2].dims)throw new Error("x-scale and x-zero-point must have the same shape.");if(e.length===3&&e[0].dataType!==e[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(e[0].dataType===6&&e.length>2)throw new Error("In the case of dequantizing int32 there is no zero point.");if(e[1].dims.length!==0&&e[1].dims.length!==1&&e[1].dims.length!==e[0].dims.length)throw new Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(e.length>2){if(e[0].dataType!==e[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(e[1].dims.length!==e[2].dims.length)throw new Error("scale and zero-point inputs must have the same rank.");if(!e[1].dims.map((t,s)=>t===e[2].dims[s]).reduce((t,s)=>t&&s,!0))throw new Error("scale and zero-point inputs must have the same shape.")}if(r.blockSize>0){if(e[1].dims.length===0||e[1].dims.length===1&&e[1].dims[0]===1)throw new Error("blockSize must be set only for block quantization.");if(!e[1].dims.map((o,a)=>a===r.axis||o===e[0].dims[a]).reduce((o,a)=>o&&a,!0))throw new Error("For block qunatization, scale input shape to match the input shape except for the axis");if(e[1].dims.length!==e[0].dims.length)throw new Error("For block qunatization the scale input rank must be the same as the x rank.");let t=e[0].dims[r.axis],s=e[1].dims[r.axis];if(r.blockSize<Math.ceil(t/s)||r.blockSize>Math.ceil(t/(s-1)-1))throw new Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},Ow=(e,r)=>{let t=we.normalizeAxis(r.axis,e[0].dims.length),s=e[0].dataType,o=s===3,a=e[0].dims,n=e[1].dataType,i=we.size(a),l=s===3||s===2,c=l?[Math.ceil(we.size(e[0].dims)/4)]:e[0].dims,_=e[1].dims,d=e.length>2?e[2]:void 0,u=d?l?[Math.ceil(we.size(d.dims)/4)]:d.dims:void 0,f=_.length===0||_.length===1&&_[0]===1,h=f===!1&&_.length===1,v=pr(i),E=f&&(!l||v===4),M=E?v:1,w=E&&!l?v:1,C=Ee("input",l?12:s,c.length,w),x=Ee("scale",n,_.length),T=d?Ee("zero_point",l?12:s,u.length):void 0,S=nt("output",n,a.length,M),g=[C,x];T&&g.push(T);let P=[c,_];d&&P.push(u);let $=[{type:12,data:i/M},{type:12,data:t},{type:12,data:r.blockSize},...pt(...P,a)],A=N=>{let W=[{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}];return`\n      ${N.registerUniforms(W).declareVariables(...g,S)}\n      ${N.mainStart()}\n          ${N.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n          let output_indices = ${S.offsetToIndices("global_idx")};\n\n          // Set input x\n          ${l?`\n            let input = ${C.getByOffset("global_idx / 4")};\n            let x_vec = ${o?"unpack4xI8(input)":"unpack4xU8(input)"};\n            let x_value = ${M===1?"x_vec[global_idx % 4]":"x_vec"};`:`let x_value = ${C.getByOffset("global_idx")};`};\n\n          // Set scale input\n          ${f?`let scale_value= ${x.getByOffset("0")}`:h?`\n            let scale_index = ${S.indicesGet("output_indices","uniforms.axis")};\n            let scale_value= ${x.getByOffset("scale_index")};`:`\n            var scale_indices: ${x.type.indices} = output_indices;\n            let index = ${x.indicesGet("scale_indices","uniforms.axis")} / uniforms.block_size;\n            ${x.indicesSet("scale_indices","uniforms.axis","index")};\n            let scale_value= ${x.getByIndices("scale_indices")};`};\n\n          // Set zero-point input\n          ${T?f?l?`\n                let zero_point_input = ${T.getByOffset("0")};\n                let zero_point_vec =  ${o?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};\n                let zero_point_value= zero_point_vec[0]`:`let zero_point_value = ${T.getByOffset("0")}`:h?l?`\n                let zero_point_index = ${S.indicesGet("output_indices","uniforms.axis")};\n                let zero_point_input = ${T.getByOffset("zero_point_index / 4")};\n                let zero_point_vec =  ${o?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};\n                let zero_point_value = zero_point_vec[zero_point_index % 4]`:`\n                let zero_point_index = ${S.indicesGet("output_indices","uniforms.axis")};\n                let zero_point_value = ${T.getByOffset("zero_point_index")};`:l?`\n                let zero_point_offset = ${x.indicesToOffset("scale_indices")};\n                let zero_point_input = ${T.getByOffset("zero_point_offset / 4")};\n                let zero_point_vec = ${o?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};\n                let zero_point_value = zero_point_vec[zero_point_offset % 4];`:`let zero_point_value = ${T.getByIndices("scale_indices")};`:`let zero_point_value = ${l?o?"i32":"u32":C.type.value}(0);`};\n      // Compute and write output\n      ${S.setByOffset("global_idx",`${S.type.value}(x_value - zero_point_value) * scale_value`)};\n      }`};return{name:"DequantizeLinear",shaderCache:{hint:r.cacheKey,inputDependencies:T?["rank","rank","rank"]:["rank","rank"]},getShaderSource:A,getRunData:()=>({outputs:[{dims:a,dataType:n}],dispatchGroup:{x:Math.ceil(i/M/64),y:1,z:1},programUniforms:$})}},ky=(e,r)=>{Dw(e.inputs,r),e.compute(Ow(e.inputs,r))},Cy=e=>qt({axis:e.axis,blockSize:e.blockSize})}),iP=Ve(()=>{"use strict";As(),bt(),$t(),Lw=(e,r,t)=>{let s=e===r,o=e<r&&t<0,a=e>r&&t>0;if(s||o||a)throw new Error("Range these inputs\' contents are invalid.")},zw=(e,r,t,s)=>{let o=Math.abs(Math.ceil((r-e)/t)),a=[o],n=o,i=[{type:12,data:n},{type:s,data:e},{type:s,data:t},...pt(a)],l=c=>{let _=nt("output",s,a.length),d=_.type.value,u=[{name:"outputSize",type:"u32"},{name:"start",type:d},{name:"delta",type:d}];return`\n        ${c.registerUniforms(u).declareVariables(_)}\n        ${c.mainStart()}\n        ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n        output[global_idx] = uniforms.start + ${d}(global_idx) * uniforms.delta;\n      }`};return{name:"Range",shaderCache:{hint:`${s}`},getShaderSource:l,getRunData:()=>({outputs:[{dims:a,dataType:s}],dispatchGroup:{x:Math.ceil(n/64)},programUniforms:i})}},Sy=e=>{let r=0,t=0,s=0;e.inputs[0].dataType===6?(r=e.inputs[0].getInt32Array()[0],t=e.inputs[1].getInt32Array()[0],s=e.inputs[2].getInt32Array()[0]):e.inputs[0].dataType===1&&(r=e.inputs[0].getFloat32Array()[0],t=e.inputs[1].getFloat32Array()[0],s=e.inputs[2].getFloat32Array()[0]),nr.webgpu.validateInputContent&&Lw(r,t,s),e.compute(zw(r,t,s,e.inputs[0].dataType),{inputs:[]})}}),lP=Ve(()=>{"use strict";bt(),St(),mr(),$t(),Bw=(e,r,t,s)=>{if(e!=="none"&&s!=="i32"&&s!=="u32"&&s!=="f32")throw new Error(`Input ${s} is not supported with reduction ${e}.`);let o=`{\n                var oldValue = 0;\n                loop {\n                  let newValueF32 =`,a=`;\n                  let newValue = bitcast<i32>(newValueF32);\n                  let res = atomicCompareExchangeWeak(&${r}, oldValue, newValue);\n                  if res.exchanged {\n                    break;\n                  }\n                  oldValue = res.old_value;\n                }\n              }`;switch(e){case"none":return`${r}=${t};`;case"add":return s==="i32"||s==="u32"?`atomicAdd(&${r}, bitcast<${s}>(${t}));`:`\n              ${o}bitcast<${s}>(oldValue) + (${t})${a}`;case"max":return s==="i32"||s==="u32"?`atomicMax(&${r}, bitcast<${s}>(${t}));`:`\n                ${o}max(bitcast<f32>(oldValue), (${t}))${a}`;case"min":return s==="i32"||s==="u32"?`atomicMin(&${r}, bitcast<${s}>(${t}));`:`${o}min(bitcast<${s}>(oldValue), (${t}))${a}`;case"mul":return`${o}(bitcast<${s}>(oldValue) * (${t}))${a}`;default:throw new Error(`Reduction ${e} is not supported.`)}},td=(e,r)=>`${e===1?`\n    let element_count_dim = uniforms.output_strides;\n    let dim_value = uniforms.output_shape;`:`\n    let element_count_dim = uniforms.output_strides[${r?"i - indices_start":"i"}];\n    let dim_value = uniforms.output_shape[${r?"i - indices_start":"i"} + uniforms.last_index_dimension];`}\n    \n    if (index >= 0) {\n      if (index >= i32(dim_value)) {\n        index = i32(dim_value - 1);\n      }\n    } else {\n      if (index < -i32(dim_value)) {\n        index = 0;\n      } else {\n        index += i32(dim_value);\n      }\n    }\n    data_offset += u32((u32(index) * element_count_dim));`,rd=(e,r,t)=>`for (var i = 0u; i < uniforms.num_updates_elements; i++) {\n        let value = updates[uniforms.num_updates_elements * ${t?"global_idx":"idx"} + i];\n        ${Bw(e.reduction,"output[data_offset + i]","value",r)}\n      }`,Rw=(e,r)=>{let t=e[0].dims,s=e[1].dims,o=t,a=1,n=Math.ceil(we.size(s)/a),i=s[s.length-1],l=we.sizeFromDimension(t,i),c=we.sizeFromDimension(s,0)/i,_=[{type:12,data:n},{type:12,data:i},{type:12,data:l},...pt(e[1].dims,e[2].dims,o)],d=u=>{let f=Ee("indices",e[1].dataType,e[1].dims.length),h=Ee("updates",e[2].dataType,e[2].dims.length,a),v=r.reduction!=="none"&&r.reduction!==""?ov("output",e[0].dataType,o.length):nt("output",e[0].dataType,o.length,a);return`\n      ${u.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(f,h,v)}\n      ${u.mainStart()}\n        ${u.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n  var hasDuplicates = false;\n  if (${r.reduction==="none"}) {\n    for (var i = 0; i < ${c}; i = i + 1) {\n      for (var j = i + 1; j < ${c}; j = j + 1) {\n        var index_i = i32(indices[i].x);\n        var index_j = i32(indices[j].x);\n        if (index_i == index_j) {\n          hasDuplicates = true;\n          break;\n        }\n      }\n      if (hasDuplicates) {\n        break;\n      }\n    }\n  }\n\n  if (${r.reduction==="none"} && hasDuplicates) {\n    if (global_idx != 0u) {\n      return;\n    }\n    // Process each index-update pair individually when duplicates exist\n    for (var idx = 0u; idx < ${c}u; idx++) {\n      var data_offset = 0u;\n      for (var i = 0u; i < uniforms.last_index_dimension; i++) {\n        var index = i32(indices[idx * uniforms.last_index_dimension + i].x);\n        ${td(t.length,!1)}\n      }\n      ${rd(r,v.type.value,!1)}\n    }\n    return;\n  }\n\n  var data_offset = 0u;\n  var indices_start = uniforms.last_index_dimension * global_idx;\n  var indices_end = indices_start + uniforms.last_index_dimension;\n  for (var i = indices_start; i < indices_end; i++) {\n    var index = i32(indices[i].x);\n    ${td(t.length,!0)}\n  }\n  ${rd(r,v.type.value,!0)}\n  }`};return{name:"ScatterND",shaderCache:{hint:`${r.cacheKey}_${r.reduction}`,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:o,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(n/64)},programUniforms:_}),getShaderSource:d}},Iy=e=>qt({reduction:e.reduction}),Fy=(e,r)=>{e.compute(Rw(e.inputs,r),{inputs:[e.inputs[1],e.inputs[2]],outputs:[]})}}),cP=Ve(()=>{"use strict";bt(),St(),mr(),$t(),Nw=(e,r)=>{if(e.every(t=>t>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),e.length>0){if(r.mode==="linear"){if(!(e.length===2||e.length===3||e.length===4&&e[0]===1&&e[1]===1||e.length===4&&e[0]===1&&e[3]===1||e.length===5&&e[0]===1&&e[1]===1))throw new Error(`For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and\n            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1`)}else if(r.mode==="cubic"&&!(e.length===2||e.length===4&&e[0]===1&&e[1]===1||e.length===4&&e[0]===1&&e[3]===1))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")}},jw=(e,r,t)=>{r.every(o=>o>=0&&o<t||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let s=new Array(t).fill(1);return r.forEach((o,a)=>s[o]=e[a]),s},Vw=(e,r,t,s,o,a)=>{let[n,i,l]=t>10?[1,2,3]:[-1,e.length>1?1:-1,-1],c=e[0].dims.length;if(n>0&&e.length>n&&e[n].dims.length>0)e[n].getFloat32Array().forEach(_=>a.push(_));else if(r.coordinateTransformMode==="tf_crop_and_resize")throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(i>0&&e.length>i&&e[i].dims.length===1&&e[i].dims[0]>0){if(e[i].getFloat32Array().forEach(_=>s.push(_)),s.length!==0&&s.length!==c&&t>=18&&s.length!==r.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");Nw(s,r),r.axes.length>0&&jw(s,r.axes,c).forEach((_,d)=>s[d]=_)}if(l>0&&e.length>l&&e[l].dims.length===1&&e[l].dims[0]>0&&(e[l].getBigInt64Array().forEach(_=>o.push(Number(_))),o.length!==0&&o.length!==c&&t>=18&&o.length!==r.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(r.axes.length>0){if(s.length!==0&&s.length!==r.axes.length)throw new Error(\'Resize requires "scales" input size to be of axes rank when axes attributes is specified\');if(o.length!==0&&o.length!==r.axes.length)throw new Error(\'Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified\')}if(typeof s<"u"&&typeof o<"u"&&s.length>0&&o.length>c)throw new Error("Resize requires only of scales or sizes to be specified")},sd=(e,r,t,s)=>`\n  // The whole part and the fractional part are calculated separately due to inaccuracy of floating\n  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an\n  // offset-by-one error later in floor().\n  let big = (${e}) * (${r});\n  let whole = ${s}(big / (${t}));\n  let fract = ${s}(big % (${t})) / ${s}(${t});\n  return whole + fract;\n`,Ww=(e,r)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,\n     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${r} { `+(()=>{switch(e){case"asymmetric":return`\n          if (xScale < 1.0 || floor(xScale) != xScale) {\n            return ${r}(xResized) / ${r}(xScale);\n          } else {\n            ${sd("xResized","lengthOriginal","lengthResized",r)}\n          }\n        `;case"pytorch_half_pixel":return`if (lengthResized > 1) {\n                    return (${r}(xResized) + 0.5) / ${r}(xScale) - 0.5;\n                  } else {\n                    return 0.0;\n                  }`;case"tf_half_pixel_for_nn":return`return (${r}(xResized) + 0.5) / ${r}(xScale);`;case"align_corners":return`if (lengthResized == 1) {\n                    return 0.0;\n                  } else {\n                    ${sd("xResized","lengthOriginal - 1","lengthResized - 1",r)}\n                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {\n                    return ${r}(roiStart) * ${r}(lengthOriginal - 1) +\n                        (${r}(xResized) * ${r}(roiEnd - roiStart) * ${r}(lengthOriginal - 1)) /\n                        ${r}(lengthResized - 1);\n                  } else {\n                    return 0.5 * ${r}(roiStart + roiEnd) * ${r}(lengthOriginal - 1);\n                  }`;case"half_pixel_symmetric":return`const outputWidth = ${r}xScale * ${r}(lengthResized);\n                  const adjustment = ${r}(lengthResized) / outputWidth;\n                  const center = ${r}(lengthOriginal) / 2;\n                  const offset = center * (1 - adjustment);\n                  return offset + ((${r}(xResized) + 0.5) / ${r}(xScale)) - 0.5;`;case"half_pixel":return`return ((${r}(xResized) + 0.5) / ${r}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${e} is not supported`)}})()+"}",Uw=(e,r,t)=>`fn getNearestPixelFromOriginal(xOriginal: ${t}, isDownSample: bool) -> ${t} {`+(()=>{switch(e){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";case"simple":default:if(r<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${e} is not supported`)}})()+"}",Gw=(e,r,t)=>{let s=new Array(t).fill(0).concat(new Array(t).fill(1)),o=e.length===0?s:e.slice();return r.length>0?(r.forEach((a,n)=>{s[a]=o[n],s[n+t]=o[r.length+n]}),s):o},Kw=(e,r,t,s)=>{let o=[];if(t.length>0)if(s.length>0){if(e.forEach(a=>o.push(a)),Math.max(...s)>e.length)throw new Error("axes is out of bound");s.forEach((a,n)=>o[a]=t[n])}else t.forEach(a=>o.push(a));else{if(r.length===0)throw new Error("Resize requires either scales or sizes.");o=e.map((a,n)=>Math.round(a*r[n]))}return o},Hw=(e,r,t)=>{let s=(()=>{switch(t.keepAspectRatioPolicy){case"not_larger":return t.axes.length>0?Math.min(...t.axes.map(a=>r[a]),Number.MAX_VALUE):Math.min(...r,Number.MAX_VALUE);case"not_smaller":return t.axes.length>0?Math.max(...t.axes.map(a=>r[a]),Number.MIN_VALUE):Math.max(...r,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${t.keepAspectRatioPolicy} is not supported`)}})();r.fill(1,0,r.length);let o=e.slice();return t.axes.length>0?(t.axes.forEach(a=>r[a]=s),t.axes.forEach(a=>o[a]=Math.round(e[a]*r[a]))):(r.fill(s,0,r.length),o.forEach((a,n)=>o[n]=Math.round(a*r[n]))),o},qw=(e,r,t,s,o)=>`\n    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${e.type.indices}) -> array<${e.type.value}, ${t.length}> {\n      var original_indices: array<${e.type.value}, ${t.length}>;\n      for (var i:u32 = 0; i < ${t.length}; i++) {\n        var output_index = ${e.indicesGet("output_indices","i")};\n        var scale = ${ct("uniforms.scales","i",s)};\n        var roi_low = ${ct("uniforms.roi","i",o)};\n        var roi_hi = ${ct("uniforms.roi",`i + ${r.length}`,o)};\n        if (scale == 1.0) {\n          original_indices[i] = ${e.type.value}(output_index);\n        } else {\n          var input_shape_i = ${ct("uniforms.input_shape","i",r.length)};\n          var output_shape_i = ${ct("uniforms.output_shape","i",t.length)};\n          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,\n                                                                           input_shape_i, roi_low, roi_hi);\n        }\n      }\n      return original_indices;\n    }`,Qw=(e,r,t,s,o,a,n)=>`\n    fn calculateInputIndicesFromOutputIndices(output_indices: ${r.type.indices}) -> ${e.type.indices} {\n      var input_indices: ${e.type.indices};\n      for (var i:u32 = 0; i < ${s.length}; i++) {\n        var output_index = ${r.indicesGet("output_indices","i")};\n        var input_index: u32;\n        var scale = ${ct("uniforms.scales","i",o)};\n        if (scale == 1.0) {\n          input_index = output_index;\n        } else {\n          var roi_low = ${ct("uniforms.roi","i",a)};\n          var roi_hi = ${ct("uniforms.roi",`i + ${t.length}`,a)};\n          var input_shape_i = ${ct("uniforms.input_shape","i",t.length)};\n          var output_shape_i = ${ct("uniforms.output_shape","i",s.length)};\n          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,\n                                                                        input_shape_i, roi_low, roi_hi);\n          if (!${n} || (original_idx >= 0 && original_idx < ${r.type.value}(input_shape_i))) {\n            if (original_idx < 0) {\n              input_index = 0;\n            } else if (original_idx > ${r.type.value}(input_shape_i - 1)) {\n              input_index = input_shape_i - 1;\n            } else {\n              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));\n            }\n          } else {\n            input_index = u32(original_idx);\n          }\n        }\n        ${e.indicesSet("input_indices","i","input_index")}\n      }\n      return input_indices;\n    }`,Xw=(e,r)=>`\n    fn checkInputIndices(input_indices: ${e.type.indices}) -> bool {\n      for (var i:u32 = 0; i < ${r.length}; i++) {\n        var input_index = ${e.indicesGet("input_indices","i")};\n        if (input_index < 0 || input_index >= ${ct("uniforms.input_shape","i",r.length)}) {\n          return false;\n        }\n      }\n      return true;\n    }`,ad=(e,r,t,s)=>e.rank>s?`\n    ${e.indicesSet("input_indices",r,"channel")};\n    ${e.indicesSet("input_indices",t,"batch")};\n`:"",Jw=(e,r,t,s,o)=>{let[a,n,i,l]=t.length===2?[-1,0,1,-1]:[0,2,3,1],c=e.type.value;return`\n    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${c} {\n      var input_indices: ${e.type.indices};\n      ${e.indicesSet("input_indices",n,`max(0, min(row, ${t[n]} - 1))`)};\n      ${e.indicesSet("input_indices",i,`max(0, min(col, ${t[i]} - 1))`)};\n      ${ad(e,l,a,2)}\n      return ${e.getByIndices("input_indices")};\n    }\n\n    fn bilinearInterpolation(output_indices: ${r.type.indices}) -> ${c} {\n      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);\n      var row:${c} = originalIndices[${n}];\n      var col:${c} = originalIndices[${i}];\n      ${s?`if (row < 0 || row > (${t[n]} - 1) || col < 0 || col > (${t[i]} - 1)) {\n        return ${o};\n      }`:""};\n      row = max(0, min(row, ${t[n]} - 1));\n      col = max(0, min(col, ${t[i]} - 1));\n      var row1: u32 = u32(row);\n      var col1: u32 = u32(col);\n      var row2: u32 = u32(row + 1);\n      var col2: u32 = u32(col + 1);\n      var channel: u32 = ${t.length>2?`u32(originalIndices[${l}])`:"0"};\n      var batch: u32 =  ${t.length>2?`u32(originalIndices[${a}])`:"0"};\n      var x11: ${c} = getInputValue(batch, channel, row1, col1);\n      var x12: ${c} = getInputValue(batch, channel, row1, col2);\n      var x21: ${c} = getInputValue(batch, channel, row2, col1);\n      var x22: ${c} = getInputValue(batch, channel, row2, col2);\n      var dx1: ${c} = abs(row - ${c}(row1));\n      var dx2: ${c} = abs(${c}(row2) - row);\n      var dy1: ${c} = abs(col - ${c}(col1));\n      var dy2: ${c} = abs(${c}(col2) - col);\n      if (row1 == row2) {\n        dx1 = 0.5;\n        dx2 = 0.5;\n      }\n      if (col1 == col2) {\n        dy1 = 0.5;\n        dy2 = 0.5;\n      }\n      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);\n    }`},Yw=(e,r,t,s,o,a,n,i,l,c)=>{let _=t.length===2,d=!0,[u,f]=_?[0,1]:d?[2,3]:[1,2],h=e.type.value,v=E=>{let M=E===u?"row":"col";return`\n      fn ${M}CubicInterpolation(input_indices: ${e.type.indices}, output_indices: ${r.type.indices}) -> ${h} {\n        var output_index = ${r.indicesGet("output_indices",E)};\n        var originalIdx: ${h} = getOriginalCoordinateFromResizedCoordinate(output_index, ${o[E]},\n        ${s[E]}, ${t[E]}, ${a[E]}, ${a[E]} + ${t.length});\n        var fractOriginalIdx: ${h} = originalIdx - floor(originalIdx);\n        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);\n\n        if (${i} && (originalIdx < 0 || originalIdx > (${t[E]} - 1))) {\n          return ${l};\n        }\n        var data: array<${h}, 4> = array<${h}, 4>(0.0, 0.0, 0.0, 0.0);\n        for (var i: i32 = -1; i < 3; i++) {\n          var ${M}: ${h} = originalIdx + ${h}(i);\n          if (${M} < 0 || ${M} >= ${t[E]}) {\n            ${c?`coefs[i + 1] = 0.0;\n                        continue;`:i?`return ${l};`:`${M} = max(0, min(${M}, ${t[E]} - 1));`};\n          }\n        var input_indices_copy: ${e.type.indices} = input_indices;\n          ${e.indicesSet("input_indices_copy",E,`u32(${M})`)};\n          data[i + 1] = ${E===u?e.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};\n        }\n        return cubicInterpolation1D(data, coefs);\n      }`};return`\n    ${v(u)};\n    ${v(f)};\n  fn getCubicInterpolationCoefs(s: ${h}) -> array<${h}, 4> {\n    var absS = abs(s);\n    var coeffs: array<${h}, 4> = array<${h}, 4>(0.0, 0.0, 0.0, 0.0);\n    var oneMinusAbsS: ${h} = 1.0 - absS;\n    var twoMinusAbsS: ${h} = 2.0 - absS;\n    var onePlusAbsS: ${h} = 1.0 + absS;\n    coeffs[0] = ((${n} * onePlusAbsS - 5 * ${n}) * onePlusAbsS + 8 * ${n}) * onePlusAbsS - 4 * ${n};\n    coeffs[1] = ((${n} + 2) * absS - (${n} + 3)) * absS * absS + 1;\n    coeffs[2] = ((${n} + 2) * oneMinusAbsS - (${n} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;\n    coeffs[3] = ((${n} * twoMinusAbsS - 5 * ${n}) * twoMinusAbsS + 8 * ${n}) * twoMinusAbsS - 4 * ${n};\n    return coeffs;\n  }\n\n  fn cubicInterpolation1D(x: array<${h}, 4>, coefs: array<${h}, 4>) -> ${h} {\n    var coefsSum: ${h} = coefs[0] + coefs[1] + coefs[2] + coefs[3];\n    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;\n  }\n\n  fn bicubicInterpolation(output_indices: ${r.type.indices}) -> ${h} {\n    var input_indices: ${e.type.indices} = output_indices;\n    return colCubicInterpolation(input_indices, output_indices);\n  }\n    `},Zw=(e,r,t,s,o)=>{let[a,n,i,l,c]=t.length===3?[-1,0,1,2,-1]:[0,2,3,4,1],_=e.type.value;return`\n    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${_} {\n      var input_indices: ${e.type.indices};\n      ${e.indicesSet("input_indices",n,`max(0, min(depth, ${t[n]} - 1))`)};\n      ${e.indicesSet("input_indices",i,`max(0, min(height, ${t[i]} - 1))`)};\n      ${e.indicesSet("input_indices",l,`max(0, min(width, ${t[l]} - 1))`)};\n      ${ad(e,c,a,3)}\n      return ${e.getByIndices("input_indices")};\n    }\n\n    fn trilinearInterpolation(output_indices: ${r.type.indices}) -> ${_} {\n      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);\n      var depth:${_} = originalIndices[${n}];\n      var height:${_} = originalIndices[${i}];\n      var width:${_} = originalIndices[${l}];\n      ${s?`if (depth < 0 || depth > (${t[n]} - 1) || height < 0 || height > (${t[i]} - 1) || width < 0 || (width > ${t[l]} - 1)) {\n      return ${o};\n        }`:""};\n\n    depth = max(0, min(depth, ${t[n]} - 1));\n      height = max(0, min(height, ${t[i]} - 1));\n      width = max(0, min(width, ${t[l]} - 1));\n      var depth1: u32 = u32(depth);\n      var height1: u32 = u32(height);\n      var width1: u32 = u32(width);\n      var depth2: u32 = u32(depth + 1);\n      var height2: u32 = u32(height + 1);\n      var width2: u32 = u32(width + 1);\n      var channel: u32 = ${t.length>3?`u32(originalIndices[${c}])`:"0"};\n      var batch: u32 =  ${t.length>3?`u32(originalIndices[${a}])`:"0"};\n\n      var x111: ${_} = getInputValue(batch, channel, depth1, height1, width1);\n      var x112: ${_} = getInputValue(batch, channel, depth1, height1, width2);\n      var x121: ${_} = getInputValue(batch, channel, depth1, height2, width1);\n      var x122: ${_} = getInputValue(batch, channel, depth1, height2, width2);\n      var x211: ${_} = getInputValue(batch, channel, depth2, height1, width1);\n      var x212: ${_} = getInputValue(batch, channel, depth2, height1, width2);\n      var x221: ${_} = getInputValue(batch, channel, depth2, height2, width1);\n      var x222: ${_} = getInputValue(batch, channel, depth2, height2, width2);\n      var dx1: ${_} = abs(depth - ${_}(depth1));\n      var dx2: ${_} = abs(${_}(depth2) - depth);\n      var dy1: ${_} = abs(height - ${_}(height1));\n      var dy2: ${_} = abs(${_}(height2) - height);\n      var dz1: ${_} = abs(width - ${_}(width1));\n      var dz2: ${_} = abs(${_}(width2) - width);\n      if (depth1 == depth2) {\n        dx1 = 0.5;\n        dx2 = 0.5;\n      }\n      if (height1 == height2) {\n        dy1 = 0.5;\n        dy2 = 0.5;\n      }\n      if (width1 == width2) {\n        dz1 = 0.5;\n        dz2 = 0.5;\n      }\n      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +\n              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);\n    }`},eb=(e,r,t,s,o,a)=>{let n=e.dims,i=Gw(a,r.axes,n.length),l=Kw(n,s,o,r.axes),c=s.slice();s.length===0&&(c=n.map((w,C)=>w===0?1:l[C]/w),r.keepAspectRatioPolicy!=="stretch"&&(l=Hw(n,c,r)));let _=nt("output",e.dataType,l.length),d=Ee("input",e.dataType,n.length),u=we.size(l),f=n.length===l.length&&n.every((w,C)=>w===l[C]),h=r.coordinateTransformMode==="tf_crop_and_resize",v=r.extrapolationValue,E=d.type.value,M=w=>`\n      ${f?"":`\n      ${Ww(r.coordinateTransformMode,E)};\n      ${(()=>{switch(r.mode){case"nearest":return`\n              ${Xw(d,n)};\n              ${Uw(r.nearestMode,t,E)};\n              ${Qw(d,_,n,l,c.length,i.length,h)};\n              `;case"linear":return`\n              ${qw(_,n,l,c.length,i.length)};\n              ${(()=>{if(n.length===2||n.length===4)return`${Jw(d,_,n,h,v)}`;if(n.length===3||n.length===5)return`${Zw(d,_,n,h,v)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};\n            `;case"cubic":return`\n            ${(()=>{if(n.length===2||n.length===4)return`${Yw(d,_,n,l,c,i,r.cubicCoeffA,h,r.extrapolationValue,r.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};\n            `;default:throw Error("Invalid resize mode")}})()};\n      `}\n      ${w.registerUniform("output_size","u32").registerUniform("scales","f32",c.length).registerUniform("roi","f32",i.length).declareVariables(d,_)}\n      ${w.mainStart()}\n        ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n        ${f?"output[global_idx] = input[global_idx];":`\n        let output_indices = ${_.offsetToIndices("global_idx")};\n        var input_indices: ${d.type.indices};\n        ${(()=>{switch(r.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);\n                if (checkInputIndices(input_indices)) {\n                  output[global_idx] = ${d.getByIndices("input_indices")};\n                } else {\n                  output[global_idx] = ${r.extrapolationValue};\n                }`;case"linear":return`output[global_idx] = ${n.length===2||n.length===4?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${r.mode}`)}})()};\n`}\n      }`;return{name:"Resize",shaderCache:{hint:`${r.cacheKey}|${t}|${c.length>0?r.mode==="cubic"?c:c.length:""}|${o.length>0?o:""}|${i.length>0?i:""}|${f}|${r.mode==="nearest"?n.length:n}`,inputDependencies:["rank"]},getShaderSource:M,getRunData:()=>({outputs:[{dims:l,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:[{type:12,data:u},{type:1,data:c},{type:1,data:i},...pt(n,l)]})}},tb=e=>{let r=e.customDataBuffer;return new Uint32Array(r,r.byteOffset,1)[0]},$y=(e,r)=>{let t=[],s=[],o=[],a=tb(e);if(r.antialias!==0)throw Error("Only default value (0) for Antialias attribute is supported");Vw(e.inputs,r,a,t,s,o),e.compute(eb(e.inputs[0],r,a,t,s,o),{inputs:[0]})},Ay=e=>{let r=e.antialias,t=e.axes,s=e.coordinateTransformMode,o=e.cubicCoeffA,a=e.excludeOutside!==0,n=e.extrapolationValue,i=e.keepAspectRatioPolicy,l=e.mode,c=e.nearestMode===""?"simple":e.nearestMode;return qt({antialias:r,axes:t,coordinateTransformMode:s,cubicCoeffA:o,excludeOutside:a,extrapolationValue:n,keepAspectRatioPolicy:i,mode:l,nearestMode:c})}}),dP=Ve(()=>{"use strict";bt(),St(),$t(),rb=e=>{if(!e||e.length<3)throw new Error("layerNorm requires at least 3 inputs.");let r=e[0],t=e[1],s=e[2];if(r.dataType!==t.dataType||r.dataType!==s.dataType)throw new Error("All inputs must have the same data type");if(r.dims.length!==3&&r.dims.length!==2)throw new Error("Input must be 2D or 3D");if(t.dims.length!==3&&t.dims.length!==2)throw new Error("Skip must be 2D or 3D");let o=r.dims[r.dims.length-1],a=r.dims[r.dims.length-2];if(t.dims[t.dims.length-1]!==o)throw new Error("Skip must have the same hidden size as input");if(t.dims[t.dims.length-2]!==a)throw new Error("Skip must have the same sequence length as input");if(s.dims.length!==1)throw new Error("Gamma must be 1D");if(s.dims[s.dims.length-1]!==o)throw new Error("Gamma must have the same hidden size as input");if(e.length>3){let n=e[3];if(n.dims.length!==1)throw new Error("Beta must be 1D");if(n.dims[n.dims.length-1]!==o)throw new Error("Beta must have the same hidden size as input")}if(e.length>4){let n=e[4];if(n.dims.length!==1)throw new Error("Bias must be 1D");if(n.dims[n.dims.length-1]!==o)throw new Error("Bias must have the same hidden size as input")}},sb=(e,r,t,s)=>{let o=r.simplified,a=e[0].dims,n=we.size(a),i=a,l=n,c=a.slice(-1)[0],_=s?a.slice(0,-1).concat(1):[],d=!o&&e.length>3,u=e.length>4,f=s&&t>1,h=s&&t>2,v=t>3,E=64,M=pr(c),w=[{type:12,data:l},{type:12,data:M},{type:12,data:c},{type:1,data:r.epsilon}],C=T=>{let S=[{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}],g=[Ee("x",e[0].dataType,e[0].dims,M),Ee("skip",e[1].dataType,e[1].dims,M),Ee("gamma",e[2].dataType,e[2].dims,M)];d&&g.push(Ee("beta",e[3].dataType,e[3].dims,M)),u&&g.push(Ee("bias",e[4].dataType,e[4].dims,M)),g.push(nt("output",e[0].dataType,i,M)),f&&g.push(nt("mean_output",1,_)),h&&g.push(nt("inv_std_output",1,_)),v&&g.push(nt("input_skip_bias_sum",e[0].dataType,i,M));let P=Ar(e[0].dataType),$=Ar(1,M);return`\n\n      ${T.registerUniforms(S).declareVariables(...g)}\n      var<workgroup> sum_shared : array<${$}, ${E}>;\n      var<workgroup> sum_squared_shared : array<${$}, ${E}>;\n\n      ${T.mainStart([E,1,1])}\n        let ix = local_id.x;\n        let iy = global_id.x / ${E};\n\n        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;\n        var stride = hidden_size_vectorized / ${E};\n        let offset = ix * stride + iy * hidden_size_vectorized;\n        let offset1d = stride * ix;\n        if (ix == ${E-1}) {\n          stride = hidden_size_vectorized - stride * ix;\n        }\n        for (var i: u32 = 0; i < stride; i++) {\n          let skip_value = skip[offset + i];\n          let bias_value = ${u?"bias[offset1d + i]":P+"(0.0)"};\n          let input_value = x[offset + i];\n          let value = input_value + skip_value + bias_value;\n          ${v?"input_skip_bias_sum[offset + i] = value;":""}\n          output[offset + i] = value;\n          let f32_value = ${_o(P,M,"value")};\n          sum_shared[ix] += f32_value;\n          sum_squared_shared[ix] += f32_value * f32_value;\n        }\n        workgroupBarrier();\n\n        var reduce_size : u32 = ${E};\n        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {\n          reduce_size = curr_size + (reduce_size & 1);\n          if (ix < curr_size) {\n            sum_shared[ix] += sum_shared[ix + reduce_size];\n            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];\n          }\n          workgroupBarrier();\n        }\n\n        let sum = sum_shared[0];\n        let square_sum = sum_squared_shared[0];\n        let mean = ${la("sum",M)} / f32(uniforms.hidden_size);\n        let inv_std_dev = inverseSqrt(${la("square_sum",M)} / f32(uniforms.hidden_size) ${o?"":"- mean * mean"} + uniforms.epsilon);\n        ${f?"mean_output[global_idx] = mean;":""}\n        ${h?"inv_std_output[global_idx] = inv_std_dev;":""}\n\n        for (var i: u32 = 0; i < stride; i++) {\n          output[offset + i] = (output[offset + i] ${o?"":`- ${P}(mean)`}) *\n            ${P}(inv_std_dev) * gamma[offset1d + i]\n            ${d?"+ beta[offset1d + i]":""};\n        }\n      }`},x=[{dims:i,dataType:e[0].dataType}];return t>1&&x.push({dims:_,dataType:1}),t>2&&x.push({dims:_,dataType:1}),t>3&&x.push({dims:a,dataType:e[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:`${M};${f};${h};${v}`,inputDependencies:e.map((T,S)=>"type")},getShaderSource:C,getRunData:()=>({outputs:x,dispatchGroup:{x:Math.ceil(l/c)},programUniforms:w})}},Dy=(e,r)=>{rb(e.inputs);let t=[0];e.outputCount>1&&t.push(-3),e.outputCount>2&&t.push(-3),e.outputCount>3&&t.push(3),e.compute(sb(e.inputs,r,e.outputCount,!1),{outputs:t})}}),uP=Ve(()=>{"use strict";bt(),St(),mr(),$t(),ab=(e,r)=>{if(!e||e.length<1)throw new Error("too few inputs");if(r.axes.length!==0){if(r.axes.length!==r.starts.length||r.axes.length!==r.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(r.starts.length!==r.ends.length)throw new Error("starts and ends must have the same length");e.slice(1).forEach((t,s)=>{if(e[s+1].dataType!==6&&e[s+1].dataType!==7)throw new Error(`Input ${s} must be an array of int32 or int64`)})},nn=(e,r)=>{let t=[];if(e.length>r)if(e[r].dataType===7)e[r].getBigInt64Array().forEach(s=>t.push(Number(s)));else if(e[r].dataType===6)e[r].getInt32Array().forEach(s=>t.push(Number(s)));else throw new Error(`Input ${r} must be an array of int32 or int64`);return t},ob=(e,r)=>{if(e.length>1){let t=nn(e,1),s=nn(e,2),o=nn(e,3);return o.length===0&&(o=[...Array(e[0].dims.length).keys()]),qt({starts:t,ends:s,axes:o})}else return r},od=(e,r,t,s,o)=>{let a=e;return e<0&&(a+=t[s[r]]),o[r]<0?Math.max(0,Math.min(a,t[s[r]]-1)):Math.max(0,Math.min(a,t[s[r]]))},nb=(e,r,t)=>`fn calculateInputIndices(output_indices: ${r.type.indices}) -> ${e.type.indices} {\n          var input_indices: ${e.type.indices};\n          var carry = 0u;\n          for (var i = ${t.length}; i >= 0; i--) {\n            let input_shape_i = ${ct("uniforms.input_shape","i",t.length)};\n            let steps_i = ${ct("uniforms.steps","i",t.length)};\n            let signs_i = ${ct("uniforms.signs","i",t.length)};\n            let starts_i = ${ct("uniforms.starts","i",t.length)};\n            var output_index = ${r.indicesGet("output_indices","i")};\n            var input_index = output_index * steps_i + starts_i + carry;\n            carry = input_index / input_shape_i;\n            input_index = input_index % input_shape_i;\n            if (signs_i < 0) {\n              input_index = input_shape_i - input_index - 1u + starts_i;\n            }\n            ${e.indicesSet("input_indices","i","input_index")};\n          }\n          return input_indices;\n      }`,ib=(e,r)=>{let t=e[0].dims,s=we.size(t),o=r.axes.length>0?we.normalizeAxes(r.axes,t.length):[...Array(t.length).keys()],a=nn(e,4);a.forEach(M=>M!==0||(()=>{throw new Error("step cannot be 0")})),a.length===0&&(a=Array(o.length).fill(1));let n=r.starts.map((M,w)=>od(M,w,t,o,a)),i=r.ends.map((M,w)=>od(M,w,t,o,a));if(o.length!==n.length||o.length!==i.length)throw new Error("start, ends and axes should have the same number of elements");if(o.length!==t.length)for(let M=0;M<t.length;++M)o.includes(M)||(n.splice(M,0,0),i.splice(M,0,t[M]),a.splice(M,0,1));let l=a.map(M=>Math.sign(M));a.forEach((M,w,C)=>{if(M<0){let x=(i[w]-n[w])/M,T=n[w],S=T+x*a[w];n[w]=S,i[w]=T,C[w]=-M}});let c=t.slice(0);o.forEach((M,w)=>{c[M]=Math.ceil((i[M]-n[M])/a[M])});let _={dims:c,dataType:e[0].dataType},d=nt("output",e[0].dataType,c.length),u=Ee("input",e[0].dataType,e[0].dims.length),f=we.size(c),h=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:n.length},{name:"signs",type:"i32",length:l.length},{name:"steps",type:"u32",length:a.length}],v=[{type:12,data:f},{type:12,data:n},{type:6,data:l},{type:12,data:a},...pt(e[0].dims,c)],E=M=>`\n      ${M.registerUniforms(h).declareVariables(u,d)}\n        ${nb(u,d,t)}\n        ${M.mainStart()}\n          ${M.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n          let output_indices = ${d.offsetToIndices("global_idx")};\n          let input_indices = calculateInputIndices(output_indices);\n          ${d.setByOffset("global_idx",u.getByIndices("input_indices"))}\n      }`;return{name:"Slice",shaderCache:{hint:`${l.length}_${n.length}_${a.length}`,inputDependencies:["rank"]},getShaderSource:E,getRunData:()=>({outputs:[_],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:v})}},Oy=(e,r)=>{ab(e.inputs,r);let t=ob(e.inputs,r);e.compute(ib(e.inputs,t),{inputs:[0]})},Ly=e=>{let r=e.starts,t=e.ends,s=e.axes;return qt({starts:r,ends:t,axes:s})}}),_P=Ve(()=>{"use strict";bt(),St(),mr(),ca(),$t(),lb=e=>{if(!e||e.length!==1)throw new Error("Softmax op requires 1 input.")},cb=(e,r)=>{let t=e.inputs[0],s=t.dims,o=we.size(s),a=s.length,n=we.normalizeAxis(r.axis,a),i=n<s.length-1,l,c=[];i?(c=Array.from({length:a},(g,P)=>P),c[n]=a-1,c[a-1]=n,l=e.compute(_s(t,c),{inputs:[t],outputs:[-1]})[0]):l=t;let _=l.dims,d=_[a-1],u=o/d,f=pr(d),h=d/f,v=64;u===1&&(v=256);let E=(g,P)=>P===4?`max(max(${g}.x, ${g}.y), max(${g}.z, ${g}.w))`:P===2?`max(${g}.x, ${g}.y)`:P===3?`max(max(${g}.x, ${g}.y), ${g}.z)`:g,M=Ee("x",l.dataType,l.dims,f),w=nt("result",l.dataType,l.dims,f),C=M.type.value,x=Ar(l.dataType)==="f32"?`var threadMax = ${C}(-3.402823e+38f);`:`var threadMax = ${C}(-65504.0h);`,T=g=>`\n      var<workgroup> rowMaxShared : ${C};\n      var<workgroup> rowSumShared : ${C};\n      var<workgroup> threadShared : array<${C}, ${v}>;\n\n      fn getValue(row: i32, col: i32, row_stride: i32) -> ${C} {\n        let index = row * row_stride + col;\n        return x[index];\n      }\n\n      fn setValue(row: i32, col: i32, row_stride: i32, value: ${C}) {\n        let index = row * row_stride + col;\n        result[index] = value;\n      }\n      ${g.registerUniform("packedCols","i32").declareVariables(M,w)}\n      ${g.mainStart(v)}\n        let gindex = i32(global_idx);\n        let lindex = i32(local_idx);\n        const wg = ${v};\n        let row = gindex / wg;\n        let cols = uniforms.packedCols;\n        let row_stride : i32 = uniforms.packedCols;\n\n        // find the rows max\n        ${x}\n        for (var col = lindex; col < cols; col += wg) {\n          let value = getValue(row, col, row_stride);\n          threadMax = max(threadMax, value);\n        }\n        if (lindex < cols) {\n          threadShared[lindex] = threadMax;\n        }\n        workgroupBarrier();\n\n        var reduceSize = min(cols, wg);\n        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {\n          reduceSize = currSize + (reduceSize & 1);\n          if (lindex < currSize) {\n            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);\n          }\n          workgroupBarrier();\n        }\n        if (lindex == 0) {\n          rowMaxShared = ${C}(${E("threadShared[0]",f)});\n        }\n        workgroupBarrier();\n\n        // find the rows sum\n        var threadSum = ${C}(0.0);\n        for (var col = lindex; col < cols; col += wg) {\n          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);\n          threadSum += subExp;\n        }\n        threadShared[lindex] = threadSum;\n        workgroupBarrier();\n\n        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {\n          if (lindex < currSize) {\n            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];\n          }\n          workgroupBarrier();\n        }\n        if (lindex == 0) {\n          rowSumShared = ${C}(${la("threadShared[0]",f)});\n        }\n        workgroupBarrier();\n\n        // calculate final value for each element in the row\n        for (var col = lindex; col < cols; col += wg) {\n          let value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;\n          setValue(row, col, row_stride, value);\n        }\n      }`,S=e.compute({name:"Softmax",shaderCache:{hint:`${f};${v}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:_,dataType:l.dataType}],dispatchGroup:{x:u},programUniforms:[{type:6,data:h}]}),getShaderSource:T},{inputs:[l],outputs:[i?-1:0]})[0];i&&e.compute(_s(S,c),{inputs:[S]})},zy=(e,r)=>{lb(e.inputs),cb(e,r)},By=e=>qt({axis:e.axis})}),pP=Ve(()=>{"use strict";bt(),St(),$t(),nd=e=>Array.from(e.getBigInt64Array(),Number),db=e=>{if(!e||e.length!==2)throw new Error("Tile requires 2 inputs.");if(e[0].dataType!==1&&e[0].dataType!==10&&e[0].dataType!==6&&e[0].dataType!==12)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(e[1].dataType!==7)throw new Error("Tile `repeats` input should be of int64 data type");if(e[1].dims.length!==1)throw new Error("Tile `repeats` input should be 1-D");if(nd(e[1]).length!==e[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},ub=(e,r)=>{let t=[];for(let s=0;s<e.length;++s)t.push(e[s]*r[s]);return t},_b=(e,r)=>{let t=e[0].dims,s=r!=null?r:nd(e[1]),o=ub(t,s),a=we.size(o),n=e[0].dataType,i=Ee("input",n,t.length),l=nt("output",n,o.length),c=_=>`\n      const inputShape = ${i.indices(...t)};\n      ${_.registerUniform("output_size","u32").declareVariables(i,l)}\n      ${_.mainStart()}\n      ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n      let output_indices = ${l.offsetToIndices("global_idx")};\n      var input_indices: ${i.type.indices};\n      for (var i = 0; i < ${t.length}; i++) {\n        let input_dim_i = ${i.indicesGet("uniforms.input_shape","i")};\n        let input_dim_value = ${l.indicesGet("output_indices","i")}  % input_dim_i;\n\n        ${i.indicesSet("input_indices","i","input_dim_value")}\n      }\n      ${l.setByOffset("global_idx",i.getByIndices("input_indices"))}\n    }`;return{name:"Tile",shaderCache:{hint:`${s}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:o,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:[{type:12,data:a},...pt(e[0].dims,o)]}),getShaderSource:c}},Ry=e=>{db(e.inputs),e.compute(_b(e.inputs),{inputs:[0]})}}),mP=Ve(()=>{"use strict";bt(),St(),$t(),pb=(e,r,t,s,o)=>{let a=nt("output_data",o,t.length,4),n=Ee("a_data",r[1].dataType,r[1].dims.length,4),i=Ee("b_data",r[2].dataType,r[2].dims.length,4),l=Ee("c_data",r[0].dataType,r[0].dims.length,4),c,_=(d,u,f)=>`select(${u}, ${d}, ${f})`;if(!s)c=a.setByOffset("global_idx",_(n.getByOffset("global_idx"),i.getByOffset("global_idx"),l.getByOffset("global_idx")));else{let d=(u,f,h="")=>{let v=`a_data[index_a${f}][component_a${f}]`,E=`b_data[index_b${f}][component_b${f}]`,M=`bool(c_data[index_c${f}] & (0xffu << (component_c${f} * 8)))`;return`\n            let output_indices${f} = ${a.offsetToIndices(`global_idx * 4u + ${f}u`)};\n            let offset_a${f} = ${n.broadcastedIndicesToOffset(`output_indices${f}`,a)};\n            let offset_b${f} = ${i.broadcastedIndicesToOffset(`output_indices${f}`,a)};\n            let offset_c${f} = ${l.broadcastedIndicesToOffset(`output_indices${f}`,a)};\n            let index_a${f} = offset_a${f} / 4u;\n            let index_b${f} = offset_b${f} / 4u;\n            let index_c${f} = offset_c${f} / 4u;\n            let component_a${f} = offset_a${f} % 4u;\n            let component_b${f} = offset_b${f} % 4u;\n            let component_c${f} = offset_c${f} % 4u;\n            ${u}[${f}] = ${h}(${_(v,E,M)});\n          `};o===9?c=`\n            var data = vec4<u32>(0);\n            ${d("data",0,"u32")}\n            ${d("data",1,"u32")}\n            ${d("data",2,"u32")}\n            ${d("data",3,"u32")}\n            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:c=`\n            ${d("output_data[global_idx]",0)}\n            ${d("output_data[global_idx]",1)}\n            ${d("output_data[global_idx]",2)}\n            ${d("output_data[global_idx]",3)}\n          `}return`\n        ${e.registerUniform("vec_size","u32").declareVariables(l,n,i,a)}\n        ${e.mainStart()}\n        ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}\n        ${c}\n      }`},mb=e=>{let r=e[1].dims,t=e[2].dims,s=e[0].dims,o=e[1].dataType,a=!(we.areEqual(r,t)&&we.areEqual(t,s)),n=r,i=we.size(r);if(a){let c=po.calcShape(po.calcShape(r,t,!1),s,!1);if(!c)throw new Error("Can\'t perform where op on the given tensors");n=c,i=we.size(n)}let l=Math.ceil(i/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:c=>pb(c,e,n,a,o),getRunData:()=>({outputs:[{dims:n,dataType:o}],dispatchGroup:{x:Math.ceil(i/64/4)},programUniforms:[{type:12,data:l},...pt(s,r,t,n)]})}},Ny=e=>{e.compute(mb(e.inputs))}}),hP=Ve(()=>{"use strict";ST(),Wd(),IT(),FT(),$T(),AT(),DT(),RT(),jT(),VT(),WT(),UT(),GT(),KT(),HT(),qT(),QT(),XT(),JT(),YT(),ZT(),eP(),tP(),rP(),sP(),ny(),aP(),oP(),nP(),iP(),lP(),Vd(),cP(),uy(),dP(),uP(),_P(),cy(),pP(),ca(),Ud(),mP(),jy=new Map([["Abs",[Dv]],["Acos",[Ov]],["Acosh",[Lv]],["Add",[fx]],["ArgMax",[Iv,gd]],["ArgMin",[Sv,gd]],["Asin",[zv]],["Asinh",[Bv]],["Atan",[Rv]],["Atanh",[Nv]],["Attention",[Fv]],["AveragePool",[by,wy]],["BatchNormalization",[$v]],["BiasAdd",[Av]],["BiasSplitGelu",[hx]],["Cast",[Vv,jv]],["Ceil",[Uv]],["Clip",[Wv]],["Concat",[Ex,kx]],["Conv",[yd,xd]],["ConvTranspose",[zx,Lx]],["Cos",[Gv]],["Cosh",[Kv]],["CumSum",[Bx,Rx]],["DepthToSpace",[Nx,jx]],["DequantizeLinear",[ky,Cy]],["Div",[gx]],["Einsum",[Vx,Wx]],["Elu",[Hv,_n]],["Equal",[Mx]],["Erf",[qv]],["Exp",[Qv]],["Expand",[Ux]],["FastGelu",[Gx]],["Floor",[Xv]],["FusedConv",[yd,xd]],["Gather",[Hx,Kx]],["GatherElements",[Zx,Yx]],["GatherBlockQuantized",[Xx,Jx]],["GatherND",[qx,Qx]],["Gelu",[Jv]],["Gemm",[ty,ey]],["GlobalAveragePool",[xy,vy]],["GlobalMaxPool",[Ey,Py]],["Greater",[xx]],["GreaterOrEqual",[Tx]],["GridSample",[ry,sy]],["GroupQueryAttention",[_y]],["HardSigmoid",[ox,ax]],["InstanceNormalization",[py]],["LayerNormalization",[my]],["LeakyRelu",[Yv,_n]],["Less",[yx]],["LessOrEqual",[Px]],["Log",[px]],["MatMul",[hy]],["MatMulNBits",[fy,gy]],["MaxPool",[yy,Ty]],["Mul",[wx]],["MultiHeadAttention",[oy,ay]],["Neg",[ex]],["Not",[Zv]],["Pad",[My]],["Pow",[bx]],["QuickGelu",[mx,_n]],["Range",[Sy]],["Reciprocal",[tx]],["ReduceMin",[Tv]],["ReduceMean",[wv]],["ReduceMax",[yv]],["ReduceSum",[Ev]],["ReduceProd",[Pv]],["ReduceL1",[bv]],["ReduceL2",[vv]],["ReduceLogSum",[Cv]],["ReduceLogSumExp",[xv]],["ReduceSumSquare",[kv]],["Relu",[rx]],["Resize",[$y,Ay]],["RotaryEmbedding",[dy]],["ScatterND",[Fy,Iy]],["Sigmoid",[sx]],["Sin",[nx]],["Sinh",[ix]],["Slice",[Oy,Ly]],["SkipLayerNormalization",[Dy]],["Split",[iy,ly]],["Sqrt",[lx]],["Softmax",[zy,By]],["Sub",[vx]],["Tan",[cx]],["Tanh",[dx]],["ThresholdedRelu",[_x,_n]],["Tile",[Ry]],["Transpose",[iv,lv]],["Where",[Ny]]])}),fP=Ve(()=>{"use strict";As(),Qs(),$t(),Vy=class{constructor(e){this.backend=e,this.repo=new Map,this.attributesBound=!1}getArtifact(e){return this.repo.get(e)}setArtifact(e,r){this.repo.set(e,r)}run(e,r,t,s,o){$s(e.programInfo.name);let a=this.backend.device,n=this.backend.getComputePassEncoder();this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2);let i=[];for(let c of r)i.push({binding:i.length,resource:{buffer:c.buffer}});for(let c of t)i.push({binding:i.length,resource:{buffer:c.buffer}});o&&i.push({binding:i.length,resource:o});let l=a.createBindGroup({layout:e.computePipeline.getBindGroupLayout(0),entries:i,label:e.programInfo.name});if(this.backend.sessionStatus==="capturing"){let c={kernelId:this.backend.currentKernelId,computePipeline:e.computePipeline,bindGroup:l,dispatchGroup:s};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(c)}n.setPipeline(e.computePipeline),n.setBindGroup(0,l),n.dispatchWorkgroups(...s),this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||this.backend.queryType==="at-passes")&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),bs(e.programInfo.name)}dispose(){}build(e,r){$s(e.name);let t=this.backend.device,s=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"}].forEach(c=>{t.features.has(c.feature)&&s.push(`enable ${c.extension};`)});let o=nv(r,this.backend.device.limits),a=e.getShaderSource(o),n=`${s.join(`\n`)}\n${o.additionalImplementations}\n${a}`,i=t.createShaderModule({code:n,label:e.name});jt("verbose",()=>`[WebGPU] ${e.name} shader code: ${n}`);let l=t.createComputePipeline({compute:{module:i,entryPoint:"main"},layout:"auto",label:e.name});return bs(e.name),{programInfo:e,computePipeline:l,uniformVariablesInfo:o.variablesInfo}}normalizeDispatchGroupSize(e){let r=typeof e=="number"?e:e.x,t=typeof e=="number"?1:e.y||1,s=typeof e=="number"?1:e.z||1,o=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(r<=o&&t<=o&&s<=o)return[r,t,s];let a=r*t*s,n=Math.ceil(Math.sqrt(a));if(n>o){if(n=Math.ceil(Math.cbrt(a)),n>o)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[n,n,n]}else return[n,n,1]}}}),Wy={};ho(Wy,{WebGpuBackend:()=>Uy});gP=Ve(()=>{"use strict";As(),bt(),Qs(),tv(),kT(),hP(),fP(),hb=(e,r)=>{if(r.length!==e.length)throw new Error(`inputDependencies length ${r.length} is not equal to inputTensors length ${e.length}.`);let t=[];for(let s=0;s<e.length;++s){let o=e[s].dataType;switch(r[s]){case"none":{t.push("");break}case"type":{t.push(`${o}`);break}case"rank":{let a=e[s].dims.length;t.push(`${o};${a}`);break}case"dims":{let a=e[s].dims.join(",");t.push(`${o};${a}`);break}default:throw new Error(`unsupported input dependency: ${r[s]}`)}}return t.join("|")},fb=(e,r,t)=>{var o,a,n;let s=e.name;return(o=e.shaderCache)!=null&&o.hint&&(s+="["+e.shaderCache.hint+"]"),s+=":"+t+`:${hb(r,(n=(a=e.shaderCache)==null?void 0:a.inputDependencies)!=null?n:new Array(r.length).fill("dims"))}`,s},gb=class{constructor(e){e&&(this.architecture=e.architecture,this.vendor=e.vendor)}isArchitecture(e){return this.architecture===e}isVendor(e){return this.vendor===e}},Uy=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(this.currentKernelId===null)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let e=this.kernelCustomData.get(this.currentKernelId);return e||(e={},this.kernelCustomData.set(this.currentKernelId,e)),e}async initialize(e,r){this.env=e;let t=[],s={requiredLimits:{maxComputeWorkgroupStorageSize:r.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:r.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:r.limits.maxStorageBufferBindingSize,maxBufferSize:r.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:r.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:r.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:r.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:r.limits.maxComputeWorkgroupSizeZ},requiredFeatures:t},o=a=>r.features.has(a)&&t.push(a)&&!0;o("chromium-experimental-timestamp-query-inside-passes")||o("timestamp-query"),o("shader-f16"),o("subgroups"),this.device=await r.requestDevice(s),this.adapterInfo=new gb(r.info||await r.requestAdapterInfo()),this.gpuDataManager=av(this),this.programManager=new Vy(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,Bd(e.logLevel,!!e.debug),this.device.onuncapturederror=a=>{a.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${a.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:r,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let e=this.getCommandEncoder(),r={};this.queryType==="at-passes"&&(r.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:this.pendingDispatchNumber*2,endOfPassWriteIndex:this.pendingDispatchNumber*2+1}),this.computePassEncoder=e.beginComputePass(r)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;$s(),this.endComputePass();let e;this.queryType!=="none"&&(this.commandEncoder.resolveQuerySet(this.querySet,0,this.pendingDispatchNumber*2,this.queryResolveBuffer,0),e=this.device.createBuffer({size:this.pendingDispatchNumber*2*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(e,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,e,0,this.pendingDispatchNumber*2*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,this.queryType!=="none"&&e.mapAsync(GPUMapMode.READ).then(()=>{var s;let r=new BigUint64Array(e.getMappedRange()),t=this.pendingQueries.get(e);for(let o=0;o<r.length/2;o++){let a=t[o],n=a.kernelId,i=this.kernels.get(n),l=i.kernelType,c=i.kernelName,_=a.programName,d=a.inputTensorViews,u=a.outputTensorViews,f=r[o*2],h=r[o*2+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=f);let v=Number(f-this.queryTimeBase),E=Number(h-this.queryTimeBase);if(!Number.isSafeInteger(v)||!Number.isSafeInteger(E))throw new RangeError("incorrect timestamp range");if((s=this.env.webgpu.profiling)!=null&&s.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:d.map(M=>({dims:M.dims,dataType:qs(M.dataType)})),outputsMetadata:u.map(M=>({dims:M.dims,dataType:qs(M.dataType)})),kernelId:n,kernelType:l,kernelName:c,programName:_,startTime:v,endTime:E});else{let M="";d.forEach((C,x)=>{M+=`input[${x}]: [${C.dims}] | ${qs(C.dataType)}, `});let w="";u.forEach((C,x)=>{w+=`output[${x}]: [${C.dims}] | ${qs(C.dataType)}, `}),console.log(`[profiling] kernel "${n}|${l}|${c}|${_}" ${M}${w}execution time: ${E-v} ns`)}fn("GPU",`${_}::${f}::${h}`)}e.unmap(),this.pendingQueries.delete(e)}),bs()}run(e,r,t,s,o,a){$s(e.name);let n=[];for(let w=0;w<r.length;++w){let C=r[w].data;if(C===0)continue;let x=this.gpuDataManager.get(C);if(!x)throw new Error(`no GPU data for input: ${C}`);n.push(x)}let{outputs:i,dispatchGroup:l,programUniforms:c}=e.getRunData(r),_=t.length===0?i.map((w,C)=>C):t;if(_.length!==i.length)throw new Error(`Output size ${_.length} must be equal to ${i.length}.`);let d=[],u=[];for(let w=0;w<i.length;++w){if(!Number.isInteger(_[w])||_[w]<-3||_[w]>=a)throw new Error(`Invalid output index: ${_[w]}`);if(_[w]===-3)continue;let C=_[w]===-1,x=_[w]===-2,T=C||x?o(i[w].dataType,i[w].dims):s(_[w],i[w].dataType,i[w].dims);if(d.push(T),T.data===0)continue;let S=this.gpuDataManager.get(T.data);if(!S)throw new Error(`no GPU data for output: ${T.data}`);if(C&&this.temporaryData.push(S),x){let g=this.kernelPersistentData.get(this.currentKernelId);g||(g=[],this.kernelPersistentData.set(this.currentKernelId,g)),g.push(S)}u.push(S)}if(n.length!==r.length||u.length!==d.length){if(u.length===0)return bs(e.name),d;throw new Error(`Program ${e.name} has zero-sized tensor(s) in inputs or outputs. This is not supported now.`)}let f;if(c){let w=0,C=[];c.forEach(g=>{let P=typeof g.data=="number"?[g.data]:g.data;if(P.length===0)return;let $=g.type===10?2:4,A,N;g.type===10?(N=P.length>4?16:P.length>2?8:P.length*$,A=P.length>4?16:$*P.length):(N=P.length<=2?P.length*$:16,A=16),w=Math.ceil(w/N)*N,C.push(w);let W=g.type===10?8:4;w+=P.length>4?Math.ceil(P.length/W)*A:P.length*$});let x=16;w=Math.ceil(w/x)*x;let T=new ArrayBuffer(w);c.forEach((g,P)=>{let $=C[P],A=typeof g.data=="number"?[g.data]:g.data;if(g.type===6)new Int32Array(T,$,A.length).set(A);else if(g.type===12)new Uint32Array(T,$,A.length).set(A);else if(g.type===10)new Uint16Array(T,$,A.length).set(A);else if(g.type===1)new Float32Array(T,$,A.length).set(A);else throw new Error(`Unsupported uniform type: ${qs(g.type)}`)});let S=this.gpuDataManager.create(w,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(S.buffer,0,T,0,w),this.gpuDataManager.release(S.id),f={offset:0,size:w,buffer:S.buffer}}let h=this.programManager.normalizeDispatchGroupSize(l),v=h[1]===1&&h[2]===1,E=fb(e,r,v),M=this.programManager.getArtifact(E);if(M||(M=this.programManager.build(e,h),this.programManager.setArtifact(E,M),jt("info",()=>`[artifact] key: ${E}, programName: ${e.name}`)),c&&M.uniformVariablesInfo){if(c.length!==M.uniformVariablesInfo.length)throw new Error(`Uniform variables count mismatch: expect ${M.uniformVariablesInfo.length}, got ${c.length} in program "${M.programInfo.name}".`);for(let w=0;w<c.length;w++){let C=c[w],x=C.type,T=typeof C.data=="number"?1:C.data.length,[S,g]=M.uniformVariablesInfo[w];if(x!==S||T!==g)throw new Error(`Uniform variable ${w} mismatch: expect type ${S} with size ${g}, got type ${x} with size ${T} in program "${M.programInfo.name}".`)}}if(jt("info",()=>`[ProgramManager] run "${e.name}" (key=${E}) with ${h[0]}x${h[1]}x${h[2]}`),this.queryType!=="none"||this.sessionStatus==="capturing"){let w={kernelId:this.currentKernelId,programName:M.programInfo.name,inputTensorViews:r,outputTensorViews:d};this.pendingKernels.push(w),this.sessionStatus==="capturing"&&this.capturedPendingKernels.get(this.currentSessionId).push(w)}return this.programManager.run(M,n,u,h,f),bs(e.name),d}upload(e,r){this.gpuDataManager.upload(e,r)}memcpy(e,r){this.gpuDataManager.memcpy(e,r)}async download(e,r){await this.gpuDataManager.download(e,r)}alloc(e){return this.gpuDataManager.create(e).id}free(e){return this.gpuDataManager.release(e)}createKernel(e,r,t,s){let o=jy.get(e);if(!o)throw new Error(`kernel not implemented: ${e}`);let a={kernelType:e,kernelName:s,kernelEntry:o[0],attributes:[o[1],t]};this.kernels.set(r,a)}releaseKernel(e){let r=this.kernelPersistentData.get(e);if(r){for(let t of r)this.gpuDataManager.release(t.id);this.kernelPersistentData.delete(e)}this.kernelCustomData.delete(e),this.kernels.delete(e)}computeKernel(e,r,t){let s=this.kernels.get(e);if(!s)throw new Error(`kernel not created: ${e}`);let o=s.kernelType,a=s.kernelName,n=s.kernelEntry,i=s.attributes;if(this.currentKernelId!==null)throw new Error(`kernel "[${o}] ${a}" is not allowed to be called recursively`);this.currentKernelId=e,i[0]&&(i[1]=i[0](i[1]),i[0]=void 0),jt("info",()=>`[WebGPU] Start to run kernel "[${o}] ${a}"...`);let l=this.env.debug;this.temporaryData=[];try{return l&&this.device.pushErrorScope("validation"),n(r,i[1]),0}catch(c){return t.push(Promise.resolve(`[WebGPU] Kernel "[${o}] ${a}" failed. ${c}`)),1}finally{l&&t.push(this.device.popErrorScope().then(c=>c?`GPU validation error for kernel "[${o}] ${a}": ${c.message}`:null));for(let c of this.temporaryData)this.gpuDataManager.release(c.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(e,r,t,s){let o=this.sessionExternalDataMapping.get(e);o||(o=new Map,this.sessionExternalDataMapping.set(e,o));let a=o.get(r),n=this.gpuDataManager.registerExternalBuffer(t,s,a);return o.set(r,[n,t]),n}unregisterBuffers(e){let r=this.sessionExternalDataMapping.get(e);r&&(r.forEach(t=>this.gpuDataManager.unregisterExternalBuffer(t[0])),this.sessionExternalDataMapping.delete(e))}getBuffer(e){let r=this.gpuDataManager.get(e);if(!r)throw new Error(`no GPU data for buffer: ${e}`);return r.buffer}createDownloader(e,r,t){return async()=>{let s=await md(this,e,r);return Rd(s.buffer,t)}}writeTimestamp(e){this.queryType==="inside-passes"&&this.computePassEncoder.writeTimestamp(this.querySet,e)}setQueryType(){var e;this.queryType="none",(((e=this.env.webgpu.profiling)==null?void 0:e.mode)==="default"||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),this.queryType!=="none"&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxDispatchNumber*2}),this.queryResolveBuffer=this.device.createBuffer({size:this.maxDispatchNumber*2*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){jt("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){jt("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){jt("info","replay"),this.sessionStatus="replaying";let e=this.capturedCommandList.get(this.currentSessionId),r=this.capturedPendingKernels.get(this.currentSessionId),t=e.length;this.pendingKernels=[];for(let s=0;s<t;s++){let o=this.getComputePassEncoder(),a=e[s];this.writeTimestamp(this.pendingDispatchNumber*2),o.setPipeline(a.computePipeline),o.setBindGroup(0,a.bindGroup),o.dispatchWorkgroups(...a.dispatchGroup),this.writeTimestamp(this.pendingDispatchNumber*2+1),this.pendingDispatchNumber++,this.queryType!=="none"&&this.pendingKernels.push(r[s]),(this.pendingDispatchNumber>=this.maxDispatchNumber||this.queryType==="at-passes")&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(e){this.unregisterBuffers(e),this.capturedCommandList.has(e)&&this.capturedCommandList.delete(e),this.capturedPendingKernels.has(e)&&this.capturedPendingKernels.delete(e),this.gpuDataManager.onReleaseSession(e)}onRunStart(e){this.currentSessionId=e,this.setQueryType()}}}),Gy={};ho(Gy,{init:()=>Ky});MP=Ve(()=>{"use strict";bt(),Qs(),St(),ET(),$i=class Hy{constructor(r,t,s,o){this.module=r,this.dataType=t,this.data=s,this.dims=o}getFloat32Array(){if(this.dataType!==1)throw new Error("Invalid data type");let r=we.size(this.dims);return r===0?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,r)}getBigInt64Array(){if(this.dataType!==7)throw new Error("Invalid data type");let r=we.size(this.dims);return r===0?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,r)}getInt32Array(){if(this.dataType!==6)throw new Error("Invalid data type");let r=we.size(this.dims);return r===0?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,r)}getUint16Array(){if(this.dataType!==10&&this.dataType!==4)throw new Error("Invalid data type");let r=we.size(this.dims);return r===0?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,r)}reshape(r){if(we.size(r)!==we.size(this.dims))throw new Error("Invalid new shape");return new Hy(this.module,this.dataType,this.data,r)}},Mb=class{constructor(e,r,t){this.module=e,this.backend=r,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=r.adapterInfo;let s=e.PTR_SIZE,o=t/e.PTR_SIZE,a=s===4?"i32":"i64";this.opKernelContext=Number(e.getValue(s*o++,a));let n=Number(e.getValue(s*o++,a));this.outputCount=Number(e.getValue(s*o++,a)),this.customDataOffset=Number(e.getValue(s*o++,"*")),this.customDataSize=Number(e.getValue(s*o++,a));let i=[];for(let l=0;l<n;l++){let c=Number(e.getValue(s*o++,a)),_=Number(e.getValue(s*o++,"*")),d=Number(e.getValue(s*o++,a)),u=[];for(let f=0;f<d;f++)u.push(Number(e.getValue(s*o++,a)));i.push(new $i(e,c,_,u))}this.inputs=i}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(e,r){var n,i,l;let t=(i=(n=r==null?void 0:r.inputs)==null?void 0:n.map(c=>typeof c=="number"?this.inputs[c]:c))!=null?i:this.inputs,s=(l=r==null?void 0:r.outputs)!=null?l:[],o=(c,_,d)=>new $i(this.module,_,this.output(c,d),d),a=(c,_)=>{let d=za(c,_);if(!d)throw new Error(`Unsupported data type: ${c}`);let u=d>0?this.backend.gpuDataManager.create(d).id:0;return new $i(this.module,c,u,_)};return this.backend.run(e,t,s,o,a,this.outputCount)}output(e,r){let t=this.module.stackSave();try{let s=this.module.PTR_SIZE,o=s===4?"i32":"i64",a=this.module.stackAlloc((1+r.length)*s);this.module.setValue(a,r.length,o);for(let n=0;n<r.length;n++)this.module.setValue(a+s*(n+1),r[n],o);return this.module._JsepOutput(this.opKernelContext,e,a)}catch(s){throw new Error(`Failed to generate kernel\'s output[${e}] with dims [${r}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${s}`)}finally{this.module.stackRestore(t)}}},Ky=async(e,r,t,s)=>{let o=r.jsepInit;if(!o)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if(e==="webgpu"){let a=(gP(),hn(Wy)).WebGpuBackend,n=new a;await n.initialize(t,s),o("webgpu",[n,i=>n.alloc(Number(i)),i=>n.free(i),(i,l,c,_=!1)=>{if(_)jt("verbose",()=>`[WebGPU] jsepCopyGpuToGpu: src=${Number(i)}, dst=${Number(l)}, size=${Number(c)}`),n.memcpy(Number(i),Number(l));else{jt("verbose",()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${Number(i)}, gpuDataId=${Number(l)}, size=${Number(c)}`);let d=r.HEAPU8.subarray(Number(i>>>0),Number(i>>>0)+Number(c));n.upload(Number(l),d)}},async(i,l,c)=>{jt("verbose",()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${i}, dataOffset=${l}, size=${c}`),await n.download(Number(i),()=>r.HEAPU8.subarray(Number(l)>>>0,Number(l+c)>>>0))},(i,l,c)=>n.createKernel(i,Number(l),c,r.UTF8ToString(r._JsepGetNodeName(Number(l)))),i=>n.releaseKernel(i),(i,l,c,_)=>{jt("verbose",()=>`[WebGPU] jsepRun: sessionHandle=${c}, kernel=${i}, contextDataOffset=${l}`);let d=new Mb(r,n,Number(l));return n.computeKernel(Number(i),d,_)},()=>n.captureBegin(),()=>n.captureEnd(),()=>n.replay()])}else{let a=new sv(t);o("webnn",[a,()=>a.reserveTensorId(),n=>a.releaseTensorId(n),async(n,i,l,c,_)=>a.ensureTensor(n,i,l,c,_),(n,i)=>{a.uploadTensor(n,i)},async(n,i)=>a.downloadTensor(n,i)])}}}),qy=Ve(()=>{"use strict";yT(),TT(),bt(),Va(),Ad(),Jb(),wb=(e,r)=>{sr()._OrtInit(e,r)!==0&&Zt("Can\'t initialize onnxruntime.")},Xd=async e=>{wb(e.wasm.numThreads,Bi(e.logLevel))},Jd=async(e,r)=>{var t,s;(s=(t=sr()).asyncInit)==null||s.call(t);{let o=(MP(),hn(Gy)).init;if(r==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");let a=e.webgpu.adapter;if(a){if(typeof a.limits!="object"||typeof a.features!="object"||typeof a.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let n=e.webgpu.powerPreference;if(n!==void 0&&n!=="low-power"&&n!=="high-performance")throw new Error(`Invalid powerPreference setting: "${n}"`);let i=e.webgpu.forceFallbackAdapter;if(i!==void 0&&typeof i!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${i}"`);if(a=await navigator.gpu.requestAdapter({powerPreference:n,forceFallbackAdapter:i}),!a)throw new Error(\'Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.\')}await o("webgpu",sr(),e,a)}if(r==="webnn"){if(typeof navigator>"u"||!navigator.ml)throw new Error("WebNN is not supported in current environment");await o("webnn",sr(),e)}}},na=new Map,bb=e=>{let r=sr(),t=r.stackSave();try{let s=r.PTR_SIZE,o=r.stackAlloc(2*s);r._OrtGetInputOutputCount(e,o,o+s)!==0&&Zt("Can\'t get session input/output count.");let a=s===4?"i32":"i64";return[Number(r.getValue(o,a)),Number(r.getValue(o+s,a))]}finally{r.stackRestore(t)}},id=(e,r)=>{let t=sr(),s=t.stackSave(),o=0;try{let a=t.PTR_SIZE,n=t.stackAlloc(2*a);t._OrtGetInputOutputMetadata(e,r,n,n+a)!==0&&Zt("Can\'t get session input/output metadata.");let i=Number(t.getValue(n,"*"));o=Number(t.getValue(n+a,"*"));let l=t.HEAP32[o/4];if(l===0)return[i,0];let c=t.HEAPU32[o/4+1],_=[];for(let d=0;d<c;d++){let u=Number(t.getValue(o+8+d*a,"*"));_.push(u!==0?t.UTF8ToString(u):Number(t.getValue(o+8+(d+c)*a,"*")))}return[i,l,_]}finally{t.stackRestore(s),o!==0&&t._OrtFree(o)}},Wi=e=>{let r=sr(),t=r._malloc(e.byteLength);if(t===0)throw new Error(`Can\'t create a session. failed to allocate a buffer of size ${e.byteLength}.`);return r.HEAPU8.set(e,t),[t,e.byteLength]},Yd=async(e,r)=>{var d,u,f,h,v,E;let t,s,o=sr();Array.isArray(e)?[t,s]=e:e.buffer===o.HEAPU8.buffer?[t,s]=[e.byteOffset,e.byteLength]:[t,s]=Wi(e);let a=0,n=0,i=0,l=[],c=[],_=[];try{if([n,l]=await Xb(r),(r==null?void 0:r.externalData)&&o.mountExternalData){let A=[];for(let N of r.externalData){let W=typeof N=="string"?N:N.path;A.push(zd(typeof N=="string"?N:N.data).then(R=>{o.mountExternalData(W,R)}))}await Promise.all(A)}for(let A of(d=r==null?void 0:r.executionProviders)!=null?d:[])if((typeof A=="string"?A:A.name)==="webnn"){if(o.shouldTransferToMLTensor=!1,typeof A!="string"){let N=A,W=N==null?void 0:N.context,R=N==null?void 0:N.gpuDevice,J=N==null?void 0:N.deviceType,H=N==null?void 0:N.powerPreference;W?o.currentContext=W:R?o.currentContext=await o.webnnCreateMLContext(R):o.currentContext=await o.webnnCreateMLContext({deviceType:J,powerPreference:H})}else o.currentContext=await o.webnnCreateMLContext();break}a=await o._OrtCreateSession(t,s,n),(u=o.webgpuOnCreateSession)==null||u.call(o,a),a===0&&Zt("Can\'t create a session."),(f=o.jsepOnCreateSession)==null||f.call(o),o.currentContext&&(o.webnnRegisterMLContext(a,o.currentContext),o.currentContext=void 0,o.shouldTransferToMLTensor=!0);let[M,w]=bb(a),C=!!(r!=null&&r.enableGraphCapture),x=[],T=[],S=[],g=[],P=[];for(let A=0;A<M;A++){let[N,W,R]=id(a,A);N===0&&Zt("Can\'t get an input name."),c.push(N);let J=o.UTF8ToString(N);x.push(J),S.push(W===0?{name:J,isTensor:!1}:{name:J,isTensor:!0,type:qs(W),shape:R})}for(let A=0;A<w;A++){let[N,W,R]=id(a,A+M);N===0&&Zt("Can\'t get an output name."),_.push(N);let J=o.UTF8ToString(N);T.push(J),g.push(W===0?{name:J,isTensor:!1}:{name:J,isTensor:!0,type:qs(W),shape:R});{if(C&&(r==null?void 0:r.preferredOutputLocation)===void 0){P.push("gpu-buffer");continue}let H=typeof(r==null?void 0:r.preferredOutputLocation)=="string"?r.preferredOutputLocation:(v=(h=r==null?void 0:r.preferredOutputLocation)==null?void 0:h[J])!=null?v:"cpu";if(H!=="cpu"&&H!=="cpu-pinned"&&H!=="gpu-buffer"&&H!=="ml-tensor")throw new Error(`Not supported preferred output location: ${H}.`);if(C&&H!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${H}. Only \'gpu-buffer\' location is supported when enableGraphCapture is true.`);P.push(H)}}let $=null;return P.some(A=>A==="gpu-buffer"||A==="ml-tensor")&&(i=o._OrtCreateBinding(a),i===0&&Zt("Can\'t create IO binding."),$={handle:i,outputPreferredLocations:P,outputPreferredLocationsEncoded:P.map(A=>_d(A))}),na.set(a,[a,c,_,$,C,!1]),[a,x,T,S,g]}catch(M){throw c.forEach(w=>o._OrtFree(w)),_.forEach(w=>o._OrtFree(w)),i!==0&&o._OrtReleaseBinding(i)!==0&&Zt("Can\'t release IO binding."),a!==0&&o._OrtReleaseSession(a)!==0&&Zt("Can\'t release session."),M}finally{o._free(t),n!==0&&o._OrtReleaseSessionOptions(n)!==0&&Zt("Can\'t release session options."),l.forEach(M=>o._free(M)),(E=o.unmountExternalData)==null||E.call(o)}},Zd=e=>{var l,c,_;let r=sr(),t=na.get(e);if(!t)throw new Error(`cannot release session. invalid session id: ${e}`);let[s,o,a,n,i]=t;n&&(i&&r._OrtClearBoundOutputs(n.handle)!==0&&Zt("Can\'t clear bound outputs."),r._OrtReleaseBinding(n.handle)!==0&&Zt("Can\'t release IO binding.")),(l=r.jsepOnReleaseSession)==null||l.call(r,e),(c=r.webnnOnReleaseSession)==null||c.call(r,e),(_=r.webgpuOnReleaseSession)==null||_.call(r,e),o.forEach(d=>r._OrtFree(d)),a.forEach(d=>r._OrtFree(d)),r._OrtReleaseSession(s)!==0&&Zt("Can\'t release session."),na.delete(e)},ld=async(e,r,t,s,o,a,n=!1)=>{if(!e){r.push(0);return}let i=sr(),l=i.PTR_SIZE,c=e[0],_=e[1],d=e[3],u=d,f,h;if(c==="string"&&(d==="gpu-buffer"||d==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(n&&d!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${a} when enableGraphCapture is true.`);if(d==="gpu-buffer"){let M=e[2].gpuBuffer;h=za(uo(c),_);{let w=i.jsepRegisterBuffer;if(!w)throw new Error(\'Tensor location "gpu-buffer" is not supported without using WebGPU.\');f=w(s,a,M,h)}}else if(d==="ml-tensor"){let M=e[2].mlTensor;h=za(uo(c),_);let w=i.webnnRegisterMLTensor;if(!w)throw new Error(\'Tensor location "ml-tensor" is not supported without using WebNN.\');f=w(s,M,uo(c),_)}else{let M=e[2];if(Array.isArray(M)){h=l*M.length,f=i._malloc(h),t.push(f);for(let w=0;w<M.length;w++){if(typeof M[w]!="string")throw new TypeError(`tensor data at index ${w} is not a string`);i.setValue(f+w*l,Ss(M[w],t),"*")}}else{let w=i.webnnIsGraphInput;if(c!=="string"&&w){let C=i.UTF8ToString(o);if(w(s,C)){let x=uo(c);h=za(x,_),u="ml-tensor";let T=i.webnnCreateTemporaryTensor,S=i.webnnUploadTensor;if(!T||!S)throw new Error(\'Tensor location "ml-tensor" is not supported without using WebNN.\');let g=await T(s,x,_);S(g,new Uint8Array(M.buffer,M.byteOffset,M.byteLength)),f=g}else h=M.byteLength,f=i._malloc(h),t.push(f),i.HEAPU8.set(new Uint8Array(M.buffer,M.byteOffset,h),f)}else h=M.byteLength,f=i._malloc(h),t.push(f),i.HEAPU8.set(new Uint8Array(M.buffer,M.byteOffset,h),f)}}let v=i.stackSave(),E=i.stackAlloc(4*_.length);try{_.forEach((w,C)=>i.setValue(E+C*l,w,l===4?"i32":"i64"));let M=i._OrtCreateTensor(uo(c),f,h,E,_.length,_d(u));M===0&&Zt(`Can\'t create tensor for input/output. session=${s}, index=${a}.`),r.push(M)}finally{i.stackRestore(v)}},eu=async(e,r,t,s,o,a)=>{var N,W,R,J;let n=sr(),i=n.PTR_SIZE,l=na.get(e);if(!l)throw new Error(`cannot run inference. invalid session id: ${e}`);let c=l[0],_=l[1],d=l[2],u=l[3],f=l[4],h=l[5],v=r.length,E=s.length,M=0,w=[],C=[],x=[],T=[],S=n.stackSave(),g=n.stackAlloc(v*i),P=n.stackAlloc(v*i),$=n.stackAlloc(E*i),A=n.stackAlloc(E*i);try{[M,w]=Qb(a);for(let X=0;X<v;X++)await ld(t[X],C,T,e,_[r[X]],r[X],f);for(let X=0;X<E;X++)await ld(o[X],x,T,e,d[s[X]],v+s[X],f);for(let X=0;X<v;X++)n.setValue(g+X*i,C[X],"*"),n.setValue(P+X*i,_[r[X]],"*");for(let X=0;X<E;X++)n.setValue($+X*i,x[X],"*"),n.setValue(A+X*i,d[s[X]],"*");if(u&&!h){let{handle:X,outputPreferredLocations:ae,outputPreferredLocationsEncoded:ce}=u;if(_.length!==v)throw new Error(`input count from feeds (${v}) is expected to be always equal to model\'s input count (${_.length}).`);for(let he=0;he<v;he++){let B=r[he];await n._OrtBindInput(X,_[B],C[he])!==0&&Zt(`Can\'t bind input[${he}] for session=${e}.`)}for(let he=0;he<E;he++){let B=s[he];(N=o[he])!=null&&N[3]?n._OrtBindOutput(X,d[B],x[he],0)!==0&&Zt(`Can\'t bind pre-allocated output[${he}] for session=${e}.`):n._OrtBindOutput(X,d[B],0,ce[B])!==0&&Zt(`Can\'t bind output[${he}] to ${ae[he]} for session=${e}.`)}na.set(e,[c,_,d,u,f,!0])}(W=n.jsepOnRunStart)==null||W.call(n,c),(R=n.webnnOnRunStart)==null||R.call(n,c);let H;u?H=await n._OrtRunWithBinding(c,u.handle,E,$,M):H=await n._OrtRun(c,P,g,v,A,E,$,M),H!==0&&Zt("failed to call OrtRun().");let q=[];for(let X=0;X<E;X++){let ae=Number(n.getValue($+X*i,"*"));if(ae===x[X]){q.push(o[X]);continue}let ce=n.stackSave(),he=n.stackAlloc(4*i),B=!1,D,K=0;try{n._OrtGetTensorData(ae,he,he+i,he+2*i,he+3*i)!==0&&Zt(`Can\'t access output tensor data on index ${X}.`);let re=i===4?"i32":"i64",me=Number(n.getValue(he,re));K=n.getValue(he+i,"*");let oe=n.getValue(he+i*2,"*"),ge=Number(n.getValue(he+i*3,re)),ze=[];for(let ie=0;ie<ge;ie++)ze.push(Number(n.getValue(oe+ie*i,re)));n._OrtFree(oe)!==0&&Zt("Can\'t free memory for tensor dims.");let We=ze.reduce((ie,Y)=>ie*Y,1);D=qs(me);let Ce=u==null?void 0:u.outputPreferredLocations[s[X]];if(D==="string"){if(Ce==="gpu-buffer"||Ce==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let ie=[];for(let Y=0;Y<We;Y++){let j=n.getValue(K+Y*i,"*"),fe=n.getValue(K+(Y+1)*i,"*"),ve=Y===We-1?void 0:fe-j;ie.push(n.UTF8ToString(j,ve))}q.push([D,ze,ie,"cpu"])}else if(Ce==="gpu-buffer"&&We>0){let ie=n.jsepGetBuffer;if(!ie)throw new Error(\'preferredLocation "gpu-buffer" is not supported without using WebGPU.\');let Y=ie(K),j=za(me,We);if(j===void 0||!Od(D))throw new Error(`Unsupported data type: ${D}`);B=!0,q.push([D,ze,{gpuBuffer:Y,download:n.jsepCreateDownloader(Y,j,D),dispose:()=>{n._OrtReleaseTensor(ae)!==0&&Zt("Can\'t release tensor.")}},"gpu-buffer"])}else if(Ce==="ml-tensor"&&We>0){let ie=n.webnnEnsureTensor,Y=n.webnnIsInt64Supported;if(!ie||!Y)throw new Error(\'preferredLocation "ml-tensor" is not supported without using WebNN.\');if(za(me,We)===void 0||!Ld(D))throw new Error(`Unsupported data type: ${D}`);if(D==="int64"&&!Y(e))throw new Error(\'preferredLocation "ml-tensor" for int64 output is not supported by current WebNN Context.\');let j=await ie(e,K,me,ze,!1);B=!0,q.push([D,ze,{mlTensor:j,download:n.webnnCreateMLTensorDownloader(K,D),dispose:()=>{n.webnnReleaseTensorId(K),n._OrtReleaseTensor(ae)}},"ml-tensor"])}else{let ie=Dd(D),Y=new ie(We);new Uint8Array(Y.buffer,Y.byteOffset,Y.byteLength).set(n.HEAPU8.subarray(K,K+Y.byteLength)),q.push([D,ze,Y,"cpu"])}}finally{n.stackRestore(ce),D==="string"&&K&&n._free(K),B||n._OrtReleaseTensor(ae),(J=n.webnnOnRunEnd)==null||J.call(n,c)}}return u&&!f&&(n._OrtClearBoundOutputs(u.handle)!==0&&Zt("Can\'t clear bound outputs."),na.set(e,[c,_,d,u,f,!1])),q}finally{n.stackRestore(S),C.forEach(H=>n._OrtReleaseTensor(H)),x.forEach(H=>n._OrtReleaseTensor(H)),T.forEach(H=>n._free(H)),M!==0&&n._OrtReleaseRunOptions(M),w.forEach(H=>n._free(H))}},tu=e=>{let r=sr(),t=na.get(e);if(!t)throw new Error("invalid session id");let s=t[0],o=r._OrtEndProfiling(s);o===0&&Zt("Can\'t get an profile file name."),r._OrtFree(o)},ru=e=>{let r=[];for(let t of e){let s=t[2];!Array.isArray(s)&&"buffer"in s&&r.push(s.buffer)}return r}}),r0=Ve(()=>{"use strict";As(),qy(),Va(),Fd(),ia=()=>!!nr.wasm.proxy&&typeof document<"u",co=!1,ln=!1,cn=!1,Di=new Map,Da=(e,r)=>{let t=Di.get(e);t?t.push(r):Di.set(e,[r])},Oa=()=>{if(co||!ln||cn||!is)throw new Error("worker not ready")},vb=e=>{switch(e.data.type){case"init-wasm":co=!1,e.data.err?(cn=!0,cd[1](e.data.err)):(ln=!0,cd[0]()),Ai&&(URL.revokeObjectURL(Ai),Ai=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let r=Di.get(e.data.type);e.data.err?r.shift()[1](e.data.err):r.shift()[0](e.data.out);break}default:}},Qy=async()=>{if(!ln){if(co)throw new Error("multiple calls to \'initWasm()\' detected.");if(cn)throw new Error("previous call to \'initWasm()\' failed.");if(co=!0,ia())return new Promise((e,r)=>{is==null||is.terminate(),Hb().then(([t,s])=>{try{is=s,is.onerror=a=>r(a),is.onmessage=vb,cd=[e,r];let o={type:"init-wasm",in:nr};!o.in.wasm.wasmPaths&&(t||ud)&&(o.in.wasm.wasmPaths={wasm:new URL("ort-wasm-simd-threaded.jsep.wasm",Is.url).href}),is.postMessage(o),Ai=t}catch(o){r(o)}},r)});try{await $d(nr.wasm),await Xd(nr),ln=!0}catch(e){throw cn=!0,e}finally{co=!1}}},Xy=async e=>{if(ia())return Oa(),new Promise((r,t)=>{Da("init-ep",[r,t]);let s={type:"init-ep",in:{epName:e,env:nr}};is.postMessage(s)});await Jd(nr,e)},Jy=async e=>ia()?(Oa(),new Promise((r,t)=>{Da("copy-from",[r,t]);let s={type:"copy-from",in:{buffer:e}};is.postMessage(s,[e.buffer])})):Wi(e),Yy=async(e,r)=>{if(ia()){if(r!=null&&r.preferredOutputLocation)throw new Error(\'session option "preferredOutputLocation" is not supported for proxy.\');return Oa(),new Promise((t,s)=>{Da("create",[t,s]);let o={type:"create",in:{model:e,options:Fe({},r)}},a=[];e instanceof Uint8Array&&a.push(e.buffer),is.postMessage(o,a)})}else return Yd(e,r)},Zy=async e=>{if(ia())return Oa(),new Promise((r,t)=>{Da("release",[r,t]);let s={type:"release",in:e};is.postMessage(s)});Zd(e)},e0=async(e,r,t,s,o,a)=>{if(ia()){if(t.some(n=>n[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(o.some(n=>n))throw new Error("pre-allocated output tensor is not supported for proxy.");return Oa(),new Promise((n,i)=>{Da("run",[n,i]);let l=t,c={type:"run",in:{sessionId:e,inputIndices:r,inputs:l,outputIndices:s,options:a}};is.postMessage(c,ru(l))})}else return eu(e,r,t,s,o,a)},t0=async e=>{if(ia())return Oa(),new Promise((r,t)=>{Da("end-profiling",[r,t]);let s={type:"end-profiling",in:e};is.postMessage(s)});tu(e)}}),wP=Ve(()=>{"use strict";As(),r0(),bt(),Id(),Jb(),dd=(e,r)=>{switch(e.location){case"cpu":return[e.type,e.dims,e.data,"cpu"];case"gpu-buffer":return[e.type,e.dims,{gpuBuffer:e.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[e.type,e.dims,{mlTensor:e.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${e.location} for ${r()}`)}},xb=e=>{switch(e[3]){case"cpu":return new Fs(e[0],e[2],e[1]);case"gpu-buffer":{let r=e[0];if(!Od(r))throw new Error(`not supported data type: ${r} for deserializing GPU tensor`);let{gpuBuffer:t,download:s,dispose:o}=e[2];return Fs.fromGpuBuffer(t,{dataType:r,dims:e[1],download:s,dispose:o})}case"ml-tensor":{let r=e[0];if(!Ld(r))throw new Error(`not supported data type: ${r} for deserializing MLTensor tensor`);let{mlTensor:t,download:s,dispose:o}=e[2];return Fs.fromMLTensor(t,{dataType:r,dims:e[1],download:s,dispose:o})}default:throw new Error(`invalid data location: ${e[3]}`)}},s0=class{async fetchModelAndCopyToWasmMemory(e){return Jy(await zd(e))}async loadModel(e,r){$s();let t;typeof e=="string"?t=await this.fetchModelAndCopyToWasmMemory(e):t=e,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await Yy(t,r),bs()}async dispose(){return Zy(this.sessionId)}async run(e,r,t){var d;$s();let s=[],o=[];Object.entries(e).forEach(u=>{let f=u[0],h=u[1],v=this.inputNames.indexOf(f);if(v===-1)throw new Error(`invalid input \'${f}\'`);s.push(h),o.push(v)});let a=[],n=[];Object.entries(r).forEach(u=>{let f=u[0],h=u[1],v=this.outputNames.indexOf(f);if(v===-1)throw new Error(`invalid output \'${f}\'`);a.push(h),n.push(v)});let i=s.map((u,f)=>dd(u,()=>`input "${this.inputNames[o[f]]}"`)),l=a.map((u,f)=>u?dd(u,()=>`output "${this.outputNames[n[f]]}"`):null),c=await e0(this.sessionId,o,i,n,l,t),_={};for(let u=0;u<c.length;u++)_[this.outputNames[n[u]]]=(d=a[u])!=null?d:xb(c[u]);return bs(),_}startProfiling(){}endProfiling(){t0(this.sessionId)}}}),a0={};ho(a0,{OnnxruntimeWebAssemblyBackend:()=>Ed,initializeFlags:()=>Pd,wasmBackend:()=>o0});bP=Ve(()=>{"use strict";As(),r0(),wP(),Pd=()=>{(typeof nr.wasm.initTimeout!="number"||nr.wasm.initTimeout<0)&&(nr.wasm.initTimeout=0);let e=nr.wasm.simd;if(typeof e!="boolean"&&e!==void 0&&e!=="fixed"&&e!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${e}". Reset it to \\`false\\` and ignore SIMD feature checking.`),nr.wasm.simd=!1),typeof nr.wasm.proxy!="boolean"&&(nr.wasm.proxy=!1),typeof nr.wasm.trace!="boolean"&&(nr.wasm.trace=!1),typeof nr.wasm.numThreads!="number"||!Number.isInteger(nr.wasm.numThreads)||nr.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)nr.wasm.numThreads=1;else{let r=typeof navigator>"u"?nT("node:os").cpus().length:navigator.hardwareConcurrency;nr.wasm.numThreads=Math.min(4,Math.ceil((r||1)/2))}},Ed=class{async init(e){Pd(),await Qy(),await Xy(e)}async createInferenceSessionHandler(e,r){let t=new s0;return await t.loadModel(e,r),t}},o0=new Ed});As();As();As();vP="1.22.0-dev.20250409-89f8206ba4",xP=jb;{let e=(bP(),hn(a0)).wasmBackend;Ba("webgpu",e,5),Ba("webnn",e,5),Ba("cpu",e,10),Ba("wasm",e,10)}Object.defineProperty(nr.versions,"web",{value:vP,enumerable:!0});});var l0={};sc(l0,{ASTFeatureExtractor:()=>TP,ASTForAudioClassification:()=>PP,ASTModel:()=>EP,ASTPreTrainedModel:()=>kP,AlbertForMaskedLM:()=>CP,AlbertForQuestionAnswering:()=>SP,AlbertForSequenceClassification:()=>IP,AlbertModel:()=>FP,AlbertPreTrainedModel:()=>$P,AlbertTokenizer:()=>AP,AudioClassificationPipeline:()=>DP,AutoConfig:()=>OP,AutoFeatureExtractor:()=>LP,AutoImageProcessor:()=>zP,AutoModel:()=>BP,AutoModelForAudioClassification:()=>RP,AutoModelForAudioFrameClassification:()=>NP,AutoModelForAudioTextToText:()=>jP,AutoModelForCTC:()=>VP,AutoModelForCausalLM:()=>WP,AutoModelForDepthEstimation:()=>UP,AutoModelForDocumentQuestionAnswering:()=>GP,AutoModelForImageClassification:()=>KP,AutoModelForImageFeatureExtraction:()=>HP,AutoModelForImageMatting:()=>qP,AutoModelForImageSegmentation:()=>QP,AutoModelForImageTextToText:()=>XP,AutoModelForImageToImage:()=>JP,AutoModelForMaskGeneration:()=>YP,AutoModelForMaskedLM:()=>ZP,AutoModelForNormalEstimation:()=>eE,AutoModelForObjectDetection:()=>tE,AutoModelForPoseEstimation:()=>rE,AutoModelForQuestionAnswering:()=>sE,AutoModelForSemanticSegmentation:()=>aE,AutoModelForSeq2SeqLM:()=>oE,AutoModelForSequenceClassification:()=>nE,AutoModelForSpeechSeq2Seq:()=>iE,AutoModelForTextToSpectrogram:()=>lE,AutoModelForTextToWaveform:()=>cE,AutoModelForTokenClassification:()=>dE,AutoModelForUniversalSegmentation:()=>uE,AutoModelForVision2Seq:()=>_E,AutoModelForXVector:()=>pE,AutoModelForZeroShotObjectDetection:()=>mE,AutoProcessor:()=>hE,AutoTokenizer:()=>fE,AutomaticSpeechRecognitionPipeline:()=>gE,BackgroundRemovalPipeline:()=>ME,BartForConditionalGeneration:()=>wE,BartForSequenceClassification:()=>bE,BartModel:()=>vE,BartPretrainedModel:()=>xE,BartTokenizer:()=>yE,BaseModelOutput:()=>TE,BaseStreamer:()=>PE,BeitFeatureExtractor:()=>EE,BeitForImageClassification:()=>kE,BeitModel:()=>CE,BeitPreTrainedModel:()=>SE,BertForMaskedLM:()=>IE,BertForQuestionAnswering:()=>FE,BertForSequenceClassification:()=>$E,BertForTokenClassification:()=>AE,BertModel:()=>DE,BertPreTrainedModel:()=>OE,BertTokenizer:()=>LE,BitImageProcessor:()=>zE,BlenderbotForConditionalGeneration:()=>BE,BlenderbotModel:()=>RE,BlenderbotPreTrainedModel:()=>NE,BlenderbotSmallForConditionalGeneration:()=>jE,BlenderbotSmallModel:()=>VE,BlenderbotSmallPreTrainedModel:()=>WE,BlenderbotSmallTokenizer:()=>UE,BlenderbotTokenizer:()=>GE,BloomForCausalLM:()=>KE,BloomModel:()=>HE,BloomPreTrainedModel:()=>qE,BloomTokenizer:()=>QE,CLIPFeatureExtractor:()=>XE,CLIPImageProcessor:()=>JE,CLIPModel:()=>YE,CLIPPreTrainedModel:()=>ZE,CLIPSegForImageSegmentation:()=>e1,CLIPSegModel:()=>t1,CLIPSegPreTrainedModel:()=>r1,CLIPTextModel:()=>s1,CLIPTextModelWithProjection:()=>a1,CLIPTokenizer:()=>o1,CLIPVisionModel:()=>n1,CLIPVisionModelWithProjection:()=>i1,CamembertForMaskedLM:()=>l1,CamembertForQuestionAnswering:()=>c1,CamembertForSequenceClassification:()=>d1,CamembertForTokenClassification:()=>u1,CamembertModel:()=>_1,CamembertPreTrainedModel:()=>p1,CamembertTokenizer:()=>m1,CausalLMOutput:()=>h1,CausalLMOutputWithPast:()=>f1,ChineseCLIPFeatureExtractor:()=>g1,ChineseCLIPModel:()=>M1,ChineseCLIPPreTrainedModel:()=>w1,ClapAudioModelWithProjection:()=>b1,ClapFeatureExtractor:()=>v1,ClapModel:()=>x1,ClapPreTrainedModel:()=>y1,ClapTextModelWithProjection:()=>T1,ClassifierFreeGuidanceLogitsProcessor:()=>P1,CodeGenForCausalLM:()=>E1,CodeGenModel:()=>k1,CodeGenPreTrainedModel:()=>C1,CodeGenTokenizer:()=>S1,CodeLlamaTokenizer:()=>I1,CohereForCausalLM:()=>F1,CohereModel:()=>$1,CoherePreTrainedModel:()=>A1,CohereTokenizer:()=>D1,ConvBertForMaskedLM:()=>O1,ConvBertForQuestionAnswering:()=>L1,ConvBertForSequenceClassification:()=>z1,ConvBertForTokenClassification:()=>B1,ConvBertModel:()=>R1,ConvBertPreTrainedModel:()=>N1,ConvBertTokenizer:()=>j1,ConvNextFeatureExtractor:()=>V1,ConvNextForImageClassification:()=>W1,ConvNextImageProcessor:()=>U1,ConvNextModel:()=>G1,ConvNextPreTrainedModel:()=>K1,ConvNextV2ForImageClassification:()=>H1,ConvNextV2Model:()=>q1,ConvNextV2PreTrainedModel:()=>Q1,DFineForObjectDetection:()=>X1,DFineModel:()=>J1,DFinePreTrainedModel:()=>Y1,DPTFeatureExtractor:()=>Z1,DPTForDepthEstimation:()=>e2,DPTImageProcessor:()=>t2,DPTModel:()=>r2,DPTPreTrainedModel:()=>s2,DacDecoderModel:()=>a2,DacDecoderOutput:()=>o2,DacEncoderModel:()=>n2,DacEncoderOutput:()=>i2,DacFeatureExtractor:()=>l2,DacModel:()=>c2,DacPreTrainedModel:()=>d2,DataTypeMap:()=>u2,DebertaForMaskedLM:()=>_2,DebertaForQuestionAnswering:()=>p2,DebertaForSequenceClassification:()=>m2,DebertaForTokenClassification:()=>h2,DebertaModel:()=>f2,DebertaPreTrainedModel:()=>g2,DebertaTokenizer:()=>M2,DebertaV2ForMaskedLM:()=>w2,DebertaV2ForQuestionAnswering:()=>b2,DebertaV2ForSequenceClassification:()=>v2,DebertaV2ForTokenClassification:()=>x2,DebertaV2Model:()=>y2,DebertaV2PreTrainedModel:()=>T2,DebertaV2Tokenizer:()=>P2,DecisionTransformerModel:()=>E2,DecisionTransformerPreTrainedModel:()=>k2,DeiTFeatureExtractor:()=>C2,DeiTForImageClassification:()=>S2,DeiTImageProcessor:()=>I2,DeiTModel:()=>F2,DeiTPreTrainedModel:()=>$2,DepthAnythingForDepthEstimation:()=>A2,DepthAnythingPreTrainedModel:()=>D2,DepthEstimationPipeline:()=>O2,DepthProForDepthEstimation:()=>L2,DepthProPreTrainedModel:()=>z2,DetrFeatureExtractor:()=>B2,DetrForObjectDetection:()=>R2,DetrForSegmentation:()=>N2,DetrImageProcessor:()=>j2,DetrModel:()=>V2,DetrObjectDetectionOutput:()=>W2,DetrPreTrainedModel:()=>U2,DetrSegmentationOutput:()=>G2,Dinov2ForImageClassification:()=>K2,Dinov2Model:()=>H2,Dinov2PreTrainedModel:()=>q2,Dinov2WithRegistersForImageClassification:()=>Q2,Dinov2WithRegistersModel:()=>X2,Dinov2WithRegistersPreTrainedModel:()=>J2,DistilBertForMaskedLM:()=>Y2,DistilBertForQuestionAnswering:()=>Z2,DistilBertForSequenceClassification:()=>ek,DistilBertForTokenClassification:()=>tk,DistilBertModel:()=>rk,DistilBertPreTrainedModel:()=>sk,DistilBertTokenizer:()=>ak,DocumentQuestionAnsweringPipeline:()=>ok,DonutFeatureExtractor:()=>nk,DonutImageProcessor:()=>ik,DonutSwinModel:()=>lk,DonutSwinPreTrainedModel:()=>ck,EfficientNetForImageClassification:()=>dk,EfficientNetImageProcessor:()=>uk,EfficientNetModel:()=>_k,EfficientNetPreTrainedModel:()=>pk,ElectraForMaskedLM:()=>mk,ElectraForQuestionAnswering:()=>hk,ElectraForSequenceClassification:()=>fk,ElectraForTokenClassification:()=>gk,ElectraModel:()=>Mk,ElectraPreTrainedModel:()=>wk,ElectraTokenizer:()=>bk,EncodecFeatureExtractor:()=>vk,EosTokenCriteria:()=>xk,EsmForMaskedLM:()=>yk,EsmForSequenceClassification:()=>Tk,EsmForTokenClassification:()=>Pk,EsmModel:()=>Ek,EsmPreTrainedModel:()=>kk,EsmTokenizer:()=>Ck,ExaoneForCausalLM:()=>Sk,ExaoneModel:()=>Ik,ExaonePreTrainedModel:()=>Fk,FFT:()=>$k,FalconForCausalLM:()=>Ak,FalconModel:()=>Dk,FalconPreTrainedModel:()=>Ok,FalconTokenizer:()=>Lk,FastViTForImageClassification:()=>zk,FastViTModel:()=>Bk,FastViTPreTrainedModel:()=>Rk,FeatureExtractionPipeline:()=>Nk,FeatureExtractor:()=>jk,FillMaskPipeline:()=>Vk,Florence2ForConditionalGeneration:()=>Wk,Florence2PreTrainedModel:()=>Uk,Florence2Processor:()=>Gk,ForcedBOSTokenLogitsProcessor:()=>Kk,ForcedEOSTokenLogitsProcessor:()=>Hk,GLPNFeatureExtractor:()=>qk,GLPNForDepthEstimation:()=>Qk,GLPNModel:()=>Xk,GLPNPreTrainedModel:()=>Jk,GPT2LMHeadModel:()=>Yk,GPT2Model:()=>Zk,GPT2PreTrainedModel:()=>eC,GPT2Tokenizer:()=>tC,GPTBigCodeForCausalLM:()=>rC,GPTBigCodeModel:()=>sC,GPTBigCodePreTrainedModel:()=>aC,GPTJForCausalLM:()=>oC,GPTJModel:()=>nC,GPTJPreTrainedModel:()=>iC,GPTNeoForCausalLM:()=>lC,GPTNeoModel:()=>cC,GPTNeoPreTrainedModel:()=>dC,GPTNeoXForCausalLM:()=>uC,GPTNeoXModel:()=>_C,GPTNeoXPreTrainedModel:()=>pC,GPTNeoXTokenizer:()=>mC,Gemma2ForCausalLM:()=>hC,Gemma2Model:()=>fC,Gemma2PreTrainedModel:()=>gC,Gemma3ForCausalLM:()=>MC,Gemma3Model:()=>wC,Gemma3PreTrainedModel:()=>bC,Gemma3nAudioFeatureExtractor:()=>vC,Gemma3nForConditionalGeneration:()=>xC,Gemma3nPreTrainedModel:()=>yC,Gemma3nProcessor:()=>TC,GemmaForCausalLM:()=>PC,GemmaModel:()=>EC,GemmaPreTrainedModel:()=>kC,GemmaTokenizer:()=>CC,GlmForCausalLM:()=>SC,GlmModel:()=>IC,GlmPreTrainedModel:()=>FC,GraniteForCausalLM:()=>$C,GraniteModel:()=>AC,GranitePreTrainedModel:()=>DC,Grok1Tokenizer:()=>OC,GroundingDinoForObjectDetection:()=>LC,GroundingDinoImageProcessor:()=>zC,GroundingDinoPreTrainedModel:()=>BC,GroundingDinoProcessor:()=>RC,GroupViTModel:()=>NC,GroupViTPreTrainedModel:()=>jC,HeliumForCausalLM:()=>VC,HeliumModel:()=>WC,HeliumPreTrainedModel:()=>UC,HerbertTokenizer:()=>GC,HieraForImageClassification:()=>KC,HieraModel:()=>HC,HieraPreTrainedModel:()=>qC,HubertForCTC:()=>QC,HubertForSequenceClassification:()=>XC,HubertModel:()=>JC,HubertPreTrainedModel:()=>YC,IJepaForImageClassification:()=>ZC,IJepaModel:()=>eS,IJepaPreTrainedModel:()=>tS,Idefics3ForConditionalGeneration:()=>rS,Idefics3ImageProcessor:()=>sS,Idefics3PreTrainedModel:()=>aS,Idefics3Processor:()=>oS,ImageClassificationPipeline:()=>nS,ImageFeatureExtractionPipeline:()=>iS,ImageFeatureExtractor:()=>lS,ImageMattingOutput:()=>cS,ImageProcessor:()=>dS,ImageSegmentationPipeline:()=>uS,ImageToImagePipeline:()=>_S,ImageToTextPipeline:()=>pS,InterruptableStoppingCriteria:()=>mS,JAISLMHeadModel:()=>hS,JAISModel:()=>fS,JAISPreTrainedModel:()=>gS,JinaCLIPImageProcessor:()=>MS,JinaCLIPModel:()=>wS,JinaCLIPPreTrainedModel:()=>bS,JinaCLIPProcessor:()=>vS,JinaCLIPTextModel:()=>xS,JinaCLIPVisionModel:()=>yS,LiteWhisperForConditionalGeneration:()=>TS,LlamaForCausalLM:()=>PS,LlamaModel:()=>ES,LlamaPreTrainedModel:()=>kS,LlamaTokenizer:()=>CS,LlavaForConditionalGeneration:()=>SS,LlavaOnevisionForConditionalGeneration:()=>IS,LlavaOnevisionImageProcessor:()=>FS,LlavaPreTrainedModel:()=>$S,LlavaProcessor:()=>AS,LlavaQwen2ForCausalLM:()=>DS,LogitsProcessor:()=>OS,LogitsProcessorList:()=>LS,LogitsWarper:()=>zS,LongT5ForConditionalGeneration:()=>BS,LongT5Model:()=>RS,LongT5PreTrainedModel:()=>NS,M2M100ForConditionalGeneration:()=>jS,M2M100Model:()=>VS,M2M100PreTrainedModel:()=>WS,M2M100Tokenizer:()=>US,MBart50Tokenizer:()=>GS,MBartForCausalLM:()=>KS,MBartForConditionalGeneration:()=>HS,MBartForSequenceClassification:()=>qS,MBartModel:()=>QS,MBartPreTrainedModel:()=>XS,MBartTokenizer:()=>JS,MPNetForMaskedLM:()=>YS,MPNetForQuestionAnswering:()=>ZS,MPNetForSequenceClassification:()=>eI,MPNetForTokenClassification:()=>tI,MPNetModel:()=>rI,MPNetPreTrainedModel:()=>sI,MPNetTokenizer:()=>aI,MT5ForConditionalGeneration:()=>oI,MT5Model:()=>nI,MT5PreTrainedModel:()=>iI,MarianMTModel:()=>lI,MarianModel:()=>cI,MarianPreTrainedModel:()=>dI,MarianTokenizer:()=>uI,Mask2FormerImageProcessor:()=>_I,MaskFormerFeatureExtractor:()=>pI,MaskFormerForInstanceSegmentation:()=>mI,MaskFormerImageProcessor:()=>hI,MaskFormerModel:()=>fI,MaskFormerPreTrainedModel:()=>gI,MaskedLMOutput:()=>MI,MaxLengthCriteria:()=>wI,Metric3DForDepthEstimation:()=>bI,Metric3DPreTrainedModel:()=>vI,Metric3Dv2ForDepthEstimation:()=>xI,Metric3Dv2PreTrainedModel:()=>yI,MgpstrForSceneTextRecognition:()=>TI,MgpstrModelOutput:()=>PI,MgpstrPreTrainedModel:()=>EI,MgpstrProcessor:()=>kI,MgpstrTokenizer:()=>CI,MimiDecoderModel:()=>SI,MimiDecoderOutput:()=>II,MimiEncoderModel:()=>FI,MimiEncoderOutput:()=>$I,MimiModel:()=>AI,MimiPreTrainedModel:()=>DI,MinLengthLogitsProcessor:()=>OI,MinNewTokensLengthLogitsProcessor:()=>LI,MistralForCausalLM:()=>zI,MistralModel:()=>BI,MistralPreTrainedModel:()=>RI,MobileBertForMaskedLM:()=>NI,MobileBertForQuestionAnswering:()=>jI,MobileBertForSequenceClassification:()=>VI,MobileBertModel:()=>WI,MobileBertPreTrainedModel:()=>UI,MobileBertTokenizer:()=>GI,MobileLLMForCausalLM:()=>KI,MobileLLMModel:()=>HI,MobileLLMPreTrainedModel:()=>qI,MobileNetV1FeatureExtractor:()=>QI,MobileNetV1ForImageClassification:()=>XI,MobileNetV1ForSemanticSegmentation:()=>JI,MobileNetV1ImageProcessor:()=>YI,MobileNetV1Model:()=>ZI,MobileNetV1PreTrainedModel:()=>eF,MobileNetV2FeatureExtractor:()=>tF,MobileNetV2ForImageClassification:()=>rF,MobileNetV2ForSemanticSegmentation:()=>sF,MobileNetV2ImageProcessor:()=>aF,MobileNetV2Model:()=>oF,MobileNetV2PreTrainedModel:()=>nF,MobileNetV3FeatureExtractor:()=>iF,MobileNetV3ForImageClassification:()=>lF,MobileNetV3ForSemanticSegmentation:()=>cF,MobileNetV3ImageProcessor:()=>dF,MobileNetV3Model:()=>uF,MobileNetV3PreTrainedModel:()=>_F,MobileNetV4FeatureExtractor:()=>pF,MobileNetV4ForImageClassification:()=>mF,MobileNetV4ForSemanticSegmentation:()=>hF,MobileNetV4ImageProcessor:()=>fF,MobileNetV4Model:()=>gF,MobileNetV4PreTrainedModel:()=>MF,MobileViTFeatureExtractor:()=>wF,MobileViTForImageClassification:()=>bF,MobileViTImageProcessor:()=>vF,MobileViTModel:()=>xF,MobileViTPreTrainedModel:()=>yF,MobileViTV2ForImageClassification:()=>TF,MobileViTV2Model:()=>PF,MobileViTV2PreTrainedModel:()=>EF,ModelOutput:()=>kF,ModernBertForMaskedLM:()=>CF,ModernBertForSequenceClassification:()=>SF,ModernBertForTokenClassification:()=>IF,ModernBertModel:()=>FF,ModernBertPreTrainedModel:()=>$F,Moondream1ForConditionalGeneration:()=>AF,MoonshineFeatureExtractor:()=>DF,MoonshineForConditionalGeneration:()=>OF,MoonshineModel:()=>LF,MoonshinePreTrainedModel:()=>zF,MoonshineProcessor:()=>BF,MptForCausalLM:()=>RF,MptModel:()=>NF,MptPreTrainedModel:()=>jF,MultiModalityCausalLM:()=>VF,MultiModalityPreTrainedModel:()=>WF,MusicgenForCausalLM:()=>UF,MusicgenForConditionalGeneration:()=>GF,MusicgenModel:()=>KF,MusicgenPreTrainedModel:()=>HF,NllbTokenizer:()=>qF,NoBadWordsLogitsProcessor:()=>QF,NoRepeatNGramLogitsProcessor:()=>XF,NomicBertModel:()=>JF,NomicBertPreTrainedModel:()=>YF,NougatImageProcessor:()=>ZF,NougatTokenizer:()=>e$,OPTForCausalLM:()=>t$,OPTModel:()=>r$,OPTPreTrainedModel:()=>s$,ObjectDetectionPipeline:()=>a$,Olmo2ForCausalLM:()=>o$,Olmo2Model:()=>n$,Olmo2PreTrainedModel:()=>i$,OlmoForCausalLM:()=>l$,OlmoModel:()=>c$,OlmoPreTrainedModel:()=>d$,OpenELMForCausalLM:()=>u$,OpenELMModel:()=>_$,OpenELMPreTrainedModel:()=>p$,OwlViTFeatureExtractor:()=>m$,OwlViTForObjectDetection:()=>h$,OwlViTImageProcessor:()=>f$,OwlViTModel:()=>g$,OwlViTPreTrainedModel:()=>M$,OwlViTProcessor:()=>w$,Owlv2ForObjectDetection:()=>b$,Owlv2ImageProcessor:()=>v$,Owlv2Model:()=>x$,Owlv2PreTrainedModel:()=>y$,PaliGemmaForConditionalGeneration:()=>T$,PaliGemmaPreTrainedModel:()=>P$,PaliGemmaProcessor:()=>E$,PatchTSMixerForPrediction:()=>k$,PatchTSMixerModel:()=>C$,PatchTSMixerPreTrainedModel:()=>S$,PatchTSTForPrediction:()=>I$,PatchTSTModel:()=>F$,PatchTSTPreTrainedModel:()=>$$,Phi3ForCausalLM:()=>A$,Phi3Model:()=>D$,Phi3PreTrainedModel:()=>O$,Phi3VForCausalLM:()=>L$,Phi3VImageProcessor:()=>z$,Phi3VPreTrainedModel:()=>B$,Phi3VProcessor:()=>R$,PhiForCausalLM:()=>N$,PhiModel:()=>j$,PhiPreTrainedModel:()=>V$,Pipeline:()=>W$,PreTrainedModel:()=>U$,PreTrainedTokenizer:()=>G$,PretrainedConfig:()=>K$,PretrainedMixin:()=>H$,Processor:()=>q$,PvtForImageClassification:()=>Q$,PvtImageProcessor:()=>X$,PvtModel:()=>J$,PvtPreTrainedModel:()=>Y$,PyAnnoteFeatureExtractor:()=>Z$,PyAnnoteForAudioFrameClassification:()=>eA,PyAnnoteModel:()=>tA,PyAnnotePreTrainedModel:()=>rA,PyAnnoteProcessor:()=>sA,QuestionAnsweringModelOutput:()=>aA,QuestionAnsweringPipeline:()=>oA,Qwen2ForCausalLM:()=>nA,Qwen2Model:()=>iA,Qwen2PreTrainedModel:()=>lA,Qwen2Tokenizer:()=>cA,Qwen2VLForConditionalGeneration:()=>dA,Qwen2VLImageProcessor:()=>uA,Qwen2VLPreTrainedModel:()=>_A,Qwen2VLProcessor:()=>pA,Qwen3ForCausalLM:()=>mA,Qwen3Model:()=>hA,Qwen3PreTrainedModel:()=>fA,RFDetrForObjectDetection:()=>gA,RFDetrModel:()=>MA,RFDetrObjectDetectionOutput:()=>wA,RFDetrPreTrainedModel:()=>bA,RTDetrForObjectDetection:()=>vA,RTDetrImageProcessor:()=>xA,RTDetrModel:()=>yA,RTDetrObjectDetectionOutput:()=>TA,RTDetrPreTrainedModel:()=>PA,RTDetrV2ForObjectDetection:()=>EA,RTDetrV2Model:()=>kA,RTDetrV2ObjectDetectionOutput:()=>CA,RTDetrV2PreTrainedModel:()=>SA,RawAudio:()=>IA,RawImage:()=>FA,RawVideo:()=>$A,RawVideoFrame:()=>AA,RepetitionPenaltyLogitsProcessor:()=>DA,ResNetForImageClassification:()=>OA,ResNetModel:()=>LA,ResNetPreTrainedModel:()=>zA,RoFormerForMaskedLM:()=>BA,RoFormerForQuestionAnswering:()=>RA,RoFormerForSequenceClassification:()=>NA,RoFormerForTokenClassification:()=>jA,RoFormerModel:()=>VA,RoFormerPreTrainedModel:()=>WA,RoFormerTokenizer:()=>UA,RobertaForMaskedLM:()=>GA,RobertaForQuestionAnswering:()=>KA,RobertaForSequenceClassification:()=>HA,RobertaForTokenClassification:()=>qA,RobertaModel:()=>QA,RobertaPreTrainedModel:()=>XA,RobertaTokenizer:()=>JA,SamImageProcessor:()=>YA,SamImageSegmentationOutput:()=>ZA,SamModel:()=>eD,SamPreTrainedModel:()=>tD,SamProcessor:()=>rD,SapiensForDepthEstimation:()=>sD,SapiensForNormalEstimation:()=>aD,SapiensForSemanticSegmentation:()=>oD,SapiensPreTrainedModel:()=>nD,SeamlessM4TFeatureExtractor:()=>iD,SegformerFeatureExtractor:()=>lD,SegformerForImageClassification:()=>cD,SegformerForSemanticSegmentation:()=>dD,SegformerImageProcessor:()=>uD,SegformerModel:()=>_D,SegformerPreTrainedModel:()=>pD,Seq2SeqLMOutput:()=>mD,SequenceClassifierOutput:()=>hD,SiglipImageProcessor:()=>fD,SiglipModel:()=>gD,SiglipPreTrainedModel:()=>MD,SiglipTextModel:()=>wD,SiglipTokenizer:()=>bD,SiglipVisionModel:()=>vD,SmolVLMForConditionalGeneration:()=>xD,SmolVLMImageProcessor:()=>yD,SmolVLMProcessor:()=>TD,SnacDecoderModel:()=>PD,SnacEncoderModel:()=>ED,SnacFeatureExtractor:()=>kD,SnacModel:()=>CD,SnacPreTrainedModel:()=>SD,SpeechT5FeatureExtractor:()=>ID,SpeechT5ForSpeechToText:()=>FD,SpeechT5ForTextToSpeech:()=>$D,SpeechT5HifiGan:()=>AD,SpeechT5Model:()=>DD,SpeechT5PreTrainedModel:()=>OD,SpeechT5Processor:()=>LD,SpeechT5Tokenizer:()=>zD,SqueezeBertForMaskedLM:()=>BD,SqueezeBertForQuestionAnswering:()=>RD,SqueezeBertForSequenceClassification:()=>ND,SqueezeBertModel:()=>jD,SqueezeBertPreTrainedModel:()=>VD,SqueezeBertTokenizer:()=>WD,StableLmForCausalLM:()=>UD,StableLmModel:()=>GD,StableLmPreTrainedModel:()=>KD,Starcoder2ForCausalLM:()=>HD,Starcoder2Model:()=>qD,Starcoder2PreTrainedModel:()=>QD,StoppingCriteria:()=>XD,StoppingCriteriaList:()=>JD,StyleTextToSpeech2Model:()=>YD,StyleTextToSpeech2PreTrainedModel:()=>ZD,SummarizationPipeline:()=>eO,SuppressTokensAtBeginLogitsProcessor:()=>tO,Swin2SRForImageSuperResolution:()=>rO,Swin2SRImageProcessor:()=>sO,Swin2SRModel:()=>aO,Swin2SRPreTrainedModel:()=>oO,SwinForImageClassification:()=>nO,SwinForSemanticSegmentation:()=>iO,SwinModel:()=>lO,SwinPreTrainedModel:()=>cO,T5ForConditionalGeneration:()=>dO,T5Model:()=>uO,T5PreTrainedModel:()=>_O,T5Tokenizer:()=>pO,TableTransformerForObjectDetection:()=>mO,TableTransformerModel:()=>hO,TableTransformerObjectDetectionOutput:()=>fO,TableTransformerPreTrainedModel:()=>gO,TemperatureLogitsWarper:()=>MO,Tensor:()=>wO,Text2TextGenerationPipeline:()=>bO,TextClassificationPipeline:()=>vO,TextGenerationPipeline:()=>xO,TextStreamer:()=>yO,TextToAudioPipeline:()=>TO,TokenClassificationPipeline:()=>PO,TokenClassifierOutput:()=>EO,TokenizerModel:()=>kO,TopKLogitsWarper:()=>CO,TopPLogitsWarper:()=>SO,TrOCRForCausalLM:()=>IO,TrOCRPreTrainedModel:()=>FO,TranslationPipeline:()=>$O,UltravoxModel:()=>AO,UltravoxPreTrainedModel:()=>DO,UltravoxProcessor:()=>OO,UniSpeechForCTC:()=>LO,UniSpeechForSequenceClassification:()=>zO,UniSpeechModel:()=>BO,UniSpeechPreTrainedModel:()=>RO,UniSpeechSatForAudioFrameClassification:()=>NO,UniSpeechSatForCTC:()=>jO,UniSpeechSatForSequenceClassification:()=>VO,UniSpeechSatModel:()=>WO,UniSpeechSatPreTrainedModel:()=>UO,VLChatProcessor:()=>GO,VLMImageProcessor:()=>KO,ViTFeatureExtractor:()=>HO,ViTForImageClassification:()=>qO,ViTImageProcessor:()=>QO,ViTMAEModel:()=>XO,ViTMAEPreTrainedModel:()=>JO,ViTMSNForImageClassification:()=>YO,ViTMSNModel:()=>ZO,ViTMSNPreTrainedModel:()=>eL,ViTModel:()=>tL,ViTPreTrainedModel:()=>rL,VisionEncoderDecoderModel:()=>sL,VitMatteForImageMatting:()=>aL,VitMatteImageProcessor:()=>oL,VitMattePreTrainedModel:()=>nL,VitPoseForPoseEstimation:()=>iL,VitPoseImageProcessor:()=>lL,VitPosePreTrainedModel:()=>cL,VitsModel:()=>dL,VitsModelOutput:()=>uL,VitsPreTrainedModel:()=>_L,VitsTokenizer:()=>pL,Wav2Vec2BertForCTC:()=>mL,Wav2Vec2BertForSequenceClassification:()=>hL,Wav2Vec2BertModel:()=>fL,Wav2Vec2BertPreTrainedModel:()=>gL,Wav2Vec2CTCTokenizer:()=>ML,Wav2Vec2FeatureExtractor:()=>wL,Wav2Vec2ForAudioFrameClassification:()=>bL,Wav2Vec2ForCTC:()=>vL,Wav2Vec2ForSequenceClassification:()=>xL,Wav2Vec2Model:()=>yL,Wav2Vec2PreTrainedModel:()=>TL,Wav2Vec2Processor:()=>PL,Wav2Vec2ProcessorWithLM:()=>EL,WavLMForAudioFrameClassification:()=>kL,WavLMForCTC:()=>CL,WavLMForSequenceClassification:()=>SL,WavLMForXVector:()=>IL,WavLMModel:()=>FL,WavLMPreTrainedModel:()=>$L,WeSpeakerFeatureExtractor:()=>AL,WeSpeakerResNetModel:()=>DL,WeSpeakerResNetPreTrainedModel:()=>OL,WhisperFeatureExtractor:()=>LL,WhisperForConditionalGeneration:()=>zL,WhisperModel:()=>BL,WhisperPreTrainedModel:()=>RL,WhisperProcessor:()=>NL,WhisperTextStreamer:()=>jL,WhisperTimeStampLogitsProcessor:()=>VL,WhisperTokenizer:()=>WL,XLMForQuestionAnswering:()=>UL,XLMForSequenceClassification:()=>GL,XLMForTokenClassification:()=>KL,XLMModel:()=>HL,XLMPreTrainedModel:()=>qL,XLMRobertaForMaskedLM:()=>QL,XLMRobertaForQuestionAnswering:()=>XL,XLMRobertaForSequenceClassification:()=>JL,XLMRobertaForTokenClassification:()=>YL,XLMRobertaModel:()=>ZL,XLMRobertaPreTrainedModel:()=>e3,XLMRobertaTokenizer:()=>t3,XLMTokenizer:()=>r3,XLMWithLMHeadModel:()=>s3,XVectorOutput:()=>a3,YolosFeatureExtractor:()=>o3,YolosForObjectDetection:()=>n3,YolosImageProcessor:()=>i3,YolosModel:()=>l3,YolosObjectDetectionOutput:()=>c3,YolosPreTrainedModel:()=>d3,ZeroShotAudioClassificationPipeline:()=>u3,ZeroShotClassificationPipeline:()=>_3,ZeroShotImageClassificationPipeline:()=>p3,ZeroShotObjectDetectionPipeline:()=>m3,bankers_round:()=>h3,cat:()=>f3,cos_sim:()=>g3,dot:()=>M3,dynamic_time_warping:()=>w3,env:()=>b3,full:()=>v3,full_like:()=>x3,getKeyValueShapes:()=>y3,hamming:()=>T3,hanning:()=>P3,interpolate:()=>E3,interpolate_4d:()=>k3,interpolate_data:()=>C3,is_chinese_char:()=>S3,layer_norm:()=>I3,load_image:()=>F3,load_video:()=>$3,log_softmax:()=>A3,magnitude:()=>D3,matmul:()=>O3,max:()=>L3,mean:()=>z3,mean_pooling:()=>B3,medianFilter:()=>R3,mel_filter_bank:()=>N3,min:()=>j3,ones:()=>V3,ones_like:()=>W3,permute:()=>U3,permute_data:()=>G3,pipeline:()=>K3,quantize_embeddings:()=>H3,rand:()=>q3,read_audio:()=>Q3,rfft:()=>X3,round:()=>J3,slice:()=>Y3,softmax:()=>Z3,spectrogram:()=>ez,stack:()=>tz,std_mean:()=>rz,topk:()=>sz,window_function:()=>az,zeros:()=>oz,zeros_like:()=>nz});function Qt(e){var r=i0[e];if(r!==void 0)return r.exports;var t=i0[e]={exports:{}};return yP[e](t,t.exports,Qt),t.exports}var iz,yP,i0,m,TP,PP,EP,kP,CP,SP,IP,FP,$P,AP,DP,OP,LP,zP,BP,RP,NP,jP,VP,WP,UP,GP,KP,HP,qP,QP,XP,JP,YP,ZP,eE,tE,rE,sE,aE,oE,nE,iE,lE,cE,dE,uE,_E,pE,mE,hE,fE,gE,ME,wE,bE,vE,xE,yE,TE,PE,EE,kE,CE,SE,IE,FE,$E,AE,DE,OE,LE,zE,BE,RE,NE,jE,VE,WE,UE,GE,KE,HE,qE,QE,XE,JE,YE,ZE,e1,t1,r1,s1,a1,o1,n1,i1,l1,c1,d1,u1,_1,p1,m1,h1,f1,g1,M1,w1,b1,v1,x1,y1,T1,P1,E1,k1,C1,S1,I1,F1,$1,A1,D1,O1,L1,z1,B1,R1,N1,j1,V1,W1,U1,G1,K1,H1,q1,Q1,X1,J1,Y1,Z1,e2,t2,r2,s2,a2,o2,n2,i2,l2,c2,d2,u2,_2,p2,m2,h2,f2,g2,M2,w2,b2,v2,x2,y2,T2,P2,E2,k2,C2,S2,I2,F2,$2,A2,D2,O2,L2,z2,B2,R2,N2,j2,V2,W2,U2,G2,K2,H2,q2,Q2,X2,J2,Y2,Z2,ek,tk,rk,sk,ak,ok,nk,ik,lk,ck,dk,uk,_k,pk,mk,hk,fk,gk,Mk,wk,bk,vk,xk,yk,Tk,Pk,Ek,kk,Ck,Sk,Ik,Fk,$k,Ak,Dk,Ok,Lk,zk,Bk,Rk,Nk,jk,Vk,Wk,Uk,Gk,Kk,Hk,qk,Qk,Xk,Jk,Yk,Zk,eC,tC,rC,sC,aC,oC,nC,iC,lC,cC,dC,uC,_C,pC,mC,hC,fC,gC,MC,wC,bC,vC,xC,yC,TC,PC,EC,kC,CC,SC,IC,FC,$C,AC,DC,OC,LC,zC,BC,RC,NC,jC,VC,WC,UC,GC,KC,HC,qC,QC,XC,JC,YC,ZC,eS,tS,rS,sS,aS,oS,nS,iS,lS,cS,dS,uS,_S,pS,mS,hS,fS,gS,MS,wS,bS,vS,xS,yS,TS,PS,ES,kS,CS,SS,IS,FS,$S,AS,DS,OS,LS,zS,BS,RS,NS,jS,VS,WS,US,GS,KS,HS,qS,QS,XS,JS,YS,ZS,eI,tI,rI,sI,aI,oI,nI,iI,lI,cI,dI,uI,_I,pI,mI,hI,fI,gI,MI,wI,bI,vI,xI,yI,TI,PI,EI,kI,CI,SI,II,FI,$I,AI,DI,OI,LI,zI,BI,RI,NI,jI,VI,WI,UI,GI,KI,HI,qI,QI,XI,JI,YI,ZI,eF,tF,rF,sF,aF,oF,nF,iF,lF,cF,dF,uF,_F,pF,mF,hF,fF,gF,MF,wF,bF,vF,xF,yF,TF,PF,EF,kF,CF,SF,IF,FF,$F,AF,DF,OF,LF,zF,BF,RF,NF,jF,VF,WF,UF,GF,KF,HF,qF,QF,XF,JF,YF,ZF,e$,t$,r$,s$,a$,o$,n$,i$,l$,c$,d$,u$,_$,p$,m$,h$,f$,g$,M$,w$,b$,v$,x$,y$,T$,P$,E$,k$,C$,S$,I$,F$,$$,A$,D$,O$,L$,z$,B$,R$,N$,j$,V$,W$,U$,G$,K$,H$,q$,Q$,X$,J$,Y$,Z$,eA,tA,rA,sA,aA,oA,nA,iA,lA,cA,dA,uA,_A,pA,mA,hA,fA,gA,MA,wA,bA,vA,xA,yA,TA,PA,EA,kA,CA,SA,IA,FA,$A,AA,DA,OA,LA,zA,BA,RA,NA,jA,VA,WA,UA,GA,KA,HA,qA,QA,XA,JA,YA,ZA,eD,tD,rD,sD,aD,oD,nD,iD,lD,cD,dD,uD,_D,pD,mD,hD,fD,gD,MD,wD,bD,vD,xD,yD,TD,PD,ED,kD,CD,SD,ID,FD,$D,AD,DD,OD,LD,zD,BD,RD,ND,jD,VD,WD,UD,GD,KD,HD,qD,QD,XD,JD,YD,ZD,eO,tO,rO,sO,aO,oO,nO,iO,lO,cO,dO,uO,_O,pO,mO,hO,fO,gO,MO,wO,bO,vO,xO,yO,TO,PO,EO,kO,CO,SO,IO,FO,$O,AO,DO,OO,LO,zO,BO,RO,NO,jO,VO,WO,UO,GO,KO,HO,qO,QO,XO,JO,YO,ZO,eL,tL,rL,sL,aL,oL,nL,iL,lL,cL,dL,uL,_L,pL,mL,hL,fL,gL,ML,wL,bL,vL,xL,yL,TL,PL,EL,kL,CL,SL,IL,FL,$L,AL,DL,OL,LL,zL,BL,RL,NL,jL,VL,WL,UL,GL,KL,HL,qL,QL,XL,JL,YL,ZL,e3,t3,r3,s3,a3,o3,n3,i3,l3,c3,d3,u3,_3,p3,m3,h3,f3,g3,M3,w3,b3,v3,x3,y3,T3,P3,E3,k3,C3,S3,I3,F3,$3,A3,D3,O3,L3,z3,B3,R3,N3,j3,V3,W3,U3,G3,K3,H3,q3,Q3,X3,J3,Y3,Z3,ez,tz,rz,sz,az,oz,nz,c0=Er(()=>{Uf();n0();iz={},yP={"onnxruntime-common":e=>{e.exports=uc},"onnxruntime-web":e=>{e.exports=su},"?2ce3":()=>{},"?7992":()=>{},"?5af5":()=>{},"?2b25":()=>{},"?db59":()=>{},"?383f":()=>{},"?fa4b":()=>{},"./node_modules/@huggingface/jinja/dist/index.js":(e,r,t)=>{t.r(r),t.d(r,{Environment:()=>He,Interpreter:()=>Ue,Template:()=>Jr,parse:()=>K,tokenize:()=>d});var s=Object.freeze({Text:"Text",NumericLiteral:"NumericLiteral",BooleanLiteral:"BooleanLiteral",NullLiteral:"NullLiteral",StringLiteral:"StringLiteral",Identifier:"Identifier",Equals:"Equals",OpenParen:"OpenParen",CloseParen:"CloseParen",OpenStatement:"OpenStatement",CloseStatement:"CloseStatement",OpenExpression:"OpenExpression",CloseExpression:"CloseExpression",OpenSquareBracket:"OpenSquareBracket",CloseSquareBracket:"CloseSquareBracket",OpenCurlyBracket:"OpenCurlyBracket",CloseCurlyBracket:"CloseCurlyBracket",Comma:"Comma",Dot:"Dot",Colon:"Colon",Pipe:"Pipe",CallOperator:"CallOperator",AdditiveBinaryOperator:"AdditiveBinaryOperator",MultiplicativeBinaryOperator:"MultiplicativeBinaryOperator",ComparisonBinaryOperator:"ComparisonBinaryOperator",UnaryOperator:"UnaryOperator",Set:"Set",If:"If",For:"For",In:"In",Is:"Is",NotIn:"NotIn",Else:"Else",EndSet:"EndSet",EndIf:"EndIf",ElseIf:"ElseIf",EndFor:"EndFor",And:"And",Or:"Or",Not:"UnaryOperator",Macro:"Macro",EndMacro:"EndMacro",Break:"Break",Continue:"Continue"}),o=Object.freeze({set:s.Set,for:s.For,in:s.In,is:s.Is,if:s.If,else:s.Else,endset:s.EndSet,endif:s.EndIf,elif:s.ElseIf,endfor:s.EndFor,and:s.And,or:s.Or,not:s.Not,"not in":s.NotIn,macro:s.Macro,endmacro:s.EndMacro,break:s.Break,continue:s.Continue,true:s.BooleanLiteral,false:s.BooleanLiteral,none:s.NullLiteral,True:s.BooleanLiteral,False:s.BooleanLiteral,None:s.NullLiteral}),a=class{constructor(L,se){this.value=L,this.type=se}};function n(L){return/\\w/.test(L)}function i(L){return/[0-9]/.test(L)}var l=[["{%",s.OpenStatement],["%}",s.CloseStatement],["{{",s.OpenExpression],["}}",s.CloseExpression],["(",s.OpenParen],[")",s.CloseParen],["{",s.OpenCurlyBracket],["}",s.CloseCurlyBracket],["[",s.OpenSquareBracket],["]",s.CloseSquareBracket],[",",s.Comma],[".",s.Dot],[":",s.Colon],["|",s.Pipe],["<=",s.ComparisonBinaryOperator],[">=",s.ComparisonBinaryOperator],["==",s.ComparisonBinaryOperator],["!=",s.ComparisonBinaryOperator],["<",s.ComparisonBinaryOperator],[">",s.ComparisonBinaryOperator],["+",s.AdditiveBinaryOperator],["-",s.AdditiveBinaryOperator],["*",s.MultiplicativeBinaryOperator],["/",s.MultiplicativeBinaryOperator],["%",s.MultiplicativeBinaryOperator],["=",s.Equals]],c=new Map([["n",`\n`],["t","	"],["r","\\r"],["b","\\b"],["f","\\f"],["v","\\v"],["\'","\'"],[\'"\',\'"\'],["\\\\","\\\\"]]);function _(L,se={}){return L.endsWith(`\n`)&&(L=L.slice(0,-1)),L=L.replace(new RegExp("{#.*?#}","gs"),"{##}"),se.lstrip_blocks&&(L=L.replace(/^[ \\t]*({[#%])/gm,"$1")),se.trim_blocks&&(L=L.replace(/([#%]})\\n/g,"$1")),L.replace(/{##}/g,"").replace(/-%}\\s*/g,"%}").replace(/\\s*{%-/g,"{%").replace(/-}}\\s*/g,"}}").replace(/\\s*{{-/g,"{{")}function d(L,se={}){var Se,Dt,Xt;let G=[],te=_(L,se),Me=0,je=ht=>{let Ot="";for(;ht(te[Me]);){if(te[Me]==="\\\\"){if(++Me,Me>=te.length)throw new SyntaxError("Unexpected end of input");let Ye=te[Me++],vt=c.get(Ye);if(vt===void 0)throw new SyntaxError(`Unexpected escaped character: ${Ye}`);Ot+=vt;continue}if(Ot+=te[Me++],Me>=te.length)throw new SyntaxError("Unexpected end of input")}return Ot};e:for(;Me<te.length;){let ht=(Se=G.at(-1))==null?void 0:Se.type;if(ht===void 0||ht===s.CloseStatement||ht===s.CloseExpression){let Ye="";for(;Me<te.length&&!(te[Me]==="{"&&(te[Me+1]==="%"||te[Me+1]==="{"));)Ye+=te[Me++];if(Ye.length>0){G.push(new a(Ye,s.Text));continue}}je(Ye=>/\\s/.test(Ye));let Ot=te[Me];if(Ot==="-"||Ot==="+"){let Ye=(Dt=G.at(-1))==null?void 0:Dt.type;if(Ye===s.Text||Ye===void 0)throw new SyntaxError(`Unexpected character: ${Ot}`);switch(Ye){case s.Identifier:case s.NumericLiteral:case s.BooleanLiteral:case s.NullLiteral:case s.StringLiteral:case s.CloseParen:case s.CloseSquareBracket:break;default:{++Me;let vt=je(i);G.push(new a(`${Ot}${vt}`,vt.length>0?s.NumericLiteral:s.UnaryOperator));continue}}}for(let[Ye,vt]of l)if(te.slice(Me,Me+Ye.length)===Ye){G.push(new a(Ye,vt)),Me+=Ye.length;continue e}if(Ot==="\'"||Ot===\'"\'){++Me;let Ye=je(vt=>vt!==Ot);G.push(new a(Ye,s.StringLiteral)),++Me;continue}if(i(Ot)){let Ye=je(i);G.push(new a(Ye,s.NumericLiteral));continue}if(n(Ot)){let Ye=je(n),vt=Object.hasOwn(o,Ye)?o[Ye]:s.Identifier;vt===s.In&&((Xt=G.at(-1))==null?void 0:Xt.type)===s.Not?(G.pop(),G.push(new a("not in",s.NotIn))):G.push(new a(Ye,vt));continue}throw new SyntaxError(`Unexpected character: ${Ot}`)}return G}var u=class{constructor(){ee(this,"type","Statement")}},f=class extends u{constructor(se){super();ee(this,"type","Program");this.body=se}},h=class extends u{constructor(se,G,te){super();ee(this,"type","If");this.test=se,this.body=G,this.alternate=te}},v=class extends u{constructor(se,G,te,Me){super();ee(this,"type","For");this.loopvar=se,this.iterable=G,this.body=te,this.defaultBlock=Me}},E=class extends u{constructor(){super(...arguments);ee(this,"type","Break")}},M=class extends u{constructor(){super(...arguments);ee(this,"type","Continue")}},w=class extends u{constructor(se,G,te){super();ee(this,"type","Set");this.assignee=se,this.value=G,this.body=te}},C=class extends u{constructor(se,G,te){super();ee(this,"type","Macro");this.name=se,this.args=G,this.body=te}},x=class extends u{constructor(){super(...arguments);ee(this,"type","Expression")}},T=class extends x{constructor(se,G,te){super();ee(this,"type","MemberExpression");this.object=se,this.property=G,this.computed=te}},S=class extends x{constructor(se,G){super();ee(this,"type","CallExpression");this.callee=se,this.args=G}},g=class extends x{constructor(se){super();ee(this,"type","Identifier");this.value=se}},P=class extends x{constructor(se){super();ee(this,"type","Literal");this.value=se}},$=class extends P{constructor(){super(...arguments);ee(this,"type","NumericLiteral")}},A=class extends P{constructor(){super(...arguments);ee(this,"type","StringLiteral")}},N=class extends P{constructor(){super(...arguments);ee(this,"type","BooleanLiteral")}},W=class extends P{constructor(){super(...arguments);ee(this,"type","NullLiteral")}},R=class extends P{constructor(){super(...arguments);ee(this,"type","ArrayLiteral")}},J=class extends P{constructor(){super(...arguments);ee(this,"type","TupleLiteral")}},H=class extends P{constructor(){super(...arguments);ee(this,"type","ObjectLiteral")}},q=class extends x{constructor(se,G,te){super();ee(this,"type","BinaryExpression");this.operator=se,this.left=G,this.right=te}},X=class extends x{constructor(se,G){super();ee(this,"type","FilterExpression");this.operand=se,this.filter=G}},ae=class extends x{constructor(se,G){super();ee(this,"type","SelectExpression");this.iterable=se,this.test=G}},ce=class extends x{constructor(se,G,te){super();ee(this,"type","TestExpression");this.operand=se,this.negate=G,this.test=te}},he=class extends x{constructor(se,G){super();ee(this,"type","UnaryExpression");this.operator=se,this.argument=G}},B=class extends x{constructor(se=void 0,G=void 0,te=void 0){super();ee(this,"type","SliceExpression");this.start=se,this.stop=G,this.step=te}},D=class extends x{constructor(se,G){super();ee(this,"type","KeywordArgumentExpression");this.key=se,this.value=G}};function K(L){let se=new f([]),G=0;function te(Ae,Ze){let rt=L[G++];if(!rt||rt.type!==Ae)throw new Error(`Parser Error: ${Ze}. ${rt.type} !== ${Ae}.`);return rt}function Me(){switch(L[G].type){case s.Text:return Dt();case s.OpenStatement:return Xt();case s.OpenExpression:return ht();default:throw new SyntaxError(`Unexpected token type: ${L[G].type}`)}}function je(...Ae){return G+Ae.length<=L.length&&Ae.some((Ze,rt)=>Ze!==L[G+rt].type)}function Se(...Ae){return G+Ae.length<=L.length&&Ae.every((Ze,rt)=>Ze===L[G+rt].type)}function Dt(){return new A(te(s.Text,"Expected text token").value)}function Xt(){te(s.OpenStatement,"Expected opening statement token");let Ae;switch(L[G].type){case s.Set:++G,Ae=Ot(),te(s.CloseStatement,"Expected closing statement token");break;case s.If:++G,Ae=Ye(),te(s.OpenStatement,"Expected {% token"),te(s.EndIf,"Expected endif token"),te(s.CloseStatement,"Expected %} token");break;case s.Macro:++G,Ae=vt(),te(s.OpenStatement,"Expected {% token"),te(s.EndMacro,"Expected endmacro token"),te(s.CloseStatement,"Expected %} token");break;case s.For:++G,Ae=zt(),te(s.OpenStatement,"Expected {% token"),te(s.EndFor,"Expected endfor token"),te(s.CloseStatement,"Expected %} token");break;case s.Break:++G,te(s.CloseStatement,"Expected closing statement token"),Ae=new E;break;case s.Continue:++G,te(s.CloseStatement,"Expected closing statement token"),Ae=new M;break;default:throw new SyntaxError(`Unknown statement type: ${L[G].type}`)}return Ae}function ht(){te(s.OpenExpression,"Expected opening expression token");let Ae=It();return te(s.CloseExpression,"Expected closing expression token"),Ae}function Ot(){var Ze,rt;let Ae=It();if(Se(s.Equals)){++G;let or=It();return new w(Ae,or,[])}else{let or=[];for(te(s.CloseStatement,"Expected %} token");!(((Ze=L[G])==null?void 0:Ze.type)===s.OpenStatement&&((rt=L[G+1])==null?void 0:rt.type)===s.EndSet);){let ps=Me();or.push(ps)}return te(s.OpenStatement,"Expected {% token"),te(s.EndSet,"Expected endset token"),new w(Ae,null,or)}}function Ye(){var or,ps,Ur,ts,ms,Or,hs,fr;let Ae=It();te(s.CloseStatement,"Expected closing statement token");let Ze=[],rt=[];for(;!(((or=L[G])==null?void 0:or.type)===s.OpenStatement&&(((ps=L[G+1])==null?void 0:ps.type)===s.ElseIf||((Ur=L[G+1])==null?void 0:Ur.type)===s.Else||((ts=L[G+1])==null?void 0:ts.type)===s.EndIf));)Ze.push(Me());if(((ms=L[G])==null?void 0:ms.type)===s.OpenStatement&&((Or=L[G+1])==null?void 0:Or.type)!==s.EndIf)if(++G,Se(s.ElseIf))te(s.ElseIf,"Expected elseif token"),rt.push(Ye());else for(te(s.Else,"Expected else token"),te(s.CloseStatement,"Expected closing statement token");!(((hs=L[G])==null?void 0:hs.type)===s.OpenStatement&&((fr=L[G+1])==null?void 0:fr.type)===s.EndIf);)rt.push(Me());return new h(Ae,Ze,rt)}function vt(){let Ae=qr();if(Ae.type!=="Identifier")throw new SyntaxError("Expected identifier following macro statement");let Ze=vs();te(s.CloseStatement,"Expected closing statement token");let rt=[];for(;je(s.OpenStatement,s.EndMacro);)rt.push(Me());return new C(Ae,Ze,rt)}function yt(Ae=!1){let Ze=Ae?qr:It,rt=[Ze()],or=Se(s.Comma);for(;or&&(++G,rt.push(Ze()),!!Se(s.Comma)););return or?new J(rt):rt[0]}function zt(){let Ae=yt(!0);if(!(Ae instanceof g||Ae instanceof J))throw new SyntaxError(`Expected identifier/tuple for the loop variable, got ${Ae.type} instead`);te(s.In,"Expected `in` keyword following loop variable");let Ze=It();te(s.CloseStatement,"Expected closing statement token");let rt=[];for(;je(s.OpenStatement,s.EndFor)&&je(s.OpenStatement,s.Else);)rt.push(Me());let or=[];if(Se(s.OpenStatement,s.Else))for(++G,++G,te(s.CloseStatement,"Expected closing statement token");je(s.OpenStatement,s.EndFor);)or.push(Me());return new v(Ae,Ze,rt,or)}function It(){return er()}function er(){let Ae=br();if(Se(s.If)){++G;let Ze=br();if(Se(s.Else)){++G;let rt=br();return new h(Ze,[Ae],[rt])}else return new ae(Ae,Ze)}return Ae}function br(){let Ae=hr();for(;Se(s.Or);){let Ze=L[G];++G;let rt=hr();Ae=new q(Ze,Ae,rt)}return Ae}function hr(){let Ae=Ir();for(;Se(s.And);){let Ze=L[G];++G;let rt=Ir();Ae=new q(Ze,Ae,rt)}return Ae}function Ir(){let Ae;for(;Se(s.Not);){let Ze=L[G];++G;let rt=Ir();Ae=new he(Ze,rt)}return Ae!=null?Ae:tr()}function tr(){let Ae=kr();for(;Se(s.ComparisonBinaryOperator)||Se(s.In)||Se(s.NotIn);){let Ze=L[G];++G;let rt=kr();Ae=new q(Ze,Ae,rt)}return Ae}function kr(){let Ae=Wr();for(;Se(s.AdditiveBinaryOperator);){let Ze=L[G];++G;let rt=Wr();Ae=new q(Ze,Ae,rt)}return Ae}function jr(){let Ae=Vr(qr());return Se(s.OpenParen)?Yr(Ae):Ae}function Yr(Ae){let Ze=new S(Ae,vs());return Ze=Vr(Ze),Se(s.OpenParen)&&(Ze=Yr(Ze)),Ze}function vs(){te(s.OpenParen,"Expected opening parenthesis for arguments list");let Ae=Ds();return te(s.CloseParen,"Expected closing parenthesis for arguments list"),Ae}function Ds(){let Ae=[];for(;!Se(s.CloseParen);){let Ze=It();if(Se(s.Equals)){if(++G,!(Ze instanceof g))throw new SyntaxError("Expected identifier for keyword argument");let rt=It();Ze=new D(Ze,rt)}Ae.push(Ze),Se(s.Comma)&&++G}return Ae}function Os(){let Ae=[],Ze=!1;for(;!Se(s.CloseSquareBracket);)Se(s.Colon)?(Ae.push(void 0),++G,Ze=!0):(Ae.push(It()),Se(s.Colon)&&(++G,Ze=!0));if(Ae.length===0)throw new SyntaxError("Expected at least one argument for member/slice expression");if(Ze){if(Ae.length>3)throw new SyntaxError("Expected 0-3 arguments for slice expression");return new B(...Ae)}return Ae[0]}function Vr(Ae){for(;Se(s.Dot)||Se(s.OpenSquareBracket);){let Ze=L[G];++G;let rt,or=Ze.type!==s.Dot;if(or)rt=Os(),te(s.CloseSquareBracket,"Expected closing square bracket");else if(rt=qr(),rt.type!=="Identifier")throw new SyntaxError("Expected identifier following dot operator");Ae=new T(Ae,rt,or)}return Ae}function Wr(){let Ae=Ls();for(;Se(s.MultiplicativeBinaryOperator);){let Ze=L[G];++G;let rt=Ls();Ae=new q(Ze,Ae,rt)}return Ae}function Ls(){let Ae=Dr();for(;Se(s.Is);){++G;let Ze=Se(s.Not);Ze&&++G;let rt=qr();if(rt instanceof N?rt=new g(rt.value.toString()):rt instanceof W&&(rt=new g("none")),!(rt instanceof g))throw new SyntaxError("Expected identifier for the test");Ae=new ce(Ae,Ze,rt)}return Ae}function Dr(){let Ae=jr();for(;Se(s.Pipe);){++G;let Ze=qr();if(!(Ze instanceof g))throw new SyntaxError("Expected identifier for the filter");Se(s.OpenParen)&&(Ze=Yr(Ze)),Ae=new X(Ae,Ze)}return Ae}function qr(){let Ae=L[G];switch(Ae.type){case s.NumericLiteral:return++G,new $(Number(Ae.value));case s.StringLiteral:return++G,new A(Ae.value);case s.BooleanLiteral:return++G,new N(Ae.value.toLowerCase()==="true");case s.NullLiteral:return++G,new W(null);case s.Identifier:return++G,new g(Ae.value);case s.OpenParen:{++G;let Ze=yt();if(L[G].type!==s.CloseParen)throw new SyntaxError(`Expected closing parenthesis, got ${L[G].type} instead`);return++G,Ze}case s.OpenSquareBracket:{++G;let Ze=[];for(;!Se(s.CloseSquareBracket);)Ze.push(It()),Se(s.Comma)&&++G;return++G,new R(Ze)}case s.OpenCurlyBracket:{++G;let Ze=new Map;for(;!Se(s.CloseCurlyBracket);){let rt=It();te(s.Colon,"Expected colon between key and value in object literal");let or=It();Ze.set(rt,or),Se(s.Comma)&&++G}return++G,new H(Ze)}default:throw new SyntaxError(`Unexpected token: ${Ae.type}`)}}for(;G<L.length;)se.body.push(Me());return se}function re(L,se,G=1){se===void 0&&(se=L,L=0);let te=[];for(let Me=L;Me<se;Me+=G)te.push(Me);return te}function me(L,se,G,te=1){let Me=Math.sign(te);Me>=0?(se=(se!=null?se:se=0)<0?Math.max(L.length+se,0):Math.min(se,L.length),G=(G!=null?G:G=L.length)<0?Math.max(L.length+G,0):Math.min(G,L.length)):(se=(se!=null?se:se=L.length-1)<0?Math.max(L.length+se,-1):Math.min(se,L.length-1),G=(G!=null?G:G=-1)<-1?Math.max(L.length+G,-1):Math.min(G,L.length-1));let je=[];for(let Se=se;Me*Se<Me*G;Se+=te)je.push(L[Se]);return je}function oe(L){return L.replace(/\\b\\w/g,se=>se.toUpperCase())}var ge=class extends Error{},ze=class extends Error{},We=class{constructor(L=void 0){ee(this,"type","RuntimeValue");ee(this,"value");ee(this,"builtins",new Map);this.value=L}__bool__(){return new Y(!!this.value)}},Ce=class extends We{constructor(){super(...arguments);ee(this,"type","NumericValue")}},ie=class extends We{constructor(){super(...arguments);ee(this,"type","StringValue");ee(this,"builtins",new Map([["upper",new xe(()=>new ie(this.value.toUpperCase()))],["lower",new xe(()=>new ie(this.value.toLowerCase()))],["strip",new xe(()=>new ie(this.value.trim()))],["title",new xe(()=>new ie(oe(this.value)))],["length",new Ce(this.value.length)],["rstrip",new xe(()=>new ie(this.value.trimEnd()))],["lstrip",new xe(()=>new ie(this.value.trimStart()))],["startswith",new xe(se=>{if(se.length===0)throw new Error("startswith() requires at least one argument");let G=se[0];if(!(G instanceof ie))throw new Error("startswith() argument must be a string");return new Y(this.value.startsWith(G.value))})],["endswith",new xe(se=>{if(se.length===0)throw new Error("endswith() requires at least one argument");let G=se[0];if(!(G instanceof ie))throw new Error("endswith() argument must be a string");return new Y(this.value.endsWith(G.value))})],["split",new xe(se=>{var je,Se;let G=(je=se[0])!=null?je:new ke;if(!(G instanceof ie||G instanceof ke))throw new Error("sep argument must be a string or null");let te=(Se=se[1])!=null?Se:new Ce(-1);if(!(te instanceof Ce))throw new Error("maxsplit argument must be a number");let Me=[];if(G instanceof ke){let Dt=this.value.trimStart();for(let{0:Xt,index:ht}of Dt.matchAll(/\\S+/g)){if(te.value!==-1&&Me.length>=te.value&&ht!==void 0){Me.push(Xt+Dt.slice(ht+Xt.length));break}Me.push(Xt)}}else{if(G.value==="")throw new Error("empty separator");Me=this.value.split(G.value),te.value!==-1&&Me.length>te.value&&Me.push(Me.splice(te.value).join(G.value))}return new ve(Me.map(Dt=>new ie(Dt)))})]]))}},Y=class extends We{constructor(){super(...arguments);ee(this,"type","BooleanValue")}},j=class extends We{constructor(){super(...arguments);ee(this,"type","ObjectValue");ee(this,"builtins",new Map([["get",new xe(([se,G])=>{var te,Me;if(!(se instanceof ie))throw new Error(`Object key must be a string: got ${se.type}`);return(Me=(te=this.value.get(se.value))!=null?te:G)!=null?Me:new ke})],["items",new xe(()=>new ve(Array.from(this.value.entries()).map(([se,G])=>new ve([new ie(se),G]))))]]))}__bool__(){return new Y(this.value.size>0)}},fe=class extends j{constructor(){super(...arguments);ee(this,"type","KeywordArgumentsValue")}},ve=class extends We{constructor(){super(...arguments);ee(this,"type","ArrayValue");ee(this,"builtins",new Map([["length",new Ce(this.value.length)]]))}__bool__(){return new Y(this.value.length>0)}},Ie=class extends ve{constructor(){super(...arguments);ee(this,"type","TupleValue")}},xe=class extends We{constructor(){super(...arguments);ee(this,"type","FunctionValue")}},ke=class extends We{constructor(){super(...arguments);ee(this,"type","NullValue")}},Pe=class extends We{constructor(){super(...arguments);ee(this,"type","UndefinedValue")}},He=class{constructor(L){ee(this,"variables",new Map([["namespace",new xe(L=>{if(L.length===0)return new j(new Map);if(L.length!==1||!(L[0]instanceof j))throw new Error("`namespace` expects either zero arguments or a single object argument");return L[0]})]]));ee(this,"tests",new Map([["boolean",L=>L.type==="BooleanValue"],["callable",L=>L instanceof xe],["odd",L=>{if(L.type!=="NumericValue")throw new Error(`Cannot apply test "odd" to type: ${L.type}`);return L.value%2!==0}],["even",L=>{if(L.type!=="NumericValue")throw new Error(`Cannot apply test "even" to type: ${L.type}`);return L.value%2===0}],["false",L=>L.type==="BooleanValue"&&!L.value],["true",L=>L.type==="BooleanValue"&&L.value],["none",L=>L.type==="NullValue"],["string",L=>L.type==="StringValue"],["number",L=>L.type==="NumericValue"],["integer",L=>L.type==="NumericValue"&&Number.isInteger(L.value)],["iterable",L=>L.type==="ArrayValue"||L.type==="StringValue"],["mapping",L=>L.type==="ObjectValue"],["lower",L=>{let se=L.value;return L.type==="StringValue"&&se===se.toLowerCase()}],["upper",L=>{let se=L.value;return L.type==="StringValue"&&se===se.toUpperCase()}],["none",L=>L.type==="NullValue"],["defined",L=>L.type!=="UndefinedValue"],["undefined",L=>L.type==="UndefinedValue"],["equalto",(L,se)=>L.value===se.value],["eq",(L,se)=>L.value===se.value]]));this.parent=L}set(L,se){return this.declareVariable(L,qe(se))}declareVariable(L,se){if(this.variables.has(L))throw new SyntaxError(`Variable already declared: ${L}`);return this.variables.set(L,se),se}setVariable(L,se){return this.variables.set(L,se),se}resolve(L){if(this.variables.has(L))return this;if(this.parent)return this.parent.resolve(L);throw new Error(`Unknown variable: ${L}`)}lookupVariable(L){var se;try{return(se=this.resolve(L).variables.get(L))!=null?se:new Pe}catch(G){return new Pe}}},Ue=class{constructor(L){ee(this,"global");this.global=L!=null?L:new He}run(L){return this.evaluate(L,this.global)}evaluateBinaryExpression(L,se){let G=this.evaluate(L.left,se);switch(L.operator.value){case"and":return G.__bool__().value?this.evaluate(L.right,se):G;case"or":return G.__bool__().value?G:this.evaluate(L.right,se)}let te=this.evaluate(L.right,se);switch(L.operator.value){case"==":return new Y(G.value==te.value);case"!=":return new Y(G.value!=te.value)}if(G instanceof Pe||te instanceof Pe)throw new Error("Cannot perform operation on undefined values");if(G instanceof ke||te instanceof ke)throw new Error("Cannot perform operation on null values");if(G instanceof Ce&&te instanceof Ce)switch(L.operator.value){case"+":return new Ce(G.value+te.value);case"-":return new Ce(G.value-te.value);case"*":return new Ce(G.value*te.value);case"/":return new Ce(G.value/te.value);case"%":return new Ce(G.value%te.value);case"<":return new Y(G.value<te.value);case">":return new Y(G.value>te.value);case">=":return new Y(G.value>=te.value);case"<=":return new Y(G.value<=te.value)}else if(G instanceof ve&&te instanceof ve)switch(L.operator.value){case"+":return new ve(G.value.concat(te.value))}else if(te instanceof ve){let Me=te.value.find(je=>je.value===G.value)!==void 0;switch(L.operator.value){case"in":return new Y(Me);case"not in":return new Y(!Me)}}if(G instanceof ie||te instanceof ie)switch(L.operator.value){case"+":return new ie(G.value.toString()+te.value.toString())}if(G instanceof ie&&te instanceof ie)switch(L.operator.value){case"in":return new Y(te.value.includes(G.value));case"not in":return new Y(!te.value.includes(G.value))}if(G instanceof ie&&te instanceof j)switch(L.operator.value){case"in":return new Y(te.value.has(G.value));case"not in":return new Y(!te.value.has(G.value))}throw new SyntaxError(`Unknown operator "${L.operator.value}" between ${G.type} and ${te.type}`)}evaluateArguments(L,se){let G=[],te=new Map;for(let Me of L)if(Me.type==="KeywordArgumentExpression"){let je=Me;te.set(je.key.value,this.evaluate(je.value,se))}else{if(te.size>0)throw new Error("Positional arguments must come before keyword arguments");G.push(this.evaluate(Me,se))}return[G,te]}evaluateFilterExpression(L,se){var te,Me,je,Se,Dt,Xt,ht,Ot,Ye;let G=this.evaluate(L.operand,se);if(L.filter.type==="Identifier"){let vt=L.filter;if(vt.value==="tojson")return new ie(Ke(G));if(G instanceof ve)switch(vt.value){case"list":return G;case"first":return G.value[0];case"last":return G.value[G.value.length-1];case"length":return new Ce(G.value.length);case"reverse":return new ve(G.value.reverse());case"sort":return new ve(G.value.sort((yt,zt)=>{if(yt.type!==zt.type)throw new Error(`Cannot compare different types: ${yt.type} and ${zt.type}`);switch(yt.type){case"NumericValue":return yt.value-zt.value;case"StringValue":return yt.value.localeCompare(zt.value);default:throw new Error(`Cannot compare type: ${yt.type}`)}}));case"join":return new ie(G.value.map(yt=>yt.value).join(""));case"string":return new ie(Ke(G));default:throw new Error(`Unknown ArrayValue filter: ${vt.value}`)}else if(G instanceof ie)switch(vt.value){case"length":return new Ce(G.value.length);case"upper":return new ie(G.value.toUpperCase());case"lower":return new ie(G.value.toLowerCase());case"title":return new ie(oe(G.value));case"capitalize":return new ie(G.value.charAt(0).toUpperCase()+G.value.slice(1));case"trim":return new ie(G.value.trim());case"indent":return new ie(G.value.split(`\n`).map((yt,zt)=>zt===0||yt.length===0?yt:"    "+yt).join(`\n`));case"join":case"string":return G;default:throw new Error(`Unknown StringValue filter: ${vt.value}`)}else if(G instanceof Ce)switch(vt.value){case"abs":return new Ce(Math.abs(G.value));default:throw new Error(`Unknown NumericValue filter: ${vt.value}`)}else if(G instanceof j)switch(vt.value){case"items":return new ve(Array.from(G.value.entries()).map(([yt,zt])=>new ve([new ie(yt),zt])));case"length":return new Ce(G.value.size);default:throw new Error(`Unknown ObjectValue filter: ${vt.value}`)}throw new Error(`Cannot apply filter "${vt.value}" to type: ${G.type}`)}else if(L.filter.type==="CallExpression"){let vt=L.filter;if(vt.callee.type!=="Identifier")throw new Error(`Unknown filter: ${vt.callee.type}`);let yt=vt.callee.value;if(yt==="tojson"){let[,zt]=this.evaluateArguments(vt.args,se),It=(te=zt.get("indent"))!=null?te:new ke;if(!(It instanceof Ce||It instanceof ke))throw new Error("If set, indent must be a number");return new ie(Ke(G,It.value))}else if(yt==="join"){let zt;if(G instanceof ie)zt=Array.from(G.value);else if(G instanceof ve)zt=G.value.map(hr=>hr.value);else throw new Error(`Cannot apply filter "${yt}" to type: ${G.type}`);let[It,er]=this.evaluateArguments(vt.args,se),br=(je=(Me=It.at(0))!=null?Me:er.get("separator"))!=null?je:new ie("");if(!(br instanceof ie))throw new Error("separator must be a string");return new ie(zt.join(br.value))}if(G instanceof ve){switch(yt){case"selectattr":case"rejectattr":{let zt=yt==="selectattr";if(G.value.some(tr=>!(tr instanceof j)))throw new Error(`\\`${yt}\\` can only be applied to array of objects`);if(vt.args.some(tr=>tr.type!=="StringLiteral"))throw new Error(`arguments of \\`${yt}\\` must be strings`);let[It,er,br]=vt.args.map(tr=>this.evaluate(tr,se)),hr;if(er){let tr=se.tests.get(er.value);if(!tr)throw new Error(`Unknown test: ${er.value}`);hr=tr}else hr=(...tr)=>tr[0].__bool__().value;let Ir=G.value.filter(tr=>{let kr=tr.value.get(It.value),jr=kr?hr(kr,br):!1;return zt?jr:!jr});return new ve(Ir)}case"map":{let[,zt]=this.evaluateArguments(vt.args,se);if(zt.has("attribute")){let It=zt.get("attribute");if(!(It instanceof ie))throw new Error("attribute must be a string");let er=zt.get("default"),br=G.value.map(hr=>{var Ir,tr;if(!(hr instanceof j))throw new Error("items in map must be an object");return(tr=(Ir=hr.value.get(It.value))!=null?Ir:er)!=null?tr:new Pe});return new ve(br)}else throw new Error("`map` expressions without `attribute` set are not currently supported.")}}throw new Error(`Unknown ArrayValue filter: ${yt}`)}else if(G instanceof ie){switch(yt){case"indent":{let[zt,It]=this.evaluateArguments(vt.args,se),er=(Dt=(Se=zt.at(0))!=null?Se:It.get("width"))!=null?Dt:new Ce(4);if(!(er instanceof Ce))throw new Error("width must be a number");let br=(ht=(Xt=zt.at(1))!=null?Xt:It.get("first"))!=null?ht:new Y(!1),hr=(Ye=(Ot=zt.at(2))!=null?Ot:It.get("blank"))!=null?Ye:new Y(!1),Ir=G.value.split(`\n`),tr=" ".repeat(er.value),kr=Ir.map((jr,Yr)=>!br.value&&Yr===0||!hr.value&&jr.length===0?jr:tr+jr);return new ie(kr.join(`\n`))}}throw new Error(`Unknown StringValue filter: ${yt}`)}else throw new Error(`Cannot apply filter "${yt}" to type: ${G.type}`)}throw new Error(`Unknown filter: ${L.filter.type}`)}evaluateTestExpression(L,se){let G=this.evaluate(L.operand,se),te=se.tests.get(L.test.value);if(!te)throw new Error(`Unknown test: ${L.test.value}`);let Me=te(G);return new Y(L.negate?!Me:Me)}evaluateUnaryExpression(L,se){let G=this.evaluate(L.argument,se);switch(L.operator.value){case"not":return new Y(!G.value);default:throw new SyntaxError(`Unknown operator: ${L.operator.value}`)}}evalProgram(L,se){return this.evaluateBlock(L.body,se)}evaluateBlock(L,se){let G="";for(let te of L){let Me=this.evaluate(te,se);Me.type!=="NullValue"&&Me.type!=="UndefinedValue"&&(G+=Me.value)}return new ie(G)}evaluateIdentifier(L,se){return se.lookupVariable(L.value)}evaluateCallExpression(L,se){let[G,te]=this.evaluateArguments(L.args,se);te.size>0&&G.push(new fe(te));let Me=this.evaluate(L.callee,se);if(Me.type!=="FunctionValue")throw new Error(`Cannot call something that is not a function: got ${Me.type}`);return Me.value(G,se)}evaluateSliceExpression(L,se,G){if(!(L instanceof ve||L instanceof ie))throw new Error("Slice object must be an array or string");let te=this.evaluate(se.start,G),Me=this.evaluate(se.stop,G),je=this.evaluate(se.step,G);if(!(te instanceof Ce||te instanceof Pe))throw new Error("Slice start must be numeric or undefined");if(!(Me instanceof Ce||Me instanceof Pe))throw new Error("Slice stop must be numeric or undefined");if(!(je instanceof Ce||je instanceof Pe))throw new Error("Slice step must be numeric or undefined");return L instanceof ve?new ve(me(L.value,te.value,Me.value,je.value)):new ie(me(Array.from(L.value),te.value,Me.value,je.value).join(""))}evaluateMemberExpression(L,se){var je;let G=this.evaluate(L.object,se),te;if(L.computed){if(L.property.type==="SliceExpression")return this.evaluateSliceExpression(G,L.property,se);te=this.evaluate(L.property,se)}else te=new ie(L.property.value);let Me;if(G instanceof j){if(!(te instanceof ie))throw new Error(`Cannot access property with non-string: got ${te.type}`);Me=(je=G.value.get(te.value))!=null?je:G.builtins.get(te.value)}else if(G instanceof ve||G instanceof ie)if(te instanceof Ce)Me=G.value.at(te.value),G instanceof ie&&(Me=new ie(G.value.at(te.value)));else if(te instanceof ie)Me=G.builtins.get(te.value);else throw new Error(`Cannot access property with non-string/non-number: got ${te.type}`);else{if(!(te instanceof ie))throw new Error(`Cannot access property with non-string: got ${te.type}`);Me=G.builtins.get(te.value)}return Me instanceof We?Me:new Pe}evaluateSet(L,se){let G=L.value?this.evaluate(L.value,se):this.evaluateBlock(L.body,se);if(L.assignee.type==="Identifier"){let te=L.assignee.value;se.setVariable(te,G)}else if(L.assignee.type==="MemberExpression"){let te=L.assignee,Me=this.evaluate(te.object,se);if(!(Me instanceof j))throw new Error("Cannot assign to member of non-object");if(te.property.type!=="Identifier")throw new Error("Cannot assign to member with non-identifier property");Me.value.set(te.property.value,G)}else throw new Error(`Invalid LHS inside assignment expression: ${JSON.stringify(L.assignee)}`);return new ke}evaluateIf(L,se){let G=this.evaluate(L.test,se);return this.evaluateBlock(G.__bool__().value?L.body:L.alternate,se)}evaluateFor(L,se){let G=new He(se),te,Me;if(L.iterable.type==="SelectExpression"){let ht=L.iterable;Me=this.evaluate(ht.iterable,G),te=ht.test}else Me=this.evaluate(L.iterable,G);if(!(Me instanceof ve))throw new Error(`Expected iterable type in for loop: got ${Me.type}`);let je=[],Se=[];for(let ht=0;ht<Me.value.length;++ht){let Ot=new He(G),Ye=Me.value[ht],vt;if(L.loopvar.type==="Identifier")vt=yt=>yt.setVariable(L.loopvar.value,Ye);else if(L.loopvar.type==="TupleLiteral"){let yt=L.loopvar;if(Ye.type!=="ArrayValue")throw new Error(`Cannot unpack non-iterable type: ${Ye.type}`);let zt=Ye;if(yt.value.length!==zt.value.length)throw new Error(`Too ${yt.value.length>zt.value.length?"few":"many"} items to unpack`);vt=It=>{for(let er=0;er<yt.value.length;++er){if(yt.value[er].type!=="Identifier")throw new Error(`Cannot unpack non-identifier type: ${yt.value[er].type}`);It.setVariable(yt.value[er].value,zt.value[er])}}}else throw new Error(`Invalid loop variable(s): ${L.loopvar.type}`);te&&(vt(Ot),!this.evaluate(te,Ot).__bool__().value)||(je.push(Ye),Se.push(vt))}let Dt="",Xt=!0;for(let ht=0;ht<je.length;++ht){let Ot=new Map([["index",new Ce(ht+1)],["index0",new Ce(ht)],["revindex",new Ce(je.length-ht)],["revindex0",new Ce(je.length-ht-1)],["first",new Y(ht===0)],["last",new Y(ht===je.length-1)],["length",new Ce(je.length)],["previtem",ht>0?je[ht-1]:new Pe],["nextitem",ht<je.length-1?je[ht+1]:new Pe]]);G.setVariable("loop",new j(Ot)),Se[ht](G);try{let Ye=this.evaluateBlock(L.body,G);Dt+=Ye.value}catch(Ye){if(Ye instanceof ze)continue;if(Ye instanceof ge)break;throw Ye}Xt=!1}if(Xt){let ht=this.evaluateBlock(L.defaultBlock,G);Dt+=ht.value}return new ie(Dt)}evaluateMacro(L,se){return se.setVariable(L.name.value,new xe((G,te)=>{var Se,Dt;let Me=new He(te);G=G.slice();let je;((Se=G.at(-1))==null?void 0:Se.type)==="KeywordArgumentsValue"&&(je=G.pop());for(let Xt=0;Xt<L.args.length;++Xt){let ht=L.args[Xt],Ot=G[Xt];if(ht.type==="Identifier"){let Ye=ht;if(!Ot)throw new Error(`Missing positional argument: ${Ye.value}`);Me.setVariable(Ye.value,Ot)}else if(ht.type==="KeywordArgumentExpression"){let Ye=ht,vt=(Dt=Ot!=null?Ot:je==null?void 0:je.value.get(Ye.key.value))!=null?Dt:this.evaluate(Ye.value,Me);Me.setVariable(Ye.key.value,vt)}else throw new Error(`Unknown argument type: ${ht.type}`)}return this.evaluateBlock(L.body,Me)})),new ke}evaluate(L,se){if(L===void 0)return new Pe;switch(L.type){case"Program":return this.evalProgram(L,se);case"Set":return this.evaluateSet(L,se);case"If":return this.evaluateIf(L,se);case"For":return this.evaluateFor(L,se);case"Macro":return this.evaluateMacro(L,se);case"Break":throw new ge;case"Continue":throw new ze;case"NumericLiteral":return new Ce(Number(L.value));case"StringLiteral":return new ie(L.value);case"BooleanLiteral":return new Y(L.value);case"NullLiteral":return new ke(L.value);case"ArrayLiteral":return new ve(L.value.map(G=>this.evaluate(G,se)));case"TupleLiteral":return new Ie(L.value.map(G=>this.evaluate(G,se)));case"ObjectLiteral":{let G=new Map;for(let[te,Me]of L.value){let je=this.evaluate(te,se);if(!(je instanceof ie))throw new Error(`Object keys must be strings: got ${je.type}`);G.set(je.value,this.evaluate(Me,se))}return new j(G)}case"Identifier":return this.evaluateIdentifier(L,se);case"CallExpression":return this.evaluateCallExpression(L,se);case"MemberExpression":return this.evaluateMemberExpression(L,se);case"UnaryExpression":return this.evaluateUnaryExpression(L,se);case"BinaryExpression":return this.evaluateBinaryExpression(L,se);case"FilterExpression":return this.evaluateFilterExpression(L,se);case"TestExpression":return this.evaluateTestExpression(L,se);default:throw new SyntaxError(`Unknown node type: ${L.type}`)}}};function qe(L){switch(typeof L){case"number":return new Ce(L);case"string":return new ie(L);case"boolean":return new Y(L);case"undefined":return new Pe;case"object":return L===null?new ke:Array.isArray(L)?new ve(L.map(qe)):new j(new Map(Object.entries(L).map(([se,G])=>[se,qe(G)])));case"function":return new xe((se,G)=>{var Me;let te=(Me=L(...se.map(je=>je.value)))!=null?Me:null;return qe(te)});default:throw new Error(`Cannot convert to runtime value: ${L}`)}}function Ke(L,se,G){let te=G!=null?G:0;switch(L.type){case"NullValue":case"UndefinedValue":return"null";case"NumericValue":case"StringValue":case"BooleanValue":return JSON.stringify(L.value);case"ArrayValue":case"ObjectValue":{let Me=se?" ".repeat(se):"",je=`\n`+Me.repeat(te),Se=je+Me;if(L.type==="ArrayValue"){let Dt=L.value.map(Xt=>Ke(Xt,se,te+1));return se?`[${Se}${Dt.join(`,${Se}`)}${je}]`:`[${Dt.join(", ")}]`}else{let Dt=Array.from(L.value.entries()).map(([Xt,ht])=>{let Ot=`"${Xt}": ${Ke(ht,se,te+1)}`;return se?`${Se}${Ot}`:Ot});return se?`{${Dt.join(",")}${je}}`:`{${Dt.join(", ")}}`}}default:throw new Error(`Cannot convert to JSON: ${L.type}`)}}var Re=`\n`,tt="{%- ",Qe=" -%}",at={MultiplicativeBinaryOperator:2,AdditiveBinaryOperator:1,ComparisonBinaryOperator:0};function it(L,se="	"){let G=typeof se=="number"?" ".repeat(se):se;return et(L.body,0,G).replace(/\\n$/,"")}function Ne(...L){return tt+L.join(" ")+Qe}function et(L,se,G){return L.map(te=>_t(te,se,G)).join(Re)}function _t(L,se,G){let te=G.repeat(se);switch(L.type){case"Program":return et(L.body,se,G);case"If":return Et(L,se,G);case"For":return At(L,se,G);case"Set":return Bt(L,se,G);case"Macro":return ar(L,se,G);case"Break":return te+Ne("break");case"Continue":return te+Ne("continue");default:return te+"{{- "+ft(L)+" -}}"}}function Et(L,se,G){let te=G.repeat(se),Me=[],je=L;for(;je&&(Me.push({test:je.test,body:je.body}),je.alternate.length===1&&je.alternate[0].type==="If");)je=je.alternate[0];let Se=te+Ne("if",ft(Me[0].test))+Re+et(Me[0].body,se+1,G);for(let Dt=1;Dt<Me.length;Dt++)Se+=Re+te+Ne("elif",ft(Me[Dt].test))+Re+et(Me[Dt].body,se+1,G);return je&&je.alternate.length>0&&(Se+=Re+te+Ne("else")+Re+et(je.alternate,se+1,G)),Se+=Re+te+Ne("endif"),Se}function At(L,se,G){let te=G.repeat(se),Me="";if(L.iterable.type==="SelectExpression"){let Se=L.iterable;Me=`${ft(Se.iterable)} if ${ft(Se.test)}`}else Me=ft(L.iterable);let je=te+Ne("for",ft(L.loopvar),"in",Me)+Re+et(L.body,se+1,G);return L.defaultBlock.length>0&&(je+=Re+te+Ne("else")+Re+et(L.defaultBlock,se+1,G)),je+=Re+te+Ne("endfor"),je}function Bt(L,se,G){let te=G.repeat(se),Me=ft(L.assignee),je=L.value?ft(L.value):"",Se=te+Ne("set",`${Me}${L.value?" = "+je:""}`);return L.body.length===0?Se:Se+Re+et(L.body,se+1,G)+Re+te+Ne("endset")}function ar(L,se,G){let te=G.repeat(se),Me=L.args.map(ft).join(", ");return te+Ne("macro",`${L.name.value}(${Me})`)+Re+et(L.body,se+1,G)+Re+te+Ne("endmacro")}function ft(L,se=-1){var G;switch(L.type){case"Identifier":return L.value;case"NullLiteral":return"none";case"NumericLiteral":case"BooleanLiteral":return`${L.value}`;case"StringLiteral":return JSON.stringify(L.value);case"BinaryExpression":{let te=L,Me=(G=at[te.operator.type])!=null?G:0,je=ft(te.left,Me),Se=ft(te.right,Me+1),Dt=`${je} ${te.operator.value} ${Se}`;return Me<se?`(${Dt})`:Dt}case"UnaryExpression":{let te=L;return te.operator.value+(te.operator.value==="not"?" ":"")+ft(te.argument,1/0)}case"LogicalNegationExpression":return`not ${ft(L.argument,1/0)}`;case"CallExpression":{let te=L,Me=te.args.map(je=>ft(je,-1)).join(", ");return`${ft(te.callee,-1)}(${Me})`}case"MemberExpression":{let te=L,Me=ft(te.object,-1);te.object.type!=="Identifier"&&(Me=`(${Me})`);let je=ft(te.property,-1);return!te.computed&&te.property.type!=="Identifier"&&(je=`(${je})`),te.computed?`${Me}[${je}]`:`${Me}.${je}`}case"FilterExpression":{let te=L,Me=ft(te.operand,1/0);return te.filter.type==="CallExpression"?`${Me} | ${ft(te.filter,-1)}`:`${Me} | ${te.filter.value}`}case"SelectExpression":{let te=L;return`${ft(te.iterable,-1)} | select(${ft(te.test,-1)})`}case"TestExpression":{let te=L;return`${ft(te.operand,-1)} is${te.negate?" not":""} ${te.test.value}`}case"ArrayLiteral":case"TupleLiteral":{let te=L.value.map(je=>ft(je,-1)),Me=L.type==="ArrayLiteral"?"[]":"()";return`${Me[0]}${te.join(", ")}${Me[1]}`}case"ObjectLiteral":return`{ ${Array.from(L.value.entries()).map(([Me,je])=>`${ft(Me,-1)}: ${ft(je,-1)}`).join(", ")} }`;case"SliceExpression":{let te=L,Me=te.start?ft(te.start,-1):"",je=te.stop?ft(te.stop,-1):"",Se=te.step?`:${ft(te.step,-1)}`:"";return`${Me}:${je}${Se}`}case"KeywordArgumentExpression":{let te=L;return`${te.key.value}=${ft(te.value,-1)}`}case"If":{let te=L,Me=ft(te.test,-1),je=ft(te.body[0],0),Se=ft(te.alternate[0],-1);return`${je} if ${Me} else ${Se}`}default:throw new Error(`Unknown expression type: ${L.type}`)}}var Jr=class{constructor(L){ee(this,"parsed");let se=d(L,{lstrip_blocks:!0,trim_blocks:!0});this.parsed=K(se)}render(L){let se=new He;if(se.set("false",!1),se.set("true",!0),se.set("raise_exception",Me=>{throw new Error(Me)}),se.set("range",re),L)for(let[Me,je]of Object.entries(L))se.set(Me,je);return new Ue(se).run(this.parsed).value}format(L){return it(this.parsed,(L==null?void 0:L.indent)||"	")}}},"./src/backends/onnx.js":(e,r,t)=>{var s;t.r(r),t.d(r,{Tensor:()=>i.Tensor,createInferenceSession:()=>E,deviceToExecutionProviders:()=>h,isONNXProxy:()=>C,isONNXTensor:()=>M});var o=t("./src/env.js"),a=t("?2ce3"),n=t("onnxruntime-web"),i=t("onnxruntime-common");let l=Object.freeze({auto:null,gpu:null,cpu:"cpu",wasm:"wasm",webgpu:"webgpu",cuda:"cuda",dml:"dml",webnn:{name:"webnn",deviceType:"cpu"},"webnn-npu":{name:"webnn",deviceType:"npu"},"webnn-gpu":{name:"webnn",deviceType:"gpu"},"webnn-cpu":{name:"webnn",deviceType:"cpu"}}),c=[],_,d,u=Symbol.for("onnxruntime");if(u in globalThis)d=globalThis[u];else if(o.apis.IS_NODE_ENV){switch(d=a!=null?a:s||(s=t.t(a,2)),process.platform){case"win32":c.push("dml");break;case"linux":process.arch==="x64"&&c.push("cuda");break;case"darwin":break}c.push("cpu"),_=["cpu"]}else d=n,o.apis.IS_WEBNN_AVAILABLE&&c.push("webnn-npu","webnn-gpu","webnn-cpu","webnn"),o.apis.IS_WEBGPU_AVAILABLE&&c.push("webgpu"),c.push("wasm"),_=["wasm"];let f=d.InferenceSession;function h(x=null){var T;if(!x)return _;switch(x){case"auto":return c;case"gpu":return c.filter(S=>["webgpu","cuda","dml","webnn-gpu"].includes(S))}if(c.includes(x))return[(T=l[x])!=null?T:x];throw new Error(`Unsupported device: "${x}". Should be one of: ${c.join(", ")}.`)}let v=null;async function E(x,T,S){v&&await v;let g=f.create(x,T);v!=null||(v=g);let P=await g;return P.config=S,P}function M(x){return x instanceof d.Tensor}let w=d==null?void 0:d.env;w!=null&&w.wasm&&(!(typeof ServiceWorkerGlobalScope!="undefined"&&self instanceof ServiceWorkerGlobalScope)&&!w.wasm.wasmPaths&&(w.wasm.wasmPaths=`https://cdn.jsdelivr.net/npm/@huggingface/transformers@${o.env.version}/dist/`),w.wasm.proxy=!1),w!=null&&w.webgpu&&(w.webgpu.powerPreference="high-performance");function C(){var x;return(x=w==null?void 0:w.wasm)==null?void 0:x.proxy}o.env.backends.onnx=w},"./src/base/feature_extraction_utils.js":(e,r,t)=>{t.r(r),t.d(r,{FeatureExtractor:()=>n,validate_audio_inputs:()=>i});var s=t("./src/utils/constants.js"),o=t("./src/utils/generic.js"),a=t("./src/utils/hub.js");class n extends o.Callable{constructor(c){super(),this.config=c}static async from_pretrained(c,_){let d=await(0,a.getModelJSON)(c,s.FEATURE_EXTRACTOR_NAME,!0,_);return new this(d)}}function i(l,c){var _,d;if(!(l instanceof Float32Array||l instanceof Float64Array))throw new Error(`${c} expects input to be a Float32Array or a Float64Array, but got ${(d=(_=l==null?void 0:l.constructor)==null?void 0:_.name)!=null?d:typeof l} instead. If using the feature extractor directly, remember to use \\`read_audio(url, sampling_rate)\\` to obtain the raw audio data of the file/url.`)}},"./src/base/image_processors_utils.js":(e,r,t)=>{t.r(r),t.d(r,{ImageProcessor:()=>T,center_to_corners_format:()=>u,post_process_instance_segmentation:()=>x,post_process_object_detection:()=>f,post_process_panoptic_segmentation:()=>C,post_process_semantic_segmentation:()=>h});var s=t("./src/utils/generic.js"),o=t("./src/utils/tensor.js"),a=t("./src/utils/maths.js"),n=t("./src/utils/image.js"),i=t("./src/utils/core.js"),l=t("./src/utils/hub.js"),c=t("./src/utils/constants.js");function _(S,g,P=0,$=null){let A=S/g,N=(0,a.bankers_round)(A)*g;return $!==null&&N>$&&(N=Math.floor(A)*g),N<P&&(N=Math.ceil(A)*g),N}function d([S,g],P){return[Math.max(Math.floor(S/P),1)*P,Math.max(Math.floor(g/P),1)*P]}function u([S,g,P,$]){return[S-P/2,g-$/2,S+P/2,g+$/2]}function f(S,g=.5,P=null,$=!1){let A=S.logits,N=S.pred_boxes,[W,R,J]=A.dims;if(P!==null&&P.length!==W)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let H=[];for(let q=0;q<W;++q){let X=P!==null?P[q]:null,ae={boxes:[],classes:[],scores:[]},ce=A[q],he=N[q];for(let B=0;B<R;++B){let D=ce[B],K=[],re;if($){re=D.sigmoid().data;for(let me=0;me<re.length;++me)re[me]>g&&K.push(me)}else{let me=(0,a.max)(D.data)[1];if(me===J-1||(re=(0,a.softmax)(D.data),re[me]<g))continue;K.push(me)}for(let me of K){let oe=he[B].data;oe=u(oe),X!==null&&(oe=oe.map((ge,ze)=>ge*X[(ze+1)%2])),ae.boxes.push(oe),ae.classes.push(me),ae.scores.push(re[me])}}H.push(ae)}return H}function h(S,g=null){let P=S.logits,$=P.dims[0];if(g!==null&&g.length!==$)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let A=[];for(let N=0;N<$;++N){let W=g!==null?g[N]:null,R=P[N];W!==null&&(R=(0,o.interpolate)(R,W,"bilinear",!1));let[J,H]=W!=null?W:R.dims.slice(-2),q=new o.Tensor("int32",new Int32Array(J*H),[J,H]),X=R[0].data,ae=q.data;for(let B=1;B<R.dims[0];++B){let D=R[B].data;for(let K=0;K<D.length;++K)D[K]>X[K]&&(X[K]=D[K],ae[K]=B)}let ce=new Array(R.dims[0]);for(let B=0;B<ae.length;++B){let D=ae[B];ce[D]=D}let he=ce.filter(B=>B!==void 0);A.push({segmentation:q,labels:he})}return A}function v(S,g,P,$){let A=[],N=[],W=[];for(let R=0;R<S.dims[0];++R){let J=S[R],H=g[R],q=(0,a.max)(J.data)[1];if(q===$)continue;let ae=(0,a.softmax)(J.data)[q];ae>P&&(A.push(H),N.push(ae),W.push(q))}return[A,N,W]}function E(S,g,P,$=.5,A=.8){let N=[],W=0,R=0,J=g[P].data;for(let q=0;q<S.length;++q)S[q]===P&&(N.push(q),++W),J[q]>=$&&++R;let H=W>0&&R>0;return H&&(H=W/R>A),[H,N]}function M(S,g,P,$,A,N=null,W=null){let[R,J]=W!=null?W:S[0].dims,H=new o.Tensor("int32",new Int32Array(R*J),[R,J]),q=[];if(W!==null)for(let B=0;B<S.length;++B)S[B]=(0,o.interpolate)(S[B],W,"bilinear",!1);let X=new Int32Array(S[0].data.length),ae=new Float32Array(S[0].data.length);for(let B=0;B<S.length;++B){let D=g[B],K=S[B].data;for(let re=0;re<K.length;++re)K[re]*=D,K[re]>ae[re]&&(X[re]=B,ae[re]=K[re])}let ce=0,he=H.data;for(let B=0;B<P.length;++B){let D=P[B],[K,re]=E(X,S,B,$,A);if(K){++ce;for(let me of re)he[me]=ce;q.push({id:ce,label_id:D,score:g[B]})}}return[H,q]}function w(S,g,P=28,$=56*56,A=14*14*4*1280){if(S<P||g<P)throw new Error(`height:${S} or width:${g} must be larger than factor:${P}`);if(Math.max(S,g)/Math.min(S,g)>200)throw new Error(`absolute aspect ratio must be smaller than 200, got ${Math.max(S,g)/Math.min(S,g)}`);let N=Math.round(S/P)*P,W=Math.round(g/P)*P;if(N*W>A){let R=Math.sqrt(S*g/A);N=Math.floor(S/R/P)*P,W=Math.floor(g/R/P)*P}else if(N*W<$){let R=Math.sqrt($/(S*g));N=Math.ceil(S*R/P)*P,W=Math.ceil(g*R/P)*P}return[N,W]}function C(S,g=.5,P=.5,$=.8,A=null,N=null){var ce,he;A===null&&(console.warn("`label_ids_to_fuse` unset. No instance will be fused."),A=new Set);let W=(ce=S.class_queries_logits)!=null?ce:S.logits,J=((he=S.masks_queries_logits)!=null?he:S.pred_masks).sigmoid(),[H,q,X]=W.dims;if(X-=1,N!==null&&N.length!==H)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let ae=[];for(let B=0;B<H;++B){let D=N!==null?N[B]:null,K=W[B],re=J[B],[me,oe,ge]=v(K,re,g,X);if(ge.length===0){let[Ce,ie]=D!=null?D:re.dims.slice(-2),Y=new o.Tensor("int32",new Int32Array(Ce*ie).fill(-1),[Ce,ie]);ae.push({segmentation:Y,segments_info:[]});continue}let[ze,We]=M(me,oe,ge,P,$,A,D);ae.push({segmentation:ze,segments_info:We})}return ae}function x(S,g=.5,P=null){throw new Error("`post_process_instance_segmentation` is not yet implemented.")}class T extends s.Callable{constructor(g){var P,$,A,N,W,R,J,H,q,X;super(),this.image_mean=(P=g.image_mean)!=null?P:g.mean,this.image_std=($=g.image_std)!=null?$:g.std,this.resample=(A=g.resample)!=null?A:2,this.do_rescale=(N=g.do_rescale)!=null?N:!0,this.rescale_factor=(W=g.rescale_factor)!=null?W:1/255,this.do_normalize=g.do_normalize,this.do_thumbnail=g.do_thumbnail,this.size=(R=g.size)!=null?R:g.image_size,this.do_resize=(J=g.do_resize)!=null?J:this.size!==void 0,this.size_divisibility=(H=g.size_divisibility)!=null?H:g.size_divisor,this.do_center_crop=g.do_center_crop,this.crop_size=g.crop_size,this.do_convert_rgb=(q=g.do_convert_rgb)!=null?q:!0,this.do_crop_margin=g.do_crop_margin,this.pad_size=g.pad_size,this.do_pad=g.do_pad,this.min_pixels=g.min_pixels,this.max_pixels=g.max_pixels,this.do_pad&&!this.pad_size&&this.size&&this.size.width!==void 0&&this.size.height!==void 0&&(this.pad_size=this.size),this.do_flip_channel_order=(X=g.do_flip_channel_order)!=null?X:!1,this.config=g}async thumbnail(g,P,$=2){let A=g.height,N=g.width,W=P.height,R=P.width,J=Math.min(A,W),H=Math.min(N,R);return J===A&&H===N?g:(A>N?H=Math.floor(N*J/A):N>A&&(J=Math.floor(A*H/N)),await g.resize(H,J,{resample:$}))}async crop_margin(g,P=200){let $=g.clone().grayscale(),A=(0,a.min)($.data)[0],W=(0,a.max)($.data)[0]-A;if(W===0)return g;let R=P/255,J=$.width,H=$.height,q=0,X=0,ae=$.data;for(let ce=0;ce<$.height;++ce){let he=ce*$.width;for(let B=0;B<$.width;++B)(ae[he+B]-A)/W<R&&(J=Math.min(J,B),H=Math.min(H,ce),q=Math.max(q,B),X=Math.max(X,ce))}return g=await g.crop([J,H,q,X]),g}pad_image(g,P,$,{mode:A="constant",center:N=!1,constant_values:W=0}={}){let[R,J,H]=P,q,X;if(typeof $=="number"?(q=$,X=$):$==="square"?q=X=Math.max(R,J):(q=$.width,X=$.height),q!==J||X!==R){let ae=new Float32Array(q*X*H);if(Array.isArray(W))for(let B=0;B<ae.length;++B)ae[B]=W[B%H];else W!==0&&ae.fill(W);let[ce,he]=N?[Math.floor((q-J)/2),Math.floor((X-R)/2)]:[0,0];for(let B=0;B<R;++B){let D=(B+he)*q,K=B*J;for(let re=0;re<J;++re){let me=(D+re+ce)*H,oe=(K+re)*H;for(let ge=0;ge<H;++ge)ae[me+ge]=g[oe+ge]}}if(A==="symmetric"){if(N)throw new Error("`center` padding is not supported when `mode` is set to `symmetric`.");let B=R-1,D=J-1;for(let K=0;K<X;++K){let re=K*q,me=(0,i.calculateReflectOffset)(K,B)*J;for(let oe=0;oe<q;++oe){if(K<R&&oe<J)continue;let ge=(re+oe)*H,ze=(me+(0,i.calculateReflectOffset)(oe,D))*H;for(let We=0;We<H;++We)ae[ge+We]=g[ze+We]}}}g=ae,P=[X,q,H]}return[g,P]}rescale(g){for(let P=0;P<g.length;++P)g[P]=this.rescale_factor*g[P]}get_resize_output_image_size(g,P){var R;let[$,A]=g.size,N,W;if(this.do_thumbnail){let{height:J,width:H}=P;N=Math.min(J,H)}else Number.isInteger(P)?(N=P,W=(R=this.config.max_size)!=null?R:N):P!==void 0&&(N=P.shortest_edge,W=P.longest_edge);if(N!==void 0||W!==void 0){let J=N===void 0?1:Math.max(N/$,N/A),H=$*J,q=A*J,X=W===void 0?1:Math.min(W/H,W/q),ae=Math.floor(Number((H*X).toFixed(2))),ce=Math.floor(Number((q*X).toFixed(2)));return this.size_divisibility!==void 0&&([ae,ce]=d([ae,ce],this.size_divisibility)),[ae,ce]}else if(P!==void 0&&P.width!==void 0&&P.height!==void 0){let J=P.width,H=P.height;if(this.config.keep_aspect_ratio&&this.config.ensure_multiple_of){let q=H/A,X=J/$;Math.abs(1-X)<Math.abs(1-q)?q=X:X=q,H=_(q*A,this.config.ensure_multiple_of),J=_(X*$,this.config.ensure_multiple_of)}return[J,H]}else{if(this.size_divisibility!==void 0)return d([$,A],this.size_divisibility);if(this.min_pixels!==void 0&&this.max_pixels!==void 0){let J=this.config.patch_size*this.config.merge_size;return w(A,$,J,this.min_pixels,this.max_pixels)}else throw new Error(`Could not resize image due to unsupported \\`this.size\\` option in config: ${JSON.stringify(P)}`)}}async resize(g){let[P,$]=this.get_resize_output_image_size(g,this.size);return await g.resize(P,$,{resample:this.resample})}async preprocess(g,{do_normalize:P=null,do_pad:$=null,do_convert_rgb:A=null,do_convert_grayscale:N=null,do_flip_channel_order:W=null}={}){this.do_crop_margin&&(g=await this.crop_margin(g));let[R,J]=g.size;if((A!=null?A:this.do_convert_rgb)?g=g.rgb():N&&(g=g.grayscale()),this.do_resize&&(g=await this.resize(g)),this.do_thumbnail&&(g=await this.thumbnail(g,this.size,this.resample)),this.do_center_crop){let ce,he;Number.isInteger(this.crop_size)?(ce=this.crop_size,he=this.crop_size):(ce=this.crop_size.width,he=this.crop_size.height),g=await g.center_crop(ce,he)}let H=[g.height,g.width],q=Float32Array.from(g.data),X=[g.height,g.width,g.channels];if(this.do_rescale&&this.rescale(q),P!=null?P:this.do_normalize){let ce=this.image_mean;Array.isArray(this.image_mean)||(ce=new Array(g.channels).fill(ce));let he=this.image_std;if(Array.isArray(this.image_std)||(he=new Array(g.channels).fill(ce)),ce.length!==g.channels||he.length!==g.channels)throw new Error(`When set to arrays, the length of \\`image_mean\\` (${ce.length}) and \\`image_std\\` (${he.length}) must match the number of channels in the image (${g.channels}).`);for(let B=0;B<q.length;B+=g.channels)for(let D=0;D<g.channels;++D)q[B+D]=(q[B+D]-ce[D])/he[D]}if($!=null?$:this.do_pad){if(this.pad_size)[q,X]=this.pad_image(q,[g.height,g.width,g.channels],this.pad_size);else if(this.size_divisibility){let[ce,he]=d([X[1],X[0]],this.size_divisibility);[q,X]=this.pad_image(q,X,{width:ce,height:he})}}if(W!=null?W:this.do_flip_channel_order){if(X[2]!==3)throw new Error("Flipping channel order is only supported for RGB images.");for(let ce=0;ce<q.length;ce+=3){let he=q[ce];q[ce]=q[ce+2],q[ce+2]=he}}let ae=new o.Tensor("float32",q,X).permute(2,0,1);return{original_size:[J,R],reshaped_input_size:H,pixel_values:ae}}async _call(g,...P){Array.isArray(g)||(g=[g]);let $=await Promise.all(g.map(N=>this.preprocess(N)));return{pixel_values:(0,o.stack)($.map(N=>N.pixel_values),0),original_sizes:$.map(N=>N.original_size),reshaped_input_sizes:$.map(N=>N.reshaped_input_size)}}static async from_pretrained(g,P){let $=await(0,l.getModelJSON)(g,c.IMAGE_PROCESSOR_NAME,!0,P);return new this($)}}},"./src/base/processing_utils.js":(e,r,t)=>{t.r(r),t.d(r,{Processor:()=>n});var s=t("./src/utils/constants.js"),o=t("./src/utils/generic.js"),a=t("./src/utils/hub.js");class n extends o.Callable{constructor(l,c,_){super(),this.config=l,this.components=c,this.chat_template=_}get image_processor(){return this.components.image_processor}get tokenizer(){return this.components.tokenizer}get feature_extractor(){return this.components.feature_extractor}apply_chat_template(l,c={}){var _;if(!this.tokenizer)throw new Error("Unable to apply chat template without a tokenizer.");return this.tokenizer.apply_chat_template(l,Fe({tokenize:!1,chat_template:(_=this.chat_template)!=null?_:void 0},c))}batch_decode(...l){if(!this.tokenizer)throw new Error("Unable to decode without a tokenizer.");return this.tokenizer.batch_decode(...l)}decode(...l){if(!this.tokenizer)throw new Error("Unable to decode without a tokenizer.");return this.tokenizer.decode(...l)}async _call(l,...c){for(let _ of[this.image_processor,this.feature_extractor,this.tokenizer])if(_)return _(l,...c);throw new Error("No image processor, feature extractor, or tokenizer found.")}static async from_pretrained(l,c){let[_,d,u]=await Promise.all([this.uses_processor_config?(0,a.getModelJSON)(l,s.PROCESSOR_NAME,!0,c):{},Promise.all(this.classes.filter(f=>f in this).map(async f=>{let h=await this[f].from_pretrained(l,c);return[f.replace(/_class$/,""),h]})).then(Object.fromEntries),this.uses_chat_template_file?(0,a.getModelText)(l,s.CHAT_TEMPLATE_NAME,!0,c):null]);return new this(_,d,u)}}ee(n,"classes",["image_processor_class","tokenizer_class","feature_extractor_class"]),ee(n,"uses_processor_config",!1),ee(n,"uses_chat_template_file",!1)},"./src/configs.js":(e,r,t)=>{t.r(r),t.d(r,{AutoConfig:()=>c,PretrainedConfig:()=>l,getKeyValueShapes:()=>i});var s=t("./src/utils/core.js"),o=t("./src/utils/hub.js");async function a(_,d){return await(0,o.getModelJSON)(_,"config.json",!0,d)}function n(_){let d={},u={};switch(_.model_type){case"llava":case"paligemma":case"gemma3":case"florence2":case"llava_onevision":case"idefics3":case"ultravox":case"smolvlm":case"gemma3n":u=n(_.text_config);break;case"moondream1":u=n(_.phi_config);break;case"musicgen":u=n(_.decoder);break;case"multi_modality":u=n(_.language_config);break;case"gpt2":case"gptj":case"jais":case"codegen":case"gpt_bigcode":d.num_heads="n_head",d.num_layers="n_layer",d.hidden_size="n_embd";break;case"gpt_neox":case"stablelm":case"opt":case"falcon":d.num_heads="num_attention_heads",d.num_layers="num_hidden_layers",d.hidden_size="hidden_size";break;case"llama":case"olmo":case"olmo2":case"mobilellm":case"granite":case"cohere":case"mistral":case"starcoder2":case"qwen2":case"qwen2_vl":case"phi":case"phi3":case"phi3_v":case"llava_qwen2":d.num_heads="num_key_value_heads",d.num_layers="num_hidden_layers",d.hidden_size="hidden_size",d.num_attention_heads="num_attention_heads";break;case"qwen3":case"gemma":case"gemma2":case"gemma3_text":case"gemma3n_text":case"glm":case"helium":d.num_heads="num_key_value_heads",d.num_layers="num_hidden_layers",d.dim_kv="head_dim";break;case"openelm":d.num_heads="num_kv_heads",d.num_layers="num_transformer_layers",d.dim_kv="head_dim";break;case"gpt_neo":case"donut-swin":d.num_heads="num_heads",d.num_layers="num_layers",d.hidden_size="hidden_size";break;case"bloom":d.num_heads="n_head",d.num_layers="n_layer",d.hidden_size="hidden_size";break;case"mpt":d.num_heads="n_heads",d.num_layers="n_layers",d.hidden_size="d_model";break;case"exaone":d.num_heads="num_key_value_heads",d.num_layers="num_layers",d.dim_kv="head_dim",d.num_attention_heads="num_attention_heads";break;case"t5":case"mt5":case"longt5":d.num_decoder_layers="num_decoder_layers",d.num_decoder_heads="num_heads",d.decoder_dim_kv="d_kv",d.num_encoder_layers="num_layers",d.num_encoder_heads="num_heads",d.encoder_dim_kv="d_kv";break;case"bart":case"mbart":case"marian":case"whisper":case"lite-whisper":case"m2m_100":case"blenderbot":case"blenderbot-small":case"florence2_language":d.num_decoder_layers="decoder_layers",d.num_decoder_heads="decoder_attention_heads",d.decoder_hidden_size="d_model",d.num_encoder_layers="encoder_layers",d.num_encoder_heads="encoder_attention_heads",d.encoder_hidden_size="d_model";break;case"speecht5":d.num_decoder_layers="decoder_layers",d.num_decoder_heads="decoder_attention_heads",d.decoder_hidden_size="hidden_size",d.num_encoder_layers="encoder_layers",d.num_encoder_heads="encoder_attention_heads",d.encoder_hidden_size="hidden_size";break;case"trocr":d.num_encoder_layers=d.num_decoder_layers="decoder_layers",d.num_encoder_heads=d.num_decoder_heads="decoder_attention_heads",d.encoder_hidden_size=d.decoder_hidden_size="d_model";break;case"musicgen_decoder":d.num_encoder_layers=d.num_decoder_layers="num_hidden_layers",d.num_encoder_heads=d.num_decoder_heads="num_attention_heads",d.encoder_hidden_size=d.decoder_hidden_size="hidden_size";break;case"moonshine":d.num_decoder_layers="decoder_num_hidden_layers",d.num_decoder_heads="decoder_num_key_value_heads",d.num_encoder_layers="encoder_num_hidden_layers",d.num_encoder_heads="encoder_num_key_value_heads",d.encoder_hidden_size=d.decoder_hidden_size="hidden_size";break;case"vision-encoder-decoder":let h=n(_.decoder),v="num_decoder_layers"in h,E=(0,s.pick)(_,["model_type","is_encoder_decoder"]);return v?(E.num_decoder_layers=h.num_decoder_layers,E.num_decoder_heads=h.num_decoder_heads,E.decoder_hidden_size=h.decoder_hidden_size,E.num_encoder_layers=h.num_encoder_layers,E.num_encoder_heads=h.num_encoder_heads,E.encoder_hidden_size=h.encoder_hidden_size):(E.num_layers=h.num_layers,E.num_heads=h.num_heads,E.hidden_size=h.hidden_size),E}let f=Fe(Fe({},u),(0,s.pick)(_,["model_type","multi_query","is_encoder_decoder"]));for(let h in d)f[h]=_[d[h]];return f}function i(_,{prefix:d="past_key_values",batch_size:u=1}={}){var v,E,M,w;let f={},h=_.normalized_config;if(h.is_encoder_decoder&&"num_encoder_heads"in h&&"num_decoder_heads"in h){let C=(v=h.encoder_dim_kv)!=null?v:h.encoder_hidden_size/h.num_encoder_heads,x=(E=h.decoder_dim_kv)!=null?E:h.decoder_hidden_size/h.num_decoder_heads,T=[u,h.num_encoder_heads,0,C],S=[u,h.num_decoder_heads,0,x];for(let g=0;g<h.num_decoder_layers;++g)f[`${d}.${g}.encoder.key`]=T,f[`${d}.${g}.encoder.value`]=T,f[`${d}.${g}.decoder.key`]=S,f[`${d}.${g}.decoder.value`]=S}else{let C=h.num_heads,x=h.num_layers,T=(w=h.dim_kv)!=null?w:h.hidden_size/((M=h.num_attention_heads)!=null?M:C);if(h.model_type==="falcon"){let S=[u*C,0,T];for(let g=0;g<x;++g)f[`${d}.${g}.key`]=S,f[`${d}.${g}.value`]=S}else if(h.multi_query){let S=[u*C,0,2*T];for(let g=0;g<x;++g)f[`${d}.${g}.key_value`]=S}else if(h.model_type==="bloom"){let S=[u*C,T,0],g=[u*C,0,T];for(let P=0;P<x;++P)f[`${d}.${P}.key`]=S,f[`${d}.${P}.value`]=g}else if(h.model_type==="openelm")for(let S=0;S<x;++S){let g=[u,C[S],0,T];f[`${d}.${S}.key`]=g,f[`${d}.${S}.value`]=g}else{let S=[u,C,0,T];for(let g=0;g<x;++g)f[`${d}.${g}.key`]=S,f[`${d}.${g}.value`]=S}}return f}class l{constructor(d){ee(this,"model_type",null);ee(this,"is_encoder_decoder",!1);ee(this,"max_position_embeddings");ee(this,"transformers.js_config");Object.assign(this,d),this.normalized_config=n(this)}static async from_pretrained(d,{progress_callback:u=null,config:f=null,cache_dir:h=null,local_files_only:v=!1,revision:E="main"}={}){f&&!(f instanceof l)&&(f=new l(f));let M=f!=null?f:await a(d,{progress_callback:u,config:f,cache_dir:h,local_files_only:v,revision:E});return new this(M)}}class c{static async from_pretrained(...d){return l.from_pretrained(...d)}}},"./src/env.js":(e,r,t)=>{var A,N;t.r(r),t.d(r,{apis:()=>w,env:()=>P});var s=t("?db59"),o=t("?383f"),a=t("?fa4b");let n="3.6.0",i=typeof window!="undefined"&&typeof window.document!="undefined",l=typeof self!="undefined"&&((A=self.constructor)==null?void 0:A.name)==="DedicatedWorkerGlobalScope",c=typeof self!="undefined"&&"caches"in self,_=typeof navigator!="undefined"&&"gpu"in navigator,d=typeof navigator!="undefined"&&"ml"in navigator,u=typeof process!="undefined",f=u&&((N=process==null?void 0:process.release)==null?void 0:N.name)==="node",h=!$(s),v=!$(o),E=typeof globalThis.Deno!="undefined",M=typeof globalThis.Bun!="undefined",w=Object.freeze({IS_BROWSER_ENV:i,IS_WEBWORKER_ENV:l,IS_WEB_CACHE_AVAILABLE:c,IS_WEBGPU_AVAILABLE:_,IS_WEBNN_AVAILABLE:d,IS_PROCESS_AVAILABLE:u,IS_NODE_ENV:f,IS_FS_AVAILABLE:h,IS_PATH_AVAILABLE:v}),C=h&&v,x="./";if(C){let W=Object(iz).url;W?x=o.dirname(o.dirname(a.fileURLToPath(W))):typeof __dirname!="undefined"&&(x=o.dirname(__dirname))}let T=C?o.join(x,"/.cache/"):null,S="/models/",g=C?o.join(x,S):S,P={version:n,backends:{onnx:{}},allowRemoteModels:!0,remoteHost:"https://huggingface.co/",remotePathTemplate:"{model}/resolve/{revision}/",allowLocalModels:!(i||l),localModelPath:g,useFS:h,useBrowserCache:c&&!E,useFSCache:h,cacheDir:T,useCustomCache:!1,customCache:null};function $(W){return Object.keys(W).length===0}},"./src/generation/configuration_utils.js":(e,r,t)=>{t.r(r),t.d(r,{GenerationConfig:()=>o});var s=t("./src/utils/core.js");class o{constructor(n){ee(this,"max_length",20);ee(this,"max_new_tokens",null);ee(this,"min_length",0);ee(this,"min_new_tokens",null);ee(this,"early_stopping",!1);ee(this,"max_time",null);ee(this,"do_sample",!1);ee(this,"num_beams",1);ee(this,"num_beam_groups",1);ee(this,"penalty_alpha",null);ee(this,"use_cache",!0);ee(this,"temperature",1);ee(this,"top_k",50);ee(this,"top_p",1);ee(this,"typical_p",1);ee(this,"epsilon_cutoff",0);ee(this,"eta_cutoff",0);ee(this,"diversity_penalty",0);ee(this,"repetition_penalty",1);ee(this,"encoder_repetition_penalty",1);ee(this,"length_penalty",1);ee(this,"no_repeat_ngram_size",0);ee(this,"bad_words_ids",null);ee(this,"force_words_ids",null);ee(this,"renormalize_logits",!1);ee(this,"constraints",null);ee(this,"forced_bos_token_id",null);ee(this,"forced_eos_token_id",null);ee(this,"remove_invalid_values",!1);ee(this,"exponential_decay_length_penalty",null);ee(this,"suppress_tokens",null);ee(this,"streamer",null);ee(this,"begin_suppress_tokens",null);ee(this,"forced_decoder_ids",null);ee(this,"guidance_scale",null);ee(this,"num_return_sequences",1);ee(this,"output_attentions",!1);ee(this,"output_hidden_states",!1);ee(this,"output_scores",!1);ee(this,"return_dict_in_generate",!1);ee(this,"pad_token_id",null);ee(this,"bos_token_id",null);ee(this,"eos_token_id",null);ee(this,"encoder_no_repeat_ngram_size",0);ee(this,"decoder_start_token_id",null);ee(this,"generation_kwargs",{});Object.assign(this,(0,s.pick)(n,Object.getOwnPropertyNames(this)))}}},"./src/generation/logits_process.js":(e,r,t)=>{t.r(r),t.d(r,{ClassifierFreeGuidanceLogitsProcessor:()=>w,ForcedBOSTokenLogitsProcessor:()=>c,ForcedEOSTokenLogitsProcessor:()=>_,LogitsProcessor:()=>n,LogitsProcessorList:()=>l,LogitsWarper:()=>i,MinLengthLogitsProcessor:()=>v,MinNewTokensLengthLogitsProcessor:()=>E,NoBadWordsLogitsProcessor:()=>M,NoRepeatNGramLogitsProcessor:()=>f,RepetitionPenaltyLogitsProcessor:()=>h,SuppressTokensAtBeginLogitsProcessor:()=>d,TemperatureLogitsWarper:()=>C,TopKLogitsWarper:()=>T,TopPLogitsWarper:()=>x,WhisperTimeStampLogitsProcessor:()=>u});var s=t("./src/utils/generic.js"),o=t("./src/utils/tensor.js"),a=t("./src/utils/maths.js");class n extends s.Callable{_call(g,P){throw Error("`_call` should be implemented in a subclass")}}class i extends s.Callable{_call(g,P){throw Error("`_call` should be implemented in a subclass")}}class l extends s.Callable{constructor(){super(),this.processors=[]}push(g){this.processors.push(g)}extend(g){this.processors.push(...g)}_call(g,P){let $=P;for(let A of this.processors)$=A(g,$);return $}[Symbol.iterator](){return this.processors.values()}}class c extends n{constructor(g){super(),this.bos_token_id=g}_call(g,P){for(let $=0;$<g.length;++$)if(g[$].length===1){let A=P[$].data;A.fill(-1/0),A[this.bos_token_id]=0}return P}}class _ extends n{constructor(g,P){super(),this.max_length=g,this.eos_token_id=Array.isArray(P)?P:[P]}_call(g,P){for(let $=0;$<g.length;++$)if(g[$].length===this.max_length-1){let A=P[$].data;A.fill(-1/0);for(let N of this.eos_token_id)A[N]=0}return P}}class d extends n{constructor(g,P){super(),this.begin_suppress_tokens=g,this.begin_index=P}_call(g,P){for(let $=0;$<g.length;++$)if(g[$].length===this.begin_index){let A=P[$].data;for(let N of this.begin_suppress_tokens)A[N]=-1/0}return P}}class u extends n{constructor(g,P){super(),this.eos_token_id=Array.isArray(g.eos_token_id)?g.eos_token_id[0]:g.eos_token_id,this.no_timestamps_token_id=g.no_timestamps_token_id,this.timestamp_begin=this.no_timestamps_token_id+1,this.begin_index=P.length,P.at(-1)===this.no_timestamps_token_id&&(this.begin_index-=1),this.max_initial_timestamp_index=g.max_initial_timestamp_index}_call(g,P){for(let $=0;$<g.length;++$){let A=P[$].data;if(A[this.no_timestamps_token_id]=-1/0,g[$].length===this.begin_index-1){A.fill(-1/0),A[this.timestamp_begin]=0;continue}let N=g[$].slice(this.begin_index),W=N.length>=1&&N[N.length-1]>=this.timestamp_begin,R=N.length<2||N[N.length-2]>=this.timestamp_begin;if(W&&(R?A.subarray(this.timestamp_begin).fill(-1/0):A.subarray(0,this.eos_token_id).fill(-1/0)),g[$].length===this.begin_index&&this.max_initial_timestamp_index!==null){let X=this.timestamp_begin+this.max_initial_timestamp_index;A.subarray(X+1).fill(-1/0)}let J=(0,a.log_softmax)(A),H=Math.log(J.subarray(this.timestamp_begin).map(Math.exp).reduce((X,ae)=>X+ae)),q=(0,a.max)(J.subarray(0,this.timestamp_begin))[0];H>q&&A.subarray(0,this.timestamp_begin).fill(-1/0)}return P}}class f extends n{constructor(g){super(),this.no_repeat_ngram_size=g}getNgrams(g){var N;let P=g.length,$=[];for(let W=0;W<P+1-this.no_repeat_ngram_size;++W){let R=[];for(let J=0;J<this.no_repeat_ngram_size;++J)R.push(g[W+J]);$.push(R.map(Number))}let A=new Map;for(let W of $){let R=W.slice(0,W.length-1),J=JSON.stringify(R),H=(N=A.get(J))!=null?N:[];H.push(W[W.length-1]),A.set(J,H)}return A}getGeneratedNgrams(g,P){var N;let $=P.slice(P.length+1-this.no_repeat_ngram_size,P.length);return(N=g.get(JSON.stringify($.map(Number))))!=null?N:[]}calcBannedNgramTokens(g){let P=[];if(g.length+1<this.no_repeat_ngram_size)return P;{let $=this.getNgrams(g);return this.getGeneratedNgrams($,g)}}_call(g,P){for(let $=0;$<g.length;++$){let A=P[$].data,N=this.calcBannedNgramTokens(g[$]);for(let W of N)A[W]=-1/0}return P}}class h extends n{constructor(g){super(),this.penalty=g}_call(g,P){for(let $=0;$<g.length;++$){let A=P[$].data;for(let N of new Set(g[$])){let W=Number(N);A[W]<0?A[W]*=this.penalty:A[W]/=this.penalty}}return P}}class v extends n{constructor(g,P){super(),this.min_length=g,this.eos_token_id=Array.isArray(P)?P:[P]}_call(g,P){for(let $=0;$<g.length;++$)if(g[$].length<this.min_length){let A=P[$].data;for(let N of this.eos_token_id)A[N]=-1/0}return P}}class E extends n{constructor(g,P,$){super(),this.prompt_length_to_skip=g,this.min_new_tokens=P,this.eos_token_id=Array.isArray($)?$:[$]}_call(g,P){for(let $=0;$<g.length;++$)if(g[$].length-this.prompt_length_to_skip<this.min_new_tokens){let N=P[$].data;for(let W of this.eos_token_id)N[W]=-1/0}return P}}class M extends n{constructor(g,P){super(),this.bad_words_ids=g,this.eos_token_id=Array.isArray(P)?P:[P]}_call(g,P){for(let $=0;$<g.length;++$){let A=P[$].data,N=g[$];for(let W of this.bad_words_ids){if(N.length<W.length-1)continue;let R=!0;for(let J=1;J<=W.length-1;++J)if(W.at(-J-1)!=N.at(-J)){R=!1;break}R&&(A[W.at(-1)]=-1/0)}}return P}}class w extends n{constructor(g){if(super(),g<=1)throw new Error(`Require guidance scale >1 to use the classifier free guidance processor, got guidance scale ${g}.`);this.guidance_scale=g}_call(g,P){if(P.dims[0]!==2*g.length)throw new Error(`Logits should have twice the batch size of the input ids, the first half of batches corresponding to the conditional inputs, and the second half of batches corresponding to the unconditional inputs. Got batch size ${P.dims[0]} for the logits and ${g.length} for the input ids.`);let $=g.length,A=P.slice([0,$],null),N=P.slice([$,P.dims[0]],null);for(let W=0;W<N.data.length;++W)N.data[W]+=(A.data[W]-N.data[W])*this.guidance_scale;return N}}class C extends i{constructor(g){if(super(),typeof g!="number"||g<=0){let P=`\\`temperature\\` (=${g}) must be a strictly positive float, otherwise your next token scores will be invalid.`;g===0&&(P+=" If you\'re looking for greedy decoding strategies, set `do_sample=false`.")}this.temperature=g}_call(g,P){let $=P.data;for(let A=0;A<$.length;++A)$[A]/=this.temperature;return P}}class x extends i{constructor(g,{filter_value:P=-1/0,min_tokens_to_keep:$=1}={}){if(super(),g<0||g>1)throw new Error(`\\`top_p\\` must be a float > 0 and < 1, but is ${g}`);if(!Number.isInteger($)||$<1)throw new Error(`\\`min_tokens_to_keep\\` must be a positive integer, but is ${$}`);this.top_p=g,this.filter_value=P,this.min_tokens_to_keep=$}}class T extends i{constructor(g,{filter_value:P=-1/0,min_tokens_to_keep:$=1}={}){if(super(),!Number.isInteger(g)||g<0)throw new Error(`\\`top_k\\` must be a positive integer, but is ${g}`);this.top_k=Math.max(g,$),this.filter_value=P}}},"./src/generation/logits_sampler.js":(e,r,t)=>{t.r(r),t.d(r,{LogitsSampler:()=>i});var s=t("./src/utils/generic.js"),o=t("./src/utils/tensor.js"),a=t("./src/utils/maths.js"),n=t("./src/generation/configuration_utils.js");class i extends s.Callable{constructor(u){super(),this.generation_config=u}async _call(u){return this.sample(u)}async sample(u){throw Error("sample should be implemented in subclasses.")}getLogits(u,f){let h=u.dims.at(-1),v=u.data;if(f===-1)v=v.slice(-h);else{let E=f*h;v=v.slice(E,E+h)}return v}randomSelect(u){let f=0;for(let v=0;v<u.length;++v)f+=u[v];let h=Math.random()*f;for(let v=0;v<u.length;++v)if(h-=u[v],h<=0)return v;return 0}static getSampler(u){if(u.do_sample)return new c(u);if(u.num_beams>1)return new _(u);if(u.num_return_sequences>1)throw Error(`num_return_sequences has to be 1 when doing greedy search, but is ${u.num_return_sequences}.`);return new l(u)}}class l extends i{async sample(u){let f=(0,a.max)(u.data)[1];return[[BigInt(f),0]]}}class c extends i{async sample(u){let f=u.dims.at(-1);this.generation_config.top_k>0&&(f=Math.min(this.generation_config.top_k,f));let[h,v]=await(0,o.topk)(u,f),E=(0,a.softmax)(h.data);return Array.from({length:this.generation_config.num_beams},()=>{let M=this.randomSelect(E);return[v.data[M],Math.log(E[M])]})}}class _ extends i{async sample(u){let f=u.dims.at(-1);this.generation_config.top_k>0&&(f=Math.min(this.generation_config.top_k,f));let[h,v]=await(0,o.topk)(u,f),E=(0,a.softmax)(h.data);return Array.from({length:this.generation_config.num_beams},(M,w)=>[v.data[w],Math.log(E[w])])}}},"./src/generation/stopping_criteria.js":(e,r,t)=>{t.r(r),t.d(r,{EosTokenCriteria:()=>i,InterruptableStoppingCriteria:()=>l,MaxLengthCriteria:()=>n,StoppingCriteria:()=>o,StoppingCriteriaList:()=>a});var s=t("./src/utils/generic.js");class o extends s.Callable{_call(_,d){throw Error("StoppingCriteria needs to be subclassed")}}class a extends s.Callable{constructor(){super(),this.criteria=[]}push(_){this.criteria.push(_)}extend(_){_ instanceof a?_=_.criteria:_ instanceof o&&(_=[_]),this.criteria.push(..._)}_call(_,d){let u=new Array(_.length).fill(!1);for(let f of this.criteria){let h=f(_,d);for(let v=0;v<u.length;++v)u[v]||(u[v]=h[v])}return u}[Symbol.iterator](){return this.criteria.values()}}class n extends o{constructor(_,d=null){super(),this.max_length=_,this.max_position_embeddings=d}_call(_){return _.map(d=>d.length>=this.max_length)}}class i extends o{constructor(_){super(),Array.isArray(_)||(_=[_]),this.eos_token_id=_}_call(_,d){return _.map(u=>{let f=u.at(-1);return this.eos_token_id.some(h=>f==h)})}}class l extends o{constructor(){super(),this.interrupted=!1}interrupt(){this.interrupted=!0}reset(){this.interrupted=!1}_call(_,d){return new Array(_.length).fill(this.interrupted)}}},"./src/generation/streamers.js":(e,r,t)=>{t.r(r),t.d(r,{BaseStreamer:()=>n,TextStreamer:()=>l,WhisperTextStreamer:()=>c});var s=t("./src/utils/core.js"),o=t("./src/tokenizers.js"),a=t("./src/env.js");class n{put(d){throw Error("Not implemented")}end(){throw Error("Not implemented")}}let i=a.apis.IS_PROCESS_AVAILABLE?_=>process.stdout.write(_):_=>console.log(_);class l extends n{constructor(d,w={}){var C=w,{skip_prompt:u=!1,callback_function:f=null,token_callback_function:h=null,skip_special_tokens:v=!0,decode_kwargs:E={}}=C,M=ns(C,["skip_prompt","callback_function","token_callback_function","skip_special_tokens","decode_kwargs"]);super(),this.tokenizer=d,this.skip_prompt=u,this.callback_function=f!=null?f:i,this.token_callback_function=h,this.decode_kwargs=Fe(Fe({skip_special_tokens:v},E),M),this.token_cache=[],this.print_len=0,this.next_tokens_are_prompt=!0}put(d){var E;if(d.length>1)throw Error("TextStreamer only supports batch size of 1");let u=this.next_tokens_are_prompt;if(u&&(this.next_tokens_are_prompt=!1,this.skip_prompt))return;let f=d[0];(E=this.token_callback_function)==null||E.call(this,f),this.token_cache=(0,s.mergeArrays)(this.token_cache,f);let h=this.tokenizer.decode(this.token_cache,this.decode_kwargs),v;u||h.endsWith(`\n`)?(v=h.slice(this.print_len),this.token_cache=[],this.print_len=0):h.length>0&&(0,o.is_chinese_char)(h.charCodeAt(h.length-1))?(v=h.slice(this.print_len),this.print_len+=v.length):(v=h.slice(this.print_len,h.lastIndexOf(" ")+1),this.print_len+=v.length),this.on_finalized_text(v,!1)}end(){let d;this.token_cache.length>0?(d=this.tokenizer.decode(this.token_cache,this.decode_kwargs).slice(this.print_len),this.token_cache=[],this.print_len=0):d="",this.next_tokens_are_prompt=!0,this.on_finalized_text(d,!0)}on_finalized_text(d,u){var f,h;d.length>0&&((f=this.callback_function)==null||f.call(this,d)),u&&this.callback_function===i&&a.apis.IS_PROCESS_AVAILABLE&&((h=this.callback_function)==null||h.call(this,`\n`))}}class c extends l{constructor(d,{skip_prompt:u=!1,callback_function:f=null,token_callback_function:h=null,on_chunk_start:v=null,on_chunk_end:E=null,on_finalize:M=null,time_precision:w=.02,skip_special_tokens:C=!0,decode_kwargs:x={}}={}){super(d,{skip_prompt:u,skip_special_tokens:C,callback_function:f,token_callback_function:h,decode_kwargs:x}),this.timestamp_begin=d.timestamp_begin,this.on_chunk_start=v,this.on_chunk_end=E,this.on_finalize=M,this.time_precision=w,this.waiting_for_timestamp=!1}put(d){var f,h,v;if(d.length>1)throw Error("WhisperTextStreamer only supports batch size of 1");let u=d[0];if(u.length===1){let E=Number(u[0])-this.timestamp_begin;if(E>=0){let M=E*this.time_precision;this.waiting_for_timestamp?(f=this.on_chunk_end)==null||f.call(this,M):(h=this.on_chunk_start)==null||h.call(this,M),this.waiting_for_timestamp=!this.waiting_for_timestamp,(v=this.token_callback_function)==null||v.call(this,u);return}}return super.put(d)}end(){var d;super.end(),(d=this.on_finalize)==null||d.call(this)}}},"./src/models.js":(e,r,t)=>{t.r(r),t.d(r,{ASTForAudioClassification:()=>kn,ASTModel:()=>En,ASTPreTrainedModel:()=>Mo,AlbertForMaskedLM:()=>Z,AlbertForQuestionAnswering:()=>V,AlbertForSequenceClassification:()=>I,AlbertModel:()=>ue,AlbertPreTrainedModel:()=>Bs,AutoModel:()=>Xl,AutoModelForAudioClassification:()=>Nh,AutoModelForAudioFrameClassification:()=>Vh,AutoModelForAudioTextToText:()=>Jh,AutoModelForCTC:()=>Rh,AutoModelForCausalLM:()=>Ch,AutoModelForDepthEstimation:()=>Kh,AutoModelForDocumentQuestionAnswering:()=>Wh,AutoModelForImageClassification:()=>$h,AutoModelForImageFeatureExtraction:()=>Qh,AutoModelForImageMatting:()=>Uh,AutoModelForImageSegmentation:()=>Ah,AutoModelForImageTextToText:()=>Xh,AutoModelForImageToImage:()=>Gh,AutoModelForMaskGeneration:()=>Bh,AutoModelForMaskedLM:()=>Sh,AutoModelForNormalEstimation:()=>Hh,AutoModelForObjectDetection:()=>Lh,AutoModelForPoseEstimation:()=>qh,AutoModelForQuestionAnswering:()=>Ih,AutoModelForSemanticSegmentation:()=>Dh,AutoModelForSeq2SeqLM:()=>Th,AutoModelForSequenceClassification:()=>xh,AutoModelForSpeechSeq2Seq:()=>Ph,AutoModelForTextToSpectrogram:()=>Eh,AutoModelForTextToWaveform:()=>kh,AutoModelForTokenClassification:()=>yh,AutoModelForUniversalSegmentation:()=>Oh,AutoModelForVision2Seq:()=>Fh,AutoModelForXVector:()=>jh,AutoModelForZeroShotObjectDetection:()=>zh,BartForConditionalGeneration:()=>Ut,BartForSequenceClassification:()=>ir,BartModel:()=>Ht,BartPretrainedModel:()=>vr,BaseModelOutput:()=>ve,BeitForImageClassification:()=>a_,BeitModel:()=>s_,BeitPreTrainedModel:()=>pl,BertForMaskedLM:()=>ke,BertForQuestionAnswering:()=>Ue,BertForSequenceClassification:()=>Pe,BertForTokenClassification:()=>He,BertModel:()=>xe,BertPreTrainedModel:()=>Ie,BlenderbotForConditionalGeneration:()=>Fr,BlenderbotModel:()=>xr,BlenderbotPreTrainedModel:()=>Vt,BlenderbotSmallForConditionalGeneration:()=>Lr,BlenderbotSmallModel:()=>gs,BlenderbotSmallPreTrainedModel:()=>rs,BloomForCausalLM:()=>Eu,BloomModel:()=>Pu,BloomPreTrainedModel:()=>tl,CLIPModel:()=>Ln,CLIPPreTrainedModel:()=>Ws,CLIPSegForImageSegmentation:()=>Oo,CLIPSegModel:()=>Do,CLIPSegPreTrainedModel:()=>qa,CLIPTextModel:()=>Ui,CLIPTextModelWithProjection:()=>zn,CLIPVisionModel:()=>Gi,CLIPVisionModelWithProjection:()=>Bn,CamembertForMaskedLM:()=>Ye,CamembertForQuestionAnswering:()=>zt,CamembertForSequenceClassification:()=>vt,CamembertForTokenClassification:()=>yt,CamembertModel:()=>Ot,CamembertPreTrainedModel:()=>ht,CausalLMOutput:()=>ya,CausalLMOutputWithPast:()=>T0,ChineseCLIPModel:()=>Ha,ChineseCLIPPreTrainedModel:()=>Nn,ClapAudioModelWithProjection:()=>am,ClapModel:()=>rm,ClapPreTrainedModel:()=>Qn,ClapTextModelWithProjection:()=>sm,CodeGenForCausalLM:()=>Za,CodeGenModel:()=>va,CodeGenPreTrainedModel:()=>Ya,CohereForCausalLM:()=>nu,CohereModel:()=>ou,CoherePreTrainedModel:()=>Ki,ConvBertForMaskedLM:()=>Jr,ConvBertForQuestionAnswering:()=>G,ConvBertForSequenceClassification:()=>L,ConvBertForTokenClassification:()=>se,ConvBertModel:()=>ft,ConvBertPreTrainedModel:()=>ar,ConvNextForImageClassification:()=>Y_,ConvNextModel:()=>J_,ConvNextPreTrainedModel:()=>Cl,ConvNextV2ForImageClassification:()=>ep,ConvNextV2Model:()=>Z_,ConvNextV2PreTrainedModel:()=>Sl,DFineForObjectDetection:()=>g_,DFineModel:()=>f_,DFinePreTrainedModel:()=>wl,DPTForDepthEstimation:()=>A_,DPTModel:()=>$_,DPTPreTrainedModel:()=>Pl,DacDecoderModel:()=>Km,DacDecoderOutput:()=>Wm,DacEncoderModel:()=>Gm,DacEncoderOutput:()=>Vm,DacModel:()=>Um,DacPreTrainedModel:()=>ri,DebertaForMaskedLM:()=>br,DebertaForQuestionAnswering:()=>tr,DebertaForSequenceClassification:()=>hr,DebertaForTokenClassification:()=>Ir,DebertaModel:()=>er,DebertaPreTrainedModel:()=>It,DebertaV2ForMaskedLM:()=>Yr,DebertaV2ForQuestionAnswering:()=>Os,DebertaV2ForSequenceClassification:()=>vs,DebertaV2ForTokenClassification:()=>Ds,DebertaV2Model:()=>jr,DebertaV2PreTrainedModel:()=>kr,DecisionTransformerModel:()=>Pm,DecisionTransformerPreTrainedModel:()=>Tm,DeiTForImageClassification:()=>x_,DeiTModel:()=>v_,DeiTPreTrainedModel:()=>vl,DepthAnythingForDepthEstimation:()=>O_,DepthAnythingPreTrainedModel:()=>D_,DepthProForDepthEstimation:()=>N_,DepthProPreTrainedModel:()=>R_,DetrForObjectDetection:()=>n_,DetrForSegmentation:()=>ml,DetrModel:()=>o_,DetrObjectDetectionOutput:()=>hl,DetrPreTrainedModel:()=>Wn,DetrSegmentationOutput:()=>i_,Dinov2ForImageClassification:()=>rp,Dinov2Model:()=>tp,Dinov2PreTrainedModel:()=>Il,Dinov2WithRegistersForImageClassification:()=>ap,Dinov2WithRegistersModel:()=>sp,Dinov2WithRegistersPreTrainedModel:()=>Fl,DistilBertForMaskedLM:()=>Ae,DistilBertForQuestionAnswering:()=>qr,DistilBertForSequenceClassification:()=>Ls,DistilBertForTokenClassification:()=>Dr,DistilBertModel:()=>Wr,DistilBertPreTrainedModel:()=>Vr,DonutSwinModel:()=>X_,DonutSwinPreTrainedModel:()=>Q_,EfficientNetForImageClassification:()=>um,EfficientNetModel:()=>dm,EfficientNetPreTrainedModel:()=>jl,ElectraForMaskedLM:()=>je,ElectraForQuestionAnswering:()=>Xt,ElectraForSequenceClassification:()=>Se,ElectraForTokenClassification:()=>Dt,ElectraModel:()=>Me,ElectraPreTrainedModel:()=>te,EsmForMaskedLM:()=>or,EsmForSequenceClassification:()=>ps,EsmForTokenClassification:()=>Ur,EsmModel:()=>rt,EsmPreTrainedModel:()=>Ze,ExaoneForCausalLM:()=>z,ExaoneModel:()=>F,ExaonePreTrainedModel:()=>y,FalconForCausalLM:()=>tm,FalconModel:()=>em,FalconPreTrainedModel:()=>Bl,FastViTForImageClassification:()=>Ku,FastViTModel:()=>Gu,FastViTPreTrainedModel:()=>ll,Florence2ForConditionalGeneration:()=>Fn,Florence2PreTrainedModel:()=>Ys,GLPNForDepthEstimation:()=>q_,GLPNModel:()=>H_,GLPNPreTrainedModel:()=>kl,GPT2LMHeadModel:()=>Bo,GPT2Model:()=>zo,GPT2PreTrainedModel:()=>Lo,GPTBigCodeForCausalLM:()=>Wo,GPTBigCodeModel:()=>Vo,GPTBigCodePreTrainedModel:()=>ba,GPTJForCausalLM:()=>jo,GPTJModel:()=>No,GPTJPreTrainedModel:()=>Ja,GPTNeoForCausalLM:()=>Ma,GPTNeoModel:()=>Ro,GPTNeoPreTrainedModel:()=>Qa,GPTNeoXForCausalLM:()=>Xa,GPTNeoXModel:()=>wa,GPTNeoXPreTrainedModel:()=>ss,Gemma2ForCausalLM:()=>du,Gemma2Model:()=>cu,Gemma2PreTrainedModel:()=>qi,Gemma3ForCausalLM:()=>_u,Gemma3Model:()=>uu,Gemma3PreTrainedModel:()=>Qi,Gemma3nForConditionalGeneration:()=>ko,Gemma3nPreTrainedModel:()=>Dn,GemmaForCausalLM:()=>lu,GemmaModel:()=>iu,GemmaPreTrainedModel:()=>Hi,GlmForCausalLM:()=>p,GlmModel:()=>qo,GlmPreTrainedModel:()=>to,GraniteForCausalLM:()=>Vn,GraniteModel:()=>Gs,GranitePreTrainedModel:()=>yr,GroundingDinoForObjectDetection:()=>np,GroundingDinoPreTrainedModel:()=>op,GroupViTModel:()=>Uu,GroupViTPreTrainedModel:()=>Wu,HeliumForCausalLM:()=>Ho,HeliumModel:()=>Ko,HeliumPreTrainedModel:()=>eo,HieraForImageClassification:()=>T_,HieraModel:()=>y_,HieraPreTrainedModel:()=>xl,HubertForCTC:()=>Lp,HubertForSequenceClassification:()=>zp,HubertModel:()=>Op,HubertPreTrainedModel:()=>d0,IJepaForImageClassification:()=>Du,IJepaModel:()=>Au,IJepaPreTrainedModel:()=>ol,Idefics3ForConditionalGeneration:()=>ga,Idefics3PreTrainedModel:()=>Ka,ImageMattingOutput:()=>Zh,JAISLMHeadModel:()=>jn,JAISModel:()=>mt,JAISPreTrainedModel:()=>ta,JinaCLIPModel:()=>Fo,JinaCLIPPreTrainedModel:()=>ea,JinaCLIPTextModel:()=>$o,JinaCLIPVisionModel:()=>Ao,LiteWhisperForConditionalGeneration:()=>Sn,LlamaForCausalLM:()=>Go,LlamaModel:()=>Uo,LlamaPreTrainedModel:()=>xa,LlavaForConditionalGeneration:()=>Ga,LlavaOnevisionForConditionalGeneration:()=>To,LlavaPreTrainedModel:()=>yo,LlavaQwen2ForCausalLM:()=>An,LongT5ForConditionalGeneration:()=>Be,LongT5Model:()=>Ge,LongT5PreTrainedModel:()=>$e,M2M100ForConditionalGeneration:()=>fp,M2M100Model:()=>hp,M2M100PreTrainedModel:()=>Dl,MBartForCausalLM:()=>Cr,MBartForConditionalGeneration:()=>fs,MBartForSequenceClassification:()=>cr,MBartModel:()=>ls,MBartPreTrainedModel:()=>lr,MPNetForMaskedLM:()=>da,MPNetForQuestionAnswering:()=>pa,MPNetForSequenceClassification:()=>ua,MPNetForTokenClassification:()=>_a,MPNetModel:()=>js,MPNetPreTrainedModel:()=>gr,MT5ForConditionalGeneration:()=>Rt,MT5Model:()=>wt,MT5PreTrainedModel:()=>Je,MarianMTModel:()=>mp,MarianModel:()=>pp,MarianPreTrainedModel:()=>Al,MaskFormerForInstanceSegmentation:()=>K_,MaskFormerModel:()=>G_,MaskFormerPreTrainedModel:()=>El,MaskedLMOutput:()=>Br,Metric3DForDepthEstimation:()=>V_,Metric3DPreTrainedModel:()=>j_,Metric3Dv2ForDepthEstimation:()=>U_,Metric3Dv2PreTrainedModel:()=>W_,MgpstrForSceneTextRecognition:()=>Im,MgpstrModelOutput:()=>Cm,MgpstrPreTrainedModel:()=>Sm,MimiDecoderModel:()=>jm,MimiDecoderOutput:()=>Bm,MimiEncoderModel:()=>Nm,MimiEncoderOutput:()=>zm,MimiModel:()=>Rm,MimiPreTrainedModel:()=>ti,MistralForCausalLM:()=>Jp,MistralModel:()=>Xp,MistralPreTrainedModel:()=>Ll,MobileBertForMaskedLM:()=>Or,MobileBertForQuestionAnswering:()=>fr,MobileBertForSequenceClassification:()=>hs,MobileBertModel:()=>ms,MobileBertPreTrainedModel:()=>ts,MobileLLMForCausalLM:()=>ye,MobileLLMModel:()=>le,MobileLLMPreTrainedModel:()=>U,MobileNetV1ForImageClassification:()=>pm,MobileNetV1ForSemanticSegmentation:()=>mm,MobileNetV1Model:()=>_m,MobileNetV1PreTrainedModel:()=>Jn,MobileNetV2ForImageClassification:()=>fm,MobileNetV2ForSemanticSegmentation:()=>gm,MobileNetV2Model:()=>hm,MobileNetV2PreTrainedModel:()=>Yn,MobileNetV3ForImageClassification:()=>wm,MobileNetV3ForSemanticSegmentation:()=>bm,MobileNetV3Model:()=>Mm,MobileNetV3PreTrainedModel:()=>Zn,MobileNetV4ForImageClassification:()=>xm,MobileNetV4ForSemanticSegmentation:()=>ym,MobileNetV4Model:()=>vm,MobileNetV4PreTrainedModel:()=>ei,MobileViTForImageClassification:()=>Xu,MobileViTModel:()=>Qu,MobileViTPreTrainedModel:()=>cl,MobileViTV2ForImageClassification:()=>Yu,MobileViTV2Model:()=>Ju,MobileViTV2PreTrainedModel:()=>dl,ModelOutput:()=>fe,ModernBertForMaskedLM:()=>Re,ModernBertForSequenceClassification:()=>tt,ModernBertForTokenClassification:()=>Qe,ModernBertModel:()=>Ke,ModernBertPreTrainedModel:()=>qe,Moondream1ForConditionalGeneration:()=>Po,MoonshineForConditionalGeneration:()=>xo,MoonshineModel:()=>In,MoonshinePreTrainedModel:()=>vo,MptForCausalLM:()=>Cu,MptModel:()=>ku,MptPreTrainedModel:()=>rl,MultiModalityCausalLM:()=>km,MultiModalityPreTrainedModel:()=>Em,MusicgenForCausalLM:()=>m0,MusicgenForConditionalGeneration:()=>Wl,MusicgenModel:()=>p0,MusicgenPreTrainedModel:()=>Vl,NomicBertModel:()=>it,NomicBertPreTrainedModel:()=>at,OPTForCausalLM:()=>Iu,OPTModel:()=>Su,OPTPreTrainedModel:()=>sl,Olmo2ForCausalLM:()=>Jt,Olmo2Model:()=>Nt,Olmo2PreTrainedModel:()=>Tt,OlmoForCausalLM:()=>ot,OlmoModel:()=>Xe,OlmoPreTrainedModel:()=>Oe,OpenELMForCausalLM:()=>mu,OpenELMModel:()=>pu,OpenELMPreTrainedModel:()=>Xi,OwlViTForObjectDetection:()=>e_,OwlViTModel:()=>Zu,OwlViTPreTrainedModel:()=>ul,Owlv2ForObjectDetection:()=>r_,Owlv2Model:()=>t_,Owlv2PreTrainedModel:()=>_l,PaliGemmaForConditionalGeneration:()=>$n,PaliGemmaPreTrainedModel:()=>Eo,PatchTSMixerForPrediction:()=>Dm,PatchTSMixerModel:()=>Am,PatchTSMixerPreTrainedModel:()=>Gl,PatchTSTForPrediction:()=>$m,PatchTSTModel:()=>Fm,PatchTSTPreTrainedModel:()=>Ul,Phi3ForCausalLM:()=>Tu,Phi3Model:()=>yu,Phi3PreTrainedModel:()=>el,Phi3VForCausalLM:()=>So,Phi3VPreTrainedModel:()=>On,PhiForCausalLM:()=>xu,PhiModel:()=>vu,PhiPreTrainedModel:()=>Zi,PreTrainedModel:()=>j,PretrainedMixin:()=>Gt,PvtForImageClassification:()=>Bu,PvtModel:()=>zu,PvtPreTrainedModel:()=>nl,PyAnnoteForAudioFrameClassification:()=>xp,PyAnnoteModel:()=>vp,PyAnnotePreTrainedModel:()=>Ol,QuestionAnsweringModelOutput:()=>Qr,Qwen2ForCausalLM:()=>fu,Qwen2Model:()=>hu,Qwen2PreTrainedModel:()=>Ji,Qwen2VLForConditionalGeneration:()=>bu,Qwen2VLPreTrainedModel:()=>wu,Qwen3ForCausalLM:()=>Mu,Qwen3Model:()=>gu,Qwen3PreTrainedModel:()=>Yi,RFDetrForObjectDetection:()=>m_,RFDetrModel:()=>p_,RFDetrObjectDetectionOutput:()=>h_,RFDetrPreTrainedModel:()=>Ml,RTDetrForObjectDetection:()=>c_,RTDetrModel:()=>l_,RTDetrObjectDetectionOutput:()=>Qo,RTDetrPreTrainedModel:()=>fl,RTDetrV2ForObjectDetection:()=>u_,RTDetrV2Model:()=>d_,RTDetrV2ObjectDetectionOutput:()=>__,RTDetrV2PreTrainedModel:()=>gl,ResNetForImageClassification:()=>E_,ResNetModel:()=>P_,ResNetPreTrainedModel:()=>yl,RoFormerForMaskedLM:()=>_t,RoFormerForQuestionAnswering:()=>Bt,RoFormerForSequenceClassification:()=>Et,RoFormerForTokenClassification:()=>At,RoFormerModel:()=>et,RoFormerPreTrainedModel:()=>Ne,RobertaForMaskedLM:()=>_r,RobertaForQuestionAnswering:()=>Zr,RobertaForSequenceClassification:()=>Mr,RobertaForTokenClassification:()=>ur,RobertaModel:()=>Sr,RobertaPreTrainedModel:()=>zr,SamImageSegmentationOutput:()=>_p,SamModel:()=>up,SamPreTrainedModel:()=>dp,SapiensForDepthEstimation:()=>z_,SapiensForNormalEstimation:()=>B_,SapiensForSemanticSegmentation:()=>L_,SapiensPreTrainedModel:()=>Gn,SegformerForImageClassification:()=>nm,SegformerForSemanticSegmentation:()=>im,SegformerModel:()=>_0,SegformerPreTrainedModel:()=>Xn,Seq2SeqLMOutput:()=>y0,SequenceClassifierOutput:()=>kt,SiglipModel:()=>Us,SiglipPreTrainedModel:()=>Zs,SiglipTextModel:()=>Io,SiglipVisionModel:()=>Rn,SmolVLMForConditionalGeneration:()=>Co,SnacDecoderModel:()=>Qm,SnacEncoderModel:()=>qm,SnacModel:()=>Hm,SnacPreTrainedModel:()=>si,SpeechT5ForSpeechToText:()=>Gp,SpeechT5ForTextToSpeech:()=>Kp,SpeechT5HifiGan:()=>Hp,SpeechT5Model:()=>u0,SpeechT5PreTrainedModel:()=>qn,SqueezeBertForMaskedLM:()=>ha,SqueezeBertForQuestionAnswering:()=>fa,SqueezeBertForSequenceClassification:()=>Xs,SqueezeBertModel:()=>ma,SqueezeBertPreTrainedModel:()=>zs,StableLmForCausalLM:()=>cm,StableLmModel:()=>lm,StableLmPreTrainedModel:()=>Nl,Starcoder2ForCausalLM:()=>Zp,Starcoder2Model:()=>Yp,Starcoder2PreTrainedModel:()=>zl,StyleTextToSpeech2Model:()=>Up,StyleTextToSpeech2PreTrainedModel:()=>Wp,Swin2SRForImageSuperResolution:()=>F_,Swin2SRModel:()=>I_,Swin2SRPreTrainedModel:()=>Tl,SwinForImageClassification:()=>C_,SwinForSemanticSegmentation:()=>S_,SwinModel:()=>k_,SwinPreTrainedModel:()=>Un,T5ForConditionalGeneration:()=>be,T5Model:()=>de,T5PreTrainedModel:()=>ne,TableTransformerForObjectDetection:()=>w_,TableTransformerModel:()=>M_,TableTransformerObjectDetectionOutput:()=>b_,TableTransformerPreTrainedModel:()=>bl,TokenClassifierOutput:()=>$r,TrOCRForCausalLM:()=>Qp,TrOCRPreTrainedModel:()=>qp,UltravoxModel:()=>Lm,UltravoxPreTrainedModel:()=>Om,UniSpeechForCTC:()=>Ep,UniSpeechForSequenceClassification:()=>kp,UniSpeechModel:()=>Pp,UniSpeechPreTrainedModel:()=>Kn,UniSpeechSatForAudioFrameClassification:()=>Fp,UniSpeechSatForCTC:()=>Sp,UniSpeechSatForSequenceClassification:()=>Ip,UniSpeechSatModel:()=>Cp,UniSpeechSatPreTrainedModel:()=>Xo,ViTForImageClassification:()=>$u,ViTMAEModel:()=>Nu,ViTMAEPreTrainedModel:()=>Ru,ViTMSNForImageClassification:()=>Vu,ViTMSNModel:()=>ju,ViTMSNPreTrainedModel:()=>il,ViTModel:()=>Fu,ViTPreTrainedModel:()=>al,VisionEncoderDecoderModel:()=>Ua,VitMatteForImageMatting:()=>qu,VitMattePreTrainedModel:()=>Hu,VitPoseForPoseEstimation:()=>Lu,VitPosePreTrainedModel:()=>Ou,VitsModel:()=>Rl,VitsModelOutput:()=>ef,VitsPreTrainedModel:()=>om,Wav2Vec2BertForCTC:()=>Ap,Wav2Vec2BertForSequenceClassification:()=>Dp,Wav2Vec2BertModel:()=>$p,Wav2Vec2BertPreTrainedModel:()=>Hn,Wav2Vec2ForAudioFrameClassification:()=>bp,Wav2Vec2ForCTC:()=>Mp,Wav2Vec2ForSequenceClassification:()=>wp,Wav2Vec2Model:()=>gp,Wav2Vec2PreTrainedModel:()=>ra,WavLMForAudioFrameClassification:()=>Vp,WavLMForCTC:()=>Rp,WavLMForSequenceClassification:()=>Np,WavLMForXVector:()=>jp,WavLMModel:()=>Bp,WavLMPreTrainedModel:()=>ro,WeSpeakerResNetModel:()=>Tp,WeSpeakerResNetPreTrainedModel:()=>yp,WhisperForConditionalGeneration:()=>bo,WhisperModel:()=>Cn,WhisperPreTrainedModel:()=>wo,XLMForQuestionAnswering:()=>vn,XLMForSequenceClassification:()=>fo,XLMForTokenClassification:()=>bn,XLMModel:()=>Vs,XLMPreTrainedModel:()=>Ms,XLMRobertaForMaskedLM:()=>xn,XLMRobertaForQuestionAnswering:()=>Pn,XLMRobertaForSequenceClassification:()=>yn,XLMRobertaForTokenClassification:()=>Tn,XLMRobertaModel:()=>go,XLMRobertaPreTrainedModel:()=>Js,XLMWithLMHeadModel:()=>wn,XVectorOutput:()=>Yh,YolosForObjectDetection:()=>lp,YolosModel:()=>ip,YolosObjectDetectionOutput:()=>cp,YolosPreTrainedModel:()=>$l});var s=t("./src/configs.js"),o=t("./src/backends/onnx.js"),a=t("./src/utils/dtypes.js"),n=t("./src/utils/generic.js"),i=t("./src/utils/core.js"),l=t("./src/utils/hub.js"),c=t("./src/utils/constants.js"),_=t("./src/generation/logits_process.js"),d=t("./src/generation/configuration_utils.js"),u=t("./src/utils/tensor.js"),f=t("./src/utils/image.js"),h=t("./src/utils/maths.js"),v=t("./src/generation/stopping_criteria.js"),E=t("./src/generation/logits_sampler.js"),M=t("./src/env.js"),w=t("./src/models/whisper/generation_whisper.js"),C=t("./src/models/whisper/common_whisper.js");let x={EncoderOnly:0,EncoderDecoder:1,Seq2Seq:2,Vision2Seq:3,DecoderOnly:4,MaskGeneration:5,ImageTextToText:6,Musicgen:7,MultiModality:8,Phi3V:9,AudioTextToText:10,AutoEncoder:11,ImageAudioTextToText:12},T=new Map,S=new Map,g=new Map;async function P(b,k,O){var Pr,sa,Rr,as,aa,Ks,ao,Gr,xs,Ta,Pa,oo,Yt;let Q=(sa=(Pr=O.config)==null?void 0:Pr["transformers.js_config"])!=null?sa:{},pe=(Rr=O.device)!=null?Rr:Q.device;pe&&typeof pe!="string"&&(pe.hasOwnProperty(k)?pe=pe[k]:(console.warn(`device not specified for "${k}". Using the default device.`),pe=null));let _e=pe!=null?pe:M.apis.IS_NODE_ENV?"cpu":"wasm",Te=(0,o.deviceToExecutionProviders)(_e),Le=(as=Q.device_config)!=null?as:{};Le.hasOwnProperty(_e)&&(Q=Fe(Fe({},Q),Le[_e]));let De=(aa=O.dtype)!=null?aa:Q.dtype;if(typeof De!="string"&&(De&&De.hasOwnProperty(k)?De=De[k]:(De=(Ks=a.DEFAULT_DEVICE_DTYPE_MAPPING[_e])!=null?Ks:a.DATA_TYPES.fp32,console.warn(`dtype not specified for "${k}". Using the default dtype (${De}) for this device (${_e}).`))),De===a.DATA_TYPES.auto){let Ft=Q.dtype;typeof Ft!="string"&&(Ft=Ft==null?void 0:Ft[k]),Ft&&Ft!==a.DATA_TYPES.auto&&a.DATA_TYPES.hasOwnProperty(Ft)?De=Ft:De=(ao=a.DEFAULT_DEVICE_DTYPE_MAPPING[_e])!=null?ao:a.DATA_TYPES.fp32}let st=De;if(a.DEFAULT_DTYPE_SUFFIX_MAPPING.hasOwnProperty(st)){if(st===a.DATA_TYPES.fp16&&_e==="webgpu"&&!await(0,a.isWebGpuFp16Supported)())throw new Error(`The device (${_e}) does not support fp16.`)}else throw new Error(`Invalid dtype: ${st}. Should be one of: ${Object.keys(a.DATA_TYPES).join(", ")}`);let dt=Q.kv_cache_dtype,gt=dt?typeof dt=="string"?dt:(Gr=dt[st])!=null?Gr:"float32":void 0;if(gt&&!["float32","float16"].includes(gt))throw new Error(`Invalid kv_cache_dtype: ${gt}. Should be one of: float32, float16`);let Mt={dtype:st,kv_cache_dtype:gt,device:_e},Lt=a.DEFAULT_DTYPE_SUFFIX_MAPPING[st],lt=`${k}${Lt}.onnx`,Pt=`${(xs=O.subfolder)!=null?xs:""}/${lt}`,ut=Fe({},O.session_options);(Ta=ut.executionProviders)!=null||(ut.executionProviders=Te);let xt=Q.free_dimension_overrides;xt?(Pa=ut.freeDimensionOverrides)!=null||(ut.freeDimensionOverrides=xt):_e.startsWith("webnn")&&!ut.freeDimensionOverrides&&console.warn(`WebNN does not currently support dynamic shapes and requires \'free_dimension_overrides\' to be set in config.json, preferably as a field within config["transformers.js_config"]["device_config"]["${_e}"]. When \'free_dimension_overrides\' is not set, you may experience significant performance degradation.`);let wr=M.apis.IS_NODE_ENV&&M.env.useFSCache,Tr=(0,l.getModelFile)(b,Pt,!0,O,wr),Wt=(oo=O.use_external_data_format)!=null?oo:Q.use_external_data_format,dr=[];if(Wt){let Ft;typeof Wt=="object"?Wt.hasOwnProperty(lt)?Ft=Wt[lt]:Wt.hasOwnProperty(k)?Ft=Wt[k]:Ft=!1:Ft=Wt;let Kr=+Ft;if(Kr>l.MAX_EXTERNAL_DATA_CHUNKS)throw new Error(`The number of external data chunks (${Kr}) exceeds the maximum allowed value (${l.MAX_EXTERNAL_DATA_CHUNKS}).`);for(let os=0;os<Kr;++os){let Rs=`${lt}_data${os===0?"":"_"+os}`,no=`${(Yt=O.subfolder)!=null?Yt:""}/${Rs}`;dr.push(new Promise(async(Jo,ai)=>{let io=await(0,l.getModelFile)(b,no,!0,O,wr);Jo(io instanceof Uint8Array?{path:Rs,data:io}:Rs)}))}}else ut.externalData!==void 0&&(dr=ut.externalData.map(async Ft=>{if(typeof Ft.data=="string"){let Kr=await(0,l.getModelFile)(b,Ft.data,!0,O);return Ct(Fe({},Ft),{data:Kr})}return Ft}));if(dr.length>0){let Ft=await Promise.all(dr);M.apis.IS_NODE_ENV||(ut.externalData=Ft)}if(_e==="webgpu"){let Ft=(0,s.getKeyValueShapes)(O.config,{prefix:"present"});if(Object.keys(Ft).length>0&&!(0,o.isONNXProxy)()){let Kr={};for(let os in Ft)Kr[os]="gpu-buffer";ut.preferredOutputLocation=Kr}}return{buffer_or_path:await Tr,session_options:ut,session_config:Mt}}async function $(b,k,O){return Object.fromEntries(await Promise.all(Object.keys(k).map(async Q=>{let{buffer_or_path:pe,session_options:_e,session_config:Te}=await P(b,k[Q],O),Le=await(0,o.createInferenceSession)(pe,_e,Te);return[Q,Le]})))}async function A(b,k,O){return Object.fromEntries(await Promise.all(Object.keys(k).map(async Q=>{let pe=await(0,l.getModelJSON)(b,k[Q],!1,O);return[Q,pe]})))}function N(b,k){let O=Object.create(null),Q=[];for(let Te of b.inputNames){let Le=k[Te];if(!(Le instanceof u.Tensor)){Q.push(Te);continue}O[Te]=(0,o.isONNXProxy)()?Le.clone():Le}if(Q.length>0)throw new Error(`An error occurred during model execution: "Missing the following inputs: ${Q.join(", ")}.`);let pe=Object.keys(k).length,_e=b.inputNames.length;if(pe>_e){let Te=Object.keys(k).filter(Le=>!b.inputNames.includes(Le));console.warn(`WARNING: Too many inputs were provided (${pe} > ${_e}). The following inputs will be ignored: "${Te.join(", ")}".`)}return O}let W=Promise.resolve();async function R(b,k){let O=N(b,k);try{let Q=Object.fromEntries(Object.entries(O).map(([Te,Le])=>[Te,Le.ort_tensor])),pe=()=>b.run(Q),_e=await(M.apis.IS_BROWSER_ENV||M.apis.IS_WEBWORKER_ENV?W=W.then(pe):pe());return J(_e)}catch(Q){let pe=Object.fromEntries(Object.entries(O).map(([_e,Te])=>{let Le={type:Te.type,dims:Te.dims,location:Te.location};return Le.location!=="gpu-buffer"&&(Le.data=Te.data),[_e,Le]}));throw console.error(`An error occurred during model execution: "${Q}".`),console.error("Inputs given to model:",pe),Q}}function J(b){for(let k in b)(0,o.isONNXTensor)(b[k])?b[k]=new u.Tensor(b[k]):typeof b[k]=="object"&&J(b[k]);return b}function H(b){if(b instanceof u.Tensor)return b;if(b.length===0)throw Error("items must be non-empty");if(Array.isArray(b[0])){if(b.some(k=>k.length!==b[0].length))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with \'padding=True\' and/or \'truncation=True\' to have batched tensors with the same length.");return new u.Tensor("int64",BigInt64Array.from(b.flat().map(k=>BigInt(k))),[b.length,b[0].length])}else return new u.Tensor("int64",BigInt64Array.from(b.map(k=>BigInt(k))),[1,b.length])}function q(b){return new u.Tensor("bool",[b],[1])}async function X(b,k){let Le=k,{encoder_outputs:O,input_ids:Q,decoder_input_ids:pe}=Le,_e=ns(Le,["encoder_outputs","input_ids","decoder_input_ids"]);if(!O){let De=(0,i.pick)(k,b.sessions.model.inputNames);O=(await ae(b,De)).last_hidden_state}return _e.input_ids=pe,_e.encoder_hidden_states=O,b.sessions.decoder_model_merged.inputNames.includes("encoder_attention_mask")&&(_e.encoder_attention_mask=k.attention_mask),await he(b,_e,!0)}async function ae(b,k){let O=b.sessions.model,Q=(0,i.pick)(k,O.inputNames);if(O.inputNames.includes("inputs_embeds")&&!Q.inputs_embeds){if(!k.input_ids)throw new Error("Both `input_ids` and `inputs_embeds` are missing in the model inputs.");Q.inputs_embeds=await b.encode_text({input_ids:k.input_ids})}if(O.inputNames.includes("token_type_ids")&&!Q.token_type_ids){if(!Q.input_ids)throw new Error("Both `input_ids` and `token_type_ids` are missing in the model inputs.");Q.token_type_ids=(0,u.zeros_like)(Q.input_ids)}if(O.inputNames.includes("pixel_mask")&&!Q.pixel_mask){if(!Q.pixel_values)throw new Error("Both `pixel_values` and `pixel_mask` are missing in the model inputs.");let pe=Q.pixel_values.dims;Q.pixel_mask=(0,u.ones)([pe[0],pe[2],pe[3]])}return await R(O,Q)}async function ce(b,k){let O=await b.encode(k);return await b.decode(O)}async function he(b,k,O=!1){let Q=b.sessions[O?"decoder_model_merged":"model"],Le=k,{past_key_values:pe}=Le,_e=ns(Le,["past_key_values"]);if(Q.inputNames.includes("use_cache_branch")&&(_e.use_cache_branch=q(!!pe)),Q.inputNames.includes("position_ids")&&_e.attention_mask&&!_e.position_ids){let De=["paligemma","gemma3_text","gemma3"].includes(b.config.model_type)?1:0;_e.position_ids=ze(_e,pe,De)}b.addPastKeyValues(_e,pe);let Te=(0,i.pick)(_e,Q.inputNames);return await R(Q,Te)}function B({modality_token_id:b,inputs_embeds:k,modality_features:O,input_ids:Q,attention_mask:pe}){let _e=Q.tolist().map(st=>st.reduce((dt,gt,Mt)=>(gt==b&&dt.push(Mt),dt),[])),Te=_e.reduce((st,dt)=>st+dt.length,0),Le=O.dims[0];if(Te!==Le)throw new Error(`Number of tokens and features do not match: tokens: ${Te}, features ${Le}`);let De=0;for(let st=0;st<_e.length;++st){let dt=_e[st],gt=k[st];for(let Mt=0;Mt<dt.length;++Mt)gt[dt[Mt]].data.set(O[De++].data)}return{inputs_embeds:k,attention_mask:pe}}function D({image_token_id:b,inputs_embeds:k,image_features:O,input_ids:Q,attention_mask:pe}){return B({modality_token_id:b,inputs_embeds:k,modality_features:O,input_ids:Q,attention_mask:pe})}function K({audio_token_id:b,inputs_embeds:k,audio_features:O,input_ids:Q,attention_mask:pe}){return B({modality_token_id:b,inputs_embeds:k,modality_features:O,input_ids:Q,attention_mask:pe})}async function re(b,Lt){var lt=Lt,{encode_function:k,merge_function:O,modality_input_name:Q,modality_output_name:pe,input_ids:_e=null,attention_mask:Te=null,position_ids:Le=null,inputs_embeds:De=null,past_key_values:st=null,generation_config:dt=null,logits_processor:gt=null}=lt,Mt=ns(lt,["encode_function","merge_function","modality_input_name","modality_output_name","input_ids","attention_mask","position_ids","inputs_embeds","past_key_values","generation_config","logits_processor"]);let Pt=Mt[Q];if(!De){if(De=await b.encode_text(Fe({input_ids:_e},Mt)),Pt&&_e.dims[1]!==1){let xt=await k(Fe({[Q]:Pt},Mt));({inputs_embeds:De,attention_mask:Te}=O({[pe]:xt,inputs_embeds:De,input_ids:_e,attention_mask:Te}))}else if(st&&Pt&&_e.dims[1]===1){let xt=_e.dims[1],wr=Object.values(st)[0].dims.at(-2);Te=(0,u.cat)([(0,u.ones)([_e.dims[0],wr]),Te.slice(null,[Te.dims[1]-xt,Te.dims[1]])],1)}}if(!Le&&b.config.model_type==="qwen2_vl"){let{image_grid_thw:xt,video_grid_thw:wr}=Mt;[Le]=b.get_rope_index(_e,xt,wr,Te)}return await he(b,{inputs_embeds:De,past_key_values:st,attention_mask:Te,position_ids:Le,generation_config:dt,logits_processor:gt},!0)}async function me(b,k){return await re(b,Ct(Fe({},k),{modality_input_name:"audio_values",modality_output_name:"audio_features",encode_function:b.encode_audio.bind(b),merge_function:b._merge_input_ids_with_audio_features.bind(b)}))}async function oe(b,k){return await re(b,Ct(Fe({},k),{modality_input_name:"pixel_values",modality_output_name:"image_features",encode_function:b.encode_image.bind(b),merge_function:b._merge_input_ids_with_image_features.bind(b)}))}function ge(b,k=0){let[O,Q]=b.dims,pe=b.data,_e=new BigInt64Array(pe.length);for(let Te=0;Te<O;++Te){let Le=Te*Q,De=BigInt(k);for(let st=0;st<Q;++st){let dt=Le+st;pe[dt]===BigInt(0)?_e[dt]=BigInt(1):(_e[dt]=De,De+=pe[dt])}}return{data:_e,dims:b.dims}}function ze(b,k=null,O=0){let{input_ids:Q,inputs_embeds:pe,attention_mask:_e}=b,{data:Te,dims:Le}=ge(_e,O),De=new u.Tensor("int64",Te,Le);if(k){let st=-(Q!=null?Q:pe).dims.at(1);De=De.slice(null,[st,null])}return De}function We(b,k,O,Q){let pe=O.past_key_values?Object.values(O.past_key_values)[0].dims.at(-2):0;if(!O.attention_mask){let _e;for(let Te of["input_ids","inputs_embeds","position_ids"])if(O[Te]){_e=O[Te].dims;break}if(!_e)throw new Error("attention_mask is not provided, and unable to infer its shape from model inputs.");O.attention_mask=(0,u.ones)([_e[0],pe+_e[1]])}if(O.past_key_values){let{input_ids:_e,attention_mask:Te}=O;Te&&Te.dims[1]>_e.dims[1]||pe<_e.dims[1]&&(O.input_ids=_e.slice(null,[pe,null]))}return O}function Ce(b,k,O,Q){return O.past_key_values&&(k=k.map(pe=>[pe.at(-1)])),Ct(Fe({},O),{decoder_input_ids:H(k)})}function ie(b,...k){return b.config.is_encoder_decoder?Ce(b,...k):We(b,...k)}function Y(b,k,O,Q){let pe=!!O.past_key_values;return Q.guidance_scale!==null&&Q.guidance_scale>1&&(pe?O.input_ids=(0,u.cat)([O.input_ids,O.input_ids],0):(O.input_ids=(0,u.cat)([O.input_ids,(0,u.full_like)(O.input_ids,BigInt(Q.pad_token_id))],0),O.attention_mask=(0,u.cat)([O.attention_mask,(0,u.full_like)(O.attention_mask,BigInt(0))],0))),(pe||!O.pixel_values)&&(O.pixel_values=(0,u.full)([0,0,3,384,384],1)),pe&&(O.images_seq_mask=new u.Tensor("bool",new Array(1).fill(!0).fill(!1,0,1),[1,1]),O.images_emb_mask=new u.Tensor("bool",new Array(0).fill(!1),[1,1,0])),O}class j extends n.Callable{constructor(O,Q,pe){var Le;super();ee(this,"main_input_name","input_ids");ee(this,"forward_params",["input_ids","attention_mask"]);this.config=O,this.sessions=Q,this.configs=pe;let _e=g.get(this.constructor),Te=T.get(_e);switch(this.can_generate=!1,this._forward=null,this._prepare_inputs_for_generation=null,Te){case x.DecoderOnly:this.can_generate=!0,this._forward=he,this._prepare_inputs_for_generation=We;break;case x.Seq2Seq:case x.Vision2Seq:case x.Musicgen:this.can_generate=!0,this._forward=X,this._prepare_inputs_for_generation=Ce;break;case x.EncoderDecoder:this._forward=X;break;case x.ImageTextToText:this.can_generate=!0,this._forward=oe,this._prepare_inputs_for_generation=ie;break;case x.AudioTextToText:this.can_generate=!0,this._forward=me,this._prepare_inputs_for_generation=ie;break;case x.Phi3V:case x.ImageAudioTextToText:this.can_generate=!0,this._prepare_inputs_for_generation=ie;break;case x.MultiModality:this.can_generate=!0,this._prepare_inputs_for_generation=Y;break;case x.AutoEncoder:this._forward=ce;break;default:this._forward=ae;break}this.can_generate&&this.forward_params.push("past_key_values"),this.custom_config=(Le=this.config["transformers.js_config"])!=null?Le:{}}async dispose(){var Q;let O=[];for(let pe of Object.values(this.sessions))(Q=pe==null?void 0:pe.handler)!=null&&Q.dispose&&O.push(pe.handler.dispose());return await Promise.all(O)}static async from_pretrained(O,{progress_callback:Q=null,config:pe=null,cache_dir:_e=null,local_files_only:Te=!1,revision:Le="main",model_file_name:De=null,subfolder:st="onnx",device:dt=null,dtype:gt=null,use_external_data_format:Mt=null,session_options:Lt={}}={}){var wr,Tr;let lt={progress_callback:Q,config:pe,cache_dir:_e,local_files_only:Te,revision:Le,model_file_name:De,subfolder:st,device:dt,dtype:gt,use_external_data_format:Mt,session_options:Lt},Pt=g.get(this),ut=T.get(Pt);pe=lt.config=await s.AutoConfig.from_pretrained(O,lt);let xt;if(ut===x.DecoderOnly)xt=await Promise.all([$(O,{model:(wr=lt.model_file_name)!=null?wr:"model"},lt),A(O,{generation_config:"generation_config.json"},lt)]);else if(ut===x.Seq2Seq||ut===x.Vision2Seq)xt=await Promise.all([$(O,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},lt),A(O,{generation_config:"generation_config.json"},lt)]);else if(ut===x.MaskGeneration)xt=await Promise.all([$(O,{model:"vision_encoder",prompt_encoder_mask_decoder:"prompt_encoder_mask_decoder"},lt)]);else if(ut===x.EncoderDecoder)xt=await Promise.all([$(O,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},lt)]);else if(ut===x.ImageTextToText){let Wt={embed_tokens:"embed_tokens",vision_encoder:"vision_encoder",decoder_model_merged:"decoder_model_merged"};pe.is_encoder_decoder&&(Wt.model="encoder_model"),xt=await Promise.all([$(O,Wt,lt),A(O,{generation_config:"generation_config.json"},lt)])}else if(ut===x.AudioTextToText){let Wt={embed_tokens:"embed_tokens",audio_encoder:"audio_encoder",decoder_model_merged:"decoder_model_merged"};xt=await Promise.all([$(O,Wt,lt),A(O,{generation_config:"generation_config.json"},lt)])}else if(ut===x.ImageAudioTextToText){let Wt={embed_tokens:"embed_tokens",audio_encoder:"audio_encoder",vision_encoder:"vision_encoder",decoder_model_merged:"decoder_model_merged"};xt=await Promise.all([$(O,Wt,lt),A(O,{generation_config:"generation_config.json"},lt)])}else if(ut===x.Musicgen)xt=await Promise.all([$(O,{model:"text_encoder",decoder_model_merged:"decoder_model_merged",encodec_decode:"encodec_decode"},lt),A(O,{generation_config:"generation_config.json"},lt)]);else if(ut===x.MultiModality)xt=await Promise.all([$(O,{prepare_inputs_embeds:"prepare_inputs_embeds",model:"language_model",lm_head:"lm_head",gen_head:"gen_head",gen_img_embeds:"gen_img_embeds",image_decode:"image_decode"},lt),A(O,{generation_config:"generation_config.json"},lt)]);else if(ut===x.Phi3V)xt=await Promise.all([$(O,{prepare_inputs_embeds:"prepare_inputs_embeds",model:"model",vision_encoder:"vision_encoder"},lt),A(O,{generation_config:"generation_config.json"},lt)]);else if(ut===x.AutoEncoder)xt=await Promise.all([$(O,{encoder_model:"encoder_model",decoder_model:"decoder_model"},lt)]);else{if(ut!==x.EncoderOnly){let Wt=Pt!=null?Pt:pe==null?void 0:pe.model_type;Wt!=="custom"&&console.warn(`Model type for \'${Wt}\' not found, assuming encoder-only architecture. Please report this at ${c.GITHUB_ISSUE_URL}.`)}xt=await Promise.all([$(O,{model:(Tr=lt.model_file_name)!=null?Tr:"model"},lt)])}return new this(pe,...xt)}async _call(O){return await this.forward(O)}async forward(O){return await this._forward(this,O)}get generation_config(){var O,Q;return(Q=(O=this.configs)==null?void 0:O.generation_config)!=null?Q:null}_get_logits_warper(O){let Q=new _.LogitsProcessorList;return O.temperature!==null&&O.temperature!==1&&Q.push(new _.TemperatureLogitsWarper(O.temperature)),O.top_k!==null&&O.top_k!==0&&Q.push(new _.TopKLogitsWarper(O.top_k)),O.top_p!==null&&O.top_p<1&&Q.push(new _.TopPLogitsWarper(O.top_p)),Q}_get_logits_processor(O,Q,pe=null){let _e=new _.LogitsProcessorList;if(O.repetition_penalty!==null&&O.repetition_penalty!==1&&_e.push(new _.RepetitionPenaltyLogitsProcessor(O.repetition_penalty)),O.no_repeat_ngram_size!==null&&O.no_repeat_ngram_size>0&&_e.push(new _.NoRepeatNGramLogitsProcessor(O.no_repeat_ngram_size)),O.bad_words_ids!==null&&_e.push(new _.NoBadWordsLogitsProcessor(O.bad_words_ids,O.eos_token_id)),O.min_length!==null&&O.eos_token_id!==null&&O.min_length>0&&_e.push(new _.MinLengthLogitsProcessor(O.min_length,O.eos_token_id)),O.min_new_tokens!==null&&O.eos_token_id!==null&&O.min_new_tokens>0&&_e.push(new _.MinNewTokensLengthLogitsProcessor(Q,O.min_new_tokens,O.eos_token_id)),O.forced_bos_token_id!==null&&_e.push(new _.ForcedBOSTokenLogitsProcessor(O.forced_bos_token_id)),O.forced_eos_token_id!==null&&_e.push(new _.ForcedEOSTokenLogitsProcessor(O.max_length,O.forced_eos_token_id)),O.begin_suppress_tokens!==null){let Te=Q>1||O.forced_bos_token_id===null?Q:Q+1;_e.push(new _.SuppressTokensAtBeginLogitsProcessor(O.begin_suppress_tokens,Te))}return O.guidance_scale!==null&&O.guidance_scale>1&&_e.push(new _.ClassifierFreeGuidanceLogitsProcessor(O.guidance_scale)),pe!==null&&_e.extend(pe),_e}_prepare_generation_config(O,Q,pe=d.GenerationConfig){var Le;let _e=Fe({},this.config);for(let De of["decoder","generator","text_config"])De in _e&&Object.assign(_e,_e[De]);let Te=new pe(_e);return Object.assign(Te,(Le=this.generation_config)!=null?Le:{}),O&&Object.assign(Te,O),Q&&Object.assign(Te,(0,i.pick)(Q,Object.getOwnPropertyNames(Te))),Te}_get_stopping_criteria(O,Q=null){var _e;let pe=new v.StoppingCriteriaList;return O.max_length!==null&&pe.push(new v.MaxLengthCriteria(O.max_length,(_e=this.config.max_position_embeddings)!=null?_e:null)),O.eos_token_id!==null&&pe.push(new v.EosTokenCriteria(O.eos_token_id)),Q&&pe.extend(Q),pe}_validate_model_class(){if(!this.can_generate){let O=[ql,Ql,Hl,Kl],Q=g.get(this.constructor),pe=new Set,_e=this.config.model_type;for(let Le of O){let De=Le.get(_e);De&&pe.add(De[0])}let Te=`The current model class (${Q}) is not compatible with \\`.generate()\\`, as it doesn\'t have a language model head.`;throw pe.size>0&&(Te+=` Please use the following class instead: ${[...pe].join(", ")}`),Error(Te)}}prepare_inputs_for_generation(...O){return this._prepare_inputs_for_generation(this,...O)}_update_model_kwargs_for_generation({generated_input_ids:O,outputs:Q,model_inputs:pe,is_encoder_decoder:_e}){return pe.past_key_values=this.getPastKeyValues(Q,pe.past_key_values),pe.input_ids=new u.Tensor("int64",O.flat(),[O.length,1]),_e?"decoder_attention_mask"in pe:pe.attention_mask=(0,u.cat)([pe.attention_mask,(0,u.ones)([pe.attention_mask.dims[0],1])],1),pe.position_ids=null,pe}_prepare_model_inputs({inputs:O,bos_token_id:Q,model_kwargs:pe}){let _e=(0,i.pick)(pe,this.forward_params),Te=this.main_input_name;if(Te in _e){if(O)throw new Error("`inputs`: {inputs}` were passed alongside {input_name} which is not allowed. Make sure to either pass {inputs} or {input_name}=...")}else _e[Te]=O;return{inputs_tensor:_e[Te],model_inputs:_e,model_input_name:Te}}async _prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:O,model_inputs:Q,model_input_name:pe,generation_config:_e}){if(this.sessions.model.inputNames.includes("inputs_embeds")&&!Q.inputs_embeds&&"_prepare_inputs_embeds"in this){let Le=Q,{input_ids:De,pixel_values:st,attention_mask:dt}=Le,gt=ns(Le,["input_ids","pixel_values","attention_mask"]),Mt=await this._prepare_inputs_embeds(Q);Q=Fe(Fe({},gt),(0,i.pick)(Mt,["inputs_embeds","attention_mask"]))}let{last_hidden_state:Te}=await ae(this,Q);if(_e.guidance_scale!==null&&_e.guidance_scale>1)Te=(0,u.cat)([Te,(0,u.full_like)(Te,0)],0),"attention_mask"in Q&&(Q.attention_mask=(0,u.cat)([Q.attention_mask,(0,u.zeros_like)(Q.attention_mask)],0));else if(Q.decoder_input_ids){let De=H(Q.decoder_input_ids).dims[0];if(De!==Te.dims[0]){if(Te.dims[0]!==1)throw new Error(`The encoder outputs have a different batch size (${Te.dims[0]}) than the decoder inputs (${De}).`);Te=(0,u.cat)(Array.from({length:De},()=>Te),0)}}return Q.encoder_outputs=Te,Q}_prepare_decoder_input_ids_for_generation({batch_size:O,model_input_name:Q,model_kwargs:pe,decoder_start_token_id:_e,bos_token_id:Te,generation_config:Le}){let dt=pe,{decoder_input_ids:De}=dt,st=ns(dt,["decoder_input_ids"]);if(!(De instanceof u.Tensor)){if(De)Array.isArray(De[0])||(De=Array.from({length:O},()=>De));else if(_e!=null||(_e=Te),this.config.model_type==="musicgen")De=Array.from({length:O*this.config.decoder.num_codebooks},()=>[_e]);else if(Array.isArray(_e)){if(_e.length!==O)throw new Error(`\\`decoder_start_token_id\\` expcted to have length ${O} but got ${_e.length}`);De=_e}else De=Array.from({length:O},()=>[_e]);De=H(De)}return pe.decoder_attention_mask=(0,u.ones_like)(De),{input_ids:De,model_inputs:st}}async generate(De){var st=De,{inputs:O=null,generation_config:Q=null,logits_processor:pe=null,stopping_criteria:_e=null,streamer:Te=null}=st,Le=ns(st,["inputs","generation_config","logits_processor","stopping_criteria","streamer"]);this._validate_model_class(),Q=this._prepare_generation_config(Q,Le);let{inputs_tensor:dt,model_inputs:gt,model_input_name:Mt}=this._prepare_model_inputs({inputs:O,model_kwargs:Le}),Lt=this.config.is_encoder_decoder;Lt&&("encoder_outputs"in gt||(gt=await this._prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:dt,model_inputs:gt,model_input_name:Mt,generation_config:Q})));let lt;Lt?{input_ids:lt,model_inputs:gt}=this._prepare_decoder_input_ids_for_generation({batch_size:gt[Mt].dims.at(0),model_input_name:Mt,model_kwargs:gt,decoder_start_token_id:Q.decoder_start_token_id,bos_token_id:Q.bos_token_id,generation_config:Q}):lt=gt[Mt];let Pt=lt.dims.at(-1);Q.max_new_tokens!==null&&(Q.max_length=Pt+Q.max_new_tokens);let ut=this._get_logits_processor(Q,Pt,pe),xt=this._get_stopping_criteria(Q,_e),wr=gt[Mt].dims.at(0),Tr=E.LogitsSampler.getSampler(Q),Wt=new Array(wr).fill(0),dr=lt.tolist();Te&&Te.put(dr);let rr,Pr={};for(;;){if(gt=this.prepare_inputs_for_generation(dr,gt,Q),rr=await this.forward(gt),Q.output_attentions&&Q.return_dict_in_generate){let Gr=this.getAttentions(rr);for(let xs in Gr)xs in Pr||(Pr[xs]=[]),Pr[xs].push(Gr[xs])}let as=rr.logits.slice(null,-1,null),aa=ut(dr,as),Ks=[];for(let Gr=0;Gr<aa.dims.at(0);++Gr){let xs=aa[Gr],Ta=await Tr(xs);for(let[Pa,oo]of Ta){let Yt=BigInt(Pa);Wt[Gr]+=oo,dr[Gr].push(Yt),Ks.push([Yt]);break}}if(Te&&Te.put(Ks),xt(dr).every(Gr=>Gr))break;gt=this._update_model_kwargs_for_generation({generated_input_ids:Ks,outputs:rr,model_inputs:gt,is_encoder_decoder:Lt})}Te&&Te.end();let sa=this.getPastKeyValues(rr,gt.past_key_values,!0),Rr=new u.Tensor("int64",dr.flat(),[dr.length,dr[0].length]);if(Q.return_dict_in_generate)return Fe({sequences:Rr,past_key_values:sa},Pr);for(let as of Object.values(rr))as.location==="gpu-buffer"&&as.dispose();return Rr}getPastKeyValues(O,Q,pe=!1){let _e=Object.create(null);for(let Te in O)if(Te.startsWith("present")){let Le=Te.replace("present","past_key_values"),De=Te.includes("encoder");if(De&&Q?_e[Le]=Q[Le]:_e[Le]=O[Te],Q&&(!De||pe)){let st=Q[Le];st.location==="gpu-buffer"&&st.dispose()}}return _e}getAttentions(O){let Q={};for(let pe of["cross_attentions","encoder_attentions","decoder_attentions"])for(let _e in O)_e.startsWith(pe)&&(pe in Q||(Q[pe]=[]),Q[pe].push(O[_e]));return Q}addPastKeyValues(O,Q){var pe,_e,Te,Le,De,st,dt;if(Q)Object.assign(O,Q);else{let gt=(pe=this.sessions.decoder_model_merged)!=null?pe:this.sessions.model,Mt=(Te=(_e=gt==null?void 0:gt.config)==null?void 0:_e.kv_cache_dtype)!=null?Te:"float32",Lt=Mt==="float16"?new u.DataTypeMap.float16:[],lt=(dt=(st=(De=(Le=O[this.main_input_name])!=null?Le:O.attention_mask)==null?void 0:De.dims)==null?void 0:st[0])!=null?dt:1,Pt=(0,s.getKeyValueShapes)(this.config,{batch_size:lt});for(let ut in Pt)O[ut]=new u.Tensor(Mt,Lt,Pt[ut])}}async encode_image({pixel_values:O}){return(await R(this.sessions.vision_encoder,{pixel_values:O})).image_features}async encode_text({input_ids:O}){return(await R(this.sessions.embed_tokens,{input_ids:O})).inputs_embeds}async encode_audio({audio_values:O}){return(await R(this.sessions.audio_encoder,{audio_values:O})).audio_features}}class fe{}class ve extends fe{constructor({last_hidden_state:k,hidden_states:O=null,attentions:Q=null}){super(),this.last_hidden_state=k,this.hidden_states=O,this.attentions=Q}}class Ie extends j{}class xe extends Ie{}class ke extends Ie{async _call(k){return new Br(await super._call(k))}}class Pe extends Ie{async _call(k){return new kt(await super._call(k))}}class He extends Ie{async _call(k){return new $r(await super._call(k))}}class Ue extends Ie{async _call(k){return new Qr(await super._call(k))}}class qe extends j{}class Ke extends qe{}class Re extends qe{async _call(k){return new Br(await super._call(k))}}class tt extends qe{async _call(k){return new kt(await super._call(k))}}class Qe extends qe{async _call(k){return new $r(await super._call(k))}}class at extends j{}class it extends at{}class Ne extends j{}class et extends Ne{}class _t extends Ne{async _call(k){return new Br(await super._call(k))}}class Et extends Ne{async _call(k){return new kt(await super._call(k))}}class At extends Ne{async _call(k){return new $r(await super._call(k))}}class Bt extends Ne{async _call(k){return new Qr(await super._call(k))}}class ar extends j{}class ft extends ar{}class Jr extends ar{async _call(k){return new Br(await super._call(k))}}class L extends ar{async _call(k){return new kt(await super._call(k))}}class se extends ar{async _call(k){return new $r(await super._call(k))}}class G extends ar{async _call(k){return new Qr(await super._call(k))}}class te extends j{}class Me extends te{}class je extends te{async _call(k){return new Br(await super._call(k))}}class Se extends te{async _call(k){return new kt(await super._call(k))}}class Dt extends te{async _call(k){return new $r(await super._call(k))}}class Xt extends te{async _call(k){return new Qr(await super._call(k))}}class ht extends j{}class Ot extends ht{}class Ye extends ht{async _call(k){return new Br(await super._call(k))}}class vt extends ht{async _call(k){return new kt(await super._call(k))}}class yt extends ht{async _call(k){return new $r(await super._call(k))}}class zt extends ht{async _call(k){return new Qr(await super._call(k))}}class It extends j{}class er extends It{}class br extends It{async _call(k){return new Br(await super._call(k))}}class hr extends It{async _call(k){return new kt(await super._call(k))}}class Ir extends It{async _call(k){return new $r(await super._call(k))}}class tr extends It{async _call(k){return new Qr(await super._call(k))}}class kr extends j{}class jr extends kr{}class Yr extends kr{async _call(k){return new Br(await super._call(k))}}class vs extends kr{async _call(k){return new kt(await super._call(k))}}class Ds extends kr{async _call(k){return new $r(await super._call(k))}}class Os extends kr{async _call(k){return new Qr(await super._call(k))}}class Vr extends j{}class Wr extends Vr{}class Ls extends Vr{async _call(k){return new kt(await super._call(k))}}class Dr extends Vr{async _call(k){return new $r(await super._call(k))}}class qr extends Vr{async _call(k){return new Qr(await super._call(k))}}class Ae extends Vr{async _call(k){return new Br(await super._call(k))}}class Ze extends j{}class rt extends Ze{}class or extends Ze{async _call(k){return new Br(await super._call(k))}}class ps extends Ze{async _call(k){return new kt(await super._call(k))}}class Ur extends Ze{async _call(k){return new $r(await super._call(k))}}class ts extends j{}class ms extends ts{}class Or extends ts{async _call(k){return new Br(await super._call(k))}}class hs extends ts{async _call(k){return new kt(await super._call(k))}}class fr extends ts{async _call(k){return new Qr(await super._call(k))}}class gr extends j{}class js extends gr{}class da extends gr{async _call(k){return new Br(await super._call(k))}}class ua extends gr{async _call(k){return new kt(await super._call(k))}}class _a extends gr{async _call(k){return new $r(await super._call(k))}}class pa extends gr{async _call(k){return new Qr(await super._call(k))}}class zs extends j{}class ma extends zs{}class ha extends zs{async _call(k){return new Br(await super._call(k))}}class Xs extends zs{async _call(k){return new kt(await super._call(k))}}class fa extends zs{async _call(k){return new Qr(await super._call(k))}}class Bs extends j{}class ue extends Bs{}class I extends Bs{async _call(k){return new kt(await super._call(k))}}class V extends Bs{async _call(k){return new Qr(await super._call(k))}}class Z extends Bs{async _call(k){return new Br(await super._call(k))}}class ne extends j{constructor(){super(...arguments);ee(this,"forward_params",["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"])}}class de extends ne{}class be extends ne{}class $e extends j{}class Ge extends $e{}class Be extends $e{}class Je extends j{}class wt extends Je{}class Rt extends Je{}class vr extends j{}class Ht extends vr{}class Ut extends vr{}class ir extends vr{async _call(k){return new kt(await super._call(k))}}class lr extends j{}class ls extends lr{}class fs extends lr{}class cr extends lr{async _call(k){return new kt(await super._call(k))}}class Cr extends lr{}class Vt extends j{}class xr extends Vt{}class Fr extends Vt{}class rs extends j{}class gs extends rs{}class Lr extends rs{}class zr extends j{}class Sr extends zr{}class _r extends zr{async _call(k){return new Br(await super._call(k))}}class Mr extends zr{async _call(k){return new kt(await super._call(k))}}class ur extends zr{async _call(k){return new $r(await super._call(k))}}class Zr extends zr{async _call(k){return new Qr(await super._call(k))}}class Ms extends j{}class Vs extends Ms{}class wn extends Ms{async _call(k){return new Br(await super._call(k))}}class fo extends Ms{async _call(k){return new kt(await super._call(k))}}class bn extends Ms{async _call(k){return new $r(await super._call(k))}}class vn extends Ms{async _call(k){return new Qr(await super._call(k))}}class Js extends j{}class go extends Js{}class xn extends Js{async _call(k){return new Br(await super._call(k))}}class yn extends Js{async _call(k){return new kt(await super._call(k))}}class Tn extends Js{async _call(k){return new $r(await super._call(k))}}class Pn extends Js{async _call(k){return new Qr(await super._call(k))}}class Mo extends j{}class En extends Mo{}class kn extends Mo{}class wo extends j{constructor(){super(...arguments);ee(this,"requires_attention_mask",!1);ee(this,"main_input_name","input_features");ee(this,"forward_params",["input_features","attention_mask","decoder_input_ids","decoder_attention_mask","past_key_values"])}}class Cn extends wo{}class bo extends wo{_prepare_generation_config(k,O){return super._prepare_generation_config(k,O,w.WhisperGenerationConfig)}_retrieve_init_tokens(k){let O=[k.decoder_start_token_id],Q=k.language,pe=k.task;if(k.is_multilingual){Q||(console.warn("No language specified - defaulting to English (en)."),Q="en");let Te=`<|${(0,C.whisper_language_to_code)(Q)}|>`;O.push(k.lang_to_id[Te]),O.push(k.task_to_id[pe!=null?pe:"transcribe"])}else if(Q||pe)throw new Error("Cannot specify `task` or `language` for an English-only model. If the model is intended to be multilingual, pass `is_multilingual=true` to generate, or update the generation config.");return!k.return_timestamps&&k.no_timestamps_token_id&&O.at(-1)!==k.no_timestamps_token_id?O.push(k.no_timestamps_token_id):k.return_timestamps&&O.at(-1)===k.no_timestamps_token_id&&(console.warn("<|notimestamps|> prompt token is removed from generation_config since `return_timestamps` is set to `true`."),O.pop()),O.filter(_e=>_e!=null)}async generate(Te){var Le=Te,{inputs:k=null,generation_config:O=null,logits_processor:Q=null,stopping_criteria:pe=null}=Le,_e=ns(Le,["inputs","generation_config","logits_processor","stopping_criteria"]);var dt;O=this._prepare_generation_config(O,_e);let De=(dt=_e.decoder_input_ids)!=null?dt:this._retrieve_init_tokens(O);if(O.return_timestamps&&(Q!=null||(Q=new _.LogitsProcessorList),Q.push(new _.WhisperTimeStampLogitsProcessor(O,De))),O.begin_suppress_tokens&&(Q!=null||(Q=new _.LogitsProcessorList),Q.push(new _.SuppressTokensAtBeginLogitsProcessor(O.begin_suppress_tokens,De.length))),O.return_token_timestamps){if(!O.alignment_heads)throw new Error("Model generation config has no `alignment_heads`, token-level timestamps not available. See https://gist.github.com/hollance/42e32852f24243b748ae6bc1f985b13a on how to add this property to the generation config.");O.task==="translate"&&console.warn("Token-level timestamps may not be reliable for task \'translate\'."),O.output_attentions=!0,O.return_dict_in_generate=!0}let st=await super.generate(Fe({inputs:k,generation_config:O,logits_processor:Q,decoder_input_ids:De},_e));return O.return_token_timestamps&&(st.token_timestamps=this._extract_token_timestamps(st,O.alignment_heads,O.num_frames)),st}_extract_token_timestamps(k,O,Q=null,pe=.02){if(!k.cross_attentions)throw new Error("Model outputs must contain cross attentions to extract timestamps. This is most likely because the model was not exported with `output_attentions=True`.");Q==null&&console.warn("`num_frames` has not been set, meaning the entire audio will be analyzed. This may lead to inaccurate token-level timestamps for short audios (< 30 seconds).");let _e=this.config.median_filter_width;_e===void 0&&(console.warn("Model config has no `median_filter_width`, using default value of 7."),_e=7);let Te=k.cross_attentions,Le=Array.from({length:this.config.decoder_layers},(Pt,ut)=>(0,u.cat)(Te.map(xt=>xt[ut]),2)),De=(0,u.stack)(O.map(([Pt,ut])=>{if(Pt>=Le.length)throw new Error(`Layer index ${Pt} is out of bounds for cross attentions (length ${Le.length}).`);return Q?Le[Pt].slice(null,ut,null,[0,Q]):Le[Pt].slice(null,ut)})).transpose(1,0,2,3),[st,dt]=(0,u.std_mean)(De,-2,0,!0),gt=De.clone();for(let Pt=0;Pt<gt.dims[0];++Pt){let ut=gt[Pt];for(let xt=0;xt<ut.dims[0];++xt){let wr=ut[xt],Tr=st[Pt][xt][0].data,Wt=dt[Pt][xt][0].data;for(let dr=0;dr<wr.dims[0];++dr){let rr=wr[dr].data;for(let Pr=0;Pr<rr.length;++Pr)rr[Pr]=(rr[Pr]-Wt[Pr])/Tr[Pr];rr.set((0,h.medianFilter)(rr,_e))}}}let Mt=[(0,u.mean)(gt,1)],Lt=k.sequences.dims,lt=new u.Tensor("float32",new Float32Array(Lt[0]*Lt[1]),Lt);for(let Pt=0;Pt<Lt[0];++Pt){let ut=Mt[Pt].neg().squeeze_(0),[xt,wr]=(0,h.dynamic_time_warping)(ut.tolist()),Tr=Array.from({length:xt.length-1},(rr,Pr)=>xt[Pr+1]-xt[Pr]),Wt=(0,i.mergeArrays)([1],Tr).map(rr=>!!rr),dr=[];for(let rr=0;rr<Wt.length;++rr)Wt[rr]&&dr.push(wr[rr]*pe);lt[Pt].data.set(dr,1)}return lt}}class Sn extends bo{}class vo extends j{constructor(){super(...arguments);ee(this,"requires_attention_mask",!1);ee(this,"main_input_name","input_values");ee(this,"forward_params",["input_values","decoder_input_ids","past_key_values"])}}class In extends vo{}class xo extends vo{}class Ua extends j{constructor(){super(...arguments);ee(this,"main_input_name","pixel_values");ee(this,"forward_params",["pixel_values","decoder_input_ids","encoder_hidden_states","past_key_values"])}}class yo extends j{constructor(){super(...arguments);ee(this,"forward_params",["input_ids","attention_mask","pixel_values","position_ids","past_key_values"])}}class Ga extends yo{_merge_input_ids_with_image_features(k){let O=k.image_features.dims.at(-1),Q=k.image_features.view(-1,O);return D(Ct(Fe({image_token_id:this.config.image_token_index},k),{image_features:Q}))}}class To extends Ga{}class Po extends Ga{}class Ys extends j{constructor(){super(...arguments);ee(this,"forward_params",["input_ids","inputs_embeds","attention_mask","pixel_values","encoder_outputs","decoder_input_ids","decoder_inputs_embeds","decoder_attention_mask","past_key_values"]);ee(this,"main_input_name","inputs_embeds")}}class Fn extends Ys{_merge_input_ids_with_image_features({inputs_embeds:k,image_features:O,input_ids:Q,attention_mask:pe}){return{inputs_embeds:(0,u.cat)([O,k],1),attention_mask:(0,u.cat)([(0,u.ones)(O.dims.slice(0,2)),pe],1)}}async _prepare_inputs_embeds({input_ids:k,pixel_values:O,inputs_embeds:Q,attention_mask:pe}){if(!k&&!O)throw new Error("Either `input_ids` or `pixel_values` should be provided.");let _e,Te;return k&&(_e=await this.encode_text({input_ids:k})),O&&(Te=await this.encode_image({pixel_values:O})),_e&&Te?{inputs_embeds:Q,attention_mask:pe}=this._merge_input_ids_with_image_features({inputs_embeds:_e,image_features:Te,input_ids:k,attention_mask:pe}):Q=_e||Te,{inputs_embeds:Q,attention_mask:pe}}async forward({input_ids:k,pixel_values:O,attention_mask:Q,decoder_input_ids:pe,decoder_attention_mask:_e,encoder_outputs:Te,past_key_values:Le,inputs_embeds:De,decoder_inputs_embeds:st}){if(De||({inputs_embeds:De,attention_mask:Q}=await this._prepare_inputs_embeds({input_ids:k,pixel_values:O,inputs_embeds:De,attention_mask:Q})),!Te){let{last_hidden_state:Mt}=await ae(this,{inputs_embeds:De,attention_mask:Q});Te=Mt}if(!st){if(!pe)throw new Error("Either `decoder_input_ids` or `decoder_inputs_embeds` should be provided.");st=await this.encode_text({input_ids:pe})}return await he(this,{inputs_embeds:st,attention_mask:_e,encoder_attention_mask:Q,encoder_hidden_states:Te,past_key_values:Le},!0)}}class Eo extends j{constructor(){super(...arguments);ee(this,"forward_params",["input_ids","attention_mask","pixel_values","position_ids","past_key_values"])}}class $n extends Eo{_merge_input_ids_with_image_features(k){let O=k.image_features.dims.at(-1),Q=k.image_features.view(-1,O);return D(Ct(Fe({image_token_id:this.config.image_token_index},k),{image_features:Q}))}}class An extends yo{_merge_input_ids_with_image_features(k){let O=k.image_features.dims.at(-1),Q=k.image_features.view(-1,O);return D(Ct(Fe({image_token_id:this.config.image_token_index},k),{image_features:Q}))}}class Dn extends j{constructor(){super(...arguments);ee(this,"forward_params",["input_ids","attention_mask","inputs_embeds","per_layer_inputs","position_ids","pixel_values","input_features","input_features_mask","past_key_values"])}}class ko extends Dn{async forward(Lt){var lt=Lt,{input_ids:k=null,attention_mask:O=null,pixel_values:Q=null,input_features:pe=null,input_features_mask:_e=null,position_ids:Te=null,inputs_embeds:Le=null,per_layer_inputs:De=null,past_key_values:st=null,generation_config:dt=null,logits_processor:gt=null}=lt,Mt=ns(lt,["input_ids","attention_mask","pixel_values","input_features","input_features_mask","position_ids","inputs_embeds","per_layer_inputs","past_key_values","generation_config","logits_processor"]);if((!Le||!De)&&({inputs_embeds:Le,per_layer_inputs:De}=await R(this.sessions.embed_tokens,{input_ids:k}),k.dims[1]!==1)){if(Q){let{image_features:ut}=await R(this.sessions.vision_encoder,{pixel_values:Q});({inputs_embeds:Le,attention_mask:O}=this._merge_input_ids_with_image_features({image_features:ut,inputs_embeds:Le,input_ids:k,attention_mask:O}))}if(pe){let{audio_features:ut}=await R(this.sessions.audio_encoder,{input_features:pe,input_features_mask:_e});({inputs_embeds:Le,attention_mask:O}=this._merge_input_ids_with_audio_features({audio_features:ut,inputs_embeds:Le,input_ids:k,attention_mask:O}))}}return await he(this,{inputs_embeds:Le,per_layer_inputs:De,past_key_values:st,attention_mask:O,position_ids:Te,generation_config:dt,logits_processor:gt},!0)}_merge_input_ids_with_image_features(k){let O=k.image_features.dims.at(-1),Q=k.image_features.view(-1,O);return D(Ct(Fe({image_token_id:this.config.image_token_id},k),{image_features:Q}))}_merge_input_ids_with_audio_features(k){let O=k.audio_features.dims.at(-1),Q=k.audio_features.view(-1,O);return K(Ct(Fe({audio_token_id:this.config.audio_token_id},k),{audio_features:Q}))}}class Ka extends j{constructor(){super(...arguments);ee(this,"forward_params",["input_ids","attention_mask","pixel_values","pixel_attention_mask","position_ids","past_key_values"])}}class ga extends Ka{async encode_image({pixel_values:k,pixel_attention_mask:O}){return(await R(this.sessions.vision_encoder,{pixel_values:k,pixel_attention_mask:O})).image_features}_merge_input_ids_with_image_features(k){let O=k.image_features.dims.at(-1),Q=k.image_features.view(-1,O);return D(Ct(Fe({image_token_id:this.config.image_token_id},k),{image_features:Q}))}}class Co extends ga{}class On extends j{constructor(){super(...arguments);ee(this,"forward_params",["input_ids","inputs_embeds","attention_mask","position_ids","pixel_values","image_sizes","past_key_values"])}}class So extends On{async forward(gt){var Mt=gt,{input_ids:k=null,attention_mask:O=null,pixel_values:Q=null,image_sizes:pe=null,position_ids:_e=null,inputs_embeds:Te=null,past_key_values:Le=null,generation_config:De=null,logits_processor:st=null}=Mt,dt=ns(Mt,["input_ids","attention_mask","pixel_values","image_sizes","position_ids","inputs_embeds","past_key_values","generation_config","logits_processor"]);if(!Te){let lt;if(Q&&k.dims[1]!==1){if(!pe)throw new Error("`image_sizes` must be provided when `pixel_values` is provided.");({image_features:lt}=await R(this.sessions.vision_encoder,{pixel_values:Q,image_sizes:pe}))}else{let Pt=this.config.normalized_config.hidden_size;lt=new u.Tensor("float32",[],[0,Pt])}({inputs_embeds:Te}=await R(this.sessions.prepare_inputs_embeds,{input_ids:k,image_features:lt}))}return await he(this,{inputs_embeds:Te,past_key_values:Le,attention_mask:O,position_ids:_e,generation_config:De,logits_processor:st},!1)}}class Ws extends j{}class Ln extends Ws{}class Ui extends Ws{static async from_pretrained(k,O={}){var Q;return super.from_pretrained(k,Ct(Fe({},O),{model_file_name:(Q=O.model_file_name)!=null?Q:"text_model"}))}}class zn extends Ws{static async from_pretrained(k,O={}){var Q;return super.from_pretrained(k,Ct(Fe({},O),{model_file_name:(Q=O.model_file_name)!=null?Q:"text_model"}))}}class Gi extends Ws{static async from_pretrained(k,O={}){var Q;return super.from_pretrained(k,Ct(Fe({},O),{model_file_name:(Q=O.model_file_name)!=null?Q:"vision_model"}))}}class Bn extends Ws{static async from_pretrained(k,O={}){var Q;return super.from_pretrained(k,Ct(Fe({},O),{model_file_name:(Q=O.model_file_name)!=null?Q:"vision_model"}))}}class Zs extends j{}class Us extends Zs{}class Io extends Zs{static async from_pretrained(k,O={}){var Q;return super.from_pretrained(k,Ct(Fe({},O),{model_file_name:(Q=O.model_file_name)!=null?Q:"text_model"}))}}class Rn extends Ws{static async from_pretrained(k,O={}){var Q;return super.from_pretrained(k,Ct(Fe({},O),{model_file_name:(Q=O.model_file_name)!=null?Q:"vision_model"}))}}class Nn extends j{}class Ha extends Nn{}class ea extends j{}class Fo extends ea{async forward(k){let O=!k.input_ids,Q=!k.pixel_values;if(O&&Q)throw new Error("Either `input_ids` or `pixel_values` should be provided.");if(O&&(k.input_ids=(0,u.ones)([k.pixel_values.dims[0],1])),Q){let{image_size:st}=this.config.vision_config;k.pixel_values=(0,u.full)([0,3,st,st],0)}let{text_embeddings:pe,image_embeddings:_e,l2norm_text_embeddings:Te,l2norm_image_embeddings:Le}=await super.forward(k),De={};return O||(De.text_embeddings=pe,De.l2norm_text_embeddings=Te),Q||(De.image_embeddings=_e,De.l2norm_image_embeddings=Le),De}}class $o extends ea{static async from_pretrained(k,O={}){var Q;return super.from_pretrained(k,Ct(Fe({},O),{model_file_name:(Q=O.model_file_name)!=null?Q:"text_model"}))}}class Ao extends ea{static async from_pretrained(k,O={}){var Q;return super.from_pretrained(k,Ct(Fe({},O),{model_file_name:(Q=O.model_file_name)!=null?Q:"vision_model"}))}}class qa extends j{}class Do extends qa{}class Oo extends qa{}class Lo extends j{}class zo extends Lo{}class Bo extends Lo{}class ta extends j{}class mt extends ta{}class jn extends ta{}class Qa extends j{}class Ro extends Qa{}class Ma extends Qa{}class ss extends j{}class wa extends ss{}class Xa extends ss{}class Ja extends j{}class No extends Ja{}class jo extends Ja{}class ba extends j{}class Vo extends ba{}class Wo extends ba{}class Ya extends j{}class va extends Ya{}class Za extends Ya{}class xa extends j{}class Uo extends xa{}class Go extends xa{}class eo extends j{}class Ko extends eo{}class Ho extends eo{}class to extends j{}class qo extends to{}class p extends to{}class y extends j{}class F extends y{}class z extends y{}class U extends j{}class le extends U{}class ye extends U{}class Oe extends j{}class Xe extends Oe{}class ot extends Oe{}class Tt extends j{}class Nt extends Tt{}class Jt extends Tt{}class yr extends j{}class Gs extends yr{}class Vn extends yr{}class Ki extends j{}class ou extends Ki{}class nu extends Ki{}class Hi extends j{}class iu extends Hi{}class lu extends Hi{}class qi extends j{}class cu extends qi{}class du extends qi{}class Qi extends j{}class uu extends Qi{}class _u extends Qi{}class Xi extends j{}class pu extends Xi{}class mu extends Xi{}class Ji extends j{}class hu extends Ji{}class fu extends Ji{}class Yi extends j{}class gu extends Yi{}class Mu extends Yi{}class wu extends j{constructor(){super(...arguments);ee(this,"forward_params",["input_ids","attention_mask","position_ids","past_key_values","pixel_values","image_grid_thw"])}}class bu extends wu{get_rope_index(k,O,Q,pe){var gt;let{vision_config:_e,image_token_id:Te,video_token_id:Le,vision_start_token_id:De}=this.config,st=(gt=_e.spatial_merge_size)!=null?gt:2,dt=[];if(O||Q){let Mt=k.tolist();pe||(pe=(0,u.ones_like)(k));let Lt=pe.tolist(),lt=Array.from({length:3},Tr=>Array.from({length:k.dims[0]},Wt=>Array.from({length:k.dims[1]},dr=>1))),Pt=O?O.tolist():[],ut=Q?Q.tolist():[],xt=0,wr=0;for(let Tr=0;Tr<Mt.length;++Tr){let Wt=Mt[Tr].filter((Yt,Ft)=>Lt[Tr][Ft]==1),rr=Wt.reduce((Yt,Ft,Kr)=>(Ft==De&&Yt.push(Kr),Yt),[]).map(Yt=>Wt[Yt+1]),Pr=rr.filter(Yt=>Yt==Te).length,sa=rr.filter(Yt=>Yt==Le).length,Rr=[],as=0,aa=Pr,Ks=sa;for(let Yt=0;Yt<rr.length;++Yt){let Ft=Wt.findIndex((Ea,ys)=>ys>as&&Ea==Te),Kr=Wt.findIndex((Ea,ys)=>ys>as&&Ea==Le),os=aa>0&&Ft!==-1?Ft:Wt.length+1,Rs=Ks>0&&Kr!==-1?Kr:Wt.length+1,no,Jo,ai,io;os<Rs?([Jo,ai,io]=Pt[xt],++xt,--aa,no=os):([Jo,ai,io]=ut[wr],++wr,--Ks,no=Rs);let[P0,Jl,oi]=[Number(Jo),Math.floor(Number(ai)/st),Math.floor(Number(io)/st)],Yl=no-as,tf=Rr.length>0?(0,h.max)(Rr.at(-1))[0]+1:0;Rr.push(Array.from({length:3*Yl},(Ea,ys)=>tf+ys%Yl));let Zl=Yl+tf,ni=P0*Jl*oi,E0=Array.from({length:ni},(Ea,ys)=>Zl+Math.floor(ys/(Jl*oi))),k0=Array.from({length:ni},(Ea,ys)=>Zl+Math.floor(ys/oi)%Jl),C0=Array.from({length:ni},(Ea,ys)=>Zl+ys%oi);Rr.push([E0,k0,C0].flat()),as=no+ni}if(as<Wt.length){let Yt=Rr.length>0?(0,h.max)(Rr.at(-1))[0]+1:0,Ft=Wt.length-as;Rr.push(Array.from({length:3*Ft},(Kr,os)=>Yt+os%Ft))}let ao=Rr.reduce((Yt,Ft)=>Yt+Ft.length,0),Gr=new Array(ao),xs=0;for(let Yt=0;Yt<3;++Yt)for(let Ft=0;Ft<Rr.length;++Ft){let Kr=Rr[Ft],os=Kr.length/3;for(let Rs=Yt*os;Rs<(Yt+1)*os;++Rs)Gr[xs++]=Kr[Rs]}let Ta=0,Pa=Lt[Tr];for(let Yt=0;Yt<Pa.length;++Yt)if(Pa[Yt]==1){for(let Ft=0;Ft<3;++Ft)lt[Ft][Tr][Yt]=Gr[Ft*ao/3+Ta];++Ta}let oo=(0,h.max)(Gr)[0];dt.push(oo+1-Mt[Tr].length)}return[new u.Tensor("int64",lt.flat(1/0),[3,k.dims[0],k.dims[1]]),new u.Tensor("int64",dt,[dt.length,1])]}else if(pe){let{data:Mt,dims:Lt}=ge(pe),lt=BigInt64Array.from({length:3*Mt.length},(ut,xt)=>Mt[xt%Mt.length]),Pt=Array.from({length:Lt[0]},(ut,xt)=>(0,h.max)(Mt.subarray(Lt[1]*xt,Lt[1]*(xt+1)))[0]+BigInt(1)+BigInt(Lt[1]));return[new u.Tensor("int64",lt,[3,...Lt]),new u.Tensor("int64",Pt,[Pt.length,1])]}else{let[Mt,Lt]=k.dims,lt=BigInt64Array.from({length:3*Mt*Lt},(Pt,ut)=>BigInt(Math.floor(ut%Lt/Mt)));return[new u.Tensor("int64",lt,[3,...k.dims]),(0,u.zeros)([Mt,1])]}}async encode_image({pixel_values:k,image_grid_thw:O}){return(await R(this.sessions.vision_encoder,{pixel_values:k,grid_thw:O})).image_features}_merge_input_ids_with_image_features(k){return D(Fe({image_token_id:this.config.image_token_id},k))}prepare_inputs_for_generation(k,O,Q){if(O.attention_mask&&!O.position_ids)if(!O.past_key_values)[O.position_ids,O.rope_deltas]=this.get_rope_index(O.input_ids,O.image_grid_thw,O.video_grid_thw,O.attention_mask);else{O.pixel_values=null;let pe=BigInt(Object.values(O.past_key_values)[0].dims.at(-2)),_e=O.rope_deltas.map(Te=>pe+Te);O.position_ids=(0,u.stack)([_e,_e,_e],0)}return O}}class Zi extends j{}class vu extends Zi{}class xu extends Zi{}class el extends j{}class yu extends el{}class Tu extends el{}class tl extends j{}class Pu extends tl{}class Eu extends tl{}class rl extends j{}class ku extends rl{}class Cu extends rl{}class sl extends j{}class Su extends sl{}class Iu extends sl{}class al extends j{}class Fu extends al{}class $u extends al{async _call(k){return new kt(await super._call(k))}}class ol extends j{}class Au extends ol{}class Du extends ol{async _call(k){return new kt(await super._call(k))}}class Ou extends j{}class Lu extends Ou{}class nl extends j{}class zu extends nl{}class Bu extends nl{async _call(k){return new kt(await super._call(k))}}class Ru extends j{}class Nu extends Ru{}class il extends j{}class ju extends il{}class Vu extends il{async _call(k){return new kt(await super._call(k))}}class Wu extends j{}class Uu extends Wu{}class ll extends j{}class Gu extends ll{}class Ku extends ll{async _call(k){return new kt(await super._call(k))}}class Hu extends j{}class qu extends Hu{async _call(k){return new Zh(await super._call(k))}}class cl extends j{}class Qu extends cl{}class Xu extends cl{async _call(k){return new kt(await super._call(k))}}class dl extends j{}class Ju extends dl{}class Yu extends dl{async _call(k){return new kt(await super._call(k))}}class ul extends j{}class Zu extends ul{}class e_ extends ul{}class _l extends j{}class t_ extends _l{}class r_ extends _l{}class pl extends j{}class s_ extends pl{}class a_ extends pl{async _call(k){return new kt(await super._call(k))}}class Wn extends j{}class o_ extends Wn{}class n_ extends Wn{async _call(k){return new hl(await super._call(k))}}class ml extends Wn{async _call(k){return new i_(await super._call(k))}}class hl extends fe{constructor({logits:k,pred_boxes:O}){super(),this.logits=k,this.pred_boxes=O}}class i_ extends fe{constructor({logits:k,pred_boxes:O,pred_masks:Q}){super(),this.logits=k,this.pred_boxes=O,this.pred_masks=Q}}class fl extends j{}class l_ extends fl{}class c_ extends fl{async _call(k){return new Qo(await super._call(k))}}class Qo extends fe{constructor({logits:k,pred_boxes:O}){super(),this.logits=k,this.pred_boxes=O}}class gl extends j{}class d_ extends gl{}class u_ extends gl{async _call(k){return new __(await super._call(k))}}class __ extends Qo{}class Ml extends j{}class p_ extends Ml{}class m_ extends Ml{async _call(k){return new h_(await super._call(k))}}class h_ extends Qo{}class wl extends j{}class f_ extends wl{}class g_ extends wl{async _call(k){return new Qo(await super._call(k))}}class bl extends j{}class M_ extends bl{}class w_ extends bl{async _call(k){return new b_(await super._call(k))}}class b_ extends hl{}class vl extends j{}class v_ extends vl{}class x_ extends vl{async _call(k){return new kt(await super._call(k))}}class xl extends j{}class y_ extends xl{}class T_ extends xl{async _call(k){return new kt(await super._call(k))}}class yl extends j{}class P_ extends yl{}class E_ extends yl{async _call(k){return new kt(await super._call(k))}}class Un extends j{}class k_ extends Un{}class C_ extends Un{async _call(k){return new kt(await super._call(k))}}class S_ extends Un{}class Tl extends j{}class I_ extends Tl{}class F_ extends Tl{}class Pl extends j{}class $_ extends Pl{}class A_ extends Pl{}class D_ extends j{}class O_ extends D_{}class Gn extends j{}class L_ extends Gn{}class z_ extends Gn{}class B_ extends Gn{}class R_ extends j{}class N_ extends R_{}class j_ extends j{}class V_ extends j_{}class W_ extends j{}class U_ extends W_{}class El extends j{}class G_ extends El{}class K_ extends El{}class kl extends j{}class H_ extends kl{}class q_ extends kl{}class Q_ extends j{}class X_ extends Q_{}class Cl extends j{}class J_ extends Cl{}class Y_ extends Cl{async _call(k){return new kt(await super._call(k))}}class Sl extends j{}class Z_ extends Sl{}class ep extends Sl{async _call(k){return new kt(await super._call(k))}}class Il extends j{}class tp extends Il{}class rp extends Il{async _call(k){return new kt(await super._call(k))}}class Fl extends j{}class sp extends Fl{}class ap extends Fl{async _call(k){return new kt(await super._call(k))}}class op extends j{}class np extends op{}class $l extends j{}class ip extends $l{}class lp extends $l{async _call(k){return new cp(await super._call(k))}}class cp extends fe{constructor({logits:k,pred_boxes:O}){super(),this.logits=k,this.pred_boxes=O}}class dp extends j{}class up extends dp{async get_image_embeddings({pixel_values:k}){return await ae(this,{pixel_values:k})}async forward(k){if((!k.image_embeddings||!k.image_positional_embeddings)&&(k=Fe(Fe({},k),await this.get_image_embeddings(k))),!k.input_labels&&k.input_points){let Q=k.input_points.dims.slice(0,-1),pe=Q.reduce((_e,Te)=>_e*Te,1);k.input_labels=new u.Tensor("int64",new BigInt64Array(pe).fill(BigInt(1)),Q)}let O={image_embeddings:k.image_embeddings,image_positional_embeddings:k.image_positional_embeddings};return k.input_points&&(O.input_points=k.input_points),k.input_labels&&(O.input_labels=k.input_labels),k.input_boxes&&(O.input_boxes=k.input_boxes),await R(this.sessions.prompt_encoder_mask_decoder,O)}async _call(k){return new _p(await super._call(k))}}class _p extends fe{constructor({iou_scores:k,pred_masks:O}){super(),this.iou_scores=k,this.pred_masks=O}}class Al extends j{}class pp extends Al{}class mp extends Al{}class Dl extends j{}class hp extends Dl{}class fp extends Dl{}class ra extends j{}class gp extends ra{}class Mp extends ra{async _call(k){return new ya(await super._call(k))}}class wp extends ra{async _call(k){return new kt(await super._call(k))}}class bp extends ra{async _call(k){return new $r(await super._call(k))}}class Ol extends j{}class vp extends Ol{}class xp extends Ol{async _call(k){return new $r(await super._call(k))}}class yp extends j{}class Tp extends yp{}class Kn extends j{}class Pp extends Kn{}class Ep extends Kn{async _call(k){return new ya(await super._call(k))}}class kp extends Kn{async _call(k){return new kt(await super._call(k))}}class Xo extends j{}class Cp extends Xo{}class Sp extends Xo{async _call(k){return new ya(await super._call(k))}}class Ip extends Xo{async _call(k){return new kt(await super._call(k))}}class Fp extends Xo{async _call(k){return new $r(await super._call(k))}}class Hn extends j{}class $p extends Hn{}class Ap extends Hn{async _call(k){return new ya(await super._call(k))}}class Dp extends Hn{async _call(k){return new kt(await super._call(k))}}class d0 extends j{}class Op extends ra{}class Lp extends ra{async _call(k){return new ya(await super._call(k))}}class zp extends ra{async _call(k){return new kt(await super._call(k))}}class ro extends j{}class Bp extends ro{}class Rp extends ro{async _call(k){return new ya(await super._call(k))}}class Np extends ro{async _call(k){return new kt(await super._call(k))}}class jp extends ro{async _call(k){return new Yh(await super._call(k))}}class Vp extends ro{async _call(k){return new $r(await super._call(k))}}class Wp extends j{}class Up extends Wp{}class qn extends j{}class u0 extends qn{}class Gp extends qn{}class Kp extends qn{async generate_speech(k,O,{threshold:Q=.5,minlenratio:pe=0,maxlenratio:_e=20,vocoder:Te=null}={}){let Le={input_ids:k},{encoder_outputs:De,encoder_attention_mask:st}=await ae(this,Le),dt=De.dims[1]/this.config.reduction_factor,gt=Math.floor(dt*_e),Mt=Math.floor(dt*pe),Lt=this.config.num_mel_bins,lt=[],Pt=null,ut=null,xt=0;for(;;){++xt;let Wt=q(!!ut),dr;ut?dr=ut.output_sequence_out:dr=new u.Tensor("float32",new Float32Array(Lt),[1,1,Lt]);let rr={use_cache_branch:Wt,output_sequence:dr,encoder_attention_mask:st,speaker_embeddings:O,encoder_hidden_states:De};this.addPastKeyValues(rr,Pt),ut=await R(this.sessions.decoder_model_merged,rr),Pt=this.getPastKeyValues(ut,Pt);let{prob:Pr,spectrum:sa}=ut;if(lt.push(sa),xt>=Mt&&(Array.from(Pr.data).filter(Rr=>Rr>=Q).length>0||xt>=gt))break}let wr=(0,u.cat)(lt),{waveform:Tr}=await R(Te.sessions.model,{spectrogram:wr});return{spectrogram:wr,waveform:Tr}}}class Hp extends j{constructor(){super(...arguments);ee(this,"main_input_name","spectrogram")}}class qp extends j{}class Qp extends qp{}class Ll extends j{}class Xp extends Ll{}class Jp extends Ll{}class zl extends j{}class Yp extends zl{}class Zp extends zl{}class Bl extends j{}class em extends Bl{}class tm extends Bl{}class Qn extends j{}class rm extends Qn{}class sm extends Qn{static async from_pretrained(k,O={}){var Q;return super.from_pretrained(k,Ct(Fe({},O),{model_file_name:(Q=O.model_file_name)!=null?Q:"text_model"}))}}class am extends Qn{static async from_pretrained(k,O={}){var Q;return super.from_pretrained(k,Ct(Fe({},O),{model_file_name:(Q=O.model_file_name)!=null?Q:"audio_model"}))}}class om extends j{}class Rl extends om{async _call(k){return new ef(await super._call(k))}}class Xn extends j{}class _0 extends Xn{}class nm extends Xn{}class im extends Xn{}class Nl extends j{}class lm extends Nl{}class cm extends Nl{}class jl extends j{}class dm extends jl{}class um extends jl{async _call(k){return new kt(await super._call(k))}}class Vl extends j{}class p0 extends Vl{}class m0 extends Vl{}class Wl extends j{constructor(){super(...arguments);ee(this,"forward_params",["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"])}_apply_and_filter_by_delay_pattern_mask(O){let[Q,pe]=O.dims,_e=this.config.decoder.num_codebooks,Te=pe-_e,Le=0;for(let dt=0;dt<O.size;++dt){if(O.data[dt]===this.config.decoder.pad_token_id)continue;let gt=dt%pe,Mt=Math.floor(dt/pe)%_e,Lt=gt-Mt;Lt>0&&Lt<=Te&&(O.data[Le++]=O.data[dt])}let De=Math.floor(Q/_e),st=Le/(De*_e);return new u.Tensor(O.type,O.data.slice(0,Le),[De,_e,st])}prepare_inputs_for_generation(O,Q,pe){let _e=structuredClone(O);for(let Le=0;Le<_e.length;++Le)for(let De=0;De<_e[Le].length;++De)Le%this.config.decoder.num_codebooks>=De&&(_e[Le][De]=BigInt(this.config.decoder.pad_token_id));return pe.guidance_scale!==null&&pe.guidance_scale>1&&(_e=_e.concat(_e)),super.prepare_inputs_for_generation(_e,Q,pe)}async generate(O){let Q=await super.generate(O),pe=this._apply_and_filter_by_delay_pattern_mask(Q).unsqueeze_(0),{audio_values:_e}=await R(this.sessions.encodec_decode,{audio_codes:pe});return _e}}class Jn extends j{}class _m extends Jn{}class pm extends Jn{async _call(k){return new kt(await super._call(k))}}class mm extends Jn{}class Yn extends j{}class hm extends Yn{}class fm extends Yn{async _call(k){return new kt(await super._call(k))}}class gm extends Yn{}class Zn extends j{}class Mm extends Zn{}class wm extends Zn{async _call(k){return new kt(await super._call(k))}}class bm extends Zn{}class ei extends j{}class vm extends ei{}class xm extends ei{async _call(k){return new kt(await super._call(k))}}class ym extends ei{}class Tm extends j{}class Pm extends Tm{}class Em extends j{}class km extends Em{constructor(...O){super(...O);ee(this,"forward_params",["input_ids","pixel_values","images_seq_mask","images_emb_mask","attention_mask","position_ids","past_key_values"]);this._generation_mode="text"}async forward(O){var st;let Q=(st=this._generation_mode)!=null?st:"text",pe;if(Q==="text"||!O.past_key_values){let dt=this.sessions.prepare_inputs_embeds,gt=(0,i.pick)(O,dt.inputNames);pe=await R(dt,gt)}else{let dt=this.sessions.gen_img_embeds,gt=(0,i.pick)({image_ids:O.input_ids},dt.inputNames);pe=await R(dt,gt)}let _e=Fe(Fe({},O),pe),Te=await he(this,_e),Le=this.sessions[Q==="text"?"lm_head":"gen_head"];if(!Le)throw new Error(`Unable to find "${Le}" generation head`);let De=await R(Le,(0,i.pick)(Te,Le.inputNames));return Fe(Fe(Fe({},pe),Te),De)}async generate(O){return this._generation_mode="text",super.generate(O)}async generate_images(O){var dt;this._generation_mode="image";let Q=((dt=O.inputs)!=null?dt:O[this.main_input_name]).dims[1],_e=(await super.generate(O)).slice(null,[Q,null]),Te=this.sessions.image_decode,{decoded_image:Le}=await R(Te,{generated_tokens:_e}),De=Le.add_(1).mul_(255/2).clamp_(0,255).to("uint8"),st=[];for(let gt of De){let Mt=f.RawImage.fromTensor(gt);st.push(Mt)}return st}}class Cm extends fe{constructor({char_logits:k,bpe_logits:O,wp_logits:Q}){super(),this.char_logits=k,this.bpe_logits=O,this.wp_logits=Q}get logits(){return[this.char_logits,this.bpe_logits,this.wp_logits]}}class Sm extends j{}class Im extends Sm{async _call(k){return new Cm(await super._call(k))}}class Ul extends j{}class Fm extends Ul{}class $m extends Ul{}class Gl extends j{}class Am extends Gl{}class Dm extends Gl{}class Om extends j{constructor(){super(...arguments);ee(this,"forward_params",["input_ids","attention_mask","position_ids","audio_values","past_key_values"])}}class Lm extends Om{_merge_input_ids_with_audio_features(k){let O=k.audio_features.dims.at(-1),Q=k.audio_features.view(-1,O);return K(Ct(Fe({audio_token_id:this.config.ignore_index},k),{audio_features:Q}))}}class ti extends j{constructor(){super(...arguments);ee(this,"main_input_name","input_values");ee(this,"forward_params",["input_values"])}}class zm extends fe{constructor({audio_codes:k}){super(),this.audio_codes=k}}class Bm extends fe{constructor({audio_values:k}){super(),this.audio_values=k}}class Rm extends ti{async encode(k){return new zm(await R(this.sessions.encoder_model,k))}async decode(k){return new Bm(await R(this.sessions.decoder_model,k))}}class Nm extends ti{static async from_pretrained(k,O={}){var Q;return super.from_pretrained(k,Ct(Fe({},O),{model_file_name:(Q=O.model_file_name)!=null?Q:"encoder_model"}))}}class jm extends ti{static async from_pretrained(k,O={}){var Q;return super.from_pretrained(k,Ct(Fe({},O),{model_file_name:(Q=O.model_file_name)!=null?Q:"decoder_model"}))}}class ri extends j{constructor(){super(...arguments);ee(this,"main_input_name","input_values");ee(this,"forward_params",["input_values"])}}class Vm extends fe{constructor({audio_codes:k}){super(),this.audio_codes=k}}class Wm extends fe{constructor({audio_values:k}){super(),this.audio_values=k}}class Um extends ri{async encode(k){return new Vm(await R(this.sessions.encoder_model,k))}async decode(k){return new Wm(await R(this.sessions.decoder_model,k))}}class Gm extends ri{static async from_pretrained(k,O={}){var Q;return super.from_pretrained(k,Ct(Fe({},O),{model_file_name:(Q=O.model_file_name)!=null?Q:"encoder_model"}))}}class Km extends ri{static async from_pretrained(k,O={}){var Q;return super.from_pretrained(k,Ct(Fe({},O),{model_file_name:(Q=O.model_file_name)!=null?Q:"decoder_model"}))}}class si extends j{constructor(){super(...arguments);ee(this,"main_input_name","input_values");ee(this,"forward_params",["input_values"])}}class Hm extends si{async encode(k){return await R(this.sessions.encoder_model,k)}async decode(k){return await R(this.sessions.decoder_model,k)}}class qm extends si{static async from_pretrained(k,O={}){var Q;return super.from_pretrained(k,Ct(Fe({},O),{model_file_name:(Q=O.model_file_name)!=null?Q:"encoder_model"}))}}class Qm extends si{static async from_pretrained(k,O={}){var Q;return super.from_pretrained(k,Ct(Fe({},O),{model_file_name:(Q=O.model_file_name)!=null?Q:"decoder_model"}))}}class Gt{static async from_pretrained(k,{progress_callback:O=null,config:Q=null,cache_dir:pe=null,local_files_only:_e=!1,revision:Te="main",model_file_name:Le=null,subfolder:De="onnx",device:st=null,dtype:dt=null,use_external_data_format:gt=null,session_options:Mt={}}={}){let Lt={progress_callback:O,config:Q,cache_dir:pe,local_files_only:_e,revision:Te,model_file_name:Le,subfolder:De,device:st,dtype:dt,use_external_data_format:gt,session_options:Mt};if(Lt.config=await s.AutoConfig.from_pretrained(k,Lt),!this.MODEL_CLASS_MAPPINGS)throw new Error("`MODEL_CLASS_MAPPINGS` not implemented for this type of `AutoClass`: "+this.name);let lt=Lt.config.model_type;for(let Pt of this.MODEL_CLASS_MAPPINGS){let ut=Pt.get(lt);if(!ut){for(let xt of Pt.values())if(xt[0]===lt){ut=xt;break}if(!ut)continue}return await ut[1].from_pretrained(k,Lt)}if(this.BASE_IF_FAIL)return vh.has(lt)||console.warn(`Unknown model class "${lt}", attempting to construct from base class.`),await j.from_pretrained(k,Lt);throw Error(`Unsupported model type: ${lt}`)}}ee(Gt,"MODEL_CLASS_MAPPINGS",null),ee(Gt,"BASE_IF_FAIL",!1);let h0=new Map([["bert",["BertModel",xe]],["modernbert",["ModernBertModel",Ke]],["nomic_bert",["NomicBertModel",it]],["roformer",["RoFormerModel",et]],["electra",["ElectraModel",Me]],["esm",["EsmModel",rt]],["convbert",["ConvBertModel",ft]],["camembert",["CamembertModel",Ot]],["deberta",["DebertaModel",er]],["deberta-v2",["DebertaV2Model",jr]],["mpnet",["MPNetModel",js]],["albert",["AlbertModel",ue]],["distilbert",["DistilBertModel",Wr]],["roberta",["RobertaModel",Sr]],["xlm",["XLMModel",Vs]],["xlm-roberta",["XLMRobertaModel",go]],["clap",["ClapModel",rm]],["clip",["CLIPModel",Ln]],["clipseg",["CLIPSegModel",Do]],["chinese_clip",["ChineseCLIPModel",Ha]],["siglip",["SiglipModel",Us]],["jina_clip",["JinaCLIPModel",Fo]],["mobilebert",["MobileBertModel",ms]],["squeezebert",["SqueezeBertModel",ma]],["wav2vec2",["Wav2Vec2Model",gp]],["wav2vec2-bert",["Wav2Vec2BertModel",$p]],["unispeech",["UniSpeechModel",Pp]],["unispeech-sat",["UniSpeechSatModel",Cp]],["hubert",["HubertModel",Op]],["wavlm",["WavLMModel",Bp]],["audio-spectrogram-transformer",["ASTModel",En]],["vits",["VitsModel",Rl]],["pyannote",["PyAnnoteModel",vp]],["wespeaker-resnet",["WeSpeakerResNetModel",Tp]],["detr",["DetrModel",o_]],["rt_detr",["RTDetrModel",l_]],["rt_detr_v2",["RTDetrV2Model",d_]],["rf_detr",["RFDetrModel",p_]],["d_fine",["DFineModel",f_]],["table-transformer",["TableTransformerModel",M_]],["vit",["ViTModel",Fu]],["ijepa",["IJepaModel",Au]],["pvt",["PvtModel",zu]],["vit_msn",["ViTMSNModel",ju]],["vit_mae",["ViTMAEModel",Nu]],["groupvit",["GroupViTModel",Uu]],["fastvit",["FastViTModel",Gu]],["mobilevit",["MobileViTModel",Qu]],["mobilevitv2",["MobileViTV2Model",Ju]],["owlvit",["OwlViTModel",Zu]],["owlv2",["Owlv2Model",t_]],["beit",["BeitModel",s_]],["deit",["DeiTModel",v_]],["hiera",["HieraModel",y_]],["convnext",["ConvNextModel",J_]],["convnextv2",["ConvNextV2Model",Z_]],["dinov2",["Dinov2Model",tp]],["dinov2_with_registers",["Dinov2WithRegistersModel",sp]],["resnet",["ResNetModel",P_]],["swin",["SwinModel",k_]],["swin2sr",["Swin2SRModel",I_]],["donut-swin",["DonutSwinModel",X_]],["yolos",["YolosModel",ip]],["dpt",["DPTModel",$_]],["glpn",["GLPNModel",H_]],["hifigan",["SpeechT5HifiGan",Hp]],["efficientnet",["EfficientNetModel",dm]],["decision_transformer",["DecisionTransformerModel",Pm]],["patchtst",["PatchTSTForPrediction",Fm]],["patchtsmixer",["PatchTSMixerForPrediction",Am]],["mobilenet_v1",["MobileNetV1Model",_m]],["mobilenet_v2",["MobileNetV2Model",hm]],["mobilenet_v3",["MobileNetV3Model",Mm]],["mobilenet_v4",["MobileNetV4Model",vm]],["maskformer",["MaskFormerModel",G_]],["mgp-str",["MgpstrForSceneTextRecognition",Im]],["style_text_to_speech_2",["StyleTextToSpeech2Model",Up]]]),f0=new Map([["t5",["T5Model",de]],["longt5",["LongT5Model",Ge]],["mt5",["MT5Model",wt]],["bart",["BartModel",Ht]],["mbart",["MBartModel",ls]],["marian",["MarianModel",pp]],["whisper",["WhisperModel",Cn]],["m2m_100",["M2M100Model",hp]],["blenderbot",["BlenderbotModel",xr]],["blenderbot-small",["BlenderbotSmallModel",gs]]]),g0=new Map([["mimi",["MimiModel",Rm]],["dac",["DacModel",Um]],["snac",["SnacModel",Hm]]]),M0=new Map([["bloom",["BloomModel",Pu]],["jais",["JAISModel",mt]],["gpt2",["GPT2Model",zo]],["gptj",["GPTJModel",No]],["gpt_bigcode",["GPTBigCodeModel",Vo]],["gpt_neo",["GPTNeoModel",Ro]],["gpt_neox",["GPTNeoXModel",wa]],["codegen",["CodeGenModel",va]],["llama",["LlamaModel",Uo]],["exaone",["ExaoneModel",F]],["olmo",["OlmoModel",Xe]],["olmo2",["Olmo2Model",Nt]],["mobilellm",["MobileLLMModel",le]],["granite",["GraniteModel",Gs]],["cohere",["CohereModel",ou]],["gemma",["GemmaModel",iu]],["gemma2",["Gemma2Model",cu]],["gemma3_text",["Gemma3Model",uu]],["helium",["HeliumModel",Ko]],["glm",["GlmModel",qo]],["openelm",["OpenELMModel",pu]],["qwen2",["Qwen2Model",hu]],["qwen3",["Qwen3Model",gu]],["phi",["PhiModel",vu]],["phi3",["Phi3Model",yu]],["mpt",["MptModel",ku]],["opt",["OPTModel",Su]],["mistral",["MistralModel",Xp]],["starcoder2",["Starcoder2Model",Yp]],["falcon",["FalconModel",em]],["stablelm",["StableLmModel",lm]]]),Kl=new Map([["speecht5",["SpeechT5ForSpeechToText",Gp]],["whisper",["WhisperForConditionalGeneration",bo]],["lite-whisper",["LiteWhisperForConditionalGeneration",Sn]],["moonshine",["MoonshineForConditionalGeneration",xo]]]),Xm=new Map([["speecht5",["SpeechT5ForTextToSpeech",Kp]]]),Jm=new Map([["vits",["VitsModel",Rl]],["musicgen",["MusicgenForConditionalGeneration",Wl]]]),Ym=new Map([["bert",["BertForSequenceClassification",Pe]],["modernbert",["ModernBertForSequenceClassification",tt]],["roformer",["RoFormerForSequenceClassification",Et]],["electra",["ElectraForSequenceClassification",Se]],["esm",["EsmForSequenceClassification",ps]],["convbert",["ConvBertForSequenceClassification",L]],["camembert",["CamembertForSequenceClassification",vt]],["deberta",["DebertaForSequenceClassification",hr]],["deberta-v2",["DebertaV2ForSequenceClassification",vs]],["mpnet",["MPNetForSequenceClassification",ua]],["albert",["AlbertForSequenceClassification",I]],["distilbert",["DistilBertForSequenceClassification",Ls]],["roberta",["RobertaForSequenceClassification",Mr]],["xlm",["XLMForSequenceClassification",fo]],["xlm-roberta",["XLMRobertaForSequenceClassification",yn]],["bart",["BartForSequenceClassification",ir]],["mbart",["MBartForSequenceClassification",cr]],["mobilebert",["MobileBertForSequenceClassification",hs]],["squeezebert",["SqueezeBertForSequenceClassification",Xs]]]),Zm=new Map([["bert",["BertForTokenClassification",He]],["modernbert",["ModernBertForTokenClassification",Qe]],["roformer",["RoFormerForTokenClassification",At]],["electra",["ElectraForTokenClassification",Dt]],["esm",["EsmForTokenClassification",Ur]],["convbert",["ConvBertForTokenClassification",se]],["camembert",["CamembertForTokenClassification",yt]],["deberta",["DebertaForTokenClassification",Ir]],["deberta-v2",["DebertaV2ForTokenClassification",Ds]],["mpnet",["MPNetForTokenClassification",_a]],["distilbert",["DistilBertForTokenClassification",Dr]],["roberta",["RobertaForTokenClassification",ur]],["xlm",["XLMForTokenClassification",bn]],["xlm-roberta",["XLMRobertaForTokenClassification",Tn]]]),Hl=new Map([["t5",["T5ForConditionalGeneration",be]],["longt5",["LongT5ForConditionalGeneration",Be]],["mt5",["MT5ForConditionalGeneration",Rt]],["bart",["BartForConditionalGeneration",Ut]],["mbart",["MBartForConditionalGeneration",fs]],["marian",["MarianMTModel",mp]],["m2m_100",["M2M100ForConditionalGeneration",fp]],["blenderbot",["BlenderbotForConditionalGeneration",Fr]],["blenderbot-small",["BlenderbotSmallForConditionalGeneration",Lr]]]),ql=new Map([["bloom",["BloomForCausalLM",Eu]],["gpt2",["GPT2LMHeadModel",Bo]],["jais",["JAISLMHeadModel",jn]],["gptj",["GPTJForCausalLM",jo]],["gpt_bigcode",["GPTBigCodeForCausalLM",Wo]],["gpt_neo",["GPTNeoForCausalLM",Ma]],["gpt_neox",["GPTNeoXForCausalLM",Xa]],["codegen",["CodeGenForCausalLM",Za]],["llama",["LlamaForCausalLM",Go]],["exaone",["ExaoneForCausalLM",z]],["olmo",["OlmoForCausalLM",ot]],["olmo2",["Olmo2ForCausalLM",Jt]],["mobilellm",["MobileLLMForCausalLM",ye]],["granite",["GraniteForCausalLM",Vn]],["cohere",["CohereForCausalLM",nu]],["gemma",["GemmaForCausalLM",lu]],["gemma2",["Gemma2ForCausalLM",du]],["gemma3_text",["Gemma3ForCausalLM",_u]],["helium",["HeliumForCausalLM",Ho]],["glm",["GlmForCausalLM",p]],["openelm",["OpenELMForCausalLM",mu]],["qwen2",["Qwen2ForCausalLM",fu]],["qwen3",["Qwen3ForCausalLM",Mu]],["phi",["PhiForCausalLM",xu]],["phi3",["Phi3ForCausalLM",Tu]],["mpt",["MptForCausalLM",Cu]],["opt",["OPTForCausalLM",Iu]],["mbart",["MBartForCausalLM",Cr]],["mistral",["MistralForCausalLM",Jp]],["starcoder2",["Starcoder2ForCausalLM",Zp]],["falcon",["FalconForCausalLM",tm]],["trocr",["TrOCRForCausalLM",Qp]],["stablelm",["StableLmForCausalLM",cm]],["phi3_v",["Phi3VForCausalLM",So]]]),w0=new Map([["multi_modality",["MultiModalityCausalLM",km]]]),eh=new Map([["bert",["BertForMaskedLM",ke]],["modernbert",["ModernBertForMaskedLM",Re]],["roformer",["RoFormerForMaskedLM",_t]],["electra",["ElectraForMaskedLM",je]],["esm",["EsmForMaskedLM",or]],["convbert",["ConvBertForMaskedLM",Jr]],["camembert",["CamembertForMaskedLM",Ye]],["deberta",["DebertaForMaskedLM",br]],["deberta-v2",["DebertaV2ForMaskedLM",Yr]],["mpnet",["MPNetForMaskedLM",da]],["albert",["AlbertForMaskedLM",Z]],["distilbert",["DistilBertForMaskedLM",Ae]],["roberta",["RobertaForMaskedLM",_r]],["xlm",["XLMWithLMHeadModel",wn]],["xlm-roberta",["XLMRobertaForMaskedLM",xn]],["mobilebert",["MobileBertForMaskedLM",Or]],["squeezebert",["SqueezeBertForMaskedLM",ha]]]),th=new Map([["bert",["BertForQuestionAnswering",Ue]],["roformer",["RoFormerForQuestionAnswering",Bt]],["electra",["ElectraForQuestionAnswering",Xt]],["convbert",["ConvBertForQuestionAnswering",G]],["camembert",["CamembertForQuestionAnswering",zt]],["deberta",["DebertaForQuestionAnswering",tr]],["deberta-v2",["DebertaV2ForQuestionAnswering",Os]],["mpnet",["MPNetForQuestionAnswering",pa]],["albert",["AlbertForQuestionAnswering",V]],["distilbert",["DistilBertForQuestionAnswering",qr]],["roberta",["RobertaForQuestionAnswering",Zr]],["xlm",["XLMForQuestionAnswering",vn]],["xlm-roberta",["XLMRobertaForQuestionAnswering",Pn]],["mobilebert",["MobileBertForQuestionAnswering",fr]],["squeezebert",["SqueezeBertForQuestionAnswering",fa]]]),Ql=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",Ua]],["idefics3",["Idefics3ForConditionalGeneration",ga]],["smolvlm",["SmolVLMForConditionalGeneration",Co]]]),rh=new Map([["llava",["LlavaForConditionalGeneration",Ga]],["llava_onevision",["LlavaOnevisionForConditionalGeneration",To]],["moondream1",["Moondream1ForConditionalGeneration",Po]],["florence2",["Florence2ForConditionalGeneration",Fn]],["qwen2-vl",["Qwen2VLForConditionalGeneration",bu]],["idefics3",["Idefics3ForConditionalGeneration",ga]],["smolvlm",["SmolVLMForConditionalGeneration",Co]],["paligemma",["PaliGemmaForConditionalGeneration",$n]],["llava_qwen2",["LlavaQwen2ForCausalLM",An]],["gemma3n",["Gemma3nForConditionalGeneration",ko]]]),sh=new Map([["ultravox",["UltravoxModel",Lm]]]),b0=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",Ua]]]),ah=new Map([["vit",["ViTForImageClassification",$u]],["ijepa",["IJepaForImageClassification",Du]],["pvt",["PvtForImageClassification",Bu]],["vit_msn",["ViTMSNForImageClassification",Vu]],["fastvit",["FastViTForImageClassification",Ku]],["mobilevit",["MobileViTForImageClassification",Xu]],["mobilevitv2",["MobileViTV2ForImageClassification",Yu]],["beit",["BeitForImageClassification",a_]],["deit",["DeiTForImageClassification",x_]],["hiera",["HieraForImageClassification",T_]],["convnext",["ConvNextForImageClassification",Y_]],["convnextv2",["ConvNextV2ForImageClassification",ep]],["dinov2",["Dinov2ForImageClassification",rp]],["dinov2_with_registers",["Dinov2WithRegistersForImageClassification",ap]],["resnet",["ResNetForImageClassification",E_]],["swin",["SwinForImageClassification",C_]],["segformer",["SegformerForImageClassification",nm]],["efficientnet",["EfficientNetForImageClassification",um]],["mobilenet_v1",["MobileNetV1ForImageClassification",pm]],["mobilenet_v2",["MobileNetV2ForImageClassification",fm]],["mobilenet_v3",["MobileNetV3ForImageClassification",wm]],["mobilenet_v4",["MobileNetV4ForImageClassification",xm]]]),oh=new Map([["detr",["DetrForObjectDetection",n_]],["rt_detr",["RTDetrForObjectDetection",c_]],["rt_detr_v2",["RTDetrV2ForObjectDetection",u_]],["rf_detr",["RFDetrForObjectDetection",m_]],["d_fine",["DFineForObjectDetection",g_]],["table-transformer",["TableTransformerForObjectDetection",w_]],["yolos",["YolosForObjectDetection",lp]]]),nh=new Map([["owlvit",["OwlViTForObjectDetection",e_]],["owlv2",["Owlv2ForObjectDetection",r_]],["grounding-dino",["GroundingDinoForObjectDetection",np]]]),so=new Map([["detr",["DetrForSegmentation",ml]],["clipseg",["CLIPSegForImageSegmentation",Oo]]]),ih=new Map([["segformer",["SegformerForSemanticSegmentation",im]],["sapiens",["SapiensForSemanticSegmentation",L_]],["swin",["SwinForSemanticSegmentation",S_]],["mobilenet_v1",["MobileNetV1ForSemanticSegmentation",mm]],["mobilenet_v2",["MobileNetV2ForSemanticSegmentation",gm]],["mobilenet_v3",["MobileNetV3ForSemanticSegmentation",bm]],["mobilenet_v4",["MobileNetV4ForSemanticSegmentation",ym]]]),lh=new Map([["detr",["DetrForSegmentation",ml]],["maskformer",["MaskFormerForInstanceSegmentation",K_]]]),ch=new Map([["sam",["SamModel",up]]]),dh=new Map([["wav2vec2",["Wav2Vec2ForCTC",Mp]],["wav2vec2-bert",["Wav2Vec2BertForCTC",Ap]],["unispeech",["UniSpeechForCTC",Ep]],["unispeech-sat",["UniSpeechSatForCTC",Sp]],["wavlm",["WavLMForCTC",Rp]],["hubert",["HubertForCTC",Lp]]]),uh=new Map([["wav2vec2",["Wav2Vec2ForSequenceClassification",wp]],["wav2vec2-bert",["Wav2Vec2BertForSequenceClassification",Dp]],["unispeech",["UniSpeechForSequenceClassification",kp]],["unispeech-sat",["UniSpeechSatForSequenceClassification",Ip]],["wavlm",["WavLMForSequenceClassification",Np]],["hubert",["HubertForSequenceClassification",zp]],["audio-spectrogram-transformer",["ASTForAudioClassification",kn]]]),_h=new Map([["wavlm",["WavLMForXVector",jp]]]),ph=new Map([["unispeech-sat",["UniSpeechSatForAudioFrameClassification",Fp]],["wavlm",["WavLMForAudioFrameClassification",Vp]],["wav2vec2",["Wav2Vec2ForAudioFrameClassification",bp]],["pyannote",["PyAnnoteForAudioFrameClassification",xp]]]),mh=new Map([["vitmatte",["VitMatteForImageMatting",qu]]]),v0=new Map([["patchtst",["PatchTSTForPrediction",$m]],["patchtsmixer",["PatchTSMixerForPrediction",Dm]]]),hh=new Map([["swin2sr",["Swin2SRForImageSuperResolution",F_]]]),fh=new Map([["dpt",["DPTForDepthEstimation",A_]],["depth_anything",["DepthAnythingForDepthEstimation",O_]],["glpn",["GLPNForDepthEstimation",q_]],["sapiens",["SapiensForDepthEstimation",z_]],["depth_pro",["DepthProForDepthEstimation",N_]],["metric3d",["Metric3DForDepthEstimation",V_]],["metric3dv2",["Metric3Dv2ForDepthEstimation",U_]]]),gh=new Map([["sapiens",["SapiensForNormalEstimation",B_]]]),Mh=new Map([["vitpose",["VitPoseForPoseEstimation",Lu]]]),wh=new Map([["clip",["CLIPVisionModelWithProjection",Bn]],["siglip",["SiglipVisionModel",Rn]],["jina_clip",["JinaCLIPVisionModel",Ao]]]),bh=[[h0,x.EncoderOnly],[f0,x.EncoderDecoder],[M0,x.DecoderOnly],[g0,x.AutoEncoder],[Ym,x.EncoderOnly],[Zm,x.EncoderOnly],[Hl,x.Seq2Seq],[Kl,x.Seq2Seq],[ql,x.DecoderOnly],[w0,x.MultiModality],[eh,x.EncoderOnly],[th,x.EncoderOnly],[Ql,x.Vision2Seq],[rh,x.ImageTextToText],[sh,x.AudioTextToText],[ah,x.EncoderOnly],[so,x.EncoderOnly],[lh,x.EncoderOnly],[ih,x.EncoderOnly],[mh,x.EncoderOnly],[v0,x.EncoderOnly],[hh,x.EncoderOnly],[fh,x.EncoderOnly],[gh,x.EncoderOnly],[Mh,x.EncoderOnly],[oh,x.EncoderOnly],[nh,x.EncoderOnly],[ch,x.MaskGeneration],[dh,x.EncoderOnly],[uh,x.EncoderOnly],[Xm,x.Seq2Seq],[Jm,x.EncoderOnly],[_h,x.EncoderOnly],[ph,x.EncoderOnly],[wh,x.EncoderOnly]];for(let[b,k]of bh)for(let[O,Q]of b.values())T.set(O,k),g.set(Q,O),S.set(O,Q);let x0=[["MusicgenForConditionalGeneration",Wl,x.Musicgen],["Phi3VForCausalLM",So,x.Phi3V],["CLIPTextModelWithProjection",zn,x.EncoderOnly],["SiglipTextModel",Io,x.EncoderOnly],["JinaCLIPTextModel",$o,x.EncoderOnly],["ClapTextModelWithProjection",sm,x.EncoderOnly],["ClapAudioModelWithProjection",am,x.EncoderOnly],["DacEncoderModel",Gm,x.EncoderOnly],["DacDecoderModel",Km,x.EncoderOnly],["MimiEncoderModel",Nm,x.EncoderOnly],["MimiDecoderModel",jm,x.EncoderOnly],["SnacEncoderModel",qm,x.EncoderOnly],["SnacDecoderModel",Qm,x.EncoderOnly],["Gemma3nForConditionalGeneration",ko,x.ImageAudioTextToText]];for(let[b,k,O]of x0)T.set(b,O),g.set(k,b),S.set(b,k);let vh=new Map([["modnet",so],["birefnet",so],["isnet",so],["ben",so]]);for(let[b,k]of vh.entries())k.set(b,["PreTrainedModel",j]),T.set(b,x.EncoderOnly),g.set(j,b),S.set(b,j);class Xl extends Gt{}ee(Xl,"MODEL_CLASS_MAPPINGS",bh.map(k=>k[0])),ee(Xl,"BASE_IF_FAIL",!0);class xh extends Gt{}ee(xh,"MODEL_CLASS_MAPPINGS",[Ym]);class yh extends Gt{}ee(yh,"MODEL_CLASS_MAPPINGS",[Zm]);class Th extends Gt{}ee(Th,"MODEL_CLASS_MAPPINGS",[Hl]);class Ph extends Gt{}ee(Ph,"MODEL_CLASS_MAPPINGS",[Kl]);class Eh extends Gt{}ee(Eh,"MODEL_CLASS_MAPPINGS",[Xm]);class kh extends Gt{}ee(kh,"MODEL_CLASS_MAPPINGS",[Jm]);class Ch extends Gt{}ee(Ch,"MODEL_CLASS_MAPPINGS",[ql]);class Sh extends Gt{}ee(Sh,"MODEL_CLASS_MAPPINGS",[eh]);class Ih extends Gt{}ee(Ih,"MODEL_CLASS_MAPPINGS",[th]);class Fh extends Gt{}ee(Fh,"MODEL_CLASS_MAPPINGS",[Ql]);class $h extends Gt{}ee($h,"MODEL_CLASS_MAPPINGS",[ah]);class Ah extends Gt{}ee(Ah,"MODEL_CLASS_MAPPINGS",[so]);class Dh extends Gt{}ee(Dh,"MODEL_CLASS_MAPPINGS",[ih]);class Oh extends Gt{}ee(Oh,"MODEL_CLASS_MAPPINGS",[lh]);class Lh extends Gt{}ee(Lh,"MODEL_CLASS_MAPPINGS",[oh]);class zh extends Gt{}ee(zh,"MODEL_CLASS_MAPPINGS",[nh]);class Bh extends Gt{}ee(Bh,"MODEL_CLASS_MAPPINGS",[ch]);class Rh extends Gt{}ee(Rh,"MODEL_CLASS_MAPPINGS",[dh]);class Nh extends Gt{}ee(Nh,"MODEL_CLASS_MAPPINGS",[uh]);class jh extends Gt{}ee(jh,"MODEL_CLASS_MAPPINGS",[_h]);class Vh extends Gt{}ee(Vh,"MODEL_CLASS_MAPPINGS",[ph]);class Wh extends Gt{}ee(Wh,"MODEL_CLASS_MAPPINGS",[b0]);class Uh extends Gt{}ee(Uh,"MODEL_CLASS_MAPPINGS",[mh]);class Gh extends Gt{}ee(Gh,"MODEL_CLASS_MAPPINGS",[hh]);class Kh extends Gt{}ee(Kh,"MODEL_CLASS_MAPPINGS",[fh]);class Hh extends Gt{}ee(Hh,"MODEL_CLASS_MAPPINGS",[gh]);class qh extends Gt{}ee(qh,"MODEL_CLASS_MAPPINGS",[Mh]);class Qh extends Gt{}ee(Qh,"MODEL_CLASS_MAPPINGS",[wh]);class Xh extends Gt{}ee(Xh,"MODEL_CLASS_MAPPINGS",[rh]);class Jh extends Gt{}ee(Jh,"MODEL_CLASS_MAPPINGS",[sh]);class y0 extends fe{constructor({logits:k,past_key_values:O,encoder_outputs:Q,decoder_attentions:pe=null,cross_attentions:_e=null}){super(),this.logits=k,this.past_key_values=O,this.encoder_outputs=Q,this.decoder_attentions=pe,this.cross_attentions=_e}}class kt extends fe{constructor(Q){var pe=Q,{logits:k}=pe,O=ns(pe,["logits"]);super(),this.logits=k;let _e=Object.values(O);_e.length>0&&(this.attentions=_e)}}class Yh extends fe{constructor({logits:k,embeddings:O}){super(),this.logits=k,this.embeddings=O}}class $r extends fe{constructor({logits:k}){super(),this.logits=k}}class Br extends fe{constructor({logits:k}){super(),this.logits=k}}class Qr extends fe{constructor({start_logits:k,end_logits:O}){super(),this.start_logits=k,this.end_logits=O}}class ya extends fe{constructor({logits:k}){super(),this.logits=k}}class T0 extends fe{constructor({logits:k,past_key_values:O}){super(),this.logits=k,this.past_key_values=O}}class Zh extends fe{constructor({alphas:k}){super(),this.alphas=k}}class ef extends fe{constructor({waveform:k,spectrogram:O}){super(),this.waveform=k,this.spectrogram=O}}},"./src/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js":(e,r,t)=>{t.r(r),t.d(r,{ASTFeatureExtractor:()=>n});var s=t("./src/base/feature_extraction_utils.js"),o=t("./src/utils/tensor.js"),a=t("./src/utils/audio.js");class n extends s.FeatureExtractor{constructor(l){super(l);let c=this.config.sampling_rate,_=(0,a.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(c/2),c,null,"kaldi",!0);this.mel_filters=_,this.window=(0,a.window_function)(400,"hann",{periodic:!1}),this.mean=this.config.mean,this.std=this.config.std}async _extract_fbank_features(l,c){return(0,a.spectrogram)(l,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:c,transpose:!0})}async _call(l){(0,s.validate_audio_inputs)(l,"ASTFeatureExtractor");let c=await this._extract_fbank_features(l,this.config.max_length);if(this.config.do_normalize){let _=this.std*2,d=c.data;for(let u=0;u<d.length;++u)d[u]=(d[u]-this.mean)/_}return{input_values:c.unsqueeze_(0)}}}},"./src/models/auto/feature_extraction_auto.js":(e,r,t)=>{t.r(r),t.d(r,{AutoFeatureExtractor:()=>i});var s=t("./src/utils/constants.js"),o=t("./src/utils/hub.js"),a=t("./src/base/feature_extraction_utils.js"),n=t("./src/models/feature_extractors.js");class i{static async from_pretrained(c,_={}){let d=await(0,o.getModelJSON)(c,s.FEATURE_EXTRACTOR_NAME,!0,_),u=d.feature_extractor_type,f=n[u];if(!f)throw new Error(`Unknown feature_extractor_type: \'${u}\'. Please report this at ${s.GITHUB_ISSUE_URL}.`);return new f(d)}}},"./src/models/auto/image_processing_auto.js":(e,r,t)=>{t.r(r),t.d(r,{AutoImageProcessor:()=>i});var s=t("./src/utils/constants.js"),o=t("./src/utils/hub.js"),a=t("./src/base/image_processors_utils.js"),n=t("./src/models/image_processors.js");class i{static async from_pretrained(c,_={}){var h;let d=await(0,o.getModelJSON)(c,s.IMAGE_PROCESSOR_NAME,!0,_),u=(h=d.image_processor_type)!=null?h:d.feature_extractor_type,f=n[u==null?void 0:u.replace(/Fast$/,"")];return f||(u!==void 0&&console.warn(`Image processor type \'${u}\' not found, assuming base ImageProcessor. Please report this at ${s.GITHUB_ISSUE_URL}.`),f=a.ImageProcessor),new f(d)}}},"./src/models/auto/processing_auto.js":(e,r,t)=>{t.r(r),t.d(r,{AutoProcessor:()=>c});var s=t("./src/utils/constants.js"),o=t("./src/utils/hub.js"),a=t("./src/base/processing_utils.js"),n=t("./src/models/processors.js"),i=t("./src/models/image_processors.js"),l=t("./src/models/feature_extractors.js");class c{static async from_pretrained(d,u={}){let f=await(0,o.getModelJSON)(d,s.IMAGE_PROCESSOR_NAME,!0,u),{image_processor_type:h,feature_extractor_type:v,processor_class:E}=f;if(E&&n[E])return n[E].from_pretrained(d,u);if(!h&&!v)throw new Error("No `image_processor_type` or `feature_extractor_type` found in the config.");let M={};if(h){let C=i[h.replace(/Fast$/,"")];if(!C)throw new Error(`Unknown image_processor_type: \'${h}\'.`);M.image_processor=new C(f)}if(v){let C=i[v];if(C)M.image_processor=new C(f);else{let x=l[v];if(!x)throw new Error(`Unknown feature_extractor_type: \'${v}\'.`);M.feature_extractor=new x(f)}}let w={};return new a.Processor(w,M,null)}}},"./src/models/beit/image_processing_beit.js":(e,r,t)=>{t.r(r),t.d(r,{BeitFeatureExtractor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{}},"./src/models/bit/image_processing_bit.js":(e,r,t)=>{t.r(r),t.d(r,{BitImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{}},"./src/models/chinese_clip/image_processing_chinese_clip.js":(e,r,t)=>{t.r(r),t.d(r,{ChineseCLIPFeatureExtractor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{}},"./src/models/clap/feature_extraction_clap.js":(e,r,t)=>{t.r(r),t.d(r,{ClapFeatureExtractor:()=>n});var s=t("./src/base/feature_extraction_utils.js"),o=t("./src/utils/tensor.js"),a=t("./src/utils/audio.js");class n extends s.FeatureExtractor{constructor(l){super(l),this.mel_filters=(0,a.mel_filter_bank)(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,null,"htk"),this.mel_filters_slaney=(0,a.mel_filter_bank)(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,"slaney","slaney"),this.window=(0,a.window_function)(this.config.fft_window_size,"hann")}async _get_input_mel(l,c,_,d){let u,f=!1,h=l.length-c;if(h>0)if(_==="rand_trunc"){f=!0;let v=Math.floor(Math.random()*(h+1));l=l.subarray(v,v+c),u=await this._extract_fbank_features(l,this.mel_filters_slaney,this.config.nb_max_samples)}else throw new Error(`Truncation strategy "${_}" not implemented`);else{if(h<0){let v=new Float64Array(c);if(v.set(l),d==="repeat")for(let E=l.length;E<c;E+=l.length)v.set(l.subarray(0,Math.min(l.length,c-E)),E);else if(d==="repeatpad")for(let E=l.length;E<-h;E+=l.length)v.set(l,E);l=v}if(_==="fusion")throw new Error(`Truncation strategy "${_}" not implemented`);u=await this._extract_fbank_features(l,this.mel_filters_slaney,this.config.nb_max_samples)}return u.unsqueeze_(0)}async _extract_fbank_features(l,c,_=null){return(0,a.spectrogram)(l,this.window,this.config.fft_window_size,this.config.hop_length,{power:2,mel_filters:c,log_mel:"dB",max_num_frames:_,do_pad:!1,transpose:!0})}async _call(l,{max_length:c=null}={}){return(0,s.validate_audio_inputs)(l,"ClapFeatureExtractor"),{input_features:(await this._get_input_mel(l,c!=null?c:this.config.nb_max_samples,this.config.truncation,this.config.padding)).unsqueeze_(0)}}}},"./src/models/clip/image_processing_clip.js":(e,r,t)=>{t.r(r),t.d(r,{CLIPFeatureExtractor:()=>a,CLIPImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{}class a extends o{}},"./src/models/convnext/image_processing_convnext.js":(e,r,t)=>{t.r(r),t.d(r,{ConvNextFeatureExtractor:()=>a,ConvNextImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{constructor(i){var l;super(i),this.crop_pct=(l=this.config.crop_pct)!=null?l:224/256}async resize(i){var c;let l=(c=this.size)==null?void 0:c.shortest_edge;if(l===void 0)throw new Error("Size dictionary must contain \'shortest_edge\' key.");if(l<384){let _=Math.floor(l/this.crop_pct),[d,u]=this.get_resize_output_image_size(i,{shortest_edge:_});i=await i.resize(d,u,{resample:this.resample}),i=await i.center_crop(l,l)}else i=await i.resize(l,l,{resample:this.resample});return i}}class a extends o{}},"./src/models/dac/feature_extraction_dac.js":(e,r,t)=>{t.r(r),t.d(r,{DacFeatureExtractor:()=>o});var s=t("./src/models/encodec/feature_extraction_encodec.js");class o extends s.EncodecFeatureExtractor{}},"./src/models/deit/image_processing_deit.js":(e,r,t)=>{t.r(r),t.d(r,{DeiTFeatureExtractor:()=>a,DeiTImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{}class a extends o{}},"./src/models/detr/image_processing_detr.js":(e,r,t)=>{t.r(r),t.d(r,{DetrFeatureExtractor:()=>n,DetrImageProcessor:()=>a});var s=t("./src/base/image_processors_utils.js"),o=t("./src/utils/tensor.js");class a extends s.ImageProcessor{async _call(l){let c=await super._call(l),_=[c.pixel_values.dims[0],64,64],d=(0,o.full)(_,BigInt(1));return Ct(Fe({},c),{pixel_mask:d})}post_process_object_detection(...l){return(0,s.post_process_object_detection)(...l)}post_process_panoptic_segmentation(...l){return(0,s.post_process_panoptic_segmentation)(...l)}post_process_instance_segmentation(...l){return(0,s.post_process_instance_segmentation)(...l)}}class n extends a{}},"./src/models/donut/image_processing_donut.js":(e,r,t)=>{t.r(r),t.d(r,{DonutFeatureExtractor:()=>a,DonutImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{pad_image(i,l,c,_={}){let[d,u,f]=l,h=this.image_mean;Array.isArray(this.image_mean)||(h=new Array(f).fill(h));let v=this.image_std;Array.isArray(v)||(v=new Array(f).fill(h));let E=h.map((M,w)=>-M/v[w]);return super.pad_image(i,l,c,Fe({center:!0,constant_values:E},_))}}class a extends o{}},"./src/models/dpt/image_processing_dpt.js":(e,r,t)=>{t.r(r),t.d(r,{DPTFeatureExtractor:()=>a,DPTImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{}class a extends o{}},"./src/models/efficientnet/image_processing_efficientnet.js":(e,r,t)=>{t.r(r),t.d(r,{EfficientNetImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{constructor(n){var i;super(n),this.include_top=(i=this.config.include_top)!=null?i:!0,this.include_top&&(this.image_std=this.image_std.map(l=>l*l))}}},"./src/models/encodec/feature_extraction_encodec.js":(e,r,t)=>{t.r(r),t.d(r,{EncodecFeatureExtractor:()=>a});var s=t("./src/base/feature_extraction_utils.js"),o=t("./src/utils/tensor.js");class a extends s.FeatureExtractor{async _call(i){(0,s.validate_audio_inputs)(i,"EncodecFeatureExtractor"),i instanceof Float64Array&&(i=new Float32Array(i));let l=this.config.feature_size;if(i.length%l!==0)throw new Error(`The length of the audio data must be a multiple of the number of channels (${l}).`);let c=[1,l,i.length/l];return{input_values:new o.Tensor("float32",i,c)}}}},"./src/models/feature_extractors.js":(e,r,t)=>{t.r(r),t.d(r,{ASTFeatureExtractor:()=>s.ASTFeatureExtractor,ClapFeatureExtractor:()=>a.ClapFeatureExtractor,DacFeatureExtractor:()=>n.DacFeatureExtractor,EncodecFeatureExtractor:()=>o.EncodecFeatureExtractor,Gemma3nAudioFeatureExtractor:()=>i.Gemma3nAudioFeatureExtractor,ImageFeatureExtractor:()=>E.ImageProcessor,MoonshineFeatureExtractor:()=>l.MoonshineFeatureExtractor,PyAnnoteFeatureExtractor:()=>c.PyAnnoteFeatureExtractor,SeamlessM4TFeatureExtractor:()=>_.SeamlessM4TFeatureExtractor,SnacFeatureExtractor:()=>d.SnacFeatureExtractor,SpeechT5FeatureExtractor:()=>u.SpeechT5FeatureExtractor,Wav2Vec2FeatureExtractor:()=>f.Wav2Vec2FeatureExtractor,WeSpeakerFeatureExtractor:()=>h.WeSpeakerFeatureExtractor,WhisperFeatureExtractor:()=>v.WhisperFeatureExtractor});var s=t("./src/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js"),o=t("./src/models/encodec/feature_extraction_encodec.js"),a=t("./src/models/clap/feature_extraction_clap.js"),n=t("./src/models/dac/feature_extraction_dac.js"),i=t("./src/models/gemma3n/feature_extraction_gemma3n.js"),l=t("./src/models/moonshine/feature_extraction_moonshine.js"),c=t("./src/models/pyannote/feature_extraction_pyannote.js"),_=t("./src/models/seamless_m4t/feature_extraction_seamless_m4t.js"),d=t("./src/models/snac/feature_extraction_snac.js"),u=t("./src/models/speecht5/feature_extraction_speecht5.js"),f=t("./src/models/wav2vec2/feature_extraction_wav2vec2.js"),h=t("./src/models/wespeaker/feature_extraction_wespeaker.js"),v=t("./src/models/whisper/feature_extraction_whisper.js"),E=t("./src/base/image_processors_utils.js")},"./src/models/florence2/processing_florence2.js":(e,r,t)=>{t.r(r),t.d(r,{Florence2Processor:()=>n});var s=t("./src/base/processing_utils.js"),o=t("./src/models/auto/image_processing_auto.js"),a=t("./src/tokenizers.js");class n extends s.Processor{constructor(l,c,_){super(l,c,_);let{tasks_answer_post_processing_type:d,task_prompts_without_inputs:u,task_prompts_with_input:f}=this.image_processor.config;this.tasks_answer_post_processing_type=new Map(Object.entries(d!=null?d:{})),this.task_prompts_without_inputs=new Map(Object.entries(u!=null?u:{})),this.task_prompts_with_input=new Map(Object.entries(f!=null?f:{})),this.regexes={quad_boxes:/(.+?)<loc_(\\d+)><loc_(\\d+)><loc_(\\d+)><loc_(\\d+)><loc_(\\d+)><loc_(\\d+)><loc_(\\d+)><loc_(\\d+)>/gm,bboxes:/([^<]+)?<loc_(\\d+)><loc_(\\d+)><loc_(\\d+)><loc_(\\d+)>/gm},this.size_per_bin=1e3}construct_prompts(l){typeof l=="string"&&(l=[l]);let c=[];for(let _ of l)if(this.task_prompts_without_inputs.has(_))c.push(this.task_prompts_without_inputs.get(_));else{for(let[d,u]of this.task_prompts_with_input)if(_.includes(d)){c.push(u.replaceAll("{input}",_).replaceAll(d,""));break}c.length!==l.length&&c.push(_)}return c}post_process_generation(l,c,_){var f,h;let d=(f=this.tasks_answer_post_processing_type.get(c))!=null?f:"pure_text";l=l.replaceAll("<s>","").replaceAll("</s>","");let u;switch(d){case"pure_text":u=l;break;case"description_with_bboxes":case"bboxes":case"phrase_grounding":case"ocr":let v=d==="ocr"?"quad_boxes":"bboxes",E=l.matchAll(this.regexes[v]),M=[],w=[];for(let[C,x,...T]of E)M.push(x?x.trim():(h=M.at(-1))!=null?h:""),w.push(T.map((S,g)=>(Number(S)+.5)/this.size_per_bin*_[g%2]));u={labels:M,[v]:w};break;default:throw new Error(`Task "${c}" (of type "${d}") not yet implemented.`)}return{[c]:u}}async _call(l,c=null,_={}){if(!l&&!c)throw new Error("Either text or images must be provided");let d=await this.image_processor(l,_),u=c?this.tokenizer(this.construct_prompts(c),_):{};return Fe(Fe({},d),u)}}ee(n,"tokenizer_class",a.AutoTokenizer),ee(n,"image_processor_class",o.AutoImageProcessor)},"./src/models/gemma3n/feature_extraction_gemma3n.js":(e,r,t)=>{t.r(r),t.d(r,{Gemma3nAudioFeatureExtractor:()=>n});var s=t("./src/base/feature_extraction_utils.js"),o=t("./src/utils/tensor.js"),a=t("./src/utils/audio.js");class n extends s.FeatureExtractor{constructor(l){super(l);let{fft_length:c,feature_size:_,min_frequency:d,max_frequency:u,sampling_rate:f,frame_length:h}=this.config,v=(0,a.mel_filter_bank)(Math.floor(1+c/2),_,d,u,f,null,"htk",!1);this.mel_filters=v,this.window=(0,a.window_function)(h,"hann")}async _extract_fbank_features(l,c){return(0,a.spectrogram)(l,this.window,this.config.frame_length,this.config.hop_length,{fft_length:this.config.fft_length,center:!1,onesided:!0,preemphasis:this.config.preemphasis,preemphasis_htk_flavor:this.config.preemphasis_htk_flavor,mel_filters:this.mel_filters,log_mel:"log",mel_floor:this.config.mel_floor,remove_dc_offset:!1,transpose:!0})}async _call(l,{max_length:c=48e4,truncation:_=!0,padding:d=!0,pad_to_multiple_of:u=128}={}){if((0,s.validate_audio_inputs)(l,"Gemma3nAudioFeatureExtractor"),_&&l.length>c&&(l=l.slice(0,c)),d&&l.length%u!==0){let v=u-l.length%u,E=new Float64Array(l.length+v);E.set(l),this.config.padding_value!==0&&E.fill(this.config.padding_value,l.length),l=E}let f=await this._extract_fbank_features(l,this.config.max_length),h=(0,o.full)([1,f.dims[0]],!0);return{input_features:f.unsqueeze_(0),input_features_mask:h}}}},"./src/models/gemma3n/processing_gemma3n.js":(e,r,t)=>{t.r(r),t.d(r,{Gemma3nProcessor:()=>c});var s=t("./src/base/processing_utils.js"),o=t("./src/models/auto/image_processing_auto.js"),a=t("./src/models/auto/feature_extraction_auto.js"),n=t("./src/tokenizers.js"),i=t("./src/utils/image.js"),l=t("./src/utils/audio.js");class c extends s.Processor{constructor(d,u,f){super(d,u,f),this.audio_seq_length=this.config.audio_seq_length,this.image_seq_length=this.config.image_seq_length;let{audio_token_id:h,boa_token:v,audio_token:E,eoa_token:M,image_token_id:w,boi_token:C,image_token:x,eoi_token:T}=this.tokenizer.config;this.audio_token_id=h,this.boa_token=v,this.audio_token=E;let S=E.repeat(this.audio_seq_length);this.full_audio_sequence=`\n\n${v}${S}${M}\n\n`,this.image_token_id=w,this.boi_token=C,this.image_token=x;let g=x.repeat(this.image_seq_length);this.full_image_sequence=`\n\n${C}${g}${T}\n\n`}async _call(d,u=null,f=null,h={}){typeof d=="string"&&(d=[d]);let v;f&&(v=await this.feature_extractor(f,h),d=d.map(w=>w.replaceAll(this.audio_token,this.full_audio_sequence)));let E;u&&(E=await this.image_processor(u,h),d=d.map(w=>w.replaceAll(this.image_token,this.full_image_sequence)));let M=this.tokenizer(d,h);return Fe(Fe(Fe({},M),E),v)}}ee(c,"image_processor_class",o.AutoImageProcessor),ee(c,"feature_extractor_class",a.AutoFeatureExtractor),ee(c,"tokenizer_class",n.AutoTokenizer),ee(c,"uses_processor_config",!0),ee(c,"uses_chat_template_file",!0)},"./src/models/glpn/image_processing_glpn.js":(e,r,t)=>{t.r(r),t.d(r,{GLPNFeatureExtractor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{}},"./src/models/grounding_dino/image_processing_grounding_dino.js":(e,r,t)=>{t.r(r),t.d(r,{GroundingDinoImageProcessor:()=>a});var s=t("./src/base/image_processors_utils.js"),o=t("./src/utils/tensor.js");class a extends s.ImageProcessor{async _call(i){let l=await super._call(i),c=l.pixel_values.dims,_=(0,o.ones)([c[0],c[2],c[3]]);return Ct(Fe({},l),{pixel_mask:_})}}},"./src/models/grounding_dino/processing_grounding_dino.js":(e,r,t)=>{t.r(r),t.d(r,{GroundingDinoProcessor:()=>l});var s=t("./src/base/processing_utils.js"),o=t("./src/models/auto/image_processing_auto.js"),a=t("./src/tokenizers.js"),n=t("./src/base/image_processors_utils.js");function i(c,_){let u=c.dims.at(-1)-1,f=c.tolist();f.fill(!1,0,1),f.fill(!1,u);let h=_.tolist();return f.map((v,E)=>v?E:null).filter(v=>v!==null).map(v=>h[v])}class l extends s.Processor{async _call(_,d,u={}){let f=_?await this.image_processor(_,u):{},h=d?this.tokenizer(d,u):{};return Fe(Fe({},h),f)}post_process_grounded_object_detection(_,d,{box_threshold:u=.25,text_threshold:f=.25,target_sizes:h=null}={}){let{logits:v,pred_boxes:E}=_,M=v.dims[0];if(h!==null&&h.length!==M)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let w=v.dims.at(1),C=v.sigmoid(),x=C.max(-1).tolist(),T=E.tolist().map(g=>g.map(P=>(0,n.center_to_corners_format)(P))),S=[];for(let g=0;g<M;++g){let P=h!==null?h[g]:null;P!==null&&(T[g]=T[g].map(R=>R.map((J,H)=>J*P[(H+1)%2])));let $=x[g],A=[],N=[],W=[];for(let R=0;R<w;++R){let J=$[R];if(J<=u)continue;let H=T[g][R],q=C[g][R];A.push(J),W.push(H);let X=i(q.gt(f),d[g]);N.push(X)}S.push({scores:A,boxes:W,labels:this.batch_decode(N)})}return S}}ee(l,"tokenizer_class",a.AutoTokenizer),ee(l,"image_processor_class",o.AutoImageProcessor)},"./src/models/idefics3/image_processing_idefics3.js":(e,r,t)=>{t.r(r),t.d(r,{Idefics3ImageProcessor:()=>a});var s=t("./src/base/image_processors_utils.js"),o=t("./src/utils/tensor.js");class a extends s.ImageProcessor{constructor(i){var l;super(i),this.do_image_splitting=(l=i.do_image_splitting)!=null?l:!0,this.max_image_size=i.max_image_size}get_resize_for_vision_encoder(i,l){let[c,_]=i.dims.slice(-2),d=_/c;return _>=c?(_=Math.ceil(_/l)*l,c=Math.floor(_/d),c=Math.ceil(c/l)*l):(c=Math.ceil(c/l)*l,_=Math.floor(c*d),_=Math.ceil(_/l)*l),{height:c,width:_}}async _call(i,{do_image_splitting:l=null,return_row_col_info:c=!1}={}){let _;if(!Array.isArray(i))_=[[i]];else{if(i.length===0||!i[0])throw new Error("No images provided.");Array.isArray(i[0])?_=i:_=[i]}let d=[],u=[],f=[],h=[],v=[];for(let g of _){let P=await Promise.all(g.map(N=>this.preprocess(N)));h.push(...P.map(N=>N.original_size)),v.push(...P.map(N=>N.reshaped_input_size)),P.forEach(N=>N.pixel_values.unsqueeze_(0));let{longest_edge:$}=this.max_image_size,A;if(l!=null?l:this.do_image_splitting){let N=new Array(P.length),W=new Array(P.length);A=await Promise.all(P.map(async(R,J)=>{let H=this.get_resize_for_vision_encoder(R.pixel_values,$),q=await(0,o.interpolate_4d)(R.pixel_values,{size:[H.height,H.width]}),{frames:X,num_splits_h:ae,num_splits_w:ce}=await this.split_image(q,this.max_image_size);return N[J]=ae,W[J]=ce,(0,o.cat)(X,0)})),u.push(N),f.push(W)}else{let N=[$,$];A=await Promise.all(P.map(W=>(0,o.interpolate_4d)(W.pixel_values,{size:N}))),u.push(new Array(P.length).fill(0)),f.push(new Array(P.length).fill(0))}d.push((0,o.cat)(A,0))}let E=d.length,[M,w,C,x]=d[0].dims,T,S;if(E===1)T=d[0].unsqueeze_(0),S=(0,o.full)([E,M,C,x],!0);else{let g=Math.max(...d.map(A=>A.dims.at(0)));S=(0,o.full)([E,g,C,x],!0);let P=S.data,$=g*C*x;for(let A=0;A<E;++A){let N=d[A].dims[0];if(N<g){d[A]=(0,o.cat)([d[A],(0,o.full)([g-N,w,C,x],0)],0);let W=A*$+N*C*x,R=(A+1)*$;P.fill(!1,W,R)}}T=(0,o.stack)(d,0)}return Fe({pixel_values:T,pixel_attention_mask:S,original_sizes:h,reshaped_input_sizes:v},c?{rows:u,cols:f}:{})}async split_image(i,{longest_edge:l}){let c=l,_=l,d=[],[u,f]=i.dims.slice(-2),h=0,v=0;if(u>c||f>_){h=Math.ceil(u/c),v=Math.ceil(f/_);let E=Math.ceil(u/h),M=Math.ceil(f/v);for(let x=0;x<h;++x)for(let T=0;T<v;++T){let S,g,P,$;x===h-1?(g=u-E,$=u):(g=x*E,$=(x+1)*E),T===v-1?(S=f-M,P=f):(S=T*M,P=(T+1)*M);let A=[g,S],N=[$,P],W=await(0,o.slice)(i,A,N,[2,3]);d.push(W)}let w=c,C=_;(u!==w||f!==C)&&(i=await(0,o.interpolate_4d)(i,{size:[w,C]}))}return d.push(i),{frames:d,num_splits_h:h,num_splits_w:v}}}},"./src/models/idefics3/processing_idefics3.js":(e,r,t)=>{t.r(r),t.d(r,{Idefics3Processor:()=>d});var s=t("./src/base/processing_utils.js"),o=t("./src/models/auto/image_processing_auto.js"),a=t("./src/tokenizers.js"),n=t("./src/utils/image.js"),i=t("./src/utils/core.js");function l(u,f,h,v,E,M){let w="";for(let C=0;C<f;++C){for(let x=0;x<h;++x)w+=v+`<row_${C+1}_col_${x+1}>`+E.repeat(u);w+=`\n`}return w+=`\n${v}${M}`+E.repeat(u)+`${v}`,w}function c(u,f,h,v){return`${f}${v}`+h.repeat(u)+`${f}`}function _(u,f,h,v,E,M){return u===0&&f===0?c(h,v,E,M):l(h,u,f,v,E,M)}class d extends s.Processor{constructor(){super(...arguments);ee(this,"fake_image_token","<fake_token_around_image>");ee(this,"image_token","<image>");ee(this,"global_img_token","<global-img>")}async _call(h,v=null,E={}){var P,$,A;(P=E.return_row_col_info)!=null||(E.return_row_col_info=!0);let M;v&&(M=await this.image_processor(v,E)),Array.isArray(h)||(h=[h]);let w=($=M.rows)!=null?$:[new Array(h.length).fill(0)],C=(A=M.cols)!=null?A:[new Array(h.length).fill(0)],x=this.config.image_seq_len,T=[],S=[];for(let N=0;N<h.length;++N){let W=h[N],R=w[N],J=C[N];T.push((0,i.count)(W,this.image_token));let H=R.map((ae,ce)=>_(ae,J[ce],x,this.fake_image_token,this.image_token,this.global_img_token)),q=W.split(this.image_token);if(q.length===0)throw new Error("The image token should be present in the text.");let X=q[0];for(let ae=0;ae<H.length;++ae)X+=H[ae]+q[ae+1];S.push(X)}let g=this.tokenizer(S);return Fe(Fe({},g),M)}}ee(d,"image_processor_class",o.AutoImageProcessor),ee(d,"tokenizer_class",a.AutoTokenizer),ee(d,"uses_processor_config",!0)},"./src/models/image_processors.js":(e,r,t)=>{t.r(r),t.d(r,{BeitFeatureExtractor:()=>s.BeitFeatureExtractor,BitImageProcessor:()=>o.BitImageProcessor,CLIPFeatureExtractor:()=>n.CLIPFeatureExtractor,CLIPImageProcessor:()=>n.CLIPImageProcessor,ChineseCLIPFeatureExtractor:()=>a.ChineseCLIPFeatureExtractor,ConvNextFeatureExtractor:()=>i.ConvNextFeatureExtractor,ConvNextImageProcessor:()=>i.ConvNextImageProcessor,DPTFeatureExtractor:()=>d.DPTFeatureExtractor,DPTImageProcessor:()=>d.DPTImageProcessor,DeiTFeatureExtractor:()=>l.DeiTFeatureExtractor,DeiTImageProcessor:()=>l.DeiTImageProcessor,DetrFeatureExtractor:()=>c.DetrFeatureExtractor,DetrImageProcessor:()=>c.DetrImageProcessor,DonutFeatureExtractor:()=>_.DonutFeatureExtractor,DonutImageProcessor:()=>_.DonutImageProcessor,EfficientNetImageProcessor:()=>u.EfficientNetImageProcessor,GLPNFeatureExtractor:()=>f.GLPNFeatureExtractor,GroundingDinoImageProcessor:()=>h.GroundingDinoImageProcessor,Idefics3ImageProcessor:()=>v.Idefics3ImageProcessor,JinaCLIPImageProcessor:()=>M.JinaCLIPImageProcessor,LlavaOnevisionImageProcessor:()=>w.LlavaOnevisionImageProcessor,Mask2FormerImageProcessor:()=>C.Mask2FormerImageProcessor,MaskFormerFeatureExtractor:()=>x.MaskFormerFeatureExtractor,MaskFormerImageProcessor:()=>x.MaskFormerImageProcessor,MobileNetV1FeatureExtractor:()=>T.MobileNetV1FeatureExtractor,MobileNetV1ImageProcessor:()=>T.MobileNetV1ImageProcessor,MobileNetV2FeatureExtractor:()=>S.MobileNetV2FeatureExtractor,MobileNetV2ImageProcessor:()=>S.MobileNetV2ImageProcessor,MobileNetV3FeatureExtractor:()=>g.MobileNetV3FeatureExtractor,MobileNetV3ImageProcessor:()=>g.MobileNetV3ImageProcessor,MobileNetV4FeatureExtractor:()=>P.MobileNetV4FeatureExtractor,MobileNetV4ImageProcessor:()=>P.MobileNetV4ImageProcessor,MobileViTFeatureExtractor:()=>$.MobileViTFeatureExtractor,MobileViTImageProcessor:()=>$.MobileViTImageProcessor,NougatImageProcessor:()=>A.NougatImageProcessor,OwlViTFeatureExtractor:()=>W.OwlViTFeatureExtractor,OwlViTImageProcessor:()=>W.OwlViTImageProcessor,Owlv2ImageProcessor:()=>N.Owlv2ImageProcessor,Phi3VImageProcessor:()=>R.Phi3VImageProcessor,PvtImageProcessor:()=>J.PvtImageProcessor,Qwen2VLImageProcessor:()=>H.Qwen2VLImageProcessor,RTDetrImageProcessor:()=>q.RTDetrImageProcessor,SamImageProcessor:()=>X.SamImageProcessor,SegformerFeatureExtractor:()=>ae.SegformerFeatureExtractor,SegformerImageProcessor:()=>ae.SegformerImageProcessor,SiglipImageProcessor:()=>ce.SiglipImageProcessor,SmolVLMImageProcessor:()=>he.SmolVLMImageProcessor,Swin2SRImageProcessor:()=>B.Swin2SRImageProcessor,VLMImageProcessor:()=>E.VLMImageProcessor,ViTFeatureExtractor:()=>D.ViTFeatureExtractor,ViTImageProcessor:()=>D.ViTImageProcessor,VitMatteImageProcessor:()=>K.VitMatteImageProcessor,VitPoseImageProcessor:()=>re.VitPoseImageProcessor,YolosFeatureExtractor:()=>me.YolosFeatureExtractor,YolosImageProcessor:()=>me.YolosImageProcessor});var s=t("./src/models/beit/image_processing_beit.js"),o=t("./src/models/bit/image_processing_bit.js"),a=t("./src/models/chinese_clip/image_processing_chinese_clip.js"),n=t("./src/models/clip/image_processing_clip.js"),i=t("./src/models/convnext/image_processing_convnext.js"),l=t("./src/models/deit/image_processing_deit.js"),c=t("./src/models/detr/image_processing_detr.js"),_=t("./src/models/donut/image_processing_donut.js"),d=t("./src/models/dpt/image_processing_dpt.js"),u=t("./src/models/efficientnet/image_processing_efficientnet.js"),f=t("./src/models/glpn/image_processing_glpn.js"),h=t("./src/models/grounding_dino/image_processing_grounding_dino.js"),v=t("./src/models/idefics3/image_processing_idefics3.js"),E=t("./src/models/janus/image_processing_janus.js"),M=t("./src/models/jina_clip/image_processing_jina_clip.js"),w=t("./src/models/llava_onevision/image_processing_llava_onevision.js"),C=t("./src/models/mask2former/image_processing_mask2former.js"),x=t("./src/models/maskformer/image_processing_maskformer.js"),T=t("./src/models/mobilenet_v1/image_processing_mobilenet_v1.js"),S=t("./src/models/mobilenet_v2/image_processing_mobilenet_v2.js"),g=t("./src/models/mobilenet_v3/image_processing_mobilenet_v3.js"),P=t("./src/models/mobilenet_v4/image_processing_mobilenet_v4.js"),$=t("./src/models/mobilevit/image_processing_mobilevit.js"),A=t("./src/models/nougat/image_processing_nougat.js"),N=t("./src/models/owlv2/image_processing_owlv2.js"),W=t("./src/models/owlvit/image_processing_owlvit.js"),R=t("./src/models/phi3_v/image_processing_phi3_v.js"),J=t("./src/models/pvt/image_processing_pvt.js"),H=t("./src/models/qwen2_vl/image_processing_qwen2_vl.js"),q=t("./src/models/rt_detr/image_processing_rt_detr.js"),X=t("./src/models/sam/image_processing_sam.js"),ae=t("./src/models/segformer/image_processing_segformer.js"),ce=t("./src/models/siglip/image_processing_siglip.js"),he=t("./src/models/smolvlm/image_processing_smolvlm.js"),B=t("./src/models/swin2sr/image_processing_swin2sr.js"),D=t("./src/models/vit/image_processing_vit.js"),K=t("./src/models/vitmatte/image_processing_vitmatte.js"),re=t("./src/models/vitpose/image_processing_vitpose.js"),me=t("./src/models/yolos/image_processing_yolos.js")},"./src/models/janus/image_processing_janus.js":(e,r,t)=>{t.r(r),t.d(r,{VLMImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{constructor(n){super(Fe({do_pad:!0,pad_size:{width:n.image_size,height:n.image_size}},n)),this.constant_values=this.config.background_color.map(i=>i*this.rescale_factor)}pad_image(n,i,l,c){return super.pad_image(n,i,l,Fe({constant_values:this.constant_values,center:!0},c))}}},"./src/models/janus/processing_janus.js":(e,r,t)=>{t.r(r),t.d(r,{VLChatProcessor:()=>c});var s=t("./src/base/processing_utils.js"),o=t("./src/models/auto/image_processing_auto.js"),a=t("./src/tokenizers.js"),n=t("./src/utils/core.js"),i=t("./src/utils/tensor.js"),l=t("./src/utils/image.js");class c extends s.Processor{constructor(d,u,f){super(d,u,f),this.image_tag=this.config.image_tag,this.image_start_tag=this.config.image_start_tag,this.image_end_tag=this.config.image_end_tag,this.num_image_tokens=this.config.num_image_tokens}async _call(d,{images:u=null,chat_template:f="default"}={}){u?Array.isArray(u)||(u=[u]):u=await Promise.all(d.filter(A=>A.images).flatMap(A=>A.images).map(A=>l.RawImage.read(A)));let h=this.tokenizer,v=h.apply_chat_template(d,{tokenize:!1,add_generation_prompt:!0,chat_template:f}),E=A=>h.encode(A,{add_special_tokens:!1}),M=v.split(this.image_tag),w=M.length-1;if(u.length!==w)throw new Error(`Number of images provided (${u.length}) does not match number of "${this.image_tag}" image tags (${w})`);let[C,x,T]=h.model.convert_tokens_to_ids([this.image_tag,this.image_start_tag,this.image_end_tag]),S=E(M[0]),g=new Array(S.length).fill(!1);for(let A=1;A<M.length;++A){let N=new Array(this.num_image_tokens).fill(C),W=E(M[A]);S=(0,n.mergeArrays)(S,[x],N,[T],W);let R=new Array(this.num_image_tokens).fill(!0);g=(0,n.mergeArrays)(g,[!1],R,[!1],new Array(W.length).fill(!1))}let P=[1,S.length],$={input_ids:new i.Tensor("int64",S,P),attention_mask:new i.Tensor("int64",new Array(S.length).fill(1),P),images_seq_mask:new i.Tensor("bool",g,P),images_emb_mask:new i.Tensor("bool",new Array(w*this.num_image_tokens).fill(!0),[1,w,this.num_image_tokens])};if(u&&u.length>0){let A=await this.image_processor(u);return A.pixel_values.unsqueeze_(0),Fe(Fe({},$),A)}return $}}ee(c,"image_processor_class",o.AutoImageProcessor),ee(c,"tokenizer_class",a.AutoTokenizer),ee(c,"uses_processor_config",!0)},"./src/models/jina_clip/image_processing_jina_clip.js":(e,r,t)=>{t.r(r),t.d(r,{JinaCLIPImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{constructor(n){let h=n,{resize_mode:i,fill_color:l,interpolation:c,size:_}=h,d=ns(h,["resize_mode","fill_color","interpolation","size"]),u=i==="squash"?{width:_,height:_}:i==="shortest"?{shortest_edge:_}:{longest_edge:_},f=c==="bicubic"?3:2;super(Ct(Fe({},d),{size:u,resample:f,do_center_crop:!0,crop_size:_,do_normalize:!0}))}}},"./src/models/jina_clip/processing_jina_clip.js":(e,r,t)=>{t.r(r),t.d(r,{JinaCLIPProcessor:()=>n});var s=t("./src/base/processing_utils.js"),o=t("./src/models/auto/image_processing_auto.js"),a=t("./src/tokenizers.js");class n extends s.Processor{async _call(l=null,c=null,_={}){if(!l&&!c)throw new Error("Either text or images must be provided");let d=l?this.tokenizer(l,_):{},u=c?await this.image_processor(c,_):{};return Fe(Fe({},d),u)}}ee(n,"tokenizer_class",a.AutoTokenizer),ee(n,"image_processor_class",o.AutoImageProcessor)},"./src/models/llava/processing_llava.js":(e,r,t)=>{t.r(r),t.d(r,{LlavaProcessor:()=>n});var s=t("./src/base/processing_utils.js"),o=t("./src/models/auto/image_processing_auto.js"),a=t("./src/tokenizers.js");class n extends s.Processor{async _call(l,c=null,_={}){let d=await this.image_processor(l,_);if(c){let[f,h]=d.pixel_values.dims.slice(-2),{image_token:v,patch_size:E,num_additional_image_tokens:M}=this.config,w=Math.floor(f/E)*Math.floor(h/E)+M;c=structuredClone(c),Array.isArray(c)||(c=[c]);for(let C=0;C<c.length;++C)c[C]=c[C].replace(v,v.repeat(w))}let u=c?this.tokenizer(c,_):{};return Fe(Fe({},d),u)}}ee(n,"tokenizer_class",a.AutoTokenizer),ee(n,"image_processor_class",o.AutoImageProcessor),ee(n,"uses_processor_config",!0)},"./src/models/llava_onevision/image_processing_llava_onevision.js":(e,r,t)=>{t.r(r),t.d(r,{LlavaOnevisionImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{}},"./src/models/mask2former/image_processing_mask2former.js":(e,r,t)=>{t.r(r),t.d(r,{Mask2FormerImageProcessor:()=>o});var s=t("./src/models/maskformer/image_processing_maskformer.js");class o extends s.MaskFormerImageProcessor{}},"./src/models/maskformer/image_processing_maskformer.js":(e,r,t)=>{t.r(r),t.d(r,{MaskFormerFeatureExtractor:()=>a,MaskFormerImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{post_process_panoptic_segmentation(...i){return(0,s.post_process_panoptic_segmentation)(...i)}post_process_instance_segmentation(...i){return(0,s.post_process_instance_segmentation)(...i)}}class a extends o{}},"./src/models/mgp_str/processing_mgp_str.js":(e,r,t)=>{t.r(r),t.d(r,{MgpstrProcessor:()=>l});var s=t("./src/base/processing_utils.js"),o=t("./src/models/auto/image_processing_auto.js"),a=t("./src/tokenizers.js"),n=t("./src/utils/maths.js");let i={char:["char_decode",1],bpe:["bpe_decode",2],wp:["wp_decode",102]};class l extends s.Processor{get char_tokenizer(){return this.components.char_tokenizer}get bpe_tokenizer(){return this.components.bpe_tokenizer}get wp_tokenizer(){return this.components.wp_tokenizer}_decode_helper(_,d){if(!i.hasOwnProperty(d))throw new Error(`Format ${d} is not supported.`);let[u,f]=i[d],h=this[u].bind(this),[v,E]=_.dims,M=[],w=[],C=_.tolist();for(let T=0;T<v;++T){let S=C[T],g=[],P=[];for(let A=1;A<E;++A){let[N,W]=(0,n.max)((0,n.softmax)(S[A]));if(P.push(N),W==f)break;g.push(W)}let $=P.length>0?P.reduce((A,N)=>A*N,1):0;w.push(g),M.push($)}return[h(w),M]}char_decode(_){return this.char_tokenizer.batch_decode(_).map(d=>d.replaceAll(" ",""))}bpe_decode(_){return this.bpe_tokenizer.batch_decode(_)}wp_decode(_){return this.wp_tokenizer.batch_decode(_).map(d=>d.replaceAll(" ",""))}batch_decode([_,d,u]){let[f,h]=this._decode_helper(_,"char"),[v,E]=this._decode_helper(d,"bpe"),[M,w]=this._decode_helper(u,"wp"),C=[],x=[];for(let T=0;T<f.length;++T){let[S,g]=(0,n.max)([h[T],E[T],w[T]]);C.push([f[T],v[T],M[T]][g]),x.push(S)}return{generated_text:C,scores:x,char_preds:f,bpe_preds:v,wp_preds:M}}static async from_pretrained(..._){let d=await super.from_pretrained(..._),u=await a.AutoTokenizer.from_pretrained("Xenova/gpt2"),f=await a.AutoTokenizer.from_pretrained("Xenova/bert-base-uncased");return d.components={image_processor:d.image_processor,char_tokenizer:d.tokenizer,bpe_tokenizer:u,wp_tokenizer:f},d}async _call(_,d=null){let u=await this.image_processor(_);return d&&(u.labels=this.tokenizer(d).input_ids),u}}ee(l,"tokenizer_class",a.AutoTokenizer),ee(l,"image_processor_class",o.AutoImageProcessor)},"./src/models/mobilenet_v1/image_processing_mobilenet_v1.js":(e,r,t)=>{t.r(r),t.d(r,{MobileNetV1FeatureExtractor:()=>a,MobileNetV1ImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{}class a extends o{}},"./src/models/mobilenet_v2/image_processing_mobilenet_v2.js":(e,r,t)=>{t.r(r),t.d(r,{MobileNetV2FeatureExtractor:()=>a,MobileNetV2ImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{}class a extends o{}},"./src/models/mobilenet_v3/image_processing_mobilenet_v3.js":(e,r,t)=>{t.r(r),t.d(r,{MobileNetV3FeatureExtractor:()=>a,MobileNetV3ImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{}class a extends o{}},"./src/models/mobilenet_v4/image_processing_mobilenet_v4.js":(e,r,t)=>{t.r(r),t.d(r,{MobileNetV4FeatureExtractor:()=>a,MobileNetV4ImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{}class a extends o{}},"./src/models/mobilevit/image_processing_mobilevit.js":(e,r,t)=>{t.r(r),t.d(r,{MobileViTFeatureExtractor:()=>a,MobileViTImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{}class a extends o{}},"./src/models/moonshine/feature_extraction_moonshine.js":(e,r,t)=>{t.r(r),t.d(r,{MoonshineFeatureExtractor:()=>a});var s=t("./src/base/feature_extraction_utils.js"),o=t("./src/utils/tensor.js");class a extends s.FeatureExtractor{async _call(i){(0,s.validate_audio_inputs)(i,"MoonshineFeatureExtractor"),i instanceof Float64Array&&(i=new Float32Array(i));let l=[1,i.length];return{input_values:new o.Tensor("float32",i,l)}}}},"./src/models/moonshine/processing_moonshine.js":(e,r,t)=>{t.r(r),t.d(r,{MoonshineProcessor:()=>n});var s=t("./src/models/auto/feature_extraction_auto.js"),o=t("./src/tokenizers.js"),a=t("./src/base/processing_utils.js");class n extends a.Processor{async _call(l){return await this.feature_extractor(l)}}ee(n,"tokenizer_class",o.AutoTokenizer),ee(n,"feature_extractor_class",s.AutoFeatureExtractor)},"./src/models/nougat/image_processing_nougat.js":(e,r,t)=>{t.r(r),t.d(r,{NougatImageProcessor:()=>o});var s=t("./src/models/donut/image_processing_donut.js");class o extends s.DonutImageProcessor{}},"./src/models/owlv2/image_processing_owlv2.js":(e,r,t)=>{t.r(r),t.d(r,{Owlv2ImageProcessor:()=>o});var s=t("./src/models/owlvit/image_processing_owlvit.js");class o extends s.OwlViTImageProcessor{}},"./src/models/owlvit/image_processing_owlvit.js":(e,r,t)=>{t.r(r),t.d(r,{OwlViTFeatureExtractor:()=>a,OwlViTImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{post_process_object_detection(...i){return(0,s.post_process_object_detection)(...i)}}class a extends o{}},"./src/models/owlvit/processing_owlvit.js":(e,r,t)=>{t.r(r),t.d(r,{OwlViTProcessor:()=>n});var s=t("./src/base/processing_utils.js"),o=t("./src/models/auto/image_processing_auto.js"),a=t("./src/tokenizers.js");class n extends s.Processor{}ee(n,"tokenizer_class",a.AutoTokenizer),ee(n,"image_processor_class",o.AutoImageProcessor)},"./src/models/paligemma/processing_paligemma.js":(e,r,t)=>{t.r(r),t.d(r,{PaliGemmaProcessor:()=>l});var s=t("./src/base/processing_utils.js"),o=t("./src/models/auto/image_processing_auto.js"),a=t("./src/tokenizers.js");let n="<image>";function i(c,_,d,u,f){return`${u.repeat(d*f)}${_}${c}\n`}class l extends s.Processor{async _call(_,d=null,u={}){d||(console.warn("You are using PaliGemma without a text prefix. It will perform as a picture-captioning model."),d=""),Array.isArray(_)||(_=[_]),Array.isArray(d)||(d=[d]);let f=this.tokenizer.bos_token,h=this.image_processor.config.image_seq_length,v;d.some(w=>w.includes(n))?v=d.map(w=>{let C=w.replaceAll(n,n.repeat(h)),x=C.lastIndexOf(n),T=x===-1?0:x+n.length;return C.slice(0,T)+f+C.slice(T)+`\n`}):(console.warn("You are passing both `text` and `images` to `PaliGemmaProcessor`. The processor expects special image tokens in the text, as many tokens as there are images per each text. It is recommended to add `<image>` tokens in the very beginning of your text. For this call, we will infer how many images each text has and add special tokens."),v=d.map(w=>i(w,f,h,n,_.length)));let E=this.tokenizer(v,u),M=await this.image_processor(_,u);return Fe(Fe({},M),E)}}ee(l,"tokenizer_class",a.AutoTokenizer),ee(l,"image_processor_class",o.AutoImageProcessor),ee(l,"uses_processor_config",!1)},"./src/models/phi3_v/image_processing_phi3_v.js":(e,r,t)=>{t.r(r),t.d(r,{Phi3VImageProcessor:()=>_});var s=t("./src/base/image_processors_utils.js"),o=t("./src/utils/tensor.js");let a=336,n=[2,3],{ceil:i,floor:l,sqrt:c}=Math;class _ extends s.ImageProcessor{constructor(u){super(Ct(Fe({},u),{do_normalize:!0,do_pad:!0,pad_size:"custom",do_convert_rgb:!0,do_resize:!0})),this._num_crops=u.num_crops}calc_num_image_tokens_from_image_size(u,f){let{num_img_tokens:h}=this.config;return l((l(f/a)*l(u/a)+1)*h+1+(l(f/a)+1)*c(h))}get_resize_output_image_size(u,f){let h=this._num_crops,[v,E]=u.size,M=v/E,w=1;for(;w*Math.ceil(w/M)<=h;)w+=1;w-=1;let C=Math.floor(w*336),x=Math.floor(C/M);return[C,x]}pad_image(u,f,h,v={}){let[E,M]=f,w=a*i(E/a),C=a*i(M/a),x=[1,1,1].map((T,S)=>(T-this.image_mean[S])/this.image_std[S]);return super.pad_image(u,f,{width:C,height:w},Fe({center:!0,constant_values:x},v))}async _call(u,{num_crops:f=null}={}){if(this._num_crops=f!=null?f:f=this.config.num_crops,f<4||c(f)%1!==0)throw new Error("num_crops must be a square number >= 4");Array.isArray(u)||(u=[u]);let h=u.length,v=await Promise.all(u.map(g=>this.preprocess(g))),E=v.map(g=>g.original_size),M=v.map(g=>g.reshaped_input_size),w=[];for(let{pixel_values:g}of v){g.unsqueeze_(0);let[P,$]=g.dims.slice(-2),A=await(0,o.interpolate_4d)(g,{size:[a,a],mode:"bicubic"});if(f>0){let N=[],W=c(f),R=l($/W),J=l(P/W);for(let q=0;q<W;++q)for(let X=0;X<W;++X){let ae,ce,he,B;q===W-1?(ce=P-J,B=P):(ce=q*J,B=(q+1)*J),X===W-1?(ae=$-R,he=$):(ae=X*R,he=(X+1)*R);let D=[ce,ae],K=[B,he],re=await(0,o.slice)(g,D,K,n);N.push(re)}let H=await(0,o.interpolate_4d)((0,o.cat)(N,0),{size:[a,a],mode:"bicubic"});w.push((0,o.cat)([A,H],0))}else w.push(A)}let C=(0,o.stack)(w,0),x=M.map(g=>g.map(P=>a*i(P/a))),T=new o.Tensor("int64",x.flat(),[h,2]),S=x.map(([g,P])=>this.calc_num_image_tokens_from_image_size(P,g));return{pixel_values:C,original_sizes:E,reshaped_input_sizes:M,image_sizes:T,num_img_tokens:S}}}},"./src/models/phi3_v/processing_phi3_v.js":(e,r,t)=>{t.r(r),t.d(r,{Phi3VProcessor:()=>c});var s=t("./src/base/processing_utils.js"),o=t("./src/models/auto/image_processing_auto.js"),a=t("./src/tokenizers.js"),n=t("./src/utils/image.js");let i="<|image|>",l=/<\\|image_\\d+\\|>/g;class c extends s.Processor{async _call(d,u=null,{padding:f=!0,truncation:h=!0,num_crops:v=null}={}){Array.isArray(d)||(d=[d]);let E,M;if(u){M=await this.image_processor(u,{num_crops:v});let{num_img_tokens:w}=M,C=d.map((T,S)=>T.split(l).join(i.repeat(w[S])));E=this.tokenizer(C,{padding:f,truncation:h});let x=this.tokenizer.model.convert_tokens_to_ids([i])[0];E.input_ids.map_(T=>T==x?-T:T)}else E=this.tokenizer(d);return Fe(Fe({},E),M)}}ee(c,"image_processor_class",o.AutoImageProcessor),ee(c,"tokenizer_class",a.AutoTokenizer)},"./src/models/processors.js":(e,r,t)=>{t.r(r),t.d(r,{Florence2Processor:()=>s.Florence2Processor,Gemma3nProcessor:()=>o.Gemma3nProcessor,GroundingDinoProcessor:()=>a.GroundingDinoProcessor,Idefics3Processor:()=>n.Idefics3Processor,JinaCLIPProcessor:()=>l.JinaCLIPProcessor,LlavaProcessor:()=>c.LlavaProcessor,MgpstrProcessor:()=>_.MgpstrProcessor,MoonshineProcessor:()=>d.MoonshineProcessor,OwlViTProcessor:()=>u.OwlViTProcessor,PaliGemmaProcessor:()=>h.PaliGemmaProcessor,Phi3VProcessor:()=>f.Phi3VProcessor,PyAnnoteProcessor:()=>v.PyAnnoteProcessor,Qwen2VLProcessor:()=>E.Qwen2VLProcessor,SamProcessor:()=>M.SamProcessor,SmolVLMProcessor:()=>w.SmolVLMProcessor,SpeechT5Processor:()=>C.SpeechT5Processor,UltravoxProcessor:()=>x.UltravoxProcessor,VLChatProcessor:()=>i.VLChatProcessor,Wav2Vec2Processor:()=>T.Wav2Vec2Processor,Wav2Vec2ProcessorWithLM:()=>S.Wav2Vec2ProcessorWithLM,WhisperProcessor:()=>g.WhisperProcessor});var s=t("./src/models/florence2/processing_florence2.js"),o=t("./src/models/gemma3n/processing_gemma3n.js"),a=t("./src/models/grounding_dino/processing_grounding_dino.js"),n=t("./src/models/idefics3/processing_idefics3.js"),i=t("./src/models/janus/processing_janus.js"),l=t("./src/models/jina_clip/processing_jina_clip.js"),c=t("./src/models/llava/processing_llava.js"),_=t("./src/models/mgp_str/processing_mgp_str.js"),d=t("./src/models/moonshine/processing_moonshine.js"),u=t("./src/models/owlvit/processing_owlvit.js"),f=t("./src/models/phi3_v/processing_phi3_v.js"),h=t("./src/models/paligemma/processing_paligemma.js"),v=t("./src/models/pyannote/processing_pyannote.js"),E=t("./src/models/qwen2_vl/processing_qwen2_vl.js"),M=t("./src/models/sam/processing_sam.js"),w=t("./src/models/smolvlm/processing_smolvlm.js"),C=t("./src/models/speecht5/processing_speecht5.js"),x=t("./src/models/ultravox/processing_ultravox.js"),T=t("./src/models/wav2vec2/processing_wav2vec2.js"),S=t("./src/models/wav2vec2_with_lm/processing_wav2vec2_with_lm.js"),g=t("./src/models/whisper/processing_whisper.js")},"./src/models/pvt/image_processing_pvt.js":(e,r,t)=>{t.r(r),t.d(r,{PvtImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{}},"./src/models/pyannote/feature_extraction_pyannote.js":(e,r,t)=>{t.r(r),t.d(r,{PyAnnoteFeatureExtractor:()=>n});var s=t("./src/base/feature_extraction_utils.js"),o=t("./src/utils/tensor.js"),a=t("./src/utils/maths.js");class n extends s.FeatureExtractor{async _call(l){(0,s.validate_audio_inputs)(l,"PyAnnoteFeatureExtractor"),l instanceof Float64Array&&(l=new Float32Array(l));let c=[1,1,l.length];return{input_values:new o.Tensor("float32",l,c)}}samples_to_frames(l){return(l-this.config.offset)/this.config.step}post_process_speaker_diarization(l,c){let _=c/this.samples_to_frames(c)/this.config.sampling_rate,d=[];for(let u of l.tolist()){let f=[],h=-1;for(let v=0;v<u.length;++v){let E=(0,a.softmax)(u[v]),[M,w]=(0,a.max)(E),[C,x]=[v,v+1];w!==h?(h=w,f.push({id:w,start:C,end:x,score:M})):(f.at(-1).end=x,f.at(-1).score+=M)}d.push(f.map(({id:v,start:E,end:M,score:w})=>({id:v,start:E*_,end:M*_,confidence:w/(M-E)})))}return d}}},"./src/models/pyannote/processing_pyannote.js":(e,r,t)=>{t.r(r),t.d(r,{PyAnnoteProcessor:()=>a});var s=t("./src/base/processing_utils.js"),o=t("./src/models/pyannote/feature_extraction_pyannote.js");class a extends s.Processor{async _call(i){return await this.feature_extractor(i)}post_process_speaker_diarization(...i){return this.feature_extractor.post_process_speaker_diarization(...i)}get sampling_rate(){return this.feature_extractor.config.sampling_rate}}ee(a,"feature_extractor_class",o.PyAnnoteFeatureExtractor)},"./src/models/qwen2_vl/image_processing_qwen2_vl.js":(e,r,t)=>{t.r(r),t.d(r,{Qwen2VLImageProcessor:()=>a});var s=t("./src/base/image_processors_utils.js"),o=t("./src/utils/tensor.js");class a extends s.ImageProcessor{async _call(i,...l){let{pixel_values:c,original_sizes:_,reshaped_input_sizes:d}=await super._call(i,...l),u=c,{temporal_patch_size:f,merge_size:h,patch_size:v}=this.config;u.dims[0]===1&&(u=(0,o.cat)(Array.from({length:f},()=>u),0));let E=u.dims[0]/f,M=u.dims[1],w=Math.floor(u.dims[2]/v),C=Math.floor(u.dims[3]/v),x=u.view(E,f,M,Math.floor(w/h),h,v,Math.floor(C/h),h,v).permute(0,3,6,4,7,2,1,5,8).view(E*w*C,M*f*v*v),T=new o.Tensor("int64",[E,w,C],[1,3]);return{pixel_values:x,image_grid_thw:T,original_sizes:_,reshaped_input_sizes:d}}}},"./src/models/qwen2_vl/processing_qwen2_vl.js":(e,r,t)=>{t.r(r),t.d(r,{Qwen2VLProcessor:()=>i});var s=t("./src/base/processing_utils.js"),o=t("./src/models/auto/image_processing_auto.js"),a=t("./src/tokenizers.js"),n=t("./src/utils/image.js");class i extends s.Processor{async _call(c,_=null,...d){Array.isArray(c)||(c=[c]);let u,f;if(_&&(u=await this.image_processor(_),f=u.image_grid_thw),f){let v=this.image_processor.config.merge_size**2,E=0,M=f.tolist();c=c.map(w=>{for(;w.includes("<|image_pad|>");){let C=Number(M[E++].reduce((x,T)=>x*T,BigInt(1)));w=w.replace("<|image_pad|>","<|placeholder|>".repeat(Math.floor(C/v)))}return w.replaceAll("<|placeholder|>","<|image_pad|>")})}let h=this.tokenizer(c);return Fe(Fe({},h),u)}}ee(i,"image_processor_class",o.AutoImageProcessor),ee(i,"tokenizer_class",a.AutoTokenizer)},"./src/models/rt_detr/image_processing_rt_detr.js":(e,r,t)=>{t.r(r),t.d(r,{RTDetrImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{post_process_object_detection(...n){return(0,s.post_process_object_detection)(...n)}}},"./src/models/sam/image_processing_sam.js":(e,r,t)=>{t.r(r),t.d(r,{SamImageProcessor:()=>n});var s=t("./src/base/image_processors_utils.js"),o=t("./src/utils/core.js"),a=t("./src/utils/tensor.js");class n extends s.ImageProcessor{reshape_input_points(l,c,_,d=!1){l=structuredClone(l);let u=(0,o.calculateDimensions)(l);if(u.length===3)d||(u=[1,...u]),l=[l];else if(u.length!==4)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");for(let f=0;f<l.length;++f){let h=c[f],v=_[f],E=[v[0]/h[0],v[1]/h[1]];for(let M=0;M<l[f].length;++M)for(let w=0;w<l[f][M].length;++w)for(let C=0;C<l[f][M][w].length;++C)l[f][M][w][C]*=E[C%2]}return new a.Tensor("float32",Float32Array.from(l.flat(1/0)),u)}add_input_labels(l,c){let _=(0,o.calculateDimensions)(l);if(_.length===2)_=[1,..._],l=[l];else if(_.length!==3)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");if(_.some((d,u)=>d!==c.dims[u]))throw Error(`The first ${_.length} dimensions of \'input_points\' and \'input_labels\' must be the same.`);return new a.Tensor("int64",l.flat(1/0).map(BigInt),_)}async _call(l,{input_points:c=null,input_labels:_=null,input_boxes:d=null}={}){let u=await super._call(l);if(c&&(u.input_points=this.reshape_input_points(c,u.original_sizes,u.reshaped_input_sizes)),_){if(!u.input_points)throw Error("`input_points` must be provided if `input_labels` are provided.");u.input_labels=this.add_input_labels(_,u.input_points)}return d&&(u.input_boxes=this.reshape_input_points(d,u.original_sizes,u.reshaped_input_sizes,!0)),u}async post_process_masks(l,c,_,{mask_threshold:d=0,binarize:u=!0,pad_size:f=null}={}){let h=[];f=f!=null?f:this.pad_size;let v=[f.height,f.width];for(let E=0;E<c.length;++E){let M=c[E],w=_[E],C=await(0,a.interpolate_4d)(l[E],{mode:"bilinear",size:v});if(C=C.slice(null,null,[0,w[0]],[0,w[1]]),C=await(0,a.interpolate_4d)(C,{mode:"bilinear",size:M}),u){let x=C.data,T=new Uint8Array(x.length);for(let S=0;S<x.length;++S)x[S]>d&&(T[S]=1);C=new a.Tensor("bool",T,C.dims)}h.push(C)}return h}generate_crop_boxes(l,c,{crop_n_layers:_=0,overlap_ratio:d=512/1500,points_per_crop:u=32,crop_n_points_downscale_factor:f=1}={}){}}},"./src/models/sam/processing_sam.js":(e,r,t)=>{t.r(r),t.d(r,{SamProcessor:()=>a});var s=t("./src/base/processing_utils.js"),o=t("./src/models/auto/image_processing_auto.js");class a extends s.Processor{async _call(...i){return await this.image_processor(...i)}post_process_masks(...i){return this.image_processor.post_process_masks(...i)}reshape_input_points(...i){return this.image_processor.reshape_input_points(...i)}}ee(a,"image_processor_class",o.AutoImageProcessor)},"./src/models/seamless_m4t/feature_extraction_seamless_m4t.js":(e,r,t)=>{t.r(r),t.d(r,{SeamlessM4TFeatureExtractor:()=>n});var s=t("./src/base/feature_extraction_utils.js"),o=t("./src/utils/tensor.js"),a=t("./src/utils/audio.js");class n extends s.FeatureExtractor{constructor(l){super(l);let c=this.config.sampling_rate,_=(0,a.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(c/2),c,null,"kaldi",!0);this.mel_filters=_,this.window=(0,a.window_function)(400,"povey",{periodic:!1})}async _extract_fbank_features(l,c){return l=l.map(_=>_*32768),(0,a.spectrogram)(l,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:c,transpose:!0})}async _call(l,{padding:c=!0,pad_to_multiple_of:_=2,do_normalize_per_mel_bins:d=!0,return_attention_mask:u=!0}={}){(0,s.validate_audio_inputs)(l,"SeamlessM4TFeatureExtractor");let f=await this._extract_fbank_features(l,this.config.max_length);if(d){let[T,S]=f.dims,g=f.data;for(let P=0;P<S;++P){let $=0;for(let R=0;R<T;++R)$+=g[R*S+P];let A=$/T,N=0;for(let R=0;R<T;++R)N+=(g[R*S+P]-A)**2;N/=T-1;let W=Math.sqrt(N+1e-7);for(let R=0;R<T;++R){let J=R*S+P;g[J]=(g[J]-A)/W}}}let h;if(c){let[T,S]=f.dims,g=f.data,P=T%_;if(P>0){let $=new Float32Array(S*(T+P));$.set(g),$.fill(this.config.padding_value,g.length);let A=T+P;f=new o.Tensor(f.type,$,[A,S]),u&&(h=new o.Tensor("int64",new BigInt64Array(A),[1,A]),h.data.fill(BigInt(1),0,T))}}let[v,E]=f.dims,M=this.config.stride;if(v%M!==0)throw new Error(`The number of frames (${v}) must be a multiple of the stride (${M}).`);let C=f.view(1,Math.floor(v/M),E*M),x={input_features:C};if(u){let T=C.dims[1],S=new BigInt64Array(T);if(h){let g=h.data;for(let P=1,$=0;P<v;P+=M,++$)S[$]=g[P]}else S.fill(BigInt(1));x.attention_mask=new o.Tensor("int64",S,[1,T])}return x}}},"./src/models/segformer/image_processing_segformer.js":(e,r,t)=>{t.r(r),t.d(r,{SegformerFeatureExtractor:()=>a,SegformerImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{post_process_semantic_segmentation(...i){return(0,s.post_process_semantic_segmentation)(...i)}}class a extends o{}},"./src/models/siglip/image_processing_siglip.js":(e,r,t)=>{t.r(r),t.d(r,{SiglipImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{}},"./src/models/smolvlm/image_processing_smolvlm.js":(e,r,t)=>{t.r(r),t.d(r,{SmolVLMImageProcessor:()=>s.Idefics3ImageProcessor});var s=t("./src/models/idefics3/image_processing_idefics3.js")},"./src/models/smolvlm/processing_smolvlm.js":(e,r,t)=>{t.r(r),t.d(r,{SmolVLMProcessor:()=>s.Idefics3Processor});var s=t("./src/models/idefics3/processing_idefics3.js")},"./src/models/snac/feature_extraction_snac.js":(e,r,t)=>{t.r(r),t.d(r,{SnacFeatureExtractor:()=>o});var s=t("./src/models/dac/feature_extraction_dac.js");class o extends s.DacFeatureExtractor{}},"./src/models/speecht5/feature_extraction_speecht5.js":(e,r,t)=>{t.r(r),t.d(r,{SpeechT5FeatureExtractor:()=>o});var s=t("./src/base/feature_extraction_utils.js");class o extends s.FeatureExtractor{}},"./src/models/speecht5/processing_speecht5.js":(e,r,t)=>{t.r(r),t.d(r,{SpeechT5Processor:()=>n});var s=t("./src/base/processing_utils.js"),o=t("./src/tokenizers.js"),a=t("./src/models/auto/feature_extraction_auto.js");class n extends s.Processor{async _call(l){return await this.feature_extractor(l)}}ee(n,"tokenizer_class",o.AutoTokenizer),ee(n,"feature_extractor_class",a.AutoFeatureExtractor)},"./src/models/swin2sr/image_processing_swin2sr.js":(e,r,t)=>{t.r(r),t.d(r,{Swin2SRImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{pad_image(n,i,l,c={}){let[_,d,u]=i;return super.pad_image(n,i,{width:d+(l-d%l)%l,height:_+(l-_%l)%l},Fe({mode:"symmetric",center:!1,constant_values:-1},c))}}},"./src/models/ultravox/processing_ultravox.js":(e,r,t)=>{t.r(r),t.d(r,{UltravoxProcessor:()=>n});var s=t("./src/models/auto/feature_extraction_auto.js"),o=t("./src/tokenizers.js"),a=t("./src/base/processing_utils.js");class n extends a.Processor{async _call(l,c=null,_={}){if(Array.isArray(l))throw new Error("Batched inputs are not supported yet.");let d={};if(c){let f=c.length,{input_features:h}=await this.feature_extractor(c,Ct(Fe({},_),{max_length:f})),v=Math.round(f/this.config.encoder_ds_factor+1e-4),E=1+Math.ceil(v/this.config.stack_factor);d.audio_token_len=[E],d.audio_values=h;let M=this.config.audio_placeholder;if(!l.includes(M))throw new Error(`The input text does not contain the image token ${M}.`);l=l.replaceAll(M,M.repeat(E))}let u=this.tokenizer(l,Fe({add_special_tokens:!1},_));return Fe(Fe({},u),d)}}ee(n,"tokenizer_class",o.AutoTokenizer),ee(n,"feature_extractor_class",s.AutoFeatureExtractor),ee(n,"uses_processor_config",!0)},"./src/models/vit/image_processing_vit.js":(e,r,t)=>{t.r(r),t.d(r,{ViTFeatureExtractor:()=>a,ViTImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{}class a extends o{}},"./src/models/vitmatte/image_processing_vitmatte.js":(e,r,t)=>{t.r(r),t.d(r,{VitMatteImageProcessor:()=>a});var s=t("./src/base/image_processors_utils.js"),o=t("./src/utils/tensor.js");class a extends s.ImageProcessor{async _call(i,l){Array.isArray(i)||(i=[i]),Array.isArray(l)||(l=[l]);let c=await Promise.all(i.map(u=>this.preprocess(u))),_=await Promise.all(l.map(u=>this.preprocess(u,{do_normalize:!1,do_convert_rgb:!1,do_convert_grayscale:!0})));return{pixel_values:(0,o.stack)(c.map((u,f)=>(0,o.cat)([u.pixel_values,_[f].pixel_values],0)),0),original_sizes:c.map(u=>u.original_size),reshaped_input_sizes:c.map(u=>u.reshaped_input_size)}}}},"./src/models/vitpose/image_processing_vitpose.js":(e,r,t)=>{t.r(r),t.d(r,{VitPoseImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{post_process_pose_estimation(n,i,{threshold:l=null}={}){let c=n.tolist(),[_,d,u,f]=n.dims,h=[];for(let v=0;v<_;++v){let E=c[v],M=i[v],w=[];for(let C=0;C<M.length;++C){let x=M[C],T=[],S=[],g=[],P=x.at(-2)/f,$=x.at(-1)/u;for(let A=0;A<E.length;++A){let[N,W]=[0,0],R=0,J=-1/0,H=E[A];for(let X=0;X<H.length;++X){let ae=H[X];for(let ce=0;ce<ae.length;++ce){let he=ae[ce];R+=he,J=Math.max(J,he),N+=(ce+.5)*he,W+=X*he}}if(l!=null&&J<l)continue;let q=[P*N/R,$*W/R];T.push(q),g.push(A),S.push(J)}w.push({bbox:x,scores:S,labels:g,keypoints:T})}h.push(w)}return h}}},"./src/models/wav2vec2/feature_extraction_wav2vec2.js":(e,r,t)=>{t.r(r),t.d(r,{Wav2Vec2FeatureExtractor:()=>a});var s=t("./src/base/feature_extraction_utils.js"),o=t("./src/utils/tensor.js");class a extends s.FeatureExtractor{_zero_mean_unit_var_norm(i){let c=i.reduce((d,u)=>d+u,0)/i.length,_=i.reduce((d,u)=>d+(u-c)**2,0)/i.length;return i.map(d=>(d-c)/Math.sqrt(_+1e-7))}async _call(i){(0,s.validate_audio_inputs)(i,"Wav2Vec2FeatureExtractor"),i instanceof Float64Array&&(i=new Float32Array(i));let l=i;this.config.do_normalize&&(l=this._zero_mean_unit_var_norm(l));let c=[1,l.length];return{input_values:new o.Tensor("float32",l,c),attention_mask:new o.Tensor("int64",new BigInt64Array(l.length).fill(BigInt(1)),c)}}}},"./src/models/wav2vec2/processing_wav2vec2.js":(e,r,t)=>{t.r(r),t.d(r,{Wav2Vec2Processor:()=>n});var s=t("./src/tokenizers.js"),o=t("./src/models/auto/feature_extraction_auto.js"),a=t("./src/base/processing_utils.js");class n extends a.Processor{async _call(l){return await this.feature_extractor(l)}}ee(n,"tokenizer_class",s.AutoTokenizer),ee(n,"feature_extractor_class",o.AutoFeatureExtractor)},"./src/models/wav2vec2_with_lm/processing_wav2vec2_with_lm.js":(e,r,t)=>{t.r(r),t.d(r,{Wav2Vec2ProcessorWithLM:()=>n});var s=t("./src/tokenizers.js"),o=t("./src/models/auto/feature_extraction_auto.js"),a=t("./src/base/processing_utils.js");class n extends a.Processor{async _call(l){return await this.feature_extractor(l)}}ee(n,"tokenizer_class",s.AutoTokenizer),ee(n,"feature_extractor_class",o.AutoFeatureExtractor)},"./src/models/wespeaker/feature_extraction_wespeaker.js":(e,r,t)=>{t.r(r),t.d(r,{WeSpeakerFeatureExtractor:()=>n});var s=t("./src/base/feature_extraction_utils.js"),o=t("./src/utils/tensor.js"),a=t("./src/utils/audio.js");class n extends s.FeatureExtractor{constructor(l){super(l);let c=this.config.sampling_rate,_=(0,a.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(c/2),c,null,"kaldi",!0);this.mel_filters=_,this.window=(0,a.window_function)(400,"hamming",{periodic:!1}),this.min_num_frames=this.config.min_num_frames}async _extract_fbank_features(l){return l=l.map(c=>c*32768),(0,a.spectrogram)(l,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,transpose:!0,min_num_frames:this.min_num_frames})}async _call(l){(0,s.validate_audio_inputs)(l,"WeSpeakerFeatureExtractor");let c=(await this._extract_fbank_features(l)).unsqueeze_(0);if(this.config.fbank_centering_span===null){let _=c.mean(1).data,d=c.data,[u,f,h]=c.dims;for(let v=0;v<u;++v){let E=v*f*h,M=v*h;for(let w=0;w<f;++w){let C=E+w*h;for(let x=0;x<h;++x)d[C+x]-=_[M+x]}}}return{input_features:c}}}},"./src/models/whisper/common_whisper.js":(e,r,t)=>{t.r(r),t.d(r,{WHISPER_LANGUAGE_MAPPING:()=>o,WHISPER_TO_LANGUAGE_CODE_MAPPING:()=>a,whisper_language_to_code:()=>n});let s=[["en","english"],["zh","chinese"],["de","german"],["es","spanish"],["ru","russian"],["ko","korean"],["fr","french"],["ja","japanese"],["pt","portuguese"],["tr","turkish"],["pl","polish"],["ca","catalan"],["nl","dutch"],["ar","arabic"],["sv","swedish"],["it","italian"],["id","indonesian"],["hi","hindi"],["fi","finnish"],["vi","vietnamese"],["he","hebrew"],["uk","ukrainian"],["el","greek"],["ms","malay"],["cs","czech"],["ro","romanian"],["da","danish"],["hu","hungarian"],["ta","tamil"],["no","norwegian"],["th","thai"],["ur","urdu"],["hr","croatian"],["bg","bulgarian"],["lt","lithuanian"],["la","latin"],["mi","maori"],["ml","malayalam"],["cy","welsh"],["sk","slovak"],["te","telugu"],["fa","persian"],["lv","latvian"],["bn","bengali"],["sr","serbian"],["az","azerbaijani"],["sl","slovenian"],["kn","kannada"],["et","estonian"],["mk","macedonian"],["br","breton"],["eu","basque"],["is","icelandic"],["hy","armenian"],["ne","nepali"],["mn","mongolian"],["bs","bosnian"],["kk","kazakh"],["sq","albanian"],["sw","swahili"],["gl","galician"],["mr","marathi"],["pa","punjabi"],["si","sinhala"],["km","khmer"],["sn","shona"],["yo","yoruba"],["so","somali"],["af","afrikaans"],["oc","occitan"],["ka","georgian"],["be","belarusian"],["tg","tajik"],["sd","sindhi"],["gu","gujarati"],["am","amharic"],["yi","yiddish"],["lo","lao"],["uz","uzbek"],["fo","faroese"],["ht","haitian creole"],["ps","pashto"],["tk","turkmen"],["nn","nynorsk"],["mt","maltese"],["sa","sanskrit"],["lb","luxembourgish"],["my","myanmar"],["bo","tibetan"],["tl","tagalog"],["mg","malagasy"],["as","assamese"],["tt","tatar"],["haw","hawaiian"],["ln","lingala"],["ha","hausa"],["ba","bashkir"],["jw","javanese"],["su","sundanese"]],o=new Map(s),a=new Map([...s.map(([i,l])=>[l,i]),["burmese","my"],["valencian","ca"],["flemish","nl"],["haitian","ht"],["letzeburgesch","lb"],["pushto","ps"],["panjabi","pa"],["moldavian","ro"],["moldovan","ro"],["sinhalese","si"],["castilian","es"]]);function n(i){i=i.toLowerCase();let l=a.get(i);if(l===void 0){let c=i.match(/^<\\|([a-z]{2})\\|>$/);if(c&&(i=c[1]),o.has(i))l=i;else{let d=i.length===2?o.keys():o.values();throw new Error(`Language "${i}" is not supported. Must be one of: ${JSON.stringify(Array.from(d))}`)}}return l}},"./src/models/whisper/feature_extraction_whisper.js":(e,r,t)=>{t.r(r),t.d(r,{WhisperFeatureExtractor:()=>i});var s=t("./src/base/feature_extraction_utils.js"),o=t("./src/utils/tensor.js"),a=t("./src/utils/audio.js"),n=t("./src/utils/maths.js");class i extends s.FeatureExtractor{constructor(c){var _,d;super(c),(d=(_=this.config).mel_filters)!=null||(_.mel_filters=(0,a.mel_filter_bank)(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,8e3,this.config.sampling_rate,"slaney","slaney")),this.window=(0,a.window_function)(this.config.n_fft,"hann")}async _extract_fbank_features(c){let _=await(0,a.spectrogram)(c,this.window,this.config.n_fft,this.config.hop_length,{power:2,mel_filters:this.config.mel_filters,log_mel:"log10",max_num_frames:Math.min(Math.floor(c.length/this.config.hop_length),this.config.nb_max_frames)}),d=_.data,u=(0,n.max)(d)[0];for(let f=0;f<d.length;++f)d[f]=(Math.max(d[f],u-8)+4)/4;return _}async _call(c,{max_length:_=null}={}){(0,s.validate_audio_inputs)(c,"WhisperFeatureExtractor");let d,u=_!=null?_:this.config.n_samples;return c.length>u?(c.length>this.config.n_samples&&console.warn("Attempting to extract features for audio longer than 30 seconds. If using a pipeline to extract transcript from a long audio clip, remember to specify `chunk_length_s` and/or `stride_length_s`."),d=c.slice(0,u)):(d=new Float32Array(u),d.set(c)),{input_features:(await this._extract_fbank_features(d)).unsqueeze_(0)}}}},"./src/models/whisper/generation_whisper.js":(e,r,t)=>{t.r(r),t.d(r,{WhisperGenerationConfig:()=>o});var s=t("./src/generation/configuration_utils.js");class o extends s.GenerationConfig{constructor(){super(...arguments);ee(this,"return_timestamps",null);ee(this,"return_token_timestamps",null);ee(this,"num_frames",null);ee(this,"alignment_heads",null);ee(this,"task",null);ee(this,"language",null);ee(this,"no_timestamps_token_id",null);ee(this,"prompt_ids",null);ee(this,"is_multilingual",null);ee(this,"lang_to_id",null);ee(this,"task_to_id",null);ee(this,"max_initial_timestamp_index",1)}}},"./src/models/whisper/processing_whisper.js":(e,r,t)=>{t.r(r),t.d(r,{WhisperProcessor:()=>n});var s=t("./src/models/auto/feature_extraction_auto.js"),o=t("./src/tokenizers.js"),a=t("./src/base/processing_utils.js");class n extends a.Processor{async _call(l){return await this.feature_extractor(l)}}ee(n,"tokenizer_class",o.AutoTokenizer),ee(n,"feature_extractor_class",s.AutoFeatureExtractor)},"./src/models/yolos/image_processing_yolos.js":(e,r,t)=>{t.r(r),t.d(r,{YolosFeatureExtractor:()=>a,YolosImageProcessor:()=>o});var s=t("./src/base/image_processors_utils.js");class o extends s.ImageProcessor{post_process_object_detection(...i){return(0,s.post_process_object_detection)(...i)}}class a extends o{}},"./src/ops/registry.js":(e,r,t)=>{t.r(r),t.d(r,{TensorOpRegistry:()=>l});var s=t("./src/backends/onnx.js"),o=t("./src/utils/tensor.js"),a=t("./src/env.js");let n=a.apis.IS_BROWSER_ENV||a.apis.IS_WEBWORKER_ENV,i=async(c,_,d)=>{let u=await(0,s.createInferenceSession)(new Uint8Array(c),_),f=Promise.resolve();return async h=>{let v=(0,s.isONNXProxy)(),E=Object.fromEntries(Object.entries(h).map(([w,C])=>[w,(v?C.clone():C).ort_tensor])),M=await(f=n?f.then(()=>u.run(E)):u.run(E));return Array.isArray(d)?d.map(w=>new o.Tensor(M[w])):new o.Tensor(M[d])}};class l{static get nearest_interpolate_4d(){return this._nearest_interpolate_4d||(this._nearest_interpolate_4d=i([8,10,18,0,58,129,1,10,41,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,18,10,4,109,111,100,101,34,7,110,101,97,114,101,115,116,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,21],this.session_options,"y")),this._nearest_interpolate_4d}static get bilinear_interpolate_4d(){return this._bilinear_interpolate_4d||(this._bilinear_interpolate_4d=i([8,9,18,0,58,128,1,10,40,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,17,10,4,109,111,100,101,34,6,108,105,110,101,97,114,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y")),this._bilinear_interpolate_4d}static get bicubic_interpolate_4d(){return this._bicubic_interpolate_4d||(this._bicubic_interpolate_4d=i([8,9,18,0,58,127,10,39,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,16,10,4,109,111,100,101,34,5,99,117,98,105,99,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y")),this._bicubic_interpolate_4d}static get matmul(){return this._matmul||(this._matmul=i([8,9,18,0,58,55,10,17,10,1,97,10,1,98,18,1,99,34,6,77,97,116,77,117,108,18,1,114,90,9,10,1,97,18,4,10,2,8,1,90,9,10,1,98,18,4,10,2,8,1,98,9,10,1,99,18,4,10,2,8,1,66,2,16,20],this.session_options,"c")),this._matmul}static get stft(){return this._stft||(this._stft=i([8,7,18,0,58,148,1,10,38,10,1,115,10,1,106,10,1,119,10,1,108,18,1,111,34,4,83,84,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,115,90,26,10,1,115,18,21,10,19,8,1,18,15,10,3,18,1,98,10,3,18,1,115,10,3,18,1,99,90,11,10,1,106,18,6,10,4,8,7,18,0,90,16,10,1,119,18,11,10,9,8,1,18,5,10,3,18,1,119,90,11,10,1,108,18,6,10,4,8,7,18,0,98,31,10,1,111,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,102,10,3,18,1,100,10,3,18,1,99,66,2,16,17],this.session_options,"o")),this._stft}static get rfft(){return this._rfft||(this._rfft=i([8,9,18,0,58,97,10,33,10,1,120,10,0,10,1,97,18,1,121,34,3,68,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,100,90,21,10,1,120,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,90,11,10,1,97,18,6,10,4,8,7,18,0,98,21,10,1,121,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,66,2,16,20],this.session_options,"y")),this._rfft}static get top_k(){return this._top_k||(this._top_k=i([8,10,18,0,58,73,10,18,10,1,120,10,1,107,18,1,118,18,1,105,34,4,84,111,112,75,18,1,116,90,9,10,1,120,18,4,10,2,8,1,90,15,10,1,107,18,10,10,8,8,7,18,4,10,2,8,1,98,9,10,1,118,18,4,10,2,8,1,98,9,10,1,105,18,4,10,2,8,7,66,2,16,21],this.session_options,["v","i"])),this._top_k}static get slice(){return this._slice||(this._slice=i([8,7,18,0,58,96,10,25,10,1,120,10,1,115,10,1,101,10,1,97,10,1,116,18,1,121,34,5,83,108,105,99,101,18,1,114,90,9,10,1,120,18,4,10,2,8,1,90,9,10,1,115,18,4,10,2,8,7,90,9,10,1,101,18,4,10,2,8,7,90,9,10,1,97,18,4,10,2,8,7,90,9,10,1,116,18,4,10,2,8,7,98,9,10,1,121,18,4,10,2,8,1,66,2,16,13],this.session_options,"y")),this._slice}}ee(l,"session_options",{})},"./src/pipelines.js":(e,r,t)=>{t.r(r),t.d(r,{AudioClassificationPipeline:()=>R,AutomaticSpeechRecognitionPipeline:()=>H,BackgroundRemovalPipeline:()=>ce,DepthEstimationPipeline:()=>oe,DocumentQuestionAnsweringPipeline:()=>K,FeatureExtractionPipeline:()=>N,FillMaskPipeline:()=>x,ImageClassificationPipeline:()=>X,ImageFeatureExtractionPipeline:()=>W,ImageSegmentationPipeline:()=>ae,ImageToImagePipeline:()=>me,ImageToTextPipeline:()=>q,ObjectDetectionPipeline:()=>B,Pipeline:()=>E,QuestionAnsweringPipeline:()=>C,SummarizationPipeline:()=>S,Text2TextGenerationPipeline:()=>T,TextClassificationPipeline:()=>M,TextGenerationPipeline:()=>$,TextToAudioPipeline:()=>re,TokenClassificationPipeline:()=>w,TranslationPipeline:()=>g,ZeroShotAudioClassificationPipeline:()=>J,ZeroShotClassificationPipeline:()=>A,ZeroShotImageClassificationPipeline:()=>he,ZeroShotObjectDetectionPipeline:()=>D,pipeline:()=>We});var s=t("./src/tokenizers.js"),o=t("./src/models.js"),a=t("./src/models/auto/processing_auto.js"),n=t("./src/base/processing_utils.js"),i=t("./src/utils/generic.js"),l=t("./src/utils/core.js"),c=t("./src/utils/maths.js"),_=t("./src/utils/audio.js"),d=t("./src/utils/tensor.js"),u=t("./src/utils/image.js");async function f(ie){return Array.isArray(ie)||(ie=[ie]),await Promise.all(ie.map(Y=>u.RawImage.read(Y)))}async function h(ie,Y){return Array.isArray(ie)||(ie=[ie]),await Promise.all(ie.map(j=>typeof j=="string"||j instanceof URL?(0,_.read_audio)(j,Y):j instanceof Float64Array?new Float32Array(j):j))}function v(ie,Y){Y&&(ie=ie.map(xe=>xe|0));let[j,fe,ve,Ie]=ie;return{xmin:j,ymin:fe,xmax:ve,ymax:Ie}}class E extends i.Callable{constructor({task:Y,model:j,tokenizer:fe=null,processor:ve=null}){super(),this.task=Y,this.model=j,this.tokenizer=fe,this.processor=ve}async dispose(){await this.model.dispose()}}class M extends E{constructor(Y){super(Y)}async _call(Y,{top_k:j=1}={}){let fe=this.tokenizer(Y,{padding:!0,truncation:!0}),ve=await this.model(fe),Ie=this.model.config.problem_type==="multi_label_classification"?Pe=>Pe.sigmoid():Pe=>new d.Tensor("float32",(0,c.softmax)(Pe.data),Pe.dims),xe=this.model.config.id2label,ke=[];for(let Pe of ve.logits){let He=Ie(Pe),Ue=await(0,d.topk)(He,j),qe=Ue[0].tolist(),Re=Ue[1].tolist().map((tt,Qe)=>({label:xe?xe[tt]:`LABEL_${tt}`,score:qe[Qe]}));j===1?ke.push(...Re):ke.push(Re)}return Array.isArray(Y)||j===1?ke:ke[0]}}class w extends E{constructor(Y){super(Y)}async _call(Y,{ignore_labels:j=["O"]}={}){let fe=Array.isArray(Y),ve=this.tokenizer(fe?Y:[Y],{padding:!0,truncation:!0}),xe=(await this.model(ve)).logits,ke=this.model.config.id2label,Pe=[];for(let He=0;He<xe.dims[0];++He){let Ue=ve.input_ids[He],qe=xe[He],Ke=[];for(let Re=0;Re<qe.dims[0];++Re){let tt=qe[Re],Qe=(0,c.max)(tt.data)[1],at=ke?ke[Qe]:`LABEL_${Qe}`;if(j.includes(at))continue;let it=this.tokenizer.decode([Ue[Re].item()],{skip_special_tokens:!0});if(it==="")continue;let Ne=(0,c.softmax)(tt.data);Ke.push({entity:at,score:Ne[Qe],index:Re,word:it})}Pe.push(Ke)}return fe?Pe:Pe[0]}}class C extends E{constructor(Y){super(Y)}async _call(Y,j,{top_k:fe=1}={}){let ve=this.tokenizer(Y,{text_pair:j,padding:!0,truncation:!0}),{start_logits:Ie,end_logits:xe}=await this.model(ve),ke=ve.input_ids.tolist(),Pe=ve.attention_mask.tolist(),He=this.tokenizer.all_special_ids,Ue=[];for(let qe=0;qe<Ie.dims[0];++qe){let Ke=ke[qe],Re=Ke.findIndex(_t=>_t==this.tokenizer.sep_token_id),tt=Pe[qe].map((_t,Et)=>_t==1&&(Et===0||Et>Re&&He.findIndex(At=>At==Ke[Et])===-1)),Qe=Ie[qe].tolist(),at=xe[qe].tolist();for(let _t=1;_t<Qe.length;++_t)(Pe[qe]==0||_t<=Re||He.findIndex(Et=>Et==Ke[_t])!==-1)&&(Qe[_t]=-1/0,at[_t]=-1/0);let it=(0,c.softmax)(Qe).map((_t,Et)=>[_t,Et]),Ne=(0,c.softmax)(at).map((_t,Et)=>[_t,Et]);it[0][0]=0,Ne[0][0]=0;let et=(0,l.product)(it,Ne).filter(_t=>_t[0][1]<=_t[1][1]).map(_t=>[_t[0][1],_t[1][1],_t[0][0]*_t[1][0]]).sort((_t,Et)=>Et[2]-_t[2]);for(let _t=0;_t<Math.min(et.length,fe);++_t){let[Et,At,Bt]=et[_t],ar=Ke.slice(Et,At+1),ft=this.tokenizer.decode(ar,{skip_special_tokens:!0});Ue.push({answer:ft,score:Bt})}}return fe===1?Ue[0]:Ue}}class x extends E{constructor(Y){super(Y)}async _call(Y,{top_k:j=5}={}){let fe=this.tokenizer(Y,{padding:!0,truncation:!0}),{logits:ve}=await this.model(fe),Ie=[],xe=fe.input_ids.tolist();for(let ke=0;ke<xe.length;++ke){let Pe=xe[ke],He=Pe.findIndex(tt=>tt==this.tokenizer.mask_token_id);if(He===-1)throw Error(`Mask token (${this.tokenizer.mask_token}) not found in text.`);let Ue=ve[ke][He],qe=await(0,d.topk)(new d.Tensor("float32",(0,c.softmax)(Ue.data),Ue.dims),j),Ke=qe[0].tolist(),Re=qe[1].tolist();Ie.push(Re.map((tt,Qe)=>{let at=Pe.slice();return at[He]=tt,{score:Ke[Qe],token:Number(tt),token_str:this.tokenizer.decode([tt]),sequence:this.tokenizer.decode(at,{skip_special_tokens:!0})}}))}return Array.isArray(Y)?Ie:Ie[0]}}class T extends E{constructor(j){super(j);ee(this,"_key","generated_text")}async _call(j,fe={}){Array.isArray(j)||(j=[j]),this.model.config.prefix&&(j=j.map(He=>this.model.config.prefix+He));let ve=this.model.config.task_specific_params;ve&&ve[this.task]&&ve[this.task].prefix&&(j=j.map(He=>ve[this.task].prefix+He));let Ie=this.tokenizer,xe={padding:!0,truncation:!0},ke;this instanceof g&&"_build_translation_inputs"in Ie?ke=Ie._build_translation_inputs(j,xe,fe):ke=Ie(j,xe);let Pe=await this.model.generate(Fe(Fe({},ke),fe));return Ie.batch_decode(Pe,{skip_special_tokens:!0}).map(He=>({[this._key]:He}))}}class S extends T{constructor(j){super(j);ee(this,"_key","summary_text")}}class g extends T{constructor(j){super(j);ee(this,"_key","translation_text")}}function P(ie){return Array.isArray(ie)&&ie.every(Y=>"role"in Y&&"content"in Y)}class $ extends E{constructor(Y){super(Y)}async _call(Y,j={}){var Re,tt;let fe=!1,ve=!1,Ie;if(typeof Y=="string")Ie=Y=[Y];else if(Array.isArray(Y)&&Y.every(Qe=>typeof Qe=="string"))fe=!0,Ie=Y;else{if(P(Y))Y=[Y];else if(Array.isArray(Y)&&Y.every(P))fe=!0;else throw new Error("Input must be a string, an array of strings, a Chat, or an array of Chats");ve=!0,Ie=Y.map(Qe=>this.tokenizer.apply_chat_template(Qe,{tokenize:!1,add_generation_prompt:!0}))}let xe=(Re=j.add_special_tokens)!=null?Re:!1,ke=ve?!1:(tt=j.return_full_text)!=null?tt:!0;this.tokenizer.padding_side="left";let Pe=this.tokenizer(Ie,{add_special_tokens:xe,padding:!0,truncation:!0}),He=await this.model.generate(Fe(Fe({},Pe),j)),Ue=this.tokenizer.batch_decode(He,{skip_special_tokens:!0}),qe;!ke&&Pe.input_ids.dims.at(-1)>0&&(qe=this.tokenizer.batch_decode(Pe.input_ids,{skip_special_tokens:!0}).map(Qe=>Qe.length));let Ke=Array.from({length:Y.length},Qe=>[]);for(let Qe=0;Qe<Ue.length;++Qe){let at=Math.floor(Qe/He.dims[0]*Y.length);qe&&(Ue[Qe]=Ue[Qe].slice(qe[at])),Ke[at].push({generated_text:ve?[...Y[at],{role:"assistant",content:Ue[Qe]}]:Ue[Qe]})}return!fe&&Ke.length===1?Ke[0]:Ke}}class A extends E{constructor(Y){var j;super(Y),this.label2id=Object.fromEntries(Object.entries(this.model.config.label2id).map(([fe,ve])=>[fe.toLowerCase(),ve])),this.entailment_id=this.label2id.entailment,this.entailment_id===void 0&&(console.warn("Could not find \'entailment\' in label2id mapping. Using 2 as entailment_id."),this.entailment_id=2),this.contradiction_id=(j=this.label2id.contradiction)!=null?j:this.label2id.not_entailment,this.contradiction_id===void 0&&(console.warn("Could not find \'contradiction\' in label2id mapping. Using 0 as contradiction_id."),this.contradiction_id=0)}async _call(Y,j,{hypothesis_template:fe="This example is {}.",multi_label:ve=!1}={}){let Ie=Array.isArray(Y);Ie||(Y=[Y]),Array.isArray(j)||(j=[j]);let xe=j.map(He=>fe.replace("{}",He)),ke=ve||j.length===1,Pe=[];for(let He of Y){let Ue=[];for(let Re of xe){let tt=this.tokenizer(He,{text_pair:Re,padding:!0,truncation:!0}),Qe=await this.model(tt);ke?Ue.push([Qe.logits.data[this.contradiction_id],Qe.logits.data[this.entailment_id]]):Ue.push(Qe.logits.data[this.entailment_id])}let Ke=(ke?Ue.map(Re=>(0,c.softmax)(Re)[1]):(0,c.softmax)(Ue)).map((Re,tt)=>[Re,tt]).sort((Re,tt)=>tt[0]-Re[0]);Pe.push({sequence:He,labels:Ke.map(Re=>j[Re[1]]),scores:Ke.map(Re=>Re[0])})}return Ie?Pe:Pe[0]}}class N extends E{constructor(Y){super(Y)}async _call(Y,{pooling:j="none",normalize:fe=!1,quantize:ve=!1,precision:Ie="binary"}={}){var He,Ue;let xe=this.tokenizer(Y,{padding:!0,truncation:!0}),ke=await this.model(xe),Pe=(Ue=(He=ke.last_hidden_state)!=null?He:ke.logits)!=null?Ue:ke.token_embeddings;switch(j){case"none":break;case"mean":Pe=(0,d.mean_pooling)(Pe,xe.attention_mask);break;case"first_token":case"cls":Pe=Pe.slice(null,0);break;case"last_token":case"eos":Pe=Pe.slice(null,-1);break;default:throw Error(`Pooling method \'${j}\' not supported.`)}return fe&&(Pe=Pe.normalize(2,-1)),ve&&(Pe=(0,d.quantize_embeddings)(Pe,Ie)),Pe}}class W extends E{constructor(Y){super(Y)}async _call(Y,{pool:j=null}={}){var ke,Pe;let fe=await f(Y),{pixel_values:ve}=await this.processor(fe),Ie=await this.model({pixel_values:ve}),xe;if(j){if(!("pooler_output"in Ie))throw Error("No pooled output was returned. Make sure the model has a \'pooler\' layer when using the \'pool\' option.");xe=Ie.pooler_output}else xe=(Pe=(ke=Ie.last_hidden_state)!=null?ke:Ie.logits)!=null?Pe:Ie.image_embeds;return xe}}class R extends E{constructor(Y){super(Y)}async _call(Y,{top_k:j=5}={}){let fe=this.processor.feature_extractor.config.sampling_rate,ve=await h(Y,fe),Ie=this.model.config.id2label,xe=[];for(let ke of ve){let Pe=await this.processor(ke),Ue=(await this.model(Pe)).logits[0],qe=await(0,d.topk)(new d.Tensor("float32",(0,c.softmax)(Ue.data),Ue.dims),j),Ke=qe[0].tolist(),tt=qe[1].tolist().map((Qe,at)=>({label:Ie?Ie[Qe]:`LABEL_${Qe}`,score:Ke[at]}));xe.push(tt)}return Array.isArray(Y)?xe:xe[0]}}class J extends E{constructor(Y){super(Y)}async _call(Y,j,{hypothesis_template:fe="This is a sound of {}."}={}){let ve=!Array.isArray(Y);ve&&(Y=[Y]);let Ie=j.map(Ue=>fe.replace("{}",Ue)),xe=this.tokenizer(Ie,{padding:!0,truncation:!0}),ke=this.processor.feature_extractor.config.sampling_rate,Pe=await h(Y,ke),He=[];for(let Ue of Pe){let qe=await this.processor(Ue),Ke=await this.model(Fe(Fe({},xe),qe)),Re=(0,c.softmax)(Ke.logits_per_audio.data);He.push([...Re].map((tt,Qe)=>({score:tt,label:j[Qe]})))}return ve?He[0]:He}}class H extends E{constructor(Y){super(Y)}async _call(Y,j={}){switch(this.model.config.model_type){case"whisper":case"lite-whisper":return this._call_whisper(Y,j);case"wav2vec2":case"wav2vec2-bert":case"unispeech":case"unispeech-sat":case"hubert":return this._call_wav2vec2(Y,j);case"moonshine":return this._call_moonshine(Y,j);default:throw new Error(`AutomaticSpeechRecognitionPipeline does not support model type \'${this.model.config.model_type}\'.`)}}async _call_wav2vec2(Y,j){j.language&&console.warn(\'`language` parameter is not yet supported for `wav2vec2` models, defaulting to "English".\'),j.task&&console.warn(\'`task` parameter is not yet supported for `wav2vec2` models, defaulting to "transcribe".\');let fe=!Array.isArray(Y);fe&&(Y=[Y]);let ve=this.processor.feature_extractor.config.sampling_rate,Ie=await h(Y,ve),xe=[];for(let ke of Ie){let Pe=await this.processor(ke),Ue=(await this.model(Pe)).logits[0],qe=[];for(let Re of Ue)qe.push((0,c.max)(Re.data)[1]);let Ke=this.tokenizer.decode(qe);xe.push({text:Ke})}return fe?xe[0]:xe}async _call_whisper(Y,j){var tt,Qe,at,it;let fe=(tt=j.return_timestamps)!=null?tt:!1,ve=(Qe=j.chunk_length_s)!=null?Qe:0,Ie=(at=j.force_full_sequences)!=null?at:!1,xe=(it=j.stride_length_s)!=null?it:null,ke=Fe({},j);fe==="word"&&(ke.return_token_timestamps=!0,ke.return_timestamps=!1);let Pe=!Array.isArray(Y);Pe&&(Y=[Y]);let He=this.processor.feature_extractor.config.chunk_length/this.model.config.max_source_positions,Ue=this.processor.feature_extractor.config.hop_length,qe=this.processor.feature_extractor.config.sampling_rate,Ke=await h(Y,qe),Re=[];for(let Ne of Ke){let et=[];if(ve>0){if(xe===null)xe=ve/6;else if(ve<=xe)throw Error("`chunk_length_s` must be larger than `stride_length_s`.");let At=qe*ve,Bt=qe*xe,ar=At-2*Bt,ft=0;for(;;){let Jr=ft+At,L=Ne.subarray(ft,Jr),se=await this.processor(L),G=ft===0,te=Jr>=Ne.length;if(et.push({stride:[L.length,G?0:Bt,te?0:Bt],input_features:se.input_features,is_last:te}),te)break;ft+=ar}}else et=[{stride:[Ne.length,0,0],input_features:(await this.processor(Ne)).input_features,is_last:!0}];for(let At of et){ke.num_frames=Math.floor(At.stride[0]/Ue);let Bt=await this.model.generate(Fe({inputs:At.input_features},ke));fe==="word"?(At.tokens=Bt.sequences.tolist()[0],At.token_timestamps=Bt.token_timestamps.tolist()[0].map(ar=>(0,c.round)(ar,2))):At.tokens=Bt[0].tolist(),At.stride=At.stride.map(ar=>ar/qe)}let[_t,Et]=this.tokenizer._decode_asr(et,{time_precision:He,return_timestamps:fe,force_full_sequences:Ie});Re.push(Fe({text:_t},Et))}return Pe?Re[0]:Re}async _call_moonshine(Y,j){let fe=!Array.isArray(Y);fe&&(Y=[Y]);let ve=this.processor.feature_extractor.config.sampling_rate,Ie=await h(Y,ve),xe=[];for(let ke of Ie){let Pe=await this.processor(ke),He=Math.floor(ke.length/ve)*6,Ue=await this.model.generate(Fe(Fe({max_new_tokens:He},j),Pe)),qe=this.processor.batch_decode(Ue,{skip_special_tokens:!0})[0];xe.push({text:qe})}return fe?xe[0]:xe}}class q extends E{constructor(Y){super(Y)}async _call(Y,j={}){let fe=Array.isArray(Y),ve=await f(Y),{pixel_values:Ie}=await this.processor(ve),xe=[];for(let ke of Ie){ke.dims=[1,...ke.dims];let Pe=await this.model.generate(Fe({inputs:ke},j)),He=this.tokenizer.batch_decode(Pe,{skip_special_tokens:!0}).map(Ue=>({generated_text:Ue.trim()}));xe.push(He)}return fe?xe:xe[0]}}class X extends E{constructor(Y){super(Y)}async _call(Y,{top_k:j=5}={}){let fe=await f(Y),{pixel_values:ve}=await this.processor(fe),Ie=await this.model({pixel_values:ve}),xe=this.model.config.id2label,ke=[];for(let Pe of Ie.logits){let He=await(0,d.topk)(new d.Tensor("float32",(0,c.softmax)(Pe.data),Pe.dims),j),Ue=He[0].tolist(),Ke=He[1].tolist().map((Re,tt)=>({label:xe?xe[Re]:`LABEL_${Re}`,score:Ue[tt]}));ke.push(Ke)}return Array.isArray(Y)?ke:ke[0]}}class ae extends E{constructor(Y){super(Y),this.subtasks_mapping={panoptic:"post_process_panoptic_segmentation",instance:"post_process_instance_segmentation",semantic:"post_process_semantic_segmentation"}}async _call(Y,{threshold:j=.5,mask_threshold:fe=.5,overlap_mask_area_threshold:ve=.8,label_ids_to_fuse:Ie=null,target_sizes:xe=null,subtask:ke=null}={}){if(Array.isArray(Y)&&Y.length!==1)throw Error("Image segmentation pipeline currently only supports a batch size of 1.");let He=await f(Y),Ue=He.map(Ne=>[Ne.height,Ne.width]),qe=await this.processor(He),{inputNames:Ke,outputNames:Re}=this.model.sessions.model;if(!Ke.includes("pixel_values")){if(Ke.length!==1)throw Error(`Expected a single input name, but got ${Ke.length} inputs: ${Ke}.`);let Ne=Ke[0];if(Ne in qe)throw Error(`Input name ${Ne} already exists in the inputs.`);qe[Ne]=qe.pixel_values}let tt=await this.model(qe),Qe=null;if(ke!==null)Qe=this.subtasks_mapping[ke];else if(this.processor.image_processor){for(let[Ne,et]of Object.entries(this.subtasks_mapping))if(et in this.processor.image_processor){Qe=this.processor.image_processor[et].bind(this.processor.image_processor),ke=Ne;break}}let at=this.model.config.id2label,it=[];if(ke)if(ke==="panoptic"||ke==="instance"){let Ne=Qe(tt,j,fe,ve,Ie,xe!=null?xe:Ue)[0],et=Ne.segmentation;for(let _t of Ne.segments_info){let Et=new Uint8ClampedArray(et.data.length);for(let Bt=0;Bt<et.data.length;++Bt)et.data[Bt]===_t.id&&(Et[Bt]=255);let At=new u.RawImage(Et,et.dims[1],et.dims[0],1);it.push({score:_t.score,label:at[_t.label_id],mask:At})}}else if(ke==="semantic"){let{segmentation:Ne,labels:et}=Qe(tt,xe!=null?xe:Ue)[0];for(let _t of et){let Et=new Uint8ClampedArray(Ne.data.length);for(let Bt=0;Bt<Ne.data.length;++Bt)Ne.data[Bt]===_t&&(Et[Bt]=255);let At=new u.RawImage(Et,Ne.dims[1],Ne.dims[0],1);it.push({score:null,label:at[_t],mask:At})}}else throw Error(`Subtask ${ke} not supported.`);else{let et=tt[Re[0]];for(let _t=0;_t<Ue.length;++_t){let Et=Ue[_t],At=et[_t];At.data.some(ar=>ar<-1e-5||ar>1+1e-5)&&At.sigmoid_();let Bt=await u.RawImage.fromTensor(At.mul_(255).to("uint8")).resize(Et[1],Et[0]);it.push({label:null,score:null,mask:Bt})}}return it}}class ce extends ae{constructor(Y){super(Y)}async _call(Y,j={}){if(Array.isArray(Y)&&Y.length!==1)throw Error("Background removal pipeline currently only supports a batch size of 1.");let ve=await f(Y),Ie=await super._call(Y,j);return ve.map((ke,Pe)=>{let He=ke.clone();return He.putAlpha(Ie[Pe].mask),He})}}class he extends E{constructor(Y){super(Y)}async _call(Y,j,{hypothesis_template:fe="This is a photo of {}"}={}){let ve=Array.isArray(Y),Ie=await f(Y),xe=j.map(Ke=>fe.replace("{}",Ke)),ke=this.tokenizer(xe,{padding:this.model.config.model_type==="siglip"?"max_length":!0,truncation:!0}),{pixel_values:Pe}=await this.processor(Ie),He=await this.model(Ct(Fe({},ke),{pixel_values:Pe})),Ue=this.model.config.model_type==="siglip"?Ke=>Ke.sigmoid().data:Ke=>(0,c.softmax)(Ke.data),qe=[];for(let Ke of He.logits_per_image){let tt=[...Ue(Ke)].map((Qe,at)=>({score:Qe,label:j[at]}));tt.sort((Qe,at)=>at.score-Qe.score),qe.push(tt)}return ve?qe:qe[0]}}class B extends E{constructor(Y){super(Y)}async _call(Y,{threshold:j=.9,percentage:fe=!1}={}){let ve=Array.isArray(Y);if(ve&&Y.length!==1)throw Error("Object detection pipeline currently only supports a batch size of 1.");let Ie=await f(Y),xe=fe?null:Ie.map(Re=>[Re.height,Re.width]),{pixel_values:ke,pixel_mask:Pe}=await this.processor(Ie),He=await this.model({pixel_values:ke,pixel_mask:Pe}),Ue=this.processor.image_processor.post_process_object_detection(He,j,xe),qe=this.model.config.id2label,Ke=Ue.map(Re=>Re.boxes.map((tt,Qe)=>({score:Re.scores[Qe],label:qe[Re.classes[Qe]],box:v(tt,!fe)})));return ve?Ke:Ke[0]}}class D extends E{constructor(Y){super(Y)}async _call(Y,j,{threshold:fe=.1,top_k:ve=null,percentage:Ie=!1}={}){let xe=Array.isArray(Y),ke=await f(Y),Pe=this.tokenizer(j,{padding:!0,truncation:!0}),He=await this.processor(ke),Ue=[];for(let qe=0;qe<ke.length;++qe){let Ke=ke[qe],Re=Ie?null:[[Ke.height,Ke.width]],tt=He.pixel_values[qe].unsqueeze_(0),Qe=await this.model(Ct(Fe({},Pe),{pixel_values:tt})),at;if("post_process_grounded_object_detection"in this.processor){let it=this.processor.post_process_grounded_object_detection(Qe,Pe.input_ids,{box_threshold:fe,text_threshold:fe,target_sizes:Re})[0];at=it.boxes.map((Ne,et)=>({score:it.scores[et],label:it.labels[et],box:v(Ne,!Ie)}))}else{let it=this.processor.image_processor.post_process_object_detection(Qe,fe,Re,!0)[0];at=it.boxes.map((Ne,et)=>({score:it.scores[et],label:j[it.classes[et]],box:v(Ne,!Ie)}))}at.sort((it,Ne)=>Ne.score-it.score),ve!==null&&(at=at.slice(0,ve)),Ue.push(at)}return xe?Ue:Ue[0]}}class K extends E{constructor(Y){super(Y)}async _call(Y,j,fe={}){let ve=(await f(Y))[0],{pixel_values:Ie}=await this.processor(ve),xe=`<s_docvqa><s_question>${j}</s_question><s_answer>`,ke=this.tokenizer(xe,{add_special_tokens:!1,padding:!0,truncation:!0}).input_ids,Pe=await this.model.generate(Fe({inputs:Ie,max_length:this.model.config.decoder.max_position_embeddings,decoder_input_ids:ke},fe)),Ue=this.tokenizer.batch_decode(Pe)[0].match(/<s_answer>(.*?)<\\/s_answer>/),qe=null;return Ue&&Ue.length>=2&&(qe=Ue[1].trim()),[{answer:qe}]}}class re extends E{constructor(j){var fe;super(j);ee(this,"DEFAULT_VOCODER_ID","Xenova/speecht5_hifigan");this.vocoder=(fe=j.vocoder)!=null?fe:null}async _call(j,{speaker_embeddings:fe=null}={}){return this.processor?this._call_text_to_spectrogram(j,{speaker_embeddings:fe}):this._call_text_to_waveform(j)}async _call_text_to_waveform(j){let fe=this.tokenizer(j,{padding:!0,truncation:!0}),{waveform:ve}=await this.model(fe),Ie=this.model.config.sampling_rate;return new _.RawAudio(ve.data,Ie)}async _call_text_to_spectrogram(j,{speaker_embeddings:fe}){if(this.vocoder||(console.log("No vocoder specified, using default HifiGan vocoder."),this.vocoder=await o.AutoModel.from_pretrained(this.DEFAULT_VOCODER_ID,{dtype:"fp32"})),(typeof fe=="string"||fe instanceof URL)&&(fe=new Float32Array(await(await fetch(fe)).arrayBuffer())),fe instanceof Float32Array)fe=new d.Tensor("float32",fe,[1,fe.length]);else if(!(fe instanceof d.Tensor))throw new Error("Speaker embeddings must be a `Tensor`, `Float32Array`, `string`, or `URL`.");let{input_ids:ve}=this.tokenizer(j,{padding:!0,truncation:!0}),{waveform:Ie}=await this.model.generate_speech(ve,fe,{vocoder:this.vocoder}),xe=this.processor.feature_extractor.config.sampling_rate;return new _.RawAudio(Ie.data,xe)}}class me extends E{constructor(Y){super(Y)}async _call(Y){let j=await f(Y),fe=await this.processor(j),ve=await this.model(fe),Ie=[];for(let xe of ve.reconstruction){let ke=xe.squeeze().clamp_(0,1).mul_(255).round_().to("uint8");Ie.push(u.RawImage.fromTensor(ke))}return Ie.length>1?Ie:Ie[0]}}class oe extends E{constructor(Y){super(Y)}async _call(Y){let j=await f(Y),fe=await this.processor(j),{predicted_depth:ve}=await this.model(fe),Ie=[];for(let xe=0;xe<j.length;++xe){let ke=ve[xe],[Pe,He]=ke.dims.slice(-2),[Ue,qe]=j[xe].size,Ke=(await(0,d.interpolate_4d)(ke.view(1,1,Pe,He),{size:[qe,Ue],mode:"bilinear"})).view(qe,Ue),Re=Ke.min().item(),tt=Ke.max().item(),Qe=Ke.sub(Re).div_(tt-Re).mul_(255).to("uint8").unsqueeze(0),at=u.RawImage.fromTensor(Qe);Ie.push({predicted_depth:Ke,depth:at})}return Ie.length>1?Ie:Ie[0]}}let ge=Object.freeze({"text-classification":{tokenizer:s.AutoTokenizer,pipeline:M,model:o.AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-finetuned-sst-2-english"},type:"text"},"token-classification":{tokenizer:s.AutoTokenizer,pipeline:w,model:o.AutoModelForTokenClassification,default:{model:"Xenova/bert-base-multilingual-cased-ner-hrl"},type:"text"},"question-answering":{tokenizer:s.AutoTokenizer,pipeline:C,model:o.AutoModelForQuestionAnswering,default:{model:"Xenova/distilbert-base-cased-distilled-squad"},type:"text"},"fill-mask":{tokenizer:s.AutoTokenizer,pipeline:x,model:o.AutoModelForMaskedLM,default:{model:"Xenova/bert-base-uncased"},type:"text"},summarization:{tokenizer:s.AutoTokenizer,pipeline:S,model:o.AutoModelForSeq2SeqLM,default:{model:"Xenova/distilbart-cnn-6-6"},type:"text"},translation:{tokenizer:s.AutoTokenizer,pipeline:g,model:o.AutoModelForSeq2SeqLM,default:{model:"Xenova/t5-small"},type:"text"},"text2text-generation":{tokenizer:s.AutoTokenizer,pipeline:T,model:o.AutoModelForSeq2SeqLM,default:{model:"Xenova/flan-t5-small"},type:"text"},"text-generation":{tokenizer:s.AutoTokenizer,pipeline:$,model:o.AutoModelForCausalLM,default:{model:"Xenova/gpt2"},type:"text"},"zero-shot-classification":{tokenizer:s.AutoTokenizer,pipeline:A,model:o.AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-mnli"},type:"text"},"audio-classification":{pipeline:R,model:o.AutoModelForAudioClassification,processor:a.AutoProcessor,default:{model:"Xenova/wav2vec2-base-superb-ks"},type:"audio"},"zero-shot-audio-classification":{tokenizer:s.AutoTokenizer,pipeline:J,model:o.AutoModel,processor:a.AutoProcessor,default:{model:"Xenova/clap-htsat-unfused"},type:"multimodal"},"automatic-speech-recognition":{tokenizer:s.AutoTokenizer,pipeline:H,model:[o.AutoModelForSpeechSeq2Seq,o.AutoModelForCTC],processor:a.AutoProcessor,default:{model:"Xenova/whisper-tiny.en"},type:"multimodal"},"text-to-audio":{tokenizer:s.AutoTokenizer,pipeline:re,model:[o.AutoModelForTextToWaveform,o.AutoModelForTextToSpectrogram],processor:[a.AutoProcessor,null],default:{model:"Xenova/speecht5_tts"},type:"text"},"image-to-text":{tokenizer:s.AutoTokenizer,pipeline:q,model:o.AutoModelForVision2Seq,processor:a.AutoProcessor,default:{model:"Xenova/vit-gpt2-image-captioning"},type:"multimodal"},"image-classification":{pipeline:X,model:o.AutoModelForImageClassification,processor:a.AutoProcessor,default:{model:"Xenova/vit-base-patch16-224"},type:"multimodal"},"image-segmentation":{pipeline:ae,model:[o.AutoModelForImageSegmentation,o.AutoModelForSemanticSegmentation,o.AutoModelForUniversalSegmentation],processor:a.AutoProcessor,default:{model:"Xenova/detr-resnet-50-panoptic"},type:"multimodal"},"background-removal":{pipeline:ce,model:[o.AutoModelForImageSegmentation,o.AutoModelForSemanticSegmentation,o.AutoModelForUniversalSegmentation],processor:a.AutoProcessor,default:{model:"Xenova/modnet"},type:"image"},"zero-shot-image-classification":{tokenizer:s.AutoTokenizer,pipeline:he,model:o.AutoModel,processor:a.AutoProcessor,default:{model:"Xenova/clip-vit-base-patch32"},type:"multimodal"},"object-detection":{pipeline:B,model:o.AutoModelForObjectDetection,processor:a.AutoProcessor,default:{model:"Xenova/detr-resnet-50"},type:"multimodal"},"zero-shot-object-detection":{tokenizer:s.AutoTokenizer,pipeline:D,model:o.AutoModelForZeroShotObjectDetection,processor:a.AutoProcessor,default:{model:"Xenova/owlvit-base-patch32"},type:"multimodal"},"document-question-answering":{tokenizer:s.AutoTokenizer,pipeline:K,model:o.AutoModelForDocumentQuestionAnswering,processor:a.AutoProcessor,default:{model:"Xenova/donut-base-finetuned-docvqa"},type:"multimodal"},"image-to-image":{pipeline:me,model:o.AutoModelForImageToImage,processor:a.AutoProcessor,default:{model:"Xenova/swin2SR-classical-sr-x2-64"},type:"image"},"depth-estimation":{pipeline:oe,model:o.AutoModelForDepthEstimation,processor:a.AutoProcessor,default:{model:"Xenova/dpt-large"},type:"image"},"feature-extraction":{tokenizer:s.AutoTokenizer,pipeline:N,model:o.AutoModel,default:{model:"Xenova/all-MiniLM-L6-v2"},type:"text"},"image-feature-extraction":{processor:a.AutoProcessor,pipeline:W,model:[o.AutoModelForImageFeatureExtraction,o.AutoModel],default:{model:"Xenova/vit-base-patch16-224-in21k"},type:"image"}}),ze=Object.freeze({"sentiment-analysis":"text-classification",ner:"token-classification",asr:"automatic-speech-recognition","text-to-speech":"text-to-audio",embeddings:"feature-extraction"});async function We(ie,Y=null,{progress_callback:j=null,config:fe=null,cache_dir:ve=null,local_files_only:Ie=!1,revision:xe="main",device:ke=null,dtype:Pe=null,subfolder:He="onnx",use_external_data_format:Ue=null,model_file_name:qe=null,session_options:Ke={}}={}){var Ne;ie=(Ne=ze[ie])!=null?Ne:ie;let Re=ge[ie.split("_",1)[0]];if(!Re)throw Error(`Unsupported pipeline: ${ie}. Must be one of [${Object.keys(ge)}]`);Y||(Y=Re.default.model,console.log(`No model specified. Using default model: "${Y}".`));let tt={progress_callback:j,config:fe,cache_dir:ve,local_files_only:Ie,revision:xe,device:ke,dtype:Pe,subfolder:He,use_external_data_format:Ue,model_file_name:qe,session_options:Ke},Qe=new Map([["tokenizer",Re.tokenizer],["model",Re.model],["processor",Re.processor]]),at=await Ce(Qe,Y,tt);at.task=ie,(0,l.dispatchCallback)(j,{status:"ready",task:ie,model:Y});let it=Re.pipeline;return new it(at)}async function Ce(ie,Y,j){let fe=Object.create(null),ve=[];for(let[Ie,xe]of ie.entries()){if(!xe)continue;let ke;Array.isArray(xe)?ke=new Promise(async(Pe,He)=>{var qe,Ke;let Ue;for(let Re of xe){if(Re===null){Pe(null);return}try{Pe(await Re.from_pretrained(Y,j));return}catch(tt){if((qe=tt.message)!=null&&qe.includes("Unsupported model type"))Ue=tt;else if((Ke=tt.message)!=null&&Ke.includes("Could not locate file"))Ue=tt;else{He(tt);return}}}He(Ue)}):ke=xe.from_pretrained(Y,j),fe[Ie]=ke,ve.push(ke)}await Promise.all(ve);for(let[Ie,xe]of Object.entries(fe))fe[Ie]=await xe;return fe}},"./src/tokenizers.js":(e,r,t)=>{t.r(r),t.d(r,{AlbertTokenizer:()=>Xt,AutoTokenizer:()=>Bs,BartTokenizer:()=>jr,BertTokenizer:()=>Dt,BlenderbotSmallTokenizer:()=>pa,BlenderbotTokenizer:()=>_a,BloomTokenizer:()=>Os,CLIPTokenizer:()=>gr,CamembertTokenizer:()=>br,CodeGenTokenizer:()=>fr,CodeLlamaTokenizer:()=>Ls,CohereTokenizer:()=>Xs,ConvBertTokenizer:()=>zt,DebertaTokenizer:()=>Ye,DebertaV2Tokenizer:()=>vt,DistilBertTokenizer:()=>er,ElectraTokenizer:()=>Ir,EsmTokenizer:()=>rt,FalconTokenizer:()=>Ae,GPT2Tokenizer:()=>kr,GPTNeoXTokenizer:()=>Ze,GemmaTokenizer:()=>ps,Grok1Tokenizer:()=>Ur,HerbertTokenizer:()=>yt,LlamaTokenizer:()=>Wr,M2M100Tokenizer:()=>Or,MBart50Tokenizer:()=>vs,MBartTokenizer:()=>Yr,MPNetTokenizer:()=>qr,MarianTokenizer:()=>da,MgpstrTokenizer:()=>fa,MobileBertTokenizer:()=>ht,NllbTokenizer:()=>ms,NougatTokenizer:()=>ma,PreTrainedTokenizer:()=>Se,Qwen2Tokenizer:()=>or,RoFormerTokenizer:()=>It,RobertaTokenizer:()=>Ds,SiglipTokenizer:()=>js,SpeechT5Tokenizer:()=>zs,SqueezeBertTokenizer:()=>Ot,T5Tokenizer:()=>tr,TokenizerModel:()=>N,VitsTokenizer:()=>ha,Wav2Vec2CTCTokenizer:()=>ua,WhisperTokenizer:()=>hs,XLMRobertaTokenizer:()=>Dr,XLMTokenizer:()=>hr,is_chinese_char:()=>C});var s=t("./src/utils/generic.js"),o=t("./src/utils/core.js"),a=t("./src/utils/hub.js"),n=t("./src/utils/maths.js"),i=t("./src/utils/tensor.js"),l=t("./src/utils/data-structures.js"),c=t("./node_modules/@huggingface/jinja/dist/index.js"),_=t("./src/models/whisper/common_whisper.js");async function d(ue,I){let V=await Promise.all([(0,a.getModelJSON)(ue,"tokenizer.json",!0,I),(0,a.getModelJSON)(ue,"tokenizer_config.json",!0,I)]);return I.legacy!==null&&(V[1].legacy=I.legacy),V}function u(ue,I){let V=[],Z=0;for(let ne of ue.matchAll(I)){let de=ne[0];Z<ne.index&&V.push(ue.slice(Z,ne.index)),de.length>0&&V.push(de),Z=ne.index+de.length}return Z<ue.length&&V.push(ue.slice(Z)),V}function f(ue,I=!0){if(ue.Regex!==void 0){let V=ue.Regex.replace(/\\\\([#&~])/g,"$1");for(let[Z,ne]of $)V=V.replaceAll(Z,ne);return new RegExp(V,"gu")}else if(ue.String!==void 0){let V=(0,o.escapeRegExp)(ue.String);return new RegExp(I?V:`(${V})`,"gu")}else return console.warn("Unknown pattern type:",ue),null}function h(ue){return new Map(Object.entries(ue))}function v(ue){let I=ue.dims;switch(I.length){case 1:return ue.tolist();case 2:if(I[0]!==1)throw new Error("Unable to decode tensor with `batch size !== 1`. Use `tokenizer.batch_decode(...)` for batched inputs.");return ue.tolist()[0];default:throw new Error(`Expected tensor to have 1-2 dimensions, got ${I.length}.`)}}function E(ue){return ue.replace(/ \\./g,".").replace(/ \\?/g,"?").replace(/ \\!/g,"!").replace(/ ,/g,",").replace(/ \\\' /g,"\'").replace(/ n\\\'t/g,"n\'t").replace(/ \\\'m/g,"\'m").replace(/ \\\'s/g,"\'s").replace(/ \\\'ve/g,"\'ve").replace(/ \\\'re/g,"\'re")}function M(ue){return ue.replace(new RegExp("\\\\p{M}","gu"),"")}function w(ue){return M(ue.toLowerCase())}function C(ue){return ue>=19968&&ue<=40959||ue>=13312&&ue<=19903||ue>=131072&&ue<=173791||ue>=173824&&ue<=177983||ue>=177984&&ue<=178207||ue>=178208&&ue<=183983||ue>=63744&&ue<=64255||ue>=194560&&ue<=195103}function x(ue,I,V){var de,be;let Z=[],ne=0;for(;ne<ue.length;){if(Z.push(ue[ne]),((de=I.get(ue[ne]))!=null?de:V)!==V){++ne;continue}for(;++ne<ue.length&&((be=I.get(ue[ne]))!=null?be:V)===V;)I.get(Z.at(-1))!==V&&(Z[Z.length-1]+=ue[ne])}return Z}function T(ue){return ue.match(/\\S+/g)||[]}let S="\\\\p{P}\\\\u0021-\\\\u002F\\\\u003A-\\\\u0040\\\\u005B-\\\\u0060\\\\u007B-\\\\u007E",g=new RegExp(`^[${S}]+$`,"gu"),P=".,!?\\u2026\\u3002\\uFF0C\\u3001\\u0964\\u06D4\\u060C",$=new Map([["(?i:\'s|\'t|\'re|\'ve|\'m|\'ll|\'d)","(?:\'([sS]|[tT]|[rR][eE]|[vV][eE]|[mM]|[lL][lL]|[dD]))"],[` ?[^(\\\\s|[${P}])]+`,` ?[^\\\\s${P}]+`]]);class A{constructor(I){var V,Z,ne,de,be;this.content=I.content,this.id=I.id,this.single_word=(V=I.single_word)!=null?V:!1,this.lstrip=(Z=I.lstrip)!=null?Z:!1,this.rstrip=(ne=I.rstrip)!=null?ne:!1,this.special=(de=I.special)!=null?de:!1,this.normalized=(be=I.normalized)!=null?be:null}}class N extends s.Callable{constructor(I){var V;super(),this.config=I,this.vocab=[],this.tokens_to_ids=new Map,this.unk_token_id=void 0,this.unk_token=void 0,this.end_of_word_suffix=void 0,this.fuse_unk=(V=this.config.fuse_unk)!=null?V:!1}static fromConfig(I,...V){switch(I.type){case"WordPiece":return new W(I);case"Unigram":return new R(I,...V);case"BPE":return new q(I);default:if(I.vocab)return Array.isArray(I.vocab)?new R(I,...V):Object.hasOwn(I,"continuing_subword_prefix")&&Object.hasOwn(I,"unk_token")?Object.hasOwn(I,"merges")?new q(I):new W(I):new X(I,...V);throw new Error(`Unknown TokenizerModel type: ${I.type}`)}}_call(I){return I=this.encode(I),this.fuse_unk&&(I=x(I,this.tokens_to_ids,this.unk_token_id)),I}encode(I){throw Error("encode should be implemented in subclass.")}convert_tokens_to_ids(I){return I.map(V=>{var Z;return(Z=this.tokens_to_ids.get(V))!=null?Z:this.unk_token_id})}convert_ids_to_tokens(I){return I.map(V=>{var Z;return(Z=this.vocab[V])!=null?Z:this.unk_token})}}class W extends N{constructor(I){var V;super(I),this.tokens_to_ids=h(I.vocab),this.unk_token_id=this.tokens_to_ids.get(I.unk_token),this.unk_token=I.unk_token,this.max_input_chars_per_word=(V=I.max_input_chars_per_word)!=null?V:100,this.vocab=new Array(this.tokens_to_ids.size);for(let[Z,ne]of this.tokens_to_ids)this.vocab[ne]=Z}encode(I){let V=[];for(let Z of I){let ne=[...Z];if(ne.length>this.max_input_chars_per_word){V.push(this.unk_token);continue}let de=!1,be=0,$e=[];for(;be<ne.length;){let Ge=ne.length,Be=null;for(;be<Ge;){let Je=ne.slice(be,Ge).join("");if(be>0&&(Je=this.config.continuing_subword_prefix+Je),this.tokens_to_ids.has(Je)){Be=Je;break}--Ge}if(Be===null){de=!0;break}$e.push(Be),be=Ge}de?V.push(this.unk_token):V.push(...$e)}return V}}class R extends N{constructor(I,V){super(I);let Z=I.vocab.length;this.vocab=new Array(Z),this.scores=new Array(Z);for(let ne=0;ne<Z;++ne)[this.vocab[ne],this.scores[ne]]=I.vocab[ne];this.unk_token_id=I.unk_id,this.unk_token=this.vocab[I.unk_id],this.tokens_to_ids=new Map(this.vocab.map((ne,de)=>[ne,de])),this.bos_token=" ",this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=V.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.unk_token=this.vocab[this.unk_token_id],this.minScore=(0,n.min)(this.scores)[0],this.unk_score=this.minScore-10,this.scores[this.unk_token_id]=this.unk_score,this.trie=new l.CharTrie,this.trie.extend(this.vocab),this.fuse_unk=!0}populateNodes(I){let V=I.chars,Z=1,ne=0;for(;ne<V.length;){let de=!1,be=[],$e=V.slice(ne).join(""),Ge=this.trie.commonPrefixSearch($e);for(let Be of Ge){be.push(Be);let Je=this.tokens_to_ids.get(Be),wt=this.scores[Je],Rt=(0,o.len)(Be);I.insert(ne,Rt,wt,Je),!de&&Rt===Z&&(de=!0)}de||I.insert(ne,Z,this.unk_score,this.unk_token_id),ne+=Z}}tokenize(I){let V=new l.TokenLattice(I,this.bos_token_id,this.eos_token_id);return this.populateNodes(V),V.tokens()}encode(I){let V=[];for(let Z of I){let ne=this.tokenize(Z);V.push(...ne)}return V}}let J=(()=>{let ue=[...Array.from({length:94},(ne,de)=>de+33),...Array.from({length:12},(ne,de)=>de+161),...Array.from({length:82},(ne,de)=>de+174)],I=ue.slice(),V=0;for(let ne=0;ne<256;++ne)ue.includes(ne)||(ue.push(ne),I.push(256+V),V+=1);let Z=I.map(ne=>String.fromCharCode(ne));return Object.fromEntries(ue.map((ne,de)=>[ne,Z[de]]))})(),H=(0,o.reverseDictionary)(J);class q extends N{constructor(I){var Z,ne,de;super(I),this.tokens_to_ids=h(I.vocab),this.unk_token_id=this.tokens_to_ids.get(I.unk_token),this.unk_token=I.unk_token,this.vocab=new Array(this.tokens_to_ids.size);for(let[be,$e]of this.tokens_to_ids)this.vocab[$e]=be;let V=Array.isArray(I.merges[0]);this.merges=V?I.merges:I.merges.map(be=>be.split(" ",2)),this.bpe_ranks=new Map(this.merges.map((be,$e)=>[JSON.stringify(be),$e])),this.end_of_word_suffix=I.end_of_word_suffix,this.continuing_subword_suffix=(Z=I.continuing_subword_suffix)!=null?Z:null,this.byte_fallback=(ne=this.config.byte_fallback)!=null?ne:!1,this.byte_fallback&&(this.text_encoder=new TextEncoder),this.ignore_merges=(de=this.config.ignore_merges)!=null?de:!1,this.max_length_to_cache=256,this.cache_capacity=1e4,this.cache=new l.LRUCache(this.cache_capacity)}clear_cache(){this.cache.clear()}bpe(I){if(I.length===0)return[];let V=this.cache.get(I);if(V!==void 0)return V;let Z=Array.from(I);this.end_of_word_suffix&&(Z[Z.length-1]+=this.end_of_word_suffix);let ne=[];if(Z.length>1){let de=new l.PriorityQueue((Ge,Be)=>Ge.score<Be.score),be={token:Z[0],bias:0,prev:null,next:null},$e=be;for(let Ge=1;Ge<Z.length;++Ge){let Be={bias:Ge/Z.length,token:Z[Ge],prev:$e,next:null};$e.next=Be,this._add_node(de,$e),$e=Be}for(;!de.isEmpty();){let Ge=de.pop();if(Ge.deleted||!Ge.next||Ge.next.deleted)continue;if(Ge.deleted=!0,Ge.next.deleted=!0,Ge.prev){let Je=Fe({},Ge.prev);Ge.prev.deleted=!0,Ge.prev=Je,Je.prev?Je.prev.next=Je:be=Je}let Be={token:Ge.token+Ge.next.token,bias:Ge.bias,prev:Ge.prev,next:Ge.next.next};Be.prev?(Be.prev.next=Be,this._add_node(de,Be.prev)):be=Be,Be.next&&(Be.next.prev=Be,this._add_node(de,Be))}for(let Ge=be;Ge!==null;Ge=Ge.next)ne.push(Ge.token)}else ne=Z;if(this.continuing_subword_suffix)for(let de=0;de<ne.length-1;++de)ne[de]+=this.continuing_subword_suffix;return I.length<this.max_length_to_cache&&this.cache.put(I,ne),ne}_add_node(I,V){let Z=this.bpe_ranks.get(JSON.stringify([V.token,V.next.token]));Z!==void 0&&(V.score=Z+V.bias,I.push(V))}encode(I){let V=[];for(let Z of I){if(this.ignore_merges&&this.tokens_to_ids.has(Z)){V.push(Z);continue}let ne=this.bpe(Z);for(let de of ne)if(this.tokens_to_ids.has(de))V.push(de);else if(this.byte_fallback){let be=Array.from(this.text_encoder.encode(de)).map($e=>`<0x${$e.toString(16).toUpperCase().padStart(2,"0")}>`);be.every($e=>this.tokens_to_ids.has($e))?V.push(...be):V.push(this.unk_token)}else V.push(this.unk_token)}return V}}class X extends N{constructor(I,V){super(I),this.tokens_to_ids=h(V.target_lang?I.vocab[V.target_lang]:I.vocab),this.bos_token=V.bos_token,this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=V.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.pad_token=V.pad_token,this.pad_token_id=this.tokens_to_ids.get(this.pad_token),this.unk_token=V.unk_token,this.unk_token_id=this.tokens_to_ids.get(this.unk_token),this.vocab=new Array(this.tokens_to_ids.size);for(let[Z,ne]of this.tokens_to_ids)this.vocab[ne]=Z}encode(I){return I}}class ae extends s.Callable{constructor(I){super(),this.config=I}static fromConfig(I){if(I===null)return null;switch(I.type){case"BertNormalizer":return new Ce(I);case"Precompiled":return new ft(I);case"Sequence":return new We(I);case"Replace":return new ce(I);case"NFC":return new B(I);case"NFD":return new D(I);case"NFKC":return new K(I);case"NFKD":return new re(I);case"Strip":return new me(I);case"StripAccents":return new oe(I);case"Lowercase":return new ge(I);case"Prepend":return new ze(I);default:throw new Error(`Unknown Normalizer type: ${I.type}`)}}normalize(I){throw Error("normalize should be implemented in subclass.")}_call(I){return this.normalize(I)}}class ce extends ae{normalize(I){let V=f(this.config.pattern);return V===null?I:I.replaceAll(V,this.config.content)}}class he extends ae{constructor(){super(...arguments);ee(this,"form")}normalize(V){return V=V.normalize(this.form),V}}class B extends he{constructor(){super(...arguments);ee(this,"form","NFC")}}class D extends he{constructor(){super(...arguments);ee(this,"form","NFD")}}class K extends he{constructor(){super(...arguments);ee(this,"form","NFKC")}}class re extends he{constructor(){super(...arguments);ee(this,"form","NFKD")}}class me extends ae{normalize(I){return this.config.strip_left&&this.config.strip_right?I=I.trim():(this.config.strip_left&&(I=I.trimStart()),this.config.strip_right&&(I=I.trimEnd())),I}}class oe extends ae{normalize(I){return I=M(I),I}}class ge extends ae{normalize(I){return I=I.toLowerCase(),I}}class ze extends ae{normalize(I){return I=this.config.prepend+I,I}}class We extends ae{constructor(I){super(I),this.normalizers=I.normalizers.map(V=>ae.fromConfig(V))}normalize(I){return this.normalizers.reduce((V,Z)=>Z.normalize(V),I)}}class Ce extends ae{_tokenize_chinese_chars(I){let V=[];for(let Z=0;Z<I.length;++Z){let ne=I[Z],de=ne.charCodeAt(0);C(de)?(V.push(" "),V.push(ne),V.push(" ")):V.push(ne)}return V.join("")}stripAccents(I){return I.normalize("NFD").replace(new RegExp("\\\\p{Mn}","gu"),"")}_is_control(I){switch(I){case"	":case`\n`:case"\\r":return!1;default:return new RegExp("^\\\\p{Cc}|\\\\p{Cf}|\\\\p{Co}|\\\\p{Cs}$","u").test(I)}}_clean_text(I){let V=[];for(let Z of I){let ne=Z.charCodeAt(0);ne===0||ne===65533||this._is_control(Z)||(/^\\s$/.test(Z)?V.push(" "):V.push(Z))}return V.join("")}normalize(I){return this.config.clean_text&&(I=this._clean_text(I)),this.config.handle_chinese_chars&&(I=this._tokenize_chinese_chars(I)),this.config.lowercase?(I=I.toLowerCase(),this.config.strip_accents!==!1&&(I=this.stripAccents(I))):this.config.strip_accents&&(I=this.stripAccents(I)),I}}class ie extends s.Callable{static fromConfig(I){if(I===null)return null;switch(I.type){case"BertPreTokenizer":return new Y(I);case"Sequence":return new Jr(I);case"Whitespace":return new L(I);case"WhitespaceSplit":return new se(I);case"Metaspace":return new Bt(I);case"ByteLevel":return new j(I);case"Split":return new fe(I);case"Punctuation":return new ve(I);case"Digits":return new Ie(I);case"Replace":return new G(I);default:throw new Error(`Unknown PreTokenizer type: ${I.type}`)}}pre_tokenize_text(I,V){throw Error("pre_tokenize_text should be implemented in subclass.")}pre_tokenize(I,V){return(Array.isArray(I)?I.map(Z=>this.pre_tokenize_text(Z,V)):this.pre_tokenize_text(I,V)).flat()}_call(I,V){return this.pre_tokenize(I,V)}}class Y extends ie{constructor(I){super(),this.pattern=new RegExp(`[^\\\\s${S}]+|[${S}]`,"gu")}pre_tokenize_text(I,V){return I.trim().match(this.pattern)||[]}}class j extends ie{constructor(I){var V;super(),this.config=I,this.add_prefix_space=this.config.add_prefix_space,this.trim_offsets=this.config.trim_offsets,this.use_regex=(V=this.config.use_regex)!=null?V:!0,this.pattern=new RegExp("\'s|\'t|\'re|\'ve|\'m|\'ll|\'d| ?\\\\p{L}+| ?\\\\p{N}+| ?[^\\\\s\\\\p{L}\\\\p{N}]+|\\\\s+(?!\\\\S)|\\\\s+","gu"),this.byte_encoder=J,this.text_encoder=new TextEncoder}pre_tokenize_text(I,V){return this.add_prefix_space&&!I.startsWith(" ")&&(I=" "+I),(this.use_regex?I.match(this.pattern)||[]:[I]).map(ne=>Array.from(this.text_encoder.encode(ne),de=>this.byte_encoder[de]).join(""))}}class fe extends ie{constructor(I){super(),this.config=I,this.pattern=f(this.config.pattern,this.config.invert)}pre_tokenize_text(I,V){var Z;return this.pattern===null?[]:this.config.invert?I.match(this.pattern)||[]:((Z=this.config.behavior)==null?void 0:Z.toLowerCase())==="removed"?I.split(this.pattern).filter(ne=>ne):u(I,this.pattern)}}class ve extends ie{constructor(I){super(),this.config=I,this.pattern=new RegExp(`[^${S}]+|[${S}]+`,"gu")}pre_tokenize_text(I,V){return I.match(this.pattern)||[]}}class Ie extends ie{constructor(I){super(),this.config=I;let V=`[^\\\\d]+|\\\\d${this.config.individual_digits?"":"+"}`;this.pattern=new RegExp(V,"gu")}pre_tokenize_text(I,V){return I.match(this.pattern)||[]}}class xe extends s.Callable{constructor(I){super(),this.config=I}static fromConfig(I){if(I===null)return null;switch(I.type){case"TemplateProcessing":return new He(I);case"ByteLevel":return new Ue(I);case"RobertaProcessing":return new Pe(I);case"BertProcessing":return new ke(I);case"Sequence":return new qe(I);default:throw new Error(`Unknown PostProcessor type: ${I.type}`)}}post_process(I,...V){throw Error("post_process should be implemented in subclass.")}_call(I,...V){return this.post_process(I,...V)}}class ke extends xe{constructor(I){super(I),this.cls=I.cls[0],this.sep=I.sep[0]}post_process(I,V=null,{add_special_tokens:Z=!0}={}){Z&&(I=(0,o.mergeArrays)([this.cls],I,[this.sep]));let ne=new Array(I.length).fill(0);if(V!==null){let de=Z&&this instanceof Pe?[this.sep]:[],be=Z?[this.sep]:[];I=(0,o.mergeArrays)(I,de,V,be),ne=(0,o.mergeArrays)(ne,new Array(V.length+de.length+be.length).fill(1))}return{tokens:I,token_type_ids:ne}}}class Pe extends ke{}class He extends xe{constructor(I){super(I),this.single=I.single,this.pair=I.pair}post_process(I,V=null,{add_special_tokens:Z=!0}={}){let ne=V===null?this.single:this.pair,de=[],be=[];for(let $e of ne)"SpecialToken"in $e?Z&&(de.push($e.SpecialToken.id),be.push($e.SpecialToken.type_id)):"Sequence"in $e&&($e.Sequence.id==="A"?(de=(0,o.mergeArrays)(de,I),be=(0,o.mergeArrays)(be,new Array(I.length).fill($e.Sequence.type_id))):$e.Sequence.id==="B"&&(de=(0,o.mergeArrays)(de,V),be=(0,o.mergeArrays)(be,new Array(V.length).fill($e.Sequence.type_id))));return{tokens:de,token_type_ids:be}}}class Ue extends xe{post_process(I,V=null){return V&&(I=(0,o.mergeArrays)(I,V)),{tokens:I}}}class qe extends xe{constructor(I){super(I),this.processors=I.processors.map(V=>xe.fromConfig(V))}post_process(I,V=null,Z={}){let ne;for(let de of this.processors)if(de instanceof Ue)I=de.post_process(I).tokens,V&&(V=de.post_process(V).tokens);else{let be=de.post_process(I,V,Z);I=be.tokens,ne=be.token_type_ids}return{tokens:I,token_type_ids:ne}}}class Ke extends s.Callable{constructor(I){super(),this.config=I,this.added_tokens=[],this.end_of_word_suffix=null,this.trim_offsets=I.trim_offsets}static fromConfig(I){if(I===null)return null;switch(I.type){case"WordPiece":return new it(I);case"Metaspace":return new ar(I);case"ByteLevel":return new Ne(I);case"Replace":return new Re(I);case"ByteFallback":return new tt(I);case"Fuse":return new Qe(I);case"Strip":return new at(I);case"Sequence":return new _t(I);case"CTC":return new et(I);case"BPEDecoder":return new Et(I);default:throw new Error(`Unknown Decoder type: ${I.type}`)}}_call(I){return this.decode(I)}decode(I){return this.decode_chain(I).join("")}decode_chain(I){throw Error("`decode_chain` should be implemented in subclass.")}}class Re extends Ke{decode_chain(I){let V=f(this.config.pattern);return V===null?I:I.map(Z=>Z.replaceAll(V,this.config.content))}}class tt extends Ke{constructor(I){super(I),this.text_decoder=new TextDecoder}decode_chain(I){let V=[],Z=[];for(let ne of I){let de=null;if(ne.length===6&&ne.startsWith("<0x")&&ne.endsWith(">")){let be=parseInt(ne.slice(3,5),16);isNaN(be)||(de=be)}if(de!==null)Z.push(de);else{if(Z.length>0){let be=this.text_decoder.decode(Uint8Array.from(Z));V.push(be),Z=[]}V.push(ne)}}if(Z.length>0){let ne=this.text_decoder.decode(Uint8Array.from(Z));V.push(ne),Z=[]}return V}}class Qe extends Ke{decode_chain(I){return[I.join("")]}}class at extends Ke{constructor(I){super(I),this.content=this.config.content,this.start=this.config.start,this.stop=this.config.stop}decode_chain(I){return I.map(V=>{let Z=0;for(let de=0;de<this.start&&V[de]===this.content;++de){Z=de+1;continue}let ne=V.length;for(let de=0;de<this.stop;++de){let be=V.length-de-1;if(V[be]===this.content){ne=be;continue}else break}return V.slice(Z,ne)})}}class it extends Ke{constructor(I){super(I),this.cleanup=I.cleanup}decode_chain(I){return I.map((V,Z)=>(Z!==0&&(V.startsWith(this.config.prefix)?V=V.replace(this.config.prefix,""):V=" "+V),this.cleanup&&(V=E(V)),V))}}class Ne extends Ke{constructor(I){super(I),this.byte_decoder=H,this.text_decoder=new TextDecoder("utf-8",{fatal:!1,ignoreBOM:!0}),this.end_of_word_suffix=null}convert_tokens_to_string(I){let V=I.join(""),Z=new Uint8Array([...V].map(de=>this.byte_decoder[de]));return this.text_decoder.decode(Z)}decode_chain(I){let V=[],Z=[];for(let ne of I)this.added_tokens.find(de=>de.content===ne)!==void 0?(Z.length>0&&(V.push(this.convert_tokens_to_string(Z)),Z=[]),V.push(ne)):Z.push(ne);return Z.length>0&&V.push(this.convert_tokens_to_string(Z)),V}}class et extends Ke{constructor(I){super(I),this.pad_token=this.config.pad_token,this.word_delimiter_token=this.config.word_delimiter_token,this.cleanup=this.config.cleanup}convert_tokens_to_string(I){if(I.length===0)return"";let V=[I[0]];for(let de=1;de<I.length;++de)I[de]!==V.at(-1)&&V.push(I[de]);let ne=V.filter(de=>de!==this.pad_token).join("");return this.cleanup&&(ne=E(ne).replaceAll(this.word_delimiter_token," ").trim()),ne}decode_chain(I){return[this.convert_tokens_to_string(I)]}}class _t extends Ke{constructor(I){super(I),this.decoders=I.decoders.map(V=>Ke.fromConfig(V))}decode_chain(I){return this.decoders.reduce((V,Z)=>Z.decode_chain(V),I)}}class Et extends Ke{constructor(I){super(I),this.suffix=this.config.suffix}decode_chain(I){return I.map((V,Z)=>V.replaceAll(this.suffix,Z===I.length-1?"":" "))}}class At extends Ke{decode_chain(I){let V="";for(let Z=1;Z<I.length;Z+=2)V+=I[Z];return[V]}}class Bt extends ie{constructor(I){var V;super(),this.addPrefixSpace=I.add_prefix_space,this.replacement=I.replacement,this.strRep=I.str_rep||this.replacement,this.prepend_scheme=(V=I.prepend_scheme)!=null?V:"always"}pre_tokenize_text(I,{section_index:V=void 0}={}){let Z=I.replaceAll(" ",this.strRep);return this.addPrefixSpace&&!Z.startsWith(this.replacement)&&(this.prepend_scheme==="always"||this.prepend_scheme==="first"&&V===0)&&(Z=this.strRep+Z),[Z]}}class ar extends Ke{constructor(I){super(I),this.addPrefixSpace=I.add_prefix_space,this.replacement=I.replacement}decode_chain(I){let V=[];for(let Z=0;Z<I.length;++Z){let ne=I[Z].replaceAll(this.replacement," ");this.addPrefixSpace&&Z==0&&ne.startsWith(" ")&&(ne=ne.substring(1)),V.push(ne)}return V}}class ft extends ae{constructor(I){super(I),this.charsmap=I.precompiled_charsmap}normalize(I){return I=I.replace(/[\\u0001-\\u0008\\u000B\\u000E-\\u001F\\u007F\\u008F\\u009F]/gm,""),I=I.replace(/[\\u0009\\u000A\\u000C\\u000D\\u00A0\\u1680\\u2000-\\u200F\\u2028\\u2029\\u202F\\u205F\\u2581\\u3000\\uFEFF\\uFFFD]/gm," "),I.includes("\\uFF5E")?I=I.split("\\uFF5E").map(Z=>Z.normalize("NFKC")).join("\\uFF5E"):I=I.normalize("NFKC"),I}}class Jr extends ie{constructor(I){super(),this.tokenizers=I.pretokenizers.map(V=>ie.fromConfig(V))}pre_tokenize_text(I,V){return this.tokenizers.reduce((Z,ne)=>ne.pre_tokenize(Z,V),[I])}}class L extends ie{constructor(I){super()}pre_tokenize_text(I,V){return I.match(/\\w+|[^\\w\\s]+/g)||[]}}class se extends ie{constructor(I){super()}pre_tokenize_text(I,V){return T(I)}}class G extends ie{constructor(I){super(),this.config=I,this.pattern=f(this.config.pattern),this.content=this.config.content}pre_tokenize_text(I,V){return this.pattern===null?[I]:[I.replaceAll(this.pattern,this.config.content)]}}let te=["bos_token","eos_token","unk_token","sep_token","pad_token","cls_token","mask_token"];function Me(ue,I,V,Z){for(let ne of Object.keys(ue)){let de=I-ue[ne].length,be=V(ne),$e=new Array(de).fill(be);ue[ne]=Z==="right"?(0,o.mergeArrays)(ue[ne],$e):(0,o.mergeArrays)($e,ue[ne])}}function je(ue,I){for(let V of Object.keys(ue))ue[V].length=I}class Se extends s.Callable{constructor(V,Z){var ne,de,be,$e;super();ee(this,"return_token_type_ids",!1);ee(this,"padding_side","right");this.config=Z,this.normalizer=ae.fromConfig(V.normalizer),this.pre_tokenizer=ie.fromConfig(V.pre_tokenizer),this.model=N.fromConfig(V.model,Z),this.post_processor=xe.fromConfig(V.post_processor),this.decoder=Ke.fromConfig(V.decoder),this.special_tokens=[],this.all_special_ids=[],this.added_tokens=[];for(let Ge of V.added_tokens){let Be=new A(Ge);this.added_tokens.push(Be),this.model.tokens_to_ids.set(Be.content,Be.id),this.model.vocab[Be.id]=Be.content,Be.special&&(this.special_tokens.push(Be.content),this.all_special_ids.push(Be.id))}if(this.additional_special_tokens=(ne=Z.additional_special_tokens)!=null?ne:[],this.special_tokens.push(...this.additional_special_tokens),this.special_tokens=[...new Set(this.special_tokens)],this.decoder&&(this.decoder.added_tokens=this.added_tokens,this.decoder.end_of_word_suffix=this.model.end_of_word_suffix),this.added_tokens_splitter=new l.DictionarySplitter(this.added_tokens.map(Ge=>Ge.content)),this.added_tokens_map=new Map(this.added_tokens.map(Ge=>[Ge.content,Ge])),this.mask_token=this.getToken("mask_token"),this.mask_token_id=this.model.tokens_to_ids.get(this.mask_token),this.pad_token=this.getToken("pad_token","eos_token"),this.pad_token_id=this.model.tokens_to_ids.get(this.pad_token),this.sep_token=this.getToken("sep_token"),this.sep_token_id=this.model.tokens_to_ids.get(this.sep_token),this.unk_token=this.getToken("unk_token"),this.unk_token_id=this.model.tokens_to_ids.get(this.unk_token),this.bos_token=this.getToken("bos_token"),this.bos_token_id=this.model.tokens_to_ids.get(this.bos_token),this.eos_token=this.getToken("eos_token"),this.eos_token_id=this.model.tokens_to_ids.get(this.eos_token),this.model_max_length=Z.model_max_length,this.remove_space=Z.remove_space,this.clean_up_tokenization_spaces=(de=Z.clean_up_tokenization_spaces)!=null?de:!0,this.do_lowercase_and_remove_accent=(be=Z.do_lowercase_and_remove_accent)!=null?be:!1,Z.padding_side&&(this.padding_side=Z.padding_side),this.legacy=!1,this.chat_template=($e=Z.chat_template)!=null?$e:null,Array.isArray(this.chat_template)){let Ge=Object.create(null);for(let{name:Be,template:Je}of this.chat_template){if(typeof Be!="string"||typeof Je!="string")throw new Error(\'Chat template must be a list of objects with "name" and "template" properties\');Ge[Be]=Je}this.chat_template=Ge}this._compiled_template_cache=new Map}getToken(...V){for(let Z of V){let ne=this.config[Z];if(ne)if(typeof ne=="object"){if(ne.__type==="AddedToken")return ne.content;throw Error(`Unknown token: ${ne}`)}else return ne}return null}static async from_pretrained(V,{progress_callback:Z=null,config:ne=null,cache_dir:de=null,local_files_only:be=!1,revision:$e="main",legacy:Ge=null}={}){let Be=await d(V,{progress_callback:Z,config:ne,cache_dir:de,local_files_only:be,revision:$e,legacy:Ge});return new this(...Be)}_call(V,{text_pair:Z=null,add_special_tokens:ne=!0,padding:de=!1,truncation:be=null,max_length:$e=null,return_tensor:Ge=!0,return_token_type_ids:Be=null}={}){var vr;let Je=Array.isArray(V),wt;if(Je){if(V.length===0)throw Error("text array must be non-empty");if(Z!==null){if(Array.isArray(Z)){if(V.length!==Z.length)throw Error("text and text_pair must have the same length")}else throw Error("text_pair must also be an array");wt=V.map((Ht,Ut)=>this._encode_plus(Ht,{text_pair:Z[Ut],add_special_tokens:ne,return_token_type_ids:Be}))}else wt=V.map(Ht=>this._encode_plus(Ht,{add_special_tokens:ne,return_token_type_ids:Be}))}else{if(V==null)throw Error("text may not be null or undefined");if(Array.isArray(Z))throw Error("When specifying `text_pair`, since `text` is a string, `text_pair` must also be a string (i.e., not an array).");wt=[this._encode_plus(V,{text_pair:Z,add_special_tokens:ne,return_token_type_ids:Be})]}if($e===null?$e=this.model_max_length:be===null&&(de===!0?(console.warn("`max_length` is ignored when `padding: true` and there is no truncation strategy. To pad to max length, use `padding: \'max_length\'`."),$e=this.model_max_length):de===!1&&(console.warn("Truncation was not explicitly activated but `max_length` is provided a specific value, please use `truncation: true` to explicitly truncate examples to max length."),be=!0)),de===!0&&($e=Math.min((0,n.max)(wt.map(Ht=>Ht.input_ids.length))[0],$e!=null?$e:1/0)),$e=Math.min($e,(vr=this.model_max_length)!=null?vr:1/0),de||be)for(let Ht=0;Ht<wt.length;++Ht)wt[Ht].input_ids.length!==$e&&(wt[Ht].input_ids.length>$e?be&&je(wt[Ht],$e):de&&Me(wt[Ht],$e,Ut=>Ut==="input_ids"?this.pad_token_id:0,this.padding_side));let Rt={};if(Ge){if(!(de&&be)&&wt.some(Ut=>{var ir;for(let lr of Object.keys(Ut))if(Ut[lr].length!==((ir=wt[0][lr])==null?void 0:ir.length))return!0;return!1}))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with \'padding=true\' and \'truncation=true\' to have batched tensors with the same length.");let Ht=[wt.length,wt[0].input_ids.length];for(let Ut of Object.keys(wt[0]))Rt[Ut]=new i.Tensor("int64",BigInt64Array.from(wt.flatMap(ir=>ir[Ut]).map(BigInt)),Ht)}else{for(let Ht of Object.keys(wt[0]))Rt[Ht]=wt.map(Ut=>Ut[Ht]);if(!Je)for(let Ht of Object.keys(Rt))Rt[Ht]=Rt[Ht][0]}return Rt}_encode_text(V){if(V===null)return null;let Z=this.added_tokens_splitter.split(V);for(let de=0;de<Z.length;++de){let be=this.added_tokens_map.get(Z[de]);be&&(be.lstrip&&de>0&&(Z[de-1]=Z[de-1].trimEnd()),be.rstrip&&de<Z.length-1&&(Z[de+1]=Z[de+1].trimStart()))}return Z.flatMap((de,be)=>{if(de.length===0)return[];if(this.added_tokens_map.has(de))return[de];if(this.remove_space===!0&&(de=de.trim().split(/\\s+/).join(" ")),this.do_lowercase_and_remove_accent&&(de=w(de)),this.normalizer!==null&&(de=this.normalizer(de)),de.length===0)return[];let $e=this.pre_tokenizer!==null?this.pre_tokenizer(de,{section_index:be}):[de];return this.model($e)})}_encode_plus(V,{text_pair:Z=null,add_special_tokens:ne=!0,return_token_type_ids:de=null}={}){let{tokens:be,token_type_ids:$e}=this._tokenize_helper(V,{pair:Z,add_special_tokens:ne}),Ge=this.model.convert_tokens_to_ids(be),Be={input_ids:Ge,attention_mask:new Array(Ge.length).fill(1)};return(de!=null?de:this.return_token_type_ids)&&$e&&(Be.token_type_ids=$e),Be}_tokenize_helper(V,{pair:Z=null,add_special_tokens:ne=!1}={}){let de=this._encode_text(V),be=this._encode_text(Z);return this.post_processor?this.post_processor(de,be,{add_special_tokens:ne}):{tokens:(0,o.mergeArrays)(de!=null?de:[],be!=null?be:[])}}tokenize(V,{pair:Z=null,add_special_tokens:ne=!1}={}){return this._tokenize_helper(V,{pair:Z,add_special_tokens:ne}).tokens}encode(V,{text_pair:Z=null,add_special_tokens:ne=!0,return_token_type_ids:de=null}={}){return this._encode_plus(V,{text_pair:Z,add_special_tokens:ne,return_token_type_ids:de}).input_ids}batch_decode(V,Z={}){return V instanceof i.Tensor&&(V=V.tolist()),V.map(ne=>this.decode(ne,Z))}decode(V,Z={}){if(V instanceof i.Tensor&&(V=v(V)),!Array.isArray(V)||V.length===0||!(0,o.isIntegralNumber)(V[0]))throw Error("token_ids must be a non-empty array of integers.");return this.decode_single(V,Z)}decode_single(V,{skip_special_tokens:Z=!1,clean_up_tokenization_spaces:ne=null}){let de=this.model.convert_ids_to_tokens(V);Z&&(de=de.filter($e=>!this.special_tokens.includes($e)));let be=this.decoder?this.decoder(de):de.join(" ");return this.decoder&&this.decoder.end_of_word_suffix&&(be=be.replaceAll(this.decoder.end_of_word_suffix," "),Z&&(be=be.trim())),(ne!=null?ne:this.clean_up_tokenization_spaces)&&(be=E(be)),be}get_chat_template({chat_template:V=null,tools:Z=null}={}){if(this.chat_template&&typeof this.chat_template=="object"){let ne=this.chat_template;if(V!==null&&Object.hasOwn(ne,V))V=ne[V];else if(V===null)if(Z!==null&&"tool_use"in ne)V=ne.tool_use;else if("default"in ne)V=ne.default;else throw Error(`This model has multiple chat templates with no default specified! Please either pass a chat template or the name of the template you wish to use to the \'chat_template\' argument. Available template names are ${Object.keys(ne).sort()}.`)}else if(V===null)if(this.chat_template)V=this.chat_template;else throw Error("Cannot use apply_chat_template() because tokenizer.chat_template is not set and no template argument was passed! For information about writing templates and setting the tokenizer.chat_template attribute, please see the documentation at https://huggingface.co/docs/transformers/main/en/chat_templating");return V}apply_chat_template(V,Ut={}){var ir=Ut,{tools:Z=null,documents:ne=null,chat_template:de=null,add_generation_prompt:be=!1,tokenize:$e=!0,padding:Ge=!1,truncation:Be=!1,max_length:Je=null,return_tensor:wt=!0,return_dict:Rt=!1,tokenizer_kwargs:vr={}}=ir,Ht=ns(ir,["tools","documents","chat_template","add_generation_prompt","tokenize","padding","truncation","max_length","return_tensor","return_dict","tokenizer_kwargs"]);if(de=this.get_chat_template({chat_template:de,tools:Z}),typeof de!="string")throw Error(`chat_template must be a string, but got ${typeof de}`);let lr=this._compiled_template_cache.get(de);lr===void 0&&(lr=new c.Template(de),this._compiled_template_cache.set(de,lr));let ls=Object.create(null);for(let cr of te){let Cr=this.getToken(cr);Cr&&(ls[cr]=Cr)}let fs=lr.render(Fe(Fe({messages:V,add_generation_prompt:be,tools:Z,documents:ne},ls),Ht));if($e){let cr=this._call(fs,Fe({add_special_tokens:!1,padding:Ge,truncation:Be,max_length:Je,return_tensor:wt},vr));return Rt?cr:cr.input_ids}return fs}}class Dt extends Se{constructor(){super(...arguments);ee(this,"return_token_type_ids",!0)}}class Xt extends Se{constructor(){super(...arguments);ee(this,"return_token_type_ids",!0)}}class ht extends Se{constructor(){super(...arguments);ee(this,"return_token_type_ids",!0)}}class Ot extends Se{constructor(){super(...arguments);ee(this,"return_token_type_ids",!0)}}class Ye extends Se{constructor(){super(...arguments);ee(this,"return_token_type_ids",!0)}}class vt extends Se{constructor(){super(...arguments);ee(this,"return_token_type_ids",!0)}}class yt extends Se{constructor(){super(...arguments);ee(this,"return_token_type_ids",!0)}}class zt extends Se{constructor(){super(...arguments);ee(this,"return_token_type_ids",!0)}}class It extends Se{constructor(){super(...arguments);ee(this,"return_token_type_ids",!0)}}class er extends Se{}class br extends Se{}class hr extends Se{constructor(V,Z){super(V,Z);ee(this,"return_token_type_ids",!0);console.warn(\'WARNING: `XLMTokenizer` is not yet supported by Hugging Face\\\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.\')}}class Ir extends Se{constructor(){super(...arguments);ee(this,"return_token_type_ids",!0)}}class tr extends Se{}class kr extends Se{}class jr extends Se{}class Yr extends Se{constructor(I,V){super(I,V),this.languageRegex=/^[a-z]{2}_[A-Z]{2}$/,this.language_codes=this.special_tokens.filter(Z=>this.languageRegex.test(Z)),this.lang_to_token=Z=>Z}_build_translation_inputs(I,V,Z){return ts(this,I,V,Z)}}class vs extends Yr{}class Ds extends Se{}class Os extends Se{}let Vr="\\u2581";class Wr extends Se{constructor(V,Z){var ne;super(V,Z);ee(this,"padding_side","left");this.legacy=(ne=Z.legacy)!=null?ne:!0,this.legacy||(this.normalizer=null,this.pre_tokenizer=new Bt({replacement:Vr,add_prefix_space:!0,prepend_scheme:"first"}))}_encode_text(V){if(V===null)return null;if(this.legacy||V.length===0)return super._encode_text(V);let Z=super._encode_text(Vr+V.replaceAll(Vr," "));return Z.length>1&&Z[0]===Vr&&this.special_tokens.includes(Z[1])&&(Z=Z.slice(1)),Z}}class Ls extends Se{}class Dr extends Se{}class qr extends Se{}class Ae extends Se{}class Ze extends Se{}class rt extends Se{}class or extends Se{}class ps extends Se{}class Ur extends Se{}function ts(ue,I,V,Z){if(!("language_codes"in ue)||!Array.isArray(ue.language_codes))throw new Error("Tokenizer must have `language_codes` attribute set and it should be an array of language ids.");if(!("languageRegex"in ue)||!(ue.languageRegex instanceof RegExp))throw new Error("Tokenizer must have `languageRegex` attribute set and it should be a regular expression.");if(!("lang_to_token"in ue)||typeof ue.lang_to_token!="function")throw new Error("Tokenizer must have `lang_to_token` attribute set and it should be a function.");let ne=Z.src_lang,de=Z.tgt_lang;if(!ue.language_codes.includes(de))throw new Error(`Target language code "${de}" is not valid. Must be one of: {${ue.language_codes.join(", ")}}`);if(ne!==void 0){if(!ue.language_codes.includes(ne))throw new Error(`Source language code "${ne}" is not valid. Must be one of: {${ue.language_codes.join(", ")}}`);for(let be of ue.post_processor.config.single)if("SpecialToken"in be&&ue.languageRegex.test(be.SpecialToken.id)){be.SpecialToken.id=ue.lang_to_token(ne);break}}return Z.forced_bos_token_id=ue.model.convert_tokens_to_ids([ue.lang_to_token(de)])[0],ue._call(I,V)}class ms extends Se{constructor(I,V){super(I,V),this.languageRegex=/^[a-z]{3}_[A-Z][a-z]{3}$/,this.language_codes=this.special_tokens.filter(Z=>this.languageRegex.test(Z)),this.lang_to_token=Z=>Z}_build_translation_inputs(I,V,Z){return ts(this,I,V,Z)}}class Or extends Se{constructor(I,V){super(I,V),this.languageRegex=/^__[a-z]{2,3}__$/,this.language_codes=this.special_tokens.filter(Z=>this.languageRegex.test(Z)).map(Z=>Z.slice(2,-2)),this.lang_to_token=Z=>`__${Z}__`}_build_translation_inputs(I,V,Z){return ts(this,I,V,Z)}}class hs extends Se{get timestamp_begin(){return this.model.convert_tokens_to_ids(["<|notimestamps|>"])[0]+1}_decode_asr(I,{return_timestamps:V=!1,return_language:Z=!1,time_precision:ne=null,force_full_sequences:de=!0}={}){if(ne===null)throw Error("Must specify time_precision");let be=null,$e=V==="word";function Ge(){return{language:be,timestamp:[null,null],text:""}}let Be=[],Je=Ge(),wt=0,Rt=this.timestamp_begin,Ht=Rt+1500,Ut=[],ir=[],lr=!1,ls=null,fs=new Set(this.all_special_ids);for(let Vt of I){let xr=Vt.tokens,Fr=$e?Vt.token_timestamps:null,rs=null,gs=Rt;if("stride"in Vt){let[Sr,_r,Mr]=Vt.stride;if(wt-=_r,ls=Sr-Mr,_r&&(gs=_r/ne+Rt),Mr)for(let ur=xr.length-1;ur>=0;--ur){let Zr=Number(xr[ur]);if(Zr>=Rt){if(rs!==null&&(Zr-Rt)*ne<ls)break;rs=Zr}}}let Lr=[],zr=[];for(let Sr=0;Sr<xr.length;++Sr){let _r=Number(xr[Sr]);if(fs.has(_r)){let Mr=this.decode([_r]),ur=_.WHISPER_LANGUAGE_MAPPING.get(Mr.slice(2,-2));if(ur!==void 0){if(be!==null&&ur!==be&&!V){Ut.push(Lr);let Zr=this.findLongestCommonSequence(Ut)[0],Ms=this.decode(Zr);Je.text=Ms,Be.push(Je),Ut=[],Lr=[],Je=Ge()}be=Je.language=ur}}else if(_r>=Rt&&_r<=Ht){let Mr=(_r-Rt)*ne+wt,ur=(0,n.round)(Mr,2);if(rs!==null&&_r>=rs)lr=!0;else if(lr||Ut.length>0&&_r<gs)lr=!1;else if(Je.timestamp[0]===null)Je.timestamp[0]=ur;else if(ur!==Je.timestamp[0]){Je.timestamp[1]=ur,Ut.push(Lr),$e&&ir.push(zr);let[Zr,Ms]=this.findLongestCommonSequence(Ut,ir),Vs=this.decode(Zr);Je.text=Vs,$e&&(Je.words=this.collateWordTimestamps(Zr,Ms,be)),Be.push(Je),Ut=[],Lr=[],ir=[],zr=[],Je=Ge()}}else if(Lr.push(_r),$e){let Mr=(0,n.round)(Fr[Sr]+wt,2),ur;if(Sr+1<Fr.length){ur=(0,n.round)(Fr[Sr+1]+wt,2);let Zr=this.decode([_r]);g.test(Zr)&&(ur=(0,n.round)(Math.min(Mr+ne,ur),2))}else ur=null;zr.push([Mr,ur])}}if("stride"in Vt){let[Sr,_r,Mr]=Vt.stride;wt+=Sr-Mr}Lr.length>0?(Ut.push(Lr),$e&&ir.push(zr)):Ut.every(Sr=>Sr.length===0)&&(Je=Ge(),Ut=[],Lr=[],ir=[],zr=[])}if(Ut.length>0){if(de&&V)throw new Error("Whisper did not predict an ending timestamp, which can happen if audio is cut off in the middle of a word. Also make sure WhisperTimeStampLogitsProcessor was used during generation.");let[Vt,xr]=this.findLongestCommonSequence(Ut,ir),Fr=this.decode(Vt);Je.text=Fr,$e&&(Je.words=this.collateWordTimestamps(Vt,xr,be)),Be.push(Je)}let cr=Object.create(null),Cr=Be.map(Vt=>Vt.text).join("");if(V||Z){for(let Vt=0;Vt<Be.length;++Vt){let xr=Be[Vt];V||delete xr.timestamp,Z||delete xr.language}if($e){let Vt=[];for(let xr of Be)for(let Fr of xr.words)Vt.push(Fr);cr={chunks:Vt}}else cr={chunks:Be}}return[Cr,cr]}findLongestCommonSequence(I,V=null){let Z=I[0],ne=Z.length,de=[],be=Array.isArray(V)&&V.length>0,$e=be?[]:null,Ge=be?V[0]:null;for(let Be=1;Be<I.length;++Be){let Je=I[Be],wt=0,Rt=[ne,ne,0,0],vr=Je.length;for(let cr=1;cr<ne+vr;++cr){let Cr=Math.max(0,ne-cr),Vt=Math.min(ne,ne+vr-cr),xr=Z.slice(Cr,Vt),Fr=Math.max(0,cr-ne),rs=Math.min(vr,cr),gs=Je.slice(Fr,rs);if(xr.length!==gs.length)throw new Error("There is a bug within whisper `decode_asr` function, please report it. Dropping to prevent bad inference.");let Lr;be?Lr=xr.filter((_r,Mr)=>_r===gs[Mr]&&Ge[Cr+Mr]<=V[Be][Fr+Mr]).length:Lr=xr.filter((_r,Mr)=>_r===gs[Mr]).length;let zr=cr/1e4,Sr=Lr/cr+zr;Lr>1&&Sr>wt&&(wt=Sr,Rt=[Cr,Vt,Fr,rs])}let[Ht,Ut,ir,lr]=Rt,ls=Math.floor((Ut+Ht)/2),fs=Math.floor((lr+ir)/2);de.push(...Z.slice(0,ls)),Z=Je.slice(fs),ne=Z.length,be&&($e.push(...Ge.slice(0,ls)),Ge=V[Be].slice(fs))}return de.push(...Z),be?($e.push(...Ge),[de,$e]):[de,[]]}collateWordTimestamps(I,V,Z){let[ne,de,be]=this.combineTokensIntoWords(I,Z),$e=[];for(let Ge=0;Ge<ne.length;++Ge){let Be=be[Ge];$e.push({text:ne[Ge],timestamp:[V[Be.at(0)][0],V[Be.at(-1)][1]]})}return $e}combineTokensIntoWords(I,V,Z=`"\'\\u201C\\xA1\\xBF([{-`,ne=`"\'.\\u3002,\\uFF0C!\\uFF01?\\uFF1F:\\uFF1A\\u201D)]}\\u3001`){V=V!=null?V:"english";let de,be,$e;return["chinese","japanese","thai","lao","myanmar"].includes(V)?[de,be,$e]=this.splitTokensOnUnicode(I):[de,be,$e]=this.splitTokensOnSpaces(I),this.mergePunctuations(de,be,$e,Z,ne)}decode(I,V){let Z;return V!=null&&V.decode_with_timestamps?(I instanceof i.Tensor&&(I=v(I)),Z=this.decodeWithTimestamps(I,V)):Z=super.decode(I,V),Z}decodeWithTimestamps(I,V){var be;let Z=(be=V==null?void 0:V.time_precision)!=null?be:.02,ne=Array.from(this.all_special_ids).at(-1)+1,de=[[]];for(let $e of I)if($e=Number($e),$e>=ne){let Ge=(($e-ne)*Z).toFixed(2);de.push(`<|${Ge}|>`),de.push([])}else de[de.length-1].push($e);return de=de.map($e=>typeof $e=="string"?$e:super.decode($e,V)),de.join("")}splitTokensOnUnicode(I){let V=this.decode(I,{decode_with_timestamps:!0}),Z="\\uFFFD",ne=[],de=[],be=[],$e=[],Ge=[],Be=0;for(let Je=0;Je<I.length;++Je){let wt=I[Je];$e.push(wt),Ge.push(Je);let Rt=this.decode($e,{decode_with_timestamps:!0});(!Rt.includes(Z)||V[Be+Rt.indexOf(Z)]===Z)&&(ne.push(Rt),de.push($e),be.push(Ge),$e=[],Ge=[],Be+=Rt.length)}return[ne,de,be]}splitTokensOnSpaces(I){let[V,Z,ne]=this.splitTokensOnUnicode(I),de=[],be=[],$e=[],Ge=new RegExp(`^[${S}]$`,"gu");for(let Be=0;Be<V.length;++Be){let Je=V[Be],wt=Z[Be],Rt=ne[Be],vr=wt[0]>=this.model.tokens_to_ids.get("<|endoftext|>"),Ht=Je.startsWith(" "),Ut=Je.trim(),ir=Ge.test(Ut);if(vr||Ht||ir||de.length===0)de.push(Je),be.push(wt),$e.push(Rt);else{let lr=de.length-1;de[lr]+=Je,be[lr].push(...wt),$e[lr].push(...Rt)}}return[de,be,$e]}mergePunctuations(I,V,Z,ne,de){let be=structuredClone(I),$e=structuredClone(V),Ge=structuredClone(Z),Be=be.length-2,Je=be.length-1;for(;Be>=0;)be[Be].startsWith(" ")&&ne.includes(be[Be].trim())?(be[Je]=be[Be]+be[Je],$e[Je]=(0,o.mergeArrays)($e[Be],$e[Je]),Ge[Je]=(0,o.mergeArrays)(Ge[Be],Ge[Je]),be[Be]="",$e[Be]=[],Ge[Be]=[]):Je=Be,--Be;for(Be=0,Je=1;Je<be.length;)!be[Be].endsWith(" ")&&de.includes(be[Je])?(be[Be]+=be[Je],$e[Be]=(0,o.mergeArrays)($e[Be],$e[Je]),Ge[Be]=(0,o.mergeArrays)(Ge[Be],Ge[Je]),be[Je]="",$e[Je]=[],Ge[Je]=[]):Be=Je,++Je;return[be.filter(wt=>wt),$e.filter(wt=>wt.length>0),Ge.filter(wt=>wt.length>0)]}}class fr extends Se{}class gr extends Se{}class js extends Se{}class da extends Se{constructor(I,V){super(I,V),this.languageRegex=/^(>>\\w+<<)\\s*/g,this.supported_language_codes=this.model.vocab.filter(Z=>this.languageRegex.test(Z)),console.warn(\'WARNING: `MarianTokenizer` is not yet supported by Hugging Face\\\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.\')}_encode_text(I){if(I===null)return null;let[V,...Z]=I.trim().split(this.languageRegex);if(Z.length===0)return super._encode_text(V);if(Z.length===2){let[ne,de]=Z;return this.supported_language_codes.includes(ne)||console.warn(`Unsupported language code "${ne}" detected, which may lead to unexpected behavior. Should be one of: ${JSON.stringify(this.supported_language_codes)}`),(0,o.mergeArrays)([ne],super._encode_text(de))}}}class ua extends Se{}class _a extends Se{}class pa extends Se{}class zs extends Se{}class ma extends Se{}class ha extends Se{constructor(I,V){super(I,V),this.decoder=new At({})}}class Xs extends Se{}class fa extends Se{}class Bs{static async from_pretrained(I,{progress_callback:V=null,config:Z=null,cache_dir:ne=null,local_files_only:de=!1,revision:be="main",legacy:$e=null}={}){var Rt,vr;let[Ge,Be]=await d(I,{progress_callback:V,config:Z,cache_dir:ne,local_files_only:de,revision:be,legacy:$e}),Je=(vr=(Rt=Be.tokenizer_class)==null?void 0:Rt.replace(/Fast$/,""))!=null?vr:"PreTrainedTokenizer",wt=this.TOKENIZER_CLASS_MAPPING[Je];return wt||(console.warn(`Unknown tokenizer class "${Je}", attempting to construct from base class.`),wt=Se),new wt(Ge,Be)}}ee(Bs,"TOKENIZER_CLASS_MAPPING",{T5Tokenizer:tr,DistilBertTokenizer:er,CamembertTokenizer:br,DebertaTokenizer:Ye,DebertaV2Tokenizer:vt,BertTokenizer:Dt,HerbertTokenizer:yt,ConvBertTokenizer:zt,RoFormerTokenizer:It,XLMTokenizer:hr,ElectraTokenizer:Ir,MobileBertTokenizer:ht,SqueezeBertTokenizer:Ot,AlbertTokenizer:Xt,GPT2Tokenizer:kr,BartTokenizer:jr,MBartTokenizer:Yr,MBart50Tokenizer:vs,RobertaTokenizer:Ds,WhisperTokenizer:hs,CodeGenTokenizer:fr,CLIPTokenizer:gr,SiglipTokenizer:js,MarianTokenizer:da,BloomTokenizer:Os,NllbTokenizer:ms,M2M100Tokenizer:Or,LlamaTokenizer:Wr,CodeLlamaTokenizer:Ls,XLMRobertaTokenizer:Dr,MPNetTokenizer:qr,FalconTokenizer:Ae,GPTNeoXTokenizer:Ze,EsmTokenizer:rt,Wav2Vec2CTCTokenizer:ua,BlenderbotTokenizer:_a,BlenderbotSmallTokenizer:pa,SpeechT5Tokenizer:zs,NougatTokenizer:ma,VitsTokenizer:ha,Qwen2Tokenizer:or,GemmaTokenizer:ps,Grok1Tokenizer:Ur,CohereTokenizer:Xs,MgpstrTokenizer:fa,PreTrainedTokenizer:Se})},"./src/utils/audio.js":(e,r,t)=>{t.r(r),t.d(r,{RawAudio:()=>W,hamming:()=>u,hanning:()=>d,mel_filter_bank:()=>C,read_audio:()=>c,spectrogram:()=>P,window_function:()=>$});var s=t("./src/utils/hub.js"),o=t("./src/utils/maths.js"),a=t("./src/utils/core.js"),n=t("./src/env.js"),i=t("./src/utils/tensor.js"),l=t("?7992");async function c(R,J){if(typeof AudioContext=="undefined")throw Error("Unable to load audio from path/URL since `AudioContext` is not available in your environment. Instead, audio data should be passed directly to the pipeline/processor. For more information and some example code, see https://huggingface.co/docs/transformers.js/guides/node-audio-processing.");let H=await(await(0,s.getFile)(R)).arrayBuffer(),q=new AudioContext({sampleRate:J});typeof J=="undefined"&&console.warn(`No sampling rate provided, using default of ${q.sampleRate}Hz.`);let X=await q.decodeAudioData(H),ae;if(X.numberOfChannels===2){let ce=Math.sqrt(2),he=X.getChannelData(0),B=X.getChannelData(1);ae=new Float32Array(he.length);for(let D=0;D<X.length;++D)ae[D]=ce*(he[D]+B[D])/2}else ae=X.getChannelData(0);return ae}function _(R,J){if(R<1)return new Float64Array;if(R===1)return new Float64Array([1]);let H=1-J,q=2*Math.PI/(R-1),X=new Float64Array(R);for(let ae=0;ae<R;++ae)X[ae]=J-H*Math.cos(ae*q);return X}function d(R){return _(R,.5)}function u(R){return _(R,.54)}let f={htk:R=>2595*Math.log10(1+R/700),kaldi:R=>1127*Math.log(1+R/700),slaney:(R,J=1e3,H=15,q=27/Math.log(6.4))=>R>=J?H+Math.log(R/J)*q:3*R/200};function h(R,J="htk"){let H=f[J];if(!H)throw new Error(\'mel_scale should be one of "htk", "slaney" or "kaldi".\');return typeof R=="number"?H(R):R.map(q=>H(q))}let v={htk:R=>700*(10**(R/2595)-1),kaldi:R=>700*(Math.exp(R/1127)-1),slaney:(R,J=1e3,H=15,q=Math.log(6.4)/27)=>R>=H?J*Math.exp(q*(R-H)):200*R/3};function E(R,J="htk"){let H=v[J];if(!H)throw new Error(\'mel_scale should be one of "htk", "slaney" or "kaldi".\');return typeof R=="number"?H(R):R.map(q=>H(q))}function M(R,J){let H=Float64Array.from({length:J.length-1},(ce,he)=>J[he+1]-J[he]),q=Array.from({length:R.length},()=>new Array(J.length));for(let ce=0;ce<R.length;++ce){let he=q[ce];for(let B=0;B<J.length;++B)he[B]=J[B]-R[ce]}let X=J.length-2,ae=Array.from({length:X},()=>new Array(R.length));for(let ce=0;ce<R.length;++ce){let he=q[ce];for(let B=0;B<X;++B){let D=-he[B]/H[B],K=he[B+2]/H[B+1];ae[B][ce]=Math.max(0,Math.min(D,K))}}return ae}function w(R,J,H){let q=(J-R)/(H-1);return Float64Array.from({length:H},(X,ae)=>R+q*ae)}function C(R,J,H,q,X,ae=null,ce="htk",he=!1){if(ae!==null&&ae!=="slaney")throw new Error(\'norm must be one of null or "slaney"\');if(R<2)throw new Error(`Require num_frequency_bins: ${R} >= 2`);if(H>q)throw new Error(`Require min_frequency: ${H} <= max_frequency: ${q}`);let B=h(H,ce),D=h(q,ce),K=w(B,D,J+2),re=E(K,ce),me;if(he){let ge=X/((R-1)*2);me=h(Float64Array.from({length:R},(ze,We)=>We*ge),ce),re=K}else me=w(0,Math.floor(X/2),R);let oe=M(me,re);if(ae!==null&&ae==="slaney")for(let ge=0;ge<J;++ge){let ze=oe[ge],We=2/(re[ge+2]-re[ge]);for(let Ce=0;Ce<R;++Ce)ze[Ce]*=We}return oe}function x(R,J,H){let q=new R.constructor(R.length+J+H),X=R.length-1;for(let ae=0;ae<R.length;++ae)q[J+ae]=R[ae];for(let ae=1;ae<=J;++ae)q[J-ae]=R[(0,a.calculateReflectOffset)(ae,X)];for(let ae=1;ae<=H;++ae)q[X+J+ae]=R[(0,a.calculateReflectOffset)(X-ae,X)];return q}function T(R,J,H,q,X){if(H<=0)throw new Error("reference must be greater than zero");if(q<=0)throw new Error("min_value must be greater than zero");H=Math.max(q,H);let ae=Math.log10(H);for(let ce=0;ce<R.length;++ce)R[ce]=J*Math.log10(Math.max(q,R[ce])-ae);if(X!==null){if(X<=0)throw new Error("db_range must be greater than zero");let ce=(0,o.max)(R)[0]-X;for(let he=0;he<R.length;++he)R[he]=Math.max(R[he],ce)}return R}function S(R,J=1,H=1e-5,q=null){return T(R,20,J,H,q)}function g(R,J=1,H=1e-10,q=null){return T(R,10,J,H,q)}async function P(R,J,H,q,{fft_length:X=null,power:ae=1,center:ce=!0,pad_mode:he="reflect",onesided:B=!0,preemphasis:D=null,preemphasis_htk_flavor:K=!0,mel_filters:re=null,mel_floor:me=1e-10,log_mel:oe=null,reference:ge=1,min_value:ze=1e-10,db_range:We=null,remove_dc_offset:Ce=null,min_num_frames:ie=null,max_num_frames:Y=null,do_pad:j=!0,transpose:fe=!1}={}){let ve=J.length;if(X===null&&(X=H),H>X)throw Error(`frame_length (${H}) may not be larger than fft_length (${X})`);if(ve!==H)throw new Error(`Length of the window (${ve}) must equal frame_length (${H})`);if(q<=0)throw new Error("hop_length must be greater than zero");if(ae===null&&re!==null)throw new Error("You have provided `mel_filters` but `power` is `None`. Mel spectrogram computation is not yet supported for complex-valued spectrogram. Specify `power` to fix this issue.");if(!K)throw new Error("`preemphasis_htk_flavor=false` is not currently supported.");if(ce){if(he!=="reflect")throw new Error(`pad_mode="${he}" not implemented yet.`);let at=Math.floor((X-1)/2)+1;R=x(R,at,at)}let Ie=Math.floor(1+Math.floor((R.length-H)/q));ie!==null&&Ie<ie&&(Ie=ie);let xe=B?Math.floor(X/2)+1:X,ke=Ie,Pe=Ie;Y!==null&&(Y>Ie?j&&(Pe=Y):Pe=ke=Y);let He=new o.FFT(X),Ue=new Float64Array(X),qe=new Float64Array(He.outputBufferSize),Ke=new Float32Array(xe*Pe);for(let at=0;at<ke;++at){let it=at*q,Ne=Math.min(R.length-it,H);Ne!==H&&Ue.fill(0,0,H);for(let et=0;et<Ne;++et)Ue[et]=R[it+et];if(Ce){let et=0;for(let Et=0;Et<Ne;++Et)et+=Ue[Et];let _t=et/Ne;for(let Et=0;Et<Ne;++Et)Ue[Et]-=_t}if(D!==null){for(let et=Ne-1;et>=1;--et)Ue[et]-=D*Ue[et-1];Ue[0]*=1-D}for(let et=0;et<J.length;++et)Ue[et]*=J[et];He.realTransform(qe,Ue);for(let et=0;et<xe;++et){let _t=et<<1;Ke[et*Pe+at]=qe[_t]**2+qe[_t+1]**2}}if(ae!==null&&ae!==2){let at=ae/2;for(let it=0;it<Ke.length;++it)Ke[it]**=at}let Re=re.length,tt=await(0,i.matmul)(new i.Tensor("float32",re.flat(),[Re,xe]),new i.Tensor("float32",Ke,[xe,Pe]));fe&&(tt=tt.transpose(1,0));let Qe=tt.data;for(let at=0;at<Qe.length;++at)Qe[at]=Math.max(me,Qe[at]);if(ae!==null&&oe!==null){let at=Math.min(Qe.length,ke*Re);switch(oe){case"log":for(let it=0;it<at;++it)Qe[it]=Math.log(Qe[it]);break;case"log10":for(let it=0;it<at;++it)Qe[it]=Math.log10(Qe[it]);break;case"dB":if(ae===1)S(Qe,ge,ze,We);else if(ae===2)g(Qe,ge,ze,We);else throw new Error(`Cannot use log_mel option \'${oe}\' with power ${ae}`);break;default:throw new Error(`log_mel must be one of null, \'log\', \'log10\' or \'dB\'. Got \'${oe}\'`)}}return tt}function $(R,J,{periodic:H=!0,frame_length:q=null,center:X=!0}={}){let ae=H?R+1:R,ce;switch(J){case"boxcar":ce=new Float64Array(ae).fill(1);break;case"hann":case"hann_window":ce=d(ae);break;case"hamming":ce=u(ae);break;case"povey":ce=d(ae).map(he=>Math.pow(he,.85));break;default:throw new Error(`Unknown window type ${J}.`)}if(H&&(ce=ce.subarray(0,R)),q===null)return ce;if(R>q)throw new Error(`Length of the window (${R}) may not be larger than frame_length (${q})`);return ce}function A(R,J){let H=44,q=new ArrayBuffer(H+R.length*4),X=new DataView(q);N(X,0,"RIFF"),X.setUint32(4,36+R.length*4,!0),N(X,8,"WAVE"),N(X,12,"fmt "),X.setUint32(16,16,!0),X.setUint16(20,3,!0),X.setUint16(22,1,!0),X.setUint32(24,J,!0),X.setUint32(28,J*4,!0),X.setUint16(32,4,!0),X.setUint16(34,32,!0),N(X,36,"data"),X.setUint32(40,R.length*4,!0);for(let ae=0;ae<R.length;++ae,H+=4)X.setFloat32(H,R[ae],!0);return q}function N(R,J,H){for(let q=0;q<H.length;++q)R.setUint8(J+q,H.charCodeAt(q))}class W{constructor(J,H){this.audio=J,this.sampling_rate=H}toWav(){return A(this.audio,this.sampling_rate)}toBlob(){let J=this.toWav();return new Blob([J],{type:"audio/wav"})}async save(J){let H;if(n.apis.IS_BROWSER_ENV){if(n.apis.IS_WEBWORKER_ENV)throw new Error("Unable to save a file from a Web Worker.");H=a.saveBlob}else if(n.apis.IS_FS_AVAILABLE)H=async(q,X)=>{let ae=await X.arrayBuffer();l.writeFileSync(q,Buffer.from(ae))};else throw new Error("Unable to save because filesystem is disabled in this environment.");await H(J,this.toBlob())}}},"./src/utils/constants.js":(e,r,t)=>{t.r(r),t.d(r,{CHAT_TEMPLATE_NAME:()=>l,CONFIG_NAME:()=>o,FEATURE_EXTRACTOR_NAME:()=>a,GENERATION_CONFIG_NAME:()=>c,GITHUB_ISSUE_URL:()=>s,IMAGE_PROCESSOR_NAME:()=>n,PROCESSOR_NAME:()=>i});let s="https://github.com/huggingface/transformers.js/issues/new/choose",o="config.json",a="preprocessor_config.json",n=a,i="processor_config.json",l="chat_template.jinja",c="generation_config.json"},"./src/utils/core.js":(e,r,t)=>{t.r(r),t.d(r,{calculateDimensions:()=>c,calculateReflectOffset:()=>f,count:()=>M,dispatchCallback:()=>s,escapeRegExp:()=>a,isIntegralNumber:()=>i,isNullishDimension:()=>l,isTypedArray:()=>n,len:()=>E,mergeArrays:()=>d,pick:()=>v,pop:()=>_,product:()=>u,reverseDictionary:()=>o,saveBlob:()=>h});function s(w,C){w&&w(C)}function o(w){return Object.fromEntries(Object.entries(w).map(([C,x])=>[x,C]))}function a(w){return w.replace(/[.*+?^${}()|[\\]\\\\]/g,"\\\\$&")}function n(w){var C,x,T;return((T=(x=(C=w==null?void 0:w.prototype)==null?void 0:C.__proto__)==null?void 0:x.constructor)==null?void 0:T.name)==="TypedArray"}function i(w){return Number.isInteger(w)||typeof w=="bigint"}function l(w){return w==null||w===-1}function c(w){let C=[],x=w;for(;Array.isArray(x);)C.push(x.length),x=x[0];return C}function _(w,C,x=void 0){let T=w[C];if(T!==void 0)return delete w[C],T;if(x===void 0)throw Error(`Key ${C} does not exist in object.`);return x}function d(...w){return Array.prototype.concat.apply([],w)}function u(...w){return w.reduce((C,x)=>C.flatMap(T=>x.map(S=>[T,S])))}function f(w,C){return Math.abs((w+C)%(2*C)-C)}function h(w,C){let x=URL.createObjectURL(C),T=document.createElement("a");T.href=x,T.download=w,T.click(),T.remove(),URL.revokeObjectURL(x)}function v(w,C){return Object.assign({},...C.map(x=>{if(w[x]!==void 0)return{[x]:w[x]}}))}function E(w){let C=0;for(let x of w)++C;return C}function M(w,C){let x=0;for(let T of w)T===C&&++x;return x}},"./src/utils/data-structures.js":(e,r,t)=>{t.r(r),t.d(r,{CharTrie:()=>o,DictionarySplitter:()=>l,LRUCache:()=>c,PriorityQueue:()=>s,TokenLattice:()=>n});class s{constructor(d=(f,h)=>f>h,u=1/0){this._heap=[],this._comparator=d,this._maxSize=u}get size(){return this._heap.length}isEmpty(){return this.size===0}peek(){return this._heap[0]}push(...d){return this.extend(d)}extend(d){for(let u of d)if(this.size<this._maxSize)this._heap.push(u),this._siftUp();else{let f=this._smallest();this._comparator(u,this._heap[f])&&(this._heap[f]=u,this._siftUpFrom(f))}return this.size}pop(){let d=this.peek(),u=this.size-1;return u>0&&this._swap(0,u),this._heap.pop(),this._siftDown(),d}replace(d){let u=this.peek();return this._heap[0]=d,this._siftDown(),u}_parent(d){return(d+1>>>1)-1}_left(d){return(d<<1)+1}_right(d){return d+1<<1}_greater(d,u){return this._comparator(this._heap[d],this._heap[u])}_swap(d,u){let f=this._heap[d];this._heap[d]=this._heap[u],this._heap[u]=f}_siftUp(){this._siftUpFrom(this.size-1)}_siftUpFrom(d){for(;d>0&&this._greater(d,this._parent(d));)this._swap(d,this._parent(d)),d=this._parent(d)}_siftDown(){let d=0;for(;this._left(d)<this.size&&this._greater(this._left(d),d)||this._right(d)<this.size&&this._greater(this._right(d),d);){let u=this._right(d)<this.size&&this._greater(this._right(d),this._left(d))?this._right(d):this._left(d);this._swap(d,u),d=u}}_smallest(){return 2**Math.floor(Math.log2(this.size))-1}}class o{constructor(){this.root=a.default()}extend(d){for(let u of d)this.push(u)}push(d){let u=this.root;for(let f of d){let h=u.children.get(f);h===void 0&&(h=a.default(),u.children.set(f,h)),u=h}u.isLeaf=!0}*commonPrefixSearch(d){let u=this.root;if(u===void 0)return;let f="";for(let h of d){if(f+=h,u=u.children.get(h),u===void 0)return;u.isLeaf&&(yield f)}}}class a{constructor(d,u){this.isLeaf=d,this.children=u}static default(){return new a(!1,new Map)}}class n{constructor(d,u,f){this.chars=Array.from(d),this.len=this.chars.length,this.bosTokenId=u,this.eosTokenId=f,this.nodes=[],this.beginNodes=Array.from({length:this.len+1},()=>[]),this.endNodes=Array.from({length:this.len+1},()=>[]);let h=new i(this.bosTokenId,0,0,0,0),v=new i(this.eosTokenId,1,this.len,0,0);this.nodes.push(h.clone()),this.nodes.push(v.clone()),this.beginNodes[this.len].push(v),this.endNodes[0].push(h)}insert(d,u,f,h){let v=this.nodes.length,E=new i(h,v,d,u,f);this.beginNodes[d].push(E),this.endNodes[d+u].push(E),this.nodes.push(E)}viterbi(){let d=this.len,u=0;for(;u<=d;){if(this.beginNodes[u].length==0)return[];for(let M of this.beginNodes[u]){M.prev=null;let w=0,C=null;for(let x of this.endNodes[u]){let T=x.backtraceScore+M.score;(C===null||T>w)&&(C=x.clone(),w=T)}if(C!==null)M.prev=C,M.backtraceScore=w;else return[]}++u}let f=[],v=this.beginNodes[d][0].prev;if(v===null)return[];let E=v.clone();for(;E.prev!==null;)f.push(E.clone()),E=E.clone().prev.clone();return f.reverse(),f}piece(d){return this.chars.slice(d.pos,d.pos+d.length).join("")}tokens(){return this.viterbi().map(u=>this.piece(u))}tokenIds(){return this.viterbi().map(u=>u.tokenId)}}class i{constructor(d,u,f,h,v){this.tokenId=d,this.nodeId=u,this.pos=f,this.length=h,this.score=v,this.prev=null,this.backtraceScore=0}clone(){let d=new i(this.tokenId,this.nodeId,this.pos,this.length,this.score);return d.prev=this.prev,d.backtraceScore=this.backtraceScore,d}}class l{constructor(d){this.trie=this._buildTrie(d)}_buildTrie(d){var f,h;let u=Object.create(null);for(let v of d){let E=u;for(let M=0;M<v.length;++M)E=(h=E[f=v[M]])!=null?h:E[f]=Object.create(null);E.end=v}return u}split(d){let u=[],f=d.length,h=0,v=0;for(;v<f;){let E=this.trie,M=null,w=v;for(;w<f&&(E=E[d[w]]);)E.end&&(M=E.end),++w;M?(v>h&&u.push(d.slice(h,v)),u.push(M),v+=M.length,h=v):++v}return h<f&&u.push(d.slice(h)),u}}class c{constructor(d){this.capacity=d,this.cache=new Map}get(d){if(!this.cache.has(d))return;let u=this.cache.get(d);return this.cache.delete(d),this.cache.set(d,u),u}put(d,u){this.cache.has(d)&&this.cache.delete(d),this.cache.set(d,u),this.cache.size>this.capacity&&this.cache.delete(this.cache.keys().next().value)}clear(){this.cache.clear()}}},"./src/utils/devices.js":(e,r,t)=>{t.r(r),t.d(r,{DEVICE_TYPES:()=>s});let s=Object.freeze({auto:"auto",gpu:"gpu",cpu:"cpu",wasm:"wasm",webgpu:"webgpu",cuda:"cuda",dml:"dml",webnn:"webnn","webnn-npu":"webnn-npu","webnn-gpu":"webnn-gpu","webnn-cpu":"webnn-cpu"})},"./src/utils/dtypes.js":(e,r,t)=>{t.r(r),t.d(r,{DATA_TYPES:()=>n,DEFAULT_DEVICE_DTYPE_MAPPING:()=>i,DEFAULT_DTYPE_SUFFIX_MAPPING:()=>l,isWebGpuFp16Supported:()=>a});var s=t("./src/env.js"),o=t("./src/utils/devices.js");let a=function(){let c;return async function(){if(c===void 0)if(!s.apis.IS_WEBGPU_AVAILABLE)c=!1;else try{c=(await navigator.gpu.requestAdapter()).features.has("shader-f16")}catch(_){c=!1}return c}}(),n=Object.freeze({auto:"auto",fp32:"fp32",fp16:"fp16",q8:"q8",int8:"int8",uint8:"uint8",q4:"q4",bnb4:"bnb4",q4f16:"q4f16"}),i=Object.freeze({[o.DEVICE_TYPES.wasm]:n.q8}),l=Object.freeze({[n.fp32]:"",[n.fp16]:"_fp16",[n.int8]:"_int8",[n.uint8]:"_uint8",[n.q8]:"_quantized",[n.q4]:"_q4",[n.q4f16]:"_q4f16",[n.bnb4]:"_bnb4"})},"./src/utils/generic.js":(e,r,t)=>{t.r(r),t.d(r,{Callable:()=>s});let s=class{constructor(){let o=function(...a){return o._call(...a)};return Object.setPrototypeOf(o,new.target.prototype)}_call(...o){throw Error("Must implement _call method in subclass")}}},"./src/utils/hub.js":(e,r,t)=>{t.r(r),t.d(r,{MAX_EXTERNAL_DATA_CHUNKS:()=>i,getFile:()=>f,getModelFile:()=>w,getModelJSON:()=>x,getModelText:()=>C});var s=t("?7992"),o=t("?5af5"),a=t("./src/env.js"),n=t("./src/utils/core.js");let i=100,l={txt:"text/plain",html:"text/html",css:"text/css",js:"text/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"};class c{constructor(P){if(this.filePath=P,this.headers=new Headers,this.exists=s.existsSync(P),this.exists){this.status=200,this.statusText="OK";let $=s.statSync(P);this.headers.set("content-length",$.size.toString()),this.updateContentType();let A=s.createReadStream(P);this.body=new ReadableStream({start(N){A.on("data",W=>N.enqueue(W)),A.on("end",()=>N.close()),A.on("error",W=>N.error(W))},cancel(){A.destroy()}})}else this.status=404,this.statusText="Not Found",this.body=null}updateContentType(){var $;let P=this.filePath.toString().split(".").pop().toLowerCase();this.headers.set("content-type",($=l[P])!=null?$:"application/octet-stream")}clone(){let P=new c(this.filePath);return P.exists=this.exists,P.status=this.status,P.statusText=this.statusText,P.headers=new Headers(this.headers),P}async arrayBuffer(){return(await s.promises.readFile(this.filePath)).buffer}async blob(){let P=await s.promises.readFile(this.filePath);return new Blob([P],{type:this.headers.get("content-type")})}async text(){return await s.promises.readFile(this.filePath,"utf8")}async json(){return JSON.parse(await this.text())}}function _(g,P=null,$=null){let A;try{A=new URL(g)}catch(N){return!1}return!(P&&!P.includes(A.protocol)||$&&!$.includes(A.hostname))}let d=/^(\\b[\\w\\-.]+\\b\\/)?\\b[\\w\\-.]{1,96}\\b$/;function u(g){return!(!d.test(g)||g.includes("..")||g.includes("--")||g.endsWith(".git")||g.endsWith(".ipynb"))}async function f(g){var P,$,A,N,W;if(a.env.useFS&&!_(g,["http:","https:","blob:"]))return new c(g instanceof URL?g.protocol==="file:"?g.pathname:g.toString():g);if(typeof process!="undefined"&&((P=process==null?void 0:process.release)==null?void 0:P.name)==="node"){let R=!!(($=process.env)!=null&&$.TESTING_REMOTELY),J=a.env.version,H=new Headers;if(H.set("User-Agent",`transformers.js/${J}; is_ci/${R};`),_(g,["http:","https:"],["huggingface.co","hf.co"])){let X=(W=(A=process.env)==null?void 0:A.HF_TOKEN)!=null?W:(N=process.env)==null?void 0:N.HF_ACCESS_TOKEN;X&&H.set("Authorization",`Bearer ${X}`)}return fetch(g,{headers:H})}else return fetch(g)}let h={400:"Bad request error occurred while trying to load file",401:"Unauthorized access to file",403:"Forbidden access to file",404:"Could not locate file",408:"Request timeout error occurred while trying to load file",500:"Internal server error error occurred while trying to load file",502:"Bad gateway error occurred while trying to load file",503:"Service unavailable error occurred while trying to load file",504:"Gateway timeout error occurred while trying to load file"};function v(g,P,$){var N;if(!$)return null;let A=(N=h[g])!=null?N:`Error (${g}) occurred while trying to load file`;throw Error(`${A}: "${P}".`)}class E{constructor(P){this.path=P}async match(P){let $=o.join(this.path,P),A=new c($);if(A.exists)return A}async put(P,$,A=void 0){let N=o.join(this.path,P);try{let W=$.headers.get("Content-Length"),R=parseInt(W!=null?W:"0"),J=0;await s.promises.mkdir(o.dirname(N),{recursive:!0});let H=s.createWriteStream(N),q=$.body.getReader();for(;;){let{done:X,value:ae}=await q.read();if(X)break;await new Promise((he,B)=>{H.write(ae,D=>{if(D){B(D);return}he()})}),J+=ae.length;let ce=R?J/R*100:0;A==null||A({progress:ce,loaded:J,total:R})}H.close()}catch(W){try{await s.promises.unlink(N)}catch(R){}throw W}}}async function M(g,...P){for(let $ of P)try{let A=await g.match($);if(A)return A}catch(A){continue}}async function w(g,P,$=!0,A={},N=!1){var me,oe;if(!a.env.allowLocalModels){if(A.local_files_only)throw Error("Invalid configuration detected: local models are disabled (`env.allowLocalModels=false`) but you have requested to only use local models (`local_files_only=true`).");if(!a.env.allowRemoteModels)throw Error("Invalid configuration detected: both local and remote models are disabled. Fix by setting `env.allowLocalModels` or `env.allowRemoteModels` to `true`.")}(0,n.dispatchCallback)(A.progress_callback,{status:"initiate",name:g,file:P});let W;if(!W&&a.env.useCustomCache){if(!a.env.customCache)throw Error("`env.useCustomCache=true`, but `env.customCache` is not defined.");if(!a.env.customCache.match||!a.env.customCache.put)throw new Error("`env.customCache` must be an object which implements the `match` and `put` functions of the Web Cache API. For more information, see https://developer.mozilla.org/en-US/docs/Web/API/Cache");W=a.env.customCache}if(!W&&a.env.useBrowserCache){if(typeof caches=="undefined")throw Error("Browser cache is not available in this environment.");try{W=await caches.open("transformers-cache")}catch(ge){console.warn("An error occurred while opening the browser cache:",ge)}}if(!W&&a.env.useFSCache){if(!a.apis.IS_FS_AVAILABLE)throw Error("File System Cache is not available in this environment.");W=new E((me=A.cache_dir)!=null?me:a.env.cacheDir)}let R=(oe=A.revision)!=null?oe:"main",J=S(g,P),H=u(g),q=H?S(a.env.localModelPath,J):J,X=S(a.env.remoteHost,a.env.remotePathTemplate.replaceAll("{model}",g).replaceAll("{revision}",encodeURIComponent(R)),P),ae,ce=W instanceof E?R==="main"?J:S(g,R,P):X,he=!1,B;W&&(B=await M(W,q,ce));let D=B!==void 0;if(B===void 0){if(a.env.allowLocalModels)if(_(J,["http:","https:"])){if(A.local_files_only)throw new Error(`\\`local_files_only=true\\`, but attempted to load a remote file from: ${J}.`);if(!a.env.allowRemoteModels)throw new Error(`\\`env.allowRemoteModels=false\\`, but attempted to load a remote file from: ${J}.`)}else try{B=await f(q),ae=q}catch(ze){console.warn(`Unable to load from local path "${q}": "${ze}"`)}if(B===void 0||B.status===404){if(A.local_files_only||!a.env.allowRemoteModels){if($)throw Error(`\\`local_files_only=true\\` or \\`env.allowRemoteModels=false\\` and file was not found locally at "${q}".`);return null}if(!H)throw Error(`Local file missing at "${q}" and download aborted due to invalid model ID "${g}".`);if(B=await f(X),B.status!==200)return v(B.status,X,$);ae=ce}he=W&&typeof Response!="undefined"&&B instanceof Response&&B.status===200}(0,n.dispatchCallback)(A.progress_callback,{status:"download",name:g,file:P});let K;if(!(a.apis.IS_NODE_ENV&&N)){let ge;A.progress_callback?D&&typeof navigator!="undefined"&&/firefox/i.test(navigator.userAgent)?(ge=new Uint8Array(await B.arrayBuffer()),(0,n.dispatchCallback)(A.progress_callback,{status:"progress",name:g,file:P,progress:100,loaded:ge.length,total:ge.length})):ge=await T(B,ze=>{(0,n.dispatchCallback)(A.progress_callback,Fe({status:"progress",name:g,file:P},ze))}):ge=new Uint8Array(await B.arrayBuffer()),K=ge}if(he&&ae&&await W.match(ae)===void 0&&(K?await W.put(ae,new Response(K,{headers:B.headers})).catch(ge=>{console.warn(`Unable to add response to browser cache: ${ge}.`)}):await W.put(ae,B,A.progress_callback)),(0,n.dispatchCallback)(A.progress_callback,{status:"done",name:g,file:P}),K){if(!a.apis.IS_NODE_ENV&&N)throw new Error("Cannot return path in a browser environment.");return K}if(B instanceof c)return B.filePath;let re=await(W==null?void 0:W.match(ae));if(re instanceof c)return re.filePath;if(re instanceof Response)return new Uint8Array(await re.arrayBuffer());if(typeof re=="string")return re;throw new Error("Unable to get model file path or buffer.")}async function C(g,P,$=!0,A={}){let N=await w(g,P,$,A,!1);return N===null?null:new TextDecoder("utf-8").decode(N)}async function x(g,P,$=!0,A={}){let N=await C(g,P,$,A);return N===null?{}:JSON.parse(N)}async function T(g,P){let $=g.headers.get("Content-Length");$===null&&console.warn("Unable to determine content-length from response headers. Will expand buffer when needed.");let A=parseInt($!=null?$:"0"),N=new Uint8Array(A),W=0,R=g.body.getReader();async function J(){let{done:H,value:q}=await R.read();if(H)return;let X=W+q.length;if(X>A){A=X;let ce=new Uint8Array(A);ce.set(N),N=ce}N.set(q,W),W=X;let ae=W/A*100;return P({progress:ae,loaded:W,total:A}),J()}return await J(),N}function S(...g){return g=g.map((P,$)=>($&&(P=P.replace(new RegExp("^/"),"")),$!==g.length-1&&(P=P.replace(new RegExp("/$"),"")),P)),g.join("/")}},"./src/utils/image.js":(e,r,t)=>{t.r(r),t.d(r,{RawImage:()=>h,load_image:()=>v});var s=t("./src/utils/core.js"),o=t("./src/utils/hub.js"),a=t("./src/env.js"),n=t("./src/utils/tensor.js"),i=t("?2b25");let l,c,_,d=a.apis.IS_BROWSER_ENV||a.apis.IS_WEBWORKER_ENV;if(d)l=(E,M)=>{if(!self.OffscreenCanvas)throw new Error("OffscreenCanvas not supported by this browser.");return new self.OffscreenCanvas(E,M)},_=self.createImageBitmap,c=self.ImageData;else if(i)_=async E=>{let w=(await E.metadata()).channels,{data:C,info:x}=await E.rotate().raw().toBuffer({resolveWithObject:!0}),T=new h(new Uint8ClampedArray(C),x.width,x.height,x.channels);return w!==void 0&&w!==x.channels&&T.convert(w),T};else throw new Error("Unable to load image processing library.");let u={0:"nearest",1:"lanczos",2:"bilinear",3:"bicubic",4:"box",5:"hamming"},f=new Map([["png","image/png"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["gif","image/gif"]]);class h{constructor(M,w,C,x){this.data=M,this.width=w,this.height=C,this.channels=x}get size(){return[this.width,this.height]}static async read(M){if(M instanceof h)return M;if(typeof M=="string"||M instanceof URL)return await this.fromURL(M);if(M instanceof Blob)return await this.fromBlob(M);if(typeof HTMLCanvasElement!="undefined"&&M instanceof HTMLCanvasElement||typeof OffscreenCanvas!="undefined"&&M instanceof OffscreenCanvas)return this.fromCanvas(M);throw new Error(`Unsupported input type: ${typeof M}`)}static fromCanvas(M){if(!d)throw new Error("fromCanvas() is only supported in browser environments.");let C=M.getContext("2d").getImageData(0,0,M.width,M.height).data;return new h(C,M.width,M.height,4)}static async fromURL(M){let w=await(0,o.getFile)(M);if(w.status!==200)throw new Error(`Unable to read image from "${M}" (${w.status} ${w.statusText})`);let C=await w.blob();return this.fromBlob(C)}static async fromBlob(M){if(d){let w=await _(M),C=l(w.width,w.height).getContext("2d");return C.drawImage(w,0,0),new this(C.getImageData(0,0,w.width,w.height).data,w.width,w.height,4)}else{let w=i(await M.arrayBuffer());return await _(w)}}static fromTensor(M,w="CHW"){if(M.dims.length!==3)throw new Error(`Tensor should have 3 dimensions, but has ${M.dims.length} dimensions.`);if(w==="CHW")M=M.transpose(1,2,0);else if(w!=="HWC")throw new Error(`Unsupported channel format: ${w}`);if(!(M.data instanceof Uint8ClampedArray||M.data instanceof Uint8Array))throw new Error(`Unsupported tensor type: ${M.type}`);switch(M.dims[2]){case 1:case 2:case 3:case 4:return new h(M.data,M.dims[1],M.dims[0],M.dims[2]);default:throw new Error(`Unsupported number of channels: ${M.dims[2]}`)}}grayscale(){if(this.channels===1)return this;let M=new Uint8ClampedArray(this.width*this.height*1);switch(this.channels){case 3:case 4:for(let w=0,C=0;w<this.data.length;w+=this.channels){let x=this.data[w],T=this.data[w+1],S=this.data[w+2];M[C++]=Math.round(.2989*x+.587*T+.114*S)}break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(M,this.width,this.height,1)}rgb(){if(this.channels===3)return this;let M=new Uint8ClampedArray(this.width*this.height*3);switch(this.channels){case 1:for(let w=0,C=0;w<this.data.length;++w)M[C++]=this.data[w],M[C++]=this.data[w],M[C++]=this.data[w];break;case 4:for(let w=0,C=0;w<this.data.length;w+=4)M[C++]=this.data[w],M[C++]=this.data[w+1],M[C++]=this.data[w+2];break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(M,this.width,this.height,3)}rgba(){if(this.channels===4)return this;let M=new Uint8ClampedArray(this.width*this.height*4);switch(this.channels){case 1:for(let w=0,C=0;w<this.data.length;++w)M[C++]=this.data[w],M[C++]=this.data[w],M[C++]=this.data[w],M[C++]=255;break;case 3:for(let w=0,C=0;w<this.data.length;w+=3)M[C++]=this.data[w],M[C++]=this.data[w+1],M[C++]=this.data[w+2],M[C++]=255;break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(M,this.width,this.height,4)}putAlpha(M){if(M.width!==this.width||M.height!==this.height)throw new Error(`Expected mask size to be ${this.width}x${this.height}, but got ${M.width}x${M.height}`);if(M.channels!==1)throw new Error(`Expected mask to have 1 channel, but got ${M.channels}`);let w=this.data,C=M.data,x=this.width*this.height;if(this.channels===3){let T=new Uint8ClampedArray(x*4);for(let S=0,g=0,P=0;S<x;++S)T[P++]=w[g++],T[P++]=w[g++],T[P++]=w[g++],T[P++]=C[S];return this._update(T,this.width,this.height,4)}else if(this.channels===4){for(let T=0;T<x;++T)w[4*T+3]=C[T];return this}throw new Error(`Expected image to have 3 or 4 channels, but got ${this.channels}`)}async resize(M,w,{resample:C=2}={}){var g;if(this.width===M&&this.height===w)return this;let x=(g=u[C])!=null?g:C,T=(0,s.isNullishDimension)(M),S=(0,s.isNullishDimension)(w);if(T&&S)return this;if(T?M=w/this.height*this.width:S&&(w=M/this.width*this.height),d){let P=this.channels,$=this.toCanvas(),A=l(M,w).getContext("2d");return A.drawImage($,0,0,M,w),new h(A.getImageData(0,0,M,w).data,M,w,4).convert(P)}else{let P=this.toSharp();switch(x){case"box":case"hamming":(x==="box"||x==="hamming")&&(console.warn(`Resampling method ${x} is not yet supported. Using bilinear instead.`),x="bilinear");case"nearest":case"bilinear":case"bicubic":P=P.affine([M/this.width,0,0,w/this.height],{interpolator:x});break;case"lanczos":P=P.resize({width:M,height:w,fit:"fill",kernel:"lanczos3"});break;default:throw new Error(`Resampling method ${x} is not supported.`)}return await _(P)}}async pad([M,w,C,x]){if(M=Math.max(M,0),w=Math.max(w,0),C=Math.max(C,0),x=Math.max(x,0),M===0&&w===0&&C===0&&x===0)return this;if(d){let T=this.channels,S=this.toCanvas(),g=this.width+M+w,P=this.height+C+x,$=l(g,P).getContext("2d");return $.drawImage(S,0,0,this.width,this.height,M,C,this.width,this.height),new h($.getImageData(0,0,g,P).data,g,P,4).convert(T)}else{let T=this.toSharp().extend({left:M,right:w,top:C,bottom:x});return await _(T)}}async crop([M,w,C,x]){if(M=Math.max(M,0),w=Math.max(w,0),C=Math.min(C,this.width-1),x=Math.min(x,this.height-1),M===0&&w===0&&C===this.width-1&&x===this.height-1)return this;let T=C-M+1,S=x-w+1;if(d){let g=this.channels,P=this.toCanvas(),$=l(T,S).getContext("2d");return $.drawImage(P,M,w,T,S,0,0,T,S),new h($.getImageData(0,0,T,S).data,T,S,4).convert(g)}else{let g=this.toSharp().extract({left:M,top:w,width:T,height:S});return await _(g)}}async center_crop(M,w){if(this.width===M&&this.height===w)return this;let C=(this.width-M)/2,x=(this.height-w)/2;if(d){let T=this.channels,S=this.toCanvas(),g=l(M,w).getContext("2d"),P=0,$=0,A=0,N=0;return C>=0?P=C:A=-C,x>=0?$=x:N=-x,g.drawImage(S,P,$,M,w,A,N,M,w),new h(g.getImageData(0,0,M,w).data,M,w,4).convert(T)}else{let T=this.toSharp();if(C>=0&&x>=0)T=T.extract({left:Math.floor(C),top:Math.floor(x),width:M,height:w});else if(C<=0&&x<=0){let S=Math.floor(-x),g=Math.floor(-C);T=T.extend({top:S,left:g,right:M-this.width-g,bottom:w-this.height-S})}else{let S=[0,0],g=0;x<0?(S[0]=Math.floor(-x),S[1]=w-this.height-S[0]):g=Math.floor(x);let P=[0,0],$=0;C<0?(P[0]=Math.floor(-C),P[1]=M-this.width-P[0]):$=Math.floor(C),T=T.extend({top:S[0],bottom:S[1],left:P[0],right:P[1]}).extract({left:$,top:g,width:M,height:w})}return await _(T)}}async toBlob(M="image/png",w=1){if(!d)throw new Error("toBlob() is only supported in browser environments.");return await this.toCanvas().convertToBlob({type:M,quality:w})}toTensor(M="CHW"){let w=new n.Tensor("uint8",new Uint8Array(this.data),[this.height,this.width,this.channels]);if(M!=="HWC")if(M==="CHW")w=w.permute(2,0,1);else throw new Error(`Unsupported channel format: ${M}`);return w}toCanvas(){if(!d)throw new Error("toCanvas() is only supported in browser environments.");let M=this.clone().rgba(),w=l(M.width,M.height),C=new c(M.data,M.width,M.height);return w.getContext("2d").putImageData(C,0,0),w}split(){let{data:M,width:w,height:C,channels:x}=this,T=M.constructor,S=M.length/x,g=Array.from({length:x},()=>new T(S));for(let P=0;P<S;++P){let $=x*P;for(let A=0;A<x;++A)g[A][P]=M[$+A]}return g.map(P=>new h(P,w,C,1))}_update(M,w,C,x=null){return this.data=M,this.width=w,this.height=C,x!==null&&(this.channels=x),this}clone(){return new h(this.data.slice(),this.width,this.height,this.channels)}convert(M){if(this.channels===M)return this;switch(M){case 1:this.grayscale();break;case 3:this.rgb();break;case 4:this.rgba();break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this}async save(M){var w;if(d){if(a.apis.IS_WEBWORKER_ENV)throw new Error("Unable to save an image from a Web Worker.");let C=M.split(".").pop().toLowerCase(),x=(w=f.get(C))!=null?w:"image/png",T=await this.toBlob(x);(0,s.saveBlob)(M,T)}else{if(a.apis.IS_FS_AVAILABLE)return await this.toSharp().toFile(M);throw new Error("Unable to save the image because filesystem is disabled in this environment.")}}toSharp(){if(d)throw new Error("toSharp() is only supported in server-side environments.");return i(this.data,{raw:{width:this.width,height:this.height,channels:this.channels}})}}let v=h.read.bind(h)},"./src/utils/maths.js":(e,r,t)=>{t.r(r),t.d(r,{FFT:()=>v,bankers_round:()=>w,cos_sim:()=>l,dot:()=>i,dynamic_time_warping:()=>C,interpolate_data:()=>s,log_softmax:()=>n,magnitude:()=>c,max:()=>d,medianFilter:()=>E,min:()=>_,permute_data:()=>o,round:()=>M,softmax:()=>a});function s(x,[T,S,g],[P,$],A="bilinear",N=!1){let W=$/g,R=P/S,J=new x.constructor(P*$*T),H=S*g,q=P*$;for(let X=0;X<P;++X)for(let ae=0;ae<$;++ae){let ce=X*$+ae,he=(ae+.5)/W-.5,B=(X+.5)/R-.5,D=Math.floor(he),K=Math.floor(B),re=Math.min(D+1,g-1),me=Math.min(K+1,S-1);D=Math.max(D,0),K=Math.max(K,0);let oe=he-D,ge=B-K,ze=(1-oe)*(1-ge),We=oe*(1-ge),Ce=(1-oe)*ge,ie=oe*ge,Y=K*g,j=me*g,fe=Y+D,ve=Y+re,Ie=j+D,xe=j+re;for(let ke=0;ke<T;++ke){let Pe=ke*H;J[ke*q+ce]=ze*x[Pe+fe]+We*x[Pe+ve]+Ce*x[Pe+Ie]+ie*x[Pe+xe]}}return J}function o(x,T,S){let g=new Array(S.length),P=new Array(S.length);for(let N=S.length-1,W=1;N>=0;--N)P[N]=W,g[N]=T[S[N]],W*=g[N];let $=S.map((N,W)=>P[S.indexOf(W)]),A=new x.constructor(x.length);for(let N=0;N<x.length;++N){let W=0;for(let R=T.length-1,J=N;R>=0;--R)W+=J%T[R]*$[R],J=Math.floor(J/T[R]);A[W]=x[N]}return[A,g]}function a(x){let T=d(x)[0],S=x.map($=>Math.exp($-T)),g=S.reduce(($,A)=>$+A,0);return S.map($=>$/g)}function n(x){let T=d(x)[0],S=0;for(let $=0;$<x.length;++$)S+=Math.exp(x[$]-T);let g=Math.log(S);return x.map($=>$-T-g)}function i(x,T){let S=0;for(let g=0;g<x.length;++g)S+=x[g]*T[g];return S}function l(x,T){let S=i(x,T),g=c(x),P=c(T);return S/(g*P)}function c(x){return Math.sqrt(x.reduce((T,S)=>T+S*S,0))}function _(x){if(x.length===0)throw Error("Array must not be empty");let T=x[0],S=0;for(let g=1;g<x.length;++g)x[g]<T&&(T=x[g],S=g);return[T,S]}function d(x){if(x.length===0)throw Error("Array must not be empty");let T=x[0],S=0;for(let g=1;g<x.length;++g)x[g]>T&&(T=x[g],S=g);return[T,S]}function u(x){return x>0&&(x&x-1)===0}class f{constructor(T){if(this.size=T|0,this.size<=1||!u(this.size))throw new Error("FFT size must be a power of two larger than 1");this._csize=T<<1,this.table=new Float64Array(this.size*2);for(let g=0;g<this.table.length;g+=2){let P=Math.PI*g/this.size;this.table[g]=Math.cos(P),this.table[g+1]=-Math.sin(P)}let S=0;for(let g=1;this.size>g;g<<=1)++S;this._width=S%2===0?S-1:S,this._bitrev=new Int32Array(1<<this._width);for(let g=0;g<this._bitrev.length;++g){this._bitrev[g]=0;for(let P=0;P<this._width;P+=2){let $=this._width-P-2;this._bitrev[g]|=(g>>>P&3)<<$}}}createComplexArray(){return new Float64Array(this._csize)}fromComplexArray(T,S){let g=S||new Array(T.length>>>1);for(let P=0;P<T.length;P+=2)g[P>>>1]=T[P];return g}toComplexArray(T,S){let g=S||this.createComplexArray();for(let P=0;P<g.length;P+=2)g[P]=T[P>>>1],g[P+1]=0;return g}transform(T,S){if(T===S)throw new Error("Input and output buffers must be different");this._transform4(T,S,1)}realTransform(T,S){if(T===S)throw new Error("Input and output buffers must be different");this._realTransform4(T,S,1)}inverseTransform(T,S){if(T===S)throw new Error("Input and output buffers must be different");this._transform4(T,S,-1);for(let g=0;g<T.length;++g)T[g]/=this.size}_transform4(T,S,g){let P=this._csize,A=1<<this._width,N=P/A<<1,W,R,J=this._bitrev;if(N===4)for(W=0,R=0;W<P;W+=N,++R){let q=J[R];this._singleTransform2(S,T,W,q,A)}else for(W=0,R=0;W<P;W+=N,++R){let q=J[R];this._singleTransform4(S,T,W,q,A,g)}let H=this.table;for(A>>=2;A>=2;A>>=2){N=P/A<<1;let q=N>>>2;for(W=0;W<P;W+=N){let X=W+q-1;for(let ae=W,ce=0;ae<X;ae+=2,ce+=A){let he=ae,B=he+q,D=B+q,K=D+q,re=T[he],me=T[he+1],oe=T[B],ge=T[B+1],ze=T[D],We=T[D+1],Ce=T[K],ie=T[K+1],Y=H[ce],j=g*H[ce+1],fe=oe*Y-ge*j,ve=oe*j+ge*Y,Ie=H[2*ce],xe=g*H[2*ce+1],ke=ze*Ie-We*xe,Pe=ze*xe+We*Ie,He=H[3*ce],Ue=g*H[3*ce+1],qe=Ce*He-ie*Ue,Ke=Ce*Ue+ie*He,Re=re+ke,tt=me+Pe,Qe=re-ke,at=me-Pe,it=fe+qe,Ne=ve+Ke,et=g*(fe-qe),_t=g*(ve-Ke);T[he]=Re+it,T[he+1]=tt+Ne,T[B]=Qe+_t,T[B+1]=at-et,T[D]=Re-it,T[D+1]=tt-Ne,T[K]=Qe-_t,T[K+1]=at+et}}}}_singleTransform2(T,S,g,P,$){let A=T[P],N=T[P+1],W=T[P+$],R=T[P+$+1];S[g]=A+W,S[g+1]=N+R,S[g+2]=A-W,S[g+3]=N-R}_singleTransform4(T,S,g,P,$,A){let N=$*2,W=$*3,R=T[P],J=T[P+1],H=T[P+$],q=T[P+$+1],X=T[P+N],ae=T[P+N+1],ce=T[P+W],he=T[P+W+1],B=R+X,D=J+ae,K=R-X,re=J-ae,me=H+ce,oe=q+he,ge=A*(H-ce),ze=A*(q-he);S[g]=B+me,S[g+1]=D+oe,S[g+2]=K+ze,S[g+3]=re-ge,S[g+4]=B-me,S[g+5]=D-oe,S[g+6]=K-ze,S[g+7]=re+ge}_realTransform4(T,S,g){let P=this._csize,A=1<<this._width,N=P/A<<1,W,R,J=this._bitrev;if(N===4)for(W=0,R=0;W<P;W+=N,++R){let X=J[R];this._singleRealTransform2(S,T,W,X>>>1,A>>>1)}else for(W=0,R=0;W<P;W+=N,++R){let X=J[R];this._singleRealTransform4(S,T,W,X>>>1,A>>>1,g)}let H=this.table;for(A>>=2;A>=2;A>>=2){N=P/A<<1;let X=N>>>1,ae=X>>>1,ce=ae>>>1;for(W=0;W<P;W+=N)for(let he=0,B=0;he<=ce;he+=2,B+=A){let D=W+he,K=D+ae,re=K+ae,me=re+ae,oe=T[D],ge=T[D+1],ze=T[K],We=T[K+1],Ce=T[re],ie=T[re+1],Y=T[me],j=T[me+1],fe=oe,ve=ge,Ie=H[B],xe=g*H[B+1],ke=ze*Ie-We*xe,Pe=ze*xe+We*Ie,He=H[2*B],Ue=g*H[2*B+1],qe=Ce*He-ie*Ue,Ke=Ce*Ue+ie*He,Re=H[3*B],tt=g*H[3*B+1],Qe=Y*Re-j*tt,at=Y*tt+j*Re,it=fe+qe,Ne=ve+Ke,et=fe-qe,_t=ve-Ke,Et=ke+Qe,At=Pe+at,Bt=g*(ke-Qe),ar=g*(Pe-at);if(T[D]=it+Et,T[D+1]=Ne+At,T[K]=et+ar,T[K+1]=_t-Bt,he===0){T[re]=it-Et,T[re+1]=Ne-At;continue}if(he===ce)continue;let ft=W+ae-he,Jr=W+X-he;T[ft]=et-g*ar,T[ft+1]=-_t-g*Bt,T[Jr]=it-g*Et,T[Jr+1]=-Ne+g*At}}let q=P>>>1;for(let X=2;X<q;X+=2)T[P-X]=T[X],T[P-X+1]=-T[X+1]}_singleRealTransform2(T,S,g,P,$){let A=T[P],N=T[P+$];S[g]=A+N,S[g+1]=0,S[g+2]=A-N,S[g+3]=0}_singleRealTransform4(T,S,g,P,$,A){let N=$*2,W=$*3,R=T[P],J=T[P+$],H=T[P+N],q=T[P+W],X=R+H,ae=R-H,ce=J+q,he=A*(J-q);S[g]=X+ce,S[g+1]=0,S[g+2]=ae,S[g+3]=-he,S[g+4]=X-ce,S[g+5]=0,S[g+6]=ae,S[g+7]=he}}class h{constructor(T){let S=2*(T-1),g=2*(2*T-1),P=2**Math.ceil(Math.log2(g));this.bufferSize=P,this._a=S;let $=new Float64Array(g),A=new Float64Array(P);this._chirpBuffer=new Float64Array(P),this._buffer1=new Float64Array(P),this._buffer2=new Float64Array(P),this._outBuffer1=new Float64Array(P),this._outBuffer2=new Float64Array(P);let N=-2*Math.PI/T,W=Math.cos(N),R=Math.sin(N);for(let J=0;J<g>>1;++J){let H=(J+1-T)**2/2,q=Math.sqrt(W**2+R**2)**H,X=H*Math.atan2(R,W),ae=2*J;$[ae]=q*Math.cos(X),$[ae+1]=q*Math.sin(X),A[ae]=$[ae],A[ae+1]=-$[ae+1]}this._slicedChirpBuffer=$.subarray(S,g),this._f=new f(P>>1),this._f.transform(this._chirpBuffer,A)}_transform(T,S,g){let P=this._buffer1,$=this._buffer2,A=this._outBuffer1,N=this._outBuffer2,W=this._chirpBuffer,R=this._slicedChirpBuffer,J=this._a;if(g)for(let H=0;H<R.length;H+=2){let q=H+1,X=H>>1,ae=S[X];P[H]=ae*R[H],P[q]=ae*R[q]}else for(let H=0;H<R.length;H+=2){let q=H+1;P[H]=S[H]*R[H]-S[q]*R[q],P[q]=S[H]*R[q]+S[q]*R[H]}this._f.transform(A,P);for(let H=0;H<W.length;H+=2){let q=H+1;$[H]=A[H]*W[H]-A[q]*W[q],$[q]=A[H]*W[q]+A[q]*W[H]}this._f.inverseTransform(N,$);for(let H=0;H<N.length;H+=2){let q=N[H+J],X=N[H+J+1],ae=R[H],ce=R[H+1];T[H]=q*ae-X*ce,T[H+1]=q*ce+X*ae}}transform(T,S){this._transform(T,S,!1)}realTransform(T,S){this._transform(T,S,!0)}}class v{constructor(T){this.fft_length=T,this.isPowerOfTwo=u(T),this.isPowerOfTwo?(this.fft=new f(T),this.outputBufferSize=2*T):(this.fft=new h(T),this.outputBufferSize=this.fft.bufferSize)}realTransform(T,S){this.fft.realTransform(T,S)}transform(T,S){this.fft.transform(T,S)}}function E(x,T){if(T%2===0||T<=0)throw new Error("Window size must be a positive odd number");let S=new x.constructor(x.length),g=new x.constructor(T),P=Math.floor(T/2);for(let $=0;$<x.length;++$){let A=0;for(let N=-P;N<=P;++N){let W=$+N;W<0?W=Math.abs(W):W>=x.length&&(W=2*(x.length-1)-W),g[A++]=x[W]}g.sort(),S[$]=g[P]}return S}function M(x,T){let S=Math.pow(10,T);return Math.round(x*S)/S}function w(x){let T=Math.round(x);return Math.abs(x)%1===.5?T%2===0?T:T-1:T}function C(x){let T=x.length,S=x[0].length,g=[T+1,S+1],P=Array.from({length:g[0]},()=>Array(g[1]).fill(1/0));P[0][0]=0;let $=Array.from({length:g[0]},()=>Array(g[1]).fill(-1));for(let J=1;J<g[1];++J)for(let H=1;H<g[0];++H){let q=P[H-1][J-1],X=P[H-1][J],ae=P[H][J-1],ce,he;q<X&&q<ae?(ce=q,he=0):X<q&&X<ae?(ce=X,he=1):(ce=ae,he=2),P[H][J]=x[H-1][J-1]+ce,$[H][J]=he}for(let J=0;J<g[1];++J)$[0][J]=2;for(let J=0;J<g[0];++J)$[J][0]=1;let A=T,N=S,W=[],R=[];for(;A>0||N>0;)switch(W.push(A-1),R.push(N-1),$[A][N]){case 0:--A,--N;break;case 1:--A;break;case 2:--N;break;default:throw new Error(`Internal error in dynamic time warping. Unexpected trace[${A}, ${N}]. Please file a bug report.`)}return W.reverse(),R.reverse(),[W,R]}},"./src/utils/tensor.js":(e,r,t)=>{t.r(r),t.d(r,{DataTypeMap:()=>n,Tensor:()=>i,cat:()=>S,full:()=>R,full_like:()=>J,interpolate:()=>_,interpolate_4d:()=>d,layer_norm:()=>w,matmul:()=>u,mean:()=>A,mean_pooling:()=>M,ones:()=>H,ones_like:()=>q,permute:()=>c,quantize_embeddings:()=>he,rand:()=>ce,rfft:()=>f,slice:()=>E,stack:()=>g,std_mean:()=>$,topk:()=>h,zeros:()=>X,zeros_like:()=>ae});var s=t("./src/utils/maths.js"),o=t("./src/backends/onnx.js"),a=t("./src/ops/registry.js");let n=Object.freeze({float32:Float32Array,float16:typeof Float16Array!="undefined"?Float16Array:Uint16Array,float64:Float64Array,string:Array,int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,int64:BigInt64Array,uint64:BigUint64Array,bool:Uint8Array,uint4:Uint8Array,int4:Int8Array});class i{constructor(...D){ee(this,"ort_tensor");return(0,o.isONNXTensor)(D[0])?this.ort_tensor=D[0]:this.ort_tensor=new o.Tensor(D[0],D[1],D[2]),new Proxy(this,{get:(K,re)=>{if(typeof re=="string"){let me=Number(re);if(Number.isInteger(me))return K._getitem(me)}return K[re]},set:(K,re,me)=>K[re]=me})}get dims(){return this.ort_tensor.dims}set dims(D){this.ort_tensor.dims=D}get type(){return this.ort_tensor.type}get data(){return this.ort_tensor.data}get size(){return this.ort_tensor.size}get location(){return this.ort_tensor.location}dispose(){this.ort_tensor.dispose()}*[Symbol.iterator](){let[D,...K]=this.dims;if(K.length>0){let re=K.reduce((me,oe)=>me*oe);for(let me=0;me<D;++me)yield this._subarray(me,re,K)}else yield*sf(this.data)}_getitem(D){let[K,...re]=this.dims;if(D=T(D,K),re.length>0){let me=re.reduce((oe,ge)=>oe*ge);return this._subarray(D,me,re)}else return new i(this.type,[this.data[D]],re)}indexOf(D){let K=this.data;for(let re=0;re<K.length;++re)if(K[re]==D)return re;return-1}_subarray(D,K,re){let me=D*K,oe=(D+1)*K,ge="subarray"in this.data?this.data.subarray(me,oe):this.data.slice(me,oe);return new i(this.type,ge,re)}item(){let D=this.data;if(D.length!==1)throw new Error(`a Tensor with ${D.length} elements cannot be converted to Scalar`);return D[0]}tolist(){return l(this.data,this.dims)}sigmoid(){return this.clone().sigmoid_()}sigmoid_(){let D=this.data;for(let K=0;K<D.length;++K)D[K]=1/(1+Math.exp(-D[K]));return this}map(D){return this.clone().map_(D)}map_(D){let K=this.data;for(let re=0;re<K.length;++re)K[re]=D(K[re],re,K);return this}mul(D){return this.clone().mul_(D)}mul_(D){let K=this.data;for(let re=0;re<K.length;++re)K[re]*=D;return this}div(D){return this.clone().div_(D)}div_(D){let K=this.data;for(let re=0;re<K.length;++re)K[re]/=D;return this}add(D){return this.clone().add_(D)}add_(D){let K=this.data;for(let re=0;re<K.length;++re)K[re]+=D;return this}sub(D){return this.clone().sub_(D)}sub_(D){let K=this.data;for(let re=0;re<K.length;++re)K[re]-=D;return this}clone(){return new i(this.type,this.data.slice(),this.dims.slice())}slice(...D){let K=[],re=[];for(let Ce=0;Ce<this.dims.length;++Ce){let ie=D[Ce];if(ie==null)re.push([0,this.dims[Ce]]),K.push(this.dims[Ce]);else if(typeof ie=="number")ie=T(ie,this.dims[Ce],Ce),re.push([ie,ie+1]);else if(Array.isArray(ie)&&ie.length===2){let[Y,j]=ie;if(Y=Y===null?0:T(Y,this.dims[Ce],Ce,!1),j=j===null?this.dims[Ce]:T(j,this.dims[Ce],Ce,!1),Y>j)throw new Error(`Invalid slice: ${ie}`);let fe=[Math.max(Y,0),Math.min(j,this.dims[Ce])];re.push(fe),K.push(fe[1]-fe[0])}else throw new Error(`Invalid slice: ${ie}`)}let me=re.map(([Ce,ie])=>ie-Ce),oe=me.reduce((Ce,ie)=>Ce*ie),ge=this.data,ze=new ge.constructor(oe),We=this.stride();for(let Ce=0;Ce<oe;++Ce){let ie=0;for(let Y=me.length-1,j=Ce;Y>=0;--Y){let fe=me[Y];ie+=(j%fe+re[Y][0])*We[Y],j=Math.floor(j/fe)}ze[Ce]=ge[ie]}return new i(this.type,ze,K)}permute(...D){return c(this,D)}transpose(...D){return this.permute(...D)}sum(D=null,K=!1){return this.norm(1,D,K)}norm(D="fro",K=null,re=!1){if(D==="fro")D=2;else if(typeof D=="string")throw Error(`Unsupported norm: ${D}`);let me=this.data,oe=(Ce,ie)=>Ce+ie**D;if(K===null){let Ce=me.reduce(oe,0)**(1/D);return new i(this.type,[Ce],[])}let[ge,ze,We]=P(oe,this,K,re);if(D!==1)for(let Ce=0;Ce<ze.length;++Ce)ze[Ce]=ze[Ce]**(1/D);return new i(ge,ze,We)}normalize_(D=2,K=1){K=T(K,this.dims.length);let re=this.norm(D,K,!0),me=this.data,oe=re.data;for(let ge=0;ge<me.length;++ge){let ze=0;for(let We=this.dims.length-1,Ce=ge,ie=1;We>=0;--We){let Y=this.dims[We];if(We!==K){let j=Ce%Y;ze+=j*ie,ie*=this.dims[We]}Ce=Math.floor(Ce/Y)}me[ge]/=oe[ze]}return this}normalize(D=2,K=1){return this.clone().normalize_(D,K)}stride(){return N(this.dims)}squeeze(D=null){return new i(this.type,this.data,C(this.dims,D))}squeeze_(D=null){return this.dims=C(this.dims,D),this}unsqueeze(D=null){return new i(this.type,this.data,x(this.dims,D))}unsqueeze_(D=null){return this.dims=x(this.dims,D),this}flatten_(D=0,K=-1){K=(K+this.dims.length)%this.dims.length;let re=this.dims.slice(0,D),me=this.dims.slice(D,K+1),oe=this.dims.slice(K+1);return this.dims=[...re,me.reduce((ge,ze)=>ge*ze,1),...oe],this}flatten(D=0,K=-1){return this.clone().flatten_(D,K)}view(...D){let K=-1;for(let me=0;me<D.length;++me)if(D[me]===-1){if(K!==-1)throw new Error("Only one dimension can be inferred");K=me}let re=this.data;if(K!==-1){let me=D.reduce((oe,ge,ze)=>ze!==K?oe*ge:oe,1);D[K]=re.length/me}return new i(this.type,re,D)}neg_(){let D=this.data;for(let K=0;K<D.length;++K)D[K]=-D[K];return this}neg(){return this.clone().neg_()}gt(D){let K=new Uint8Array(this.data.length),re=this.data;for(let me=0;me<re.length;++me)K[me]=re[me]>D?1:0;return new i("bool",K,this.dims)}lt(D){let K=new Uint8Array(this.data.length),re=this.data;for(let me=0;me<re.length;++me)K[me]=re[me]<D?1:0;return new i("bool",K,this.dims)}clamp_(D,K){let re=this.data;for(let me=0;me<re.length;++me)re[me]=Math.min(Math.max(re[me],D),K);return this}clamp(D,K){return this.clone().clamp_(D,K)}round_(){let D=this.data;for(let K=0;K<D.length;++K)D[K]=Math.round(D[K]);return this}round(){return this.clone().round_()}mean(D=null,K=!1){return A(this,D,K)}min(D=null,K=!1){if(D===null){let ge=(0,s.min)(this.data)[0];return new i(this.type,[ge],[])}let[re,me,oe]=P((ge,ze)=>Math.min(ge,ze),this,D,K,1/0);return new i(re,me,oe)}max(D=null,K=!1){if(D===null){let ge=(0,s.max)(this.data)[0];return new i(this.type,[ge],[])}let[re,me,oe]=P((ge,ze)=>Math.max(ge,ze),this,D,K,-1/0);return new i(re,me,oe)}argmin(D=null,K=!1){if(D!==null)throw new Error("`dim !== null` not yet implemented.");let re=(0,s.min)(this.data)[1];return new i("int64",[BigInt(re)],[])}argmax(D=null,K=!1){if(D!==null)throw new Error("`dim !== null` not yet implemented.");let re=(0,s.max)(this.data)[1];return new i("int64",[BigInt(re)],[])}to(D){if(this.type===D)return this;if(!n.hasOwnProperty(D))throw new Error(`Unsupported type: ${D}`);let K,re=["int64","uint64"].includes(this.type),me=["int64","uint64"].includes(D);return re&&!me?K=Number:!re&&me&&(K=BigInt),new i(D,n[D].from(this.data,K),this.dims)}}function l(B,D){let K=B.length,re=D.reduce((oe,ge)=>oe*ge);if(K!==re)throw Error(`cannot reshape array of size ${K} into shape (${D})`);let me=B;for(let oe=D.length-1;oe>=0;oe--)me=me.reduce((ge,ze)=>{let We=ge[ge.length-1];return We.length<D[oe]?We.push(ze):ge.push([ze]),ge},[[]]);return me[0]}function c(B,D){let[K,re]=(0,s.permute_data)(B.data,B.dims,D);return new i(B.type,K,re)}function _(B,[D,K],re="bilinear",me=!1){var Ce;let oe=(Ce=B.dims.at(-3))!=null?Ce:1,ge=B.dims.at(-2),ze=B.dims.at(-1),We=(0,s.interpolate_data)(B.data,[oe,ge,ze],[D,K],re,me);return new i(B.type,We,[oe,D,K])}async function d(B,{size:D=null,mode:K="bilinear"}={}){if(B.dims.length!==4)throw new Error("`interpolate_4d` currently only supports 4D input.");if(!D)throw new Error("`interpolate_4d` requires a `size` argument.");let re;if(D.length===2)re=[...B.dims.slice(0,2),...D];else if(D.length===3)re=[B.dims[0],...D];else if(D.length===4)re=D;else throw new Error("`size` must be of length 2, 3, or 4.");let me;if(K==="nearest")me=await a.TensorOpRegistry.nearest_interpolate_4d;else if(K==="bilinear")me=await a.TensorOpRegistry.bilinear_interpolate_4d;else if(K==="bicubic")me=await a.TensorOpRegistry.bicubic_interpolate_4d;else throw new Error(`Unsupported mode: ${K}`);let oe=new i("int64",new BigInt64Array(re.map(BigInt)),[re.length]);return await me({x:B,s:oe})}async function u(B,D){return await(await a.TensorOpRegistry.matmul)({a:B,b:D})}async function f(B,D){return await(await a.TensorOpRegistry.rfft)({x:B,a:D})}async function h(B,D){let K=await a.TensorOpRegistry.top_k;return D==null?D=B.dims.at(-1):D=Math.min(D,B.dims.at(-1)),await K({x:B,k:new i("int64",[BigInt(D)],[1])})}let v=B=>new i("int64",B,[B.length]);async function E(B,D,K,re,me){return await(await a.TensorOpRegistry.slice)({x:B,s:v(D),e:v(K),a:v(re),t:v(me!=null?me:new Array(re.length).fill(1))})}function M(B,D){let K=B.data,re=D.data,me=[B.dims[0],B.dims[2]],oe=new K.constructor(me[0]*me[1]),[ge,ze,We]=B.dims,Ce=0;for(let ie=0;ie<ge;++ie){let Y=ie*We*ze;for(let j=0;j<We;++j){let fe=0,ve=0,Ie=ie*ze,xe=Y+j;for(let Pe=0;Pe<ze;++Pe){let He=Number(re[Ie+Pe]);ve+=He,fe+=K[xe+Pe*We]*He}let ke=fe/ve;oe[Ce++]=ke}}return new i(B.type,oe,me)}function w(B,D,{eps:K=1e-5}={}){if(B.dims.length!==2)throw new Error("`layer_norm` currently only supports 2D input.");let[re,me]=B.dims;if(D.length!==1&&D[0]!==me)throw new Error("`normalized_shape` must be a 1D array with shape `[input.dims[1]]`.");let[oe,ge]=$(B,1,0,!0),ze=oe.data,We=ge.data,Ce=B.data,ie=new Ce.constructor(Ce.length);for(let Y=0;Y<re;++Y){let j=Y*me;for(let fe=0;fe<me;++fe){let ve=j+fe;ie[ve]=(Ce[ve]-We[Y])/(ze[Y]+K)}}return new i(B.type,ie,B.dims)}function C(B,D){return B=B.slice(),D===null?B=B.filter(K=>K!==1):typeof D=="number"?B[D]===1&&B.splice(D,1):Array.isArray(D)&&(B=B.filter((K,re)=>K!==1||!D.includes(re))),B}function x(B,D){return D=T(D,B.length+1),B=B.slice(),B.splice(D,0,1),B}function T(B,D,K=null,re=!0){if(B<-D||B>=D){if(re)throw new Error(`IndexError: index ${B} is out of bounds for dimension${K===null?"":" "+K} with size ${D}`);return B<-D?0:D}return B<0&&(B=(B%D+D)%D),B}function S(B,D=0){D=T(D,B[0].dims.length);let K=B[0].dims.slice();K[D]=B.reduce((ge,ze)=>ge+ze.dims[D],0);let re=K.reduce((ge,ze)=>ge*ze,1),me=new B[0].data.constructor(re),oe=B[0].type;if(D===0){let ge=0;for(let ze of B){let We=ze.data;me.set(We,ge),ge+=We.length}}else{let ge=0;for(let ze=0;ze<B.length;++ze){let{data:We,dims:Ce}=B[ze];for(let ie=0;ie<We.length;++ie){let Y=0;for(let j=Ce.length-1,fe=ie,ve=1;j>=0;--j){let Ie=Ce[j],xe=fe%Ie;j===D&&(xe+=ge),Y+=xe*ve,ve*=K[j],fe=Math.floor(fe/Ie)}me[Y]=We[ie]}ge+=Ce[D]}}return new i(oe,me,K)}function g(B,D=0){return S(B.map(K=>K.unsqueeze(D)),D)}function P(B,D,K=null,re=!1,me=null){let oe=D.data,ge=D.dims;K=T(K,ge.length);let ze=ge.slice();ze[K]=1;let We=new oe.constructor(oe.length/ge[K]);me!==null&&We.fill(me);for(let Ce=0;Ce<oe.length;++Ce){let ie=0;for(let Y=ge.length-1,j=Ce,fe=1;Y>=0;--Y){let ve=ge[Y];if(Y!==K){let Ie=j%ve;ie+=Ie*fe,fe*=ze[Y]}j=Math.floor(j/ve)}We[ie]=B(We[ie],oe[Ce],Ce,ie)}return re||ze.splice(K,1),[D.type,We,ze]}function $(B,D=null,K=1,re=!1){let me=B.data,oe=B.dims;if(D===null){let fe=me.reduce((ke,Pe)=>ke+Pe,0)/me.length,ve=Math.sqrt(me.reduce((ke,Pe)=>ke+(Pe-fe)**2,0)/(me.length-K)),Ie=new i(B.type,[fe],[]);return[new i(B.type,[ve],[]),Ie]}D=T(D,oe.length);let ge=A(B,D,re),ze=ge.data,[We,Ce,ie]=P((j,fe,ve,Ie)=>j+(fe-ze[Ie])**2,B,D,re);for(let j=0;j<Ce.length;++j)Ce[j]=Math.sqrt(Ce[j]/(oe[D]-K));return[new i(We,Ce,ie),ge]}function A(B,D=null,K=!1){let re=B.dims,me=B.data;if(D===null){let We=me.reduce((Ce,ie)=>Ce+ie,0);return new i(B.type,[We/me.length],[])}D=T(D,re.length);let[oe,ge,ze]=P((We,Ce)=>We+Ce,B,D,K);if(re[D]!==1)for(let We=0;We<ge.length;++We)ge[We]/=re[D];return new i(oe,ge,ze)}function N(B){let D=new Array(B.length);for(let K=B.length-1,re=1;K>=0;--K)D[K]=re,re*=B[K];return D}function W(B,D,K,re){let me=B.reduce((oe,ge)=>oe*ge,1);return new i(K,new re(me).fill(D),B)}function R(B,D){let K,re;if(typeof D=="number")K="float32",re=Float32Array;else if(typeof D=="bigint")K="int64",re=BigInt64Array;else if(typeof D=="boolean")K="bool",re=Uint8Array;else throw new Error(`Unsupported data type: ${typeof D}`);return W(B,D,K,re)}function J(B,D){return R(B.dims,D)}function H(B){return W(B,BigInt(1),"int64",BigInt64Array)}function q(B){return H(B.dims)}function X(B){return W(B,BigInt(0),"int64",BigInt64Array)}function ae(B){return X(B.dims)}function ce(B){let D=B.reduce((K,re)=>K*re,1);return new i("float32",Float32Array.from({length:D},()=>Math.random()),B)}function he(B,D){if(B.dims.length!==2)throw new Error("The tensor must have 2 dimensions");if(B.dims.at(-1)%8!==0)throw new Error("The last dimension of the tensor must be a multiple of 8");if(!["binary","ubinary"].includes(D))throw new Error("The precision must be either \'binary\' or \'ubinary\'");let K=D==="binary",re=K?"int8":"uint8",me=K?Int8Array:Uint8Array,oe=B.data,ge=new me(oe.length/8);for(let ze=0;ze<oe.length;++ze){let We=oe[ze]>0?1:0,Ce=Math.floor(ze/8),ie=ze%8;ge[Ce]|=We<<7-ie,K&&ie===0&&(ge[Ce]-=128)}return new i(re,ge,[B.dims[0],B.dims[1]/8])}},"./src/utils/video.js":(e,r,t)=>{t.r(r),t.d(r,{RawVideo:()=>n,RawVideoFrame:()=>a,load_video:()=>i});var s=t("./src/utils/image.js"),o=t("./src/env.js");class a{constructor(c,_){this.image=c,this.timestamp=_}}class n{constructor(c,_){c.length>0&&c[0]instanceof s.RawImage&&(c=c.map((d,u)=>new a(d,(u+1)/(c.length+1)*_))),this.frames=c,this.duration=_}get width(){return this.frames[0].image.width}get height(){return this.frames[0].image.height}get fps(){return this.frames.length/this.duration}}async function i(l,{num_frames:c=null,fps:_=null}={}){if(!o.apis.IS_BROWSER_ENV)throw new Error("`load_video` is currently only supported in browser environments.");if(c==null&&_==null)throw new Error("Either num_frames or fps must be provided.");let d=[],u=document.createElement("video");if(u.crossOrigin="anonymous",u.muted=!0,typeof l=="string")u.src=l;else if(l instanceof Blob)u.src=URL.createObjectURL(l);else if(l instanceof HTMLVideoElement)u.src=l.src;else throw new Error("Invalid URL or video element provided.");if(await new Promise(C=>u.onloadedmetadata=C),u.seekable.start(0)===u.seekable.end(0)){let x=await(await fetch(u.src)).blob();u.src=URL.createObjectURL(x),await new Promise(T=>u.onloadedmetadata=T)}let f=u.duration,h,v;c!=null?(h=c,v=c===1?0:f/(c-1)):(v=1/_,h=Math.floor(f/v));let E=[];for(let C=0;C<h;++C)E.push(c===1?f/2:C*v);let M=document.createElement("canvas");M.width=u.videoWidth,M.height=u.videoHeight;let w=M.getContext("2d",{willReadFrequently:!0});for(let C of E){u.currentTime=C,await new Promise(g=>{u.onseeked=g}),w.drawImage(u,0,0,M.width,M.height);let x=w.getImageData(0,0,M.width,M.height),T=new s.RawImage(x.data,M.width,M.height,4),S=new a(T,C);d.push(S)}return u.remove(),new n(d,f)}}},i0={};(()=>{var e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,r;Qt.t=function(t,s){if(s&1&&(t=this(t)),s&8||typeof t=="object"&&t&&(s&4&&t.__esModule||s&16&&typeof t.then=="function"))return t;var o=Object.create(null);Qt.r(o);var a={};r=r||[null,e({}),e([]),e(e)];for(var n=s&2&&t;typeof n=="object"&&!~r.indexOf(n);n=e(n))Object.getOwnPropertyNames(n).forEach(i=>a[i]=()=>t[i]);return a.default=()=>t,Qt.d(o,a),o}})();Qt.d=(e,r)=>{for(var t in r)Qt.o(r,t)&&!Qt.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})};Qt.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r);Qt.r=e=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};m={};(()=>{Qt.r(m),Qt.d(m,{ASTFeatureExtractor:()=>d.ASTFeatureExtractor,ASTForAudioClassification:()=>t.ASTForAudioClassification,ASTModel:()=>t.ASTModel,ASTPreTrainedModel:()=>t.ASTPreTrainedModel,AlbertForMaskedLM:()=>t.AlbertForMaskedLM,AlbertForQuestionAnswering:()=>t.AlbertForQuestionAnswering,AlbertForSequenceClassification:()=>t.AlbertForSequenceClassification,AlbertModel:()=>t.AlbertModel,AlbertPreTrainedModel:()=>t.AlbertPreTrainedModel,AlbertTokenizer:()=>s.AlbertTokenizer,AudioClassificationPipeline:()=>r.AudioClassificationPipeline,AutoConfig:()=>o.AutoConfig,AutoFeatureExtractor:()=>u.AutoFeatureExtractor,AutoImageProcessor:()=>v.AutoImageProcessor,AutoModel:()=>t.AutoModel,AutoModelForAudioClassification:()=>t.AutoModelForAudioClassification,AutoModelForAudioFrameClassification:()=>t.AutoModelForAudioFrameClassification,AutoModelForAudioTextToText:()=>t.AutoModelForAudioTextToText,AutoModelForCTC:()=>t.AutoModelForCTC,AutoModelForCausalLM:()=>t.AutoModelForCausalLM,AutoModelForDepthEstimation:()=>t.AutoModelForDepthEstimation,AutoModelForDocumentQuestionAnswering:()=>t.AutoModelForDocumentQuestionAnswering,AutoModelForImageClassification:()=>t.AutoModelForImageClassification,AutoModelForImageFeatureExtraction:()=>t.AutoModelForImageFeatureExtraction,AutoModelForImageMatting:()=>t.AutoModelForImageMatting,AutoModelForImageSegmentation:()=>t.AutoModelForImageSegmentation,AutoModelForImageTextToText:()=>t.AutoModelForImageTextToText,AutoModelForImageToImage:()=>t.AutoModelForImageToImage,AutoModelForMaskGeneration:()=>t.AutoModelForMaskGeneration,AutoModelForMaskedLM:()=>t.AutoModelForMaskedLM,AutoModelForNormalEstimation:()=>t.AutoModelForNormalEstimation,AutoModelForObjectDetection:()=>t.AutoModelForObjectDetection,AutoModelForPoseEstimation:()=>t.AutoModelForPoseEstimation,AutoModelForQuestionAnswering:()=>t.AutoModelForQuestionAnswering,AutoModelForSemanticSegmentation:()=>t.AutoModelForSemanticSegmentation,AutoModelForSeq2SeqLM:()=>t.AutoModelForSeq2SeqLM,AutoModelForSequenceClassification:()=>t.AutoModelForSequenceClassification,AutoModelForSpeechSeq2Seq:()=>t.AutoModelForSpeechSeq2Seq,AutoModelForTextToSpectrogram:()=>t.AutoModelForTextToSpectrogram,AutoModelForTextToWaveform:()=>t.AutoModelForTextToWaveform,AutoModelForTokenClassification:()=>t.AutoModelForTokenClassification,AutoModelForUniversalSegmentation:()=>t.AutoModelForUniversalSegmentation,AutoModelForVision2Seq:()=>t.AutoModelForVision2Seq,AutoModelForXVector:()=>t.AutoModelForXVector,AutoModelForZeroShotObjectDetection:()=>t.AutoModelForZeroShotObjectDetection,AutoProcessor:()=>w.AutoProcessor,AutoTokenizer:()=>s.AutoTokenizer,AutomaticSpeechRecognitionPipeline:()=>r.AutomaticSpeechRecognitionPipeline,BackgroundRemovalPipeline:()=>r.BackgroundRemovalPipeline,BartForConditionalGeneration:()=>t.BartForConditionalGeneration,BartForSequenceClassification:()=>t.BartForSequenceClassification,BartModel:()=>t.BartModel,BartPretrainedModel:()=>t.BartPretrainedModel,BartTokenizer:()=>s.BartTokenizer,BaseModelOutput:()=>t.BaseModelOutput,BaseStreamer:()=>C.BaseStreamer,BeitFeatureExtractor:()=>h.BeitFeatureExtractor,BeitForImageClassification:()=>t.BeitForImageClassification,BeitModel:()=>t.BeitModel,BeitPreTrainedModel:()=>t.BeitPreTrainedModel,BertForMaskedLM:()=>t.BertForMaskedLM,BertForQuestionAnswering:()=>t.BertForQuestionAnswering,BertForSequenceClassification:()=>t.BertForSequenceClassification,BertForTokenClassification:()=>t.BertForTokenClassification,BertModel:()=>t.BertModel,BertPreTrainedModel:()=>t.BertPreTrainedModel,BertTokenizer:()=>s.BertTokenizer,BitImageProcessor:()=>h.BitImageProcessor,BlenderbotForConditionalGeneration:()=>t.BlenderbotForConditionalGeneration,BlenderbotModel:()=>t.BlenderbotModel,BlenderbotPreTrainedModel:()=>t.BlenderbotPreTrainedModel,BlenderbotSmallForConditionalGeneration:()=>t.BlenderbotSmallForConditionalGeneration,BlenderbotSmallModel:()=>t.BlenderbotSmallModel,BlenderbotSmallPreTrainedModel:()=>t.BlenderbotSmallPreTrainedModel,BlenderbotSmallTokenizer:()=>s.BlenderbotSmallTokenizer,BlenderbotTokenizer:()=>s.BlenderbotTokenizer,BloomForCausalLM:()=>t.BloomForCausalLM,BloomModel:()=>t.BloomModel,BloomPreTrainedModel:()=>t.BloomPreTrainedModel,BloomTokenizer:()=>s.BloomTokenizer,CLIPFeatureExtractor:()=>h.CLIPFeatureExtractor,CLIPImageProcessor:()=>h.CLIPImageProcessor,CLIPModel:()=>t.CLIPModel,CLIPPreTrainedModel:()=>t.CLIPPreTrainedModel,CLIPSegForImageSegmentation:()=>t.CLIPSegForImageSegmentation,CLIPSegModel:()=>t.CLIPSegModel,CLIPSegPreTrainedModel:()=>t.CLIPSegPreTrainedModel,CLIPTextModel:()=>t.CLIPTextModel,CLIPTextModelWithProjection:()=>t.CLIPTextModelWithProjection,CLIPTokenizer:()=>s.CLIPTokenizer,CLIPVisionModel:()=>t.CLIPVisionModel,CLIPVisionModelWithProjection:()=>t.CLIPVisionModelWithProjection,CamembertForMaskedLM:()=>t.CamembertForMaskedLM,CamembertForQuestionAnswering:()=>t.CamembertForQuestionAnswering,CamembertForSequenceClassification:()=>t.CamembertForSequenceClassification,CamembertForTokenClassification:()=>t.CamembertForTokenClassification,CamembertModel:()=>t.CamembertModel,CamembertPreTrainedModel:()=>t.CamembertPreTrainedModel,CamembertTokenizer:()=>s.CamembertTokenizer,CausalLMOutput:()=>t.CausalLMOutput,CausalLMOutputWithPast:()=>t.CausalLMOutputWithPast,ChineseCLIPFeatureExtractor:()=>h.ChineseCLIPFeatureExtractor,ChineseCLIPModel:()=>t.ChineseCLIPModel,ChineseCLIPPreTrainedModel:()=>t.ChineseCLIPPreTrainedModel,ClapAudioModelWithProjection:()=>t.ClapAudioModelWithProjection,ClapFeatureExtractor:()=>d.ClapFeatureExtractor,ClapModel:()=>t.ClapModel,ClapPreTrainedModel:()=>t.ClapPreTrainedModel,ClapTextModelWithProjection:()=>t.ClapTextModelWithProjection,ClassifierFreeGuidanceLogitsProcessor:()=>T.ClassifierFreeGuidanceLogitsProcessor,CodeGenForCausalLM:()=>t.CodeGenForCausalLM,CodeGenModel:()=>t.CodeGenModel,CodeGenPreTrainedModel:()=>t.CodeGenPreTrainedModel,CodeGenTokenizer:()=>s.CodeGenTokenizer,CodeLlamaTokenizer:()=>s.CodeLlamaTokenizer,CohereForCausalLM:()=>t.CohereForCausalLM,CohereModel:()=>t.CohereModel,CoherePreTrainedModel:()=>t.CoherePreTrainedModel,CohereTokenizer:()=>s.CohereTokenizer,ConvBertForMaskedLM:()=>t.ConvBertForMaskedLM,ConvBertForQuestionAnswering:()=>t.ConvBertForQuestionAnswering,ConvBertForSequenceClassification:()=>t.ConvBertForSequenceClassification,ConvBertForTokenClassification:()=>t.ConvBertForTokenClassification,ConvBertModel:()=>t.ConvBertModel,ConvBertPreTrainedModel:()=>t.ConvBertPreTrainedModel,ConvBertTokenizer:()=>s.ConvBertTokenizer,ConvNextFeatureExtractor:()=>h.ConvNextFeatureExtractor,ConvNextForImageClassification:()=>t.ConvNextForImageClassification,ConvNextImageProcessor:()=>h.ConvNextImageProcessor,ConvNextModel:()=>t.ConvNextModel,ConvNextPreTrainedModel:()=>t.ConvNextPreTrainedModel,ConvNextV2ForImageClassification:()=>t.ConvNextV2ForImageClassification,ConvNextV2Model:()=>t.ConvNextV2Model,ConvNextV2PreTrainedModel:()=>t.ConvNextV2PreTrainedModel,DFineForObjectDetection:()=>t.DFineForObjectDetection,DFineModel:()=>t.DFineModel,DFinePreTrainedModel:()=>t.DFinePreTrainedModel,DPTFeatureExtractor:()=>h.DPTFeatureExtractor,DPTForDepthEstimation:()=>t.DPTForDepthEstimation,DPTImageProcessor:()=>h.DPTImageProcessor,DPTModel:()=>t.DPTModel,DPTPreTrainedModel:()=>t.DPTPreTrainedModel,DacDecoderModel:()=>t.DacDecoderModel,DacDecoderOutput:()=>t.DacDecoderOutput,DacEncoderModel:()=>t.DacEncoderModel,DacEncoderOutput:()=>t.DacEncoderOutput,DacFeatureExtractor:()=>d.DacFeatureExtractor,DacModel:()=>t.DacModel,DacPreTrainedModel:()=>t.DacPreTrainedModel,DataTypeMap:()=>l.DataTypeMap,DebertaForMaskedLM:()=>t.DebertaForMaskedLM,DebertaForQuestionAnswering:()=>t.DebertaForQuestionAnswering,DebertaForSequenceClassification:()=>t.DebertaForSequenceClassification,DebertaForTokenClassification:()=>t.DebertaForTokenClassification,DebertaModel:()=>t.DebertaModel,DebertaPreTrainedModel:()=>t.DebertaPreTrainedModel,DebertaTokenizer:()=>s.DebertaTokenizer,DebertaV2ForMaskedLM:()=>t.DebertaV2ForMaskedLM,DebertaV2ForQuestionAnswering:()=>t.DebertaV2ForQuestionAnswering,DebertaV2ForSequenceClassification:()=>t.DebertaV2ForSequenceClassification,DebertaV2ForTokenClassification:()=>t.DebertaV2ForTokenClassification,DebertaV2Model:()=>t.DebertaV2Model,DebertaV2PreTrainedModel:()=>t.DebertaV2PreTrainedModel,DebertaV2Tokenizer:()=>s.DebertaV2Tokenizer,DecisionTransformerModel:()=>t.DecisionTransformerModel,DecisionTransformerPreTrainedModel:()=>t.DecisionTransformerPreTrainedModel,DeiTFeatureExtractor:()=>h.DeiTFeatureExtractor,DeiTForImageClassification:()=>t.DeiTForImageClassification,DeiTImageProcessor:()=>h.DeiTImageProcessor,DeiTModel:()=>t.DeiTModel,DeiTPreTrainedModel:()=>t.DeiTPreTrainedModel,DepthAnythingForDepthEstimation:()=>t.DepthAnythingForDepthEstimation,DepthAnythingPreTrainedModel:()=>t.DepthAnythingPreTrainedModel,DepthEstimationPipeline:()=>r.DepthEstimationPipeline,DepthProForDepthEstimation:()=>t.DepthProForDepthEstimation,DepthProPreTrainedModel:()=>t.DepthProPreTrainedModel,DetrFeatureExtractor:()=>h.DetrFeatureExtractor,DetrForObjectDetection:()=>t.DetrForObjectDetection,DetrForSegmentation:()=>t.DetrForSegmentation,DetrImageProcessor:()=>h.DetrImageProcessor,DetrModel:()=>t.DetrModel,DetrObjectDetectionOutput:()=>t.DetrObjectDetectionOutput,DetrPreTrainedModel:()=>t.DetrPreTrainedModel,DetrSegmentationOutput:()=>t.DetrSegmentationOutput,Dinov2ForImageClassification:()=>t.Dinov2ForImageClassification,Dinov2Model:()=>t.Dinov2Model,Dinov2PreTrainedModel:()=>t.Dinov2PreTrainedModel,Dinov2WithRegistersForImageClassification:()=>t.Dinov2WithRegistersForImageClassification,Dinov2WithRegistersModel:()=>t.Dinov2WithRegistersModel,Dinov2WithRegistersPreTrainedModel:()=>t.Dinov2WithRegistersPreTrainedModel,DistilBertForMaskedLM:()=>t.DistilBertForMaskedLM,DistilBertForQuestionAnswering:()=>t.DistilBertForQuestionAnswering,DistilBertForSequenceClassification:()=>t.DistilBertForSequenceClassification,DistilBertForTokenClassification:()=>t.DistilBertForTokenClassification,DistilBertModel:()=>t.DistilBertModel,DistilBertPreTrainedModel:()=>t.DistilBertPreTrainedModel,DistilBertTokenizer:()=>s.DistilBertTokenizer,DocumentQuestionAnsweringPipeline:()=>r.DocumentQuestionAnsweringPipeline,DonutFeatureExtractor:()=>h.DonutFeatureExtractor,DonutImageProcessor:()=>h.DonutImageProcessor,DonutSwinModel:()=>t.DonutSwinModel,DonutSwinPreTrainedModel:()=>t.DonutSwinPreTrainedModel,EfficientNetForImageClassification:()=>t.EfficientNetForImageClassification,EfficientNetImageProcessor:()=>h.EfficientNetImageProcessor,EfficientNetModel:()=>t.EfficientNetModel,EfficientNetPreTrainedModel:()=>t.EfficientNetPreTrainedModel,ElectraForMaskedLM:()=>t.ElectraForMaskedLM,ElectraForQuestionAnswering:()=>t.ElectraForQuestionAnswering,ElectraForSequenceClassification:()=>t.ElectraForSequenceClassification,ElectraForTokenClassification:()=>t.ElectraForTokenClassification,ElectraModel:()=>t.ElectraModel,ElectraPreTrainedModel:()=>t.ElectraPreTrainedModel,ElectraTokenizer:()=>s.ElectraTokenizer,EncodecFeatureExtractor:()=>d.EncodecFeatureExtractor,EosTokenCriteria:()=>x.EosTokenCriteria,EsmForMaskedLM:()=>t.EsmForMaskedLM,EsmForSequenceClassification:()=>t.EsmForSequenceClassification,EsmForTokenClassification:()=>t.EsmForTokenClassification,EsmModel:()=>t.EsmModel,EsmPreTrainedModel:()=>t.EsmPreTrainedModel,EsmTokenizer:()=>s.EsmTokenizer,ExaoneForCausalLM:()=>t.ExaoneForCausalLM,ExaoneModel:()=>t.ExaoneModel,ExaonePreTrainedModel:()=>t.ExaonePreTrainedModel,FFT:()=>c.FFT,FalconForCausalLM:()=>t.FalconForCausalLM,FalconModel:()=>t.FalconModel,FalconPreTrainedModel:()=>t.FalconPreTrainedModel,FalconTokenizer:()=>s.FalconTokenizer,FastViTForImageClassification:()=>t.FastViTForImageClassification,FastViTModel:()=>t.FastViTModel,FastViTPreTrainedModel:()=>t.FastViTPreTrainedModel,FeatureExtractionPipeline:()=>r.FeatureExtractionPipeline,FeatureExtractor:()=>_.FeatureExtractor,FillMaskPipeline:()=>r.FillMaskPipeline,Florence2ForConditionalGeneration:()=>t.Florence2ForConditionalGeneration,Florence2PreTrainedModel:()=>t.Florence2PreTrainedModel,Florence2Processor:()=>M.Florence2Processor,ForcedBOSTokenLogitsProcessor:()=>T.ForcedBOSTokenLogitsProcessor,ForcedEOSTokenLogitsProcessor:()=>T.ForcedEOSTokenLogitsProcessor,GLPNFeatureExtractor:()=>h.GLPNFeatureExtractor,GLPNForDepthEstimation:()=>t.GLPNForDepthEstimation,GLPNModel:()=>t.GLPNModel,GLPNPreTrainedModel:()=>t.GLPNPreTrainedModel,GPT2LMHeadModel:()=>t.GPT2LMHeadModel,GPT2Model:()=>t.GPT2Model,GPT2PreTrainedModel:()=>t.GPT2PreTrainedModel,GPT2Tokenizer:()=>s.GPT2Tokenizer,GPTBigCodeForCausalLM:()=>t.GPTBigCodeForCausalLM,GPTBigCodeModel:()=>t.GPTBigCodeModel,GPTBigCodePreTrainedModel:()=>t.GPTBigCodePreTrainedModel,GPTJForCausalLM:()=>t.GPTJForCausalLM,GPTJModel:()=>t.GPTJModel,GPTJPreTrainedModel:()=>t.GPTJPreTrainedModel,GPTNeoForCausalLM:()=>t.GPTNeoForCausalLM,GPTNeoModel:()=>t.GPTNeoModel,GPTNeoPreTrainedModel:()=>t.GPTNeoPreTrainedModel,GPTNeoXForCausalLM:()=>t.GPTNeoXForCausalLM,GPTNeoXModel:()=>t.GPTNeoXModel,GPTNeoXPreTrainedModel:()=>t.GPTNeoXPreTrainedModel,GPTNeoXTokenizer:()=>s.GPTNeoXTokenizer,Gemma2ForCausalLM:()=>t.Gemma2ForCausalLM,Gemma2Model:()=>t.Gemma2Model,Gemma2PreTrainedModel:()=>t.Gemma2PreTrainedModel,Gemma3ForCausalLM:()=>t.Gemma3ForCausalLM,Gemma3Model:()=>t.Gemma3Model,Gemma3PreTrainedModel:()=>t.Gemma3PreTrainedModel,Gemma3nAudioFeatureExtractor:()=>d.Gemma3nAudioFeatureExtractor,Gemma3nForConditionalGeneration:()=>t.Gemma3nForConditionalGeneration,Gemma3nPreTrainedModel:()=>t.Gemma3nPreTrainedModel,Gemma3nProcessor:()=>M.Gemma3nProcessor,GemmaForCausalLM:()=>t.GemmaForCausalLM,GemmaModel:()=>t.GemmaModel,GemmaPreTrainedModel:()=>t.GemmaPreTrainedModel,GemmaTokenizer:()=>s.GemmaTokenizer,GlmForCausalLM:()=>t.GlmForCausalLM,GlmModel:()=>t.GlmModel,GlmPreTrainedModel:()=>t.GlmPreTrainedModel,GraniteForCausalLM:()=>t.GraniteForCausalLM,GraniteModel:()=>t.GraniteModel,GranitePreTrainedModel:()=>t.GranitePreTrainedModel,Grok1Tokenizer:()=>s.Grok1Tokenizer,GroundingDinoForObjectDetection:()=>t.GroundingDinoForObjectDetection,GroundingDinoImageProcessor:()=>h.GroundingDinoImageProcessor,GroundingDinoPreTrainedModel:()=>t.GroundingDinoPreTrainedModel,GroundingDinoProcessor:()=>M.GroundingDinoProcessor,GroupViTModel:()=>t.GroupViTModel,GroupViTPreTrainedModel:()=>t.GroupViTPreTrainedModel,HeliumForCausalLM:()=>t.HeliumForCausalLM,HeliumModel:()=>t.HeliumModel,HeliumPreTrainedModel:()=>t.HeliumPreTrainedModel,HerbertTokenizer:()=>s.HerbertTokenizer,HieraForImageClassification:()=>t.HieraForImageClassification,HieraModel:()=>t.HieraModel,HieraPreTrainedModel:()=>t.HieraPreTrainedModel,HubertForCTC:()=>t.HubertForCTC,HubertForSequenceClassification:()=>t.HubertForSequenceClassification,HubertModel:()=>t.HubertModel,HubertPreTrainedModel:()=>t.HubertPreTrainedModel,IJepaForImageClassification:()=>t.IJepaForImageClassification,IJepaModel:()=>t.IJepaModel,IJepaPreTrainedModel:()=>t.IJepaPreTrainedModel,Idefics3ForConditionalGeneration:()=>t.Idefics3ForConditionalGeneration,Idefics3ImageProcessor:()=>h.Idefics3ImageProcessor,Idefics3PreTrainedModel:()=>t.Idefics3PreTrainedModel,Idefics3Processor:()=>M.Idefics3Processor,ImageClassificationPipeline:()=>r.ImageClassificationPipeline,ImageFeatureExtractionPipeline:()=>r.ImageFeatureExtractionPipeline,ImageFeatureExtractor:()=>d.ImageFeatureExtractor,ImageMattingOutput:()=>t.ImageMattingOutput,ImageProcessor:()=>f.ImageProcessor,ImageSegmentationPipeline:()=>r.ImageSegmentationPipeline,ImageToImagePipeline:()=>r.ImageToImagePipeline,ImageToTextPipeline:()=>r.ImageToTextPipeline,InterruptableStoppingCriteria:()=>x.InterruptableStoppingCriteria,JAISLMHeadModel:()=>t.JAISLMHeadModel,JAISModel:()=>t.JAISModel,JAISPreTrainedModel:()=>t.JAISPreTrainedModel,JinaCLIPImageProcessor:()=>h.JinaCLIPImageProcessor,JinaCLIPModel:()=>t.JinaCLIPModel,JinaCLIPPreTrainedModel:()=>t.JinaCLIPPreTrainedModel,JinaCLIPProcessor:()=>M.JinaCLIPProcessor,JinaCLIPTextModel:()=>t.JinaCLIPTextModel,JinaCLIPVisionModel:()=>t.JinaCLIPVisionModel,LiteWhisperForConditionalGeneration:()=>t.LiteWhisperForConditionalGeneration,LlamaForCausalLM:()=>t.LlamaForCausalLM,LlamaModel:()=>t.LlamaModel,LlamaPreTrainedModel:()=>t.LlamaPreTrainedModel,LlamaTokenizer:()=>s.LlamaTokenizer,LlavaForConditionalGeneration:()=>t.LlavaForConditionalGeneration,LlavaOnevisionForConditionalGeneration:()=>t.LlavaOnevisionForConditionalGeneration,LlavaOnevisionImageProcessor:()=>h.LlavaOnevisionImageProcessor,LlavaPreTrainedModel:()=>t.LlavaPreTrainedModel,LlavaProcessor:()=>M.LlavaProcessor,LlavaQwen2ForCausalLM:()=>t.LlavaQwen2ForCausalLM,LogitsProcessor:()=>T.LogitsProcessor,LogitsProcessorList:()=>T.LogitsProcessorList,LogitsWarper:()=>T.LogitsWarper,LongT5ForConditionalGeneration:()=>t.LongT5ForConditionalGeneration,LongT5Model:()=>t.LongT5Model,LongT5PreTrainedModel:()=>t.LongT5PreTrainedModel,M2M100ForConditionalGeneration:()=>t.M2M100ForConditionalGeneration,M2M100Model:()=>t.M2M100Model,M2M100PreTrainedModel:()=>t.M2M100PreTrainedModel,M2M100Tokenizer:()=>s.M2M100Tokenizer,MBart50Tokenizer:()=>s.MBart50Tokenizer,MBartForCausalLM:()=>t.MBartForCausalLM,MBartForConditionalGeneration:()=>t.MBartForConditionalGeneration,MBartForSequenceClassification:()=>t.MBartForSequenceClassification,MBartModel:()=>t.MBartModel,MBartPreTrainedModel:()=>t.MBartPreTrainedModel,MBartTokenizer:()=>s.MBartTokenizer,MPNetForMaskedLM:()=>t.MPNetForMaskedLM,MPNetForQuestionAnswering:()=>t.MPNetForQuestionAnswering,MPNetForSequenceClassification:()=>t.MPNetForSequenceClassification,MPNetForTokenClassification:()=>t.MPNetForTokenClassification,MPNetModel:()=>t.MPNetModel,MPNetPreTrainedModel:()=>t.MPNetPreTrainedModel,MPNetTokenizer:()=>s.MPNetTokenizer,MT5ForConditionalGeneration:()=>t.MT5ForConditionalGeneration,MT5Model:()=>t.MT5Model,MT5PreTrainedModel:()=>t.MT5PreTrainedModel,MarianMTModel:()=>t.MarianMTModel,MarianModel:()=>t.MarianModel,MarianPreTrainedModel:()=>t.MarianPreTrainedModel,MarianTokenizer:()=>s.MarianTokenizer,Mask2FormerImageProcessor:()=>h.Mask2FormerImageProcessor,MaskFormerFeatureExtractor:()=>h.MaskFormerFeatureExtractor,MaskFormerForInstanceSegmentation:()=>t.MaskFormerForInstanceSegmentation,MaskFormerImageProcessor:()=>h.MaskFormerImageProcessor,MaskFormerModel:()=>t.MaskFormerModel,MaskFormerPreTrainedModel:()=>t.MaskFormerPreTrainedModel,MaskedLMOutput:()=>t.MaskedLMOutput,MaxLengthCriteria:()=>x.MaxLengthCriteria,Metric3DForDepthEstimation:()=>t.Metric3DForDepthEstimation,Metric3DPreTrainedModel:()=>t.Metric3DPreTrainedModel,Metric3Dv2ForDepthEstimation:()=>t.Metric3Dv2ForDepthEstimation,Metric3Dv2PreTrainedModel:()=>t.Metric3Dv2PreTrainedModel,MgpstrForSceneTextRecognition:()=>t.MgpstrForSceneTextRecognition,MgpstrModelOutput:()=>t.MgpstrModelOutput,MgpstrPreTrainedModel:()=>t.MgpstrPreTrainedModel,MgpstrProcessor:()=>M.MgpstrProcessor,MgpstrTokenizer:()=>s.MgpstrTokenizer,MimiDecoderModel:()=>t.MimiDecoderModel,MimiDecoderOutput:()=>t.MimiDecoderOutput,MimiEncoderModel:()=>t.MimiEncoderModel,MimiEncoderOutput:()=>t.MimiEncoderOutput,MimiModel:()=>t.MimiModel,MimiPreTrainedModel:()=>t.MimiPreTrainedModel,MinLengthLogitsProcessor:()=>T.MinLengthLogitsProcessor,MinNewTokensLengthLogitsProcessor:()=>T.MinNewTokensLengthLogitsProcessor,MistralForCausalLM:()=>t.MistralForCausalLM,MistralModel:()=>t.MistralModel,MistralPreTrainedModel:()=>t.MistralPreTrainedModel,MobileBertForMaskedLM:()=>t.MobileBertForMaskedLM,MobileBertForQuestionAnswering:()=>t.MobileBertForQuestionAnswering,MobileBertForSequenceClassification:()=>t.MobileBertForSequenceClassification,MobileBertModel:()=>t.MobileBertModel,MobileBertPreTrainedModel:()=>t.MobileBertPreTrainedModel,MobileBertTokenizer:()=>s.MobileBertTokenizer,MobileLLMForCausalLM:()=>t.MobileLLMForCausalLM,MobileLLMModel:()=>t.MobileLLMModel,MobileLLMPreTrainedModel:()=>t.MobileLLMPreTrainedModel,MobileNetV1FeatureExtractor:()=>h.MobileNetV1FeatureExtractor,MobileNetV1ForImageClassification:()=>t.MobileNetV1ForImageClassification,MobileNetV1ForSemanticSegmentation:()=>t.MobileNetV1ForSemanticSegmentation,MobileNetV1ImageProcessor:()=>h.MobileNetV1ImageProcessor,MobileNetV1Model:()=>t.MobileNetV1Model,MobileNetV1PreTrainedModel:()=>t.MobileNetV1PreTrainedModel,MobileNetV2FeatureExtractor:()=>h.MobileNetV2FeatureExtractor,MobileNetV2ForImageClassification:()=>t.MobileNetV2ForImageClassification,MobileNetV2ForSemanticSegmentation:()=>t.MobileNetV2ForSemanticSegmentation,MobileNetV2ImageProcessor:()=>h.MobileNetV2ImageProcessor,MobileNetV2Model:()=>t.MobileNetV2Model,MobileNetV2PreTrainedModel:()=>t.MobileNetV2PreTrainedModel,MobileNetV3FeatureExtractor:()=>h.MobileNetV3FeatureExtractor,MobileNetV3ForImageClassification:()=>t.MobileNetV3ForImageClassification,MobileNetV3ForSemanticSegmentation:()=>t.MobileNetV3ForSemanticSegmentation,MobileNetV3ImageProcessor:()=>h.MobileNetV3ImageProcessor,MobileNetV3Model:()=>t.MobileNetV3Model,MobileNetV3PreTrainedModel:()=>t.MobileNetV3PreTrainedModel,MobileNetV4FeatureExtractor:()=>h.MobileNetV4FeatureExtractor,MobileNetV4ForImageClassification:()=>t.MobileNetV4ForImageClassification,MobileNetV4ForSemanticSegmentation:()=>t.MobileNetV4ForSemanticSegmentation,MobileNetV4ImageProcessor:()=>h.MobileNetV4ImageProcessor,MobileNetV4Model:()=>t.MobileNetV4Model,MobileNetV4PreTrainedModel:()=>t.MobileNetV4PreTrainedModel,MobileViTFeatureExtractor:()=>h.MobileViTFeatureExtractor,MobileViTForImageClassification:()=>t.MobileViTForImageClassification,MobileViTImageProcessor:()=>h.MobileViTImageProcessor,MobileViTModel:()=>t.MobileViTModel,MobileViTPreTrainedModel:()=>t.MobileViTPreTrainedModel,MobileViTV2ForImageClassification:()=>t.MobileViTV2ForImageClassification,MobileViTV2Model:()=>t.MobileViTV2Model,MobileViTV2PreTrainedModel:()=>t.MobileViTV2PreTrainedModel,ModelOutput:()=>t.ModelOutput,ModernBertForMaskedLM:()=>t.ModernBertForMaskedLM,ModernBertForSequenceClassification:()=>t.ModernBertForSequenceClassification,ModernBertForTokenClassification:()=>t.ModernBertForTokenClassification,ModernBertModel:()=>t.ModernBertModel,ModernBertPreTrainedModel:()=>t.ModernBertPreTrainedModel,Moondream1ForConditionalGeneration:()=>t.Moondream1ForConditionalGeneration,MoonshineFeatureExtractor:()=>d.MoonshineFeatureExtractor,MoonshineForConditionalGeneration:()=>t.MoonshineForConditionalGeneration,MoonshineModel:()=>t.MoonshineModel,MoonshinePreTrainedModel:()=>t.MoonshinePreTrainedModel,MoonshineProcessor:()=>M.MoonshineProcessor,MptForCausalLM:()=>t.MptForCausalLM,MptModel:()=>t.MptModel,MptPreTrainedModel:()=>t.MptPreTrainedModel,MultiModalityCausalLM:()=>t.MultiModalityCausalLM,MultiModalityPreTrainedModel:()=>t.MultiModalityPreTrainedModel,MusicgenForCausalLM:()=>t.MusicgenForCausalLM,MusicgenForConditionalGeneration:()=>t.MusicgenForConditionalGeneration,MusicgenModel:()=>t.MusicgenModel,MusicgenPreTrainedModel:()=>t.MusicgenPreTrainedModel,NllbTokenizer:()=>s.NllbTokenizer,NoBadWordsLogitsProcessor:()=>T.NoBadWordsLogitsProcessor,NoRepeatNGramLogitsProcessor:()=>T.NoRepeatNGramLogitsProcessor,NomicBertModel:()=>t.NomicBertModel,NomicBertPreTrainedModel:()=>t.NomicBertPreTrainedModel,NougatImageProcessor:()=>h.NougatImageProcessor,NougatTokenizer:()=>s.NougatTokenizer,OPTForCausalLM:()=>t.OPTForCausalLM,OPTModel:()=>t.OPTModel,OPTPreTrainedModel:()=>t.OPTPreTrainedModel,ObjectDetectionPipeline:()=>r.ObjectDetectionPipeline,Olmo2ForCausalLM:()=>t.Olmo2ForCausalLM,Olmo2Model:()=>t.Olmo2Model,Olmo2PreTrainedModel:()=>t.Olmo2PreTrainedModel,OlmoForCausalLM:()=>t.OlmoForCausalLM,OlmoModel:()=>t.OlmoModel,OlmoPreTrainedModel:()=>t.OlmoPreTrainedModel,OpenELMForCausalLM:()=>t.OpenELMForCausalLM,OpenELMModel:()=>t.OpenELMModel,OpenELMPreTrainedModel:()=>t.OpenELMPreTrainedModel,OwlViTFeatureExtractor:()=>h.OwlViTFeatureExtractor,OwlViTForObjectDetection:()=>t.OwlViTForObjectDetection,OwlViTImageProcessor:()=>h.OwlViTImageProcessor,OwlViTModel:()=>t.OwlViTModel,OwlViTPreTrainedModel:()=>t.OwlViTPreTrainedModel,OwlViTProcessor:()=>M.OwlViTProcessor,Owlv2ForObjectDetection:()=>t.Owlv2ForObjectDetection,Owlv2ImageProcessor:()=>h.Owlv2ImageProcessor,Owlv2Model:()=>t.Owlv2Model,Owlv2PreTrainedModel:()=>t.Owlv2PreTrainedModel,PaliGemmaForConditionalGeneration:()=>t.PaliGemmaForConditionalGeneration,PaliGemmaPreTrainedModel:()=>t.PaliGemmaPreTrainedModel,PaliGemmaProcessor:()=>M.PaliGemmaProcessor,PatchTSMixerForPrediction:()=>t.PatchTSMixerForPrediction,PatchTSMixerModel:()=>t.PatchTSMixerModel,PatchTSMixerPreTrainedModel:()=>t.PatchTSMixerPreTrainedModel,PatchTSTForPrediction:()=>t.PatchTSTForPrediction,PatchTSTModel:()=>t.PatchTSTModel,PatchTSTPreTrainedModel:()=>t.PatchTSTPreTrainedModel,Phi3ForCausalLM:()=>t.Phi3ForCausalLM,Phi3Model:()=>t.Phi3Model,Phi3PreTrainedModel:()=>t.Phi3PreTrainedModel,Phi3VForCausalLM:()=>t.Phi3VForCausalLM,Phi3VImageProcessor:()=>h.Phi3VImageProcessor,Phi3VPreTrainedModel:()=>t.Phi3VPreTrainedModel,Phi3VProcessor:()=>M.Phi3VProcessor,PhiForCausalLM:()=>t.PhiForCausalLM,PhiModel:()=>t.PhiModel,PhiPreTrainedModel:()=>t.PhiPreTrainedModel,Pipeline:()=>r.Pipeline,PreTrainedModel:()=>t.PreTrainedModel,PreTrainedTokenizer:()=>s.PreTrainedTokenizer,PretrainedConfig:()=>o.PretrainedConfig,PretrainedMixin:()=>t.PretrainedMixin,Processor:()=>E.Processor,PvtForImageClassification:()=>t.PvtForImageClassification,PvtImageProcessor:()=>h.PvtImageProcessor,PvtModel:()=>t.PvtModel,PvtPreTrainedModel:()=>t.PvtPreTrainedModel,PyAnnoteFeatureExtractor:()=>d.PyAnnoteFeatureExtractor,PyAnnoteForAudioFrameClassification:()=>t.PyAnnoteForAudioFrameClassification,PyAnnoteModel:()=>t.PyAnnoteModel,PyAnnotePreTrainedModel:()=>t.PyAnnotePreTrainedModel,PyAnnoteProcessor:()=>M.PyAnnoteProcessor,QuestionAnsweringModelOutput:()=>t.QuestionAnsweringModelOutput,QuestionAnsweringPipeline:()=>r.QuestionAnsweringPipeline,Qwen2ForCausalLM:()=>t.Qwen2ForCausalLM,Qwen2Model:()=>t.Qwen2Model,Qwen2PreTrainedModel:()=>t.Qwen2PreTrainedModel,Qwen2Tokenizer:()=>s.Qwen2Tokenizer,Qwen2VLForConditionalGeneration:()=>t.Qwen2VLForConditionalGeneration,Qwen2VLImageProcessor:()=>h.Qwen2VLImageProcessor,Qwen2VLPreTrainedModel:()=>t.Qwen2VLPreTrainedModel,Qwen2VLProcessor:()=>M.Qwen2VLProcessor,Qwen3ForCausalLM:()=>t.Qwen3ForCausalLM,Qwen3Model:()=>t.Qwen3Model,Qwen3PreTrainedModel:()=>t.Qwen3PreTrainedModel,RFDetrForObjectDetection:()=>t.RFDetrForObjectDetection,RFDetrModel:()=>t.RFDetrModel,RFDetrObjectDetectionOutput:()=>t.RFDetrObjectDetectionOutput,RFDetrPreTrainedModel:()=>t.RFDetrPreTrainedModel,RTDetrForObjectDetection:()=>t.RTDetrForObjectDetection,RTDetrImageProcessor:()=>h.RTDetrImageProcessor,RTDetrModel:()=>t.RTDetrModel,RTDetrObjectDetectionOutput:()=>t.RTDetrObjectDetectionOutput,RTDetrPreTrainedModel:()=>t.RTDetrPreTrainedModel,RTDetrV2ForObjectDetection:()=>t.RTDetrV2ForObjectDetection,RTDetrV2Model:()=>t.RTDetrV2Model,RTDetrV2ObjectDetectionOutput:()=>t.RTDetrV2ObjectDetectionOutput,RTDetrV2PreTrainedModel:()=>t.RTDetrV2PreTrainedModel,RawAudio:()=>a.RawAudio,RawImage:()=>n.RawImage,RawVideo:()=>i.RawVideo,RawVideoFrame:()=>i.RawVideoFrame,RepetitionPenaltyLogitsProcessor:()=>T.RepetitionPenaltyLogitsProcessor,ResNetForImageClassification:()=>t.ResNetForImageClassification,ResNetModel:()=>t.ResNetModel,ResNetPreTrainedModel:()=>t.ResNetPreTrainedModel,RoFormerForMaskedLM:()=>t.RoFormerForMaskedLM,RoFormerForQuestionAnswering:()=>t.RoFormerForQuestionAnswering,RoFormerForSequenceClassification:()=>t.RoFormerForSequenceClassification,RoFormerForTokenClassification:()=>t.RoFormerForTokenClassification,RoFormerModel:()=>t.RoFormerModel,RoFormerPreTrainedModel:()=>t.RoFormerPreTrainedModel,RoFormerTokenizer:()=>s.RoFormerTokenizer,RobertaForMaskedLM:()=>t.RobertaForMaskedLM,RobertaForQuestionAnswering:()=>t.RobertaForQuestionAnswering,RobertaForSequenceClassification:()=>t.RobertaForSequenceClassification,RobertaForTokenClassification:()=>t.RobertaForTokenClassification,RobertaModel:()=>t.RobertaModel,RobertaPreTrainedModel:()=>t.RobertaPreTrainedModel,RobertaTokenizer:()=>s.RobertaTokenizer,SamImageProcessor:()=>h.SamImageProcessor,SamImageSegmentationOutput:()=>t.SamImageSegmentationOutput,SamModel:()=>t.SamModel,SamPreTrainedModel:()=>t.SamPreTrainedModel,SamProcessor:()=>M.SamProcessor,SapiensForDepthEstimation:()=>t.SapiensForDepthEstimation,SapiensForNormalEstimation:()=>t.SapiensForNormalEstimation,SapiensForSemanticSegmentation:()=>t.SapiensForSemanticSegmentation,SapiensPreTrainedModel:()=>t.SapiensPreTrainedModel,SeamlessM4TFeatureExtractor:()=>d.SeamlessM4TFeatureExtractor,SegformerFeatureExtractor:()=>h.SegformerFeatureExtractor,SegformerForImageClassification:()=>t.SegformerForImageClassification,SegformerForSemanticSegmentation:()=>t.SegformerForSemanticSegmentation,SegformerImageProcessor:()=>h.SegformerImageProcessor,SegformerModel:()=>t.SegformerModel,SegformerPreTrainedModel:()=>t.SegformerPreTrainedModel,Seq2SeqLMOutput:()=>t.Seq2SeqLMOutput,SequenceClassifierOutput:()=>t.SequenceClassifierOutput,SiglipImageProcessor:()=>h.SiglipImageProcessor,SiglipModel:()=>t.SiglipModel,SiglipPreTrainedModel:()=>t.SiglipPreTrainedModel,SiglipTextModel:()=>t.SiglipTextModel,SiglipTokenizer:()=>s.SiglipTokenizer,SiglipVisionModel:()=>t.SiglipVisionModel,SmolVLMForConditionalGeneration:()=>t.SmolVLMForConditionalGeneration,SmolVLMImageProcessor:()=>h.SmolVLMImageProcessor,SmolVLMProcessor:()=>M.SmolVLMProcessor,SnacDecoderModel:()=>t.SnacDecoderModel,SnacEncoderModel:()=>t.SnacEncoderModel,SnacFeatureExtractor:()=>d.SnacFeatureExtractor,SnacModel:()=>t.SnacModel,SnacPreTrainedModel:()=>t.SnacPreTrainedModel,SpeechT5FeatureExtractor:()=>d.SpeechT5FeatureExtractor,SpeechT5ForSpeechToText:()=>t.SpeechT5ForSpeechToText,SpeechT5ForTextToSpeech:()=>t.SpeechT5ForTextToSpeech,SpeechT5HifiGan:()=>t.SpeechT5HifiGan,SpeechT5Model:()=>t.SpeechT5Model,SpeechT5PreTrainedModel:()=>t.SpeechT5PreTrainedModel,SpeechT5Processor:()=>M.SpeechT5Processor,SpeechT5Tokenizer:()=>s.SpeechT5Tokenizer,SqueezeBertForMaskedLM:()=>t.SqueezeBertForMaskedLM,SqueezeBertForQuestionAnswering:()=>t.SqueezeBertForQuestionAnswering,SqueezeBertForSequenceClassification:()=>t.SqueezeBertForSequenceClassification,SqueezeBertModel:()=>t.SqueezeBertModel,SqueezeBertPreTrainedModel:()=>t.SqueezeBertPreTrainedModel,SqueezeBertTokenizer:()=>s.SqueezeBertTokenizer,StableLmForCausalLM:()=>t.StableLmForCausalLM,StableLmModel:()=>t.StableLmModel,StableLmPreTrainedModel:()=>t.StableLmPreTrainedModel,Starcoder2ForCausalLM:()=>t.Starcoder2ForCausalLM,Starcoder2Model:()=>t.Starcoder2Model,Starcoder2PreTrainedModel:()=>t.Starcoder2PreTrainedModel,StoppingCriteria:()=>x.StoppingCriteria,StoppingCriteriaList:()=>x.StoppingCriteriaList,StyleTextToSpeech2Model:()=>t.StyleTextToSpeech2Model,StyleTextToSpeech2PreTrainedModel:()=>t.StyleTextToSpeech2PreTrainedModel,SummarizationPipeline:()=>r.SummarizationPipeline,SuppressTokensAtBeginLogitsProcessor:()=>T.SuppressTokensAtBeginLogitsProcessor,Swin2SRForImageSuperResolution:()=>t.Swin2SRForImageSuperResolution,Swin2SRImageProcessor:()=>h.Swin2SRImageProcessor,Swin2SRModel:()=>t.Swin2SRModel,Swin2SRPreTrainedModel:()=>t.Swin2SRPreTrainedModel,SwinForImageClassification:()=>t.SwinForImageClassification,SwinForSemanticSegmentation:()=>t.SwinForSemanticSegmentation,SwinModel:()=>t.SwinModel,SwinPreTrainedModel:()=>t.SwinPreTrainedModel,T5ForConditionalGeneration:()=>t.T5ForConditionalGeneration,T5Model:()=>t.T5Model,T5PreTrainedModel:()=>t.T5PreTrainedModel,T5Tokenizer:()=>s.T5Tokenizer,TableTransformerForObjectDetection:()=>t.TableTransformerForObjectDetection,TableTransformerModel:()=>t.TableTransformerModel,TableTransformerObjectDetectionOutput:()=>t.TableTransformerObjectDetectionOutput,TableTransformerPreTrainedModel:()=>t.TableTransformerPreTrainedModel,TemperatureLogitsWarper:()=>T.TemperatureLogitsWarper,Tensor:()=>l.Tensor,Text2TextGenerationPipeline:()=>r.Text2TextGenerationPipeline,TextClassificationPipeline:()=>r.TextClassificationPipeline,TextGenerationPipeline:()=>r.TextGenerationPipeline,TextStreamer:()=>C.TextStreamer,TextToAudioPipeline:()=>r.TextToAudioPipeline,TokenClassificationPipeline:()=>r.TokenClassificationPipeline,TokenClassifierOutput:()=>t.TokenClassifierOutput,TokenizerModel:()=>s.TokenizerModel,TopKLogitsWarper:()=>T.TopKLogitsWarper,TopPLogitsWarper:()=>T.TopPLogitsWarper,TrOCRForCausalLM:()=>t.TrOCRForCausalLM,TrOCRPreTrainedModel:()=>t.TrOCRPreTrainedModel,TranslationPipeline:()=>r.TranslationPipeline,UltravoxModel:()=>t.UltravoxModel,UltravoxPreTrainedModel:()=>t.UltravoxPreTrainedModel,UltravoxProcessor:()=>M.UltravoxProcessor,UniSpeechForCTC:()=>t.UniSpeechForCTC,UniSpeechForSequenceClassification:()=>t.UniSpeechForSequenceClassification,UniSpeechModel:()=>t.UniSpeechModel,UniSpeechPreTrainedModel:()=>t.UniSpeechPreTrainedModel,UniSpeechSatForAudioFrameClassification:()=>t.UniSpeechSatForAudioFrameClassification,UniSpeechSatForCTC:()=>t.UniSpeechSatForCTC,UniSpeechSatForSequenceClassification:()=>t.UniSpeechSatForSequenceClassification,UniSpeechSatModel:()=>t.UniSpeechSatModel,UniSpeechSatPreTrainedModel:()=>t.UniSpeechSatPreTrainedModel,VLChatProcessor:()=>M.VLChatProcessor,VLMImageProcessor:()=>h.VLMImageProcessor,ViTFeatureExtractor:()=>h.ViTFeatureExtractor,ViTForImageClassification:()=>t.ViTForImageClassification,ViTImageProcessor:()=>h.ViTImageProcessor,ViTMAEModel:()=>t.ViTMAEModel,ViTMAEPreTrainedModel:()=>t.ViTMAEPreTrainedModel,ViTMSNForImageClassification:()=>t.ViTMSNForImageClassification,ViTMSNModel:()=>t.ViTMSNModel,ViTMSNPreTrainedModel:()=>t.ViTMSNPreTrainedModel,ViTModel:()=>t.ViTModel,ViTPreTrainedModel:()=>t.ViTPreTrainedModel,VisionEncoderDecoderModel:()=>t.VisionEncoderDecoderModel,VitMatteForImageMatting:()=>t.VitMatteForImageMatting,VitMatteImageProcessor:()=>h.VitMatteImageProcessor,VitMattePreTrainedModel:()=>t.VitMattePreTrainedModel,VitPoseForPoseEstimation:()=>t.VitPoseForPoseEstimation,VitPoseImageProcessor:()=>h.VitPoseImageProcessor,VitPosePreTrainedModel:()=>t.VitPosePreTrainedModel,VitsModel:()=>t.VitsModel,VitsModelOutput:()=>t.VitsModelOutput,VitsPreTrainedModel:()=>t.VitsPreTrainedModel,VitsTokenizer:()=>s.VitsTokenizer,Wav2Vec2BertForCTC:()=>t.Wav2Vec2BertForCTC,Wav2Vec2BertForSequenceClassification:()=>t.Wav2Vec2BertForSequenceClassification,Wav2Vec2BertModel:()=>t.Wav2Vec2BertModel,Wav2Vec2BertPreTrainedModel:()=>t.Wav2Vec2BertPreTrainedModel,Wav2Vec2CTCTokenizer:()=>s.Wav2Vec2CTCTokenizer,Wav2Vec2FeatureExtractor:()=>d.Wav2Vec2FeatureExtractor,Wav2Vec2ForAudioFrameClassification:()=>t.Wav2Vec2ForAudioFrameClassification,Wav2Vec2ForCTC:()=>t.Wav2Vec2ForCTC,Wav2Vec2ForSequenceClassification:()=>t.Wav2Vec2ForSequenceClassification,Wav2Vec2Model:()=>t.Wav2Vec2Model,Wav2Vec2PreTrainedModel:()=>t.Wav2Vec2PreTrainedModel,Wav2Vec2Processor:()=>M.Wav2Vec2Processor,Wav2Vec2ProcessorWithLM:()=>M.Wav2Vec2ProcessorWithLM,WavLMForAudioFrameClassification:()=>t.WavLMForAudioFrameClassification,WavLMForCTC:()=>t.WavLMForCTC,WavLMForSequenceClassification:()=>t.WavLMForSequenceClassification,WavLMForXVector:()=>t.WavLMForXVector,WavLMModel:()=>t.WavLMModel,WavLMPreTrainedModel:()=>t.WavLMPreTrainedModel,WeSpeakerFeatureExtractor:()=>d.WeSpeakerFeatureExtractor,WeSpeakerResNetModel:()=>t.WeSpeakerResNetModel,WeSpeakerResNetPreTrainedModel:()=>t.WeSpeakerResNetPreTrainedModel,WhisperFeatureExtractor:()=>d.WhisperFeatureExtractor,WhisperForConditionalGeneration:()=>t.WhisperForConditionalGeneration,WhisperModel:()=>t.WhisperModel,WhisperPreTrainedModel:()=>t.WhisperPreTrainedModel,WhisperProcessor:()=>M.WhisperProcessor,WhisperTextStreamer:()=>C.WhisperTextStreamer,WhisperTimeStampLogitsProcessor:()=>T.WhisperTimeStampLogitsProcessor,WhisperTokenizer:()=>s.WhisperTokenizer,XLMForQuestionAnswering:()=>t.XLMForQuestionAnswering,XLMForSequenceClassification:()=>t.XLMForSequenceClassification,XLMForTokenClassification:()=>t.XLMForTokenClassification,XLMModel:()=>t.XLMModel,XLMPreTrainedModel:()=>t.XLMPreTrainedModel,XLMRobertaForMaskedLM:()=>t.XLMRobertaForMaskedLM,XLMRobertaForQuestionAnswering:()=>t.XLMRobertaForQuestionAnswering,XLMRobertaForSequenceClassification:()=>t.XLMRobertaForSequenceClassification,XLMRobertaForTokenClassification:()=>t.XLMRobertaForTokenClassification,XLMRobertaModel:()=>t.XLMRobertaModel,XLMRobertaPreTrainedModel:()=>t.XLMRobertaPreTrainedModel,XLMRobertaTokenizer:()=>s.XLMRobertaTokenizer,XLMTokenizer:()=>s.XLMTokenizer,XLMWithLMHeadModel:()=>t.XLMWithLMHeadModel,XVectorOutput:()=>t.XVectorOutput,YolosFeatureExtractor:()=>h.YolosFeatureExtractor,YolosForObjectDetection:()=>t.YolosForObjectDetection,YolosImageProcessor:()=>h.YolosImageProcessor,YolosModel:()=>t.YolosModel,YolosObjectDetectionOutput:()=>t.YolosObjectDetectionOutput,YolosPreTrainedModel:()=>t.YolosPreTrainedModel,ZeroShotAudioClassificationPipeline:()=>r.ZeroShotAudioClassificationPipeline,ZeroShotClassificationPipeline:()=>r.ZeroShotClassificationPipeline,ZeroShotImageClassificationPipeline:()=>r.ZeroShotImageClassificationPipeline,ZeroShotObjectDetectionPipeline:()=>r.ZeroShotObjectDetectionPipeline,bankers_round:()=>c.bankers_round,cat:()=>l.cat,cos_sim:()=>c.cos_sim,dot:()=>c.dot,dynamic_time_warping:()=>c.dynamic_time_warping,env:()=>e.env,full:()=>l.full,full_like:()=>l.full_like,getKeyValueShapes:()=>o.getKeyValueShapes,hamming:()=>a.hamming,hanning:()=>a.hanning,interpolate:()=>l.interpolate,interpolate_4d:()=>l.interpolate_4d,interpolate_data:()=>c.interpolate_data,is_chinese_char:()=>s.is_chinese_char,layer_norm:()=>l.layer_norm,load_image:()=>n.load_image,load_video:()=>i.load_video,log_softmax:()=>c.log_softmax,magnitude:()=>c.magnitude,matmul:()=>l.matmul,max:()=>c.max,mean:()=>l.mean,mean_pooling:()=>l.mean_pooling,medianFilter:()=>c.medianFilter,mel_filter_bank:()=>a.mel_filter_bank,min:()=>c.min,ones:()=>l.ones,ones_like:()=>l.ones_like,permute:()=>l.permute,permute_data:()=>c.permute_data,pipeline:()=>r.pipeline,quantize_embeddings:()=>l.quantize_embeddings,rand:()=>l.rand,read_audio:()=>a.read_audio,rfft:()=>l.rfft,round:()=>c.round,slice:()=>l.slice,softmax:()=>c.softmax,spectrogram:()=>a.spectrogram,stack:()=>l.stack,std_mean:()=>l.std_mean,topk:()=>l.topk,window_function:()=>a.window_function,zeros:()=>l.zeros,zeros_like:()=>l.zeros_like});var e=Qt("./src/env.js"),r=Qt("./src/pipelines.js"),t=Qt("./src/models.js"),s=Qt("./src/tokenizers.js"),o=Qt("./src/configs.js"),a=Qt("./src/utils/audio.js"),n=Qt("./src/utils/image.js"),i=Qt("./src/utils/video.js"),l=Qt("./src/utils/tensor.js"),c=Qt("./src/utils/maths.js"),_=Qt("./src/base/feature_extraction_utils.js"),d=Qt("./src/models/feature_extractors.js"),u=Qt("./src/models/auto/feature_extraction_auto.js"),f=Qt("./src/base/image_processors_utils.js"),h=Qt("./src/models/image_processors.js"),v=Qt("./src/models/auto/image_processing_auto.js"),E=Qt("./src/base/processing_utils.js"),M=Qt("./src/models/processors.js"),w=Qt("./src/models/auto/processing_auto.js"),C=Qt("./src/generation/streamers.js"),x=Qt("./src/generation/stopping_criteria.js"),T=Qt("./src/generation/logits_process.js")})();TP=m.ASTFeatureExtractor,PP=m.ASTForAudioClassification,EP=m.ASTModel,kP=m.ASTPreTrainedModel,CP=m.AlbertForMaskedLM,SP=m.AlbertForQuestionAnswering,IP=m.AlbertForSequenceClassification,FP=m.AlbertModel,$P=m.AlbertPreTrainedModel,AP=m.AlbertTokenizer,DP=m.AudioClassificationPipeline,OP=m.AutoConfig,LP=m.AutoFeatureExtractor,zP=m.AutoImageProcessor,BP=m.AutoModel,RP=m.AutoModelForAudioClassification,NP=m.AutoModelForAudioFrameClassification,jP=m.AutoModelForAudioTextToText,VP=m.AutoModelForCTC,WP=m.AutoModelForCausalLM,UP=m.AutoModelForDepthEstimation,GP=m.AutoModelForDocumentQuestionAnswering,KP=m.AutoModelForImageClassification,HP=m.AutoModelForImageFeatureExtraction,qP=m.AutoModelForImageMatting,QP=m.AutoModelForImageSegmentation,XP=m.AutoModelForImageTextToText,JP=m.AutoModelForImageToImage,YP=m.AutoModelForMaskGeneration,ZP=m.AutoModelForMaskedLM,eE=m.AutoModelForNormalEstimation,tE=m.AutoModelForObjectDetection,rE=m.AutoModelForPoseEstimation,sE=m.AutoModelForQuestionAnswering,aE=m.AutoModelForSemanticSegmentation,oE=m.AutoModelForSeq2SeqLM,nE=m.AutoModelForSequenceClassification,iE=m.AutoModelForSpeechSeq2Seq,lE=m.AutoModelForTextToSpectrogram,cE=m.AutoModelForTextToWaveform,dE=m.AutoModelForTokenClassification,uE=m.AutoModelForUniversalSegmentation,_E=m.AutoModelForVision2Seq,pE=m.AutoModelForXVector,mE=m.AutoModelForZeroShotObjectDetection,hE=m.AutoProcessor,fE=m.AutoTokenizer,gE=m.AutomaticSpeechRecognitionPipeline,ME=m.BackgroundRemovalPipeline,wE=m.BartForConditionalGeneration,bE=m.BartForSequenceClassification,vE=m.BartModel,xE=m.BartPretrainedModel,yE=m.BartTokenizer,TE=m.BaseModelOutput,PE=m.BaseStreamer,EE=m.BeitFeatureExtractor,kE=m.BeitForImageClassification,CE=m.BeitModel,SE=m.BeitPreTrainedModel,IE=m.BertForMaskedLM,FE=m.BertForQuestionAnswering,$E=m.BertForSequenceClassification,AE=m.BertForTokenClassification,DE=m.BertModel,OE=m.BertPreTrainedModel,LE=m.BertTokenizer,zE=m.BitImageProcessor,BE=m.BlenderbotForConditionalGeneration,RE=m.BlenderbotModel,NE=m.BlenderbotPreTrainedModel,jE=m.BlenderbotSmallForConditionalGeneration,VE=m.BlenderbotSmallModel,WE=m.BlenderbotSmallPreTrainedModel,UE=m.BlenderbotSmallTokenizer,GE=m.BlenderbotTokenizer,KE=m.BloomForCausalLM,HE=m.BloomModel,qE=m.BloomPreTrainedModel,QE=m.BloomTokenizer,XE=m.CLIPFeatureExtractor,JE=m.CLIPImageProcessor,YE=m.CLIPModel,ZE=m.CLIPPreTrainedModel,e1=m.CLIPSegForImageSegmentation,t1=m.CLIPSegModel,r1=m.CLIPSegPreTrainedModel,s1=m.CLIPTextModel,a1=m.CLIPTextModelWithProjection,o1=m.CLIPTokenizer,n1=m.CLIPVisionModel,i1=m.CLIPVisionModelWithProjection,l1=m.CamembertForMaskedLM,c1=m.CamembertForQuestionAnswering,d1=m.CamembertForSequenceClassification,u1=m.CamembertForTokenClassification,_1=m.CamembertModel,p1=m.CamembertPreTrainedModel,m1=m.CamembertTokenizer,h1=m.CausalLMOutput,f1=m.CausalLMOutputWithPast,g1=m.ChineseCLIPFeatureExtractor,M1=m.ChineseCLIPModel,w1=m.ChineseCLIPPreTrainedModel,b1=m.ClapAudioModelWithProjection,v1=m.ClapFeatureExtractor,x1=m.ClapModel,y1=m.ClapPreTrainedModel,T1=m.ClapTextModelWithProjection,P1=m.ClassifierFreeGuidanceLogitsProcessor,E1=m.CodeGenForCausalLM,k1=m.CodeGenModel,C1=m.CodeGenPreTrainedModel,S1=m.CodeGenTokenizer,I1=m.CodeLlamaTokenizer,F1=m.CohereForCausalLM,$1=m.CohereModel,A1=m.CoherePreTrainedModel,D1=m.CohereTokenizer,O1=m.ConvBertForMaskedLM,L1=m.ConvBertForQuestionAnswering,z1=m.ConvBertForSequenceClassification,B1=m.ConvBertForTokenClassification,R1=m.ConvBertModel,N1=m.ConvBertPreTrainedModel,j1=m.ConvBertTokenizer,V1=m.ConvNextFeatureExtractor,W1=m.ConvNextForImageClassification,U1=m.ConvNextImageProcessor,G1=m.ConvNextModel,K1=m.ConvNextPreTrainedModel,H1=m.ConvNextV2ForImageClassification,q1=m.ConvNextV2Model,Q1=m.ConvNextV2PreTrainedModel,X1=m.DFineForObjectDetection,J1=m.DFineModel,Y1=m.DFinePreTrainedModel,Z1=m.DPTFeatureExtractor,e2=m.DPTForDepthEstimation,t2=m.DPTImageProcessor,r2=m.DPTModel,s2=m.DPTPreTrainedModel,a2=m.DacDecoderModel,o2=m.DacDecoderOutput,n2=m.DacEncoderModel,i2=m.DacEncoderOutput,l2=m.DacFeatureExtractor,c2=m.DacModel,d2=m.DacPreTrainedModel,u2=m.DataTypeMap,_2=m.DebertaForMaskedLM,p2=m.DebertaForQuestionAnswering,m2=m.DebertaForSequenceClassification,h2=m.DebertaForTokenClassification,f2=m.DebertaModel,g2=m.DebertaPreTrainedModel,M2=m.DebertaTokenizer,w2=m.DebertaV2ForMaskedLM,b2=m.DebertaV2ForQuestionAnswering,v2=m.DebertaV2ForSequenceClassification,x2=m.DebertaV2ForTokenClassification,y2=m.DebertaV2Model,T2=m.DebertaV2PreTrainedModel,P2=m.DebertaV2Tokenizer,E2=m.DecisionTransformerModel,k2=m.DecisionTransformerPreTrainedModel,C2=m.DeiTFeatureExtractor,S2=m.DeiTForImageClassification,I2=m.DeiTImageProcessor,F2=m.DeiTModel,$2=m.DeiTPreTrainedModel,A2=m.DepthAnythingForDepthEstimation,D2=m.DepthAnythingPreTrainedModel,O2=m.DepthEstimationPipeline,L2=m.DepthProForDepthEstimation,z2=m.DepthProPreTrainedModel,B2=m.DetrFeatureExtractor,R2=m.DetrForObjectDetection,N2=m.DetrForSegmentation,j2=m.DetrImageProcessor,V2=m.DetrModel,W2=m.DetrObjectDetectionOutput,U2=m.DetrPreTrainedModel,G2=m.DetrSegmentationOutput,K2=m.Dinov2ForImageClassification,H2=m.Dinov2Model,q2=m.Dinov2PreTrainedModel,Q2=m.Dinov2WithRegistersForImageClassification,X2=m.Dinov2WithRegistersModel,J2=m.Dinov2WithRegistersPreTrainedModel,Y2=m.DistilBertForMaskedLM,Z2=m.DistilBertForQuestionAnswering,ek=m.DistilBertForSequenceClassification,tk=m.DistilBertForTokenClassification,rk=m.DistilBertModel,sk=m.DistilBertPreTrainedModel,ak=m.DistilBertTokenizer,ok=m.DocumentQuestionAnsweringPipeline,nk=m.DonutFeatureExtractor,ik=m.DonutImageProcessor,lk=m.DonutSwinModel,ck=m.DonutSwinPreTrainedModel,dk=m.EfficientNetForImageClassification,uk=m.EfficientNetImageProcessor,_k=m.EfficientNetModel,pk=m.EfficientNetPreTrainedModel,mk=m.ElectraForMaskedLM,hk=m.ElectraForQuestionAnswering,fk=m.ElectraForSequenceClassification,gk=m.ElectraForTokenClassification,Mk=m.ElectraModel,wk=m.ElectraPreTrainedModel,bk=m.ElectraTokenizer,vk=m.EncodecFeatureExtractor,xk=m.EosTokenCriteria,yk=m.EsmForMaskedLM,Tk=m.EsmForSequenceClassification,Pk=m.EsmForTokenClassification,Ek=m.EsmModel,kk=m.EsmPreTrainedModel,Ck=m.EsmTokenizer,Sk=m.ExaoneForCausalLM,Ik=m.ExaoneModel,Fk=m.ExaonePreTrainedModel,$k=m.FFT,Ak=m.FalconForCausalLM,Dk=m.FalconModel,Ok=m.FalconPreTrainedModel,Lk=m.FalconTokenizer,zk=m.FastViTForImageClassification,Bk=m.FastViTModel,Rk=m.FastViTPreTrainedModel,Nk=m.FeatureExtractionPipeline,jk=m.FeatureExtractor,Vk=m.FillMaskPipeline,Wk=m.Florence2ForConditionalGeneration,Uk=m.Florence2PreTrainedModel,Gk=m.Florence2Processor,Kk=m.ForcedBOSTokenLogitsProcessor,Hk=m.ForcedEOSTokenLogitsProcessor,qk=m.GLPNFeatureExtractor,Qk=m.GLPNForDepthEstimation,Xk=m.GLPNModel,Jk=m.GLPNPreTrainedModel,Yk=m.GPT2LMHeadModel,Zk=m.GPT2Model,eC=m.GPT2PreTrainedModel,tC=m.GPT2Tokenizer,rC=m.GPTBigCodeForCausalLM,sC=m.GPTBigCodeModel,aC=m.GPTBigCodePreTrainedModel,oC=m.GPTJForCausalLM,nC=m.GPTJModel,iC=m.GPTJPreTrainedModel,lC=m.GPTNeoForCausalLM,cC=m.GPTNeoModel,dC=m.GPTNeoPreTrainedModel,uC=m.GPTNeoXForCausalLM,_C=m.GPTNeoXModel,pC=m.GPTNeoXPreTrainedModel,mC=m.GPTNeoXTokenizer,hC=m.Gemma2ForCausalLM,fC=m.Gemma2Model,gC=m.Gemma2PreTrainedModel,MC=m.Gemma3ForCausalLM,wC=m.Gemma3Model,bC=m.Gemma3PreTrainedModel,vC=m.Gemma3nAudioFeatureExtractor,xC=m.Gemma3nForConditionalGeneration,yC=m.Gemma3nPreTrainedModel,TC=m.Gemma3nProcessor,PC=m.GemmaForCausalLM,EC=m.GemmaModel,kC=m.GemmaPreTrainedModel,CC=m.GemmaTokenizer,SC=m.GlmForCausalLM,IC=m.GlmModel,FC=m.GlmPreTrainedModel,$C=m.GraniteForCausalLM,AC=m.GraniteModel,DC=m.GranitePreTrainedModel,OC=m.Grok1Tokenizer,LC=m.GroundingDinoForObjectDetection,zC=m.GroundingDinoImageProcessor,BC=m.GroundingDinoPreTrainedModel,RC=m.GroundingDinoProcessor,NC=m.GroupViTModel,jC=m.GroupViTPreTrainedModel,VC=m.HeliumForCausalLM,WC=m.HeliumModel,UC=m.HeliumPreTrainedModel,GC=m.HerbertTokenizer,KC=m.HieraForImageClassification,HC=m.HieraModel,qC=m.HieraPreTrainedModel,QC=m.HubertForCTC,XC=m.HubertForSequenceClassification,JC=m.HubertModel,YC=m.HubertPreTrainedModel,ZC=m.IJepaForImageClassification,eS=m.IJepaModel,tS=m.IJepaPreTrainedModel,rS=m.Idefics3ForConditionalGeneration,sS=m.Idefics3ImageProcessor,aS=m.Idefics3PreTrainedModel,oS=m.Idefics3Processor,nS=m.ImageClassificationPipeline,iS=m.ImageFeatureExtractionPipeline,lS=m.ImageFeatureExtractor,cS=m.ImageMattingOutput,dS=m.ImageProcessor,uS=m.ImageSegmentationPipeline,_S=m.ImageToImagePipeline,pS=m.ImageToTextPipeline,mS=m.InterruptableStoppingCriteria,hS=m.JAISLMHeadModel,fS=m.JAISModel,gS=m.JAISPreTrainedModel,MS=m.JinaCLIPImageProcessor,wS=m.JinaCLIPModel,bS=m.JinaCLIPPreTrainedModel,vS=m.JinaCLIPProcessor,xS=m.JinaCLIPTextModel,yS=m.JinaCLIPVisionModel,TS=m.LiteWhisperForConditionalGeneration,PS=m.LlamaForCausalLM,ES=m.LlamaModel,kS=m.LlamaPreTrainedModel,CS=m.LlamaTokenizer,SS=m.LlavaForConditionalGeneration,IS=m.LlavaOnevisionForConditionalGeneration,FS=m.LlavaOnevisionImageProcessor,$S=m.LlavaPreTrainedModel,AS=m.LlavaProcessor,DS=m.LlavaQwen2ForCausalLM,OS=m.LogitsProcessor,LS=m.LogitsProcessorList,zS=m.LogitsWarper,BS=m.LongT5ForConditionalGeneration,RS=m.LongT5Model,NS=m.LongT5PreTrainedModel,jS=m.M2M100ForConditionalGeneration,VS=m.M2M100Model,WS=m.M2M100PreTrainedModel,US=m.M2M100Tokenizer,GS=m.MBart50Tokenizer,KS=m.MBartForCausalLM,HS=m.MBartForConditionalGeneration,qS=m.MBartForSequenceClassification,QS=m.MBartModel,XS=m.MBartPreTrainedModel,JS=m.MBartTokenizer,YS=m.MPNetForMaskedLM,ZS=m.MPNetForQuestionAnswering,eI=m.MPNetForSequenceClassification,tI=m.MPNetForTokenClassification,rI=m.MPNetModel,sI=m.MPNetPreTrainedModel,aI=m.MPNetTokenizer,oI=m.MT5ForConditionalGeneration,nI=m.MT5Model,iI=m.MT5PreTrainedModel,lI=m.MarianMTModel,cI=m.MarianModel,dI=m.MarianPreTrainedModel,uI=m.MarianTokenizer,_I=m.Mask2FormerImageProcessor,pI=m.MaskFormerFeatureExtractor,mI=m.MaskFormerForInstanceSegmentation,hI=m.MaskFormerImageProcessor,fI=m.MaskFormerModel,gI=m.MaskFormerPreTrainedModel,MI=m.MaskedLMOutput,wI=m.MaxLengthCriteria,bI=m.Metric3DForDepthEstimation,vI=m.Metric3DPreTrainedModel,xI=m.Metric3Dv2ForDepthEstimation,yI=m.Metric3Dv2PreTrainedModel,TI=m.MgpstrForSceneTextRecognition,PI=m.MgpstrModelOutput,EI=m.MgpstrPreTrainedModel,kI=m.MgpstrProcessor,CI=m.MgpstrTokenizer,SI=m.MimiDecoderModel,II=m.MimiDecoderOutput,FI=m.MimiEncoderModel,$I=m.MimiEncoderOutput,AI=m.MimiModel,DI=m.MimiPreTrainedModel,OI=m.MinLengthLogitsProcessor,LI=m.MinNewTokensLengthLogitsProcessor,zI=m.MistralForCausalLM,BI=m.MistralModel,RI=m.MistralPreTrainedModel,NI=m.MobileBertForMaskedLM,jI=m.MobileBertForQuestionAnswering,VI=m.MobileBertForSequenceClassification,WI=m.MobileBertModel,UI=m.MobileBertPreTrainedModel,GI=m.MobileBertTokenizer,KI=m.MobileLLMForCausalLM,HI=m.MobileLLMModel,qI=m.MobileLLMPreTrainedModel,QI=m.MobileNetV1FeatureExtractor,XI=m.MobileNetV1ForImageClassification,JI=m.MobileNetV1ForSemanticSegmentation,YI=m.MobileNetV1ImageProcessor,ZI=m.MobileNetV1Model,eF=m.MobileNetV1PreTrainedModel,tF=m.MobileNetV2FeatureExtractor,rF=m.MobileNetV2ForImageClassification,sF=m.MobileNetV2ForSemanticSegmentation,aF=m.MobileNetV2ImageProcessor,oF=m.MobileNetV2Model,nF=m.MobileNetV2PreTrainedModel,iF=m.MobileNetV3FeatureExtractor,lF=m.MobileNetV3ForImageClassification,cF=m.MobileNetV3ForSemanticSegmentation,dF=m.MobileNetV3ImageProcessor,uF=m.MobileNetV3Model,_F=m.MobileNetV3PreTrainedModel,pF=m.MobileNetV4FeatureExtractor,mF=m.MobileNetV4ForImageClassification,hF=m.MobileNetV4ForSemanticSegmentation,fF=m.MobileNetV4ImageProcessor,gF=m.MobileNetV4Model,MF=m.MobileNetV4PreTrainedModel,wF=m.MobileViTFeatureExtractor,bF=m.MobileViTForImageClassification,vF=m.MobileViTImageProcessor,xF=m.MobileViTModel,yF=m.MobileViTPreTrainedModel,TF=m.MobileViTV2ForImageClassification,PF=m.MobileViTV2Model,EF=m.MobileViTV2PreTrainedModel,kF=m.ModelOutput,CF=m.ModernBertForMaskedLM,SF=m.ModernBertForSequenceClassification,IF=m.ModernBertForTokenClassification,FF=m.ModernBertModel,$F=m.ModernBertPreTrainedModel,AF=m.Moondream1ForConditionalGeneration,DF=m.MoonshineFeatureExtractor,OF=m.MoonshineForConditionalGeneration,LF=m.MoonshineModel,zF=m.MoonshinePreTrainedModel,BF=m.MoonshineProcessor,RF=m.MptForCausalLM,NF=m.MptModel,jF=m.MptPreTrainedModel,VF=m.MultiModalityCausalLM,WF=m.MultiModalityPreTrainedModel,UF=m.MusicgenForCausalLM,GF=m.MusicgenForConditionalGeneration,KF=m.MusicgenModel,HF=m.MusicgenPreTrainedModel,qF=m.NllbTokenizer,QF=m.NoBadWordsLogitsProcessor,XF=m.NoRepeatNGramLogitsProcessor,JF=m.NomicBertModel,YF=m.NomicBertPreTrainedModel,ZF=m.NougatImageProcessor,e$=m.NougatTokenizer,t$=m.OPTForCausalLM,r$=m.OPTModel,s$=m.OPTPreTrainedModel,a$=m.ObjectDetectionPipeline,o$=m.Olmo2ForCausalLM,n$=m.Olmo2Model,i$=m.Olmo2PreTrainedModel,l$=m.OlmoForCausalLM,c$=m.OlmoModel,d$=m.OlmoPreTrainedModel,u$=m.OpenELMForCausalLM,_$=m.OpenELMModel,p$=m.OpenELMPreTrainedModel,m$=m.OwlViTFeatureExtractor,h$=m.OwlViTForObjectDetection,f$=m.OwlViTImageProcessor,g$=m.OwlViTModel,M$=m.OwlViTPreTrainedModel,w$=m.OwlViTProcessor,b$=m.Owlv2ForObjectDetection,v$=m.Owlv2ImageProcessor,x$=m.Owlv2Model,y$=m.Owlv2PreTrainedModel,T$=m.PaliGemmaForConditionalGeneration,P$=m.PaliGemmaPreTrainedModel,E$=m.PaliGemmaProcessor,k$=m.PatchTSMixerForPrediction,C$=m.PatchTSMixerModel,S$=m.PatchTSMixerPreTrainedModel,I$=m.PatchTSTForPrediction,F$=m.PatchTSTModel,$$=m.PatchTSTPreTrainedModel,A$=m.Phi3ForCausalLM,D$=m.Phi3Model,O$=m.Phi3PreTrainedModel,L$=m.Phi3VForCausalLM,z$=m.Phi3VImageProcessor,B$=m.Phi3VPreTrainedModel,R$=m.Phi3VProcessor,N$=m.PhiForCausalLM,j$=m.PhiModel,V$=m.PhiPreTrainedModel,W$=m.Pipeline,U$=m.PreTrainedModel,G$=m.PreTrainedTokenizer,K$=m.PretrainedConfig,H$=m.PretrainedMixin,q$=m.Processor,Q$=m.PvtForImageClassification,X$=m.PvtImageProcessor,J$=m.PvtModel,Y$=m.PvtPreTrainedModel,Z$=m.PyAnnoteFeatureExtractor,eA=m.PyAnnoteForAudioFrameClassification,tA=m.PyAnnoteModel,rA=m.PyAnnotePreTrainedModel,sA=m.PyAnnoteProcessor,aA=m.QuestionAnsweringModelOutput,oA=m.QuestionAnsweringPipeline,nA=m.Qwen2ForCausalLM,iA=m.Qwen2Model,lA=m.Qwen2PreTrainedModel,cA=m.Qwen2Tokenizer,dA=m.Qwen2VLForConditionalGeneration,uA=m.Qwen2VLImageProcessor,_A=m.Qwen2VLPreTrainedModel,pA=m.Qwen2VLProcessor,mA=m.Qwen3ForCausalLM,hA=m.Qwen3Model,fA=m.Qwen3PreTrainedModel,gA=m.RFDetrForObjectDetection,MA=m.RFDetrModel,wA=m.RFDetrObjectDetectionOutput,bA=m.RFDetrPreTrainedModel,vA=m.RTDetrForObjectDetection,xA=m.RTDetrImageProcessor,yA=m.RTDetrModel,TA=m.RTDetrObjectDetectionOutput,PA=m.RTDetrPreTrainedModel,EA=m.RTDetrV2ForObjectDetection,kA=m.RTDetrV2Model,CA=m.RTDetrV2ObjectDetectionOutput,SA=m.RTDetrV2PreTrainedModel,IA=m.RawAudio,FA=m.RawImage,$A=m.RawVideo,AA=m.RawVideoFrame,DA=m.RepetitionPenaltyLogitsProcessor,OA=m.ResNetForImageClassification,LA=m.ResNetModel,zA=m.ResNetPreTrainedModel,BA=m.RoFormerForMaskedLM,RA=m.RoFormerForQuestionAnswering,NA=m.RoFormerForSequenceClassification,jA=m.RoFormerForTokenClassification,VA=m.RoFormerModel,WA=m.RoFormerPreTrainedModel,UA=m.RoFormerTokenizer,GA=m.RobertaForMaskedLM,KA=m.RobertaForQuestionAnswering,HA=m.RobertaForSequenceClassification,qA=m.RobertaForTokenClassification,QA=m.RobertaModel,XA=m.RobertaPreTrainedModel,JA=m.RobertaTokenizer,YA=m.SamImageProcessor,ZA=m.SamImageSegmentationOutput,eD=m.SamModel,tD=m.SamPreTrainedModel,rD=m.SamProcessor,sD=m.SapiensForDepthEstimation,aD=m.SapiensForNormalEstimation,oD=m.SapiensForSemanticSegmentation,nD=m.SapiensPreTrainedModel,iD=m.SeamlessM4TFeatureExtractor,lD=m.SegformerFeatureExtractor,cD=m.SegformerForImageClassification,dD=m.SegformerForSemanticSegmentation,uD=m.SegformerImageProcessor,_D=m.SegformerModel,pD=m.SegformerPreTrainedModel,mD=m.Seq2SeqLMOutput,hD=m.SequenceClassifierOutput,fD=m.SiglipImageProcessor,gD=m.SiglipModel,MD=m.SiglipPreTrainedModel,wD=m.SiglipTextModel,bD=m.SiglipTokenizer,vD=m.SiglipVisionModel,xD=m.SmolVLMForConditionalGeneration,yD=m.SmolVLMImageProcessor,TD=m.SmolVLMProcessor,PD=m.SnacDecoderModel,ED=m.SnacEncoderModel,kD=m.SnacFeatureExtractor,CD=m.SnacModel,SD=m.SnacPreTrainedModel,ID=m.SpeechT5FeatureExtractor,FD=m.SpeechT5ForSpeechToText,$D=m.SpeechT5ForTextToSpeech,AD=m.SpeechT5HifiGan,DD=m.SpeechT5Model,OD=m.SpeechT5PreTrainedModel,LD=m.SpeechT5Processor,zD=m.SpeechT5Tokenizer,BD=m.SqueezeBertForMaskedLM,RD=m.SqueezeBertForQuestionAnswering,ND=m.SqueezeBertForSequenceClassification,jD=m.SqueezeBertModel,VD=m.SqueezeBertPreTrainedModel,WD=m.SqueezeBertTokenizer,UD=m.StableLmForCausalLM,GD=m.StableLmModel,KD=m.StableLmPreTrainedModel,HD=m.Starcoder2ForCausalLM,qD=m.Starcoder2Model,QD=m.Starcoder2PreTrainedModel,XD=m.StoppingCriteria,JD=m.StoppingCriteriaList,YD=m.StyleTextToSpeech2Model,ZD=m.StyleTextToSpeech2PreTrainedModel,eO=m.SummarizationPipeline,tO=m.SuppressTokensAtBeginLogitsProcessor,rO=m.Swin2SRForImageSuperResolution,sO=m.Swin2SRImageProcessor,aO=m.Swin2SRModel,oO=m.Swin2SRPreTrainedModel,nO=m.SwinForImageClassification,iO=m.SwinForSemanticSegmentation,lO=m.SwinModel,cO=m.SwinPreTrainedModel,dO=m.T5ForConditionalGeneration,uO=m.T5Model,_O=m.T5PreTrainedModel,pO=m.T5Tokenizer,mO=m.TableTransformerForObjectDetection,hO=m.TableTransformerModel,fO=m.TableTransformerObjectDetectionOutput,gO=m.TableTransformerPreTrainedModel,MO=m.TemperatureLogitsWarper,wO=m.Tensor,bO=m.Text2TextGenerationPipeline,vO=m.TextClassificationPipeline,xO=m.TextGenerationPipeline,yO=m.TextStreamer,TO=m.TextToAudioPipeline,PO=m.TokenClassificationPipeline,EO=m.TokenClassifierOutput,kO=m.TokenizerModel,CO=m.TopKLogitsWarper,SO=m.TopPLogitsWarper,IO=m.TrOCRForCausalLM,FO=m.TrOCRPreTrainedModel,$O=m.TranslationPipeline,AO=m.UltravoxModel,DO=m.UltravoxPreTrainedModel,OO=m.UltravoxProcessor,LO=m.UniSpeechForCTC,zO=m.UniSpeechForSequenceClassification,BO=m.UniSpeechModel,RO=m.UniSpeechPreTrainedModel,NO=m.UniSpeechSatForAudioFrameClassification,jO=m.UniSpeechSatForCTC,VO=m.UniSpeechSatForSequenceClassification,WO=m.UniSpeechSatModel,UO=m.UniSpeechSatPreTrainedModel,GO=m.VLChatProcessor,KO=m.VLMImageProcessor,HO=m.ViTFeatureExtractor,qO=m.ViTForImageClassification,QO=m.ViTImageProcessor,XO=m.ViTMAEModel,JO=m.ViTMAEPreTrainedModel,YO=m.ViTMSNForImageClassification,ZO=m.ViTMSNModel,eL=m.ViTMSNPreTrainedModel,tL=m.ViTModel,rL=m.ViTPreTrainedModel,sL=m.VisionEncoderDecoderModel,aL=m.VitMatteForImageMatting,oL=m.VitMatteImageProcessor,nL=m.VitMattePreTrainedModel,iL=m.VitPoseForPoseEstimation,lL=m.VitPoseImageProcessor,cL=m.VitPosePreTrainedModel,dL=m.VitsModel,uL=m.VitsModelOutput,_L=m.VitsPreTrainedModel,pL=m.VitsTokenizer,mL=m.Wav2Vec2BertForCTC,hL=m.Wav2Vec2BertForSequenceClassification,fL=m.Wav2Vec2BertModel,gL=m.Wav2Vec2BertPreTrainedModel,ML=m.Wav2Vec2CTCTokenizer,wL=m.Wav2Vec2FeatureExtractor,bL=m.Wav2Vec2ForAudioFrameClassification,vL=m.Wav2Vec2ForCTC,xL=m.Wav2Vec2ForSequenceClassification,yL=m.Wav2Vec2Model,TL=m.Wav2Vec2PreTrainedModel,PL=m.Wav2Vec2Processor,EL=m.Wav2Vec2ProcessorWithLM,kL=m.WavLMForAudioFrameClassification,CL=m.WavLMForCTC,SL=m.WavLMForSequenceClassification,IL=m.WavLMForXVector,FL=m.WavLMModel,$L=m.WavLMPreTrainedModel,AL=m.WeSpeakerFeatureExtractor,DL=m.WeSpeakerResNetModel,OL=m.WeSpeakerResNetPreTrainedModel,LL=m.WhisperFeatureExtractor,zL=m.WhisperForConditionalGeneration,BL=m.WhisperModel,RL=m.WhisperPreTrainedModel,NL=m.WhisperProcessor,jL=m.WhisperTextStreamer,VL=m.WhisperTimeStampLogitsProcessor,WL=m.WhisperTokenizer,UL=m.XLMForQuestionAnswering,GL=m.XLMForSequenceClassification,KL=m.XLMForTokenClassification,HL=m.XLMModel,qL=m.XLMPreTrainedModel,QL=m.XLMRobertaForMaskedLM,XL=m.XLMRobertaForQuestionAnswering,JL=m.XLMRobertaForSequenceClassification,YL=m.XLMRobertaForTokenClassification,ZL=m.XLMRobertaModel,e3=m.XLMRobertaPreTrainedModel,t3=m.XLMRobertaTokenizer,r3=m.XLMTokenizer,s3=m.XLMWithLMHeadModel,a3=m.XVectorOutput,o3=m.YolosFeatureExtractor,n3=m.YolosForObjectDetection,i3=m.YolosImageProcessor,l3=m.YolosModel,c3=m.YolosObjectDetectionOutput,d3=m.YolosPreTrainedModel,u3=m.ZeroShotAudioClassificationPipeline,_3=m.ZeroShotClassificationPipeline,p3=m.ZeroShotImageClassificationPipeline,m3=m.ZeroShotObjectDetectionPipeline,h3=m.bankers_round,f3=m.cat,g3=m.cos_sim,M3=m.dot,w3=m.dynamic_time_warping,b3=m.env,v3=m.full,x3=m.full_like,y3=m.getKeyValueShapes,T3=m.hamming,P3=m.hanning,E3=m.interpolate,k3=m.interpolate_4d,C3=m.interpolate_data,S3=m.is_chinese_char,I3=m.layer_norm,F3=m.load_image,$3=m.load_video,A3=m.log_softmax,D3=m.magnitude,O3=m.matmul,L3=m.max,z3=m.mean,B3=m.mean_pooling,R3=m.medianFilter,N3=m.mel_filter_bank,j3=m.min,V3=m.ones,W3=m.ones_like,U3=m.permute,G3=m.permute_data,K3=m.pipeline,H3=m.quantize_embeddings,q3=m.rand,Q3=m.read_audio,X3=m.rfft,J3=m.round,Y3=m.slice,Z3=m.softmax,ez=m.spectrogram,tz=m.stack,rz=m.std_mean,sz=m.topk,az=m.window_function,oz=m.zeros,nz=m.zeros_like});var of=Symbol("Comlink.proxy"),N0=Symbol("Comlink.endpoint"),j0=Symbol("Comlink.releaseProxy"),ac=Symbol("Comlink.finalizer"),di=Symbol("Comlink.thrown"),nf=e=>typeof e=="object"&&e!==null||typeof e=="function",V0={canHandle:e=>nf(e)&&e[of],serialize(e){let{port1:r,port2:t}=new MessageChannel;return mi(e,r),[t,[t]]},deserialize(e){return e.start(),K0(e)}},W0={canHandle:e=>nf(e)&&di in e,serialize({value:e}){let r;return e instanceof Error?r={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:r={isError:!1,value:e},[r,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},lf=new Map([["proxy",V0],["throw",W0]]);function U0(e,r){for(let t of e)if(r===t||t==="*"||t instanceof RegExp&&t.test(r))return!0;return!1}function mi(e,r=globalThis,t=["*"]){r.addEventListener("message",function s(o){if(!o||!o.data)return;if(!U0(t,o.origin)){console.warn(`Invalid origin \'${o.origin}\' for comlink proxy`);return}let{id:a,type:n,path:i}=Object.assign({path:[]},o.data),l=(o.data.argumentList||[]).map(Ca),c;try{let _=i.slice(0,-1).reduce((u,f)=>u[f],e),d=i.reduce((u,f)=>u[f],e);switch(n){case"GET":c=d;break;case"SET":_[i.slice(-1)[0]]=Ca(o.data.value),c=!0;break;case"APPLY":c=d.apply(_,l);break;case"CONSTRUCT":{let u=new d(...l);c=J0(u)}break;case"ENDPOINT":{let{port1:u,port2:f}=new MessageChannel;mi(e,f),c=X0(u,[u])}break;case"RELEASE":c=void 0;break;default:return}}catch(_){c={value:_,[di]:0}}Promise.resolve(c).catch(_=>({value:_,[di]:0})).then(_=>{let[d,u]=pi(_);r.postMessage(Object.assign(Object.assign({},d),{id:a}),u),n==="RELEASE"&&(r.removeEventListener("message",s),cf(r),ac in e&&typeof e[ac]=="function"&&e[ac]())}).catch(_=>{let[d,u]=pi({value:new TypeError("Unserializable return value"),[di]:0});r.postMessage(Object.assign(Object.assign({},d),{id:a}),u)})}),r.start&&r.start()}function G0(e){return e.constructor.name==="MessagePort"}function cf(e){G0(e)&&e.close()}function K0(e,r){let t=new Map;return e.addEventListener("message",function(o){let{data:a}=o;if(!a||!a.id)return;let n=t.get(a.id);if(n)try{n(a)}finally{t.delete(a.id)}}),oc(e,t,[],r)}function ci(e){if(e)throw new Error("Proxy has been released and is not useable")}function df(e){return lo(e,new Map,{type:"RELEASE"}).then(()=>{cf(e)})}var ui=new WeakMap,_i="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{let r=(ui.get(e)||0)-1;ui.set(e,r),r===0&&df(e)});function H0(e,r){let t=(ui.get(r)||0)+1;ui.set(r,t),_i&&_i.register(e,r,e)}function q0(e){_i&&_i.unregister(e)}function oc(e,r,t=[],s=function(){}){let o=!1,a=new Proxy(s,{get(n,i){if(ci(o),i===j0)return()=>{q0(a),df(e),r.clear(),o=!0};if(i==="then"){if(t.length===0)return{then:()=>a};let l=lo(e,r,{type:"GET",path:t.map(c=>c.toString())}).then(Ca);return l.then.bind(l)}return oc(e,r,[...t,i])},set(n,i,l){ci(o);let[c,_]=pi(l);return lo(e,r,{type:"SET",path:[...t,i].map(d=>d.toString()),value:c},_).then(Ca)},apply(n,i,l){ci(o);let c=t[t.length-1];if(c===N0)return lo(e,r,{type:"ENDPOINT"}).then(Ca);if(c==="bind")return oc(e,r,t.slice(0,-1));let[_,d]=af(l);return lo(e,r,{type:"APPLY",path:t.map(u=>u.toString()),argumentList:_},d).then(Ca)},construct(n,i){ci(o);let[l,c]=af(i);return lo(e,r,{type:"CONSTRUCT",path:t.map(_=>_.toString()),argumentList:l},c).then(Ca)}});return H0(a,e),a}function Q0(e){return Array.prototype.concat.apply([],e)}function af(e){let r=e.map(pi);return[r.map(t=>t[0]),Q0(r.map(t=>t[1]))]}var uf=new WeakMap;function X0(e,r){return uf.set(e,r),e}function J0(e){return Object.assign(e,{[of]:!0})}function pi(e){for(let[r,t]of lf)if(t.canHandle(e)){let[s,o]=t.serialize(e);return[{type:"HANDLER",name:r,value:s},o]}return[{type:"RAW",value:e},uf.get(e)||[]]}function Ca(e){switch(e.type){case"HANDLER":return lf.get(e.name).deserialize(e.value);case"RAW":return e.value}}function lo(e,r,t,s){return new Promise(o=>{let a=Y0();r.set(a,o),e.start&&e.start(),e.postMessage(Object.assign({id:a},t),s)})}function Y0(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var Mn=B0(pf()),lz=!1,cz=()=>{let e=async r=>{let t;typeof r=="string"?t=[r]:t=r;let s=t.map(()=>new Array(384).fill(0));return{tolist:()=>s}};return e.tokenizer={model:{max_position_embeddings:512},encode:r=>new Array(Math.ceil(r.length/4)).fill(0)},{pipeline:async()=>e}};async function dz(){try{return lz?cz():(Object.defineProperty(globalThis,"process",{get:()=>{},configurable:!0}),await Promise.resolve().then(()=>(c0(),l0)))}catch(e){throw new Error(`Failed to load transformers library: ${e instanceof Error?e.message:String(e)}`)}}var au=class{constructor(){this.extractor=null;this.vectorSize=null;this.maxTokens=null;this.embeddingQueue=Promise.resolve();this.extractor=null,this.vectorSize=null,this.maxTokens=null}setLogLevel(r){Mn.default.setLevel(r),Mn.default.info(`TransformersWorker log level set to: ${Mn.default.getLevel()}`)}async enqueue(r){return this.embeddingQueue=this.embeddingQueue.then(()=>r()).catch(t=>{throw console.error(t),t}),this.embeddingQueue}async handleLoad(r,t,s=!0){var i;Mn.default.info(`Loading model: ${r}, useGPU: ${s}`);let o=await dz();this.extractor=await o.pipeline("feature-extraction",r,{dtype:"fp32",device:s?"webgpu":"wasm",progress_callback:l=>{l.status==="progress"&&l.file.includes("onnx")&&t(l.progress)}});let a=await this.extractor("test",{pooling:"mean",normalize:!0}),n=a.tolist();if(a.dispose(),this.vectorSize=n[0].length,this.maxTokens=(i=this.extractor.tokenizer.model_max_length)!=null?i:512,this.vectorSize===null||this.maxTokens===null)throw new Error("Failed to initialize model parameters");return{vectorSize:this.vectorSize,maxTokens:this.maxTokens}}async handleUnload(){this.extractor&&typeof this.extractor.dispose=="function"&&await this.extractor.dispose(),this.extractor=null}async handleEmbed(r){if(!this.extractor)throw new Error("Model not loaded");let t=this.extractor;return this.enqueue(async()=>{let s=await t(r,{pooling:"mean",normalize:!0}),o=s.tolist()[0];return s.dispose(),o})}async handleEmbedBatch(r){if(!this.extractor)throw new Error("Model not loaded");let t=this.extractor;return this.enqueue(async()=>{let s=await t(r,{pooling:"mean",normalize:!0}),o=s.tolist();return s.dispose(),o})}async handleCountToken(r){if(!this.extractor)throw new Error("Model not loaded");return this.extractor.tokenizer.encode(r).length}};mi(au);\n/*! Bundled license information:\n\nonnxruntime-web/dist/ort.bundle.min.mjs:\n  (*!\n   * ONNX Runtime Web v1.22.0-dev.20250409-89f8206ba4\n   * Copyright (c) Microsoft Corporation. All rights reserved.\n   * Licensed under the MIT License.\n   *)\n  (**\n   * @license\n   * Copyright 2021 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the "License");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an "AS IS" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   *)\n  (**\n   * @license\n   * Copyright 2020 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the "License");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an "AS IS" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   *)\n  (**\n   * @license\n   * Copyright 2019 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the "License");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an "AS IS" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   *)\n\n@huggingface/transformers/dist/transformers.web.js:\n  (*!*****************************!*\\\n    !*** ./src/transformers.js ***!\n    \\*****************************)\n\ncomlink/dist/esm/comlink.mjs:\n  (**\n   * @license\n   * Copyright 2019 Google LLC\n   * SPDX-License-Identifier: Apache-2.0\n   *)\n*/\n')}var cs=class{constructor(){this.modelId=null;this.vectorSize=null;this.maxTokens=null;this.modelBusy$=new Ue;this.downloadProgress$=new Ue;this.workerManager=new li("TransformersWorker")}async loadModel(e,r){let n=r?.useGPU??!0;us.default.info("Loading Transformers model",e,"with GPU:",n),await this.unloadModel();let o=await(await this.workerManager.initialize($p)).handleLoad(e,lo(s=>{this.downloadProgress$.next(s)}),n);return us.default.info("Transformers model loaded",o),this.modelId=e,this.vectorSize=o.vectorSize,this.maxTokens=o.maxTokens,{vectorSize:o.vectorSize,maxTokens:o.maxTokens}}async unloadModel(){if(this.workerManager.isInitialized()){try{await this.workerManager.getWorker().handleUnload()}catch(e){us.default.error("Error unloading Transformers model:",e)}this.modelId=null,this.vectorSize=null,this.maxTokens=null}}getModelBusy$(){return this.modelBusy$.asObservable()}getDownloadProgress$(){return this.downloadProgress$.asObservable()}async embedText(e){if(this.workerManager.ensureInitialized(),!this.modelId)throw new Error("Transformers model not loaded");this.modelBusy$.next(!0);try{return await this.workerManager.getWorker().handleEmbed(e)}finally{this.modelBusy$.next(!1)}}async embedTexts(e){if(this.workerManager.ensureInitialized(),!this.modelId)throw new Error("Transformers model not loaded");this.modelBusy$.next(!0);try{return await this.workerManager.getWorker().handleEmbedBatch(e)}finally{this.modelBusy$.next(!1)}}async countTokens(e){if(this.workerManager.ensureInitialized(),!this.modelId)throw new Error("Transformers model not loaded");return await this.workerManager.getWorker().handleCountToken(e)}getVectorSize(){if(!this.vectorSize)throw new Error("Transformers model not loaded");return this.vectorSize}getMaxTokens(){if(!this.maxTokens)throw new Error("Transformers model not loaded");return this.maxTokens}isModelLoaded(){return this.workerManager.isInitialized()&&this.modelId!==null}getCurrentModelId(){return this.modelId}dispose(){this.workerManager.isInitialized()&&this.workerManager.getWorker().handleUnload().catch(r=>{us.default.error("Error unloading Transformers model:",r)}).finally(()=>{this.workerManager.dispose()}),this.modelId=null,this.vectorSize=null,this.maxTokens=null}setLogLevel(e){this.workerManager.updateLogLevel(e)}};var tn=Z(Qe());var Cl=class{constructor(e){this.config=e;this.modelId=null;this.vectorSize=null;this.maxTokens=null;this.modelBusy$=new Ue;this.downloadProgress$=new Ue;this.ollamaClient=new Cn(e.url)}async loadModel(e,r){let n=r||this.config;tn.default.info("Loading Ollama model",e,"from",n.url),n.url!==this.config.url&&(this.ollamaClient.setBaseUrl(n.url),this.config.url=n.url);try{if(!await this.ollamaClient.testConnection())throw new Error(`Cannot connect to Ollama server at ${n.url}`);if(!await this.ollamaClient.testModel(e))throw new Error(`Model ${e} is not available on Ollama server`);let s=await this.ollamaClient.generateEmbedding(e,"test");return this.vectorSize=s.length,this.maxTokens=8192,this.modelId=e,this.config.model=e,tn.default.info("Ollama model loaded successfully",{modelId:e,vectorSize:this.vectorSize,maxTokens:this.maxTokens}),{vectorSize:this.vectorSize,maxTokens:this.maxTokens}}catch(i){throw tn.default.error("Failed to load Ollama model:",i),i}}async unloadModel(){this.modelId=null,this.vectorSize=null,this.maxTokens=null,tn.default.info("Ollama model unloaded")}getModelBusy$(){return this.modelBusy$.asObservable()}getDownloadProgress$(){return this.downloadProgress$.asObservable()}async embedText(e){if(!this.modelId)throw new Error("Ollama model not loaded");this.modelBusy$.next(!0);try{return await this.ollamaClient.generateEmbedding(this.modelId,e)}catch(r){throw tn.default.error("Failed to embed text with Ollama:",r),r}finally{this.modelBusy$.next(!1)}}async embedTexts(e){if(!this.modelId)throw new Error("Ollama model not loaded");this.modelBusy$.next(!0);try{let r=[];for(let n of e){let i=await this.ollamaClient.generateEmbedding(this.modelId,n);r.push(i)}return r}catch(r){throw tn.default.error("Failed to embed texts with Ollama:",r),r}finally{this.modelBusy$.next(!1)}}async countTokens(e){return Math.ceil(e.length/4)}getVectorSize(){if(!this.vectorSize)throw new Error("Ollama model not loaded");return this.vectorSize}getMaxTokens(){if(!this.maxTokens)throw new Error("Ollama model not loaded");return this.maxTokens}isModelLoaded(){return this.modelId!==null}getCurrentModelId(){return this.modelId}dispose(){this.unloadModel().catch(e=>{tn.default.error("Error during Ollama provider disposal:",e)})}updateConfig(e){e.url&&(this.config.url=e.url,this.ollamaClient.setBaseUrl(e.url)),e.model&&(this.config.model=e.model)}getConfig(){return{...this.config}}};var Il=class{constructor(){this.provider=null;this.currentProviderType=null;this.defaultModelBusy$=new Ue;this.defaultDownloadProgress$=new Ue}async switchProvider(e){let r=e.modelProvider;if(this.currentProviderType===r&&this.provider?.isModelLoaded()){let n=this.provider.getCurrentModelId(),i=r==="builtin"?e.modelId:e.ollamaModel;if(n===i)if(r==="builtin")In.default.info("Same model but GPU settings may have changed, continuing with provider switch");else{In.default.info("Same provider and model already loaded, skipping switch");return}}if(this.provider&&(In.default.info("Disposing current embedding provider:",this.currentProviderType),this.provider.dispose(),this.provider=null),r==="builtin")In.default.info("Switching to Transformers embedding provider"),this.provider=new cs,await this.loadModel(e.modelId,{useGPU:e.useGPU});else if(r==="ollama"){In.default.info("Switching to Ollama embedding provider");let n={url:e.ollamaUrl||"http://localhost:11434",model:e.ollamaModel||""};this.provider=new Cl(n),await this.loadModel(e.ollamaModel||"",n)}else throw new Error(`Unknown provider type: ${r}`);this.currentProviderType=r,In.default.info("Successfully switched to provider:",r)}async loadModel(e,r){if(!this.provider)throw new Error("No embedding provider initialized");return await this.provider.loadModel(e,r)}async unloadModel(){this.provider&&await this.provider.unloadModel()}getModelBusy$(){return this.provider?this.provider.getModelBusy$():this.defaultModelBusy$.asObservable()}getDownloadProgress$(){return this.provider?this.provider.getDownloadProgress$():this.defaultDownloadProgress$.asObservable()}async embedText(e){if(!this.provider)throw new Error("No embedding provider initialized");return await this.provider.embedText(e)}async embedTexts(e){if(!this.provider)throw new Error("No embedding provider initialized");return await this.provider.embedTexts(e)}async countTokens(e){if(!this.provider)throw new Error("No embedding provider initialized");return await this.provider.countTokens(e)}getVectorSize(){if(!this.provider)throw new Error("No embedding provider initialized");return this.provider.getVectorSize()}getMaxTokens(){if(!this.provider)throw new Error("No embedding provider initialized");return this.provider.getMaxTokens()}isModelLoaded(){return this.provider?.isModelLoaded()??!1}getCurrentModelId(){return this.provider?.getCurrentModelId()??null}getCurrentProviderType(){return this.currentProviderType}dispose(){this.provider&&(this.provider.dispose(),this.provider=null),this.currentProviderType=null}setLogLevel(e){this.provider instanceof cs&&this.provider.setLogLevel(e)}};var vy=Z(Qe());var Al=class{constructor(e,r,n,i,o){this.title=e;this.path=r;this.similarity=n;this.similarChunk=i;this.sourceChunk=o}};var $l=class{constructor(e,r,n){this.noteChunkRepository=e;this.noteChunkingService=r;this.modelService=n}async findSimilarNotes(e){if(!e.content)return[];let r=await this.noteChunkingService.split(e);if(r.length===0)return[];let n=await Promise.all(r.map(async u=>u.withEmbedding(await this.modelService.embedText(u.content)))),s=(await Promise.all(n.map(async({content:u,embedding:c})=>(await this.noteChunkRepository.findSimilarChunks(c,15,0,[e.path,...e.links])).map(p=>({...p,sourceChunk:u}))))).flat().reduce((u,c)=>((u[c.chunk.path]===void 0||u[c.chunk.path].score<c.score)&&(u[c.chunk.path]=c),u),{}),a=Object.values(s);return a.sort((u,c)=>c.score-u.score),vy.default.info("uniqueResultsArray",a),a.map(u=>new Al(u.chunk.title,u.chunk.path,u.score,u.chunk.content,u.sourceChunk)).slice(0,5)}};var Ol=Z(Qe());var Fl=class{constructor(e,r){this.vault=e;this.fileMtimePath=r;this.mtimes={};this.indexedNoteCount$=new Pn(0)}clear(){this.mtimes={},this.indexedNoteCount$.next(0),Ol.default.info("Cleared all stored modification times")}getMTime(e){return this.mtimes[e]}setMTime(e,r){let n=this.mtimes[e]===void 0;if(this.mtimes[e]=r,n){let i=this.indexedNoteCount$.getValue();this.indexedNoteCount$.next(i+1)}}deleteMTime(e){let r=this.mtimes[e]!==void 0;if(delete this.mtimes[e],r){let n=this.indexedNoteCount$.getValue();this.indexedNoteCount$.next(n-1)}}getAllPaths(){return Object.keys(this.mtimes)}async persist(){await this.vault.adapter.write(this.fileMtimePath,JSON.stringify(this.mtimes))}getIndexedNoteCount$(){return this.indexedNoteCount$}getCurrentIndexedNoteCount(){return this.indexedNoteCount$.getValue()}async restore(){if(!await this.vault.adapter.exists(this.fileMtimePath)){this.mtimes={};return}let r=await this.vault.adapter.read(this.fileMtimePath);try{this.mtimes=JSON.parse(r);let n=Object.keys(this.mtimes).length;this.indexedNoteCount$.next(n),Ol.default.info("Restored modification times for",n,"files")}catch(n){Ol.default.error("Failed to restore modification times:",n)}}};var Nl=class{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=e.pageContent!==void 0?e.pageContent.toString():"",this.metadata=e.metadata??{},this.id=e.id}};var K;(function(t){t.assertEqual=i=>i;function e(i){}t.assertIs=e;function r(i){throw new Error}t.assertNever=r,t.arrayToEnum=i=>{let o={};for(let s of i)o[s]=s;return o},t.getValidEnumValues=i=>{let o=t.objectKeys(i).filter(a=>typeof i[i[a]]!="number"),s={};for(let a of o)s[a]=i[a];return t.objectValues(s)},t.objectValues=i=>t.objectKeys(i).map(function(o){return i[o]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let o=[];for(let s in i)Object.prototype.hasOwnProperty.call(i,s)&&o.push(s);return o},t.find=(i,o)=>{for(let s of i)if(o(s))return s},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,o=" | "){return i.map(s=>typeof s=="string"?`'${s}'`:s).join(o)}t.joinValues=n,t.jsonStringifyReplacer=(i,o)=>typeof o=="bigint"?o.toString():o})(K||(K={}));var Fp;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(Fp||(Fp={}));var A=K.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),wr=t=>{switch(typeof t){case"undefined":return A.undefined;case"string":return A.string;case"number":return isNaN(t)?A.nan:A.number;case"boolean":return A.boolean;case"function":return A.function;case"bigint":return A.bigint;case"symbol":return A.symbol;case"object":return Array.isArray(t)?A.array:t===null?A.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?A.promise:typeof Map<"u"&&t instanceof Map?A.map:typeof Set<"u"&&t instanceof Set?A.set:typeof Date<"u"&&t instanceof Date?A.date:A.object;default:return A.unknown}},S=K.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),ES=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),pt=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(o){return o.message},n={_errors:[]},i=o=>{for(let s of o.issues)if(s.code==="invalid_union")s.unionErrors.map(i);else if(s.code==="invalid_return_type")i(s.returnTypeError);else if(s.code==="invalid_arguments")i(s.argumentsError);else if(s.path.length===0)n._errors.push(r(s));else{let a=n,l=0;for(;l<s.path.length;){let u=s.path[l];l===s.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(r(s))):a[u]=a[u]||{_errors:[]},a=a[u],l++}}};return i(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,K.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};pt.create=t=>new pt(t);var Hi=(t,e)=>{let r;switch(t.code){case S.invalid_type:t.received===A.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case S.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,K.jsonStringifyReplacer)}`;break;case S.unrecognized_keys:r=`Unrecognized key(s) in object: ${K.joinValues(t.keys,", ")}`;break;case S.invalid_union:r="Invalid input";break;case S.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${K.joinValues(t.options)}`;break;case S.invalid_enum_value:r=`Invalid enum value. Expected ${K.joinValues(t.options)}, received '${t.received}'`;break;case S.invalid_arguments:r="Invalid function arguments";break;case S.invalid_return_type:r="Invalid function return type";break;case S.invalid_date:r="Invalid date";break;case S.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:K.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case S.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case S.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case S.custom:r="Invalid input";break;case S.invalid_intersection_types:r="Intersection results could not be merged";break;case S.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case S.not_finite:r="Number must be finite";break;default:r=e.defaultError,K.assertNever(t)}return{message:r}},Ty=Hi;function PS(t){Ty=t}function Ll(){return Ty}var Rl=t=>{let{data:e,path:r,errorMaps:n,issueData:i}=t,o=[...r,...i.path||[]],s={...i,path:o};if(i.message!==void 0)return{...i,path:o,message:i.message};let a="",l=n.filter(u=>!!u).slice().reverse();for(let u of l)a=u(s,{data:e,defaultError:a}).message;return{...i,path:o,message:a}},CS=[];function P(t,e){let r=Ll(),n=Rl({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Hi?void 0:Hi].filter(i=>!!i)});t.common.issues.push(n)}var Oe=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let i of r){if(i.status==="aborted")return z;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let i of r){let o=await i.key,s=await i.value;n.push({key:o,value:s})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let i of r){let{key:o,value:s}=i;if(o.status==="aborted"||s.status==="aborted")return z;o.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),o.value!=="__proto__"&&(typeof s.value<"u"||i.alwaysSet)&&(n[o.value]=s.value)}return{status:e.value,value:n}}},z=Object.freeze({status:"aborted"}),qi=t=>({status:"dirty",value:t}),Ve=t=>({status:"valid",value:t}),Np=t=>t.status==="aborted",Lp=t=>t.status==="dirty",An=t=>t.status==="valid",fs=t=>typeof Promise<"u"&&t instanceof Promise;function Dl(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function My(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r}var N;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(N||(N={}));var ds,ps,Tt=class{constructor(e,r,n,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},by=(t,e)=>{if(An(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new pt(t.common.issues);return this._error=r,this._error}}};function B(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:i}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(s,a)=>{var l,u;let{message:c}=t;return s.code==="invalid_enum_value"?{message:c??a.defaultError}:typeof a.data>"u"?{message:(l=c??n)!==null&&l!==void 0?l:a.defaultError}:s.code!=="invalid_type"?{message:a.defaultError}:{message:(u=c??r)!==null&&u!==void 0?u:a.defaultError}},description:i}}var U=class{get description(){return this._def.description}_getType(e){return wr(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:wr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Oe,ctx:{common:e.parent.common,data:e.data,parsedType:wr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(fs(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;let i={common:{issues:[],async:(n=r?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:wr(e)},o=this._parseSync({data:e,path:i.path,parent:i});return by(i,o)}"~validate"(e){var r,n;let i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:wr(e)};if(!this["~standard"].async)try{let o=this._parseSync({data:e,path:[],parent:i});return An(o)?{value:o.value}:{issues:i.common.issues}}catch(o){!((n=(r=o?.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(o=>An(o)?{value:o.value}:{issues:i.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:wr(e)},i=this._parse({data:e,path:n.path,parent:n}),o=await(fs(i)?i:Promise.resolve(i));return by(n,o)}refine(e,r){let n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,o)=>{let s=e(i),a=()=>o.addIssue({code:S.custom,...n(i)});return typeof Promise<"u"&&s instanceof Promise?s.then(l=>l?!0:(a(),!1)):s?!0:(a(),!1)})}refinement(e,r){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(e){return new ft({schema:this,typeName:T.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return tt.create(this,this._def)}nullable(){return tr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return br.create(this)}promise(){return on.create(this,this._def)}or(e){return Dn.create([this,e],this._def)}and(e){return zn.create(this,e,this._def)}transform(e){return new ft({...B(this._def),schema:this,typeName:T.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Wn({...B(this._def),innerType:this,defaultValue:r,typeName:T.ZodDefault})}brand(){return new hs({typeName:T.ZodBranded,type:this,...B(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Gn({...B(this._def),innerType:this,catchValue:r,typeName:T.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return ms.create(this,e)}readonly(){return qn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},IS=/^c[^\s-]{8,}$/i,AS=/^[0-9a-z]+$/,$S=/^[0-9A-HJKMNP-TV-Z]{26}$/i,OS=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,FS=/^[a-z0-9_-]{21}$/i,NS=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,LS=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,RS=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,DS="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Op,zS=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,jS=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,BS=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,US=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,VS=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,WS=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ky="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",GS=new RegExp(`^${ky}$`);function Ey(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function qS(t){return new RegExp(`^${Ey(t)}$`)}function Py(t){let e=`${ky}T${Ey(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function HS(t,e){return!!((e==="v4"||!e)&&zS.test(t)||(e==="v6"||!e)&&BS.test(t))}function KS(t,e){if(!NS.test(t))return!1;try{let[r]=t.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||!i.typ||!i.alg||e&&i.alg!==e)}catch{return!1}}function QS(t,e){return!!((e==="v4"||!e)&&jS.test(t)||(e==="v6"||!e)&&US.test(t))}var rn=class t extends U{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==A.string){let o=this._getOrReturnCtx(e);return P(o,{code:S.invalid_type,expected:A.string,received:o.parsedType}),z}let n=new Oe,i;for(let o of this._def.checks)if(o.kind==="min")e.data.length<o.value&&(i=this._getOrReturnCtx(e,i),P(i,{code:S.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),n.dirty());else if(o.kind==="max")e.data.length>o.value&&(i=this._getOrReturnCtx(e,i),P(i,{code:S.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),n.dirty());else if(o.kind==="length"){let s=e.data.length>o.value,a=e.data.length<o.value;(s||a)&&(i=this._getOrReturnCtx(e,i),s?P(i,{code:S.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):a&&P(i,{code:S.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),n.dirty())}else if(o.kind==="email")RS.test(e.data)||(i=this._getOrReturnCtx(e,i),P(i,{validation:"email",code:S.invalid_string,message:o.message}),n.dirty());else if(o.kind==="emoji")Op||(Op=new RegExp(DS,"u")),Op.test(e.data)||(i=this._getOrReturnCtx(e,i),P(i,{validation:"emoji",code:S.invalid_string,message:o.message}),n.dirty());else if(o.kind==="uuid")OS.test(e.data)||(i=this._getOrReturnCtx(e,i),P(i,{validation:"uuid",code:S.invalid_string,message:o.message}),n.dirty());else if(o.kind==="nanoid")FS.test(e.data)||(i=this._getOrReturnCtx(e,i),P(i,{validation:"nanoid",code:S.invalid_string,message:o.message}),n.dirty());else if(o.kind==="cuid")IS.test(e.data)||(i=this._getOrReturnCtx(e,i),P(i,{validation:"cuid",code:S.invalid_string,message:o.message}),n.dirty());else if(o.kind==="cuid2")AS.test(e.data)||(i=this._getOrReturnCtx(e,i),P(i,{validation:"cuid2",code:S.invalid_string,message:o.message}),n.dirty());else if(o.kind==="ulid")$S.test(e.data)||(i=this._getOrReturnCtx(e,i),P(i,{validation:"ulid",code:S.invalid_string,message:o.message}),n.dirty());else if(o.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),P(i,{validation:"url",code:S.invalid_string,message:o.message}),n.dirty()}else o.kind==="regex"?(o.regex.lastIndex=0,o.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),P(i,{validation:"regex",code:S.invalid_string,message:o.message}),n.dirty())):o.kind==="trim"?e.data=e.data.trim():o.kind==="includes"?e.data.includes(o.value,o.position)||(i=this._getOrReturnCtx(e,i),P(i,{code:S.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),n.dirty()):o.kind==="toLowerCase"?e.data=e.data.toLowerCase():o.kind==="toUpperCase"?e.data=e.data.toUpperCase():o.kind==="startsWith"?e.data.startsWith(o.value)||(i=this._getOrReturnCtx(e,i),P(i,{code:S.invalid_string,validation:{startsWith:o.value},message:o.message}),n.dirty()):o.kind==="endsWith"?e.data.endsWith(o.value)||(i=this._getOrReturnCtx(e,i),P(i,{code:S.invalid_string,validation:{endsWith:o.value},message:o.message}),n.dirty()):o.kind==="datetime"?Py(o).test(e.data)||(i=this._getOrReturnCtx(e,i),P(i,{code:S.invalid_string,validation:"datetime",message:o.message}),n.dirty()):o.kind==="date"?GS.test(e.data)||(i=this._getOrReturnCtx(e,i),P(i,{code:S.invalid_string,validation:"date",message:o.message}),n.dirty()):o.kind==="time"?qS(o).test(e.data)||(i=this._getOrReturnCtx(e,i),P(i,{code:S.invalid_string,validation:"time",message:o.message}),n.dirty()):o.kind==="duration"?LS.test(e.data)||(i=this._getOrReturnCtx(e,i),P(i,{validation:"duration",code:S.invalid_string,message:o.message}),n.dirty()):o.kind==="ip"?HS(e.data,o.version)||(i=this._getOrReturnCtx(e,i),P(i,{validation:"ip",code:S.invalid_string,message:o.message}),n.dirty()):o.kind==="jwt"?KS(e.data,o.alg)||(i=this._getOrReturnCtx(e,i),P(i,{validation:"jwt",code:S.invalid_string,message:o.message}),n.dirty()):o.kind==="cidr"?QS(e.data,o.version)||(i=this._getOrReturnCtx(e,i),P(i,{validation:"cidr",code:S.invalid_string,message:o.message}),n.dirty()):o.kind==="base64"?VS.test(e.data)||(i=this._getOrReturnCtx(e,i),P(i,{validation:"base64",code:S.invalid_string,message:o.message}),n.dirty()):o.kind==="base64url"?WS.test(e.data)||(i=this._getOrReturnCtx(e,i),P(i,{validation:"base64url",code:S.invalid_string,message:o.message}),n.dirty()):K.assertNever(o);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(i=>e.test(i),{validation:r,code:S.invalid_string,...N.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...N.errToObj(e)})}url(e){return this._addCheck({kind:"url",...N.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...N.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...N.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...N.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...N.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...N.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...N.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...N.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...N.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...N.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...N.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...N.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(r=e?.offset)!==null&&r!==void 0?r:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...N.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...N.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...N.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...N.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...N.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...N.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...N.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...N.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...N.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...N.errToObj(r)})}nonempty(e){return this.min(1,N.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};rn.create=t=>{var e;return new rn({checks:[],typeName:T.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...B(t)})};function JS(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=r>n?r:n,o=parseInt(t.toFixed(i).replace(".","")),s=parseInt(e.toFixed(i).replace(".",""));return o%s/Math.pow(10,i)}var $n=class t extends U{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==A.number){let o=this._getOrReturnCtx(e);return P(o,{code:S.invalid_type,expected:A.number,received:o.parsedType}),z}let n,i=new Oe;for(let o of this._def.checks)o.kind==="int"?K.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),P(n,{code:S.invalid_type,expected:"integer",received:"float",message:o.message}),i.dirty()):o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(n=this._getOrReturnCtx(e,n),P(n,{code:S.too_small,minimum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),i.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(n=this._getOrReturnCtx(e,n),P(n,{code:S.too_big,maximum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),i.dirty()):o.kind==="multipleOf"?JS(e.data,o.value)!==0&&(n=this._getOrReturnCtx(e,n),P(n,{code:S.not_multiple_of,multipleOf:o.value,message:o.message}),i.dirty()):o.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),P(n,{code:S.not_finite,message:o.message}),i.dirty()):K.assertNever(o);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,N.toString(r))}gt(e,r){return this.setLimit("min",e,!1,N.toString(r))}lte(e,r){return this.setLimit("max",e,!0,N.toString(r))}lt(e,r){return this.setLimit("max",e,!1,N.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:N.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:N.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:N.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:N.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:N.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:N.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&K.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};$n.create=t=>new $n({checks:[],typeName:T.ZodNumber,coerce:t?.coerce||!1,...B(t)});var On=class t extends U{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==A.bigint)return this._getInvalidInput(e);let n,i=new Oe;for(let o of this._def.checks)o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(n=this._getOrReturnCtx(e,n),P(n,{code:S.too_small,type:"bigint",minimum:o.value,inclusive:o.inclusive,message:o.message}),i.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(n=this._getOrReturnCtx(e,n),P(n,{code:S.too_big,type:"bigint",maximum:o.value,inclusive:o.inclusive,message:o.message}),i.dirty()):o.kind==="multipleOf"?e.data%o.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),P(n,{code:S.not_multiple_of,multipleOf:o.value,message:o.message}),i.dirty()):K.assertNever(o);return{status:i.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return P(r,{code:S.invalid_type,expected:A.bigint,received:r.parsedType}),z}gte(e,r){return this.setLimit("min",e,!0,N.toString(r))}gt(e,r){return this.setLimit("min",e,!1,N.toString(r))}lte(e,r){return this.setLimit("max",e,!0,N.toString(r))}lt(e,r){return this.setLimit("max",e,!1,N.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:N.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:N.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};On.create=t=>{var e;return new On({checks:[],typeName:T.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...B(t)})};var Fn=class extends U{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==A.boolean){let n=this._getOrReturnCtx(e);return P(n,{code:S.invalid_type,expected:A.boolean,received:n.parsedType}),z}return Ve(e.data)}};Fn.create=t=>new Fn({typeName:T.ZodBoolean,coerce:t?.coerce||!1,...B(t)});var Nn=class t extends U{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==A.date){let o=this._getOrReturnCtx(e);return P(o,{code:S.invalid_type,expected:A.date,received:o.parsedType}),z}if(isNaN(e.data.getTime())){let o=this._getOrReturnCtx(e);return P(o,{code:S.invalid_date}),z}let n=new Oe,i;for(let o of this._def.checks)o.kind==="min"?e.data.getTime()<o.value&&(i=this._getOrReturnCtx(e,i),P(i,{code:S.too_small,message:o.message,inclusive:!0,exact:!1,minimum:o.value,type:"date"}),n.dirty()):o.kind==="max"?e.data.getTime()>o.value&&(i=this._getOrReturnCtx(e,i),P(i,{code:S.too_big,message:o.message,inclusive:!0,exact:!1,maximum:o.value,type:"date"}),n.dirty()):K.assertNever(o);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:N.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:N.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};Nn.create=t=>new Nn({checks:[],coerce:t?.coerce||!1,typeName:T.ZodDate,...B(t)});var Ki=class extends U{_parse(e){if(this._getType(e)!==A.symbol){let n=this._getOrReturnCtx(e);return P(n,{code:S.invalid_type,expected:A.symbol,received:n.parsedType}),z}return Ve(e.data)}};Ki.create=t=>new Ki({typeName:T.ZodSymbol,...B(t)});var Ln=class extends U{_parse(e){if(this._getType(e)!==A.undefined){let n=this._getOrReturnCtx(e);return P(n,{code:S.invalid_type,expected:A.undefined,received:n.parsedType}),z}return Ve(e.data)}};Ln.create=t=>new Ln({typeName:T.ZodUndefined,...B(t)});var Rn=class extends U{_parse(e){if(this._getType(e)!==A.null){let n=this._getOrReturnCtx(e);return P(n,{code:S.invalid_type,expected:A.null,received:n.parsedType}),z}return Ve(e.data)}};Rn.create=t=>new Rn({typeName:T.ZodNull,...B(t)});var nn=class extends U{constructor(){super(...arguments),this._any=!0}_parse(e){return Ve(e.data)}};nn.create=t=>new nn({typeName:T.ZodAny,...B(t)});var vr=class extends U{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ve(e.data)}};vr.create=t=>new vr({typeName:T.ZodUnknown,...B(t)});var Ut=class extends U{_parse(e){let r=this._getOrReturnCtx(e);return P(r,{code:S.invalid_type,expected:A.never,received:r.parsedType}),z}};Ut.create=t=>new Ut({typeName:T.ZodNever,...B(t)});var Qi=class extends U{_parse(e){if(this._getType(e)!==A.undefined){let n=this._getOrReturnCtx(e);return P(n,{code:S.invalid_type,expected:A.void,received:n.parsedType}),z}return Ve(e.data)}};Qi.create=t=>new Qi({typeName:T.ZodVoid,...B(t)});var br=class t extends U{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),i=this._def;if(r.parsedType!==A.array)return P(r,{code:S.invalid_type,expected:A.array,received:r.parsedType}),z;if(i.exactLength!==null){let s=r.data.length>i.exactLength.value,a=r.data.length<i.exactLength.value;(s||a)&&(P(r,{code:s?S.too_big:S.too_small,minimum:a?i.exactLength.value:void 0,maximum:s?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),n.dirty())}if(i.minLength!==null&&r.data.length<i.minLength.value&&(P(r,{code:S.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),n.dirty()),i.maxLength!==null&&r.data.length>i.maxLength.value&&(P(r,{code:S.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((s,a)=>i.type._parseAsync(new Tt(r,s,r.path,a)))).then(s=>Oe.mergeArray(n,s));let o=[...r.data].map((s,a)=>i.type._parseSync(new Tt(r,s,r.path,a)));return Oe.mergeArray(n,o)}get element(){return this._def.type}min(e,r){return new t({...this._def,minLength:{value:e,message:N.toString(r)}})}max(e,r){return new t({...this._def,maxLength:{value:e,message:N.toString(r)}})}length(e,r){return new t({...this._def,exactLength:{value:e,message:N.toString(r)}})}nonempty(e){return this.min(1,e)}};br.create=(t,e)=>new br({type:t,minLength:null,maxLength:null,exactLength:null,typeName:T.ZodArray,...B(e)});function Gi(t){if(t instanceof rt){let e={};for(let r in t.shape){let n=t.shape[r];e[r]=tt.create(Gi(n))}return new rt({...t._def,shape:()=>e})}else return t instanceof br?new br({...t._def,type:Gi(t.element)}):t instanceof tt?tt.create(Gi(t.unwrap())):t instanceof tr?tr.create(Gi(t.unwrap())):t instanceof er?er.create(t.items.map(e=>Gi(e))):t}var rt=class t extends U{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),r=K.objectKeys(e);return this._cached={shape:e,keys:r}}_parse(e){if(this._getType(e)!==A.object){let u=this._getOrReturnCtx(e);return P(u,{code:S.invalid_type,expected:A.object,received:u.parsedType}),z}let{status:n,ctx:i}=this._processInputParams(e),{shape:o,keys:s}=this._getCached(),a=[];if(!(this._def.catchall instanceof Ut&&this._def.unknownKeys==="strip"))for(let u in i.data)s.includes(u)||a.push(u);let l=[];for(let u of s){let c=o[u],d=i.data[u];l.push({key:{status:"valid",value:u},value:c._parse(new Tt(i,d,i.path,u)),alwaysSet:u in i.data})}if(this._def.catchall instanceof Ut){let u=this._def.unknownKeys;if(u==="passthrough")for(let c of a)l.push({key:{status:"valid",value:c},value:{status:"valid",value:i.data[c]}});else if(u==="strict")a.length>0&&(P(i,{code:S.unrecognized_keys,keys:a}),n.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let c of a){let d=i.data[c];l.push({key:{status:"valid",value:c},value:u._parse(new Tt(i,d,i.path,c)),alwaysSet:c in i.data})}}return i.common.async?Promise.resolve().then(async()=>{let u=[];for(let c of l){let d=await c.key,p=await c.value;u.push({key:d,value:p,alwaysSet:c.alwaysSet})}return u}).then(u=>Oe.mergeObjectSync(n,u)):Oe.mergeObjectSync(n,l)}get shape(){return this._def.shape()}strict(e){return N.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{var i,o,s,a;let l=(s=(o=(i=this._def).errorMap)===null||o===void 0?void 0:o.call(i,r,n).message)!==null&&s!==void 0?s:n.defaultError;return r.code==="unrecognized_keys"?{message:(a=N.errToObj(e).message)!==null&&a!==void 0?a:l}:{message:l}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:T.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let r={};return K.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(r[n]=this.shape[n])}),new t({...this._def,shape:()=>r})}omit(e){let r={};return K.objectKeys(this.shape).forEach(n=>{e[n]||(r[n]=this.shape[n])}),new t({...this._def,shape:()=>r})}deepPartial(){return Gi(this)}partial(e){let r={};return K.objectKeys(this.shape).forEach(n=>{let i=this.shape[n];e&&!e[n]?r[n]=i:r[n]=i.optional()}),new t({...this._def,shape:()=>r})}required(e){let r={};return K.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])r[n]=this.shape[n];else{let o=this.shape[n];for(;o instanceof tt;)o=o._def.innerType;r[n]=o}}),new t({...this._def,shape:()=>r})}keyof(){return Cy(K.objectKeys(this.shape))}};rt.create=(t,e)=>new rt({shape:()=>t,unknownKeys:"strip",catchall:Ut.create(),typeName:T.ZodObject,...B(e)});rt.strictCreate=(t,e)=>new rt({shape:()=>t,unknownKeys:"strict",catchall:Ut.create(),typeName:T.ZodObject,...B(e)});rt.lazycreate=(t,e)=>new rt({shape:t,unknownKeys:"strip",catchall:Ut.create(),typeName:T.ZodObject,...B(e)});var Dn=class extends U{_parse(e){let{ctx:r}=this._processInputParams(e),n=this._def.options;function i(o){for(let a of o)if(a.result.status==="valid")return a.result;for(let a of o)if(a.result.status==="dirty")return r.common.issues.push(...a.ctx.common.issues),a.result;let s=o.map(a=>new pt(a.ctx.common.issues));return P(r,{code:S.invalid_union,unionErrors:s}),z}if(r.common.async)return Promise.all(n.map(async o=>{let s={...r,common:{...r.common,issues:[]},parent:null};return{result:await o._parseAsync({data:r.data,path:r.path,parent:s}),ctx:s}})).then(i);{let o,s=[];for(let l of n){let u={...r,common:{...r.common,issues:[]},parent:null},c=l._parseSync({data:r.data,path:r.path,parent:u});if(c.status==="valid")return c;c.status==="dirty"&&!o&&(o={result:c,ctx:u}),u.common.issues.length&&s.push(u.common.issues)}if(o)return r.common.issues.push(...o.ctx.common.issues),o.result;let a=s.map(l=>new pt(l));return P(r,{code:S.invalid_union,unionErrors:a}),z}}get options(){return this._def.options}};Dn.create=(t,e)=>new Dn({options:t,typeName:T.ZodUnion,...B(e)});var yr=t=>t instanceof jn?yr(t.schema):t instanceof ft?yr(t.innerType()):t instanceof Bn?[t.value]:t instanceof Un?t.options:t instanceof Vn?K.objectValues(t.enum):t instanceof Wn?yr(t._def.innerType):t instanceof Ln?[void 0]:t instanceof Rn?[null]:t instanceof tt?[void 0,...yr(t.unwrap())]:t instanceof tr?[null,...yr(t.unwrap())]:t instanceof hs||t instanceof qn?yr(t.unwrap()):t instanceof Gn?yr(t._def.innerType):[],zl=class t extends U{_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==A.object)return P(r,{code:S.invalid_type,expected:A.object,received:r.parsedType}),z;let n=this.discriminator,i=r.data[n],o=this.optionsMap.get(i);return o?r.common.async?o._parseAsync({data:r.data,path:r.path,parent:r}):o._parseSync({data:r.data,path:r.path,parent:r}):(P(r,{code:S.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),z)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,n){let i=new Map;for(let o of r){let s=yr(o.shape[e]);if(!s.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of s){if(i.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);i.set(a,o)}}return new t({typeName:T.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:i,...B(n)})}};function Rp(t,e){let r=wr(t),n=wr(e);if(t===e)return{valid:!0,data:t};if(r===A.object&&n===A.object){let i=K.objectKeys(e),o=K.objectKeys(t).filter(a=>i.indexOf(a)!==-1),s={...t,...e};for(let a of o){let l=Rp(t[a],e[a]);if(!l.valid)return{valid:!1};s[a]=l.data}return{valid:!0,data:s}}else if(r===A.array&&n===A.array){if(t.length!==e.length)return{valid:!1};let i=[];for(let o=0;o<t.length;o++){let s=t[o],a=e[o],l=Rp(s,a);if(!l.valid)return{valid:!1};i.push(l.data)}return{valid:!0,data:i}}else return r===A.date&&n===A.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var zn=class extends U{_parse(e){let{status:r,ctx:n}=this._processInputParams(e),i=(o,s)=>{if(Np(o)||Np(s))return z;let a=Rp(o.value,s.value);return a.valid?((Lp(o)||Lp(s))&&r.dirty(),{status:r.value,value:a.data}):(P(n,{code:S.invalid_intersection_types}),z)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([o,s])=>i(o,s)):i(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};zn.create=(t,e,r)=>new zn({left:t,right:e,typeName:T.ZodIntersection,...B(r)});var er=class t extends U{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==A.array)return P(n,{code:S.invalid_type,expected:A.array,received:n.parsedType}),z;if(n.data.length<this._def.items.length)return P(n,{code:S.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),z;!this._def.rest&&n.data.length>this._def.items.length&&(P(n,{code:S.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let o=[...n.data].map((s,a)=>{let l=this._def.items[a]||this._def.rest;return l?l._parse(new Tt(n,s,n.path,a)):null}).filter(s=>!!s);return n.common.async?Promise.all(o).then(s=>Oe.mergeArray(r,s)):Oe.mergeArray(r,o)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};er.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new er({items:t,typeName:T.ZodTuple,rest:null,...B(e)})};var jl=class t extends U{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==A.object)return P(n,{code:S.invalid_type,expected:A.object,received:n.parsedType}),z;let i=[],o=this._def.keyType,s=this._def.valueType;for(let a in n.data)i.push({key:o._parse(new Tt(n,a,n.path,a)),value:s._parse(new Tt(n,n.data[a],n.path,a)),alwaysSet:a in n.data});return n.common.async?Oe.mergeObjectAsync(r,i):Oe.mergeObjectSync(r,i)}get element(){return this._def.valueType}static create(e,r,n){return r instanceof U?new t({keyType:e,valueType:r,typeName:T.ZodRecord,...B(n)}):new t({keyType:rn.create(),valueType:e,typeName:T.ZodRecord,...B(r)})}},Ji=class extends U{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==A.map)return P(n,{code:S.invalid_type,expected:A.map,received:n.parsedType}),z;let i=this._def.keyType,o=this._def.valueType,s=[...n.data.entries()].map(([a,l],u)=>({key:i._parse(new Tt(n,a,n.path,[u,"key"])),value:o._parse(new Tt(n,l,n.path,[u,"value"]))}));if(n.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let l of s){let u=await l.key,c=await l.value;if(u.status==="aborted"||c.status==="aborted")return z;(u.status==="dirty"||c.status==="dirty")&&r.dirty(),a.set(u.value,c.value)}return{status:r.value,value:a}})}else{let a=new Map;for(let l of s){let u=l.key,c=l.value;if(u.status==="aborted"||c.status==="aborted")return z;(u.status==="dirty"||c.status==="dirty")&&r.dirty(),a.set(u.value,c.value)}return{status:r.value,value:a}}}};Ji.create=(t,e,r)=>new Ji({valueType:e,keyType:t,typeName:T.ZodMap,...B(r)});var Xi=class t extends U{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==A.set)return P(n,{code:S.invalid_type,expected:A.set,received:n.parsedType}),z;let i=this._def;i.minSize!==null&&n.data.size<i.minSize.value&&(P(n,{code:S.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),r.dirty()),i.maxSize!==null&&n.data.size>i.maxSize.value&&(P(n,{code:S.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),r.dirty());let o=this._def.valueType;function s(l){let u=new Set;for(let c of l){if(c.status==="aborted")return z;c.status==="dirty"&&r.dirty(),u.add(c.value)}return{status:r.value,value:u}}let a=[...n.data.values()].map((l,u)=>o._parse(new Tt(n,l,n.path,u)));return n.common.async?Promise.all(a).then(l=>s(l)):s(a)}min(e,r){return new t({...this._def,minSize:{value:e,message:N.toString(r)}})}max(e,r){return new t({...this._def,maxSize:{value:e,message:N.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}};Xi.create=(t,e)=>new Xi({valueType:t,minSize:null,maxSize:null,typeName:T.ZodSet,...B(e)});var Bl=class t extends U{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==A.function)return P(r,{code:S.invalid_type,expected:A.function,received:r.parsedType}),z;function n(a,l){return Rl({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Ll(),Hi].filter(u=>!!u),issueData:{code:S.invalid_arguments,argumentsError:l}})}function i(a,l){return Rl({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Ll(),Hi].filter(u=>!!u),issueData:{code:S.invalid_return_type,returnTypeError:l}})}let o={errorMap:r.common.contextualErrorMap},s=r.data;if(this._def.returns instanceof on){let a=this;return Ve(async function(...l){let u=new pt([]),c=await a._def.args.parseAsync(l,o).catch(f=>{throw u.addIssue(n(l,f)),u}),d=await Reflect.apply(s,this,c);return await a._def.returns._def.type.parseAsync(d,o).catch(f=>{throw u.addIssue(i(d,f)),u})})}else{let a=this;return Ve(function(...l){let u=a._def.args.safeParse(l,o);if(!u.success)throw new pt([n(l,u.error)]);let c=Reflect.apply(s,this,u.data),d=a._def.returns.safeParse(c,o);if(!d.success)throw new pt([i(c,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:er.create(e).rest(vr.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,n){return new t({args:e||er.create([]).rest(vr.create()),returns:r||vr.create(),typeName:T.ZodFunction,...B(n)})}},jn=class extends U{get schema(){return this._def.getter()}_parse(e){let{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};jn.create=(t,e)=>new jn({getter:t,typeName:T.ZodLazy,...B(e)});var Bn=class extends U{_parse(e){if(e.data!==this._def.value){let r=this._getOrReturnCtx(e);return P(r,{received:r.data,code:S.invalid_literal,expected:this._def.value}),z}return{status:"valid",value:e.data}}get value(){return this._def.value}};Bn.create=(t,e)=>new Bn({value:t,typeName:T.ZodLiteral,...B(e)});function Cy(t,e){return new Un({values:t,typeName:T.ZodEnum,...B(e)})}var Un=class t extends U{constructor(){super(...arguments),ds.set(this,void 0)}_parse(e){if(typeof e.data!="string"){let r=this._getOrReturnCtx(e),n=this._def.values;return P(r,{expected:K.joinValues(n),received:r.parsedType,code:S.invalid_type}),z}if(Dl(this,ds,"f")||My(this,ds,new Set(this._def.values),"f"),!Dl(this,ds,"f").has(e.data)){let r=this._getOrReturnCtx(e),n=this._def.values;return P(r,{received:r.data,code:S.invalid_enum_value,options:n}),z}return Ve(e.data)}get options(){return this._def.values}get enum(){let e={};for(let r of this._def.values)e[r]=r;return e}get Values(){let e={};for(let r of this._def.values)e[r]=r;return e}get Enum(){let e={};for(let r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return t.create(e,{...this._def,...r})}exclude(e,r=this._def){return t.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}};ds=new WeakMap;Un.create=Cy;var Vn=class extends U{constructor(){super(...arguments),ps.set(this,void 0)}_parse(e){let r=K.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==A.string&&n.parsedType!==A.number){let i=K.objectValues(r);return P(n,{expected:K.joinValues(i),received:n.parsedType,code:S.invalid_type}),z}if(Dl(this,ps,"f")||My(this,ps,new Set(K.getValidEnumValues(this._def.values)),"f"),!Dl(this,ps,"f").has(e.data)){let i=K.objectValues(r);return P(n,{received:n.data,code:S.invalid_enum_value,options:i}),z}return Ve(e.data)}get enum(){return this._def.values}};ps=new WeakMap;Vn.create=(t,e)=>new Vn({values:t,typeName:T.ZodNativeEnum,...B(e)});var on=class extends U{unwrap(){return this._def.type}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==A.promise&&r.common.async===!1)return P(r,{code:S.invalid_type,expected:A.promise,received:r.parsedType}),z;let n=r.parsedType===A.promise?r.data:Promise.resolve(r.data);return Ve(n.then(i=>this._def.type.parseAsync(i,{path:r.path,errorMap:r.common.contextualErrorMap})))}};on.create=(t,e)=>new on({type:t,typeName:T.ZodPromise,...B(e)});var ft=class extends U{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===T.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:r,ctx:n}=this._processInputParams(e),i=this._def.effect||null,o={addIssue:s=>{P(n,s),s.fatal?r.abort():r.dirty()},get path(){return n.path}};if(o.addIssue=o.addIssue.bind(o),i.type==="preprocess"){let s=i.transform(n.data,o);if(n.common.async)return Promise.resolve(s).then(async a=>{if(r.value==="aborted")return z;let l=await this._def.schema._parseAsync({data:a,path:n.path,parent:n});return l.status==="aborted"?z:l.status==="dirty"||r.value==="dirty"?qi(l.value):l});{if(r.value==="aborted")return z;let a=this._def.schema._parseSync({data:s,path:n.path,parent:n});return a.status==="aborted"?z:a.status==="dirty"||r.value==="dirty"?qi(a.value):a}}if(i.type==="refinement"){let s=a=>{let l=i.refinement(a,o);if(n.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?z:(a.status==="dirty"&&r.dirty(),s(a.value),{status:r.value,value:a.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>a.status==="aborted"?z:(a.status==="dirty"&&r.dirty(),s(a.value).then(()=>({status:r.value,value:a.value}))))}if(i.type==="transform")if(n.common.async===!1){let s=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!An(s))return s;let a=i.transform(s.value,o);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:a}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(s=>An(s)?Promise.resolve(i.transform(s.value,o)).then(a=>({status:r.value,value:a})):s);K.assertNever(i)}};ft.create=(t,e,r)=>new ft({schema:t,typeName:T.ZodEffects,effect:e,...B(r)});ft.createWithPreprocess=(t,e,r)=>new ft({schema:e,effect:{type:"preprocess",transform:t},typeName:T.ZodEffects,...B(r)});var tt=class extends U{_parse(e){return this._getType(e)===A.undefined?Ve(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};tt.create=(t,e)=>new tt({innerType:t,typeName:T.ZodOptional,...B(e)});var tr=class extends U{_parse(e){return this._getType(e)===A.null?Ve(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};tr.create=(t,e)=>new tr({innerType:t,typeName:T.ZodNullable,...B(e)});var Wn=class extends U{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return r.parsedType===A.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};Wn.create=(t,e)=>new Wn({innerType:t,typeName:T.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...B(e)});var Gn=class extends U{_parse(e){let{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},i=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return fs(i)?i.then(o=>({status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new pt(n.common.issues)},input:n.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new pt(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Gn.create=(t,e)=>new Gn({innerType:t,typeName:T.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...B(e)});var Zi=class extends U{_parse(e){if(this._getType(e)!==A.nan){let n=this._getOrReturnCtx(e);return P(n,{code:S.invalid_type,expected:A.nan,received:n.parsedType}),z}return{status:"valid",value:e.data}}};Zi.create=t=>new Zi({typeName:T.ZodNaN,...B(t)});var XS=Symbol("zod_brand"),hs=class extends U{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}},ms=class t extends U{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let o=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?z:o.status==="dirty"?(r.dirty(),qi(o.value)):this._def.out._parseAsync({data:o.value,path:n.path,parent:n})})();{let i=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?z:i.status==="dirty"?(r.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:n.path,parent:n})}}static create(e,r){return new t({in:e,out:r,typeName:T.ZodPipeline})}},qn=class extends U{_parse(e){let r=this._def.innerType._parse(e),n=i=>(An(i)&&(i.value=Object.freeze(i.value)),i);return fs(r)?r.then(i=>n(i)):n(r)}unwrap(){return this._def.innerType}};qn.create=(t,e)=>new qn({innerType:t,typeName:T.ZodReadonly,...B(e)});function xy(t,e){let r=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof r=="string"?{message:r}:r}function Iy(t,e={},r){return t?nn.create().superRefine((n,i)=>{var o,s;let a=t(n);if(a instanceof Promise)return a.then(l=>{var u,c;if(!l){let d=xy(e,n),p=(c=(u=d.fatal)!==null&&u!==void 0?u:r)!==null&&c!==void 0?c:!0;i.addIssue({code:"custom",...d,fatal:p})}});if(!a){let l=xy(e,n),u=(s=(o=l.fatal)!==null&&o!==void 0?o:r)!==null&&s!==void 0?s:!0;i.addIssue({code:"custom",...l,fatal:u})}}):nn.create()}var ZS={object:rt.lazycreate},T;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(T||(T={}));var YS=(t,e={message:`Input not instance of ${t.name}`})=>Iy(r=>r instanceof t,e),Ay=rn.create,$y=$n.create,eT=Zi.create,tT=On.create,Oy=Fn.create,rT=Nn.create,nT=Ki.create,iT=Ln.create,oT=Rn.create,sT=nn.create,aT=vr.create,lT=Ut.create,uT=Qi.create,cT=br.create,dT=rt.create,pT=rt.strictCreate,fT=Dn.create,hT=zl.create,mT=zn.create,gT=er.create,_T=jl.create,yT=Ji.create,wT=Xi.create,vT=Bl.create,bT=jn.create,xT=Bn.create,ST=Un.create,TT=Vn.create,MT=on.create,Sy=ft.create,kT=tt.create,ET=tr.create,PT=ft.createWithPreprocess,CT=ms.create,IT=()=>Ay().optional(),AT=()=>$y().optional(),$T=()=>Oy().optional(),OT={string:t=>rn.create({...t,coerce:!0}),number:t=>$n.create({...t,coerce:!0}),boolean:t=>Fn.create({...t,coerce:!0}),bigint:t=>On.create({...t,coerce:!0}),date:t=>Nn.create({...t,coerce:!0})},FT=z,Yi=Object.freeze({__proto__:null,defaultErrorMap:Hi,setErrorMap:PS,getErrorMap:Ll,makeIssue:Rl,EMPTY_PATH:CS,addIssueToContext:P,ParseStatus:Oe,INVALID:z,DIRTY:qi,OK:Ve,isAborted:Np,isDirty:Lp,isValid:An,isAsync:fs,get util(){return K},get objectUtil(){return Fp},ZodParsedType:A,getParsedType:wr,ZodType:U,datetimeRegex:Py,ZodString:rn,ZodNumber:$n,ZodBigInt:On,ZodBoolean:Fn,ZodDate:Nn,ZodSymbol:Ki,ZodUndefined:Ln,ZodNull:Rn,ZodAny:nn,ZodUnknown:vr,ZodNever:Ut,ZodVoid:Qi,ZodArray:br,ZodObject:rt,ZodUnion:Dn,ZodDiscriminatedUnion:zl,ZodIntersection:zn,ZodTuple:er,ZodRecord:jl,ZodMap:Ji,ZodSet:Xi,ZodFunction:Bl,ZodLazy:jn,ZodLiteral:Bn,ZodEnum:Un,ZodNativeEnum:Vn,ZodPromise:on,ZodEffects:ft,ZodTransformer:ft,ZodOptional:tt,ZodNullable:tr,ZodDefault:Wn,ZodCatch:Gn,ZodNaN:Zi,BRAND:XS,ZodBranded:hs,ZodPipeline:ms,ZodReadonly:qn,custom:Iy,Schema:U,ZodSchema:U,late:ZS,get ZodFirstPartyTypeKind(){return T},coerce:OT,any:sT,array:cT,bigint:tT,boolean:Oy,date:rT,discriminatedUnion:hT,effect:Sy,enum:ST,function:vT,instanceof:YS,intersection:mT,lazy:bT,literal:xT,map:yT,nan:eT,nativeEnum:TT,never:lT,null:oT,nullable:ET,number:$y,object:dT,oboolean:$T,onumber:AT,optional:kT,ostring:IT,pipeline:CT,preprocess:PT,promise:MT,record:_T,set:wT,strictObject:pT,string:Ay,symbol:nT,transformer:Sy,tuple:gT,undefined:iT,union:fT,unknown:aT,void:uT,NEVER:FT,ZodIssueCode:S,quotelessJson:ES,ZodError:pt});var Qf=Z(Wl(),1);var jy=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function jT(t){return typeof t=="string"&&jy.test(t)}var sn=jT;var ke=[];for(Gl=0;Gl<256;++Gl)ke.push((Gl+256).toString(16).slice(1));var Gl;function By(t,e=0){return(ke[t[e+0]]+ke[t[e+1]]+ke[t[e+2]]+ke[t[e+3]]+"-"+ke[t[e+4]]+ke[t[e+5]]+"-"+ke[t[e+6]]+ke[t[e+7]]+"-"+ke[t[e+8]]+ke[t[e+9]]+"-"+ke[t[e+10]]+ke[t[e+11]]+ke[t[e+12]]+ke[t[e+13]]+ke[t[e+14]]+ke[t[e+15]]).toLowerCase()}var ql,BT=new Uint8Array(16);function Dp(){if(!ql&&(ql=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ql))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ql(BT)}var UT=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),zp={randomUUID:UT};function VT(t,e,r){if(zp.randomUUID&&!e&&!t)return zp.randomUUID();t=t||{};var n=t.random||(t.rng||Dp)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){r=r||0;for(var i=0;i<16;++i)e[r+i]=n[i];return e}return By(n)}var de=VT;var Xy=Z(Wl(),1),Yl=Z(Zl(),1);var ZT=(...t)=>fetch(...t),YT=Symbol.for("ls:fetch_implementation");var L=()=>globalThis[YT]??ZT;var eM=[400,401,403,404,405,406,407,408],tM=[409],_s=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in Yl.default?this.queue=new Yl.default.default({concurrency:this.maxConcurrency}):this.queue=new Yl.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...r){let n=this.onFailedResponseHook;return this.queue.add(()=>(0,Xy.default)(()=>e(...r).catch(i=>{throw i instanceof Error?i:new Error(i)}),{async onFailedAttempt(i){if(i.message.startsWith("Cancel")||i.message.startsWith("TimeoutError")||i.message.startsWith("AbortError")||i?.code==="ECONNABORTED")throw i;let o=i?.response,s=o?.status;if(s){if(eM.includes(+s))throw i;if(tM.includes(+s))return;n&&await n(o)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,r,...n){return e.signal?Promise.race([this.call(r,...n),new Promise((i,o)=>{e.signal?.addEventListener("abort",()=>{o(new Error("AbortError"))})})]):this.call(r,...n)}fetch(...e){return this.call(()=>L()(...e).then(r=>r.ok?r:Promise.reject(r)))}};function qp(t){return typeof t?._getType=="function"}function Hp(t){let e={type:t._getType(),data:{content:t.content}};return t?.additional_kwargs&&Object.keys(t.additional_kwargs).length>0&&(e.data.additional_kwargs={...t.additional_kwargs}),e}function V(t,e){if(!sn(t)){let r=e!==void 0?`Invalid UUID for ${e}: ${t}`:`Invalid UUID: ${t}`;throw new Error(r)}return t}var Zy={};function eu(t){Zy[t]||(console.warn(t),Zy[t]=!0)}var XE=Z(Bv(),1);function xr(t){if(!t||t.split("/").length>2||t.startsWith("/")||t.endsWith("/")||t.split(":").length>2)throw new Error(`Invalid identifier format: ${t}`);let[e,r]=t.split(":"),n=r||"latest";if(e.includes("/")){let[i,o]=e.split("/",2);if(!i||!o)throw new Error(`Invalid identifier format: ${t}`);return[i,o,n]}else{if(!e)throw new Error(`Invalid identifier format: ${t}`);return["-",e,n]}}var ff=class extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}};async function W(t,e,r){let n;if(t.ok){r&&(n=await t.text());return}n=await t.text();let i=`Failed to ${e}. Received status [${t.status}]: ${t.statusText}. Server response: ${n}`;throw t.status===409?new ff(i):new Error(i)}var Uv="[...]",ZE={result:"[Circular]"},hu=[],ro=[],YE=new TextEncoder;function eP(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function fu(t){return YE.encode(t)}function it(t,e,r,n){try{let i=JSON.stringify(t,e,r);return fu(i)}catch(i){if(!i.message?.includes("Converting circular structure to JSON"))return console.warn("[WARNING]: LangSmith received unserializable value."),fu("[Unserializable]");console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),typeof n>"u"&&(n=eP()),mf(t,"",0,[],void 0,0,n);let o;try{ro.length===0?o=JSON.stringify(t,e,r):o=JSON.stringify(t,tP(e),r)}catch{return fu("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;hu.length!==0;){let s=hu.pop();s.length===4?Object.defineProperty(s[0],s[1],s[3]):s[0][s[1]]=s[2]}}return fu(o)}}function hf(t,e,r,n){var i=Object.getOwnPropertyDescriptor(n,r);i.get!==void 0?i.configurable?(Object.defineProperty(n,r,{value:t}),hu.push([n,r,e,i])):ro.push([e,r,t]):(n[r]=t,hu.push([n,r,e]))}function mf(t,e,r,n,i,o,s){o+=1;var a;if(typeof t=="object"&&t!==null){for(a=0;a<n.length;a++)if(n[a]===t){hf(ZE,t,e,i);return}if(typeof s.depthLimit<"u"&&o>s.depthLimit){hf(Uv,t,e,i);return}if(typeof s.edgesLimit<"u"&&r+1>s.edgesLimit){hf(Uv,t,e,i);return}if(n.push(t),Array.isArray(t))for(a=0;a<t.length;a++)mf(t[a],a,a,n,t,o,s);else{var l=Object.keys(t);for(a=0;a<l.length;a++){var u=l[a];mf(t[u],u,a,n,t,o,s)}}n.pop()}}function tP(t){return t=typeof t<"u"?t:function(e,r){return r},function(e,r){if(ro.length>0)for(var n=0;n<ro.length;n++){var i=ro[n];if(i[1]===e&&i[0]===r){r=i[2],ro.splice(n,1);break}}return t.call(this,e,r)}}function Vv(t){let e=gu(),r=qv(),n=t.extra??{},i=n.metadata;return t.extra={...n,runtime:{...e,...n?.runtime},metadata:{...r,...r.revision_id||t.revision_id?{revision_id:t.revision_id??r.revision_id}:{},...i}},t}var rP=t=>{let e=t?.toString()??Vt("TRACING_SAMPLING_RATE");if(e===void 0)return;let r=parseFloat(e);if(r<0||r>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${r}`);return r},nP=t=>{let r=t.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return r==="localhost"||r==="127.0.0.1"||r==="::1"};async function iP(t){let e=[];for await(let r of t)e.push(r);return e}function gf(t){if(t!==void 0)return t.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}var oP=async t=>{if(t?.status===429){let e=parseInt(t.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(r=>setTimeout(r,e)),!0}return!1};function Wv(t){return typeof t=="number"?Number(t.toFixed(4)):t}var _f=class{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let r,n=new Promise(o=>{r=o}),i=it(e.item).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:r,itemPromise:n,size:i}),this.sizeBytes+=i,n}pop(e){if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");let r=[],n=0;for(;n+(this.peek()?.size??0)<e&&this.items.length>0;){let i=this.items.shift();i&&(r.push(i),n+=i.size,this.sizeBytes-=i.size)}if(r.length===0&&this.items.length>0){let i=this.items.shift();r.push(i),n+=i.size,this.sizeBytes-=i.size}return[r.map(i=>({action:i.action,item:i.payload})),()=>r.forEach(i=>i.itemPromiseResolve())]}},sP=20971520,aP=2500,Qn=class t{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new _f}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:Sr("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1});let r=t.getDefaultClientConfig();if(this.tracingSampleRate=rP(e.tracingSamplingRate),this.apiUrl=gf(e.apiUrl??r.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=gf(e.apiKey??r.apiKey),this.webUrl=gf(e.webUrl??r.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new _s(e.callerOptions??{}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.batchIngestCaller=new _s({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:oP}),this.hideInputs=e.hideInputs??e.anonymizer??r.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??r.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode}static getDefaultClientConfig(){let e=Vt("API_KEY"),r=Vt("ENDPOINT")??"https://api.smith.langchain.com",n=Vt("HIDE_INPUTS")==="true",i=Vt("HIDE_OUTPUTS")==="true";return{apiUrl:r,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:i}}getHostUrl(){return this.webUrl?this.webUrl:nP(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){let e={"User-Agent":`langsmith-js/${mu}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){let r={...e};return r.inputs!==void 0&&(r.inputs=this.processInputs(r.inputs)),r.outputs!==void 0&&(r.outputs=this.processOutputs(r.outputs)),r}async _getResponse(e,r){let n=r?.toString()??"",i=`${this.apiUrl}${e}?${n}`,o=await this.caller.call(L(),i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(o,`Failed to fetch ${e}`),o}async _get(e,r){return(await this._getResponse(e,r)).json()}async*_getPaginated(e,r=new URLSearchParams,n){let i=Number(r.get("offset"))||0,o=Number(r.get("limit"))||100;for(;;){r.set("offset",String(i)),r.set("limit",String(o));let s=`${this.apiUrl}${e}?${r}`,a=await this.caller.call(L(),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(a,`Failed to fetch ${e}`);let l=n?n(await a.json()):await a.json();if(l.length===0||(yield l,l.length<o))break;i+=l.length}}async*_getCursorPaginatedList(e,r=null,n="POST",i="runs"){let o=r?{...r}:{};for(;;){let a=await(await this.caller.call(L(),`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(o)})).json();if(!a||!a[i])break;yield a[i];let l=a.cursors;if(!l||!l.next)break;o.cursor=l.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,r=!1){if(this.tracingSampleRate===void 0)return e;if(r){let n=[];for(let i of e)this.filteredPostUuids.has(i.id)?this.filteredPostUuids.delete(i.id):n.push(i);return n}else{let n=[];for(let i of e){let o=i.trace_id??i.id;this.filteredPostUuids.has(o)||(i.id===o?this._shouldSample()?n.push(i):this.filteredPostUuids.add(o):n.push(i))}return n}}async _getBatchSizeLimitBytes(){let e=await this._ensureServerInfo();return this.batchSizeBytesLimit??e.batch_ingest_config?.size_limit_bytes??sP}async _getMultiPartSupport(){return(await this._ensureServerInfo()).instance_flags?.dataset_examples_multipart_enabled??!1}drainAutoBatchQueue(e){let r=[];for(;this.autoBatchQueue.items.length>0;){let[n,i]=this.autoBatchQueue.pop(e);if(!n.length){i();break}let o=this._processBatch(n,i).catch(console.error);r.push(o)}return Promise.all(r)}async _processBatch(e,r){if(!e.length){r();return}try{let n={runCreates:e.filter(o=>o.action==="create").map(o=>o.item),runUpdates:e.filter(o=>o.action==="update").map(o=>o.item)};(await this._ensureServerInfo())?.batch_ingest_config?.use_multipart_endpoint?await this.multipartIngestRuns(n):await this.batchIngestRuns(n)}finally{r()}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=Vv(e.item));let r=this.autoBatchQueue.push(e);if(this.manualFlushMode)return r;let n=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>n&&this.drainAutoBatchQueue(n),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(n)},this.autoBatchAggregationDelayMs)),r}async _getServerInfo(){let e=await L()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(aP),...this.fetchOptions});return await W(e,"get server info"),e.json()}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch{console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to batch operations and default limits.")}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){let e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}async createRun(e){if(!this._filterForSampling([e]).length)return;let r={...this.headers,"Content-Type":"application/json"},n=e.project_name;delete e.project_name;let i=this.prepareRunCreateOrUpdateInputs({session_name:n,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&i.trace_id!==void 0&&i.dotted_order!==void 0){this.processRunOperation({action:"create",item:i}).catch(console.error);return}let o=Vv(i),s=await this.caller.call(L(),`${this.apiUrl}/runs`,{method:"POST",headers:r,body:it(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(s,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:r}){if(e===void 0&&r===void 0)return;let n=e?.map(a=>this.prepareRunCreateOrUpdateInputs(a))??[],i=r?.map(a=>this.prepareRunCreateOrUpdateInputs(a))??[];if(n.length>0&&i.length>0){let a=n.reduce((u,c)=>(c.id&&(u[c.id]=c),u),{}),l=[];for(let u of i)u.id!==void 0&&a[u.id]?a[u.id]={...a[u.id],...u}:l.push(u);n=Object.values(a),i=l}let o={post:n,patch:i};if(!o.post.length&&!o.patch.length)return;let s={post:[],patch:[]};for(let a of["post","patch"]){let l=a,u=o[l].reverse(),c=u.pop();for(;c!==void 0;)s[l].push(c),c=u.pop()}(s.post.length>0||s.patch.length>0)&&await this._postBatchIngestRuns(it(s))}async _postBatchIngestRuns(e){let r={...this.headers,"Content-Type":"application/json",Accept:"application/json"},n=await this.batchIngestCaller.call(L(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:r,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(n,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:r}){if(e===void 0&&r===void 0)return;let n={},i=[];for(let c of e??[]){let d=this.prepareRunCreateOrUpdateInputs(c);d.id!==void 0&&d.attachments!==void 0&&(n[d.id]=d.attachments),delete d.attachments,i.push(d)}let o=[];for(let c of r??[])o.push(this.prepareRunCreateOrUpdateInputs(c));if(i.find(c=>c.trace_id===void 0||c.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(o.find(c=>c.trace_id===void 0||c.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(i.length>0&&o.length>0){let c=i.reduce((p,f)=>(f.id&&(p[f.id]=f),p),{}),d=[];for(let p of o)p.id!==void 0&&c[p.id]?c[p.id]={...c[p.id],...p}:d.push(p);i=Object.values(c),o=d}if(i.length===0&&o.length===0)return;let l=[],u=[];for(let[c,d]of[["post",i],["patch",o]])for(let p of d){let{inputs:f,outputs:_,events:w,attachments:b,...m}=p,h={inputs:f,outputs:_,events:w},g=it(m);u.push({name:`${c}.${m.id}`,payload:new Blob([g],{type:`application/json; length=${g.length}`})});for(let[y,v]of Object.entries(h)){if(v===void 0)continue;let x=it(v);u.push({name:`${c}.${m.id}.${y}`,payload:new Blob([x],{type:`application/json; length=${x.length}`})})}if(m.id!==void 0){let y=n[m.id];if(y){delete n[m.id];for(let[v,x]of Object.entries(y)){let k,E;if(Array.isArray(x)?[k,E]=x:(k=x.mimeType,E=x.data),v.includes(".")){console.warn(`Skipping attachment '${v}' for run ${m.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}u.push({name:`attachment.${m.id}.${v}`,payload:new Blob([E],{type:`${k}; length=${E.byteLength}`})})}}}l.push(`trace=${m.trace_id},id=${m.id}`)}await this._sendMultipartRequest(u,l.join("; "))}async _sendMultipartRequest(e,r){try{let n="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),i=[];for(let l of e)i.push(new Blob([`--${n}\r
`])),i.push(new Blob([`Content-Disposition: form-data; name="${l.name}"\r
`,`Content-Type: ${l.payload.type}\r
\r
`])),i.push(l.payload),i.push(new Blob([`\r
`]));i.push(new Blob([`--${n}--\r
`]));let s=await new Blob(i).arrayBuffer(),a=await this.batchIngestCaller.call(L(),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers,"Content-Type":`multipart/form-data; boundary=${n}`},body:s,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(a,"ingest multipart runs",!0)}catch(n){console.warn(`${n.message.trim()}

Context: ${r}`)}}async updateRun(e,r){V(e),r.inputs&&(r.inputs=this.processInputs(r.inputs)),r.outputs&&(r.outputs=this.processOutputs(r.outputs));let n={...r,id:e};if(!this._filterForSampling([n],!0).length)return;if(this.autoBatchTracing&&n.trace_id!==void 0&&n.dotted_order!==void 0){if(r.end_time!==void 0&&n.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:n}).catch(console.error);return}else this.processRunOperation({action:"update",item:n}).catch(console.error);return}let i={...this.headers,"Content-Type":"application/json"},o=await this.caller.call(L(),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:i,body:it(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(o,"update run",!0)}async readRun(e,{loadChildRuns:r}={loadChildRuns:!1}){V(e);let n=await this._get(`/runs/${e}`);return r&&n.child_run_ids&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:r,projectOpts:n}){if(r!==void 0){let i;r.session_id?i=r.session_id:n?.projectName?i=(await this.readProject({projectName:n?.projectName})).id:n?.projectId?i=n?.projectId:i=(await this.readProject({projectName:Vt("PROJECT")||"default"})).id;let o=await this._getTenantId();return`${this.getHostUrl()}/o/${o}/projects/p/${i}/r/${r.id}?poll=true`}else if(e!==void 0){let i=await this.readRun(e);if(!i.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${i.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){let r=await iP(this.listRuns({id:e.child_run_ids})),n={},i={};r.sort((o,s)=>(o?.dotted_order??"").localeCompare(s?.dotted_order??""));for(let o of r){if(o.parent_run_id===null||o.parent_run_id===void 0)throw new Error(`Child run ${o.id} has no parent`);o.parent_run_id in n||(n[o.parent_run_id]=[]),n[o.parent_run_id].push(o),i[o.id]=o}e.child_runs=n[e.id]||[];for(let o in n)o!==e.id&&(i[o].child_runs=n[o]);return e}async*listRuns(e){let{projectId:r,projectName:n,parentRunId:i,traceId:o,referenceExampleId:s,startTime:a,executionOrder:l,isRoot:u,runType:c,error:d,id:p,query:f,filter:_,traceFilter:w,treeFilter:b,limit:m,select:h}=e,g=[];if(r&&(g=Array.isArray(r)?r:[r]),n){let k=Array.isArray(n)?n:[n],E=await Promise.all(k.map(H=>this.readProject({projectName:H}).then(C=>C.id)));g.push(...E)}let y=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],v={session:g.length?g:null,run_type:c,reference_example:s,query:f,filter:_,trace_filter:w,tree_filter:b,execution_order:l,parent_run:i,start_time:a?a.toISOString():null,error:d,id:p,limit:m,trace:o,select:h||y,is_root:u},x=0;for await(let k of this._getCursorPaginatedList("/runs/query",v))if(m){if(x>=m)break;if(k.length+x>m){yield*k.slice(0,m-x);break}x+=k.length,yield*k}else yield*k}async getRunStats({id:e,trace:r,parentRun:n,runType:i,projectNames:o,projectIds:s,referenceExampleIds:a,startTime:l,endTime:u,error:c,query:d,filter:p,traceFilter:f,treeFilter:_,isRoot:w,dataSourceType:b}){let m=s||[];o&&(m=[...s||[],...await Promise.all(o.map(x=>this.readProject({projectName:x}).then(k=>k.id)))]);let g=Object.fromEntries(Object.entries({id:e,trace:r,parent_run:n,run_type:i,session:m,reference_example:a,start_time:l,end_time:u,error:c,query:d,filter:p,trace_filter:f,tree_filter:_,is_root:w,data_source_type:b}).filter(([x,k])=>k!==void 0));return await(await this.caller.call(L(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(g),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:r}={}){let n={run_id:e,share_token:r||de()};V(e);let o=await(await this.caller.call(L(),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(o===null||!("share_token"in o))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${o.share_token}/r`}async unshareRun(e){V(e);let r=await this.caller.call(L(),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(r,"unshare run",!0)}async readRunSharedLink(e){V(e);let n=await(await this.caller.call(L(),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(n===null||!("share_token"in n)))return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e,{runIds:r}={}){let n=new URLSearchParams({share_token:e});if(r!==void 0)for(let s of r)n.append("id",s);return V(e),await(await this.caller.call(L(),`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,r){if(!e&&!r)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:r})).id),V(e);let i=await(await this.caller.call(L(),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async shareDataset(e,r){if(!e&&!r)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:r})).id);let n={dataset_id:e};V(e);let o=await(await this.caller.call(L(),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return o.url=`${this.getHostUrl()}/public/${o.share_token}/d`,o}async unshareDataset(e){V(e);let r=await this.caller.call(L(),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(r,"unshare dataset",!0)}async readSharedDataset(e){return V(e),await(await this.caller.call(L(),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,r){let n={};r?.exampleIds&&(n.id=r.exampleIds);let i=new URLSearchParams;Object.entries(n).forEach(([a,l])=>{Array.isArray(l)?l.forEach(u=>i.append(a,u)):i.append(a,l)});let o=await this.caller.call(L(),`${this.apiUrl}/public/${e}/examples?${i.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),s=await o.json();if(!o.ok)throw"detail"in s?new Error(`Failed to list shared examples.
Status: ${o.status}
Message: ${s.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${o.status} ${o.statusText}`);return s.map(a=>({...a,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:r=null,metadata:n=null,upsert:i=!1,projectExtra:o=null,referenceDatasetId:s=null}){let a=i?"?upsert=true":"",l=`${this.apiUrl}/sessions${a}`,u=o||{};n&&(u.metadata=n);let c={name:e,extra:u,description:r};s!==null&&(c.reference_dataset_id=s);let d=await this.caller.call(L(),l,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(d,"create project"),await d.json()}async updateProject(e,{name:r=null,description:n=null,metadata:i=null,projectExtra:o=null,endTime:s=null}){let a=`${this.apiUrl}/sessions/${e}`,l=o;i&&(l={...l||{},metadata:i});let u={name:r,extra:l,description:n,end_time:s?new Date(s).toISOString():null},c=await this.caller.call(L(),a,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(c,"update project"),await c.json()}async hasProject({projectId:e,projectName:r}){let n="/sessions",i=new URLSearchParams;if(e!==void 0&&r!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)V(e),n+=`/${e}`;else if(r!==void 0)i.append("name",r);else throw new Error("Must provide projectName or projectId");let o=await this.caller.call(L(),`${this.apiUrl}${n}?${i}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{let s=await o.json();return o.ok?Array.isArray(s)?s.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:r,includeStats:n}){let i="/sessions",o=new URLSearchParams;if(e!==void 0&&r!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)V(e),i+=`/${e}`;else if(r!==void 0)o.append("name",r);else throw new Error("Must provide projectName or projectId");n!==void 0&&o.append("include_stats",n.toString());let s=await this._get(i,o),a;if(Array.isArray(s)){if(s.length===0)throw new Error(`Project[id=${e}, name=${r}] not found`);a=s[0]}else a=s;return a}async getProjectUrl({projectId:e,projectName:r}){if(e===void 0&&r===void 0)throw new Error("Must provide either projectName or projectId");let n=await this.readProject({projectId:e,projectName:r}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${n.id}`}async getDatasetUrl({datasetId:e,datasetName:r}){if(e===void 0&&r===void 0)throw new Error("Must provide either datasetName or datasetId");let n=await this.readDataset({datasetId:e,datasetName:r}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/datasets/${n.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let r of this._getPaginated("/sessions",e))return this._tenantId=r[0].tenant_id,r[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:r,nameContains:n,referenceDatasetId:i,referenceDatasetName:o,referenceFree:s,metadata:a}={}){let l=new URLSearchParams;if(e!==void 0)for(let u of e)l.append("id",u);if(r!==void 0&&l.append("name",r),n!==void 0&&l.append("name_contains",n),i!==void 0)l.append("reference_dataset",i);else if(o!==void 0){let u=await this.readDataset({datasetName:o});l.append("reference_dataset",u.id)}s!==void 0&&l.append("reference_free",s.toString()),a!==void 0&&l.append("metadata",JSON.stringify(a));for await(let u of this._getPaginated("/sessions",l))yield*u}async deleteProject({projectId:e,projectName:r}){let n;if(e===void 0&&r===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&r!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?n=(await this.readProject({projectName:r})).id:n=e,V(n);let i=await this.caller.call(L(),`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(i,`delete session ${n} (${r})`,!0)}async uploadCsv({csvFile:e,fileName:r,inputKeys:n,outputKeys:i,description:o,dataType:s,name:a}){let l=`${this.apiUrl}/datasets/upload`,u=new FormData;u.append("file",e,r),n.forEach(p=>{u.append("input_keys",p)}),i.forEach(p=>{u.append("output_keys",p)}),o&&u.append("description",o),s&&u.append("data_type",s),a&&u.append("name",a);let c=await this.caller.call(L(),l,{method:"POST",headers:this.headers,body:u,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(c,"upload CSV"),await c.json()}async createDataset(e,{description:r,dataType:n,inputsSchema:i,outputsSchema:o,metadata:s}={}){let a={name:e,description:r,extra:s?{metadata:s}:void 0};n&&(a.data_type=n),i&&(a.inputs_schema_definition=i),o&&(a.outputs_schema_definition=o);let l=await this.caller.call(L(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(l,"create dataset"),await l.json()}async readDataset({datasetId:e,datasetName:r}){let n="/datasets",i=new URLSearchParams({limit:"1"});if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)V(e),n+=`/${e}`;else if(r!==void 0)i.append("name",r);else throw new Error("Must provide datasetName or datasetId");let o=await this._get(n,i),s;if(Array.isArray(o)){if(o.length===0)throw new Error(`Dataset[id=${e}, name=${r}] not found`);s=o[0]}else s=o;return s}async hasDataset({datasetId:e,datasetName:r}){try{return await this.readDataset({datasetId:e,datasetName:r}),!0}catch(n){if(n instanceof Error&&n.message.toLocaleLowerCase().includes("not found"))return!1;throw n}}async diffDatasetVersions({datasetId:e,datasetName:r,fromVersion:n,toVersion:i}){let o=e;if(o===void 0&&r===void 0)throw new Error("Must provide either datasetName or datasetId");if(o!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");o===void 0&&(o=(await this.readDataset({datasetName:r})).id);let s=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof i=="string"?i:i.toISOString()});return await this._get(`/datasets/${o}/versions/diff`,s)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:r}){let n="/datasets";if(e===void 0)if(r!==void 0)e=(await this.readDataset({datasetName:r})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${n}/${e}/openai_ft`)).text()).trim().split(`
`).map(a=>JSON.parse(a))}async*listDatasets({limit:e=100,offset:r=0,datasetIds:n,datasetName:i,datasetNameContains:o,metadata:s}={}){let a="/datasets",l=new URLSearchParams({limit:e.toString(),offset:r.toString()});if(n!==void 0)for(let u of n)l.append("id",u);i!==void 0&&l.append("name",i),o!==void 0&&l.append("name_contains",o),s!==void 0&&l.append("metadata",JSON.stringify(s));for await(let u of this._getPaginated(a,l))yield*u}async updateDataset(e){let{datasetId:r,datasetName:n,...i}=e;if(!r&&!n)throw new Error("Must provide either datasetName or datasetId");let o=r??(await this.readDataset({datasetName:n})).id;V(o);let s=await this.caller.call(L(),`${this.apiUrl}/datasets/${o}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(s,"update dataset"),await s.json()}async updateDatasetTag(e){let{datasetId:r,datasetName:n,asOf:i,tag:o}=e;if(!r&&!n)throw new Error("Must provide either datasetName or datasetId");let s=r??(await this.readDataset({datasetName:n})).id;V(s);let a=await this.caller.call(L(),`${this.apiUrl}/datasets/${s}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:typeof i=="string"?i:i.toISOString(),tag:o}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(a,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:r}){let n="/datasets",i=e;if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(r!==void 0&&(i=(await this.readDataset({datasetName:r})).id),i!==void 0)V(i),n+=`/${i}`;else throw new Error("Must provide datasetName or datasetId");let o=await this.caller.call(L(),this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(o,`delete ${n}`),await o.json()}async indexDataset({datasetId:e,datasetName:r,tag:n}){let i=e;if(!i&&!r)throw new Error("Must provide either datasetName or datasetId");if(i&&r)throw new Error("Must provide either datasetName or datasetId, not both");i||(i=(await this.readDataset({datasetName:r})).id),V(i);let o={tag:n},s=await this.caller.call(L(),`${this.apiUrl}/datasets/${i}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(s,"index dataset"),await s.json()}async similarExamples(e,r,n,{filter:i}={}){let o={limit:n,inputs:e};i!==void 0&&(o.filter=i),V(r);let s=await this.caller.call(L(),`${this.apiUrl}/datasets/${r}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(s,"fetch similar examples"),(await s.json()).examples}async createExample(e,r,n){if(Gv(e)&&(r!==void 0||n!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let i=r?n?.datasetId:e.dataset_id,o=r?n?.datasetName:e.dataset_name;if(i===void 0&&o===void 0)throw new Error("Must provide either datasetName or datasetId");if(i!==void 0&&o!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");i===void 0&&(i=(await this.readDataset({datasetName:o})).id);let s=(r?n?.createdAt:e.created_at)||new Date,a;Gv(e)?a=e:a={inputs:e,outputs:r,created_at:s?.toISOString(),id:n?.exampleId,metadata:n?.metadata,split:n?.split,source_run_id:n?.sourceRunId,use_source_run_io:n?.useSourceRunIO,use_source_run_attachments:n?.useSourceRunAttachments,attachments:n?.attachments};let l=await this._uploadExamplesMultipart(i,[a]);return await this.readExample(l.example_ids?.[0]??de())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];let h=e,g=h[0].dataset_id,y=h[0].dataset_name;if(g===void 0&&y===void 0)throw new Error("Must provide either datasetName or datasetId");if(g!==void 0&&y!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");g===void 0&&(g=(await this.readDataset({datasetName:y})).id);let v=await this._uploadExamplesMultipart(g,h);return await Promise.all(v.example_ids.map(k=>this.readExample(k)))}let{inputs:r,outputs:n,metadata:i,splits:o,sourceRunIds:s,useSourceRunIOs:a,useSourceRunAttachments:l,attachments:u,exampleIds:c,datasetId:d,datasetName:p}=e;if(r===void 0)throw new Error("Must provide inputs when using legacy parameters");let f=d,_=p;if(f===void 0&&_===void 0)throw new Error("Must provide either datasetName or datasetId");if(f!==void 0&&_!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");f===void 0&&(f=(await this.readDataset({datasetName:_})).id);let w=r.map((h,g)=>({dataset_id:f,inputs:h,outputs:n?.[g],metadata:i?.[g],split:o?.[g],id:c?.[g],attachments:u?.[g],source_run_id:s?.[g],use_source_run_io:a?.[g],use_source_run_attachments:l?.[g]})),b=await this._uploadExamplesMultipart(f,w);return await Promise.all(b.example_ids.map(h=>this.readExample(h)))}async createLLMExample(e,r,n){return this.createExample({input:e},{output:r},n)}async createChatExample(e,r,n){let i=e.map(s=>qp(s)?Hp(s):s),o=qp(r)?Hp(r):r;return this.createExample({input:i},{output:o},n)}async readExample(e){V(e);let r=`/examples/${e}`,n=await this._get(r),{attachment_urls:i,...o}=n,s=o;return i&&(s.attachments=Object.entries(i).reduce((a,[l,u])=>(a[l.slice(11)]={presigned_url:u.presigned_url,mime_type:u.mime_type},a),{})),s}async*listExamples({datasetId:e,datasetName:r,exampleIds:n,asOf:i,splits:o,inlineS3Urls:s,metadata:a,limit:l,offset:u,filter:c,includeAttachments:d}={}){let p;if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)p=e;else if(r!==void 0)p=(await this.readDataset({datasetName:r})).id;else throw new Error("Must provide a datasetName or datasetId");let f=new URLSearchParams({dataset:p}),_=i?typeof i=="string"?i:i?.toISOString():void 0;_&&f.append("as_of",_);let w=s??!0;if(f.append("inline_s3_urls",w.toString()),n!==void 0)for(let m of n)f.append("id",m);if(o!==void 0)for(let m of o)f.append("splits",m);if(a!==void 0){let m=JSON.stringify(a);f.append("metadata",m)}l!==void 0&&f.append("limit",l.toString()),u!==void 0&&f.append("offset",u.toString()),c!==void 0&&f.append("filter",c),d===!0&&["attachment_urls","outputs","metadata"].forEach(m=>f.append("select",m));let b=0;for await(let m of this._getPaginated("/examples",f)){for(let h of m){let{attachment_urls:g,...y}=h,v=y;g&&(v.attachments=Object.entries(g).reduce((x,[k,E])=>(x[k.slice(11)]={presigned_url:E.presigned_url,mime_type:E.mime_type||void 0},x),{})),yield v,b++}if(l!==void 0&&b>=l)break}}async deleteExample(e){V(e);let r=`/examples/${e}`,n=await this.caller.call(L(),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(n,`delete ${r}`),await n.json()}async updateExample(e,r){let n;r?n=e:n=e.id,V(n);let i;r?i={id:n,...r}:i=e;let o;return i.dataset_id!==void 0?o=i.dataset_id:o=(await this.readExample(n)).dataset_id,this._updateExamplesMultipart(o,[i])}async updateExamples(e){let r;return e[0].dataset_id===void 0?r=(await this.readExample(e[0].id)).dataset_id:r=e[0].dataset_id,this._updateExamplesMultipart(r,e)}async readDatasetVersion({datasetId:e,datasetName:r,asOf:n,tag:i}){let o;if(e?o=e:o=(await this.readDataset({datasetName:r})).id,V(o),n&&i||!n&&!i)throw new Error("Exactly one of asOf and tag must be specified.");let s=new URLSearchParams;n!==void 0&&s.append("as_of",typeof n=="string"?n:n.toISOString()),i!==void 0&&s.append("tag",i);let a=await this.caller.call(L(),`${this.apiUrl}/datasets/${o}/version?${s.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(a,"read dataset version"),await a.json()}async listDatasetSplits({datasetId:e,datasetName:r,asOf:n}){let i;if(e===void 0&&r===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:r})).id:i=e,V(i);let o=new URLSearchParams,s=n?typeof n=="string"?n:n?.toISOString():void 0;return s&&o.append("as_of",s),await this._get(`/datasets/${i}/splits`,o)}async updateDatasetSplits({datasetId:e,datasetName:r,splitName:n,exampleIds:i,remove:o=!1}){let s;if(e===void 0&&r===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:r})).id:s=e,V(s);let a={split_name:n,examples:i.map(u=>(V(u),u)),remove:o},l=await this.caller.call(L(),`${this.apiUrl}/datasets/${s}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(l,"update dataset splits",!0)}async evaluateRun(e,r,{sourceInfo:n,loadChildRuns:i,referenceExample:o}={loadChildRuns:!1}){eu("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let s;if(typeof e=="string")s=await this.readRun(e,{loadChildRuns:i});else if(typeof e=="object"&&"id"in e)s=e;else throw new Error(`Invalid run type: ${typeof e}`);s.reference_example_id!==null&&s.reference_example_id!==void 0&&(o=await this.readExample(s.reference_example_id));let a=await r.evaluateRun(s,o),[l,u]=await this._logEvaluationFeedback(a,s,n);return u[0]}async createFeedback(e,r,{score:n,value:i,correction:o,comment:s,sourceInfo:a,feedbackSourceType:l="api",sourceRunId:u,feedbackId:c,feedbackConfig:d,projectId:p,comparativeExperimentId:f}){if(!e&&!p)throw new Error("One of runId or projectId must be provided");if(e&&p)throw new Error("Only one of runId or projectId can be provided");let _={type:l??"api",metadata:a??{}};u!==void 0&&_?.metadata!==void 0&&!_.metadata.__run&&(_.metadata.__run={run_id:u}),_?.metadata!==void 0&&_.metadata.__run?.run_id!==void 0&&V(_.metadata.__run.run_id);let w={id:c??de(),run_id:e,key:r,score:Wv(n),value:i,correction:o,comment:s,feedback_source:_,comparative_experiment_id:f,feedbackConfig:d,session_id:p},b=`${this.apiUrl}/feedback`,m=await this.caller.call(L(),b,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(w),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(m,"create feedback",!0),w}async updateFeedback(e,{score:r,value:n,correction:i,comment:o}){let s={};r!=null&&(s.score=Wv(r)),n!=null&&(s.value=n),i!=null&&(s.correction=i),o!=null&&(s.comment=o),V(e);let a=await this.caller.call(L(),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(a,"update feedback",!0)}async readFeedback(e){V(e);let r=`/feedback/${e}`;return await this._get(r)}async deleteFeedback(e){V(e);let r=`/feedback/${e}`,n=await this.caller.call(L(),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(n,`delete ${r}`),await n.json()}async*listFeedback({runIds:e,feedbackKeys:r,feedbackSourceTypes:n}={}){let i=new URLSearchParams;if(e&&i.append("run",e.join(",")),r)for(let o of r)i.append("key",o);if(n)for(let o of n)i.append("source",o);for await(let o of this._getPaginated("/feedback",i))yield*o}async createPresignedFeedbackToken(e,r,{expiration:n,feedbackConfig:i}={}){let o={run_id:e,feedback_key:r,feedback_config:i};return n?typeof n=="string"?o.expires_at=n:(n?.hours||n?.minutes||n?.days)&&(o.expires_in=n):o.expires_in={hours:3},await(await this.caller.call(L(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:r,referenceDatasetId:n,createdAt:i,description:o,metadata:s,id:a}){if(r.length===0)throw new Error("At least one experiment is required");if(n||(n=(await this.readProject({projectId:r[0]})).reference_dataset_id),!n==null)throw new Error("A reference dataset is required");let l={id:a,name:e,experiment_ids:r,reference_dataset_id:n,description:o,created_at:(i??new Date)?.toISOString(),extra:{}};return s&&(l.extra.metadata=s),await(await this.caller.call(L(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){V(e);let r=new URLSearchParams({run_id:e});for await(let n of this._getPaginated("/feedback/tokens",r))yield*n}_selectEvalResults(e){let r;return"results"in e?r=e.results:Array.isArray(e)?r=e:r=[e],r}async _logEvaluationFeedback(e,r,n){let i=this._selectEvalResults(e),o=[];for(let s of i){let a=n||{};s.evaluatorInfo&&(a={...s.evaluatorInfo,...a});let l=null;s.targetRunId?l=s.targetRunId:r&&(l=r.id),o.push(await this.createFeedback(l,s.key,{score:s.score,value:s.value,comment:s.comment,correction:s.correction,sourceInfo:a,sourceRunId:s.sourceRunId,feedbackConfig:s.feedbackConfig,feedbackSourceType:"model"}))}return[i,o]}async logEvaluationFeedback(e,r,n){let[i]=await this._logEvaluationFeedback(e,r,n);return i}async*listAnnotationQueues(e={}){let{queueIds:r,name:n,nameContains:i,limit:o}=e,s=new URLSearchParams;r&&r.forEach((l,u)=>{V(l,`queueIds[${u}]`),s.append("ids",l)}),n&&s.append("name",n),i&&s.append("name_contains",i),s.append("limit",(o!==void 0?Math.min(o,100):100).toString());let a=0;for await(let l of this._getPaginated("/annotation-queues",s))if(yield*l,a++,o!==void 0&&a>=o)break}async createAnnotationQueue(e){let{name:r,description:n,queueId:i}=e,o={name:r,description:n,id:i||de()},s=await this.caller.call(L(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(o).filter(([l,u])=>u!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(s,"create annotation queue"),await s.json()}async readAnnotationQueue(e){let r=await this.listAnnotationQueues({queueIds:[e]}).next();if(r.done)throw new Error(`Annotation queue with ID ${e} not found`);return r.value}async updateAnnotationQueue(e,r){let{name:n,description:i}=r,o=await this.caller.call(L(),`${this.apiUrl}/annotation-queues/${V(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:n,description:i}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(o,"update annotation queue")}async deleteAnnotationQueue(e){let r=await this.caller.call(L(),`${this.apiUrl}/annotation-queues/${V(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(r,"delete annotation queue")}async addRunsToAnnotationQueue(e,r){let n=await this.caller.call(L(),`${this.apiUrl}/annotation-queues/${V(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(r.map((i,o)=>V(i,`runIds[${o}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(n,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,r){let n=`/annotation-queues/${V(e,"queueId")}/run`,i=await this.caller.call(L(),`${this.apiUrl}${n}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(i,"get run from annotation queue"),await i.json()}async deleteRunFromAnnotationQueue(e,r){let n=await this.caller.call(L(),`${this.apiUrl}/annotation-queues/${V(e,"queueId")}/runs/${V(r,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(n,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){let r=await this.caller.call(L(),`${this.apiUrl}/annotation-queues/${V(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(r,"get size from annotation queue"),await r.json()}async _currentTenantIsOwner(e){let r=await this._getSettings();return e=="-"||r.tenant_handle===e}async _ownerConflictError(e,r){let n=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${n.tenant_handle}

      Requested tenant: ${r}`)}async _getLatestCommitHash(e){let r=await this.caller.call(L(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await r.json();if(!r.ok){let i=typeof n.detail=="string"?n.detail:JSON.stringify(n.detail),o=new Error(`Error ${r.status}: ${r.statusText}
${i}`);throw o.statusCode=r.status,o}if(n.commits.length!==0)return n.commits[0].commit_hash}async _likeOrUnlikePrompt(e,r){let[n,i,o]=xr(e),s=await this.caller.call(L(),`${this.apiUrl}/likes/${n}/${i}`,{method:"POST",body:JSON.stringify({like:r}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(s,`${r?"like":"unlike"} prompt`),await s.json()}async _getPromptUrl(e){let[r,n,i]=xr(e);if(await this._currentTenantIsOwner(r)){let o=await this._getSettings();return i!=="latest"?`${this.getHostUrl()}/prompts/${n}/${i.substring(0,8)}?organizationId=${o.id}`:`${this.getHostUrl()}/prompts/${n}?organizationId=${o.id}`}else return i!=="latest"?`${this.getHostUrl()}/hub/${r}/${n}/${i.substring(0,8)}`:`${this.getHostUrl()}/hub/${r}/${n}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(let r of this._getPaginated(`/commits/${e}/`,new URLSearchParams,n=>n.commits))yield*r}async*listPrompts(e){let r=new URLSearchParams;r.append("sort_field",e?.sortField??"updated_at"),r.append("sort_direction","desc"),r.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&r.append("is_public",e.isPublic.toString()),e?.query&&r.append("query",e.query);for await(let n of this._getPaginated("/repos",r,i=>i.repos))yield*n}async getPrompt(e){let[r,n,i]=xr(e),o=await this.caller.call(L(),`${this.apiUrl}/repos/${r}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(o.status===404)return null;await W(o,"get prompt");let s=await o.json();return s.repo?s.repo:null}async createPrompt(e,r){let n=await this._getSettings();if(r?.isPublic&&!n.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[i,o,s]=xr(e);if(!await this._currentTenantIsOwner(i))throw await this._ownerConflictError("create a prompt",i);let a={repo_handle:o,...r?.description&&{description:r.description},...r?.readme&&{readme:r.readme},...r?.tags&&{tags:r.tags},is_public:!!r?.isPublic},l=await this.caller.call(L(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(l,"create prompt");let{repo:u}=await l.json();return u}async createCommit(e,r,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[i,o,s]=xr(e),a=n?.parentCommitHash==="latest"||!n?.parentCommitHash?await this._getLatestCommitHash(`${i}/${o}`):n?.parentCommitHash,l={manifest:JSON.parse(JSON.stringify(r)),parent_commit:a},u=await this.caller.call(L(),`${this.apiUrl}/commits/${i}/${o}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(u,"create commit");let c=await u.json();return this._getPromptUrl(`${i}/${o}${c.commit_hash?`:${c.commit_hash}`:""}`)}async updateExamplesMultipart(e,r=[]){return this._updateExamplesMultipart(e,r)}async _updateExamplesMultipart(e,r=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith version does not allow using the multipart examples endpoint, please update to the latest version.");let n=new FormData;for(let a of r){let l=a.id,u={...a.metadata&&{metadata:a.metadata},...a.split&&{split:a.split}},c=it(u),d=new Blob([c],{type:"application/json"});if(n.append(l,d),a.inputs){let p=it(a.inputs),f=new Blob([p],{type:"application/json"});n.append(`${l}.inputs`,f)}if(a.outputs){let p=it(a.outputs),f=new Blob([p],{type:"application/json"});n.append(`${l}.outputs`,f)}if(a.attachments)for(let[p,f]of Object.entries(a.attachments)){let _,w;Array.isArray(f)?[_,w]=f:(_=f.mimeType,w=f.data);let b=new Blob([w],{type:`${_}; length=${w.byteLength}`});n.append(`${l}.attachment.${p}`,b)}if(a.attachments_operations){let p=it(a.attachments_operations),f=new Blob([p],{type:"application/json"});n.append(`${l}.attachments_operations`,f)}}let i=e??r[0]?.dataset_id;return await(await this.caller.call(L(),`${this.apiUrl}/v1/platform/datasets/${i}/examples`,{method:"PATCH",headers:this.headers,body:n})).json()}async uploadExamplesMultipart(e,r=[]){return this._uploadExamplesMultipart(e,r)}async _uploadExamplesMultipart(e,r=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith version does not allow using the multipart examples endpoint, please update to the latest version.");let n=new FormData;for(let s of r){let a=(s.id??de()).toString(),l={created_at:s.created_at,...s.metadata&&{metadata:s.metadata},...s.split&&{split:s.split},...s.source_run_id&&{source_run_id:s.source_run_id},...s.use_source_run_io&&{use_source_run_io:s.use_source_run_io},...s.use_source_run_attachments&&{use_source_run_attachments:s.use_source_run_attachments}},u=it(l),c=new Blob([u],{type:"application/json"});if(n.append(a,c),s.inputs){let d=it(s.inputs),p=new Blob([d],{type:"application/json"});n.append(`${a}.inputs`,p)}if(s.outputs){let d=it(s.outputs),p=new Blob([d],{type:"application/json"});n.append(`${a}.outputs`,p)}if(s.attachments)for(let[d,p]of Object.entries(s.attachments)){let f,_;Array.isArray(p)?[f,_]=p:(f=p.mimeType,_=p.data);let w=new Blob([_],{type:`${f}; length=${_.byteLength}`});n.append(`${a}.attachment.${d}`,w)}}return await(await this.caller.call(L(),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"POST",headers:this.headers,body:n})).json()}async updatePrompt(e,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[n,i]=xr(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("update a prompt",n);let o={};if(r?.description!==void 0&&(o.description=r.description),r?.readme!==void 0&&(o.readme=r.readme),r?.tags!==void 0&&(o.tags=r.tags),r?.isPublic!==void 0&&(o.is_public=r.isPublic),r?.isArchived!==void 0&&(o.is_archived=r.isArchived),Object.keys(o).length===0)throw new Error("No valid update options provided");let s=await this.caller.call(L(),`${this.apiUrl}/repos/${n}/${i}`,{method:"PATCH",body:JSON.stringify(o),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(s,"update prompt"),s.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[r,n,i]=xr(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("delete a prompt",r);return await(await this.caller.call(L(),`${this.apiUrl}/repos/${r}/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,r){let[n,i,o]=xr(e),s=await this.caller.call(L(),`${this.apiUrl}/commits/${n}/${i}/${o}${r?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(s,"pull prompt commit");let a=await s.json();return{owner:n,repo:i,commit_hash:a.commit_hash,manifest:a.manifest,examples:a.examples}}async _pullPrompt(e,r){let n=await this.pullPromptCommit(e,{includeModel:r?.includeModel});return JSON.stringify(n.manifest)}async pushPrompt(e,r){return await this.promptExists(e)?r&&Object.keys(r).some(i=>i!=="object")&&await this.updatePrompt(e,{description:r?.description,readme:r?.readme,tags:r?.tags,isPublic:r?.isPublic}):await this.createPrompt(e,{description:r?.description,readme:r?.readme,tags:r?.tags,isPublic:r?.isPublic}),r?.object?await this.createCommit(e,r?.object,{parentCommitHash:r?.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,r={}){let{sourceApiUrl:n=this.apiUrl,datasetName:i}=r,[o,s]=this.parseTokenOrUrl(e,n),a=new t({apiUrl:o,apiKey:"placeholder"}),l=await a.readSharedDataset(s),u=i||l.name;try{if(await this.hasDataset({datasetId:u})){console.log(`Dataset ${u} already exists in your tenant. Skipping.`);return}}catch{}let c=await a.listSharedExamples(s),d=await this.createDataset(u,{description:l.description,dataType:l.data_type||"kv",inputsSchema:l.inputs_schema_definition??void 0,outputsSchema:l.outputs_schema_definition??void 0});try{await this.createExamples({inputs:c.map(p=>p.inputs),outputs:c.flatMap(p=>p.outputs?[p.outputs]:[]),datasetId:d.id})}catch(p){throw console.error(`An error occurred while creating dataset ${u}. You should delete it manually.`),p}}parseTokenOrUrl(e,r,n=2,i="dataset"){try{return V(e),[r,e]}catch{}try{let s=new URL(e).pathname.split("/").filter(a=>a!=="");if(s.length>=n){let a=s[s.length-n];return[r,a]}else throw new Error(`Invalid public ${i} URL: ${e}`)}catch{throw new Error(`Invalid public ${i} URL or token: ${e}`)}}awaitPendingTraceBatches(){return this.manualFlushMode?(console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve()):Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()])}};function Gv(t){return"dataset_id"in t||"dataset_name"in t}var mu="0.3.15";var Mr,lP=()=>typeof window<"u"&&typeof window.document<"u",uP=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",cP=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),Hv=()=>typeof Deno<"u",dP=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Hv(),pP=()=>Mr||(lP()?Mr="browser":dP()?Mr="node":uP()?Mr="webworker":cP()?Mr="jsdom":Hv()?Mr="deno":Mr="other",Mr),yf;function gu(){if(yf===void 0){let t=pP(),e=hP();yf={library:"langsmith",runtime:t,sdk:"langsmith-js",sdk_version:mu,...e}}return yf}function qv(){let t=fP()||{},e={},r=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(let[n,i]of Object.entries(t))(n.startsWith("LANGCHAIN_")||n.startsWith("LANGSMITH_"))&&typeof i=="string"&&!r.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=i:e[n]=i);return e}function fP(){try{return typeof process<"u"&&process.env?Object.entries(process.env).reduce((t,[e,r])=>(t[e]=String(r),t),{}):void 0}catch{return}}function Sr(t){try{return typeof process<"u"?process.env?.[t]:void 0}catch{return}}function Vt(t){return Sr(`LANGSMITH_${t}`)||Sr(`LANGCHAIN_${t}`)}var wf;function hP(){if(wf!==void 0)return wf;let t=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(let r of t){let n=Sr(r);n!==void 0&&(e[r]=n)}return wf=e,e}var Kv=t=>t!==void 0?t:!!["TRACING_V2","TRACING"].find(r=>Vt(r)==="true");var _u=Symbol.for("lc:context_variables");function mP(t){return t.replace(/[-:.]/g,"")}function gP(t,e,r=1){let n=r.toFixed(0).slice(0,3).padStart(3,"0");return mP(`${new Date(t).toISOString().slice(0,-1)}${n}Z`)+e}var yu=class t{constructor(e,r){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=r}static fromHeader(e){let r=e.split(","),n={},i=[];for(let o of r){let[s,a]=o.split("="),l=decodeURIComponent(a);s==="langsmith-metadata"?n=JSON.parse(l):s==="langsmith-tags"&&(i=l.split(","))}return new t(n,i)}toHeader(){let e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),e.join(",")}},Tr=class t{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),wu(e)){Object.assign(this,{...e});return}let r=t.getDefaultConfig(),{metadata:n,...i}=e,o=i.client??t.getSharedClient(),s={...n,...i?.extra?.metadata};if(i.extra={...i.extra,metadata:s},Object.assign(this,{...r,...i,client:o}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){let a=gP(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+a:this.dotted_order=a}}static getDefaultConfig(){return{id:de(),run_type:"chain",project_name:Vt("PROJECT")??Sr("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:Sr("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:Sr("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return t.sharedClient||(t.sharedClient=new Qn),t.sharedClient}createChild(e){let r=this.child_execution_order+1,n=new t({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:r,child_execution_order:r});_u in this&&(n[_u]=this[_u]);let i=Symbol.for("lc:child_config"),o=e.extra?.[i]??this.extra[i];if(yP(o)){let l={...o},u=_P(l.callbacks)?l.callbacks.copy?.():void 0;u&&(Object.assign(u,{_parentRunId:n.id}),u.handlers?.find(Jv)?.updateFromRunTree?.(n),l.callbacks=u),n.extra[i]=l}let s=new Set,a=this;for(;a!=null&&!s.has(a.id);)s.add(a.id),a.child_execution_order=Math.max(a.child_execution_order,r),a=a.parent_run;return this.child_runs.push(n),n}async end(e,r,n=Date.now(),i){this.outputs=this.outputs??e,this.error=this.error??r,this.end_time=this.end_time??n,i&&Object.keys(i).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...i}}:{metadata:i})}_convertToCreate(e,r,n=!0){let i=e.extra??{};if(i.runtime||(i.runtime={}),r)for(let[l,u]of Object.entries(r))i.runtime[l]||(i.runtime[l]=u);let o,s;return n?(s=e.parent_run?.id,o=[]):(o=e.child_runs.map(l=>this._convertToCreate(l,r,n)),s=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:i,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:o,parent_run_id:s,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments}}async postRun(e=!0){try{let r=gu(),n=await this._convertToCreate(this,r,!0);if(await this.client.createRun(n),!e){eu("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(let i of this.child_runs)await i.postRun(!1)}}catch(r){console.error(`Error in postRun for run ${this.id}:`,r)}}async patchRun(){try{let e={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:this.parent_run?.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments};await this.client.updateRun(this.id,e)}catch(e){console.error(`Error in patchRun for run ${this.id}`,e)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,r){let n=e?.callbacks,i,o,s,a=Kv();if(n){let u=n?.getParentRunId?.()??"",c=n?.handlers?.find(d=>d?.name=="langchain_tracer");i=c?.getRun?.(u),o=c?.projectName,s=c?.client,a=a||!!c}return i?new t({name:i.name,id:i.id,trace_id:i.trace_id,dotted_order:i.dotted_order,client:s,tracingEnabled:a,project_name:o,tags:[...new Set((i?.tags??[]).concat(e?.tags??[]))],extra:{metadata:{...i?.extra?.metadata,...e?.metadata}}}).createChild(r):new t({...r,client:s,tracingEnabled:a,project_name:o})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,r){let n="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,i=n["langsmith-trace"];if(!i||typeof i!="string")return;let o=i.trim(),s=o.split(".").map(u=>{let[c,d]=u.split("Z");return{strTime:c,time:Date.parse(c+"Z"),uuid:d}}),a=s[0].uuid,l={...r,name:r?.name??"parent",run_type:r?.run_type??"chain",start_time:r?.start_time??Date.now(),id:s.at(-1)?.uuid,trace_id:a,dotted_order:o};if(n.baggage&&typeof n.baggage=="string"){let u=yu.fromHeader(n.baggage);l.metadata=u.metadata,l.tags=u.tags}return new t(l)}toHeaders(e){let r={"langsmith-trace":this.dotted_order,baggage:new yu(this.extra?.metadata,this.tags).toHeader()};if(e)for(let[n,i]of Object.entries(r))e.set(n,i);return r}};Object.defineProperty(Tr,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function wu(t){return t!==void 0&&typeof t.createChild=="function"&&typeof t.postRun=="function"}function Jv(t){return typeof t=="object"&&t!=null&&typeof t.name=="string"&&t.name==="langchain_tracer"}function Qv(t){return Array.isArray(t)&&t.some(e=>Jv(e))}function _P(t){return typeof t=="object"&&t!=null&&Array.isArray(t.handlers)}function yP(t){return t!==void 0&&typeof t.callbacks=="object"&&(Qv(t.callbacks?.handlers)||Qv(t.callbacks))}var bf=class{getStore(){}run(e,r){return r()}},vf=Symbol.for("ls:tracing_async_local_storage"),wP=new bf,xf=class{getInstance(){return globalThis[vf]??wP}initializeGlobalInstance(e){globalThis[vf]===void 0&&(globalThis[vf]=e)}},vP=new xf,Xv=()=>{let t=vP.getInstance().getStore();if(!wu(t))throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function and that tracing is enabled."].join(`
`));return t};var L$=Symbol.for("langsmith:traceable:root");function vu(t){return typeof t=="function"&&"langsmith:traceable"in t}var Sf={};sh(Sf,{JsonPatchError:()=>pe,_areEquals:()=>ks,applyOperation:()=>Xn,applyPatch:()=>Zn,applyReducer:()=>TP,deepClone:()=>xP,getValueByPointer:()=>Tu,validate:()=>tb,validator:()=>Mu});var bP=Object.prototype.hasOwnProperty;function Yv(t,e){return bP.call(t,e)}function eb(t){if(Array.isArray(t)){let r=new Array(t.length);for(let n=0;n<r.length;n++)r[n]=""+n;return r}if(Object.keys)return Object.keys(t);let e=[];for(let r in t)Yv(t,r)&&e.push(r);return e}function Pt(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function xu(t){let e=0,r=t.length,n;for(;e<r;){if(n=t.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function Su(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function Ms(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function bu(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(let r=0,n=t.length;r<n;r++)if(bu(t[r]))return!0}else if(typeof t=="object"){let r=eb(t),n=r.length;for(var e=0;e<n;e++)if(bu(t[r[e]]))return!0}}return!1}function Zv(t,e){let r=[t];for(let n in e){let i=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof i<"u"&&r.push(`${n}: ${i}`)}return r.join(`
`)}var Jn=class extends Error{constructor(e,r,n,i,o){super(Zv(e,{name:r,index:n,operation:i,tree:o})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.setPrototypeOf(this,new.target.prototype),this.message=Zv(e,{name:r,index:n,operation:i,tree:o})}};var pe=Jn,xP=Pt,no={add:function(t,e,r){return t[e]=this.value,{newDocument:r}},remove:function(t,e,r){var n=t[e];return delete t[e],{newDocument:r,removed:n}},replace:function(t,e,r){var n=t[e];return t[e]=this.value,{newDocument:r,removed:n}},move:function(t,e,r){let n=Tu(r,this.path);n&&(n=Pt(n));let i=Xn(r,{op:"remove",path:this.from}).removed;return Xn(r,{op:"add",path:this.path,value:i}),{newDocument:r,removed:n}},copy:function(t,e,r){let n=Tu(r,this.from);return Xn(r,{op:"add",path:this.path,value:Pt(n)}),{newDocument:r}},test:function(t,e,r){return{newDocument:r,test:ks(t[e],this.value)}},_get:function(t,e,r){return this.value=t[e],{newDocument:r}}},SP={add:function(t,e,r){return xu(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:r,index:e}},remove:function(t,e,r){var n=t.splice(e,1);return{newDocument:r,removed:n[0]}},replace:function(t,e,r){var n=t[e];return t[e]=this.value,{newDocument:r,removed:n}},move:no.move,copy:no.copy,test:no.test,_get:no._get};function Tu(t,e){if(e=="")return t;var r={op:"_get",path:e};return Xn(t,r),r.value}function Xn(t,e,r=!1,n=!0,i=!0,o=0){if(r&&(typeof r=="function"?r(e,0,t,e.path):Mu(e,0)),e.path===""){let s={newDocument:t};if(e.op==="add")return s.newDocument=e.value,s;if(e.op==="replace")return s.newDocument=e.value,s.removed=t,s;if(e.op==="move"||e.op==="copy")return s.newDocument=Tu(t,e.from),e.op==="move"&&(s.removed=t),s;if(e.op==="test"){if(s.test=ks(t,e.value),s.test===!1)throw new pe("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return s.newDocument=t,s}else{if(e.op==="remove")return s.removed=t,s.newDocument=null,s;if(e.op==="_get")return e.value=t,s;if(r)throw new pe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",o,e,t);return s}}else{n||(t=Pt(t));let a=(e.path||"").split("/"),l=t,u=1,c=a.length,d,p,f;for(typeof r=="function"?f=r:f=Mu;;){if(p=a[u],p&&p.indexOf("~")!=-1&&(p=Ms(p)),i&&(p=="__proto__"||p=="prototype"&&u>0&&a[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&d===void 0&&(l[p]===void 0?d=a.slice(0,u).join("/"):u==c-1&&(d=e.path),d!==void 0&&f(e,0,t,d)),u++,Array.isArray(l)){if(p==="-")p=l.length;else{if(r&&!xu(p))throw new pe("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",o,e,t);xu(p)&&(p=~~p)}if(u>=c){if(r&&e.op==="add"&&p>l.length)throw new pe("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",o,e,t);let _=SP[e.op].call(e,l,p,t);if(_.test===!1)throw new pe("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return _}}else if(u>=c){let _=no[e.op].call(e,l,p,t);if(_.test===!1)throw new pe("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return _}if(l=l[p],r&&u<c&&(!l||typeof l!="object"))throw new pe("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",o,e,t)}}}function Zn(t,e,r,n=!0,i=!0){if(r&&!Array.isArray(e))throw new pe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(t=Pt(t));let o=new Array(e.length);for(let s=0,a=e.length;s<a;s++)o[s]=Xn(t,e[s],r,!0,i,s),t=o[s].newDocument;return o.newDocument=t,o}function TP(t,e,r){let n=Xn(t,e);if(n.test===!1)throw new pe("Test operation failed","TEST_OPERATION_FAILED",r,e,t);return n.newDocument}function Mu(t,e,r,n){if(typeof t!="object"||t===null||Array.isArray(t))throw new pe("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,r);if(no[t.op]){if(typeof t.path!="string")throw new pe("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,r);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new pe('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,r);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new pe("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,r);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new pe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,r);if((t.op==="add"||t.op==="replace"||t.op==="test")&&bu(t.value))throw new pe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,r);if(r){if(t.op=="add"){var i=t.path.split("/").length,o=n.split("/").length;if(i!==o+1&&i!==o)throw new pe("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,r)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==n)throw new pe("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,r)}else if(t.op==="move"||t.op==="copy"){var s={op:"_get",path:t.from,value:void 0},a=tb([s],r);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new pe("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,r)}}}else throw new pe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,r)}function tb(t,e,r){try{if(!Array.isArray(t))throw new pe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Zn(Pt(e),Pt(t),r||!0);else{r=r||Mu;for(var n=0;n<t.length;n++)r(t[n],n,e,void 0)}}catch(i){if(i instanceof pe)return i;throw i}}function ks(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var r=Array.isArray(t),n=Array.isArray(e),i,o,s;if(r&&n){if(o=t.length,o!=e.length)return!1;for(i=o;i--!==0;)if(!ks(t[i],e[i]))return!1;return!0}if(r!=n)return!1;var a=Object.keys(t);if(o=a.length,o!==Object.keys(e).length)return!1;for(i=o;i--!==0;)if(!e.hasOwnProperty(a[i]))return!1;for(i=o;i--!==0;)if(s=a[i],!ks(t[s],e[s]))return!1;return!0}return t!==t&&e!==e}var q$={...Sf,JsonPatchError:Jn,deepClone:Pt,escapePathComponent:Su,unescapePathComponent:Ms};var db=Z(nb(),1),AP=Z(cb(),1);function pb(t,e){return e?.[t]||(0,db.default)(t)}function fb(t,e,r){let n={};for(let i in t)Object.hasOwn(t,i)&&(n[e(i,r)]=t[i]);return n}function hb(t){return Array.isArray(t)?[...t]:{...t}}function $P(t,e){let r=hb(t);for(let[n,i]of Object.entries(e)){let[o,...s]=n.split(".").reverse(),a=r;for(let l of s.reverse()){if(a[l]===void 0)break;a[l]=hb(a[l]),a=a[l]}a[o]!==void 0&&(a[o]={lc:1,type:"secret",id:[i]})}return r}function Mf(t){let e=Object.getPrototypeOf(t);return typeof t.lc_name=="function"&&(typeof e.lc_name!="function"||t.lc_name()!==e.lc_name())?t.lc_name():t.name}var kr=class t{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Mf(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...r){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([n])=>this.lc_serializable_keys?.includes(n))):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof t||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},r={},n=Object.keys(this.lc_kwargs).reduce((i,o)=>(i[o]=o in this?this[o]:this.lc_kwargs[o],i),{});for(let i=Object.getPrototypeOf(this);i;i=Object.getPrototypeOf(i))Object.assign(e,Reflect.get(i,"lc_aliases",this)),Object.assign(r,Reflect.get(i,"lc_secrets",this)),Object.assign(n,Reflect.get(i,"lc_attributes",this));return Object.keys(r).forEach(i=>{let o=this,s=n,[a,...l]=i.split(".").reverse();for(let u of l.reverse()){if(!(u in o)||o[u]===void 0)return;(!(u in s)||s[u]===void 0)&&(typeof o[u]=="object"&&o[u]!=null?s[u]={}:Array.isArray(o[u])&&(s[u]=[])),o=o[u],s=s[u]}a in o&&o[a]!==void 0&&(s[a]=s[a]||o[a])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:fb(Object.keys(r).length?$P(n,r):n,pb,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};var OP=()=>typeof window<"u"&&typeof window.document<"u",FP=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",NP=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),Ef=()=>typeof Deno<"u",LP=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Ef(),RP=()=>{let t;return OP()?t="browser":LP()?t="node":FP()?t="webworker":NP()?t="jsdom":Ef()?t="deno":t="other",t},kf;async function mb(){return kf===void 0&&(kf={library:"langchain-js",runtime:RP()}),kf}function ht(t){try{return typeof process<"u"?process.env?.[t]:Ef()?Deno?.env.get(t):void 0}catch{return}}var Pf=class{};var Yn=class t extends Pf{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Mf(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:ht("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return kr.prototype.toJSON.call(this)}toJSONNotImplemented(){return kr.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class r extends t{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:de()}),Object.assign(this,e)}}return new r}},gb=t=>{let e=t;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"};function Cf(t,e){return t&&!Array.isArray(t)&&typeof t=="object"?t:{[e]:t}}function DP(t){return t.replace(/[-:.]/g,"")}function zP(t,e,r){let n=r.toFixed(0).slice(0,3).padStart(3,"0");return DP(`${new Date(t).toISOString().slice(0,-1)}${n}Z`)+e}function io(t){return typeof t._addRunToRunMap=="function"}var Ct=class extends Yn{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,r){e.child_runs.push(r)}_addRunToRunMap(e){let r=zP(e.start_time,e.id,e.execution_order),n={...e};if(n.parent_run_id!==void 0){let i=this.runMap.get(n.parent_run_id);i&&(this._addChildRun(i,n),i.child_execution_order=Math.max(i.child_execution_order,n.child_execution_order),n.trace_id=i.trace_id,i.dotted_order!==void 0&&(n.dotted_order=[i.dotted_order,r].join(".")))}else n.trace_id=n.id,n.dotted_order=r;return this.runMap.set(n.id,n),n}async _endTrace(e){let r=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);r?r.child_execution_order=Math.max(r.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await this.onRunUpdate?.(e)}_getExecutionOrder(e){let r=e!==void 0&&this.runMap.get(e);return r?r.child_execution_order+1:1}_createRunForLLMStart(e,r,n,i,o,s,a,l){let u=this._getExecutionOrder(i),c=Date.now(),d=a?{...o,metadata:a}:o,p={id:n,name:l??e.id[e.id.length-1],parent_run_id:i,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{prompts:r},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:s||[]};return this._addRunToRunMap(p)}async handleLLMStart(e,r,n,i,o,s,a,l){let u=this.runMap.get(n)??this._createRunForLLMStart(e,r,n,i,o,s,a,l);return await this.onRunCreate?.(u),await this.onLLMStart?.(u),u}_createRunForChatModelStart(e,r,n,i,o,s,a,l){let u=this._getExecutionOrder(i),c=Date.now(),d=a?{...o,metadata:a}:o,p={id:n,name:l??e.id[e.id.length-1],parent_run_id:i,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{messages:r},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:s||[]};return this._addRunToRunMap(p)}async handleChatModelStart(e,r,n,i,o,s,a,l){let u=this.runMap.get(n)??this._createRunForChatModelStart(e,r,n,i,o,s,a,l);return await this.onRunCreate?.(u),await this.onLLMStart?.(u),u}async handleLLMEnd(e,r,n,i,o){let s=this.runMap.get(r);if(!s||s?.run_type!=="llm")throw new Error("No LLM run to end.");return s.end_time=Date.now(),s.outputs=e,s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),s.extra={...s.extra,...o},await this.onLLMEnd?.(s),await this._endTrace(s),s}async handleLLMError(e,r,n,i,o){let s=this.runMap.get(r);if(!s||s?.run_type!=="llm")throw new Error("No LLM run to end.");return s.end_time=Date.now(),s.error=this.stringifyError(e),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),s.extra={...s.extra,...o},await this.onLLMError?.(s),await this._endTrace(s),s}_createRunForChainStart(e,r,n,i,o,s,a,l){let u=this._getExecutionOrder(i),c=Date.now(),d={id:n,name:l??e.id[e.id.length-1],parent_run_id:i,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:r,execution_order:u,child_execution_order:u,run_type:a??"chain",child_runs:[],extra:s?{metadata:s}:{},tags:o||[]};return this._addRunToRunMap(d)}async handleChainStart(e,r,n,i,o,s,a,l){let u=this.runMap.get(n)??this._createRunForChainStart(e,r,n,i,o,s,a,l);return await this.onRunCreate?.(u),await this.onChainStart?.(u),u}async handleChainEnd(e,r,n,i,o){let s=this.runMap.get(r);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.outputs=Cf(e,"output"),s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),o?.inputs!==void 0&&(s.inputs=Cf(o.inputs,"input")),await this.onChainEnd?.(s),await this._endTrace(s),s}async handleChainError(e,r,n,i,o){let s=this.runMap.get(r);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.error=this.stringifyError(e),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),o?.inputs!==void 0&&(s.inputs=Cf(o.inputs,"input")),await this.onChainError?.(s),await this._endTrace(s),s}_createRunForToolStart(e,r,n,i,o,s,a){let l=this._getExecutionOrder(i),u=Date.now(),c={id:n,name:a??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{input:r},execution_order:l,child_execution_order:l,run_type:"tool",child_runs:[],extra:s?{metadata:s}:{},tags:o||[]};return this._addRunToRunMap(c)}async handleToolStart(e,r,n,i,o,s,a){let l=this.runMap.get(n)??this._createRunForToolStart(e,r,n,i,o,s,a);return await this.onRunCreate?.(l),await this.onToolStart?.(l),l}async handleToolEnd(e,r){let n=this.runMap.get(r);if(!n||n?.run_type!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await this.onToolEnd?.(n),await this._endTrace(n),n}async handleToolError(e,r){let n=this.runMap.get(r);if(!n||n?.run_type!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await this.onToolError?.(n),await this._endTrace(n),n}async handleAgentAction(e,r){let n=this.runMap.get(r);if(!n||n?.run_type!=="chain")return;let i=n;i.actions=i.actions||[],i.actions.push(e),i.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentAction?.(n)}async handleAgentEnd(e,r){let n=this.runMap.get(r);!n||n?.run_type!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentEnd?.(n))}_createRunForRetrieverStart(e,r,n,i,o,s,a){let l=this._getExecutionOrder(i),u=Date.now(),c={id:n,name:a??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{query:r},execution_order:l,child_execution_order:l,run_type:"retriever",child_runs:[],extra:s?{metadata:s}:{},tags:o||[]};return this._addRunToRunMap(c)}async handleRetrieverStart(e,r,n,i,o,s,a){let l=this.runMap.get(n)??this._createRunForRetrieverStart(e,r,n,i,o,s,a);return await this.onRunCreate?.(l),await this.onRetrieverStart?.(l),l}async handleRetrieverEnd(e,r){let n=this.runMap.get(r);if(!n||n?.run_type!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await this.onRetrieverEnd?.(n),await this._endTrace(n),n}async handleRetrieverError(e,r){let n=this.runMap.get(r);if(!n||n?.run_type!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await this.onRetrieverError?.(n),await this._endTrace(n),n}async handleText(e,r){let n=this.runMap.get(r);!n||n?.run_type!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await this.onText?.(n))}async handleLLMNewToken(e,r,n,i,o,s){let a=this.runMap.get(n);if(!a||a?.run_type!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return a.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:r,chunk:s?.chunk}}),await this.onLLMNewToken?.(a,e,{chunk:s?.chunk}),a}};var If=Z(vb(),1);function He(t,e){return`${t.open}${e}${t.close}`}function It(t,e){try{return JSON.stringify(t,null,2)}catch{return e}}function bb(t){return typeof t=="string"?t.trim():t==null?t:It(t,t.toString())}function an(t){if(!t.end_time)return"";let e=t.end_time-t.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}var{color:ot}=If.default,Es=class extends Ct{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let r=[],n=e;for(;n.parent_run_id;){let i=this.runMap.get(n.parent_run_id);if(i)r.push(i),n=i;else break}return r}getBreadcrumbs(e){let n=[...this.getParents(e).reverse(),e].map((i,o,s)=>{let a=`${i.execution_order}:${i.run_type}:${i.name}`;return o===s.length-1?He(If.default.bold,a):a}).join(" > ");return He(ot.grey,n)}onChainStart(e){let r=this.getBreadcrumbs(e);console.log(`${He(ot.green,"[chain/start]")} [${r}] Entering Chain run with input: ${It(e.inputs,"[inputs]")}`)}onChainEnd(e){let r=this.getBreadcrumbs(e);console.log(`${He(ot.cyan,"[chain/end]")} [${r}] [${an(e)}] Exiting Chain run with output: ${It(e.outputs,"[outputs]")}`)}onChainError(e){let r=this.getBreadcrumbs(e);console.log(`${He(ot.red,"[chain/error]")} [${r}] [${an(e)}] Chain run errored with error: ${It(e.error,"[error]")}`)}onLLMStart(e){let r=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(i=>i.trim())}:e.inputs;console.log(`${He(ot.green,"[llm/start]")} [${r}] Entering LLM run with input: ${It(n,"[inputs]")}`)}onLLMEnd(e){let r=this.getBreadcrumbs(e);console.log(`${He(ot.cyan,"[llm/end]")} [${r}] [${an(e)}] Exiting LLM run with output: ${It(e.outputs,"[response]")}`)}onLLMError(e){let r=this.getBreadcrumbs(e);console.log(`${He(ot.red,"[llm/error]")} [${r}] [${an(e)}] LLM run errored with error: ${It(e.error,"[error]")}`)}onToolStart(e){let r=this.getBreadcrumbs(e);console.log(`${He(ot.green,"[tool/start]")} [${r}] Entering Tool run with input: "${bb(e.inputs.input)}"`)}onToolEnd(e){let r=this.getBreadcrumbs(e);console.log(`${He(ot.cyan,"[tool/end]")} [${r}] [${an(e)}] Exiting Tool run with output: "${bb(e.outputs?.output)}"`)}onToolError(e){let r=this.getBreadcrumbs(e);console.log(`${He(ot.red,"[tool/error]")} [${r}] [${an(e)}] Tool run errored with error: ${It(e.error,"[error]")}`)}onRetrieverStart(e){let r=this.getBreadcrumbs(e);console.log(`${He(ot.green,"[retriever/start]")} [${r}] Entering Retriever run with input: ${It(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let r=this.getBreadcrumbs(e);console.log(`${He(ot.cyan,"[retriever/end]")} [${r}] [${an(e)}] Exiting Retriever run with output: ${It(e.outputs,"[outputs]")}`)}onRetrieverError(e){let r=this.getBreadcrumbs(e);console.log(`${He(ot.red,"[retriever/error]")} [${r}] [${an(e)}] Retriever run errored with error: ${It(e.error,"[error]")}`)}onAgentAction(e){let r=e,n=this.getBreadcrumbs(e);console.log(`${He(ot.blue,"[agent/action]")} [${n}] Agent selected action: ${It(r.actions[r.actions.length-1],"[action]")}`)}};function Af(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="tool_call")}var ku=class extends Error{constructor(e,r){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=r}};function xb(t){if(typeof t>"u")return null;try{return JSON.parse(t)}catch{}let e="",r=[],n=!1,i=!1;for(let o of t){if(n)o==='"'&&!i?n=!1:o===`
`&&!i?o="\\n":o==="\\"?i=!i:i=!1;else if(o==='"')n=!0,i=!1;else if(o==="{")r.push("}");else if(o==="[")r.push("]");else if(o==="}"||o==="]")if(r&&r[r.length-1]===o)r.pop();else return null;e+=o}n&&(e+='"');for(let o=r.length-1;o>=0;o-=1)e+=r[o];try{return JSON.parse(e)}catch{return null}}function ei(t,e){return typeof t=="string"?t===""?e:typeof e=="string"?t+e:[{type:"text",text:t},...e]:Array.isArray(e)?Eu(t,e)??[...t,...e]:e===""?t:[...t,{type:"text",text:e}]}function BP(t,e){function r(n,i){if(typeof n!="object"||n===null||n===void 0)return n;if(i>=e)return Array.isArray(n)?"[Array]":"[Object]";if(Array.isArray(n))return n.map(s=>r(s,i+1));let o={};for(let s of Object.keys(n))o[s]=r(n[s],i+1);return o}return JSON.stringify(r(t,0),null,2)}var Er=class extends kr{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,r){typeof e=="string"&&(e={content:e,additional_kwargs:r,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;let r=BP(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${r}`}};function nr(t,e){let r={...t};for(let[n,i]of Object.entries(e))if(r[n]==null)r[n]=i;else{if(i==null)continue;if(typeof r[n]!=typeof i||Array.isArray(r[n])!==Array.isArray(i))throw new Error(`field[${n}] already exists in the message chunk, but with a different type.`);if(typeof r[n]=="string"){if(n==="type")continue;r[n]+=i}else if(typeof r[n]=="object"&&!Array.isArray(r[n]))r[n]=nr(r[n],i);else if(Array.isArray(r[n]))r[n]=Eu(r[n],i);else{if(r[n]===i)continue;console.warn(`field[${n}] already exists in this message chunk and value has unsupported type.`)}}return r}function Eu(t,e){if(!(t===void 0&&e===void 0)){if(t===void 0||e===void 0)return t||e;{let r=[...t];for(let n of e)if(typeof n=="object"&&"index"in n&&typeof n.index=="number"){let i=r.findIndex(o=>o.index===n.index);i!==-1?r[i]=nr(r[i],n):r.push(n)}else{if(typeof n=="object"&&"text"in n&&n.text==="")continue;r.push(n)}return r}}}var Pr=class extends Er{};var ti=class t extends Pr{constructor(e){let r;if(typeof e=="string")r={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)r={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{let n=[],i=[];for(let o of e.tool_call_chunks){let s={};try{if(s=xb(o.args||"{}"),s===null||typeof s!="object"||Array.isArray(s))throw new Error("Malformed tool call chunk args.");n.push({name:o.name??"",args:s,id:o.id,type:"tool_call"})}catch{i.push({name:o.name,args:o.args,id:o.id,error:"Malformed args.",type:"invalid_tool_call"})}}r={...e,tool_calls:n,invalid_tool_calls:i,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=r.tool_call_chunks??this.tool_call_chunks,this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=r.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){let r={content:ei(this.content,e.content),additional_kwargs:nr(this.additional_kwargs,e.additional_kwargs),response_metadata:nr(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){let n=Eu(this.tool_call_chunks,e.tool_call_chunks);n!==void 0&&n.length>0&&(r.tool_call_chunks=n)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){let n={...(this.usage_metadata?.input_token_details?.audio!==void 0||e.usage_metadata?.input_token_details?.audio!==void 0)&&{audio:(this.usage_metadata?.input_token_details?.audio??0)+(e.usage_metadata?.input_token_details?.audio??0)},...(this.usage_metadata?.input_token_details?.cache_read!==void 0||e.usage_metadata?.input_token_details?.cache_read!==void 0)&&{cache_read:(this.usage_metadata?.input_token_details?.cache_read??0)+(e.usage_metadata?.input_token_details?.cache_read??0)},...(this.usage_metadata?.input_token_details?.cache_creation!==void 0||e.usage_metadata?.input_token_details?.cache_creation!==void 0)&&{cache_creation:(this.usage_metadata?.input_token_details?.cache_creation??0)+(e.usage_metadata?.input_token_details?.cache_creation??0)}},i={...(this.usage_metadata?.output_token_details?.audio!==void 0||e.usage_metadata?.output_token_details?.audio!==void 0)&&{audio:(this.usage_metadata?.output_token_details?.audio??0)+(e.usage_metadata?.output_token_details?.audio??0)},...(this.usage_metadata?.output_token_details?.reasoning!==void 0||e.usage_metadata?.output_token_details?.reasoning!==void 0)&&{reasoning:(this.usage_metadata?.output_token_details?.reasoning??0)+(e.usage_metadata?.output_token_details?.reasoning??0)}},o=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},s=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},a={input_tokens:o.input_tokens+s.input_tokens,output_tokens:o.output_tokens+s.output_tokens,total_tokens:o.total_tokens+s.total_tokens,...Object.keys(n).length>0&&{input_token_details:n},...Object.keys(i).length>0&&{output_token_details:i}};r.usage_metadata=a}return new t(r)}};function Sb(t,e="Human",r="AI"){let n=[];for(let i of t){let o;if(i._getType()==="human")o=e;else if(i._getType()==="ai")o=r;else if(i._getType()==="system")o="System";else if(i._getType()==="function")o="Function";else if(i._getType()==="tool")o="Tool";else if(i._getType()==="generic")o=i.role;else throw new Error(`Got unsupported message type: ${i._getType()}`);let s=i.name?`${i.name}, `:"",a=typeof i.content=="string"?i.content:JSON.stringify(i.content,null,2);n.push(`${o}: ${s}${a}`)}return n.join(`
`)}var $f,Tb=()=>{if($f===void 0){let t=ht("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};$f=new Qn(t)}return $f};var oo=class t extends Ct{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{exampleId:r,projectName:n,client:i}=e;this.projectName=n??ht("LANGCHAIN_PROJECT")??ht("LANGCHAIN_SESSION"),this.exampleId=r,this.client=i??Tb();let o=t.getTraceableRunTree();o&&this.updateFromRunTree(o)}async _convertToCreate(e,r=void 0){return{...e,extra:{...e.extra,runtime:await mb()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:r}}async persistRun(e){}async onRunCreate(e){let r=await this._convertToCreate(e,this.exampleId);await this.client.createRun(r)}async onRunUpdate(e){let r={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id,extra:e.extra};await this.client.updateRun(e.id,r)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let r=e,n=new Set;for(;r.parent_run&&!(n.has(r.id)||(n.add(r.id),!r.parent_run));)r=r.parent_run;n.clear();let i=[r];for(;i.length>0;){let o=i.shift();!o||n.has(o.id)||(n.add(o.id),this.runMap.set(o.id,o),o.child_runs&&i.push(...o.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){let r={},n=[];for(let[i,o]of this.runMap){let s=new Tr({...o,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});r[i]=s,n.push([i,o.dotted_order])}n.sort((i,o)=>!i[1]||!o[1]?0:i[1].localeCompare(o[1]));for(let[i]of n){let o=this.runMap.get(i),s=r[i];if(!(!o||!s)&&o.parent_run_id){let a=r[o.parent_run_id];a&&(a.child_runs.push(s),s.parent_run=a)}}return r[e]}static getTraceableRunTree(){try{return Xv()}catch{return}}};var Pu=Z(Zl(),1);var Mb=Symbol.for("ls:tracing_async_local_storage"),ri=Symbol.for("lc:context_variables"),kb=t=>{globalThis[Mb]=t},ln=()=>globalThis[Mb];var Ps;function UP(){let t="default"in Pu.default?Pu.default.default:Pu.default;return new t({autoStart:!0,concurrency:1})}function VP(){return typeof Ps>"u"&&(Ps=UP()),Ps}async function he(t,e){if(e===!0){let r=ln();r!==void 0?await r.run(void 0,async()=>t()):await t()}else Ps=VP(),Ps.add(async()=>{let r=ln();r!==void 0?await r.run(void 0,async()=>t()):await t()})}var Eb=t=>t!==void 0?t:!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(r=>ht(r)==="true");function Of(t){let e=ln();return e===void 0?void 0:e.getStore()?.[ri]?.[t]}var WP=Symbol("lc:configure_hooks"),Pb=()=>Of(WP)||[];var Ff=class{setHandler(e){return this.setHandlers([e])}},so=class{constructor(e,r,n,i,o,s,a,l){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:l})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(r=>he(async()=>{try{await r.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleText: ${n}`),r.raiseError)throw n}},r.awaitHandlers)))}async handleCustomEvent(e,r,n,i,o){await Promise.all(this.handlers.map(s=>he(async()=>{try{await s.handleCustomEvent?.(e,r,this.runId,this.tags,this.metadata)}catch(a){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleCustomEvent: ${a}`),s.raiseError)throw a}},s.awaitHandlers)))}},Nf=class extends so{getChild(e){let r=new ir(this.runId);return r.setHandlers(this.inheritableHandlers),r.addTags(this.inheritableTags),r.addMetadata(this.inheritableMetadata),e&&r.addTags([e],!1),r}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(r=>he(async()=>{if(!r.ignoreRetriever)try{await r.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleRetriever`),r.raiseError)throw n}},r.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(r=>he(async()=>{if(!r.ignoreRetriever)try{await r.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleRetrieverError: ${n}`),r.raiseError)throw e}},r.awaitHandlers)))}},Cu=class extends so{async handleLLMNewToken(e,r,n,i,o,s){await Promise.all(this.handlers.map(a=>he(async()=>{if(!a.ignoreLLM)try{await a.handleLLMNewToken?.(e,r??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,s)}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMNewToken: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}async handleLLMError(e,r,n,i,o){await Promise.all(this.handlers.map(s=>he(async()=>{if(!s.ignoreLLM)try{await s.handleLLMError?.(e,this.runId,this._parentRunId,this.tags,o)}catch(a){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleLLMError: ${a}`),s.raiseError)throw a}},s.awaitHandlers)))}async handleLLMEnd(e,r,n,i,o){await Promise.all(this.handlers.map(s=>he(async()=>{if(!s.ignoreLLM)try{await s.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags,o)}catch(a){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleLLMEnd: ${a}`),s.raiseError)throw a}},s.awaitHandlers)))}},Lf=class extends so{getChild(e){let r=new ir(this.runId);return r.setHandlers(this.inheritableHandlers),r.addTags(this.inheritableTags),r.addMetadata(this.inheritableMetadata),e&&r.addTags([e],!1),r}async handleChainError(e,r,n,i,o){await Promise.all(this.handlers.map(s=>he(async()=>{if(!s.ignoreChain)try{await s.handleChainError?.(e,this.runId,this._parentRunId,this.tags,o)}catch(a){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleChainError: ${a}`),s.raiseError)throw a}},s.awaitHandlers)))}async handleChainEnd(e,r,n,i,o){await Promise.all(this.handlers.map(s=>he(async()=>{if(!s.ignoreChain)try{await s.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,o)}catch(a){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleChainEnd: ${a}`),s.raiseError)throw a}},s.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(r=>he(async()=>{if(!r.ignoreAgent)try{await r.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleAgentAction: ${n}`),r.raiseError)throw n}},r.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(r=>he(async()=>{if(!r.ignoreAgent)try{await r.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleAgentEnd: ${n}`),r.raiseError)throw n}},r.awaitHandlers)))}},Rf=class extends so{getChild(e){let r=new ir(this.runId);return r.setHandlers(this.inheritableHandlers),r.addTags(this.inheritableTags),r.addMetadata(this.inheritableMetadata),e&&r.addTags([e],!1),r}async handleToolError(e){await Promise.all(this.handlers.map(r=>he(async()=>{if(!r.ignoreAgent)try{await r.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleToolError: ${n}`),r.raiseError)throw n}},r.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(r=>he(async()=>{if(!r.ignoreAgent)try{await r.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleToolEnd: ${n}`),r.raiseError)throw n}},r.awaitHandlers)))}},ir=class t extends Ff{constructor(e,r){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=r?.handlers??this.handlers,this.inheritableHandlers=r?.inheritableHandlers??this.inheritableHandlers,this.tags=r?.tags??this.tags,this.inheritableTags=r?.inheritableTags??this.inheritableTags,this.metadata=r?.metadata??this.metadata,this.inheritableMetadata=r?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,r,n=void 0,i=void 0,o=void 0,s=void 0,a=void 0,l=void 0){return Promise.all(r.map(async(u,c)=>{let d=c===0&&n?n:de();return await Promise.all(this.handlers.map(p=>{if(!p.ignoreLLM)return io(p)&&p._createRunForLLMStart(e,[u],d,this._parentRunId,o,this.tags,this.metadata,l),he(async()=>{try{await p.handleLLMStart?.(e,[u],d,this._parentRunId,o,this.tags,this.metadata,l)}catch(f){if((p.raiseError?console.error:console.warn)(`Error in handler ${p.constructor.name}, handleLLMStart: ${f}`),p.raiseError)throw f}},p.awaitHandlers)})),new Cu(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,r,n=void 0,i=void 0,o=void 0,s=void 0,a=void 0,l=void 0){return Promise.all(r.map(async(u,c)=>{let d=c===0&&n?n:de();return await Promise.all(this.handlers.map(p=>{if(!p.ignoreLLM)return io(p)&&p._createRunForChatModelStart(e,[u],d,this._parentRunId,o,this.tags,this.metadata,l),he(async()=>{try{if(p.handleChatModelStart)await p.handleChatModelStart?.(e,[u],d,this._parentRunId,o,this.tags,this.metadata,l);else if(p.handleLLMStart){let f=Sb(u);await p.handleLLMStart?.(e,[f],d,this._parentRunId,o,this.tags,this.metadata,l)}}catch(f){if((p.raiseError?console.error:console.warn)(`Error in handler ${p.constructor.name}, handleLLMStart: ${f}`),p.raiseError)throw f}},p.awaitHandlers)})),new Cu(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,r,n=de(),i=void 0,o=void 0,s=void 0,a=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreChain)return io(l)&&l._createRunForChainStart(e,r,n,this._parentRunId,this.tags,this.metadata,i,a),he(async()=>{try{await l.handleChainStart?.(e,r,n,this._parentRunId,this.tags,this.metadata,i,a)}catch(u){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleChainStart: ${u}`),l.raiseError)throw u}},l.awaitHandlers)})),new Lf(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,r,n=de(),i=void 0,o=void 0,s=void 0,a=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreAgent)return io(l)&&l._createRunForToolStart(e,r,n,this._parentRunId,this.tags,this.metadata,a),he(async()=>{try{await l.handleToolStart?.(e,r,n,this._parentRunId,this.tags,this.metadata,a)}catch(u){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleToolStart: ${u}`),l.raiseError)throw u}},l.awaitHandlers)})),new Rf(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,r,n=de(),i=void 0,o=void 0,s=void 0,a=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreRetriever)return io(l)&&l._createRunForRetrieverStart(e,r,n,this._parentRunId,this.tags,this.metadata,a),he(async()=>{try{await l.handleRetrieverStart?.(e,r,n,this._parentRunId,this.tags,this.metadata,a)}catch(u){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleRetrieverStart: ${u}`),l.raiseError)throw u}},l.awaitHandlers)})),new Nf(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,r,n,i,o){await Promise.all(this.handlers.map(s=>he(async()=>{if(!s.ignoreCustomEvent)try{await s.handleCustomEvent?.(e,r,n,this.tags,this.metadata)}catch(a){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleCustomEvent: ${a}`),s.raiseError)throw a}},s.awaitHandlers)))}addHandler(e,r=!0){this.handlers.push(e),r&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(r=>r!==e),this.inheritableHandlers=this.inheritableHandlers.filter(r=>r!==e)}setHandlers(e,r=!0){this.handlers=[],this.inheritableHandlers=[];for(let n of e)this.addHandler(n,r)}addTags(e,r=!0){this.removeTags(e),this.tags.push(...e),r&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(r=>!e.includes(r)),this.inheritableTags=this.inheritableTags.filter(r=>!e.includes(r))}addMetadata(e,r=!0){this.metadata={...this.metadata,...e},r&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(let r of Object.keys(e))delete this.metadata[r],delete this.inheritableMetadata[r]}copy(e=[],r=!0){let n=new t(this._parentRunId);for(let i of this.handlers){let o=this.inheritableHandlers.includes(i);n.addHandler(i,o)}for(let i of this.tags){let o=this.inheritableTags.includes(i);n.addTags([i],o)}for(let i of Object.keys(this.metadata)){let o=Object.keys(this.inheritableMetadata).includes(i);n.addMetadata({[i]:this.metadata[i]},o)}for(let i of e)n.handlers.filter(o=>o.name==="console_callback_handler").some(o=>o.name===i.name)||n.addHandler(i,r);return n}static fromHandlers(e){class r extends Yn{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:de()}),Object.assign(this,e)}}let n=new this;return n.addHandler(new r),n}static configure(e,r,n,i,o,s,a){return this._configureSync(e,r,n,i,o,s,a)}static _configureSync(e,r,n,i,o,s,a){let l;(e||r)&&(Array.isArray(e)||!e?(l=new t,l.setHandlers(e?.map(Cs)??[],!0)):l=e,l=l.copy(Array.isArray(r)?r.map(Cs):r?.handlers,!1));let u=ht("LANGCHAIN_VERBOSE")==="true"||a?.verbose,c=oo.getTraceableRunTree()?.tracingEnabled||Eb(),d=c||(ht("LANGCHAIN_TRACING")??!1);if(u||d){if(l||(l=new t),u&&!l.handlers.some(p=>p.name===Es.prototype.name)){let p=new Es;l.addHandler(p,!0)}if(d&&!l.handlers.some(p=>p.name==="langchain_tracer")&&c){let p=new oo;l.addHandler(p,!0),l._parentRunId=oo.getTraceableRunTree()?.id??l._parentRunId}}for(let{contextVar:p,inheritable:f=!0,handlerClass:_,envVar:w}of Pb()){let b=w&&ht(w)==="true"&&_,m,h=p!==void 0?Of(p):void 0;h&&gb(h)?m=h:b&&(m=new _({})),m!==void 0&&(l||(l=new t),l.handlers.some(g=>g.name===m.name)||l.addHandler(m,f))}return(n||i)&&l&&(l.addTags(n??[]),l.addTags(i??[],!1)),(o||s)&&l&&(l.addMetadata(o??{}),l.addMetadata(s??{},!1)),l}};function Cs(t){return"name"in t?t:Yn.fromMethods(t)}var Iu=class{getStore(){}run(e,r){return r()}enterWith(e){}},GP=new Iu,Cb=Symbol.for("lc:child_config"),Df=class{getInstance(){return ln()??GP}getRunnableConfig(){return this.getInstance().getStore()?.extra?.[Cb]}runWithConfig(e,r,n){let i=ir._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),o=this.getInstance(),s=o.getStore(),a=i?.getParentRunId(),l=i?.handlers?.find(c=>c?.name==="langchain_tracer"),u;return l&&a?u=l.convertToRunTree(a):n||(u=new Tr({name:"<runnable_lambda>",tracingEnabled:!1})),u&&(u.extra={...u.extra,[Cb]:e}),s!==void 0&&s[ri]!==void 0&&(u===void 0&&(u={}),u[ri]=s[ri]),o.run(u,r)}initializeGlobalInstance(e){ln()===void 0&&kb(e)}},mt=new Df;var Au=25;async function At(t){return ir._configureSync(t?.callbacks,void 0,t?.tags,void 0,t?.metadata)}function zf(...t){let e={};for(let r of t.filter(n=>!!n))for(let n of Object.keys(r))if(n==="metadata")e[n]={...e[n],...r[n]};else if(n==="tags"){let i=e[n]??[];e[n]=[...new Set(i.concat(r[n]??[]))]}else if(n==="configurable")e[n]={...e[n],...r[n]};else if(n==="timeout")e.timeout===void 0?e.timeout=r.timeout:r.timeout!==void 0&&(e.timeout=Math.min(e.timeout,r.timeout));else if(n==="signal")e.signal===void 0?e.signal=r.signal:r.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,r.signal]):e.signal=r.signal);else if(n==="callbacks"){let i=e.callbacks,o=r.callbacks;if(Array.isArray(o))if(!i)e.callbacks=o;else if(Array.isArray(i))e.callbacks=i.concat(o);else{let s=i.copy();for(let a of o)s.addHandler(Cs(a),!0);e.callbacks=s}else if(o)if(!i)e.callbacks=o;else if(Array.isArray(i)){let s=o.copy();for(let a of i)s.addHandler(Cs(a),!0);e.callbacks=s}else e.callbacks=new ir(o._parentRunId,{handlers:i.handlers.concat(o.handlers),inheritableHandlers:i.inheritableHandlers.concat(o.inheritableHandlers),tags:Array.from(new Set(i.tags.concat(o.tags))),inheritableTags:Array.from(new Set(i.inheritableTags.concat(o.inheritableTags))),metadata:{...i.metadata,...o.metadata}})}else{let i=n;e[i]=r[i]??e[i]}return e}var qP=new Set(["string","number","boolean"]);function ee(t){let e=mt.getRunnableConfig(),r={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){let{runId:n,runName:i,...o}=e;r=Object.entries(o).reduce((s,[a,l])=>(l!==void 0&&(s[a]=l),s),r)}if(t&&(r=Object.entries(t).reduce((n,[i,o])=>(o!==void 0&&(n[i]=o),n),r)),r?.configurable)for(let n of Object.keys(r.configurable))qP.has(typeof r.configurable[n])&&!r.metadata?.[n]&&(r.metadata||(r.metadata={}),r.metadata[n]=r.configurable[n]);if(r.timeout!==void 0){if(r.timeout<=0)throw new Error("Timeout must be a positive number");let n=AbortSignal.timeout(r.timeout);r.signal!==void 0?"any"in AbortSignal&&(r.signal=AbortSignal.any([r.signal,n])):r.signal=n,delete r.timeout}return r}function Ee(t={},{callbacks:e,maxConcurrency:r,recursionLimit:n,runName:i,configurable:o,runId:s}={}){let a=ee(t);return e!==void 0&&(delete a.runName,a.callbacks=e),n!==void 0&&(a.recursionLimit=n),r!==void 0&&(a.maxConcurrency=r),i!==void 0&&(a.runName=i),o!==void 0&&(a.configurable={...a.configurable,...o}),s!==void 0&&delete a.runId,a}function Cr(t){return t?{configurable:t.configurable,recursionLimit:t.recursionLimit,callbacks:t.callbacks,tags:t.tags,metadata:t.metadata,maxConcurrency:t.maxConcurrency,timeout:t.timeout,signal:t.signal}:void 0}async function or(t,e){if(e===void 0)return t;let r;return Promise.race([t.catch(n=>{if(!e?.aborted)throw n}),new Promise((n,i)=>{r=()=>{i(new Error("Aborted"))},e.addEventListener("abort",r),e.aborted&&i(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",r))}var Le=class t extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){let r=this.reader.cancel();this.reader.releaseLock(),await r}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){let r=e.getReader();return new t({start(n){return i();function i(){return r.read().then(({done:o,value:s})=>{if(o){n.close();return}return n.enqueue(s),i()})}},cancel(){r.releaseLock()}})}static fromAsyncGenerator(e){return new t({async pull(r){let{value:n,done:i}=await e.next();i&&r.close(),r.enqueue(n)},async cancel(r){await e.return(r)}})}};function jf(t,e=2){let r=Array.from({length:e},()=>[]);return r.map(async function*(i){for(;;)if(i.length===0){let o=await t.next();for(let s of r)s.push(o)}else{if(i[0].done)return;yield i.shift().value}})}function sr(t,e){if(Array.isArray(t)&&Array.isArray(e))return t.concat(e);if(typeof t=="string"&&typeof e=="string")return t+e;if(typeof t=="number"&&typeof e=="number")return t+e;if("concat"in t&&typeof t.concat=="function")return t.concat(e);if(typeof t=="object"&&typeof e=="object"){let r={...t};for(let[n,i]of Object.entries(e))n in r&&!Array.isArray(r[n])?r[n]=sr(r[n],i):r[n]=i;return r}else throw new Error(`Cannot concat ${typeof t} and ${typeof e}`)}var Ir=class{constructor(e){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise((r,n)=>{mt.runWithConfig(Cr(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(r,n):this.firstResult.then(i=>r(void 0),n)},!0)})}async next(...e){return this.signal?.throwIfAborted(),this.firstResultUsed?mt.runWithConfig(Cr(this.config),this.signal?async()=>or(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}};async function Ib(t,e,r,n,...i){let o=new Ir({generator:e,startSetup:r,signal:n}),s=await o.setup;return{output:t(o,s,...i),setup:s}}var Wt=class{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){let r=this.ops.concat(e.ops),n=Zn({},r);return new Is({ops:r,state:n[n.length-1].newDocument})}},Is=class t extends Wt{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let r=this.ops.concat(e.ops),n=Zn(this.state,e.ops);return new t({ops:r,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){let r=Zn({},e.ops);return new t({ops:e.ops,state:r[r.length-1].newDocument})}},Ob=t=>t.name==="log_stream_tracer";async function Ab(t,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:r}=t;if(["retriever","llm","prompt"].includes(t.run_type))return r;if(!(Object.keys(r).length===1&&r?.input===""))return r.input}async function $b(t,e){let{outputs:r}=t;return e==="original"||["retriever","llm","prompt"].includes(t.run_type)?r:r!==void 0&&Object.keys(r).length===1&&r?.output!==void 0?r.output:r}function HP(t){return t!==void 0&&t.message!==void 0}var As=class extends Ct{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Le.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;let r=e.tags??[],n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||r.find(i=>this.includeTags?.includes(i))!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&r.every(i=>!this.excludeTags?.includes(i))),n}async*tapOutputIterable(e,r){for await(let n of r){if(e!==this.rootId){let i=this.keyMapByRunId[e];i&&await this.writer.write(new Wt({ops:[{op:"add",path:`/logs/${i}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Wt({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let r=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=r===1?e.name:`${e.name}:${r}`;let n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=await Ab(e,this._schemaFormat)),await this.writer.write(new Wt({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{let r=this.keyMapByRunId[e.id];if(r===void 0)return;let n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${r}/inputs`,value:await Ab(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${r}/final_output`,value:await $b(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${r}/end_time`,value:new Date(e.end_time).toISOString()});let i=new Wt({ops:n});await this.writer.write(i)}finally{if(e.id===this.rootId){let r=new Wt({ops:[{op:"replace",path:"/final_output",value:await $b(e,this._schemaFormat)}]});await this.writer.write(r),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,r,n){let i=this.keyMapByRunId[e.id];if(i===void 0)return;let o=e.inputs.messages!==void 0,s;o?HP(n?.chunk)?s=n?.chunk:s=new ti({id:`run-${e.id}`,content:r}):s=r;let a=new Wt({ops:[{op:"add",path:`/logs/${i}/streamed_output_str/-`,value:r},{op:"add",path:`/logs/${i}/streamed_output/-`,value:s}]});await this.writer.write(a)}};var $s=class t{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new t({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}};function $u({name:t,serialized:e}){return t!==void 0?t:e?.name!==void 0?e.name:e?.id!==void 0&&Array.isArray(e?.id)?e.id[e.id.length-1]:"Unnamed"}var Fb=t=>t.name==="event_stream_tracer",Ou=class extends Ct{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Le.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){let r=e.tags??[],n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(n=n||r.find(i=>this.includeTags?.includes(i))!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(n=n&&r.every(i=>!this.excludeTags?.includes(i))),n}async*tapOutputIterable(e,r){let n=await r.next();if(n.done)return;let i=this.runInfoMap.get(e);if(i===void 0){yield n.value;return}function o(a,l){return a==="llm"&&typeof l=="string"?new $s({text:l}):l}let s=this.tappedPromises.get(e);if(s===void 0){let a;s=new Promise(l=>{a=l}),this.tappedPromises.set(e,s);try{let l={event:`on_${i.runType}_stream`,run_id:e,name:i.name,tags:i.tags,metadata:i.metadata,data:{}};await this.send({...l,data:{chunk:o(i.runType,n.value)}},i),yield n.value;for await(let u of r)i.runType!=="tool"&&i.runType!=="retriever"&&await this.send({...l,data:{chunk:o(i.runType,u)}},i),yield u}finally{a()}}else{yield n.value;for await(let a of r)yield a}}async send(e,r){this._includeRun(r)&&await this.writer.write(e)}async sendEndEvent(e,r){let n=this.tappedPromises.get(e.run_id);n!==void 0?n.then(()=>{this.send(e,r)}):await this.send(e,r)}async onLLMStart(e){let r=$u(e),n=e.inputs.messages!==void 0?"chat_model":"llm",i={tags:e.tags??[],metadata:e.extra?.metadata??{},name:r,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,i);let o=`on_${n}_start`;await this.send({event:o,data:{input:e.inputs},name:r,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},i)}async onLLMNewToken(e,r,n){let i=this.runInfoMap.get(e.id),o,s;if(i===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(i.runType==="chat_model")s="on_chat_model_stream",n?.chunk===void 0?o=new ti({content:r,id:`run-${e.id}`}):o=n.chunk.message;else if(i.runType==="llm")s="on_llm_stream",n?.chunk===void 0?o=new $s({text:r}):o=n.chunk;else throw new Error(`Unexpected run type ${i.runType}`);await this.send({event:s,data:{chunk:o},run_id:e.id,name:i.name,tags:i.tags,metadata:i.metadata},i)}}async onLLMEnd(e){let r=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let n;if(r===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);let i=e.outputs?.generations,o;if(r.runType==="chat_model"){for(let s of i??[]){if(o!==void 0)break;o=s[0]?.message}n="on_chat_model_end"}else if(r.runType==="llm")o={generations:i?.map(s=>s.map(a=>({text:a.text,generationInfo:a.generationInfo}))),llmOutput:e.outputs?.llmOutput??{}},n="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${r.runType}`);await this.sendEndEvent({event:n,data:{output:o,input:r.inputs},run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata},r)}async onChainStart(e){let r=$u(e),n=e.run_type??"chain",i={tags:e.tags??[],metadata:e.extra?.metadata??{},name:r,runType:e.run_type},o={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(o={},i.inputs={}):e.inputs.input!==void 0?(o.input=e.inputs.input,i.inputs=e.inputs.input):(o.input=e.inputs,i.inputs=e.inputs),this.runInfoMap.set(e.id,i),await this.send({event:`on_${n}_start`,data:o,name:r,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},i)}async onChainEnd(e){let r=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),r===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);let n=`on_${e.run_type}_end`,i=e.inputs??r.inputs??{},s={output:e.outputs?.output??e.outputs,input:i};i.input&&Object.keys(i).length===1&&(s.input=i.input,r.inputs=i.input),await this.sendEndEvent({event:n,data:s,run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata??{}},r)}async onToolStart(e){let r=$u(e),n={tags:e.tags??[],metadata:e.extra?.metadata??{},name:r,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:r,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},n)}async onToolEnd(e){let r=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),r===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(r.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);let n=e.outputs?.output===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:n,input:r.inputs},run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata},r)}async onRetrieverStart(e){let r=$u(e),i={tags:e.tags??[],metadata:e.extra?.metadata??{},name:r,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,i),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:r,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},i)}async onRetrieverEnd(e){let r=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),r===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:r.inputs},run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata},r)}async handleCustomEvent(e,r,n){let i=this.runInfoMap.get(n);if(i===void 0)throw new Error(`handleCustomEvent: Run ID ${n} not found in run map.`);await this.send({event:"on_custom_event",run_id:n,name:e,tags:i.tags,metadata:i.metadata,data:r},i)}async finish(){let e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}};var Nb=Z(Wl(),1),Fu=Z(Zl(),1),KP=[400,401,402,403,404,405,406,407,409],QP=t=>{if(t.message.startsWith("Cancel")||t.message.startsWith("AbortError")||t.name==="AbortError"||t?.code==="ECONNABORTED")throw t;let e=t?.response?.status??t?.status;if(e&&KP.includes(+e))throw t;if(t?.error?.code==="insufficient_quota"){let r=new Error(t?.message);throw r.name="InsufficientQuotaError",r}},Os=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??QP;let r="default"in Fu.default?Fu.default.default:Fu.default;this.queue=new r({concurrency:this.maxConcurrency})}call(e,...r){return this.queue.add(()=>(0,Nb.default)(()=>e(...r).catch(n=>{throw n instanceof Error?n:new Error(n)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,r,...n){return e.signal?Promise.race([this.call(r,...n),new Promise((i,o)=>{e.signal?.addEventListener("abort",()=>{o(new Error("AbortError"))})})]):this.call(r,...n)}fetch(...e){return this.call(()=>fetch(...e).then(r=>r.ok?r:Promise.reject(r)))}};var Fs=class extends Ct{constructor({config:e,onStart:r,onEnd:n,onError:i}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=r,this.argOnEnd=n,this.argOnError=i}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}};function Ns(t){return t?t.lc_runnable:!1}var Nu=class{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,r){let n=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0,i=e.tags??[];return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(r)),this.includeTags!==void 0&&(n=n||i.some(o=>this.includeTags?.includes(o))),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(r)),this.excludeTags!==void 0&&(n=n&&i.every(o=>!this.excludeTags?.includes(o))),n}};var Rb=Symbol("Let zodToJsonSchema decide on which parser to use");var Lb={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Db=t=>typeof t=="string"?{...Lb,name:t}:{...Lb,...t};var zb=t=>{let e=Db(t),r=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,i])=>[i._def,{def:i._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function Bf(t,e,r,n){n?.errorMessages&&r&&(t.errorMessage={...t.errorMessage,[e]:r})}function q(t,e,r,n,i){t[e]=r,Bf(t,e,n,i)}function jb(){return{}}function Bb(t,e){let r={type:"array"};return t.type?._def&&t.type?._def?.typeName!==T.ZodAny&&(r.items=R(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&q(r,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&q(r,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(q(r,"minItems",t.exactLength.value,t.exactLength.message,e),q(r,"maxItems",t.exactLength.value,t.exactLength.message,e)),r}function Ub(t,e){let r={type:"integer",format:"int64"};if(!t.checks)return r;for(let n of t.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?q(r,"minimum",n.value,n.message,e):q(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),q(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?q(r,"maximum",n.value,n.message,e):q(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),q(r,"maximum",n.value,n.message,e));break;case"multipleOf":q(r,"multipleOf",n.value,n.message,e);break}return r}function Vb(){return{type:"boolean"}}function Lu(t,e){return R(t.type._def,e)}var Wb=(t,e)=>R(t.innerType._def,e);function Uf(t,e,r){let n=r??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((i,o)=>Uf(t,e,i))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return JP(t,e)}}var JP=(t,e)=>{let r={type:"integer",format:"unix-time"};if(e.target==="openApi3")return r;for(let n of t.checks)switch(n.kind){case"min":q(r,"minimum",n.value,n.message,e);break;case"max":q(r,"maximum",n.value,n.message,e);break}return r};function Gb(t,e){return{...R(t.innerType._def,e),default:t.defaultValue()}}function qb(t,e){return e.effectStrategy==="input"?R(t.schema._def,e):{}}function Hb(t){return{type:"string",enum:Array.from(t.values)}}var XP=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function Kb(t,e){let r=[R(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),R(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(o=>!!o),n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,i=[];return r.forEach(o=>{if(XP(o))i.push(...o.allOf),o.unevaluatedProperties===void 0&&(n=void 0);else{let s=o;if("additionalProperties"in o&&o.additionalProperties===!1){let{additionalProperties:a,...l}=o;s=l}else n=void 0;i.push(s)}}),i.length?{allOf:i,...n}:void 0}function Qb(t,e){let r=typeof t.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[t.value]}:{type:r==="bigint"?"integer":r,const:t.value}}var Vf,Gt={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Vf===void 0&&(Vf=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Vf),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Ru(t,e){let r={type:"string"};if(t.checks)for(let n of t.checks)switch(n.kind){case"min":q(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,e);break;case"max":q(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":qt(r,"email",n.message,e);break;case"format:idn-email":qt(r,"idn-email",n.message,e);break;case"pattern:zod":Ke(r,Gt.email,n.message,e);break}break;case"url":qt(r,"uri",n.message,e);break;case"uuid":qt(r,"uuid",n.message,e);break;case"regex":Ke(r,n.regex,n.message,e);break;case"cuid":Ke(r,Gt.cuid,n.message,e);break;case"cuid2":Ke(r,Gt.cuid2,n.message,e);break;case"startsWith":Ke(r,RegExp(`^${Wf(n.value,e)}`),n.message,e);break;case"endsWith":Ke(r,RegExp(`${Wf(n.value,e)}$`),n.message,e);break;case"datetime":qt(r,"date-time",n.message,e);break;case"date":qt(r,"date",n.message,e);break;case"time":qt(r,"time",n.message,e);break;case"duration":qt(r,"duration",n.message,e);break;case"length":q(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,e),q(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,e);break;case"includes":{Ke(r,RegExp(Wf(n.value,e)),n.message,e);break}case"ip":{n.version!=="v6"&&qt(r,"ipv4",n.message,e),n.version!=="v4"&&qt(r,"ipv6",n.message,e);break}case"base64url":Ke(r,Gt.base64url,n.message,e);break;case"jwt":Ke(r,Gt.jwt,n.message,e);break;case"cidr":{n.version!=="v6"&&Ke(r,Gt.ipv4Cidr,n.message,e),n.version!=="v4"&&Ke(r,Gt.ipv6Cidr,n.message,e);break}case"emoji":Ke(r,Gt.emoji(),n.message,e);break;case"ulid":{Ke(r,Gt.ulid,n.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{qt(r,"binary",n.message,e);break}case"contentEncoding:base64":{q(r,"contentEncoding","base64",n.message,e);break}case"pattern:zod":{Ke(r,Gt.base64,n.message,e);break}}break}case"nanoid":Ke(r,Gt.nanoid,n.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return r}function Wf(t,e){return e.patternStrategy==="escape"?YP(t):t}var ZP=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function YP(t){let e="";for(let r=0;r<t.length;r++)ZP.has(t[r])||(e+="\\"),e+=t[r];return e}function qt(t,e,r,n){t.format||t.anyOf?.some(i=>i.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&n.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...r&&n.errorMessages&&{errorMessage:{format:r}}})):q(t,"format",e,r,n)}function Ke(t,e,r,n){t.pattern||t.allOf?.some(i=>i.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&n.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:Jb(e,n),...r&&n.errorMessages&&{errorMessage:{pattern:r}}})):q(t,"pattern",Jb(e,n),r,n)}function Jb(t,e){if(!e.applyRegexFlags||!t.flags)return t.source;let r={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},n=r.i?t.source.toLowerCase():t.source,i="",o=!1,s=!1,a=!1;for(let l=0;l<n.length;l++){if(o){i+=n[l],o=!1;continue}if(r.i){if(s){if(n[l].match(/[a-z]/)){a?(i+=n[l],i+=`${n[l-2]}-${n[l]}`.toUpperCase(),a=!1):n[l+1]==="-"&&n[l+2]?.match(/[a-z]/)?(i+=n[l],a=!0):i+=`${n[l]}${n[l].toUpperCase()}`;continue}}else if(n[l].match(/[a-z]/)){i+=`[${n[l]}${n[l].toUpperCase()}]`;continue}}if(r.m){if(n[l]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(n[l]==="$"){i+=`($|(?=[\r
]))`;continue}}if(r.s&&n[l]==="."){i+=s?`${n[l]}\r
`:`[${n[l]}\r
]`;continue}i+=n[l],n[l]==="\\"?o=!0:s&&n[l]==="]"?s=!1:!s&&n[l]==="["&&(s=!0)}try{new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return i}function Du(t,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&t.keyType?._def.typeName===T.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((n,i)=>({...n,[i]:R(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",i]})??{}}),{}),additionalProperties:e.rejectedAdditionalProperties};let r={type:"object",additionalProperties:R(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return r;if(t.keyType?._def.typeName===T.ZodString&&t.keyType._def.checks?.length){let{type:n,...i}=Ru(t.keyType._def,e);return{...r,propertyNames:i}}else{if(t.keyType?._def.typeName===T.ZodEnum)return{...r,propertyNames:{enum:t.keyType._def.values}};if(t.keyType?._def.typeName===T.ZodBranded&&t.keyType._def.type._def.typeName===T.ZodString&&t.keyType._def.type._def.checks?.length){let{type:n,...i}=Lu(t.keyType._def,e);return{...r,propertyNames:i}}}return r}function Xb(t,e){if(e.mapStrategy==="record")return Du(t,e);let r=R(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=R(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[r,n],minItems:2,maxItems:2}}}function Zb(t){let e=t.values,n=Object.keys(t.values).filter(o=>typeof e[e[o]]!="number").map(o=>e[o]),i=Array.from(new Set(n.map(o=>typeof o)));return{type:i.length===1?i[0]==="string"?"string":"number":["string","number"],enum:n}}function Yb(){return{not:{}}}function e0(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var Ls={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function r0(t,e){if(e.target==="openApi3")return t0(t,e);let r=t.options instanceof Map?Array.from(t.options.values()):t.options;if(r.every(n=>n._def.typeName in Ls&&(!n._def.checks||!n._def.checks.length))){let n=r.reduce((i,o)=>{let s=Ls[o._def.typeName];return s&&!i.includes(s)?[...i,s]:i},[]);return{type:n.length>1?n:n[0]}}else if(r.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=r.reduce((i,o)=>{let s=typeof o._def.value;switch(s){case"string":case"number":case"boolean":return[...i,s];case"bigint":return[...i,"integer"];case"object":if(o._def.value===null)return[...i,"null"];case"symbol":case"undefined":case"function":default:return i}},[]);if(n.length===r.length){let i=n.filter((o,s,a)=>a.indexOf(o)===s);return{type:i.length>1?i:i[0],enum:r.reduce((o,s)=>o.includes(s._def.value)?o:[...o,s._def.value],[])}}}else if(r.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((n,i)=>[...n,...i._def.values.filter(o=>!n.includes(o))],[])};return t0(t,e)}var t0=(t,e)=>{let r=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((n,i)=>R(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${i}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return r.length?{anyOf:r}:void 0};function n0(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"?{type:Ls[t.innerType._def.typeName],nullable:!0}:{type:[Ls[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let n=R(t.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}let r=R(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function i0(t,e){let r={type:"number"};if(!t.checks)return r;for(let n of t.checks)switch(n.kind){case"int":r.type="integer",Bf(r,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?q(r,"minimum",n.value,n.message,e):q(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),q(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?q(r,"maximum",n.value,n.message,e):q(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),q(r,"maximum",n.value,n.message,e));break;case"multipleOf":q(r,"multipleOf",n.value,n.message,e);break}return r}function o0(t,e){let r=e.target==="openAi",n={type:"object",properties:{}},i=[],o=t.shape();for(let a in o){let l=o[a];if(l===void 0||l._def===void 0)continue;let u=tC(l);u&&r&&(l instanceof tt&&(l=l._def.innerType),l.isNullable()||(l=l.nullable()),u=!1);let c=R(l._def,{...e,currentPath:[...e.currentPath,"properties",a],propertyPath:[...e.currentPath,"properties",a]});c!==void 0&&(n.properties[a]=c,u||i.push(a))}i.length&&(n.required=i);let s=eC(t,e);return s!==void 0&&(n.additionalProperties=s),n}function eC(t,e){if(t.catchall._def.typeName!=="ZodNever")return R(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function tC(t){try{return t.isOptional()}catch{return!0}}var s0=(t,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return R(t.innerType._def,e);let r=R(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{}};var a0=(t,e)=>{if(e.pipeStrategy==="input")return R(t.in._def,e);if(e.pipeStrategy==="output")return R(t.out._def,e);let r=R(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=R(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,n].filter(i=>i!==void 0)}};function l0(t,e){return R(t.type._def,e)}function u0(t,e){let n={type:"array",uniqueItems:!0,items:R(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&q(n,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&q(n,"maxItems",t.maxSize.value,t.maxSize.message,e),n}function c0(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((r,n)=>R(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[]),additionalItems:R(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((r,n)=>R(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[])}}function d0(){return{not:{}}}function p0(){return{}}var f0=(t,e)=>R(t.innerType._def,e);var h0=(t,e,r)=>{switch(e){case T.ZodString:return Ru(t,r);case T.ZodNumber:return i0(t,r);case T.ZodObject:return o0(t,r);case T.ZodBigInt:return Ub(t,r);case T.ZodBoolean:return Vb();case T.ZodDate:return Uf(t,r);case T.ZodUndefined:return d0();case T.ZodNull:return e0(r);case T.ZodArray:return Bb(t,r);case T.ZodUnion:case T.ZodDiscriminatedUnion:return r0(t,r);case T.ZodIntersection:return Kb(t,r);case T.ZodTuple:return c0(t,r);case T.ZodRecord:return Du(t,r);case T.ZodLiteral:return Qb(t,r);case T.ZodEnum:return Hb(t);case T.ZodNativeEnum:return Zb(t);case T.ZodNullable:return n0(t,r);case T.ZodOptional:return s0(t,r);case T.ZodMap:return Xb(t,r);case T.ZodSet:return u0(t,r);case T.ZodLazy:return()=>t.getter()._def;case T.ZodPromise:return l0(t,r);case T.ZodNaN:case T.ZodNever:return Yb();case T.ZodEffects:return qb(t,r);case T.ZodAny:return jb();case T.ZodUnknown:return p0();case T.ZodDefault:return Gb(t,r);case T.ZodBranded:return Lu(t,r);case T.ZodReadonly:return f0(t,r);case T.ZodCatch:return Wb(t,r);case T.ZodPipeline:return a0(t,r);case T.ZodFunction:case T.ZodVoid:case T.ZodSymbol:return;default:return(n=>{})(e)}};function R(t,e,r=!1){let n=e.seen.get(t);if(e.override){let a=e.override?.(t,e,n,r);if(a!==Rb)return a}if(n&&!r){let a=rC(n,e);if(a!==void 0)return a}let i={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,i);let o=h0(t,t.typeName,e),s=typeof o=="function"?R(o(),e):o;if(s&&iC(t,e,s),e.postProcess){let a=e.postProcess(s,t,e);return i.jsonSchema=s,a}return i.jsonSchema=s,s}var rC=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:nC(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((r,n)=>e.currentPath[n]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},nC=(t,e)=>{let r=0;for(;r<t.length&&r<e.length&&t[r]===e[r];r++);return[(t.length-r).toString(),...e.slice(r)].join("/")},iC=(t,e,r)=>(t.description&&(r.description=t.description,e.markdownDescription&&(r.markdownDescription=t.description)),r);var Gf=(t,e)=>{let r=zb(e),n=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((l,[u,c])=>({...l,[u]:R(c._def,{...r,currentPath:[...r.basePath,r.definitionPath,u]},!0)??{}}),{}):void 0,i=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,o=R(t._def,i===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,i]},!1)??{},s=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;s!==void 0&&(o.title=s);let a=i===void 0?n?{...o,[r.definitionPath]:n}:o:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,i].join("/"),[r.definitionPath]:{...n,[i]:o}};return r.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":(r.target==="jsonSchema2019-09"||r.target==="openAi")&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),r.target==="openAi"&&("anyOf"in a||"oneOf"in a||"allOf"in a||"type"in a&&Array.isArray(a.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),a};function qf(t){return t.replace(/[^a-zA-Z-_0-9]/g,"_")}var oC=["*","_","`"];function sC(t){let e="";for(let[r,n]of Object.entries(t))e+=`	classDef ${r} ${n};
`;return e}function m0(t,e,r){let{firstNode:n,lastNode:i,nodeColors:o,withStyles:s=!0,curveStyle:a="linear",wrapLabelNWords:l=9}=r??{},u=s?`%%{init: {'flowchart': {'curve': '${a}'}}}%%
graph TD;
`:`graph TD;
`;if(s){let f="default",_={[f]:"{0}({1})"};n!==void 0&&(_[n]="{0}([{1}]):::first"),i!==void 0&&(_[i]="{0}([{1}]):::last");for(let[w,b]of Object.entries(t)){let m=b.name.split(":").pop()??"",g=oC.some(v=>m.startsWith(v)&&m.endsWith(v))?`<p>${m}</p>`:m;Object.keys(b.metadata??{}).length&&(g+=`<hr/><small><em>${Object.entries(b.metadata??{}).map(([v,x])=>`${v} = ${x}`).join(`
`)}</em></small>`);let y=(_[w]??_[f]).replace("{0}",qf(w)).replace("{1}",g);u+=`	${y}
`}}let c={};for(let f of e){let _=f.source.split(":"),w=f.target.split(":"),b=_.filter((m,h)=>m===w[h]).join(":");c[b]||(c[b]=[]),c[b].push(f)}let d=new Set;function p(f,_){let w=f.length===1&&f[0].source===f[0].target;if(_&&!w){let b=_.split(":").pop();if(d.has(b))throw new Error(`Found duplicate subgraph '${b}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(b),u+=`	subgraph ${b}
`}for(let b of f){let{source:m,target:h,data:g,conditional:y}=b,v="";if(g!==void 0){let x=g,k=x.split(" ");k.length>l&&(x=Array.from({length:Math.ceil(k.length/l)},(E,H)=>k.slice(H*l,(H+1)*l).join(" ")).join("&nbsp;<br>&nbsp;")),v=y?` -. &nbsp;${x}&nbsp; .-> `:` -- &nbsp;${x}&nbsp; --> `}else v=y?" -.-> ":" --> ";u+=`	${qf(m)}${v}${qf(h)};
`}for(let b in c)b.startsWith(`${_}:`)&&b!==_&&p(c[b],b);_&&!w&&(u+=`	end
`)}p(c[""]??[],"");for(let f in c)!f.includes(":")&&f!==""&&p(c[f],f);return s&&(u+=sC(o??{})),u}async function g0(t,e){let{backgroundColor:r="white"}=e??{},n=btoa(t);r!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(r)||(r=`!${r}`));let i=`https://mermaid.ink/img/${n}?bgColor=${r}`,o=await fetch(i);if(!o.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${o.status}`,`Status text: ${o.statusText}`].join(`
`));return await o.blob()}function aC(t,e){if(t!==void 0&&!sn(t))return t;if(Ns(e))try{let r=e.getName();return r=r.startsWith("Runnable")?r.slice(8):r,r}catch{return e.getName()}else return e.name??"UnknownSchema"}function lC(t){return Ns(t.data)?{type:"runnable",data:{id:t.data.lc_id,name:t.data.getName()}}:{type:"schema",data:{...Gf(t.data.schema),title:t.data.name}}}var Rs=class t{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=e?.nodes??this.nodes,this.edges=e?.edges??this.edges}toJSON(){let e={};return Object.values(this.nodes).forEach((r,n)=>{e[r.id]=sn(r.id)?n:r.id}),{nodes:Object.values(this.nodes).map(r=>({id:e[r.id],...lC(r)})),edges:this.edges.map(r=>{let n={source:e[r.source],target:e[r.target]};return typeof r.data<"u"&&(n.data=r.data),typeof r.conditional<"u"&&(n.conditional=r.conditional),n})}}addNode(e,r,n){if(r!==void 0&&this.nodes[r]!==void 0)throw new Error(`Node with id ${r} already exists`);let i=r??de(),o={id:i,data:e,name:aC(r,e),metadata:n};return this.nodes[i]=o,o}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(r=>r.source!==e.id&&r.target!==e.id)}addEdge(e,r,n,i){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[r.id]===void 0)throw new Error(`Target node ${r.id} not in graph`);let o={source:e.id,target:r.id,data:n,conditional:i};return this.edges.push(o),o}firstNode(){return _0(this)}lastNode(){return y0(this)}extend(e,r=""){let n=r;Object.values(e.nodes).map(u=>u.id).every(sn)&&(n="");let o=u=>n?`${n}:${u}`:u;Object.entries(e.nodes).forEach(([u,c])=>{this.nodes[o(u)]={...c,id:o(u)}});let s=e.edges.map(u=>({...u,source:o(u.source),target:o(u.target)}));this.edges=[...this.edges,...s];let a=e.firstNode(),l=e.lastNode();return[a?{id:o(a.id),data:a.data}:void 0,l?{id:o(l.id),data:l.data}:void 0]}trimFirstNode(){let e=this.firstNode();e&&_0(this,[e.id])&&this.removeNode(e)}trimLastNode(){let e=this.lastNode();e&&y0(this,[e.id])&&this.removeNode(e)}reid(){let e=Object.fromEntries(Object.values(this.nodes).map(i=>[i.id,i.name])),r=new Map;Object.values(e).forEach(i=>{r.set(i,(r.get(i)||0)+1)});let n=i=>{let o=e[i];return sn(i)&&r.get(o)===1?o:i};return new t({nodes:Object.fromEntries(Object.entries(this.nodes).map(([i,o])=>[n(i),{...o,id:n(i)}])),edges:this.edges.map(i=>({...i,source:n(i.source),target:n(i.target)}))})}drawMermaid(e){let{withStyles:r,curveStyle:n,nodeColors:i={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:o}=e??{},s=this.reid(),a=s.firstNode(),l=s.lastNode();return m0(s.nodes,s.edges,{firstNode:a?.id,lastNode:l?.id,withStyles:r,curveStyle:n,nodeColors:i,wrapLabelNWords:o})}async drawMermaidPng(e){let r=this.drawMermaid(e);return g0(r,{backgroundColor:e?.backgroundColor})}};function _0(t,e=[]){let r=new Set(t.edges.filter(i=>!e.includes(i.source)).map(i=>i.target)),n=[];for(let i of Object.values(t.nodes))!e.includes(i.id)&&!r.has(i.id)&&n.push(i);return n.length===1?n[0]:void 0}function y0(t,e=[]){let r=new Set(t.edges.filter(i=>!e.includes(i.target)).map(i=>i.source)),n=[];for(let i of Object.values(t.nodes))!e.includes(i.id)&&!r.has(i.id)&&n.push(i);return n.length===1?n[0]:void 0}function w0(t){let e=new TextEncoder,r=new ReadableStream({async start(n){for await(let i of t)n.enqueue(e.encode(`event: data
data: ${JSON.stringify(i)}

`));n.enqueue(e.encode(`event: end

`)),n.close()}});return Le.fromReadableStream(r)}function Hf(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.iterator]=="function"&&typeof t.next=="function"}var v0=t=>t!=null&&typeof t=="object"&&"next"in t&&typeof t.next=="function";function zu(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.asyncIterator]=="function"}function*Kf(t,e){for(;;){let{value:r,done:n}=mt.runWithConfig(Cr(t),e.next.bind(e),!0);if(n)break;yield r}}async function*ju(t,e){let r=e[Symbol.asyncIterator]();for(;;){let{value:n,done:i}=await mt.runWithConfig(Cr(t),r.next.bind(e),!0);if(i)break;yield n}}function be(t,e){return t&&!Array.isArray(t)&&!(t instanceof Date)&&typeof t=="object"?t:{[e]:t}}var xe=class extends kr{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){let r=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${r}${e}`:r}bind(e){return new ii({bound:this,kwargs:e,config:{}})}map(){return new Jf({bound:this})}withRetry(e){return new Xf({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new ii({bound:this,config:e,kwargs:{}})}withFallbacks(e){let r=Array.isArray(e)?e:e.fallbacks;return new Yf({runnable:this,fallbacks:r})}_getOptionsList(e,r=0){if(Array.isArray(e)&&e.length!==r)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${r} inputs`);if(Array.isArray(e))return e.map(ee);if(r>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");let n=Object.fromEntries(Object.entries(e).filter(([i])=>i!=="runId"));return Array.from({length:r},(i,o)=>ee(o===0?e:n))}return Array.from({length:r},()=>ee(e))}async batch(e,r,n){let i=this._getOptionsList(r??{},e.length),o=i[0]?.maxConcurrency??n?.maxConcurrency,s=new Os({maxConcurrency:o,onFailedAttempt:l=>{throw l}}),a=e.map((l,u)=>s.call(async()=>{try{return await this.invoke(l,i[u])}catch(c){if(n?.returnExceptions)return c;throw c}}));return Promise.all(a)}async*_streamIterator(e,r){yield this.invoke(e,r)}async stream(e,r){let n=ee(r),i=new Ir({generator:this._streamIterator(e,n),config:n});return await i.setup,Le.fromAsyncGenerator(i)}_separateRunnableConfigFromCallOptions(e){let r;e===void 0?r=ee(e):r=ee({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});let n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,delete n.timeout,delete n.signal,[r,n]}async _callWithConfig(e,r,n){let i=ee(n),s=await(await At(i))?.handleChainStart(this.toJSON(),be(r,"input"),i.runId,i?.runType,void 0,void 0,i?.runName??this.getName());delete i.runId;let a;try{let l=e.call(this,r,i,s);a=await or(l,n?.signal)}catch(l){throw await s?.handleChainError(l),l}return await s?.handleChainEnd(be(a,"output")),a}async _batchWithConfig(e,r,n,i){let o=this._getOptionsList(n??{},r.length),s=await Promise.all(o.map(At)),a=await Promise.all(s.map(async(u,c)=>{let d=await u?.handleChainStart(this.toJSON(),be(r[c],"input"),o[c].runId,o[c].runType,void 0,void 0,o[c].runName??this.getName());return delete o[c].runId,d})),l;try{let u=e.call(this,r,o,a,i);l=await or(u,o?.[0]?.signal)}catch(u){throw await Promise.all(a.map(c=>c?.handleChainError(u))),u}return await Promise.all(a.map(u=>u?.handleChainEnd(be(l,"output")))),l}async*_transformStreamWithConfig(e,r,n){let i,o=!0,s,a=!0,l=ee(n),u=await At(l);async function*c(){for await(let p of e){if(o)if(i===void 0)i=p;else try{i=sr(i,p)}catch{i=void 0,o=!1}yield p}}let d;try{let p=await Ib(r.bind(this),c(),async()=>u?.handleChainStart(this.toJSON(),{input:""},l.runId,l.runType,void 0,void 0,l.runName??this.getName()),n?.signal,l);delete l.runId,d=p.setup;let f=d?.handlers.find(Fb),_=p.output;f!==void 0&&d!==void 0&&(_=f.tapOutputIterable(d.runId,_));let w=d?.handlers.find(Ob);w!==void 0&&d!==void 0&&(_=w.tapOutputIterable(d.runId,_));for await(let b of _)if(yield b,a)if(s===void 0)s=b;else try{s=sr(s,b)}catch{s=void 0,a=!1}}catch(p){throw await d?.handleChainError(p,void 0,void 0,void 0,{inputs:be(i,"input")}),p}await d?.handleChainEnd(s??{},void 0,void 0,void 0,{inputs:be(i,"input")})}getGraph(e){let r=new Rs,n=r.addNode({name:`${this.getName()}Input`,schema:Yi.any()}),i=r.addNode(this),o=r.addNode({name:`${this.getName()}Output`,schema:Yi.any()});return r.addEdge(n,i),r.addEdge(i,o),r}pipe(e){return new Bu({first:this,last:ni(e)})}pick(e){return this.pipe(new th(e))}assign(e){return this.pipe(new eh(new Ds({steps:e})))}async*transform(e,r){let n;for await(let i of e)n===void 0?n=i:n=sr(n,i);yield*this._streamIterator(n,ee(r))}async*streamLog(e,r,n){let i=new As({...n,autoClose:!1,_schemaFormat:"original"}),o=ee(r);yield*this._streamLog(e,i,o)}async*_streamLog(e,r,n){let{callbacks:i}=n;if(i===void 0)n.callbacks=[r];else if(Array.isArray(i))n.callbacks=i.concat([r]);else{let l=i.copy();l.addHandler(r,!0),n.callbacks=l}let o=this.stream(e,n);async function s(){try{let l=await o;for await(let u of l){let c=new Wt({ops:[{op:"add",path:"/streamed_output/-",value:u}]});await r.writer.write(c)}}finally{await r.writer.close()}}let a=s();try{for await(let l of r)yield l}finally{await a}}streamEvents(e,r,n){let i;if(r.version==="v1")i=this._streamEventsV1(e,r,n);else if(r.version==="v2")i=this._streamEventsV2(e,r,n);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return r.encoding==="text/event-stream"?w0(i):Le.fromAsyncGenerator(i)}async*_streamEventsV2(e,r,n){let i=new Ou({...n,autoClose:!1}),o=ee(r),s=o.runId??de();o.runId=s;let a=o.callbacks;if(a===void 0)o.callbacks=[i];else if(Array.isArray(a))o.callbacks=a.concat(i);else{let _=a.copy();_.addHandler(i,!0),o.callbacks=_}let l=new AbortController,u=this;async function c(){try{let _;r?.signal?"any"in AbortSignal?_=AbortSignal.any([l.signal,r.signal]):(_=r.signal,r.signal.addEventListener("abort",()=>{l.abort()},{once:!0})):_=l.signal;let w=await u.stream(e,{...o,signal:_}),b=i.tapOutputIterable(s,w);for await(let m of b)if(l.signal.aborted)break}finally{await i.finish()}}let d=c(),p=!1,f;try{for await(let _ of i){if(!p){_.data.input=e,p=!0,f=_.run_id,yield _;continue}_.run_id===f&&_.event.endsWith("_end")&&_.data?.input&&delete _.data.input,yield _}}finally{l.abort(),await d}}async*_streamEventsV1(e,r,n){let i,o=!1,s=ee(r),a=s.tags??[],l=s.metadata??{},u=s.runName??this.getName(),c=new As({...n,autoClose:!1,_schemaFormat:"streaming_events"}),d=new Nu({...n}),p=this._streamLog(e,c,s);for await(let _ of p){if(i?i=i.concat(_):i=Is.fromRunLogPatch(_),i.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!o){o=!0;let h={...i.state},g={run_id:h.id,event:`on_${h.type}_start`,name:u,tags:a,metadata:l,data:{input:e}};d.includeEvent(g,h.type)&&(yield g)}let w=_.ops.filter(h=>h.path.startsWith("/logs/")).map(h=>h.path.split("/")[2]),b=[...new Set(w)];for(let h of b){let g,y={},v=i.state.logs[h];if(v.end_time===void 0?v.streamed_output.length>0?g="stream":g="start":g="end",g==="start")v.inputs!==void 0&&(y.input=v.inputs);else if(g==="end")v.inputs!==void 0&&(y.input=v.inputs),y.output=v.final_output;else if(g==="stream"){let x=v.streamed_output.length;if(x!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${x} instead. Encountered in: "${v.name}"`);y={chunk:v.streamed_output[0]},v.streamed_output=[]}yield{event:`on_${v.type}_${g}`,name:v.name,run_id:v.id,tags:v.tags,metadata:v.metadata,data:y}}let{state:m}=i;if(m.streamed_output.length>0){let h=m.streamed_output.length;if(h!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${h} instead. Encountered in: "${m.name}"`);let g={chunk:m.streamed_output[0]};m.streamed_output=[];let y={event:`on_${m.type}_stream`,run_id:m.id,tags:a,metadata:l,name:u,data:g};d.includeEvent(y,m.type)&&(yield y)}}let f=i?.state;if(f!==void 0){let _={event:`on_${f.type}_end`,name:u,run_id:f.id,tags:a,metadata:l,data:{output:f.final_output}};d.includeEvent(_,f.type)&&(yield _)}}static isRunnable(e){return Ns(e)}withListeners({onStart:e,onEnd:r,onError:n}){return new ii({bound:this,config:{},configFactories:[i=>({callbacks:[new Fs({config:i,onStart:e,onEnd:r,onError:n})]})]})}asTool(e){return cC(this,e)}},ii=class t extends xe{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){let r=zf(this.config,...e);return zf(r,...this.configFactories?await Promise.all(this.configFactories.map(async n=>await n(r))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,r){return this.bound.invoke(e,await this._mergeConfig(ee(r),this.kwargs))}async batch(e,r,n){let i=Array.isArray(r)?await Promise.all(r.map(async o=>this._mergeConfig(ee(o),this.kwargs))):await this._mergeConfig(ee(r),this.kwargs);return this.bound.batch(e,i,n)}async*_streamIterator(e,r){yield*this.bound._streamIterator(e,await this._mergeConfig(ee(r),this.kwargs))}async stream(e,r){return this.bound.stream(e,await this._mergeConfig(ee(r),this.kwargs))}async*transform(e,r){yield*this.bound.transform(e,await this._mergeConfig(ee(r),this.kwargs))}streamEvents(e,r,n){let i=this,o=async function*(){yield*i.bound.streamEvents(e,{...await i._mergeConfig(ee(r),i.kwargs),version:r.version},n)};return Le.fromAsyncGenerator(o())}static isRunnableBinding(e){return e.bound&&xe.isRunnable(e.bound)}withListeners({onStart:e,onEnd:r,onError:n}){return new t({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[i=>({callbacks:[new Fs({config:i,onStart:e,onEnd:r,onError:n})]})]})}},Jf=class t extends xe{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new t({bound:this.bound.bind(e)})}async invoke(e,r){return this._callWithConfig(this._invoke.bind(this),e,r)}async _invoke(e,r,n){return this.bound.batch(e,Ee(r,{callbacks:n?.getChild()}))}withListeners({onStart:e,onEnd:r,onError:n}){return new t({bound:this.bound.withListeners({onStart:e,onEnd:r,onError:n})})}},Xf=class extends ii{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,r,n){let i=e>1?`retry:attempt:${e}`:void 0;return Ee(r,{callbacks:n?.getChild(i)})}async _invoke(e,r,n){return(0,Qf.default)(i=>super.invoke(e,this._patchConfigForRetry(i,r,n)),{onFailedAttempt:i=>this.onFailedAttempt(i,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,r){return this._callWithConfig(this._invoke.bind(this),e,r)}async _batch(e,r,n,i){let o={};try{await(0,Qf.default)(async s=>{let a=e.map((p,f)=>f).filter(p=>o[p.toString()]===void 0||o[p.toString()]instanceof Error),l=a.map(p=>e[p]),u=a.map(p=>this._patchConfigForRetry(s,r?.[p],n?.[p])),c=await super.batch(l,u,{...i,returnExceptions:!0}),d;for(let p=0;p<c.length;p+=1){let f=c[p],_=a[p];f instanceof Error&&d===void 0&&(d=f,d.input=l[p]),o[_.toString()]=f}if(d)throw d;return c},{onFailedAttempt:s=>this.onFailedAttempt(s,s.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(s){if(i?.returnExceptions!==!0)throw s}return Object.keys(o).sort((s,a)=>parseInt(s,10)-parseInt(a,10)).map(s=>o[parseInt(s,10)])}async batch(e,r,n){return this._batchWithConfig(this._batch.bind(this),e,r,n)}},Bu=class t extends xe{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,r){let n=ee(r),o=await(await At(n))?.handleChainStart(this.toJSON(),be(e,"input"),n.runId,void 0,void 0,void 0,n?.runName);delete n.runId;let s=e,a;try{let l=[this.first,...this.middle];for(let u=0;u<l.length;u+=1){let d=l[u].invoke(s,Ee(n,{callbacks:o?.getChild(this.omitSequenceTags?void 0:`seq:step:${u+1}`)}));s=await or(d,r?.signal)}if(r?.signal?.aborted)throw new Error("Aborted");a=await this.last.invoke(s,Ee(n,{callbacks:o?.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(l){throw await o?.handleChainError(l),l}return await o?.handleChainEnd(be(a,"output")),a}async batch(e,r,n){let i=this._getOptionsList(r??{},e.length),o=await Promise.all(i.map(At)),s=await Promise.all(o.map(async(l,u)=>{let c=await l?.handleChainStart(this.toJSON(),be(e[u],"input"),i[u].runId,void 0,void 0,void 0,i[u].runName);return delete i[u].runId,c})),a=e;try{for(let l=0;l<this.steps.length;l+=1){let c=this.steps[l].batch(a,s.map((d,p)=>{let f=d?.getChild(this.omitSequenceTags?void 0:`seq:step:${l+1}`);return Ee(i[p],{callbacks:f})}),n);a=await or(c,i[0]?.signal)}}catch(l){throw await Promise.all(s.map(u=>u?.handleChainError(l))),l}return await Promise.all(s.map(l=>l?.handleChainEnd(be(a,"output")))),a}async*_streamIterator(e,r){let n=await At(r),{runId:i,...o}=r??{},s=await n?.handleChainStart(this.toJSON(),be(e,"input"),i,void 0,void 0,void 0,o?.runName),a=[this.first,...this.middle,this.last],l=!0,u;async function*c(){yield e}try{let d=a[0].transform(c(),Ee(o,{callbacks:s?.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let p=1;p<a.length;p+=1)d=await a[p].transform(d,Ee(o,{callbacks:s?.getChild(this.omitSequenceTags?void 0:`seq:step:${p+1}`)}));for await(let p of d)if(r?.signal?.throwIfAborted(),yield p,l)if(u===void 0)u=p;else try{u=sr(u,p)}catch{u=void 0,l=!1}}catch(d){throw await s?.handleChainError(d),d}await s?.handleChainEnd(be(u,"output"))}getGraph(e){let r=new Rs,n=null;return this.steps.forEach((i,o)=>{let s=i.getGraph(e);o!==0&&s.trimFirstNode(),o!==this.steps.length-1&&s.trimLastNode(),r.extend(s);let a=s.firstNode();if(!a)throw new Error(`Runnable ${i} has no first node`);n&&r.addEdge(n,a),n=s.lastNode()}),r}pipe(e){return t.isRunnableSequence(e)?new t({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new t({first:this.first,middle:[...this.middle,this.last],last:ni(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&xe.isRunnable(e)}static from([e,...r],n){let i={};return typeof n=="string"?i.name=n:n!==void 0&&(i=n),new t({...i,first:ni(e),middle:r.slice(0,-1).map(ni),last:ni(r[r.length-1])})}},Ds=class t extends xe{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(let[r,n]of Object.entries(e.steps))this.steps[r]=ni(n)}static from(e){return new t({steps:e})}async invoke(e,r){let n=ee(r),o=await(await At(n))?.handleChainStart(this.toJSON(),{input:e},n.runId,void 0,void 0,void 0,n?.runName);delete n.runId;let s={};try{let a=Object.entries(this.steps).map(async([l,u])=>{s[l]=await u.invoke(e,Ee(n,{callbacks:o?.getChild(`map:key:${l}`)}))});await or(Promise.all(a),r?.signal)}catch(a){throw await o?.handleChainError(a),a}return await o?.handleChainEnd(s),s}async*_transform(e,r,n){let i={...this.steps},o=jf(e,Object.keys(i).length),s=new Map(Object.entries(i).map(([a,l],u)=>{let c=l.transform(o[u],Ee(n,{callbacks:r?.getChild(`map:key:${a}`)}));return[a,c.next().then(d=>({key:a,gen:c,result:d}))]}));for(;s.size;){let a=Promise.race(s.values()),{key:l,result:u,gen:c}=await or(a,n?.signal);s.delete(l),u.done||(yield{[l]:u.value},s.set(l,c.next().then(d=>({key:l,gen:c,result:d}))))}}transform(e,r){return this._transformStreamWithConfig(e,this._transform.bind(this),r)}async stream(e,r){async function*n(){yield e}let i=ee(r),o=new Ir({generator:this.transform(n(),i),config:i});return await o.setup,Le.fromAsyncGenerator(o)}},Zf=class t extends xe{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!vu(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,r){let[n]=this._getOptionsList(r??{},1),i=await At(n),o=this.func(Ee(n,{callbacks:i}),e);return or(o,n?.signal)}async*_streamIterator(e,r){let[n]=this._getOptionsList(r??{},1),i=await this.invoke(e,r);if(zu(i)){for await(let o of i)n?.signal?.throwIfAborted(),yield o;return}if(v0(i)){for(;;){n?.signal?.throwIfAborted();let o=i.next();if(o.done)break;yield o.value}return}yield i}static from(e){return new t({func:e})}};function uC(t){if(vu(t))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}var Uu=class t extends xe{static lc_name(){return"RunnableLambda"}constructor(e){if(vu(e.func))return Zf.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),uC(e.func),this.func=e.func}static from(e){return new t({func:e})}async _invoke(e,r,n){return new Promise((i,o)=>{let s=Ee(r,{callbacks:n?.getChild(),recursionLimit:(r?.recursionLimit??Au)-1});mt.runWithConfig(Cr(s),async()=>{try{let a=await this.func(e,{...s});if(a&&xe.isRunnable(a)){if(r?.recursionLimit===0)throw new Error("Recursion limit reached.");a=await a.invoke(e,{...s,recursionLimit:(s.recursionLimit??Au)-1})}else if(zu(a)){let l;for await(let u of ju(s,a))if(r?.signal?.throwIfAborted(),l===void 0)l=u;else try{l=sr(l,u)}catch{l=u}a=l}else if(Hf(a)){let l;for(let u of Kf(s,a))if(r?.signal?.throwIfAborted(),l===void 0)l=u;else try{l=sr(l,u)}catch{l=u}a=l}i(a)}catch(a){o(a)}})})}async invoke(e,r){return this._callWithConfig(this._invoke.bind(this),e,r)}async*_transform(e,r,n){let i;for await(let a of e)if(i===void 0)i=a;else try{i=sr(i,a)}catch{i=a}let o=Ee(n,{callbacks:r?.getChild(),recursionLimit:(n?.recursionLimit??Au)-1}),s=await new Promise((a,l)=>{mt.runWithConfig(Cr(o),async()=>{try{let u=await this.func(i,{...o,config:o});a(u)}catch(u){l(u)}})});if(s&&xe.isRunnable(s)){if(n?.recursionLimit===0)throw new Error("Recursion limit reached.");let a=await s.stream(i,o);for await(let l of a)yield l}else if(zu(s))for await(let a of ju(o,s))n?.signal?.throwIfAborted(),yield a;else if(Hf(s))for(let a of Kf(o,s))n?.signal?.throwIfAborted(),yield a;else yield s}transform(e,r){return this._transformStreamWithConfig(e,this._transform.bind(this),r)}async stream(e,r){async function*n(){yield e}let i=ee(r),o=new Ir({generator:this.transform(n(),i),config:i});return await o.setup,Le.fromAsyncGenerator(o)}};var Yf=class extends xe{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(let e of this.fallbacks)yield e}async invoke(e,r){let n=ee(r),i=await At(n),{runId:o,...s}=n,a=await i?.handleChainStart(this.toJSON(),be(e,"input"),o,void 0,void 0,void 0,s?.runName),l=Ee(s,{callbacks:a?.getChild()});return await mt.runWithConfig(l,async()=>{let c;for(let d of this.runnables()){n?.signal?.throwIfAborted();try{let p=await d.invoke(e,l);return await a?.handleChainEnd(be(p,"output")),p}catch(p){c===void 0&&(c=p)}}throw c===void 0?new Error("No error stored at end of fallback."):(await a?.handleChainError(c),c)})}async*_streamIterator(e,r){let n=ee(r),i=await At(n),{runId:o,...s}=n,a=await i?.handleChainStart(this.toJSON(),be(e,"input"),o,void 0,void 0,void 0,s?.runName),l,u;for(let d of this.runnables()){n?.signal?.throwIfAborted();let p=Ee(s,{callbacks:a?.getChild()});try{let f=await d.stream(e,p);u=ju(p,f);break}catch(f){l===void 0&&(l=f)}}if(u===void 0){let d=l??new Error("No error stored at end of fallback.");throw await a?.handleChainError(d),d}let c;try{for await(let d of u){yield d;try{c=c===void 0?c:sr(c,d)}catch{c=void 0}}}catch(d){throw await a?.handleChainError(d),d}await a?.handleChainEnd(be(c,"output"))}async batch(e,r,n){if(n?.returnExceptions)throw new Error("Not implemented.");let i=this._getOptionsList(r??{},e.length),o=await Promise.all(i.map(l=>At(l))),s=await Promise.all(o.map(async(l,u)=>{let c=await l?.handleChainStart(this.toJSON(),be(e[u],"input"),i[u].runId,void 0,void 0,void 0,i[u].runName);return delete i[u].runId,c})),a;for(let l of this.runnables()){i[0].signal?.throwIfAborted();try{let u=await l.batch(e,s.map((c,d)=>Ee(i[d],{callbacks:c?.getChild()})),n);return await Promise.all(s.map((c,d)=>c?.handleChainEnd(be(u[d],"output")))),u}catch(u){a===void 0&&(a=u)}}throw a?(await Promise.all(s.map(l=>l?.handleChainError(a))),a):new Error("No error stored at end of fallbacks.")}};function ni(t){if(typeof t=="function")return new Uu({func:t});if(xe.isRunnable(t))return t;if(!Array.isArray(t)&&typeof t=="object"){let e={};for(let[r,n]of Object.entries(t))e[r]=ni(n);return new Ds({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}var eh=class extends xe{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof Ds&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,r){let n=await this.mapper.invoke(e,r);return{...e,...n}}async*_transform(e,r,n){let i=this.mapper.getStepsKeys(),[o,s]=jf(e),a=this.mapper.transform(s,Ee(n,{callbacks:r?.getChild()})),l=a.next();for await(let u of o){if(typeof u!="object"||Array.isArray(u))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof u}`);let c=Object.fromEntries(Object.entries(u).filter(([d])=>!i.includes(d)));Object.keys(c).length>0&&(yield c)}yield(await l).value;for await(let u of a)yield u}transform(e,r){return this._transformStreamWithConfig(e,this._transform.bind(this),r)}async stream(e,r){async function*n(){yield e}let i=ee(r),o=new Ir({generator:this.transform(n(),i),config:i});return await o.setup,Le.fromAsyncGenerator(o)}},th=class extends xe{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{let r=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return r.length===0?void 0:Object.fromEntries(r)}}async invoke(e,r){return this._callWithConfig(this._pick.bind(this),e,r)}async*_transform(e){for await(let r of e){let n=await this._pick(r);n!==void 0&&(yield n)}}transform(e,r){return this._transformStreamWithConfig(e,this._transform.bind(this),r)}async stream(e,r){async function*n(){yield e}let i=ee(r),o=new Ir({generator:this.transform(n(),i),config:i});return await o.setup,Le.fromAsyncGenerator(o)}},Vu=class extends ii{constructor(e){let r=Bu.from([Uu.from(async n=>{let i;if(Af(n))try{i=await this.schema.parseAsync(n.args)}catch{throw new ku("Received tool input did not match expected schema",JSON.stringify(n.args))}else i=n;return i}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:r,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}};function cC(t,e){let r=e.name??t.getName(),n=e.description??e.schema?.description;return e.schema.constructor===Yi.ZodString?new Vu({name:r,description:n,schema:Yi.object({input:Yi.string()}).transform(i=>i.input),bound:t}):new Vu({name:r,description:n,schema:e.schema,bound:t})}var Wu=class extends xe{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","documents","transformers"]})}invoke(e,r){return this.transformDocuments(e)}};var T0=Z(S0(),1);var yC=Object.defineProperty,wC=(t,e,r)=>e in t?yC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,vC=(t,e,r)=>(wC(t,typeof e!="symbol"?e+"":e,r),r);function bC(t,e){let r=Array.from({length:t.length},(n,i)=>({start:i,end:i+1}));for(;r.length>1;){let n=null;for(let i=0;i<r.length-1;i++){let o=t.slice(r[i].start,r[i+1].end),s=e.get(o.join(","));s!=null&&(n==null||s<n[0])&&(n=[s,i])}if(n!=null){let i=n[1];r[i]={start:r[i].start,end:r[i+1].end},r.splice(i+1,1)}else break}return r}function xC(t,e){return t.length===1?[e.get(t.join(","))]:bC(t,e).map(r=>e.get(t.slice(r.start,r.end).join(","))).filter(r=>r!=null)}function SC(t){return t.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var nh=class{constructor(t,e){Ar(this,"specialTokens");Ar(this,"inverseSpecialTokens");Ar(this,"patStr");Ar(this,"textEncoder",new TextEncoder);Ar(this,"textDecoder",new TextDecoder("utf-8"));Ar(this,"rankMap",new Map);Ar(this,"textMap",new Map);this.patStr=t.pat_str;let r=t.bpe_ranks.split(`
`).filter(Boolean).reduce((n,i)=>{let[o,s,...a]=i.split(" "),l=Number.parseInt(s,10);return a.forEach((u,c)=>n[u]=l+c),n},{});for(let[n,i]of Object.entries(r)){let o=T0.default.toByteArray(n);this.rankMap.set(o.join(","),i),this.textMap.set(i,o)}this.specialTokens={...t.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[i,o])=>(n[o]=this.textEncoder.encode(i),n),{})}encode(t,e=[],r="all"){let n=new RegExp(this.patStr,"ug"),i=nh.specialTokenRegex(Object.keys(this.specialTokens)),o=[],s=new Set(e==="all"?Object.keys(this.specialTokens):e),a=new Set(r==="all"?Object.keys(this.specialTokens).filter(u=>!s.has(u)):r);if(a.size>0){let u=nh.specialTokenRegex([...a]),c=t.match(u);if(c!=null)throw new Error(`The text contains a special token that is not allowed: ${c[0]}`)}let l=0;for(;;){let u=null,c=l;for(;i.lastIndex=c,u=i.exec(t),!(u==null||s.has(u[0]));)c=u.index+1;let d=u?.index??t.length;for(let f of t.substring(l,d).matchAll(n)){let _=this.textEncoder.encode(f[0]),w=this.rankMap.get(_.join(","));if(w!=null){o.push(w);continue}o.push(...xC(_,this.rankMap))}if(u==null)break;let p=this.specialTokens[u[0]];o.push(p),l=u.index+u[0].length}return o}decode(t){let e=[],r=0;for(let o=0;o<t.length;++o){let s=t[o],a=this.textMap.get(s)??this.inverseSpecialTokens[s];a!=null&&(e.push(a),r+=a.length)}let n=new Uint8Array(r),i=0;for(let o of e)n.set(o,i),i+=o.length;return this.textDecoder.decode(n)}},ih=nh;vC(ih,"specialTokenRegex",t=>new RegExp(t.map(e=>SC(e)).join("|"),"g"));var oh=class extends Wu{constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers","text_splitters"]}),Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),Object.defineProperty(this,"keepSeparator",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lengthFunction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chunkSize=e?.chunkSize??this.chunkSize,this.chunkOverlap=e?.chunkOverlap??this.chunkOverlap,this.keepSeparator=e?.keepSeparator??this.keepSeparator,this.lengthFunction=e?.lengthFunction??(r=>r.length),this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}async transformDocuments(e,r={}){return this.splitDocuments(e,r)}splitOnSeparator(e,r){let n;if(r)if(this.keepSeparator){let i=r.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");n=e.split(new RegExp(`(?=${i})`))}else n=e.split(r);else n=e.split("");return n.filter(i=>i!=="")}async createDocuments(e,r=[],n={}){let i=r.length>0?r:[...Array(e.length)].map(()=>({})),{chunkHeader:o="",chunkOverlapHeader:s="(cont'd) ",appendChunkOverlapHeader:a=!1}=n,l=new Array;for(let u=0;u<e.length;u+=1){let c=e[u],d=1,p=null,f=-1;for(let _ of await this.splitText(c)){let w=o,b=c.indexOf(_,f+1);if(p===null){let y=this.numberOfNewLines(c,0,b);d+=y}else{let y=f+await this.lengthFunction(p);if(y<b){let v=this.numberOfNewLines(c,y,b);d+=v}else if(y>b){let v=this.numberOfNewLines(c,b,y);d-=v}a&&(w+=s)}let m=this.numberOfNewLines(_),h=i[u].loc&&typeof i[u].loc=="object"?{...i[u].loc}:{};h.lines={from:d,to:d+m};let g={...i[u],loc:h};w+=_,l.push(new Nl({pageContent:w,metadata:g})),d+=m,p=_,f=b}}return l}numberOfNewLines(e,r,n){return(e.slice(r,n).match(/\n/g)||[]).length}async splitDocuments(e,r={}){let n=e.filter(s=>s.pageContent!==void 0),i=n.map(s=>s.pageContent),o=n.map(s=>s.metadata);return this.createDocuments(i,o,r)}joinDocs(e,r){let n=e.join(r).trim();return n===""?null:n}async mergeSplits(e,r){let n=[],i=[],o=0;for(let a of e){let l=await this.lengthFunction(a);if(o+l+i.length*r.length>this.chunkSize&&(o>this.chunkSize&&console.warn(`Created a chunk of size ${o}, +
which is longer than the specified ${this.chunkSize}`),i.length>0)){let u=this.joinDocs(i,r);for(u!==null&&n.push(u);o>this.chunkOverlap||o+l+i.length*r.length>this.chunkSize&&o>0;)o-=await this.lengthFunction(i[0]),i.shift()}i.push(a),o+=l}let s=this.joinDocs(i,r);return s!==null&&n.push(s),n}};var qu=class t extends oh{static lc_name(){return"RecursiveCharacterTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:[`

`,`
`," ",""]}),this.separators=e?.separators??this.separators,this.keepSeparator=e?.keepSeparator??!0}async _splitText(e,r){let n=[],i=r[r.length-1],o;for(let u=0;u<r.length;u+=1){let c=r[u];if(c===""){i=c;break}if(e.includes(c)){i=c,o=r.slice(u+1);break}}let s=this.splitOnSeparator(e,i),a=[],l=this.keepSeparator?"":i;for(let u of s)if(await this.lengthFunction(u)<this.chunkSize)a.push(u);else{if(a.length){let c=await this.mergeSplits(a,l);n.push(...c),a=[]}if(!o)n.push(u);else{let c=await this._splitText(u,o);n.push(...c)}}if(a.length){let u=await this.mergeSplits(a,l);n.push(...u)}return n}async splitText(e){return this._splitText(e,this.separators)}static fromLanguage(e,r){return new t({...r,separators:t.getSeparatorsForLanguage(e)})}static getSeparatorsForLanguage(e){if(e==="cpp")return[`
class `,`
void `,`
int `,`
float `,`
double `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="go")return[`
func `,`
var `,`
const `,`
type `,`
if `,`
for `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="java")return[`
class `,`
public `,`
protected `,`
private `,`
static `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="js")return[`
function `,`
const `,`
let `,`
var `,`
class `,`
if `,`
for `,`
while `,`
switch `,`
case `,`
default `,`

`,`
`," ",""];if(e==="php")return[`
function `,`
class `,`
if `,`
foreach `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="proto")return[`
message `,`
service `,`
enum `,`
option `,`
import `,`
syntax `,`

`,`
`," ",""];if(e==="python")return[`
class `,`
def `,`
	def `,`

`,`
`," ",""];if(e==="rst")return[`
===
`,`
---
`,`
***
`,`
.. `,`

`,`
`," ",""];if(e==="ruby")return[`
def `,`
class `,`
if `,`
unless `,`
while `,`
for `,`
do `,`
begin `,`
rescue `,`

`,`
`," ",""];if(e==="rust")return[`
fn `,`
const `,`
let `,`
if `,`
while `,`
for `,`
loop `,`
match `,`
const `,`

`,`
`," ",""];if(e==="scala")return[`
class `,`
object `,`
def `,`
val `,`
var `,`
if `,`
for `,`
while `,`
match `,`
case `,`

`,`
`," ",""];if(e==="swift")return[`
func `,`
class `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="markdown")return[`
## `,`
### `,`
#### `,`
##### `,`
###### `,"```\n\n",`

***

`,`

---

`,`

___

`,`

`,`
`," ",""];if(e==="latex")return[`
\\chapter{`,`
\\section{`,`
\\subsection{`,`
\\subsubsection{`,`
\\begin{enumerate}`,`
\\begin{itemize}`,`
\\begin{description}`,`
\\begin{list}`,`
\\begin{quote}`,`
\\begin{quotation}`,`
\\begin{verse}`,`
\\begin{verbatim}`,`
\\begin{align}`,"$$","$",`

`,`
`," ",""];if(e==="html")return["<body>","<div>","<p>","<br>","<li>","<h1>","<h2>","<h3>","<h4>","<h5>","<h6>","<span>","<table>","<tr>","<td>","<th>","<ul>","<ol>","<header>","<footer>","<nav>","<head>","<style>","<script>","<meta>","<title>"," ",""];if(e==="sol")return[`
pragma `,`
using `,`
contract `,`
interface `,`
library `,`
constructor `,`
type `,`
function `,`
event `,`
modifier `,`
error `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do while `,`
assembly `,`

`,`
`," ",""];throw new Error(`Language ${e} is not supported.`)}};var Hu=Z(Qe()),Ku=class{constructor(e){this.embeddingService=e;this.splitter=null}async init(){this.splitter=qu.fromLanguage("markdown",{chunkSize:this.embeddingService.getMaxTokens(),chunkOverlap:100,lengthFunction:e=>this.embeddingService.countTokens(e)})}async split(e){if(!this.splitter)throw new Error("Splitter not initialized");let r=await this.splitter.splitText(e.content);if(Hu.default.getLevel()<=Hu.default.levels.DEBUG){let n=await Promise.all(r.map(i=>this.embeddingService.countTokens(i)));Hu.default.debug("chunk tokens",e.path,r.length,n)}return r.map((n,i)=>new si(e.path,e.title,n,i,r.length,[]))}};var Qu=class{constructor(e,r,n,i){this.path=e;this.title=r;this.content=n;this.links=i}};var Ju=class{constructor(e){this.app=e}async findByFile(e,r=!1){let n=r?await this.readContentWithoutFrontmatter(e):await this.app.vault.cachedRead(e),i=this.extractLinks(e);return new Qu(e.path,e.basename,n,i)}async findByPath(e,r=!1){let n=this.app.vault.getFileByPath(e);return n?this.findByFile(n,r):null}extractLinks(e){let r=this.app.metadataCache.resolvedLinks[e.path];return r?Object.keys(r):[]}async readContentWithoutFrontmatter(e){let r=await this.app.vault.cachedRead(e),n=this.app.metadataCache.getFileCache(e);if(!n?.frontmatterPosition)return r;let{start:i,end:o}=n.frontmatterPosition;return r.split(`
`).slice(o.line+1).join(`
`)}};var M0=Z(Qe()),Xu=class{constructor(e,r){this.vault=e;this.mTimeStore=r;this.queue=[];this.eventRefs=[]}async initialize(){let e=this.vault.getMarkdownFiles(),r={},n=[];for(let i of e){r[i.path]=i.stat.mtime;let o=await this.mTimeStore.getMTime(i.path);o?o!==i.stat.mtime&&n.push({path:i.path,reason:"modified",mtime:i.stat.mtime}):n.push({path:i.path,reason:"new",mtime:i.stat.mtime})}for(let i of this.mTimeStore.getAllPaths())r[i]||n.push({path:i,reason:"deleted"});this.queue=n,M0.default.info("queue size",this.queue.length),this.registerFileChangeCallbacks()}registerFileChangeCallbacks(){this.unregisterFileChangeCallbacks();let e=this.vault.on("create",async i=>{i.extension==="md"&&this.queue.push({path:i.path,reason:"new",mtime:i.stat.mtime})});this.eventRefs.push(e);let r=this.vault.on("modify",async i=>{i.extension==="md"&&(this.queue=this.queue.filter(o=>o.path!==i.path),this.queue.push({path:i.path,reason:"modified",mtime:i.stat.mtime}))});this.eventRefs.push(r);let n=this.vault.on("delete",i=>{i.extension==="md"&&(this.queue=this.queue.filter(o=>o.path!==i.path),this.queue.push({path:i.path,reason:"deleted"}))});this.eventRefs.push(n)}unregisterFileChangeCallbacks(){for(let e of this.eventRefs)this.vault.offref(e);this.eventRefs=[]}cleanup(){this.unregisterFileChangeCallbacks()}async enqueueAllNotes(){let e=this.vault.getMarkdownFiles(),r=[];for(let n of e)r.push({path:n.path,reason:"modified",mtime:n.stat.mtime});this.queue=r}pollFileChanges(e){let r=this.queue.slice(0,e);return this.queue=this.queue.slice(e),r}getFileChangeCount(){return this.queue.length}async markNoteChangeProcessed(e){e.reason==="deleted"?this.mTimeStore.deleteMTime(e.path):e.mtime&&this.mTimeStore.setMTime(e.path,e.mtime)}};var MC="similar-notes.json",kC="similar-notes-file-mtimes.json",Zu=class extends k0.Plugin{async onload(){Re.default.setDefaultLevel(Re.default.levels.ERROR),Re.default.info("Loading Similar Notes plugin"),this.settingsService=new Tl(this),await this.settingsService.load(),this.settingTab=new El(this,this.settingsService),this.addSettingTab(this.settingTab),this.registerEvents(),this.app.workspace.onLayoutReady(()=>this.initializeServices())}registerEvents(){this.registerEvent(this.app.workspace.on("file-open",async e=>{await this.similarNoteCoordinator?.onFileOpen(e)})),this.registerEvent(this.app.workspace.on("layout-change",async()=>{this.leafViewCoordinator?.onLayoutChange()})),this.registerEvent(this.app.workspace.on("active-leaf-change",async e=>{this.leafViewCoordinator?.onActiveLeafChange(e)}))}async initializeServices(){let e=this.app.vault.configDir+"/"+kC;this.noteRepository=new Ju(this.app),this.indexedNotesMTimeStore=new Fl(this.app.vault,e),this.settingTab.setMTimeStore(this.indexedNotesMTimeStore),this.modelService=new Il,this.noteChunkRepository=new qs(this.app.vault),await this.indexedNotesMTimeStore.restore(),this.noteChunkingService=new Ku(this.modelService),this.similarNoteFinder=new $l(this.noteChunkRepository,this.noteChunkingService,this.modelService),this.similarNoteCoordinator=new Ml(this.app.vault,this.noteRepository,this.similarNoteFinder,this.settingsService),this.leafViewCoordinator=new _l(this.app,this.similarNoteCoordinator),this.noteChangeQueue=new Xu(this.app.vault,this.indexedNotesMTimeStore),await this.noteChangeQueue.initialize(),this.noteIndexingService=new Sl(this.noteRepository,this.noteChunkRepository,this.noteChangeQueue,this.noteChunkingService,this.modelService,this.similarNoteCoordinator,this.settingsService,this.app),this.statusBarView=new Pl(this,this.noteIndexingService.getNoteChangeCount$(),this.modelService.getModelBusy$(),this.modelService.getDownloadProgress$()),await this.init(this.settingsService.get().modelId,!0,!1)}async onunload(){this.statusBarView.dispose(),this.noteIndexingService.stopLoop(),this.leafViewCoordinator.onUnload(),this.autoSaveInterval&&clearInterval(this.autoSaveInterval),await this.closeStore(),this.noteChunkRepository&&(Re.default.info("Disposing note chunk repository worker"),await this.noteChunkRepository.dispose()),this.noteChangeQueue.cleanup(),this.modelService&&(Re.default.info("Disposing model service"),this.modelService.dispose()),Re.default.info("Similar Notes plugin unloaded")}setLogLevel(e){if(Re.default.setLevel(e),Re.default.info(`Main thread log level set to: ${Re.default.getLevel()}`),this.modelService&&this.modelService.setLogLevel(e),this.noteChunkRepository){let r=this.noteChunkRepository;typeof r.setLogLevel=="function"&&r.setLogLevel(e)}}async init(e,r,n){this.noteIndexingService.stopLoop();try{if(r||n){let s=this.settingsService.get();await this.modelService.switchProvider(s),Re.default.info("Model service initialized successfully with provider:",s.modelProvider,"and model:",s.modelProvider==="builtin"?s.modelId:s.ollamaModel),this.noteChunkingService.init()}}catch(s){Re.default.error("Failed to initialize model service:",s);return}let i=this.modelService.getVectorSize(),o=this.app.vault.configDir+"/"+MC;if(r){await this.noteChunkRepository.init(i,o,!0);let s=await this.noteChunkRepository.count();Re.default.info("Successfully loaded existing database from",o,"with",s,"chunks"),this.setupAutoSave(this.settingsService.get().autoSaveInterval),this.settingsService.getNewSettingsObservable().subscribe(a=>{a.autoSaveInterval!==void 0&&this.setupAutoSave(a.autoSaveInterval)})}else await this.noteChunkRepository.init(i,o,!1),this.noteChangeQueue.enqueueAllNotes();this.noteIndexingService.startLoop()}async reindexNotes(){this.indexedNotesMTimeStore.clear(),await this.init(this.settingsService.get().modelId,!1,!1)}async changeModel(e){await this.init(e,!1,!0)}async reloadModel(){this.noteIndexingService.stopLoop();let e=this.settingsService.get();try{await this.modelService.switchProvider(e),this.statusBarView.setStatus("ready")}catch(r){Re.default.error("Failed to reload model:",r),this.statusBarView.setStatus("error")}finally{this.noteIndexingService.startLoop()}}async closeStore(){this.autoSaveInterval&&clearInterval(this.autoSaveInterval),await this.noteChunkRepository.persist(),await this.indexedNotesMTimeStore.persist()}setupAutoSave(e){this.autoSaveInterval&&clearInterval(this.autoSaveInterval);let r=e*60*1e3;this.autoSaveInterval=setInterval(async()=>{try{await this.noteChunkRepository.persist(),await this.indexedNotesMTimeStore.persist(),Re.default.info("Auto-saved databases")}catch(n){Re.default.error("Failed to auto-save database:",n)}},r)}};
/*! Bundled license information:

react/cjs/react.production.min.js:
  (**
   * @license React
   * react.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

scheduler/cjs/scheduler.production.min.js:
  (**
   * @license React
   * scheduler.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

react-dom/cjs/react-dom.production.min.js:
  (**
   * @license React
   * react-dom.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

react/cjs/react-jsx-runtime.production.min.js:
  (**
   * @license React
   * react-jsx-runtime.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

comlink/dist/esm/comlink.mjs:
  (**
   * @license
   * Copyright 2019 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@langchain/core/dist/utils/fast-json-patch/src/helpers.js:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2017-2022 Joachim Wester
   * MIT licensed
   *)

@langchain/core/dist/utils/fast-json-patch/src/duplex.js:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2013-2021 Joachim Wester
   * MIT license
   *)
*/

/* nosourcemap */