/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin: https://github.com/terrastruct/d2-obsidian
*/
var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __commonJS = (cb, mod) => function __require() {
  return mod || (0, cb[__getOwnPropNames(cb)[0]])((mod = { exports: {} }).exports, mod), mod.exports;
};
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target, mod));
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// node_modules/lodash.debounce/index.js
var require_lodash = __commonJS({
  "node_modules/lodash.debounce/index.js"(exports, module2) {
    var FUNC_ERROR_TEXT = "Expected a function";
    var NAN = 0 / 0;
    var symbolTag = "[object Symbol]";
    var reTrim = /^\s+|\s+$/g;
    var reIsBadHex = /^[-+]0x[0-9a-f]+$/i;
    var reIsBinary = /^0b[01]+$/i;
    var reIsOctal = /^0o[0-7]+$/i;
    var freeParseInt = parseInt;
    var freeGlobal = typeof global == "object" && global && global.Object === Object && global;
    var freeSelf = typeof self == "object" && self && self.Object === Object && self;
    var root = freeGlobal || freeSelf || Function("return this")();
    var objectProto = Object.prototype;
    var objectToString = objectProto.toString;
    var nativeMax = Math.max;
    var nativeMin = Math.min;
    var now = function() {
      return root.Date.now();
    };
    function debounce2(func, wait, options) {
      var lastArgs, lastThis, maxWait, result, timerId, lastCallTime, lastInvokeTime = 0, leading = false, maxing = false, trailing = true;
      if (typeof func != "function") {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      wait = toNumber(wait) || 0;
      if (isObject(options)) {
        leading = !!options.leading;
        maxing = "maxWait" in options;
        maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;
        trailing = "trailing" in options ? !!options.trailing : trailing;
      }
      function invokeFunc(time) {
        var args = lastArgs, thisArg = lastThis;
        lastArgs = lastThis = void 0;
        lastInvokeTime = time;
        result = func.apply(thisArg, args);
        return result;
      }
      function leadingEdge(time) {
        lastInvokeTime = time;
        timerId = setTimeout(timerExpired, wait);
        return leading ? invokeFunc(time) : result;
      }
      function remainingWait(time) {
        var timeSinceLastCall = time - lastCallTime, timeSinceLastInvoke = time - lastInvokeTime, result2 = wait - timeSinceLastCall;
        return maxing ? nativeMin(result2, maxWait - timeSinceLastInvoke) : result2;
      }
      function shouldInvoke(time) {
        var timeSinceLastCall = time - lastCallTime, timeSinceLastInvoke = time - lastInvokeTime;
        return lastCallTime === void 0 || timeSinceLastCall >= wait || timeSinceLastCall < 0 || maxing && timeSinceLastInvoke >= maxWait;
      }
      function timerExpired() {
        var time = now();
        if (shouldInvoke(time)) {
          return trailingEdge(time);
        }
        timerId = setTimeout(timerExpired, remainingWait(time));
      }
      function trailingEdge(time) {
        timerId = void 0;
        if (trailing && lastArgs) {
          return invokeFunc(time);
        }
        lastArgs = lastThis = void 0;
        return result;
      }
      function cancel() {
        if (timerId !== void 0) {
          clearTimeout(timerId);
        }
        lastInvokeTime = 0;
        lastArgs = lastCallTime = lastThis = timerId = void 0;
      }
      function flush() {
        return timerId === void 0 ? result : trailingEdge(now());
      }
      function debounced() {
        var time = now(), isInvoking = shouldInvoke(time);
        lastArgs = arguments;
        lastThis = this;
        lastCallTime = time;
        if (isInvoking) {
          if (timerId === void 0) {
            return leadingEdge(lastCallTime);
          }
          if (maxing) {
            timerId = setTimeout(timerExpired, wait);
            return invokeFunc(lastCallTime);
          }
        }
        if (timerId === void 0) {
          timerId = setTimeout(timerExpired, wait);
        }
        return result;
      }
      debounced.cancel = cancel;
      debounced.flush = flush;
      return debounced;
    }
    function isObject(value) {
      var type = typeof value;
      return !!value && (type == "object" || type == "function");
    }
    function isObjectLike(value) {
      return !!value && typeof value == "object";
    }
    function isSymbol(value) {
      return typeof value == "symbol" || isObjectLike(value) && objectToString.call(value) == symbolTag;
    }
    function toNumber(value) {
      if (typeof value == "number") {
        return value;
      }
      if (isSymbol(value)) {
        return NAN;
      }
      if (isObject(value)) {
        var other = typeof value.valueOf == "function" ? value.valueOf() : value;
        value = isObject(other) ? other + "" : other;
      }
      if (typeof value != "string") {
        return value === 0 ? value : +value;
      }
      value = value.replace(reTrim, "");
      var isBinary = reIsBinary.test(value);
      return isBinary || reIsOctal.test(value) ? freeParseInt(value.slice(2), isBinary ? 2 : 8) : reIsBadHex.test(value) ? NAN : +value;
    }
    module2.exports = debounce2;
  }
});

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => D2Plugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian3 = require("obsidian");

// src/settings.ts
var import_obsidian = require("obsidian");

// src/constants.ts
var LAYOUT_ENGINES = {
  DAGRE: {
    value: "dagre",
    label: "dagre"
  },
  ELK: {
    value: "elk",
    label: "ELK"
  },
  TALA: {
    value: "tala",
    label: "TALA"
  }
};
var RecompileIcon = `
<svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M8.33325 83.3334V58.3334H33.3333" stroke="#2E3346" stroke-width="8.33333" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M91.6667 16.6666V41.6666H66.6667" stroke="#2E3346" stroke-width="8.33333" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M14.6249 37.5004C16.7381 31.5287 20.3296 26.1896 25.0644 21.9813C29.7991 17.773 35.5227 14.8328 41.7011 13.4348C47.8795 12.0369 54.3114 12.2268 60.3965 13.987C66.4817 15.7471 72.0218 19.02 76.4999 23.5004C80.978 27.9808 91.6666 41.667 91.6666 41.667M8.33325 58.3337C8.33325 58.3337 19.0218 72.02 23.4999 76.5004C27.978 80.9808 33.5181 84.2537 39.6033 86.0138C45.6884 87.774 52.1203 87.9639 58.2987 86.566C64.4771 85.168 70.2007 82.2277 74.9355 78.0195C79.6702 73.8112 83.2617 68.4721 85.3749 62.5004" stroke="#2E3346" stroke-width="8.33333" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`;

// src/settings.ts
var DEFAULT_SETTINGS = {
  layoutEngine: "dagre",
  debounce: 500,
  theme: 0,
  apiToken: "",
  d2Path: "",
  pad: 100,
  sketch: false,
  containerHeight: 800
};
var D2SettingsTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  addTALASettings() {
    const talaSettings = this.containerEl.createEl("div");
    talaSettings.createEl("h3", {
      text: "TALA settings"
    });
    new import_obsidian.Setting(talaSettings).setName("API token").setDesc('To use TALA, copy your API token here or in ~/.local/state/tstruct/auth.json under the field "api_token"').addText((text) => text.setPlaceholder("tstruct_...").setValue(this.plugin.settings.apiToken).setDisabled(this.plugin.settings.layoutEngine !== LAYOUT_ENGINES.TALA.value).onChange(async (value) => {
      if (value && !value.startsWith("tstruct_")) {
        new import_obsidian.Notice("Invalid API token");
      } else {
        this.plugin.settings.apiToken = value;
        await this.plugin.saveSettings();
      }
    }));
    this.talaSettings = talaSettings;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h1", { text: "D2 plugin settings" });
    new import_obsidian.Setting(containerEl).setName("Layout engine").setDesc('Available layout engines include "dagre", "ELK", and "TALA" (TALA must be installed separately from D2)').addDropdown((dropdown) => {
      dropdown.addOption(LAYOUT_ENGINES.DAGRE.value, LAYOUT_ENGINES.DAGRE.label).addOption(LAYOUT_ENGINES.ELK.value, LAYOUT_ENGINES.ELK.label).addOption(LAYOUT_ENGINES.TALA.value, LAYOUT_ENGINES.TALA.label).setValue(this.plugin.settings.layoutEngine).onChange(async (value) => {
        var _a;
        this.plugin.settings.layoutEngine = value;
        await this.plugin.saveSettings();
        if (value === LAYOUT_ENGINES.TALA.value) {
          this.addTALASettings();
        } else {
          (_a = this.talaSettings) == null ? void 0 : _a.remove();
        }
      });
    });
    new import_obsidian.Setting(containerEl).setName("Theme ID").setDesc("Available themes are located at https://github.com/terrastruct/d2/tree/master/d2themes").addText((text) => text.setPlaceholder("Enter a theme ID").setValue(String(this.plugin.settings.theme)).onChange(async (value) => {
      if (!isNaN(Number(value)) || value === "") {
        this.plugin.settings.theme = Number(value || DEFAULT_SETTINGS.theme);
        await this.plugin.saveSettings();
      } else {
        new import_obsidian.Notice("Please specify a valid number");
      }
    }));
    new import_obsidian.Setting(containerEl).setName("Pad").setDesc("Pixels padded around the rendered diagram").addText((text) => text.setPlaceholder(String(DEFAULT_SETTINGS.pad)).setValue(String(this.plugin.settings.pad)).onChange(async (value) => {
      if (isNaN(Number(value))) {
        new import_obsidian.Notice("Please specify a valid number");
        this.plugin.settings.pad = Number(DEFAULT_SETTINGS.pad);
      } else if (value === "") {
        this.plugin.settings.pad = Number(DEFAULT_SETTINGS.pad);
      } else {
        this.plugin.settings.pad = Number(value);
      }
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Sketch mode").setDesc("Render the diagram to look like it was sketched by hand").addToggle((toggle) => toggle.setValue(this.plugin.settings.sketch).onChange(async (value) => {
      this.plugin.settings.sketch = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Container height").setDesc("Diagram max render height in pixels (Requires d2 v0.2.2 and up)").addText((text) => text.setPlaceholder(String(DEFAULT_SETTINGS.containerHeight)).setValue(String(this.plugin.settings.containerHeight)).onChange(async (value) => {
      if (isNaN(Number(value))) {
        new import_obsidian.Notice("Please specify a valid number");
        this.plugin.settings.containerHeight = Number(DEFAULT_SETTINGS.containerHeight);
      } else if (value === "") {
        this.plugin.settings.containerHeight = Number(DEFAULT_SETTINGS.containerHeight);
      } else {
        this.plugin.settings.containerHeight = Number(value);
      }
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Debounce").setDesc("How often should the diagram refresh in milliseconds (min 100)").addText((text) => text.setPlaceholder(String(DEFAULT_SETTINGS.debounce)).setValue(String(this.plugin.settings.debounce)).onChange(async (value) => {
      if (isNaN(Number(value))) {
        new import_obsidian.Notice("Please specify a valid number");
        this.plugin.settings.debounce = Number(DEFAULT_SETTINGS.debounce);
      } else if (value === "") {
        this.plugin.settings.debounce = Number(DEFAULT_SETTINGS.debounce);
      } else if (Number(value) < 100) {
        new import_obsidian.Notice("The value must be greater than 100");
        this.plugin.settings.debounce = Number(DEFAULT_SETTINGS.debounce);
      } else {
        this.plugin.settings.debounce = Number(value);
      }
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Path (optional)").setDesc("Customize the local path to the directory `d2` is installed in (ex. if d2 is located at `/usr/local/bin/d2`, then the path is `/usr/local/bin`). This is only necessary if `d2` is not found automatically by the plugin (but is installed).").addText((text) => {
      text.setPlaceholder("/usr/local/Cellar").setValue(this.plugin.settings.d2Path).onChange(async (value) => {
        this.plugin.settings.d2Path = value;
        await this.plugin.saveSettings();
      });
    });
    if (this.plugin.settings.layoutEngine === LAYOUT_ENGINES.TALA.value) {
      this.addTALASettings();
    }
  }
};

// src/processor.ts
var import_obsidian2 = require("obsidian");
var import_child_process = require("child_process");
var import_path = require("path");
var import_lodash = __toESM(require_lodash());
var import_os = __toESM(require("os"));
var D2Processor = class {
  constructor(plugin) {
    this.attemptExport = async (source, el, ctx) => {
      var _a;
      el.createEl("h6", {
        text: "Generating D2 diagram...",
        cls: "D2__Loading"
      });
      const pageContainer = ctx.containerEl;
      let pageID = pageContainer.dataset.pageID;
      if (!pageID) {
        pageID = Math.floor(Math.random() * Date.now()).toString();
        pageContainer.dataset.pageID = pageID;
      }
      let debouncedFunc = this.debouncedMap.get(pageID);
      if (!debouncedFunc) {
        await this.export(source, el, ctx);
        debouncedFunc = (0, import_lodash.default)(this.export, this.plugin.settings.debounce, {
          leading: true
        });
        this.debouncedMap.set(pageID, debouncedFunc);
        return;
      }
      (_a = this.abortControllerMap.get(pageID)) == null ? void 0 : _a.abort();
      const newAbortController = new AbortController();
      this.abortControllerMap.set(pageID, newAbortController);
      await debouncedFunc(source, el, ctx, newAbortController.signal);
    };
    this.sanitizeSVGIDs = (svgEl, docID) => {
      const overrides = svgEl.querySelectorAll("marker, mask, filter");
      const overrideIDs = [];
      overrides.forEach((override) => {
        const id = override.getAttribute("id");
        if (id) {
          overrideIDs.push(id);
        }
      });
      return overrideIDs.reduce((svgHTML, overrideID) => {
        return svgHTML.replaceAll(overrideID, [overrideID, docID].join("-"));
      }, svgEl.outerHTML);
    };
    this.export = async (source, el, ctx, signal) => {
      try {
        const image = await this.generatePreview(source, signal);
        if (image) {
          el.empty();
          this.prevImage = image;
          this.insertImage(image, el, ctx);
          const button = new import_obsidian2.ButtonComponent(el).setClass("Preview__Recompile").setIcon("recompile").onClick((e) => {
            e.preventDefault();
            e.stopPropagation();
            el.empty();
            this.attemptExport(source, el, ctx);
          });
          button.buttonEl.createEl("span", {
            text: "Recompile"
          });
        }
      } catch (err) {
        el.empty();
        const errorEl = el.createEl("pre", {
          cls: "markdown-rendered pre Preview__Error"
        });
        errorEl.createEl("code", {
          text: "D2 Compilation Error:",
          cls: "Preview__Error--Title"
        });
        errorEl.createEl("code", {
          text: err.message
        });
        if (this.prevImage) {
          this.insertImage(this.prevImage, el, ctx);
        }
      } finally {
        const pageContainer = ctx.containerEl;
        this.abortControllerMap.delete(pageContainer.dataset.id);
      }
    };
    this.plugin = plugin;
    this.debouncedMap = /* @__PURE__ */ new Map();
    this.abortControllerMap = /* @__PURE__ */ new Map();
  }
  insertImage(image, el, ctx) {
    const parser = new DOMParser();
    const svg = parser.parseFromString(image, "image/svg+xml");
    const containerEl = el.createDiv();
    containerEl.style.maxHeight = `${this.plugin.settings.containerHeight}px`;
    containerEl.style.height = "100vh";
    containerEl.style.width = "100%";
    containerEl.style.position = "relative";
    const svgEl = svg.documentElement;
    svgEl.style.position = "absolute";
    svgEl.style.width = "100%";
    svgEl.style.height = "100%";
    containerEl.innerHTML = this.sanitizeSVGIDs(svgEl, ctx.docId);
  }
  async generatePreview(source, signal) {
    var _a, _b;
    const pathArray = [process.env.PATH, "/opt/homebrew/bin", "/usr/local/bin"];
    if (import_os.default.platform() === "win32") {
      pathArray.push(`C:Program FilesD2`);
    } else {
      pathArray.push(`${process.env.HOME}/.local/bin`);
    }
    let GOPATH = "";
    try {
      GOPATH = (0, import_child_process.execSync)("go env GOPATH", {
        env: {
          ...process.env,
          PATH: pathArray.join(import_path.delimiter)
        }
      }).toString();
    } catch (error) {
    }
    if (GOPATH) {
      pathArray.push(`${GOPATH.replace("\n", "")}/bin`);
    }
    if (this.plugin.settings.d2Path) {
      pathArray.push(this.plugin.settings.d2Path);
    }
    const options = {
      ...process.env,
      env: {
        PATH: pathArray.join(import_path.delimiter)
      },
      signal
    };
    if (this.plugin.settings.apiToken) {
      options.env.TSTRUCT_TOKEN = this.plugin.settings.apiToken;
    }
    let args = [
      `d2`,
      "-",
      `--theme=${this.plugin.settings.theme}`,
      `--layout=${this.plugin.settings.layoutEngine}`,
      `--pad=${this.plugin.settings.pad}`,
      `--sketch=${this.plugin.settings.sketch}`,
      "--bundle=false"
    ];
    const cmd = args.join(" ");
    const child = (0, import_child_process.exec)(cmd, options);
    (_a = child.stdin) == null ? void 0 : _a.write(source);
    (_b = child.stdin) == null ? void 0 : _b.end();
    let stdout;
    let stderr;
    if (child.stdout) {
      child.stdout.on("data", (data) => {
        if (stdout === void 0) {
          stdout = data;
        } else {
          stdout += data;
        }
      });
    }
    if (child.stderr) {
      child.stderr.on("data", (data) => {
        if (stderr === void 0) {
          stderr = data;
        } else {
          stderr += data;
        }
      });
    }
    return new Promise((resolve, reject) => {
      child.on("error", reject);
      child.on("close", (code) => {
        if (code === 0) {
          resolve(stdout);
          return;
        } else if (stderr) {
          console.error(stderr);
          reject(new Error(stderr));
        } else if (stdout) {
          console.error(stdout);
          reject(new Error(stdout));
        }
      });
    });
  }
};

// src/main.ts
var D2Plugin = class extends import_obsidian3.Plugin {
  async onload() {
    (0, import_obsidian3.addIcon)("recompile", RecompileIcon);
    await this.loadSettings();
    this.addSettingTab(new D2SettingsTab(this.app, this));
    const processor = new D2Processor(this);
    this.registerMarkdownCodeBlockProcessor("d2", processor.attemptExport);
    this.processor = processor;
  }
  onunload() {
    const abortControllers = this.processor.abortControllerMap.values();
    Array.from(abortControllers).forEach((controller) => {
      controller.abort();
    });
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibm9kZV9tb2R1bGVzL2xvZGFzaC5kZWJvdW5jZS9pbmRleC5qcyIsICJzcmMvbWFpbi50cyIsICJzcmMvc2V0dGluZ3MudHMiLCAic3JjL2NvbnN0YW50cy50cyIsICJzcmMvcHJvY2Vzc29yLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyIvKipcbiAqIGxvZGFzaCAoQ3VzdG9tIEJ1aWxkKSA8aHR0cHM6Ly9sb2Rhc2guY29tLz5cbiAqIEJ1aWxkOiBgbG9kYXNoIG1vZHVsYXJpemUgZXhwb3J0cz1cIm5wbVwiIC1vIC4vYFxuICogQ29weXJpZ2h0IGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMgPGh0dHBzOi8vanF1ZXJ5Lm9yZy8+XG4gKiBSZWxlYXNlZCB1bmRlciBNSVQgbGljZW5zZSA8aHR0cHM6Ly9sb2Rhc2guY29tL2xpY2Vuc2U+XG4gKiBCYXNlZCBvbiBVbmRlcnNjb3JlLmpzIDEuOC4zIDxodHRwOi8vdW5kZXJzY29yZWpzLm9yZy9MSUNFTlNFPlxuICogQ29weXJpZ2h0IEplcmVteSBBc2hrZW5hcywgRG9jdW1lbnRDbG91ZCBhbmQgSW52ZXN0aWdhdGl2ZSBSZXBvcnRlcnMgJiBFZGl0b3JzXG4gKi9cblxuLyoqIFVzZWQgYXMgdGhlIGBUeXBlRXJyb3JgIG1lc3NhZ2UgZm9yIFwiRnVuY3Rpb25zXCIgbWV0aG9kcy4gKi9cbnZhciBGVU5DX0VSUk9SX1RFWFQgPSAnRXhwZWN0ZWQgYSBmdW5jdGlvbic7XG5cbi8qKiBVc2VkIGFzIHJlZmVyZW5jZXMgZm9yIHZhcmlvdXMgYE51bWJlcmAgY29uc3RhbnRzLiAqL1xudmFyIE5BTiA9IDAgLyAwO1xuXG4vKiogYE9iamVjdCN0b1N0cmluZ2AgcmVzdWx0IHJlZmVyZW5jZXMuICovXG52YXIgc3ltYm9sVGFnID0gJ1tvYmplY3QgU3ltYm9sXSc7XG5cbi8qKiBVc2VkIHRvIG1hdGNoIGxlYWRpbmcgYW5kIHRyYWlsaW5nIHdoaXRlc3BhY2UuICovXG52YXIgcmVUcmltID0gL15cXHMrfFxccyskL2c7XG5cbi8qKiBVc2VkIHRvIGRldGVjdCBiYWQgc2lnbmVkIGhleGFkZWNpbWFsIHN0cmluZyB2YWx1ZXMuICovXG52YXIgcmVJc0JhZEhleCA9IC9eWy0rXTB4WzAtOWEtZl0rJC9pO1xuXG4vKiogVXNlZCB0byBkZXRlY3QgYmluYXJ5IHN0cmluZyB2YWx1ZXMuICovXG52YXIgcmVJc0JpbmFyeSA9IC9eMGJbMDFdKyQvaTtcblxuLyoqIFVzZWQgdG8gZGV0ZWN0IG9jdGFsIHN0cmluZyB2YWx1ZXMuICovXG52YXIgcmVJc09jdGFsID0gL14wb1swLTddKyQvaTtcblxuLyoqIEJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzIHdpdGhvdXQgYSBkZXBlbmRlbmN5IG9uIGByb290YC4gKi9cbnZhciBmcmVlUGFyc2VJbnQgPSBwYXJzZUludDtcblxuLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBnbG9iYWxgIGZyb20gTm9kZS5qcy4gKi9cbnZhciBmcmVlR2xvYmFsID0gdHlwZW9mIGdsb2JhbCA9PSAnb2JqZWN0JyAmJiBnbG9iYWwgJiYgZ2xvYmFsLk9iamVjdCA9PT0gT2JqZWN0ICYmIGdsb2JhbDtcblxuLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBzZWxmYC4gKi9cbnZhciBmcmVlU2VsZiA9IHR5cGVvZiBzZWxmID09ICdvYmplY3QnICYmIHNlbGYgJiYgc2VsZi5PYmplY3QgPT09IE9iamVjdCAmJiBzZWxmO1xuXG4vKiogVXNlZCBhcyBhIHJlZmVyZW5jZSB0byB0aGUgZ2xvYmFsIG9iamVjdC4gKi9cbnZhciByb290ID0gZnJlZUdsb2JhbCB8fCBmcmVlU2VsZiB8fCBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpO1xuXG4vKiogVXNlZCBmb3IgYnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMuICovXG52YXIgb2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlO1xuXG4vKipcbiAqIFVzZWQgdG8gcmVzb2x2ZSB0aGVcbiAqIFtgdG9TdHJpbmdUYWdgXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1vYmplY3QucHJvdG90eXBlLnRvc3RyaW5nKVxuICogb2YgdmFsdWVzLlxuICovXG52YXIgb2JqZWN0VG9TdHJpbmcgPSBvYmplY3RQcm90by50b1N0cmluZztcblxuLyogQnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMgZm9yIHRob3NlIHdpdGggdGhlIHNhbWUgbmFtZSBhcyBvdGhlciBgbG9kYXNoYCBtZXRob2RzLiAqL1xudmFyIG5hdGl2ZU1heCA9IE1hdGgubWF4LFxuICAgIG5hdGl2ZU1pbiA9IE1hdGgubWluO1xuXG4vKipcbiAqIEdldHMgdGhlIHRpbWVzdGFtcCBvZiB0aGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0aGF0IGhhdmUgZWxhcHNlZCBzaW5jZVxuICogdGhlIFVuaXggZXBvY2ggKDEgSmFudWFyeSAxOTcwIDAwOjAwOjAwIFVUQykuXG4gKlxuICogQHN0YXRpY1xuICogQG1lbWJlck9mIF9cbiAqIEBzaW5jZSAyLjQuMFxuICogQGNhdGVnb3J5IERhdGVcbiAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIHRpbWVzdGFtcC5cbiAqIEBleGFtcGxlXG4gKlxuICogXy5kZWZlcihmdW5jdGlvbihzdGFtcCkge1xuICogICBjb25zb2xlLmxvZyhfLm5vdygpIC0gc3RhbXApO1xuICogfSwgXy5ub3coKSk7XG4gKiAvLyA9PiBMb2dzIHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIGl0IHRvb2sgZm9yIHRoZSBkZWZlcnJlZCBpbnZvY2F0aW9uLlxuICovXG52YXIgbm93ID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiByb290LkRhdGUubm93KCk7XG59O1xuXG4vKipcbiAqIENyZWF0ZXMgYSBkZWJvdW5jZWQgZnVuY3Rpb24gdGhhdCBkZWxheXMgaW52b2tpbmcgYGZ1bmNgIHVudGlsIGFmdGVyIGB3YWl0YFxuICogbWlsbGlzZWNvbmRzIGhhdmUgZWxhcHNlZCBzaW5jZSB0aGUgbGFzdCB0aW1lIHRoZSBkZWJvdW5jZWQgZnVuY3Rpb24gd2FzXG4gKiBpbnZva2VkLiBUaGUgZGVib3VuY2VkIGZ1bmN0aW9uIGNvbWVzIHdpdGggYSBgY2FuY2VsYCBtZXRob2QgdG8gY2FuY2VsXG4gKiBkZWxheWVkIGBmdW5jYCBpbnZvY2F0aW9ucyBhbmQgYSBgZmx1c2hgIG1ldGhvZCB0byBpbW1lZGlhdGVseSBpbnZva2UgdGhlbS5cbiAqIFByb3ZpZGUgYG9wdGlvbnNgIHRvIGluZGljYXRlIHdoZXRoZXIgYGZ1bmNgIHNob3VsZCBiZSBpbnZva2VkIG9uIHRoZVxuICogbGVhZGluZyBhbmQvb3IgdHJhaWxpbmcgZWRnZSBvZiB0aGUgYHdhaXRgIHRpbWVvdXQuIFRoZSBgZnVuY2AgaXMgaW52b2tlZFxuICogd2l0aCB0aGUgbGFzdCBhcmd1bWVudHMgcHJvdmlkZWQgdG8gdGhlIGRlYm91bmNlZCBmdW5jdGlvbi4gU3Vic2VxdWVudFxuICogY2FsbHMgdG8gdGhlIGRlYm91bmNlZCBmdW5jdGlvbiByZXR1cm4gdGhlIHJlc3VsdCBvZiB0aGUgbGFzdCBgZnVuY2BcbiAqIGludm9jYXRpb24uXG4gKlxuICogKipOb3RlOioqIElmIGBsZWFkaW5nYCBhbmQgYHRyYWlsaW5nYCBvcHRpb25zIGFyZSBgdHJ1ZWAsIGBmdW5jYCBpc1xuICogaW52b2tlZCBvbiB0aGUgdHJhaWxpbmcgZWRnZSBvZiB0aGUgdGltZW91dCBvbmx5IGlmIHRoZSBkZWJvdW5jZWQgZnVuY3Rpb25cbiAqIGlzIGludm9rZWQgbW9yZSB0aGFuIG9uY2UgZHVyaW5nIHRoZSBgd2FpdGAgdGltZW91dC5cbiAqXG4gKiBJZiBgd2FpdGAgaXMgYDBgIGFuZCBgbGVhZGluZ2AgaXMgYGZhbHNlYCwgYGZ1bmNgIGludm9jYXRpb24gaXMgZGVmZXJyZWRcbiAqIHVudGlsIHRvIHRoZSBuZXh0IHRpY2ssIHNpbWlsYXIgdG8gYHNldFRpbWVvdXRgIHdpdGggYSB0aW1lb3V0IG9mIGAwYC5cbiAqXG4gKiBTZWUgW0RhdmlkIENvcmJhY2hvJ3MgYXJ0aWNsZV0oaHR0cHM6Ly9jc3MtdHJpY2tzLmNvbS9kZWJvdW5jaW5nLXRocm90dGxpbmctZXhwbGFpbmVkLWV4YW1wbGVzLylcbiAqIGZvciBkZXRhaWxzIG92ZXIgdGhlIGRpZmZlcmVuY2VzIGJldHdlZW4gYF8uZGVib3VuY2VgIGFuZCBgXy50aHJvdHRsZWAuXG4gKlxuICogQHN0YXRpY1xuICogQG1lbWJlck9mIF9cbiAqIEBzaW5jZSAwLjEuMFxuICogQGNhdGVnb3J5IEZ1bmN0aW9uXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBkZWJvdW5jZS5cbiAqIEBwYXJhbSB7bnVtYmVyfSBbd2FpdD0wXSBUaGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byBkZWxheS5cbiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucz17fV0gVGhlIG9wdGlvbnMgb2JqZWN0LlxuICogQHBhcmFtIHtib29sZWFufSBbb3B0aW9ucy5sZWFkaW5nPWZhbHNlXVxuICogIFNwZWNpZnkgaW52b2tpbmcgb24gdGhlIGxlYWRpbmcgZWRnZSBvZiB0aGUgdGltZW91dC5cbiAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy5tYXhXYWl0XVxuICogIFRoZSBtYXhpbXVtIHRpbWUgYGZ1bmNgIGlzIGFsbG93ZWQgdG8gYmUgZGVsYXllZCBiZWZvcmUgaXQncyBpbnZva2VkLlxuICogQHBhcmFtIHtib29sZWFufSBbb3B0aW9ucy50cmFpbGluZz10cnVlXVxuICogIFNwZWNpZnkgaW52b2tpbmcgb24gdGhlIHRyYWlsaW5nIGVkZ2Ugb2YgdGhlIHRpbWVvdXQuXG4gKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBkZWJvdW5jZWQgZnVuY3Rpb24uXG4gKiBAZXhhbXBsZVxuICpcbiAqIC8vIEF2b2lkIGNvc3RseSBjYWxjdWxhdGlvbnMgd2hpbGUgdGhlIHdpbmRvdyBzaXplIGlzIGluIGZsdXguXG4gKiBqUXVlcnkod2luZG93KS5vbigncmVzaXplJywgXy5kZWJvdW5jZShjYWxjdWxhdGVMYXlvdXQsIDE1MCkpO1xuICpcbiAqIC8vIEludm9rZSBgc2VuZE1haWxgIHdoZW4gY2xpY2tlZCwgZGVib3VuY2luZyBzdWJzZXF1ZW50IGNhbGxzLlxuICogalF1ZXJ5KGVsZW1lbnQpLm9uKCdjbGljaycsIF8uZGVib3VuY2Uoc2VuZE1haWwsIDMwMCwge1xuICogICAnbGVhZGluZyc6IHRydWUsXG4gKiAgICd0cmFpbGluZyc6IGZhbHNlXG4gKiB9KSk7XG4gKlxuICogLy8gRW5zdXJlIGBiYXRjaExvZ2AgaXMgaW52b2tlZCBvbmNlIGFmdGVyIDEgc2Vjb25kIG9mIGRlYm91bmNlZCBjYWxscy5cbiAqIHZhciBkZWJvdW5jZWQgPSBfLmRlYm91bmNlKGJhdGNoTG9nLCAyNTAsIHsgJ21heFdhaXQnOiAxMDAwIH0pO1xuICogdmFyIHNvdXJjZSA9IG5ldyBFdmVudFNvdXJjZSgnL3N0cmVhbScpO1xuICogalF1ZXJ5KHNvdXJjZSkub24oJ21lc3NhZ2UnLCBkZWJvdW5jZWQpO1xuICpcbiAqIC8vIENhbmNlbCB0aGUgdHJhaWxpbmcgZGVib3VuY2VkIGludm9jYXRpb24uXG4gKiBqUXVlcnkod2luZG93KS5vbigncG9wc3RhdGUnLCBkZWJvdW5jZWQuY2FuY2VsKTtcbiAqL1xuZnVuY3Rpb24gZGVib3VuY2UoZnVuYywgd2FpdCwgb3B0aW9ucykge1xuICB2YXIgbGFzdEFyZ3MsXG4gICAgICBsYXN0VGhpcyxcbiAgICAgIG1heFdhaXQsXG4gICAgICByZXN1bHQsXG4gICAgICB0aW1lcklkLFxuICAgICAgbGFzdENhbGxUaW1lLFxuICAgICAgbGFzdEludm9rZVRpbWUgPSAwLFxuICAgICAgbGVhZGluZyA9IGZhbHNlLFxuICAgICAgbWF4aW5nID0gZmFsc2UsXG4gICAgICB0cmFpbGluZyA9IHRydWU7XG5cbiAgaWYgKHR5cGVvZiBmdW5jICE9ICdmdW5jdGlvbicpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKEZVTkNfRVJST1JfVEVYVCk7XG4gIH1cbiAgd2FpdCA9IHRvTnVtYmVyKHdhaXQpIHx8IDA7XG4gIGlmIChpc09iamVjdChvcHRpb25zKSkge1xuICAgIGxlYWRpbmcgPSAhIW9wdGlvbnMubGVhZGluZztcbiAgICBtYXhpbmcgPSAnbWF4V2FpdCcgaW4gb3B0aW9ucztcbiAgICBtYXhXYWl0ID0gbWF4aW5nID8gbmF0aXZlTWF4KHRvTnVtYmVyKG9wdGlvbnMubWF4V2FpdCkgfHwgMCwgd2FpdCkgOiBtYXhXYWl0O1xuICAgIHRyYWlsaW5nID0gJ3RyYWlsaW5nJyBpbiBvcHRpb25zID8gISFvcHRpb25zLnRyYWlsaW5nIDogdHJhaWxpbmc7XG4gIH1cblxuICBmdW5jdGlvbiBpbnZva2VGdW5jKHRpbWUpIHtcbiAgICB2YXIgYXJncyA9IGxhc3RBcmdzLFxuICAgICAgICB0aGlzQXJnID0gbGFzdFRoaXM7XG5cbiAgICBsYXN0QXJncyA9IGxhc3RUaGlzID0gdW5kZWZpbmVkO1xuICAgIGxhc3RJbnZva2VUaW1lID0gdGltZTtcbiAgICByZXN1bHQgPSBmdW5jLmFwcGx5KHRoaXNBcmcsIGFyZ3MpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBmdW5jdGlvbiBsZWFkaW5nRWRnZSh0aW1lKSB7XG4gICAgLy8gUmVzZXQgYW55IGBtYXhXYWl0YCB0aW1lci5cbiAgICBsYXN0SW52b2tlVGltZSA9IHRpbWU7XG4gICAgLy8gU3RhcnQgdGhlIHRpbWVyIGZvciB0aGUgdHJhaWxpbmcgZWRnZS5cbiAgICB0aW1lcklkID0gc2V0VGltZW91dCh0aW1lckV4cGlyZWQsIHdhaXQpO1xuICAgIC8vIEludm9rZSB0aGUgbGVhZGluZyBlZGdlLlxuICAgIHJldHVybiBsZWFkaW5nID8gaW52b2tlRnVuYyh0aW1lKSA6IHJlc3VsdDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbWFpbmluZ1dhaXQodGltZSkge1xuICAgIHZhciB0aW1lU2luY2VMYXN0Q2FsbCA9IHRpbWUgLSBsYXN0Q2FsbFRpbWUsXG4gICAgICAgIHRpbWVTaW5jZUxhc3RJbnZva2UgPSB0aW1lIC0gbGFzdEludm9rZVRpbWUsXG4gICAgICAgIHJlc3VsdCA9IHdhaXQgLSB0aW1lU2luY2VMYXN0Q2FsbDtcblxuICAgIHJldHVybiBtYXhpbmcgPyBuYXRpdmVNaW4ocmVzdWx0LCBtYXhXYWl0IC0gdGltZVNpbmNlTGFzdEludm9rZSkgOiByZXN1bHQ7XG4gIH1cblxuICBmdW5jdGlvbiBzaG91bGRJbnZva2UodGltZSkge1xuICAgIHZhciB0aW1lU2luY2VMYXN0Q2FsbCA9IHRpbWUgLSBsYXN0Q2FsbFRpbWUsXG4gICAgICAgIHRpbWVTaW5jZUxhc3RJbnZva2UgPSB0aW1lIC0gbGFzdEludm9rZVRpbWU7XG5cbiAgICAvLyBFaXRoZXIgdGhpcyBpcyB0aGUgZmlyc3QgY2FsbCwgYWN0aXZpdHkgaGFzIHN0b3BwZWQgYW5kIHdlJ3JlIGF0IHRoZVxuICAgIC8vIHRyYWlsaW5nIGVkZ2UsIHRoZSBzeXN0ZW0gdGltZSBoYXMgZ29uZSBiYWNrd2FyZHMgYW5kIHdlJ3JlIHRyZWF0aW5nXG4gICAgLy8gaXQgYXMgdGhlIHRyYWlsaW5nIGVkZ2UsIG9yIHdlJ3ZlIGhpdCB0aGUgYG1heFdhaXRgIGxpbWl0LlxuICAgIHJldHVybiAobGFzdENhbGxUaW1lID09PSB1bmRlZmluZWQgfHwgKHRpbWVTaW5jZUxhc3RDYWxsID49IHdhaXQpIHx8XG4gICAgICAodGltZVNpbmNlTGFzdENhbGwgPCAwKSB8fCAobWF4aW5nICYmIHRpbWVTaW5jZUxhc3RJbnZva2UgPj0gbWF4V2FpdCkpO1xuICB9XG5cbiAgZnVuY3Rpb24gdGltZXJFeHBpcmVkKCkge1xuICAgIHZhciB0aW1lID0gbm93KCk7XG4gICAgaWYgKHNob3VsZEludm9rZSh0aW1lKSkge1xuICAgICAgcmV0dXJuIHRyYWlsaW5nRWRnZSh0aW1lKTtcbiAgICB9XG4gICAgLy8gUmVzdGFydCB0aGUgdGltZXIuXG4gICAgdGltZXJJZCA9IHNldFRpbWVvdXQodGltZXJFeHBpcmVkLCByZW1haW5pbmdXYWl0KHRpbWUpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHRyYWlsaW5nRWRnZSh0aW1lKSB7XG4gICAgdGltZXJJZCA9IHVuZGVmaW5lZDtcblxuICAgIC8vIE9ubHkgaW52b2tlIGlmIHdlIGhhdmUgYGxhc3RBcmdzYCB3aGljaCBtZWFucyBgZnVuY2AgaGFzIGJlZW5cbiAgICAvLyBkZWJvdW5jZWQgYXQgbGVhc3Qgb25jZS5cbiAgICBpZiAodHJhaWxpbmcgJiYgbGFzdEFyZ3MpIHtcbiAgICAgIHJldHVybiBpbnZva2VGdW5jKHRpbWUpO1xuICAgIH1cbiAgICBsYXN0QXJncyA9IGxhc3RUaGlzID0gdW5kZWZpbmVkO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBmdW5jdGlvbiBjYW5jZWwoKSB7XG4gICAgaWYgKHRpbWVySWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgY2xlYXJUaW1lb3V0KHRpbWVySWQpO1xuICAgIH1cbiAgICBsYXN0SW52b2tlVGltZSA9IDA7XG4gICAgbGFzdEFyZ3MgPSBsYXN0Q2FsbFRpbWUgPSBsYXN0VGhpcyA9IHRpbWVySWQgPSB1bmRlZmluZWQ7XG4gIH1cblxuICBmdW5jdGlvbiBmbHVzaCgpIHtcbiAgICByZXR1cm4gdGltZXJJZCA9PT0gdW5kZWZpbmVkID8gcmVzdWx0IDogdHJhaWxpbmdFZGdlKG5vdygpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGRlYm91bmNlZCgpIHtcbiAgICB2YXIgdGltZSA9IG5vdygpLFxuICAgICAgICBpc0ludm9raW5nID0gc2hvdWxkSW52b2tlKHRpbWUpO1xuXG4gICAgbGFzdEFyZ3MgPSBhcmd1bWVudHM7XG4gICAgbGFzdFRoaXMgPSB0aGlzO1xuICAgIGxhc3RDYWxsVGltZSA9IHRpbWU7XG5cbiAgICBpZiAoaXNJbnZva2luZykge1xuICAgICAgaWYgKHRpbWVySWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gbGVhZGluZ0VkZ2UobGFzdENhbGxUaW1lKTtcbiAgICAgIH1cbiAgICAgIGlmIChtYXhpbmcpIHtcbiAgICAgICAgLy8gSGFuZGxlIGludm9jYXRpb25zIGluIGEgdGlnaHQgbG9vcC5cbiAgICAgICAgdGltZXJJZCA9IHNldFRpbWVvdXQodGltZXJFeHBpcmVkLCB3YWl0KTtcbiAgICAgICAgcmV0dXJuIGludm9rZUZ1bmMobGFzdENhbGxUaW1lKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRpbWVySWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGltZXJJZCA9IHNldFRpbWVvdXQodGltZXJFeHBpcmVkLCB3YWl0KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuICBkZWJvdW5jZWQuY2FuY2VsID0gY2FuY2VsO1xuICBkZWJvdW5jZWQuZmx1c2ggPSBmbHVzaDtcbiAgcmV0dXJuIGRlYm91bmNlZDtcbn1cblxuLyoqXG4gKiBDaGVja3MgaWYgYHZhbHVlYCBpcyB0aGVcbiAqIFtsYW5ndWFnZSB0eXBlXShodHRwOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtZWNtYXNjcmlwdC1sYW5ndWFnZS10eXBlcylcbiAqIG9mIGBPYmplY3RgLiAoZS5nLiBhcnJheXMsIGZ1bmN0aW9ucywgb2JqZWN0cywgcmVnZXhlcywgYG5ldyBOdW1iZXIoMClgLCBhbmQgYG5ldyBTdHJpbmcoJycpYClcbiAqXG4gKiBAc3RhdGljXG4gKiBAbWVtYmVyT2YgX1xuICogQHNpbmNlIDAuMS4wXG4gKiBAY2F0ZWdvcnkgTGFuZ1xuICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhbiBvYmplY3QsIGVsc2UgYGZhbHNlYC5cbiAqIEBleGFtcGxlXG4gKlxuICogXy5pc09iamVjdCh7fSk7XG4gKiAvLyA9PiB0cnVlXG4gKlxuICogXy5pc09iamVjdChbMSwgMiwgM10pO1xuICogLy8gPT4gdHJ1ZVxuICpcbiAqIF8uaXNPYmplY3QoXy5ub29wKTtcbiAqIC8vID0+IHRydWVcbiAqXG4gKiBfLmlzT2JqZWN0KG51bGwpO1xuICogLy8gPT4gZmFsc2VcbiAqL1xuZnVuY3Rpb24gaXNPYmplY3QodmFsdWUpIHtcbiAgdmFyIHR5cGUgPSB0eXBlb2YgdmFsdWU7XG4gIHJldHVybiAhIXZhbHVlICYmICh0eXBlID09ICdvYmplY3QnIHx8IHR5cGUgPT0gJ2Z1bmN0aW9uJyk7XG59XG5cbi8qKlxuICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgb2JqZWN0LWxpa2UuIEEgdmFsdWUgaXMgb2JqZWN0LWxpa2UgaWYgaXQncyBub3QgYG51bGxgXG4gKiBhbmQgaGFzIGEgYHR5cGVvZmAgcmVzdWx0IG9mIFwib2JqZWN0XCIuXG4gKlxuICogQHN0YXRpY1xuICogQG1lbWJlck9mIF9cbiAqIEBzaW5jZSA0LjAuMFxuICogQGNhdGVnb3J5IExhbmdcbiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgb2JqZWN0LWxpa2UsIGVsc2UgYGZhbHNlYC5cbiAqIEBleGFtcGxlXG4gKlxuICogXy5pc09iamVjdExpa2Uoe30pO1xuICogLy8gPT4gdHJ1ZVxuICpcbiAqIF8uaXNPYmplY3RMaWtlKFsxLCAyLCAzXSk7XG4gKiAvLyA9PiB0cnVlXG4gKlxuICogXy5pc09iamVjdExpa2UoXy5ub29wKTtcbiAqIC8vID0+IGZhbHNlXG4gKlxuICogXy5pc09iamVjdExpa2UobnVsbCk7XG4gKiAvLyA9PiBmYWxzZVxuICovXG5mdW5jdGlvbiBpc09iamVjdExpa2UodmFsdWUpIHtcbiAgcmV0dXJuICEhdmFsdWUgJiYgdHlwZW9mIHZhbHVlID09ICdvYmplY3QnO1xufVxuXG4vKipcbiAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSBgU3ltYm9sYCBwcmltaXRpdmUgb3Igb2JqZWN0LlxuICpcbiAqIEBzdGF0aWNcbiAqIEBtZW1iZXJPZiBfXG4gKiBAc2luY2UgNC4wLjBcbiAqIEBjYXRlZ29yeSBMYW5nXG4gKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgc3ltYm9sLCBlbHNlIGBmYWxzZWAuXG4gKiBAZXhhbXBsZVxuICpcbiAqIF8uaXNTeW1ib2woU3ltYm9sLml0ZXJhdG9yKTtcbiAqIC8vID0+IHRydWVcbiAqXG4gKiBfLmlzU3ltYm9sKCdhYmMnKTtcbiAqIC8vID0+IGZhbHNlXG4gKi9cbmZ1bmN0aW9uIGlzU3ltYm9sKHZhbHVlKSB7XG4gIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ3N5bWJvbCcgfHxcbiAgICAoaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBvYmplY3RUb1N0cmluZy5jYWxsKHZhbHVlKSA9PSBzeW1ib2xUYWcpO1xufVxuXG4vKipcbiAqIENvbnZlcnRzIGB2YWx1ZWAgdG8gYSBudW1iZXIuXG4gKlxuICogQHN0YXRpY1xuICogQG1lbWJlck9mIF9cbiAqIEBzaW5jZSA0LjAuMFxuICogQGNhdGVnb3J5IExhbmdcbiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHByb2Nlc3MuXG4gKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBudW1iZXIuXG4gKiBAZXhhbXBsZVxuICpcbiAqIF8udG9OdW1iZXIoMy4yKTtcbiAqIC8vID0+IDMuMlxuICpcbiAqIF8udG9OdW1iZXIoTnVtYmVyLk1JTl9WQUxVRSk7XG4gKiAvLyA9PiA1ZS0zMjRcbiAqXG4gKiBfLnRvTnVtYmVyKEluZmluaXR5KTtcbiAqIC8vID0+IEluZmluaXR5XG4gKlxuICogXy50b051bWJlcignMy4yJyk7XG4gKiAvLyA9PiAzLjJcbiAqL1xuZnVuY3Rpb24gdG9OdW1iZXIodmFsdWUpIHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJykge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuICBpZiAoaXNTeW1ib2wodmFsdWUpKSB7XG4gICAgcmV0dXJuIE5BTjtcbiAgfVxuICBpZiAoaXNPYmplY3QodmFsdWUpKSB7XG4gICAgdmFyIG90aGVyID0gdHlwZW9mIHZhbHVlLnZhbHVlT2YgPT0gJ2Z1bmN0aW9uJyA/IHZhbHVlLnZhbHVlT2YoKSA6IHZhbHVlO1xuICAgIHZhbHVlID0gaXNPYmplY3Qob3RoZXIpID8gKG90aGVyICsgJycpIDogb3RoZXI7XG4gIH1cbiAgaWYgKHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykge1xuICAgIHJldHVybiB2YWx1ZSA9PT0gMCA/IHZhbHVlIDogK3ZhbHVlO1xuICB9XG4gIHZhbHVlID0gdmFsdWUucmVwbGFjZShyZVRyaW0sICcnKTtcbiAgdmFyIGlzQmluYXJ5ID0gcmVJc0JpbmFyeS50ZXN0KHZhbHVlKTtcbiAgcmV0dXJuIChpc0JpbmFyeSB8fCByZUlzT2N0YWwudGVzdCh2YWx1ZSkpXG4gICAgPyBmcmVlUGFyc2VJbnQodmFsdWUuc2xpY2UoMiksIGlzQmluYXJ5ID8gMiA6IDgpXG4gICAgOiAocmVJc0JhZEhleC50ZXN0KHZhbHVlKSA/IE5BTiA6ICt2YWx1ZSk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gZGVib3VuY2U7XG4iLCAiaW1wb3J0IHsgUGx1Z2luLCBhZGRJY29uIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5cbmltcG9ydCB7IEQyUGx1Z2luU2V0dGluZ3MsIEQyU2V0dGluZ3NUYWIsIERFRkFVTFRfU0VUVElOR1MgfSBmcm9tIFwiLi9zZXR0aW5nc1wiO1xuaW1wb3J0IHsgRDJQcm9jZXNzb3IgfSBmcm9tIFwiLi9wcm9jZXNzb3JcIjtcbmltcG9ydCB7IFJlY29tcGlsZUljb24gfSBmcm9tIFwiLi9jb25zdGFudHNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRDJQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xuICBzZXR0aW5nczogRDJQbHVnaW5TZXR0aW5ncztcbiAgcHJvY2Vzc29yOiBEMlByb2Nlc3NvcjtcblxuICBhc3luYyBvbmxvYWQoKSB7XG4gICAgYWRkSWNvbihcInJlY29tcGlsZVwiLCBSZWNvbXBpbGVJY29uKTtcbiAgICBhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xuICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgRDJTZXR0aW5nc1RhYih0aGlzLmFwcCwgdGhpcykpO1xuXG4gICAgY29uc3QgcHJvY2Vzc29yID0gbmV3IEQyUHJvY2Vzc29yKHRoaXMpO1xuICAgIHRoaXMucmVnaXN0ZXJNYXJrZG93bkNvZGVCbG9ja1Byb2Nlc3NvcihcImQyXCIsIHByb2Nlc3Nvci5hdHRlbXB0RXhwb3J0KTtcblxuICAgIHRoaXMucHJvY2Vzc29yID0gcHJvY2Vzc29yO1xuICB9XG5cbiAgb251bmxvYWQoKSB7XG4gICAgY29uc3QgYWJvcnRDb250cm9sbGVycyA9IHRoaXMucHJvY2Vzc29yLmFib3J0Q29udHJvbGxlck1hcC52YWx1ZXMoKTtcbiAgICBBcnJheS5mcm9tKGFib3J0Q29udHJvbGxlcnMpLmZvckVhY2goKGNvbnRyb2xsZXIpID0+IHtcbiAgICAgIGNvbnRyb2xsZXIuYWJvcnQoKTtcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcbiAgICB0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcbiAgfVxuXG4gIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcbiAgICBhd2FpdCB0aGlzLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgTm90aWNlLCBBcHAsIFBsdWdpblNldHRpbmdUYWIsIFNldHRpbmcgfSBmcm9tIFwib2JzaWRpYW5cIjtcblxuaW1wb3J0IEQyUGx1Z2luIGZyb20gXCIuL21haW5cIjtcbmltcG9ydCB7IExBWU9VVF9FTkdJTkVTIH0gZnJvbSBcIi4vY29uc3RhbnRzXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRDJQbHVnaW5TZXR0aW5ncyB7XG4gIGxheW91dEVuZ2luZTogc3RyaW5nO1xuICBhcGlUb2tlbjogc3RyaW5nO1xuICBkZWJvdW5jZTogbnVtYmVyO1xuICB0aGVtZTogbnVtYmVyO1xuICBkMlBhdGg6IHN0cmluZztcbiAgcGFkOiBudW1iZXI7XG4gIHNrZXRjaDogYm9vbGVhbjtcbiAgY29udGFpbmVySGVpZ2h0OiBudW1iZXI7XG59XG5cbmV4cG9ydCBjb25zdCBERUZBVUxUX1NFVFRJTkdTOiBEMlBsdWdpblNldHRpbmdzID0ge1xuICBsYXlvdXRFbmdpbmU6IFwiZGFncmVcIixcbiAgZGVib3VuY2U6IDUwMCxcbiAgdGhlbWU6IDAsXG4gIGFwaVRva2VuOiBcIlwiLFxuICBkMlBhdGg6IFwiXCIsXG4gIHBhZDogMTAwLFxuICBza2V0Y2g6IGZhbHNlLFxuICBjb250YWluZXJIZWlnaHQ6IDgwMCxcbn07XG5cbmV4cG9ydCBjbGFzcyBEMlNldHRpbmdzVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XG4gIHBsdWdpbjogRDJQbHVnaW47XG4gIHRhbGFTZXR0aW5nczogSFRNTERpdkVsZW1lbnQ7XG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogRDJQbHVnaW4pIHtcbiAgICBzdXBlcihhcHAsIHBsdWdpbik7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gIH1cblxuICBhZGRUQUxBU2V0dGluZ3MoKSB7XG4gICAgY29uc3QgdGFsYVNldHRpbmdzID0gdGhpcy5jb250YWluZXJFbC5jcmVhdGVFbChcImRpdlwiKTtcbiAgICB0YWxhU2V0dGluZ3MuY3JlYXRlRWwoXCJoM1wiLCB7XG4gICAgICB0ZXh0OiBcIlRBTEEgc2V0dGluZ3NcIixcbiAgICB9KTtcbiAgICBuZXcgU2V0dGluZyh0YWxhU2V0dGluZ3MpXG4gICAgICAuc2V0TmFtZShcIkFQSSB0b2tlblwiKVxuICAgICAgLnNldERlc2MoXG4gICAgICAgICdUbyB1c2UgVEFMQSwgY29weSB5b3VyIEFQSSB0b2tlbiBoZXJlIG9yIGluIH4vLmxvY2FsL3N0YXRlL3RzdHJ1Y3QvYXV0aC5qc29uIHVuZGVyIHRoZSBmaWVsZCBcImFwaV90b2tlblwiJ1xuICAgICAgKVxuICAgICAgLmFkZFRleHQoKHRleHQpID0+XG4gICAgICAgIHRleHRcbiAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoXCJ0c3RydWN0Xy4uLlwiKVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5hcGlUb2tlbilcbiAgICAgICAgICAuc2V0RGlzYWJsZWQodGhpcy5wbHVnaW4uc2V0dGluZ3MubGF5b3V0RW5naW5lICE9PSBMQVlPVVRfRU5HSU5FUy5UQUxBLnZhbHVlKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSAmJiAhdmFsdWUuc3RhcnRzV2l0aChcInRzdHJ1Y3RfXCIpKSB7XG4gICAgICAgICAgICAgIG5ldyBOb3RpY2UoXCJJbnZhbGlkIEFQSSB0b2tlblwiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmFwaVRva2VuID0gdmFsdWU7XG4gICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgdGhpcy50YWxhU2V0dGluZ3MgPSB0YWxhU2V0dGluZ3M7XG4gIH1cblxuICBkaXNwbGF5KCk6IHZvaWQge1xuICAgIGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG4gICAgY29udGFpbmVyRWwuZW1wdHkoKTtcbiAgICBjb250YWluZXJFbC5jcmVhdGVFbChcImgxXCIsIHsgdGV4dDogXCJEMiBwbHVnaW4gc2V0dGluZ3NcIiB9KTtcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJMYXlvdXQgZW5naW5lXCIpXG4gICAgICAuc2V0RGVzYyhcbiAgICAgICAgJ0F2YWlsYWJsZSBsYXlvdXQgZW5naW5lcyBpbmNsdWRlIFwiZGFncmVcIiwgXCJFTEtcIiwgYW5kIFwiVEFMQVwiIChUQUxBIG11c3QgYmUgaW5zdGFsbGVkIHNlcGFyYXRlbHkgZnJvbSBEMiknXG4gICAgICApXG4gICAgICAuYWRkRHJvcGRvd24oKGRyb3Bkb3duKSA9PiB7XG4gICAgICAgIGRyb3Bkb3duXG4gICAgICAgICAgLmFkZE9wdGlvbihMQVlPVVRfRU5HSU5FUy5EQUdSRS52YWx1ZSwgTEFZT1VUX0VOR0lORVMuREFHUkUubGFiZWwpXG4gICAgICAgICAgLmFkZE9wdGlvbihMQVlPVVRfRU5HSU5FUy5FTEsudmFsdWUsIExBWU9VVF9FTkdJTkVTLkVMSy5sYWJlbClcbiAgICAgICAgICAuYWRkT3B0aW9uKExBWU9VVF9FTkdJTkVTLlRBTEEudmFsdWUsIExBWU9VVF9FTkdJTkVTLlRBTEEubGFiZWwpXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmxheW91dEVuZ2luZSlcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5sYXlvdXRFbmdpbmUgPSB2YWx1ZTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgaWYgKHZhbHVlID09PSBMQVlPVVRfRU5HSU5FUy5UQUxBLnZhbHVlKSB7XG4gICAgICAgICAgICAgIHRoaXMuYWRkVEFMQVNldHRpbmdzKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0aGlzLnRhbGFTZXR0aW5ncz8ucmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJUaGVtZSBJRFwiKVxuICAgICAgLnNldERlc2MoXG4gICAgICAgIFwiQXZhaWxhYmxlIHRoZW1lcyBhcmUgbG9jYXRlZCBhdCBodHRwczovL2dpdGh1Yi5jb20vdGVycmFzdHJ1Y3QvZDIvdHJlZS9tYXN0ZXIvZDJ0aGVtZXNcIlxuICAgICAgKVxuICAgICAgLmFkZFRleHQoKHRleHQpID0+XG4gICAgICAgIHRleHRcbiAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoXCJFbnRlciBhIHRoZW1lIElEXCIpXG4gICAgICAgICAgLnNldFZhbHVlKFN0cmluZyh0aGlzLnBsdWdpbi5zZXR0aW5ncy50aGVtZSkpXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgaWYgKCFpc05hTihOdW1iZXIodmFsdWUpKSB8fCB2YWx1ZSA9PT0gXCJcIikge1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy50aGVtZSA9IE51bWJlcih2YWx1ZSB8fCBERUZBVUxUX1NFVFRJTkdTLnRoZW1lKTtcbiAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBuZXcgTm90aWNlKFwiUGxlYXNlIHNwZWNpZnkgYSB2YWxpZCBudW1iZXJcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiUGFkXCIpXG4gICAgICAuc2V0RGVzYyhcIlBpeGVscyBwYWRkZWQgYXJvdW5kIHRoZSByZW5kZXJlZCBkaWFncmFtXCIpXG4gICAgICAuYWRkVGV4dCgodGV4dCkgPT5cbiAgICAgICAgdGV4dFxuICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcihTdHJpbmcoREVGQVVMVF9TRVRUSU5HUy5wYWQpKVxuICAgICAgICAgIC5zZXRWYWx1ZShTdHJpbmcodGhpcy5wbHVnaW4uc2V0dGluZ3MucGFkKSlcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICBpZiAoaXNOYU4oTnVtYmVyKHZhbHVlKSkpIHtcbiAgICAgICAgICAgICAgbmV3IE5vdGljZShcIlBsZWFzZSBzcGVjaWZ5IGEgdmFsaWQgbnVtYmVyXCIpO1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wYWQgPSBOdW1iZXIoREVGQVVMVF9TRVRUSU5HUy5wYWQpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gXCJcIikge1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wYWQgPSBOdW1iZXIoREVGQVVMVF9TRVRUSU5HUy5wYWQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucGFkID0gTnVtYmVyKHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIlNrZXRjaCBtb2RlXCIpXG4gICAgICAuc2V0RGVzYyhcIlJlbmRlciB0aGUgZGlhZ3JhbSB0byBsb29rIGxpa2UgaXQgd2FzIHNrZXRjaGVkIGJ5IGhhbmRcIilcbiAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cbiAgICAgICAgdG9nZ2xlLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnNrZXRjaCkub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc2tldGNoID0gdmFsdWU7XG4gICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIkNvbnRhaW5lciBoZWlnaHRcIilcbiAgICAgIC5zZXREZXNjKFwiRGlhZ3JhbSBtYXggcmVuZGVyIGhlaWdodCBpbiBwaXhlbHMgKFJlcXVpcmVzIGQyIHYwLjIuMiBhbmQgdXApXCIpXG4gICAgICAuYWRkVGV4dCgodGV4dCkgPT5cbiAgICAgICAgdGV4dFxuICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcihTdHJpbmcoREVGQVVMVF9TRVRUSU5HUy5jb250YWluZXJIZWlnaHQpKVxuICAgICAgICAgIC5zZXRWYWx1ZShTdHJpbmcodGhpcy5wbHVnaW4uc2V0dGluZ3MuY29udGFpbmVySGVpZ2h0KSlcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICBpZiAoaXNOYU4oTnVtYmVyKHZhbHVlKSkpIHtcbiAgICAgICAgICAgICAgbmV3IE5vdGljZShcIlBsZWFzZSBzcGVjaWZ5IGEgdmFsaWQgbnVtYmVyXCIpO1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5jb250YWluZXJIZWlnaHQgPSBOdW1iZXIoXG4gICAgICAgICAgICAgICAgREVGQVVMVF9TRVRUSU5HUy5jb250YWluZXJIZWlnaHRcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuY29udGFpbmVySGVpZ2h0ID0gTnVtYmVyKFxuICAgICAgICAgICAgICAgIERFRkFVTFRfU0VUVElOR1MuY29udGFpbmVySGVpZ2h0XG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5jb250YWluZXJIZWlnaHQgPSBOdW1iZXIodmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiRGVib3VuY2VcIilcbiAgICAgIC5zZXREZXNjKFwiSG93IG9mdGVuIHNob3VsZCB0aGUgZGlhZ3JhbSByZWZyZXNoIGluIG1pbGxpc2Vjb25kcyAobWluIDEwMClcIilcbiAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PlxuICAgICAgICB0ZXh0XG4gICAgICAgICAgLnNldFBsYWNlaG9sZGVyKFN0cmluZyhERUZBVUxUX1NFVFRJTkdTLmRlYm91bmNlKSlcbiAgICAgICAgICAuc2V0VmFsdWUoU3RyaW5nKHRoaXMucGx1Z2luLnNldHRpbmdzLmRlYm91bmNlKSlcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICBpZiAoaXNOYU4oTnVtYmVyKHZhbHVlKSkpIHtcbiAgICAgICAgICAgICAgbmV3IE5vdGljZShcIlBsZWFzZSBzcGVjaWZ5IGEgdmFsaWQgbnVtYmVyXCIpO1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5kZWJvdW5jZSA9IE51bWJlcihERUZBVUxUX1NFVFRJTkdTLmRlYm91bmNlKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZGVib3VuY2UgPSBOdW1iZXIoREVGQVVMVF9TRVRUSU5HUy5kZWJvdW5jZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKE51bWJlcih2YWx1ZSkgPCAxMDApIHtcbiAgICAgICAgICAgICAgbmV3IE5vdGljZShcIlRoZSB2YWx1ZSBtdXN0IGJlIGdyZWF0ZXIgdGhhbiAxMDBcIik7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmRlYm91bmNlID0gTnVtYmVyKERFRkFVTFRfU0VUVElOR1MuZGVib3VuY2UpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZGVib3VuY2UgPSBOdW1iZXIodmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiUGF0aCAob3B0aW9uYWwpXCIpXG4gICAgICAuc2V0RGVzYyhcbiAgICAgICAgXCJDdXN0b21pemUgdGhlIGxvY2FsIHBhdGggdG8gdGhlIGRpcmVjdG9yeSBgZDJgIGlzIGluc3RhbGxlZCBpbiAoZXguIGlmIGQyIGlzIGxvY2F0ZWQgYXQgYC91c3IvbG9jYWwvYmluL2QyYCwgdGhlbiB0aGUgcGF0aCBpcyBgL3Vzci9sb2NhbC9iaW5gKS4gVGhpcyBpcyBvbmx5IG5lY2Vzc2FyeSBpZiBgZDJgIGlzIG5vdCBmb3VuZCBhdXRvbWF0aWNhbGx5IGJ5IHRoZSBwbHVnaW4gKGJ1dCBpcyBpbnN0YWxsZWQpLlwiXG4gICAgICApXG4gICAgICAuYWRkVGV4dCgodGV4dCkgPT4ge1xuICAgICAgICB0ZXh0XG4gICAgICAgICAgLnNldFBsYWNlaG9sZGVyKFwiL3Vzci9sb2NhbC9DZWxsYXJcIilcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZDJQYXRoKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmQyUGF0aCA9IHZhbHVlO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgIGlmICh0aGlzLnBsdWdpbi5zZXR0aW5ncy5sYXlvdXRFbmdpbmUgPT09IExBWU9VVF9FTkdJTkVTLlRBTEEudmFsdWUpIHtcbiAgICAgIHRoaXMuYWRkVEFMQVNldHRpbmdzKCk7XG4gICAgfVxuICB9XG59XG4iLCAiY29uc3QgTEFZT1VUX0VOR0lORVMgPSB7XG4gIERBR1JFOiB7XG4gICAgdmFsdWU6IFwiZGFncmVcIixcbiAgICBsYWJlbDogXCJkYWdyZVwiLFxuICB9LFxuICBFTEs6IHtcbiAgICB2YWx1ZTogXCJlbGtcIixcbiAgICBsYWJlbDogXCJFTEtcIixcbiAgfSxcbiAgVEFMQToge1xuICAgIHZhbHVlOiBcInRhbGFcIixcbiAgICBsYWJlbDogXCJUQUxBXCIsXG4gIH0sXG59O1xuXG5jb25zdCBSZWNvbXBpbGVJY29uID0gYFxuPHN2ZyB3aWR0aD1cIjEwMFwiIGhlaWdodD1cIjEwMFwiIHZpZXdCb3g9XCIwIDAgMTAwIDEwMFwiIGZpbGw9XCJub25lXCIgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiPlxuPHBhdGggZD1cIk04LjMzMzI1IDgzLjMzMzRWNTguMzMzNEgzMy4zMzMzXCIgc3Ryb2tlPVwiIzJFMzM0NlwiIHN0cm9rZS13aWR0aD1cIjguMzMzMzNcIiBzdHJva2UtbGluZWNhcD1cInJvdW5kXCIgc3Ryb2tlLWxpbmVqb2luPVwicm91bmRcIi8+XG48cGF0aCBkPVwiTTkxLjY2NjcgMTYuNjY2NlY0MS42NjY2SDY2LjY2NjdcIiBzdHJva2U9XCIjMkUzMzQ2XCIgc3Ryb2tlLXdpZHRoPVwiOC4zMzMzM1wiIHN0cm9rZS1saW5lY2FwPVwicm91bmRcIiBzdHJva2UtbGluZWpvaW49XCJyb3VuZFwiLz5cbjxwYXRoIGQ9XCJNMTQuNjI0OSAzNy41MDA0QzE2LjczODEgMzEuNTI4NyAyMC4zMjk2IDI2LjE4OTYgMjUuMDY0NCAyMS45ODEzQzI5Ljc5OTEgMTcuNzczIDM1LjUyMjcgMTQuODMyOCA0MS43MDExIDEzLjQzNDhDNDcuODc5NSAxMi4wMzY5IDU0LjMxMTQgMTIuMjI2OCA2MC4zOTY1IDEzLjk4N0M2Ni40ODE3IDE1Ljc0NzEgNzIuMDIxOCAxOS4wMiA3Ni40OTk5IDIzLjUwMDRDODAuOTc4IDI3Ljk4MDggOTEuNjY2NiA0MS42NjcgOTEuNjY2NiA0MS42NjdNOC4zMzMyNSA1OC4zMzM3QzguMzMzMjUgNTguMzMzNyAxOS4wMjE4IDcyLjAyIDIzLjQ5OTkgNzYuNTAwNEMyNy45NzggODAuOTgwOCAzMy41MTgxIDg0LjI1MzcgMzkuNjAzMyA4Ni4wMTM4QzQ1LjY4ODQgODcuNzc0IDUyLjEyMDMgODcuOTYzOSA1OC4yOTg3IDg2LjU2NkM2NC40NzcxIDg1LjE2OCA3MC4yMDA3IDgyLjIyNzcgNzQuOTM1NSA3OC4wMTk1Qzc5LjY3MDIgNzMuODExMiA4My4yNjE3IDY4LjQ3MjEgODUuMzc0OSA2Mi41MDA0XCIgc3Ryb2tlPVwiIzJFMzM0NlwiIHN0cm9rZS13aWR0aD1cIjguMzMzMzNcIiBzdHJva2UtbGluZWNhcD1cInJvdW5kXCIgc3Ryb2tlLWxpbmVqb2luPVwicm91bmRcIi8+XG48L3N2Zz5cbmA7XG5cbmV4cG9ydCB7IExBWU9VVF9FTkdJTkVTLCBSZWNvbXBpbGVJY29uIH07XG4iLCAiaW1wb3J0IHsgTWFya2Rvd25Qb3N0UHJvY2Vzc29yQ29udGV4dCwgQnV0dG9uQ29tcG9uZW50IH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBleGVjLCBleGVjU3luYyB9IGZyb20gXCJjaGlsZF9wcm9jZXNzXCI7XG5pbXBvcnQgeyBkZWxpbWl0ZXIgfSBmcm9tIFwicGF0aFwiO1xuaW1wb3J0IGRlYm91bmNlIGZyb20gXCJsb2Rhc2guZGVib3VuY2VcIjtcbmltcG9ydCBvcyBmcm9tIFwib3NcIjtcblxuaW1wb3J0IEQyUGx1Z2luIGZyb20gXCIuL21haW5cIjtcblxuZXhwb3J0IGNsYXNzIEQyUHJvY2Vzc29yIHtcbiAgcGx1Z2luOiBEMlBsdWdpbjtcbiAgZGVib3VuY2VkTWFwOiBNYXA8XG4gICAgc3RyaW5nLFxuICAgIChcbiAgICAgIHNvdXJjZTogc3RyaW5nLFxuICAgICAgZWw6IEhUTUxFbGVtZW50LFxuICAgICAgY3R4OiBNYXJrZG93blBvc3RQcm9jZXNzb3JDb250ZXh0LFxuICAgICAgc2lnbmFsPzogQWJvcnRTaWduYWxcbiAgICApID0+IFByb21pc2U8dm9pZD5cbiAgPjtcbiAgYWJvcnRDb250cm9sbGVyTWFwOiBNYXA8c3RyaW5nLCBBYm9ydENvbnRyb2xsZXI+O1xuICBwcmV2SW1hZ2U6IHN0cmluZztcbiAgYWJvcnRDb250cm9sbGVyOiBBYm9ydENvbnRyb2xsZXI7XG5cbiAgY29uc3RydWN0b3IocGx1Z2luOiBEMlBsdWdpbikge1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMuZGVib3VuY2VkTWFwID0gbmV3IE1hcCgpO1xuICAgIHRoaXMuYWJvcnRDb250cm9sbGVyTWFwID0gbmV3IE1hcCgpO1xuICB9XG5cbiAgYXR0ZW1wdEV4cG9ydCA9IGFzeW5jIChcbiAgICBzb3VyY2U6IHN0cmluZyxcbiAgICBlbDogSFRNTEVsZW1lbnQsXG4gICAgY3R4OiBNYXJrZG93blBvc3RQcm9jZXNzb3JDb250ZXh0XG4gICkgPT4ge1xuICAgIGVsLmNyZWF0ZUVsKFwiaDZcIiwge1xuICAgICAgdGV4dDogXCJHZW5lcmF0aW5nIEQyIGRpYWdyYW0uLi5cIixcbiAgICAgIGNsczogXCJEMl9fTG9hZGluZ1wiLFxuICAgIH0pO1xuXG4gICAgLy8gd2UgbmVlZCB0byBnZW5lcmF0ZSBhIGRlYm91bmNlIHBlciBzcGxpdCBwYWdlLCBhbmQgY3R4LmNvbnRhaW5lckVsIGlzIHRoZSBvbmx5IGVsZW1lbnQgd2UgaGF2ZSBhY2Nlc3MgdG8gdGhhdCdzIHBhZ2Ugc3BlY2lmaWNcbiAgICAvLyBob3dldmVyLCBpdCBpcyBub3QgcHVibGljYWxseSBhdmFpbGFibGUgaW4gTWFya2Rvd25Qb3N0UHJvY2Vzc29yQ29udGV4dCwgc28gd2UgaGFjayBpdHMgYWNjZXNzIGJ5IGNhc3RpbmcgaXQgdG8gYW4gJ2FueScgdHlwZVxuICAgIGNvbnN0IHBhZ2VDb250YWluZXIgPSAoY3R4IGFzIGFueSkuY29udGFpbmVyRWw7XG4gICAgbGV0IHBhZ2VJRCA9IHBhZ2VDb250YWluZXIuZGF0YXNldC5wYWdlSUQ7XG4gICAgaWYgKCFwYWdlSUQpIHtcbiAgICAgIHBhZ2VJRCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIERhdGUubm93KCkpLnRvU3RyaW5nKCk7XG4gICAgICBwYWdlQ29udGFpbmVyLmRhdGFzZXQucGFnZUlEID0gcGFnZUlEO1xuICAgIH1cblxuICAgIGxldCBkZWJvdW5jZWRGdW5jID0gdGhpcy5kZWJvdW5jZWRNYXAuZ2V0KHBhZ2VJRCk7XG4gICAgaWYgKCFkZWJvdW5jZWRGdW5jKSB7XG4gICAgICAvLyBObyBuZWVkIHRvIGRlYm91bmNlIGluaXRpYWwgcmVuZGVyXG4gICAgICBhd2FpdCB0aGlzLmV4cG9ydChzb3VyY2UsIGVsLCBjdHgpO1xuXG4gICAgICBkZWJvdW5jZWRGdW5jID0gZGVib3VuY2UodGhpcy5leHBvcnQsIHRoaXMucGx1Z2luLnNldHRpbmdzLmRlYm91bmNlLCB7XG4gICAgICAgIGxlYWRpbmc6IHRydWUsXG4gICAgICB9KTtcbiAgICAgIHRoaXMuZGVib3VuY2VkTWFwLnNldChwYWdlSUQsIGRlYm91bmNlZEZ1bmMpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuYWJvcnRDb250cm9sbGVyTWFwLmdldChwYWdlSUQpPy5hYm9ydCgpO1xuICAgIGNvbnN0IG5ld0Fib3J0Q29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtcbiAgICB0aGlzLmFib3J0Q29udHJvbGxlck1hcC5zZXQocGFnZUlELCBuZXdBYm9ydENvbnRyb2xsZXIpO1xuXG4gICAgYXdhaXQgZGVib3VuY2VkRnVuYyhzb3VyY2UsIGVsLCBjdHgsIG5ld0Fib3J0Q29udHJvbGxlci5zaWduYWwpO1xuICB9O1xuXG4gIHNhbml0aXplU1ZHSURzID0gKHN2Z0VsOiBIVE1MRWxlbWVudCwgZG9jSUQ6IHN0cmluZyk6IHN0cmluZyA9PiB7XG4gICAgLy8gYXBwZW5kIGRvY0lkIHRvIDxtYXJrZXI+IHx8IDxtYXNrPiB8fCA8ZmlsdGVyPiBpZCdzIHNvIHRoYXQgdGhleSdyZSB1bmlxdWUgYWNyb3NzIGRpZmZlcmVudCBwYW5lbHMgJiBlZGl0L3ZpZXcgbW9kZVxuICAgIGNvbnN0IG92ZXJyaWRlcyA9IHN2Z0VsLnF1ZXJ5U2VsZWN0b3JBbGwoXCJtYXJrZXIsIG1hc2ssIGZpbHRlclwiKTtcbiAgICBjb25zdCBvdmVycmlkZUlEczogc3RyaW5nW10gPSBbXTtcbiAgICBvdmVycmlkZXMuZm9yRWFjaCgob3ZlcnJpZGUpID0+IHtcbiAgICAgIGNvbnN0IGlkID0gb3ZlcnJpZGUuZ2V0QXR0cmlidXRlKFwiaWRcIik7XG4gICAgICBpZiAoaWQpIHtcbiAgICAgICAgb3ZlcnJpZGVJRHMucHVzaChpZCk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIG92ZXJyaWRlSURzLnJlZHVjZSgoc3ZnSFRNTCwgb3ZlcnJpZGVJRCkgPT4ge1xuICAgICAgcmV0dXJuIHN2Z0hUTUwucmVwbGFjZUFsbChvdmVycmlkZUlELCBbb3ZlcnJpZGVJRCwgZG9jSURdLmpvaW4oXCItXCIpKTtcbiAgICB9LCBzdmdFbC5vdXRlckhUTUwpO1xuICB9O1xuXG4gIGluc2VydEltYWdlKGltYWdlOiBzdHJpbmcsIGVsOiBIVE1MRWxlbWVudCwgY3R4OiBNYXJrZG93blBvc3RQcm9jZXNzb3JDb250ZXh0KSB7XG4gICAgY29uc3QgcGFyc2VyID0gbmV3IERPTVBhcnNlcigpO1xuICAgIGNvbnN0IHN2ZyA9IHBhcnNlci5wYXJzZUZyb21TdHJpbmcoaW1hZ2UsIFwiaW1hZ2Uvc3ZnK3htbFwiKTtcbiAgICBjb25zdCBjb250YWluZXJFbCA9IGVsLmNyZWF0ZURpdigpO1xuXG4gICAgY29udGFpbmVyRWwuc3R5bGUubWF4SGVpZ2h0ID0gYCR7dGhpcy5wbHVnaW4uc2V0dGluZ3MuY29udGFpbmVySGVpZ2h0fXB4YDtcbiAgICBjb250YWluZXJFbC5zdHlsZS5oZWlnaHQgPSBcIjEwMHZoXCI7XG4gICAgY29udGFpbmVyRWwuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcbiAgICBjb250YWluZXJFbC5zdHlsZS5wb3NpdGlvbiA9IFwicmVsYXRpdmVcIjtcblxuICAgIGNvbnN0IHN2Z0VsID0gc3ZnLmRvY3VtZW50RWxlbWVudDtcbiAgICBzdmdFbC5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgICBzdmdFbC5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xuICAgIHN2Z0VsLnN0eWxlLmhlaWdodCA9IFwiMTAwJVwiO1xuXG4gICAgY29udGFpbmVyRWwuaW5uZXJIVE1MID0gdGhpcy5zYW5pdGl6ZVNWR0lEcyhzdmdFbCwgY3R4LmRvY0lkKTtcbiAgfVxuXG4gIGV4cG9ydCA9IGFzeW5jIChcbiAgICBzb3VyY2U6IHN0cmluZyxcbiAgICBlbDogSFRNTEVsZW1lbnQsXG4gICAgY3R4OiBNYXJrZG93blBvc3RQcm9jZXNzb3JDb250ZXh0LFxuICAgIHNpZ25hbD86IEFib3J0U2lnbmFsXG4gICkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBpbWFnZSA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVQcmV2aWV3KHNvdXJjZSwgc2lnbmFsKTtcbiAgICAgIGlmIChpbWFnZSkge1xuICAgICAgICBlbC5lbXB0eSgpO1xuICAgICAgICB0aGlzLnByZXZJbWFnZSA9IGltYWdlO1xuICAgICAgICB0aGlzLmluc2VydEltYWdlKGltYWdlLCBlbCwgY3R4KTtcblxuICAgICAgICBjb25zdCBidXR0b24gPSBuZXcgQnV0dG9uQ29tcG9uZW50KGVsKVxuICAgICAgICAgIC5zZXRDbGFzcyhcIlByZXZpZXdfX1JlY29tcGlsZVwiKVxuICAgICAgICAgIC5zZXRJY29uKFwicmVjb21waWxlXCIpXG4gICAgICAgICAgLm9uQ2xpY2soKGUpID0+IHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBlbC5lbXB0eSgpO1xuICAgICAgICAgICAgdGhpcy5hdHRlbXB0RXhwb3J0KHNvdXJjZSwgZWwsIGN0eCk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgYnV0dG9uLmJ1dHRvbkVsLmNyZWF0ZUVsKFwic3BhblwiLCB7XG4gICAgICAgICAgdGV4dDogXCJSZWNvbXBpbGVcIixcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBlbC5lbXB0eSgpO1xuICAgICAgY29uc3QgZXJyb3JFbCA9IGVsLmNyZWF0ZUVsKFwicHJlXCIsIHtcbiAgICAgICAgY2xzOiBcIm1hcmtkb3duLXJlbmRlcmVkIHByZSBQcmV2aWV3X19FcnJvclwiLFxuICAgICAgfSk7XG4gICAgICBlcnJvckVsLmNyZWF0ZUVsKFwiY29kZVwiLCB7XG4gICAgICAgIHRleHQ6IFwiRDIgQ29tcGlsYXRpb24gRXJyb3I6XCIsXG4gICAgICAgIGNsczogXCJQcmV2aWV3X19FcnJvci0tVGl0bGVcIixcbiAgICAgIH0pO1xuICAgICAgZXJyb3JFbC5jcmVhdGVFbChcImNvZGVcIiwge1xuICAgICAgICB0ZXh0OiBlcnIubWVzc2FnZSxcbiAgICAgIH0pO1xuICAgICAgaWYgKHRoaXMucHJldkltYWdlKSB7XG4gICAgICAgIHRoaXMuaW5zZXJ0SW1hZ2UodGhpcy5wcmV2SW1hZ2UsIGVsLCBjdHgpO1xuICAgICAgfVxuICAgIH0gZmluYWxseSB7XG4gICAgICBjb25zdCBwYWdlQ29udGFpbmVyID0gKGN0eCBhcyBhbnkpLmNvbnRhaW5lckVsO1xuICAgICAgdGhpcy5hYm9ydENvbnRyb2xsZXJNYXAuZGVsZXRlKHBhZ2VDb250YWluZXIuZGF0YXNldC5pZCk7XG4gICAgfVxuICB9O1xuXG4gIGFzeW5jIGdlbmVyYXRlUHJldmlldyhzb3VyY2U6IHN0cmluZywgc2lnbmFsPzogQWJvcnRTaWduYWwpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IHBhdGhBcnJheSA9IFtwcm9jZXNzLmVudi5QQVRILCBcIi9vcHQvaG9tZWJyZXcvYmluXCIsIFwiL3Vzci9sb2NhbC9iaW5cIl07XG5cbiAgICAvLyBwbGF0Zm9ybSB3aWxsIGJlIHdpbjMyIGV2ZW4gb24gNjQgYml0IHdpbmRvd3NcbiAgICBpZiAob3MucGxhdGZvcm0oKSA9PT0gXCJ3aW4zMlwiKSB7XG4gICAgICBwYXRoQXJyYXkucHVzaChgQzpcXFByb2dyYW0gRmlsZXNcXEQyYCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBhdGhBcnJheS5wdXNoKGAke3Byb2Nlc3MuZW52LkhPTUV9Ly5sb2NhbC9iaW5gKTtcbiAgICB9XG5cbiAgICBsZXQgR09QQVRIID0gXCJcIjtcbiAgICB0cnkge1xuICAgICAgR09QQVRIID0gZXhlY1N5bmMoXCJnbyBlbnYgR09QQVRIXCIsIHtcbiAgICAgICAgZW52OiB7XG4gICAgICAgICAgLi4ucHJvY2Vzcy5lbnYsXG4gICAgICAgICAgUEFUSDogcGF0aEFycmF5LmpvaW4oZGVsaW1pdGVyKSxcbiAgICAgICAgfSxcbiAgICAgIH0pLnRvU3RyaW5nKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIC8vIGlnbm9yZSBpZiBnbyBpcyBub3QgaW5zdGFsbGVkXG4gICAgfVxuXG4gICAgaWYgKEdPUEFUSCkge1xuICAgICAgcGF0aEFycmF5LnB1c2goYCR7R09QQVRILnJlcGxhY2UoXCJcXG5cIiwgXCJcIil9L2JpbmApO1xuICAgIH1cbiAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MuZDJQYXRoKSB7XG4gICAgICBwYXRoQXJyYXkucHVzaCh0aGlzLnBsdWdpbi5zZXR0aW5ncy5kMlBhdGgpO1xuICAgIH1cblxuICAgIGNvbnN0IG9wdGlvbnM6IGFueSA9IHtcbiAgICAgIC4uLnByb2Nlc3MuZW52LFxuICAgICAgZW52OiB7XG4gICAgICAgIFBBVEg6IHBhdGhBcnJheS5qb2luKGRlbGltaXRlciksXG4gICAgICB9LFxuICAgICAgc2lnbmFsLFxuICAgIH07XG4gICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLmFwaVRva2VuKSB7XG4gICAgICBvcHRpb25zLmVudi5UU1RSVUNUX1RPS0VOID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuYXBpVG9rZW47XG4gICAgfVxuXG4gICAgbGV0IGFyZ3MgPSBbXG4gICAgICBgZDJgLFxuICAgICAgXCItXCIsXG4gICAgICBgLS10aGVtZT0ke3RoaXMucGx1Z2luLnNldHRpbmdzLnRoZW1lfWAsXG4gICAgICBgLS1sYXlvdXQ9JHt0aGlzLnBsdWdpbi5zZXR0aW5ncy5sYXlvdXRFbmdpbmV9YCxcbiAgICAgIGAtLXBhZD0ke3RoaXMucGx1Z2luLnNldHRpbmdzLnBhZH1gLFxuICAgICAgYC0tc2tldGNoPSR7dGhpcy5wbHVnaW4uc2V0dGluZ3Muc2tldGNofWAsXG4gICAgICBcIi0tYnVuZGxlPWZhbHNlXCIsXG4gICAgXTtcbiAgICBjb25zdCBjbWQgPSBhcmdzLmpvaW4oXCIgXCIpO1xuICAgIGNvbnN0IGNoaWxkID0gZXhlYyhjbWQsIG9wdGlvbnMpO1xuICAgIGNoaWxkLnN0ZGluPy53cml0ZShzb3VyY2UpO1xuICAgIGNoaWxkLnN0ZGluPy5lbmQoKTtcblxuICAgIGxldCBzdGRvdXQ6IGFueTtcbiAgICBsZXQgc3RkZXJyOiBhbnk7XG5cbiAgICBpZiAoY2hpbGQuc3Rkb3V0KSB7XG4gICAgICBjaGlsZC5zdGRvdXQub24oXCJkYXRhXCIsIChkYXRhKSA9PiB7XG4gICAgICAgIGlmIChzdGRvdXQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHN0ZG91dCA9IGRhdGE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc3Rkb3V0ICs9IGRhdGE7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChjaGlsZC5zdGRlcnIpIHtcbiAgICAgIGNoaWxkLnN0ZGVyci5vbihcImRhdGFcIiwgKGRhdGEpID0+IHtcbiAgICAgICAgaWYgKHN0ZGVyciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgc3RkZXJyID0gZGF0YTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzdGRlcnIgKz0gZGF0YTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGNoaWxkLm9uKFwiZXJyb3JcIiwgcmVqZWN0KTtcbiAgICAgIGNoaWxkLm9uKFwiY2xvc2VcIiwgKGNvZGU6IG51bWJlcikgPT4ge1xuICAgICAgICBpZiAoY29kZSA9PT0gMCkge1xuICAgICAgICAgIHJlc29sdmUoc3Rkb3V0KTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSBpZiAoc3RkZXJyKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihzdGRlcnIpO1xuICAgICAgICAgIHJlamVjdChuZXcgRXJyb3Ioc3RkZXJyKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoc3Rkb3V0KSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihzdGRvdXQpO1xuICAgICAgICAgIHJlamVjdChuZXcgRXJyb3Ioc3Rkb3V0KSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG59XG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFVQSxRQUFJLGtCQUFrQjtBQUd0QixRQUFJLE1BQU0sSUFBSTtBQUdkLFFBQUksWUFBWTtBQUdoQixRQUFJLFNBQVM7QUFHYixRQUFJLGFBQWE7QUFHakIsUUFBSSxhQUFhO0FBR2pCLFFBQUksWUFBWTtBQUdoQixRQUFJLGVBQWU7QUFHbkIsUUFBSSxhQUFhLE9BQU8sVUFBVSxZQUFZLFVBQVUsT0FBTyxXQUFXLFVBQVU7QUFHcEYsUUFBSSxXQUFXLE9BQU8sUUFBUSxZQUFZLFFBQVEsS0FBSyxXQUFXLFVBQVU7QUFHNUUsUUFBSSxPQUFPLGNBQWMsWUFBWSxTQUFTLGFBQWEsRUFBRTtBQUc3RCxRQUFJLGNBQWMsT0FBTztBQU96QixRQUFJLGlCQUFpQixZQUFZO0FBR2pDLFFBQUksWUFBWSxLQUFLO0FBQXJCLFFBQ0ksWUFBWSxLQUFLO0FBa0JyQixRQUFJLE1BQU0sV0FBVztBQUNuQixhQUFPLEtBQUssS0FBSyxJQUFJO0FBQUEsSUFDdkI7QUF3REEsdUJBQWtCLE1BQU0sTUFBTSxTQUFTO0FBQ3JDLFVBQUksVUFDQSxVQUNBLFNBQ0EsUUFDQSxTQUNBLGNBQ0EsaUJBQWlCLEdBQ2pCLFVBQVUsT0FDVixTQUFTLE9BQ1QsV0FBVztBQUVmLFVBQUksT0FBTyxRQUFRLFlBQVk7QUFDN0IsY0FBTSxJQUFJLFVBQVUsZUFBZTtBQUFBLE1BQ3JDO0FBQ0EsYUFBTyxTQUFTLElBQUksS0FBSztBQUN6QixVQUFJLFNBQVMsT0FBTyxHQUFHO0FBQ3JCLGtCQUFVLENBQUMsQ0FBQyxRQUFRO0FBQ3BCLGlCQUFTLGFBQWE7QUFDdEIsa0JBQVUsU0FBUyxVQUFVLFNBQVMsUUFBUSxPQUFPLEtBQUssR0FBRyxJQUFJLElBQUk7QUFDckUsbUJBQVcsY0FBYyxVQUFVLENBQUMsQ0FBQyxRQUFRLFdBQVc7QUFBQSxNQUMxRDtBQUVBLDBCQUFvQixNQUFNO0FBQ3hCLFlBQUksT0FBTyxVQUNQLFVBQVU7QUFFZCxtQkFBVyxXQUFXO0FBQ3RCLHlCQUFpQjtBQUNqQixpQkFBUyxLQUFLLE1BQU0sU0FBUyxJQUFJO0FBQ2pDLGVBQU87QUFBQSxNQUNUO0FBRUEsMkJBQXFCLE1BQU07QUFFekIseUJBQWlCO0FBRWpCLGtCQUFVLFdBQVcsY0FBYyxJQUFJO0FBRXZDLGVBQU8sVUFBVSxXQUFXLElBQUksSUFBSTtBQUFBLE1BQ3RDO0FBRUEsNkJBQXVCLE1BQU07QUFDM0IsWUFBSSxvQkFBb0IsT0FBTyxjQUMzQixzQkFBc0IsT0FBTyxnQkFDN0IsVUFBUyxPQUFPO0FBRXBCLGVBQU8sU0FBUyxVQUFVLFNBQVEsVUFBVSxtQkFBbUIsSUFBSTtBQUFBLE1BQ3JFO0FBRUEsNEJBQXNCLE1BQU07QUFDMUIsWUFBSSxvQkFBb0IsT0FBTyxjQUMzQixzQkFBc0IsT0FBTztBQUtqQyxlQUFRLGlCQUFpQixVQUFjLHFCQUFxQixRQUN6RCxvQkFBb0IsS0FBTyxVQUFVLHVCQUF1QjtBQUFBLE1BQ2pFO0FBRUEsOEJBQXdCO0FBQ3RCLFlBQUksT0FBTyxJQUFJO0FBQ2YsWUFBSSxhQUFhLElBQUksR0FBRztBQUN0QixpQkFBTyxhQUFhLElBQUk7QUFBQSxRQUMxQjtBQUVBLGtCQUFVLFdBQVcsY0FBYyxjQUFjLElBQUksQ0FBQztBQUFBLE1BQ3hEO0FBRUEsNEJBQXNCLE1BQU07QUFDMUIsa0JBQVU7QUFJVixZQUFJLFlBQVksVUFBVTtBQUN4QixpQkFBTyxXQUFXLElBQUk7QUFBQSxRQUN4QjtBQUNBLG1CQUFXLFdBQVc7QUFDdEIsZUFBTztBQUFBLE1BQ1Q7QUFFQSx3QkFBa0I7QUFDaEIsWUFBSSxZQUFZLFFBQVc7QUFDekIsdUJBQWEsT0FBTztBQUFBLFFBQ3RCO0FBQ0EseUJBQWlCO0FBQ2pCLG1CQUFXLGVBQWUsV0FBVyxVQUFVO0FBQUEsTUFDakQ7QUFFQSx1QkFBaUI7QUFDZixlQUFPLFlBQVksU0FBWSxTQUFTLGFBQWEsSUFBSSxDQUFDO0FBQUEsTUFDNUQ7QUFFQSwyQkFBcUI7QUFDbkIsWUFBSSxPQUFPLElBQUksR0FDWCxhQUFhLGFBQWEsSUFBSTtBQUVsQyxtQkFBVztBQUNYLG1CQUFXO0FBQ1gsdUJBQWU7QUFFZixZQUFJLFlBQVk7QUFDZCxjQUFJLFlBQVksUUFBVztBQUN6QixtQkFBTyxZQUFZLFlBQVk7QUFBQSxVQUNqQztBQUNBLGNBQUksUUFBUTtBQUVWLHNCQUFVLFdBQVcsY0FBYyxJQUFJO0FBQ3ZDLG1CQUFPLFdBQVcsWUFBWTtBQUFBLFVBQ2hDO0FBQUEsUUFDRjtBQUNBLFlBQUksWUFBWSxRQUFXO0FBQ3pCLG9CQUFVLFdBQVcsY0FBYyxJQUFJO0FBQUEsUUFDekM7QUFDQSxlQUFPO0FBQUEsTUFDVDtBQUNBLGdCQUFVLFNBQVM7QUFDbkIsZ0JBQVUsUUFBUTtBQUNsQixhQUFPO0FBQUEsSUFDVDtBQTJCQSxzQkFBa0IsT0FBTztBQUN2QixVQUFJLE9BQU8sT0FBTztBQUNsQixhQUFPLENBQUMsQ0FBQyxTQUFVLFNBQVEsWUFBWSxRQUFRO0FBQUEsSUFDakQ7QUEwQkEsMEJBQXNCLE9BQU87QUFDM0IsYUFBTyxDQUFDLENBQUMsU0FBUyxPQUFPLFNBQVM7QUFBQSxJQUNwQztBQW1CQSxzQkFBa0IsT0FBTztBQUN2QixhQUFPLE9BQU8sU0FBUyxZQUNwQixhQUFhLEtBQUssS0FBSyxlQUFlLEtBQUssS0FBSyxLQUFLO0FBQUEsSUFDMUQ7QUF5QkEsc0JBQWtCLE9BQU87QUFDdkIsVUFBSSxPQUFPLFNBQVMsVUFBVTtBQUM1QixlQUFPO0FBQUEsTUFDVDtBQUNBLFVBQUksU0FBUyxLQUFLLEdBQUc7QUFDbkIsZUFBTztBQUFBLE1BQ1Q7QUFDQSxVQUFJLFNBQVMsS0FBSyxHQUFHO0FBQ25CLFlBQUksUUFBUSxPQUFPLE1BQU0sV0FBVyxhQUFhLE1BQU0sUUFBUSxJQUFJO0FBQ25FLGdCQUFRLFNBQVMsS0FBSyxJQUFLLFFBQVEsS0FBTTtBQUFBLE1BQzNDO0FBQ0EsVUFBSSxPQUFPLFNBQVMsVUFBVTtBQUM1QixlQUFPLFVBQVUsSUFBSSxRQUFRLENBQUM7QUFBQSxNQUNoQztBQUNBLGNBQVEsTUFBTSxRQUFRLFFBQVEsRUFBRTtBQUNoQyxVQUFJLFdBQVcsV0FBVyxLQUFLLEtBQUs7QUFDcEMsYUFBUSxZQUFZLFVBQVUsS0FBSyxLQUFLLElBQ3BDLGFBQWEsTUFBTSxNQUFNLENBQUMsR0FBRyxXQUFXLElBQUksQ0FBQyxJQUM1QyxXQUFXLEtBQUssS0FBSyxJQUFJLE1BQU0sQ0FBQztBQUFBLElBQ3ZDO0FBRUEsWUFBTyxVQUFVO0FBQUE7QUFBQTs7O0FDeFhqQjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsdUJBQWdDOzs7QUNBaEMsc0JBQXVEOzs7QUNBdkQsSUFBTSxpQkFBaUI7QUFBQSxFQUNyQixPQUFPO0FBQUEsSUFDTCxPQUFPO0FBQUEsSUFDUCxPQUFPO0FBQUEsRUFDVDtBQUFBLEVBQ0EsS0FBSztBQUFBLElBQ0gsT0FBTztBQUFBLElBQ1AsT0FBTztBQUFBLEVBQ1Q7QUFBQSxFQUNBLE1BQU07QUFBQSxJQUNKLE9BQU87QUFBQSxJQUNQLE9BQU87QUFBQSxFQUNUO0FBQ0Y7QUFFQSxJQUFNLGdCQUFnQjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTs7O0FEQ2YsSUFBTSxtQkFBcUM7QUFBQSxFQUNoRCxjQUFjO0FBQUEsRUFDZCxVQUFVO0FBQUEsRUFDVixPQUFPO0FBQUEsRUFDUCxVQUFVO0FBQUEsRUFDVixRQUFRO0FBQUEsRUFDUixLQUFLO0FBQUEsRUFDTCxRQUFRO0FBQUEsRUFDUixpQkFBaUI7QUFDbkI7QUFFTyxJQUFNLGdCQUFOLGNBQTRCLGlDQUFpQjtBQUFBLEVBSWxELFlBQVksS0FBVSxRQUFrQjtBQUN0QyxVQUFNLEtBQUssTUFBTTtBQUNqQixTQUFLLFNBQVM7QUFBQSxFQUNoQjtBQUFBLEVBRUEsa0JBQWtCO0FBQ2hCLFVBQU0sZUFBZSxLQUFLLFlBQVksU0FBUyxLQUFLO0FBQ3BELGlCQUFhLFNBQVMsTUFBTTtBQUFBLE1BQzFCLE1BQU07QUFBQSxJQUNSLENBQUM7QUFDRCxRQUFJLHdCQUFRLFlBQVksRUFDckIsUUFBUSxXQUFXLEVBQ25CLFFBQ0MsMEdBQ0YsRUFDQyxRQUFRLENBQUMsU0FDUixLQUNHLGVBQWUsYUFBYSxFQUM1QixTQUFTLEtBQUssT0FBTyxTQUFTLFFBQVEsRUFDdEMsWUFBWSxLQUFLLE9BQU8sU0FBUyxpQkFBaUIsZUFBZSxLQUFLLEtBQUssRUFDM0UsU0FBUyxPQUFPLFVBQVU7QUFDekIsVUFBSSxTQUFTLENBQUMsTUFBTSxXQUFXLFVBQVUsR0FBRztBQUMxQyxZQUFJLHVCQUFPLG1CQUFtQjtBQUFBLE1BQ2hDLE9BQU87QUFDTCxhQUFLLE9BQU8sU0FBUyxXQUFXO0FBQ2hDLGNBQU0sS0FBSyxPQUFPLGFBQWE7QUFBQSxNQUNqQztBQUFBLElBQ0YsQ0FBQyxDQUNMO0FBRUYsU0FBSyxlQUFlO0FBQUEsRUFDdEI7QUFBQSxFQUVBLFVBQWdCO0FBQ2QsVUFBTSxFQUFFLGdCQUFnQjtBQUN4QixnQkFBWSxNQUFNO0FBQ2xCLGdCQUFZLFNBQVMsTUFBTSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFekQsUUFBSSx3QkFBUSxXQUFXLEVBQ3BCLFFBQVEsZUFBZSxFQUN2QixRQUNDLHlHQUNGLEVBQ0MsWUFBWSxDQUFDLGFBQWE7QUFDekIsZUFDRyxVQUFVLGVBQWUsTUFBTSxPQUFPLGVBQWUsTUFBTSxLQUFLLEVBQ2hFLFVBQVUsZUFBZSxJQUFJLE9BQU8sZUFBZSxJQUFJLEtBQUssRUFDNUQsVUFBVSxlQUFlLEtBQUssT0FBTyxlQUFlLEtBQUssS0FBSyxFQUM5RCxTQUFTLEtBQUssT0FBTyxTQUFTLFlBQVksRUFDMUMsU0FBUyxPQUFPLFVBQVU7QUFoRnJDO0FBaUZZLGFBQUssT0FBTyxTQUFTLGVBQWU7QUFDcEMsY0FBTSxLQUFLLE9BQU8sYUFBYTtBQUMvQixZQUFJLFVBQVUsZUFBZSxLQUFLLE9BQU87QUFDdkMsZUFBSyxnQkFBZ0I7QUFBQSxRQUN2QixPQUFPO0FBQ0wscUJBQUssaUJBQUwsbUJBQW1CO0FBQUEsUUFDckI7QUFBQSxNQUNGLENBQUM7QUFBQSxJQUNMLENBQUM7QUFFSCxRQUFJLHdCQUFRLFdBQVcsRUFDcEIsUUFBUSxVQUFVLEVBQ2xCLFFBQ0Msd0ZBQ0YsRUFDQyxRQUFRLENBQUMsU0FDUixLQUNHLGVBQWUsa0JBQWtCLEVBQ2pDLFNBQVMsT0FBTyxLQUFLLE9BQU8sU0FBUyxLQUFLLENBQUMsRUFDM0MsU0FBUyxPQUFPLFVBQVU7QUFDekIsVUFBSSxDQUFDLE1BQU0sT0FBTyxLQUFLLENBQUMsS0FBSyxVQUFVLElBQUk7QUFDekMsYUFBSyxPQUFPLFNBQVMsUUFBUSxPQUFPLFNBQVMsaUJBQWlCLEtBQUs7QUFDbkUsY0FBTSxLQUFLLE9BQU8sYUFBYTtBQUFBLE1BQ2pDLE9BQU87QUFDTCxZQUFJLHVCQUFPLCtCQUErQjtBQUFBLE1BQzVDO0FBQUEsSUFDRixDQUFDLENBQ0w7QUFFRixRQUFJLHdCQUFRLFdBQVcsRUFDcEIsUUFBUSxLQUFLLEVBQ2IsUUFBUSwyQ0FBMkMsRUFDbkQsUUFBUSxDQUFDLFNBQ1IsS0FDRyxlQUFlLE9BQU8saUJBQWlCLEdBQUcsQ0FBQyxFQUMzQyxTQUFTLE9BQU8sS0FBSyxPQUFPLFNBQVMsR0FBRyxDQUFDLEVBQ3pDLFNBQVMsT0FBTyxVQUFVO0FBQ3pCLFVBQUksTUFBTSxPQUFPLEtBQUssQ0FBQyxHQUFHO0FBQ3hCLFlBQUksdUJBQU8sK0JBQStCO0FBQzFDLGFBQUssT0FBTyxTQUFTLE1BQU0sT0FBTyxpQkFBaUIsR0FBRztBQUFBLE1BQ3hELFdBQVcsVUFBVSxJQUFJO0FBQ3ZCLGFBQUssT0FBTyxTQUFTLE1BQU0sT0FBTyxpQkFBaUIsR0FBRztBQUFBLE1BQ3hELE9BQU87QUFDTCxhQUFLLE9BQU8sU0FBUyxNQUFNLE9BQU8sS0FBSztBQUFBLE1BQ3pDO0FBQ0EsWUFBTSxLQUFLLE9BQU8sYUFBYTtBQUFBLElBQ2pDLENBQUMsQ0FDTDtBQUVGLFFBQUksd0JBQVEsV0FBVyxFQUNwQixRQUFRLGFBQWEsRUFDckIsUUFBUSx5REFBeUQsRUFDakUsVUFBVSxDQUFDLFdBQ1YsT0FBTyxTQUFTLEtBQUssT0FBTyxTQUFTLE1BQU0sRUFBRSxTQUFTLE9BQU8sVUFBVTtBQUNyRSxXQUFLLE9BQU8sU0FBUyxTQUFTO0FBQzlCLFlBQU0sS0FBSyxPQUFPLGFBQWE7QUFBQSxJQUNqQyxDQUFDLENBQ0g7QUFFRixRQUFJLHdCQUFRLFdBQVcsRUFDcEIsUUFBUSxrQkFBa0IsRUFDMUIsUUFBUSxpRUFBaUUsRUFDekUsUUFBUSxDQUFDLFNBQ1IsS0FDRyxlQUFlLE9BQU8saUJBQWlCLGVBQWUsQ0FBQyxFQUN2RCxTQUFTLE9BQU8sS0FBSyxPQUFPLFNBQVMsZUFBZSxDQUFDLEVBQ3JELFNBQVMsT0FBTyxVQUFVO0FBQ3pCLFVBQUksTUFBTSxPQUFPLEtBQUssQ0FBQyxHQUFHO0FBQ3hCLFlBQUksdUJBQU8sK0JBQStCO0FBQzFDLGFBQUssT0FBTyxTQUFTLGtCQUFrQixPQUNyQyxpQkFBaUIsZUFDbkI7QUFBQSxNQUNGLFdBQVcsVUFBVSxJQUFJO0FBQ3ZCLGFBQUssT0FBTyxTQUFTLGtCQUFrQixPQUNyQyxpQkFBaUIsZUFDbkI7QUFBQSxNQUNGLE9BQU87QUFDTCxhQUFLLE9BQU8sU0FBUyxrQkFBa0IsT0FBTyxLQUFLO0FBQUEsTUFDckQ7QUFDQSxZQUFNLEtBQUssT0FBTyxhQUFhO0FBQUEsSUFDakMsQ0FBQyxDQUNMO0FBRUYsUUFBSSx3QkFBUSxXQUFXLEVBQ3BCLFFBQVEsVUFBVSxFQUNsQixRQUFRLGdFQUFnRSxFQUN4RSxRQUFRLENBQUMsU0FDUixLQUNHLGVBQWUsT0FBTyxpQkFBaUIsUUFBUSxDQUFDLEVBQ2hELFNBQVMsT0FBTyxLQUFLLE9BQU8sU0FBUyxRQUFRLENBQUMsRUFDOUMsU0FBUyxPQUFPLFVBQVU7QUFDekIsVUFBSSxNQUFNLE9BQU8sS0FBSyxDQUFDLEdBQUc7QUFDeEIsWUFBSSx1QkFBTywrQkFBK0I7QUFDMUMsYUFBSyxPQUFPLFNBQVMsV0FBVyxPQUFPLGlCQUFpQixRQUFRO0FBQUEsTUFDbEUsV0FBVyxVQUFVLElBQUk7QUFDdkIsYUFBSyxPQUFPLFNBQVMsV0FBVyxPQUFPLGlCQUFpQixRQUFRO0FBQUEsTUFDbEUsV0FBVyxPQUFPLEtBQUssSUFBSSxLQUFLO0FBQzlCLFlBQUksdUJBQU8sb0NBQW9DO0FBQy9DLGFBQUssT0FBTyxTQUFTLFdBQVcsT0FBTyxpQkFBaUIsUUFBUTtBQUFBLE1BQ2xFLE9BQU87QUFDTCxhQUFLLE9BQU8sU0FBUyxXQUFXLE9BQU8sS0FBSztBQUFBLE1BQzlDO0FBQ0EsWUFBTSxLQUFLLE9BQU8sYUFBYTtBQUFBLElBQ2pDLENBQUMsQ0FDTDtBQUVGLFFBQUksd0JBQVEsV0FBVyxFQUNwQixRQUFRLGlCQUFpQixFQUN6QixRQUNDLDhPQUNGLEVBQ0MsUUFBUSxDQUFDLFNBQVM7QUFDakIsV0FDRyxlQUFlLG1CQUFtQixFQUNsQyxTQUFTLEtBQUssT0FBTyxTQUFTLE1BQU0sRUFDcEMsU0FBUyxPQUFPLFVBQVU7QUFDekIsYUFBSyxPQUFPLFNBQVMsU0FBUztBQUM5QixjQUFNLEtBQUssT0FBTyxhQUFhO0FBQUEsTUFDakMsQ0FBQztBQUFBLElBQ0wsQ0FBQztBQUVILFFBQUksS0FBSyxPQUFPLFNBQVMsaUJBQWlCLGVBQWUsS0FBSyxPQUFPO0FBQ25FLFdBQUssZ0JBQWdCO0FBQUEsSUFDdkI7QUFBQSxFQUNGO0FBQ0Y7OztBRTlNQSx1QkFBOEQ7QUFDOUQsMkJBQStCO0FBQy9CLGtCQUEwQjtBQUMxQixvQkFBcUI7QUFDckIsZ0JBQWU7QUFJUixJQUFNLGNBQU4sTUFBa0I7QUFBQSxFQWV2QixZQUFZLFFBQWtCO0FBTTlCLHlCQUFnQixPQUNkLFFBQ0EsSUFDQSxRQUNHO0FBakNQO0FBa0NJLFNBQUcsU0FBUyxNQUFNO0FBQUEsUUFDaEIsTUFBTTtBQUFBLFFBQ04sS0FBSztBQUFBLE1BQ1AsQ0FBQztBQUlELFlBQU0sZ0JBQWlCLElBQVk7QUFDbkMsVUFBSSxTQUFTLGNBQWMsUUFBUTtBQUNuQyxVQUFJLENBQUMsUUFBUTtBQUNYLGlCQUFTLEtBQUssTUFBTSxLQUFLLE9BQU8sSUFBSSxLQUFLLElBQUksQ0FBQyxFQUFFLFNBQVM7QUFDekQsc0JBQWMsUUFBUSxTQUFTO0FBQUEsTUFDakM7QUFFQSxVQUFJLGdCQUFnQixLQUFLLGFBQWEsSUFBSSxNQUFNO0FBQ2hELFVBQUksQ0FBQyxlQUFlO0FBRWxCLGNBQU0sS0FBSyxPQUFPLFFBQVEsSUFBSSxHQUFHO0FBRWpDLHdCQUFnQiwyQkFBUyxLQUFLLFFBQVEsS0FBSyxPQUFPLFNBQVMsVUFBVTtBQUFBLFVBQ25FLFNBQVM7QUFBQSxRQUNYLENBQUM7QUFDRCxhQUFLLGFBQWEsSUFBSSxRQUFRLGFBQWE7QUFDM0M7QUFBQSxNQUNGO0FBRUEsaUJBQUssbUJBQW1CLElBQUksTUFBTSxNQUFsQyxtQkFBcUM7QUFDckMsWUFBTSxxQkFBcUIsSUFBSSxnQkFBZ0I7QUFDL0MsV0FBSyxtQkFBbUIsSUFBSSxRQUFRLGtCQUFrQjtBQUV0RCxZQUFNLGNBQWMsUUFBUSxJQUFJLEtBQUssbUJBQW1CLE1BQU07QUFBQSxJQUNoRTtBQUVBLDBCQUFpQixDQUFDLE9BQW9CLFVBQTBCO0FBRTlELFlBQU0sWUFBWSxNQUFNLGlCQUFpQixzQkFBc0I7QUFDL0QsWUFBTSxjQUF3QixDQUFDO0FBQy9CLGdCQUFVLFFBQVEsQ0FBQyxhQUFhO0FBQzlCLGNBQU0sS0FBSyxTQUFTLGFBQWEsSUFBSTtBQUNyQyxZQUFJLElBQUk7QUFDTixzQkFBWSxLQUFLLEVBQUU7QUFBQSxRQUNyQjtBQUFBLE1BQ0YsQ0FBQztBQUNELGFBQU8sWUFBWSxPQUFPLENBQUMsU0FBUyxlQUFlO0FBQ2pELGVBQU8sUUFBUSxXQUFXLFlBQVksQ0FBQyxZQUFZLEtBQUssRUFBRSxLQUFLLEdBQUcsQ0FBQztBQUFBLE1BQ3JFLEdBQUcsTUFBTSxTQUFTO0FBQUEsSUFDcEI7QUFvQkEsa0JBQVMsT0FDUCxRQUNBLElBQ0EsS0FDQSxXQUNHO0FBQ0gsVUFBSTtBQUNGLGNBQU0sUUFBUSxNQUFNLEtBQUssZ0JBQWdCLFFBQVEsTUFBTTtBQUN2RCxZQUFJLE9BQU87QUFDVCxhQUFHLE1BQU07QUFDVCxlQUFLLFlBQVk7QUFDakIsZUFBSyxZQUFZLE9BQU8sSUFBSSxHQUFHO0FBRS9CLGdCQUFNLFNBQVMsSUFBSSxpQ0FBZ0IsRUFBRSxFQUNsQyxTQUFTLG9CQUFvQixFQUM3QixRQUFRLFdBQVcsRUFDbkIsUUFBUSxDQUFDLE1BQU07QUFDZCxjQUFFLGVBQWU7QUFDakIsY0FBRSxnQkFBZ0I7QUFDbEIsZUFBRyxNQUFNO0FBQ1QsaUJBQUssY0FBYyxRQUFRLElBQUksR0FBRztBQUFBLFVBQ3BDLENBQUM7QUFFSCxpQkFBTyxTQUFTLFNBQVMsUUFBUTtBQUFBLFlBQy9CLE1BQU07QUFBQSxVQUNSLENBQUM7QUFBQSxRQUNIO0FBQUEsTUFDRixTQUFTLEtBQVA7QUFDQSxXQUFHLE1BQU07QUFDVCxjQUFNLFVBQVUsR0FBRyxTQUFTLE9BQU87QUFBQSxVQUNqQyxLQUFLO0FBQUEsUUFDUCxDQUFDO0FBQ0QsZ0JBQVEsU0FBUyxRQUFRO0FBQUEsVUFDdkIsTUFBTTtBQUFBLFVBQ04sS0FBSztBQUFBLFFBQ1AsQ0FBQztBQUNELGdCQUFRLFNBQVMsUUFBUTtBQUFBLFVBQ3ZCLE1BQU0sSUFBSTtBQUFBLFFBQ1osQ0FBQztBQUNELFlBQUksS0FBSyxXQUFXO0FBQ2xCLGVBQUssWUFBWSxLQUFLLFdBQVcsSUFBSSxHQUFHO0FBQUEsUUFDMUM7QUFBQSxNQUNGLFVBQUU7QUFDQSxjQUFNLGdCQUFpQixJQUFZO0FBQ25DLGFBQUssbUJBQW1CLE9BQU8sY0FBYyxRQUFRLEVBQUU7QUFBQSxNQUN6RDtBQUFBLElBQ0Y7QUExSEUsU0FBSyxTQUFTO0FBQ2QsU0FBSyxlQUFlLG9CQUFJLElBQUk7QUFDNUIsU0FBSyxxQkFBcUIsb0JBQUksSUFBSTtBQUFBLEVBQ3BDO0FBQUEsRUF1REEsWUFBWSxPQUFlLElBQWlCLEtBQW1DO0FBQzdFLFVBQU0sU0FBUyxJQUFJLFVBQVU7QUFDN0IsVUFBTSxNQUFNLE9BQU8sZ0JBQWdCLE9BQU8sZUFBZTtBQUN6RCxVQUFNLGNBQWMsR0FBRyxVQUFVO0FBRWpDLGdCQUFZLE1BQU0sWUFBWSxHQUFHLEtBQUssT0FBTyxTQUFTO0FBQ3RELGdCQUFZLE1BQU0sU0FBUztBQUMzQixnQkFBWSxNQUFNLFFBQVE7QUFDMUIsZ0JBQVksTUFBTSxXQUFXO0FBRTdCLFVBQU0sUUFBUSxJQUFJO0FBQ2xCLFVBQU0sTUFBTSxXQUFXO0FBQ3ZCLFVBQU0sTUFBTSxRQUFRO0FBQ3BCLFVBQU0sTUFBTSxTQUFTO0FBRXJCLGdCQUFZLFlBQVksS0FBSyxlQUFlLE9BQU8sSUFBSSxLQUFLO0FBQUEsRUFDOUQ7QUFBQSxFQWtEQSxNQUFNLGdCQUFnQixRQUFnQixRQUF1QztBQXBKL0U7QUFxSkksVUFBTSxZQUFZLENBQUMsUUFBUSxJQUFJLE1BQU0scUJBQXFCLGdCQUFnQjtBQUcxRSxRQUFJLGtCQUFHLFNBQVMsTUFBTSxTQUFTO0FBQzdCLGdCQUFVLEtBQUssbUJBQXFCO0FBQUEsSUFDdEMsT0FBTztBQUNMLGdCQUFVLEtBQUssR0FBRyxRQUFRLElBQUksaUJBQWlCO0FBQUEsSUFDakQ7QUFFQSxRQUFJLFNBQVM7QUFDYixRQUFJO0FBQ0YsZUFBUyxtQ0FBUyxpQkFBaUI7QUFBQSxRQUNqQyxLQUFLO0FBQUEsVUFDSCxHQUFHLFFBQVE7QUFBQSxVQUNYLE1BQU0sVUFBVSxLQUFLLHFCQUFTO0FBQUEsUUFDaEM7QUFBQSxNQUNGLENBQUMsRUFBRSxTQUFTO0FBQUEsSUFDZCxTQUFTLE9BQVA7QUFBQSxJQUVGO0FBRUEsUUFBSSxRQUFRO0FBQ1YsZ0JBQVUsS0FBSyxHQUFHLE9BQU8sUUFBUSxNQUFNLEVBQUUsT0FBTztBQUFBLElBQ2xEO0FBQ0EsUUFBSSxLQUFLLE9BQU8sU0FBUyxRQUFRO0FBQy9CLGdCQUFVLEtBQUssS0FBSyxPQUFPLFNBQVMsTUFBTTtBQUFBLElBQzVDO0FBRUEsVUFBTSxVQUFlO0FBQUEsTUFDbkIsR0FBRyxRQUFRO0FBQUEsTUFDWCxLQUFLO0FBQUEsUUFDSCxNQUFNLFVBQVUsS0FBSyxxQkFBUztBQUFBLE1BQ2hDO0FBQUEsTUFDQTtBQUFBLElBQ0Y7QUFDQSxRQUFJLEtBQUssT0FBTyxTQUFTLFVBQVU7QUFDakMsY0FBUSxJQUFJLGdCQUFnQixLQUFLLE9BQU8sU0FBUztBQUFBLElBQ25EO0FBRUEsUUFBSSxPQUFPO0FBQUEsTUFDVDtBQUFBLE1BQ0E7QUFBQSxNQUNBLFdBQVcsS0FBSyxPQUFPLFNBQVM7QUFBQSxNQUNoQyxZQUFZLEtBQUssT0FBTyxTQUFTO0FBQUEsTUFDakMsU0FBUyxLQUFLLE9BQU8sU0FBUztBQUFBLE1BQzlCLFlBQVksS0FBSyxPQUFPLFNBQVM7QUFBQSxNQUNqQztBQUFBLElBQ0Y7QUFDQSxVQUFNLE1BQU0sS0FBSyxLQUFLLEdBQUc7QUFDekIsVUFBTSxRQUFRLCtCQUFLLEtBQUssT0FBTztBQUMvQixnQkFBTSxVQUFOLG1CQUFhLE1BQU07QUFDbkIsZ0JBQU0sVUFBTixtQkFBYTtBQUViLFFBQUk7QUFDSixRQUFJO0FBRUosUUFBSSxNQUFNLFFBQVE7QUFDaEIsWUFBTSxPQUFPLEdBQUcsUUFBUSxDQUFDLFNBQVM7QUFDaEMsWUFBSSxXQUFXLFFBQVc7QUFDeEIsbUJBQVM7QUFBQSxRQUNYLE9BQU87QUFDTCxvQkFBVTtBQUFBLFFBQ1o7QUFBQSxNQUNGLENBQUM7QUFBQSxJQUNIO0FBRUEsUUFBSSxNQUFNLFFBQVE7QUFDaEIsWUFBTSxPQUFPLEdBQUcsUUFBUSxDQUFDLFNBQVM7QUFDaEMsWUFBSSxXQUFXLFFBQVc7QUFDeEIsbUJBQVM7QUFBQSxRQUNYLE9BQU87QUFDTCxvQkFBVTtBQUFBLFFBQ1o7QUFBQSxNQUNGLENBQUM7QUFBQSxJQUNIO0FBRUEsV0FBTyxJQUFJLFFBQVEsQ0FBQyxTQUFTLFdBQVc7QUFDdEMsWUFBTSxHQUFHLFNBQVMsTUFBTTtBQUN4QixZQUFNLEdBQUcsU0FBUyxDQUFDLFNBQWlCO0FBQ2xDLFlBQUksU0FBUyxHQUFHO0FBQ2Qsa0JBQVEsTUFBTTtBQUNkO0FBQUEsUUFDRixXQUFXLFFBQVE7QUFDakIsa0JBQVEsTUFBTSxNQUFNO0FBQ3BCLGlCQUFPLElBQUksTUFBTSxNQUFNLENBQUM7QUFBQSxRQUMxQixXQUFXLFFBQVE7QUFDakIsa0JBQVEsTUFBTSxNQUFNO0FBQ3BCLGlCQUFPLElBQUksTUFBTSxNQUFNLENBQUM7QUFBQSxRQUMxQjtBQUFBLE1BQ0YsQ0FBQztBQUFBLElBQ0gsQ0FBQztBQUFBLEVBQ0g7QUFDRjs7O0FIM09BLElBQXFCLFdBQXJCLGNBQXNDLHdCQUFPO0FBQUEsRUFJM0MsTUFBTSxTQUFTO0FBQ2Isa0NBQVEsYUFBYSxhQUFhO0FBQ2xDLFVBQU0sS0FBSyxhQUFhO0FBQ3hCLFNBQUssY0FBYyxJQUFJLGNBQWMsS0FBSyxLQUFLLElBQUksQ0FBQztBQUVwRCxVQUFNLFlBQVksSUFBSSxZQUFZLElBQUk7QUFDdEMsU0FBSyxtQ0FBbUMsTUFBTSxVQUFVLGFBQWE7QUFFckUsU0FBSyxZQUFZO0FBQUEsRUFDbkI7QUFBQSxFQUVBLFdBQVc7QUFDVCxVQUFNLG1CQUFtQixLQUFLLFVBQVUsbUJBQW1CLE9BQU87QUFDbEUsVUFBTSxLQUFLLGdCQUFnQixFQUFFLFFBQVEsQ0FBQyxlQUFlO0FBQ25ELGlCQUFXLE1BQU07QUFBQSxJQUNuQixDQUFDO0FBQUEsRUFDSDtBQUFBLEVBRUEsTUFBTSxlQUFlO0FBQ25CLFNBQUssV0FBVyxPQUFPLE9BQU8sQ0FBQyxHQUFHLGtCQUFrQixNQUFNLEtBQUssU0FBUyxDQUFDO0FBQUEsRUFDM0U7QUFBQSxFQUVBLE1BQU0sZUFBZTtBQUNuQixVQUFNLEtBQUssU0FBUyxLQUFLLFFBQVE7QUFBQSxFQUNuQztBQUNGOyIsCiAgIm5hbWVzIjogW10KfQo=
